#!/bin/bash
# Bash completion for playground CLI
# Generated by papers-thesis-cli completions generator
#
# Installation:
#   1. Copy to /usr/local/etc/bash_completion.d/playground
#   2. Or source directly: source /path/to/playground-completion.bash
#   3. Or add to ~/.bashrc: source /path/to/playground-completion.bash

_playground_completions() {
    local cur prev words cword split
    _init_completion -s || return

    # Get command context
    local cmd=""
    local subcmd=""
    local i=1

    while [[ $i -lt $cword ]]; do
        case "${words[$i]}" in
            papers|thesis|config|meta)
                cmd="${words[$i]}"
                ;;
            *)
                if [[ -n "$cmd" && -z "$subcmd" && ! "${words[$i]}" =~ ^- ]]; then
                    subcmd="${words[$i]}"
                fi
                ;;
        esac
        ((i++))
    done

    # Complete based on context
    case "$prev" in
        # Global options that take arguments
        -f|--format)
            COMPREPLY=($(compgen -W "json json-pretty yaml table latex csv" -- "$cur"))
            return
            ;;
        -o|--output)
            _filedir
            return
            ;;
        -c|--config)
            _filedir '@(json|yaml|yml|mjs|js)'
            return
            ;;

        # papers command completions
        papers)
            COMPREPLY=($(compgen -W "generate list validate" -- "$cur"))
            return
            ;;
        --family)
            if [[ "$cmd" == "papers" ]]; then
                COMPREPLY=($(compgen -W "imrad dsr argument contribution IMRaD DSR Argument Contribution" -- "$cur"))
                return
            fi
            ;;
        --output)
            if [[ "$cmd" == "papers" ]]; then
                _filedir
                return
            fi
            ;;
        --format)
            if [[ "$cmd" == "papers" ]]; then
                COMPREPLY=($(compgen -W "json latex yaml" -- "$cur"))
                return
            fi
            ;;
        --format)
            if [[ "$cmd" == "papers" ]]; then
                COMPREPLY=($(compgen -W "json yaml table" -- "$cur"))
                return
            fi
            ;;
        --format)
            if [[ "$cmd" == "papers" ]]; then
                COMPREPLY=($(compgen -W "json table" -- "$cur"))
                return
            fi
            ;;

        # thesis command completions
        thesis)
            COMPREPLY=($(compgen -W "generate list schedule" -- "$cur"))
            return
            ;;
        --type)
            if [[ "$cmd" == "thesis" ]]; then
                COMPREPLY=($(compgen -W "masters phd doctoral Masters PhD Doctoral" -- "$cur"))
                return
            fi
            ;;
        --output)
            if [[ "$cmd" == "thesis" ]]; then
                _filedir
                return
            fi
            ;;
        --format)
            if [[ "$cmd" == "thesis" ]]; then
                COMPREPLY=($(compgen -W "json latex yaml" -- "$cur"))
                return
            fi
            ;;
        --format)
            if [[ "$cmd" == "thesis" ]]; then
                COMPREPLY=($(compgen -W "json yaml table" -- "$cur"))
                return
            fi
            ;;

        # config command completions
        config)
            COMPREPLY=($(compgen -W "list get set reset" -- "$cur"))
            return
            ;;

        # meta command completions
        meta)
            COMPREPLY=($(compgen -W "sparql schema version completions" -- "$cur"))
            return
            ;;
        --format)
            if [[ "$cmd" == "meta" ]]; then
                COMPREPLY=($(compgen -W "json table csv" -- "$cur"))
                return
            fi
            ;;
        --file)
            if [[ "$cmd" == "meta" ]]; then
                _filedir
                return
            fi
            ;;
        --format)
            if [[ "$cmd" == "meta" ]]; then
                COMPREPLY=($(compgen -W "json yaml turtle" -- "$cur"))
                return
            fi
            ;;
        --shell)
            if [[ "$cmd" == "meta" ]]; then
                COMPREPLY=($(compgen -W "bash zsh fish powershell" -- "$cur"))
                return
            fi
            ;;
        --output)
            if [[ "$cmd" == "meta" ]]; then
                _filedir
                return
            fi
            ;;
    esac

    # Main command completion logic
    if [[ -z "$cmd" ]]; then
        # No command yet, complete commands and global options
        COMPREPLY=($(compgen -W "papers thesis config meta -q --quiet -v --verbose -f --format -o --output -c --config -h --help --version" -- "$cur"))
    elif [[ -z "$subcmd" && "$cur" != -* ]]; then
        # Have command, complete subcommands
        case "$cmd" in
            papers)
                COMPREPLY=($(compgen -W "generate list validate" -- "$cur"))
                ;;
            thesis)
                COMPREPLY=($(compgen -W "generate list schedule" -- "$cur"))
                ;;
            config)
                COMPREPLY=($(compgen -W "list get set reset" -- "$cur"))
                ;;
            meta)
                COMPREPLY=($(compgen -W "sparql schema version completions" -- "$cur"))
                ;;
        esac
    else
        # Have subcommand, complete arguments
        local opts=""
        case "$cmd:$subcmd" in
            papers:generate)
                opts="--family --title --author --affiliation --abstract --output --format -q --quiet -v --verbose -f --format -o --output -c --config -h --help --version"
                ;;
            papers:list)
                opts="--verbose --format -q --quiet -v --verbose -f --format -o --output -c --config -h --help --version"
                ;;
            papers:validate)
                opts="--strict --format -q --quiet -v --verbose -f --format -o --output -c --config -h --help --version"
                ;;
            thesis:generate)
                opts="--type --title --author --advisor --institution --department --output --format -q --quiet -v --verbose -f --format -o --output -c --config -h --help --version"
                ;;
            thesis:list)
                opts="--verbose --format -q --quiet -v --verbose -f --format -o --output -c --config -h --help --version"
                ;;
            thesis:schedule)
                opts="--milestone --date -q --quiet -v --verbose -f --format -o --output -c --config -h --help --version"
                ;;
            config:reset)
                opts="--all -q --quiet -v --verbose -f --format -o --output -c --config -h --help --version"
                ;;
            meta:sparql)
                opts="--format --file -q --quiet -v --verbose -f --format -o --output -c --config -h --help --version"
                ;;
            meta:schema)
                opts="--format -q --quiet -v --verbose -f --format -o --output -c --config -h --help --version"
                ;;
            meta:completions)
                opts="--shell --output -q --quiet -v --verbose -f --format -o --output -c --config -h --help --version"
                ;;
        esac

        if [[ "$cur" == -* ]]; then
            COMPREPLY=($(compgen -W "$opts" -- "$cur"))
        else
            # File completion for positional arguments
            _filedir
        fi
    fi
}

# Register completion function
complete -F _playground_completions playground

# Dynamic completions (optional)
# These functions can be customized to load completions from domain data

_playground_complete_papers() {
    # Load available papers from knowledge graph or cache
    # Example: local papers=$($cliName papers list --format=names 2>/dev/null)
    # COMPREPLY=($(compgen -W "$papers" -- "$1"))
    :
}

_playground_complete_thesis() {
    # Load available thesis documents from knowledge graph or cache
    :
}

_playground_complete_templates() {
    # Load available templates
    local templates="imrad dsr argument contribution masters phd doctoral"
    COMPREPLY=($(compgen -W "$templates" -- "$1"))
}
