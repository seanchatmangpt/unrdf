# PowerShell completion for playground CLI
# Generated by papers-thesis-cli completions generator
#
# Installation:
#   1. Copy to your PowerShell profile directory
#   2. Or add to $PROFILE: . "/path/to/playground-completion.ps1"
#   3. For all users: Copy to $PSHOME/Modules/

# Define completion data
$playgroundCommands = @{
    'papers' = @{
        Description = 'Manage research papers'
        Subcommands = @{
            'generate' = @{
                Description = 'Generate paper from template'
                Args = @{
                    '--family' = @{
                        Description = 'Paper family/structure type'
                        Choices = @('imrad', 'dsr', 'argument', 'contribution')
                    }
                    '--title' = @{
                        Description = 'Paper title'
                        Short = '-t'
                    }
                    '--author' = @{
                        Description = 'Author name'
                        Short = '-a'
                    }
                    '--affiliation' = @{
                        Description = 'Author affiliation'
                    }
                    '--abstract' = @{
                        Description = 'Paper abstract'
                    }
                    '--output' = @{
                        Description = 'Output file path'
                        Short = '-o'
                        Type = 'file'
                    }
                    '--format' = @{
                        Description = 'Output format'
                        Choices = @('json', 'latex', 'yaml')
                        Short = '-f'
                    }
                }
            }
            'list' = @{
                Description = 'List available paper families'
                Args = @{
                    '--verbose' = @{
                        Description = 'Show detailed information'
                        Short = '-v'
                    }
                    '--format' = @{
                        Description = 'Output format'
                        Choices = @('json', 'yaml', 'table')
                        Short = '-f'
                    }
                }
            }
            'validate' = @{
                Description = 'Validate paper structure'
                Args = @{
                    '--strict' = @{
                        Description = 'Enable strict validation'
                    }
                    '--format' = @{
                        Description = 'Output format'
                        Choices = @('json', 'table')
                        Short = '-f'
                    }
                }
            }
        }
    }
    'thesis' = @{
        Description = 'Manage thesis documents'
        Subcommands = @{
            'generate' = @{
                Description = 'Generate thesis from template'
                Args = @{
                    '--type' = @{
                        Description = 'Thesis type'
                        Choices = @('masters', 'phd', 'doctoral')
                    }
                    '--title' = @{
                        Description = 'Thesis title'
                        Short = '-t'
                    }
                    '--author' = @{
                        Description = 'Author name'
                        Short = '-a'
                    }
                    '--advisor' = @{
                        Description = 'Advisor name'
                    }
                    '--institution' = @{
                        Description = 'Institution name'
                    }
                    '--department' = @{
                        Description = 'Department name'
                    }
                    '--output' = @{
                        Description = 'Output file path'
                        Short = '-o'
                        Type = 'file'
                    }
                    '--format' = @{
                        Description = 'Output format'
                        Choices = @('json', 'latex', 'yaml')
                        Short = '-f'
                    }
                }
            }
            'list' = @{
                Description = 'List available thesis types'
                Args = @{
                    '--verbose' = @{
                        Description = 'Show detailed information'
                        Short = '-v'
                    }
                    '--format' = @{
                        Description = 'Output format'
                        Choices = @('json', 'yaml', 'table')
                        Short = '-f'
                    }
                }
            }
            'schedule' = @{
                Description = 'Manage thesis schedule'
                Args = @{
                    '--milestone' = @{
                        Description = 'Milestone name'
                    }
                    '--date' = @{
                        Description = 'Target date'
                    }
                }
            }
        }
    }
    'config' = @{
        Description = 'Manage CLI configuration'
        Subcommands = @{
            'list' = @{
                Description = 'List all configuration values'
                Args = @{
                }
            }
            'get' = @{
                Description = 'Get a configuration value'
                Args = @{
                }
            }
            'set' = @{
                Description = 'Set a configuration value'
                Args = @{
                }
            }
            'reset' = @{
                Description = 'Reset configuration to defaults'
                Args = @{
                    '--all' = @{
                        Description = 'Reset all values'
                    }
                }
            }
        }
    }
    'meta' = @{
        Description = 'Metadata and introspection'
        Subcommands = @{
            'sparql' = @{
                Description = 'Execute SPARQL query'
                Args = @{
                    '--format' = @{
                        Description = 'Output format'
                        Choices = @('json', 'table', 'csv')
                        Short = '-f'
                    }
                    '--file' = @{
                        Description = 'Query file'
                        Type = 'file'
                    }
                }
            }
            'schema' = @{
                Description = 'Show schema information'
                Args = @{
                    '--format' = @{
                        Description = 'Output format'
                        Choices = @('json', 'yaml', 'turtle')
                        Short = '-f'
                    }
                }
            }
            'version' = @{
                Description = 'Show version information'
                Args = @{
                }
            }
            'completions' = @{
                Description = 'Generate shell completions'
                Args = @{
                    '--shell' = @{
                        Description = 'Target shell'
                        Choices = @('bash', 'zsh', 'fish', 'powershell')
                    }
                    '--output' = @{
                        Description = 'Output file'
                        Short = '-o'
                        Type = 'file'
                    }
                }
            }
        }
    }
}

# Global options available for all commands
$playgroundGlobalOptions = @(
    @{ Name = '-h'; Long = '--help'; Description = 'Show help information' }
    @{ Name = '-v'; Long = '--verbose'; Description = 'Enable verbose output' }
    @{ Name = '-q'; Long = '--quiet'; Description = 'Suppress non-essential output' }
    @{ Name = '-f'; Long = '--format'; Description = 'Output format'; Choices = @('json', 'json-pretty', 'yaml', 'table', 'latex', 'csv') }
    @{ Name = '-o'; Long = '--output'; Description = 'Output file path'; Type = 'file' }
    @{ Name = '-c'; Long = '--config'; Description = 'Configuration file'; Type = 'file' }
    @{ Name = ''; Long = '--version'; Description = 'Show version information' }
)

# Register argument completer
Register-ArgumentCompleter -CommandName playground -ScriptBlock {
    param($wordToComplete, $commandAst, $cursorPosition)

    $words = $commandAst.CommandElements | ForEach-Object { $_.Extent.Text }
    $wordsBeforeCursor = @()

    foreach ($word in $words) {
        if ($commandAst.CommandElements | Where-Object { $_.Extent.Text -eq $word -and $_.Extent.EndOffset -le $cursorPosition }) {
            $wordsBeforeCursor += $word
        }
    }

    $command = $null
    $subcommand = $null
    $lastArg = $null

    # Parse command context
    for ($i = 1; $i -lt $wordsBeforeCursor.Count; $i++) {
        $word = $wordsBeforeCursor[$i]
        if ($word -notlike '-*') {
            if (-not $command) {
                $command = $word
            } elseif (-not $subcommand) {
                $subcommand = $word
            }
        } else {
            $lastArg = $word
        }
    }

    $completions = @()

    # Check if we need to complete argument values
    if ($lastArg -and $command -and $subcommand) {
        $cmdData = $playgroundCommands[$command]
        if ($cmdData -and $cmdData.Subcommands[$subcommand]) {
            $argData = $cmdData.Subcommands[$subcommand].Args[$lastArg]
            if ($argData -and $argData.Choices) {
                foreach ($choice in $argData.Choices) {
                    if ($choice -like "$wordToComplete*") {
                        $completions += [System.Management.Automation.CompletionResult]::new(
                            $choice,
                            $choice,
                            'ParameterValue',
                            $choice
                        )
                    }
                }
                return $completions
            }
        }

        # Check global options
        foreach ($opt in $playgroundGlobalOptions) {
            if ($opt.Long -eq $lastArg -and $opt.Choices) {
                foreach ($choice in $opt.Choices) {
                    if ($choice -like "$wordToComplete*") {
                        $completions += [System.Management.Automation.CompletionResult]::new(
                            $choice,
                            $choice,
                            'ParameterValue',
                            $choice
                        )
                    }
                }
                return $completions
            }
        }
    }

    # Complete commands
    if (-not $command) {
        foreach ($cmd in $playgroundCommands.Keys) {
            if ($cmd -like "$wordToComplete*") {
                $desc = $playgroundCommands[$cmd].Description
                $completions += [System.Management.Automation.CompletionResult]::new(
                    $cmd,
                    $cmd,
                    'Command',
                    $desc
                )
            }
        }

        # Add global options
        foreach ($opt in $playgroundGlobalOptions) {
            if ($opt.Long -like "$wordToComplete*") {
                $completions += [System.Management.Automation.CompletionResult]::new(
                    $opt.Long,
                    $opt.Long,
                    'ParameterName',
                    $opt.Description
                )
            }
            if ($opt.Name -and $opt.Name -like "$wordToComplete*") {
                $completions += [System.Management.Automation.CompletionResult]::new(
                    $opt.Name,
                    $opt.Name,
                    'ParameterName',
                    $opt.Description
                )
            }
        }

        return $completions
    }

    # Complete subcommands
    if ($command -and -not $subcommand -and $playgroundCommands.ContainsKey($command)) {
        $cmdData = $playgroundCommands[$command]
        foreach ($subcmd in $cmdData.Subcommands.Keys) {
            if ($subcmd -like "$wordToComplete*") {
                $desc = $cmdData.Subcommands[$subcmd].Description
                $completions += [System.Management.Automation.CompletionResult]::new(
                    $subcmd,
                    $subcmd,
                    'Command',
                    $desc
                )
            }
        }
        return $completions
    }

    # Complete arguments for subcommand
    if ($command -and $subcommand -and $wordToComplete -like '-*') {
        $cmdData = $playgroundCommands[$command]
        if ($cmdData -and $cmdData.Subcommands[$subcommand]) {
            foreach ($arg in $cmdData.Subcommands[$subcommand].Args.Keys) {
                if ($arg -like "$wordToComplete*") {
                    $argData = $cmdData.Subcommands[$subcommand].Args[$arg]
                    $completions += [System.Management.Automation.CompletionResult]::new(
                        $arg,
                        $arg,
                        'ParameterName',
                        $argData.Description
                    )
                }
            }
        }

        # Add global options
        foreach ($opt in $playgroundGlobalOptions) {
            if ($opt.Long -like "$wordToComplete*") {
                $completions += [System.Management.Automation.CompletionResult]::new(
                    $opt.Long,
                    $opt.Long,
                    'ParameterName',
                    $opt.Description
                )
            }
        }
    }

    return $completions
}

Write-Host "playground completions loaded. Press Tab to use." -ForegroundColor Green
