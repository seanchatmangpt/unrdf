# =============================================================================
# SPARQL Named Queries for Papers-Thesis Ontology
# =============================================================================
#
# These queries are designed for use with the papers-thesis ontology.
# Compatible with N3.js, Comunica, and other SPARQL 1.1 compliant engines.
#
# Prefixes used:
#   PREFIX paper: <http://example.org/ontology/paper#>
#   PREFIX thesis: <http://example.org/ontology/thesis#>
#   PREFIX ex: <http://example.org/instances#>
#   PREFIX foaf: <http://xmlns.com/foaf/0.1/>
#   PREFIX dc: <http://purl.org/dc/terms/>
#   PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
#   PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
#   PREFIX owl: <http://www.w3.org/2002/07/owl#>
#   PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
# =============================================================================


# -----------------------------------------------------------------------------
# QUERY 1: Find all papers by author
# Description: Retrieves all papers written by a specific author
# Parameters: $authorName - the name of the author to search for
# -----------------------------------------------------------------------------
# Name: findPapersByAuthor
# Description: Find all papers written by a specific author

PREFIX paper: <http://example.org/ontology/paper#>
PREFIX foaf: <http://xmlns.com/foaf/0.1/>

SELECT ?paper ?title ?authorName
WHERE {
    ?paper a paper:Paper ;
           paper:hasTitle ?title ;
           paper:hasAuthor ?author .
    ?author foaf:name ?authorName .
}
ORDER BY ?title


# -----------------------------------------------------------------------------
# QUERY 2: Get thesis by type
# Description: Retrieves all theses of a specific type (PhD, Masters, etc.)
# Parameters: $type - the thesis type to filter by
# -----------------------------------------------------------------------------
# Name: getThesisByType
# Description: List all theses of a specific type

PREFIX thesis: <http://example.org/ontology/thesis#>
PREFIX paper: <http://example.org/ontology/paper#>

SELECT ?thesis ?title ?type ?institution ?degree
WHERE {
    ?thesis a ?thesisClass ;
            paper:hasTitle ?title ;
            thesis:thesisType ?type ;
            thesis:institution ?institution ;
            thesis:degree ?degree .
    FILTER(?thesisClass IN (thesis:PhDThesis, thesis:MastersThesis, thesis:BachelorsThesis))
}
ORDER BY ?degree ?title


# -----------------------------------------------------------------------------
# QUERY 3: List all sections of a paper
# Description: Retrieves all sections belonging to a specific paper with ordering
# Parameters: $paperUri - the URI of the paper
# -----------------------------------------------------------------------------
# Name: listPaperSections
# Description: List all sections of a paper in order

PREFIX paper: <http://example.org/ontology/paper#>

SELECT ?paper ?section ?heading ?order ?level ?content
WHERE {
    ?paper paper:hasSection ?section .
    ?section paper:sectionHeading ?heading ;
             paper:sectionOrder ?order .
    OPTIONAL { ?section paper:sectionLevel ?level }
    OPTIONAL { ?section paper:sectionContent ?content }
}
ORDER BY ?paper ?order


# -----------------------------------------------------------------------------
# QUERY 4: Find upcoming defenses
# Description: Retrieves thesis defense events scheduled in the future
# Parameters: None (uses current date)
# -----------------------------------------------------------------------------
# Name: findUpcomingDefenses
# Description: Find all thesis defenses scheduled in the future

PREFIX thesis: <http://example.org/ontology/thesis#>
PREFIX paper: <http://example.org/ontology/paper#>
PREFIX foaf: <http://xmlns.com/foaf/0.1/>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>

SELECT ?thesis ?title ?defenseDate ?location ?studentName
WHERE {
    ?thesis a thesis:Thesis ;
            paper:hasTitle ?title ;
            thesis:hasDefense ?defense ;
            paper:hasAuthor ?author .
    ?defense thesis:defenseDate ?defenseDate .
    ?author foaf:name ?studentName .
    OPTIONAL { ?defense thesis:defenseLocation ?location }
    FILTER (?defenseDate > NOW())
}
ORDER BY ?defenseDate


# -----------------------------------------------------------------------------
# QUERY 5: Ontology introspection - List all classes
# Description: Lists all classes defined in the ontology with their labels
# Parameters: None
# -----------------------------------------------------------------------------
# Name: listOntologyClasses
# Description: List all classes and their descriptions in the ontology

PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX paper: <http://example.org/ontology/paper#>
PREFIX thesis: <http://example.org/ontology/thesis#>

SELECT ?class ?label ?comment ?superClass
WHERE {
    ?class a owl:Class .
    OPTIONAL { ?class rdfs:label ?label }
    OPTIONAL { ?class rdfs:comment ?comment }
    OPTIONAL { ?class rdfs:subClassOf ?superClass }
    FILTER(STRSTARTS(STR(?class), STR(paper:)) || STRSTARTS(STR(?class), STR(thesis:)))
}
ORDER BY ?label


# -----------------------------------------------------------------------------
# QUERY 6: List all properties with domain and range
# Description: Lists all properties defined in the ontology
# Parameters: None
# -----------------------------------------------------------------------------
# Name: listOntologyProperties
# Description: List all properties with their domains and ranges

PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX paper: <http://example.org/ontology/paper#>
PREFIX thesis: <http://example.org/ontology/thesis#>

SELECT ?property ?label ?domain ?range ?type
WHERE {
    ?property a ?propType .
    FILTER(?propType IN (rdf:Property, owl:ObjectProperty, owl:DatatypeProperty))
    OPTIONAL { ?property rdfs:label ?label }
    OPTIONAL { ?property rdfs:domain ?domain }
    OPTIONAL { ?property rdfs:range ?range }
    BIND(IF(?propType = owl:ObjectProperty, "Object",
         IF(?propType = owl:DatatypeProperty, "Datatype", "General")) AS ?type)
    FILTER(STRSTARTS(STR(?property), STR(paper:)) || STRSTARTS(STR(?property), STR(thesis:)))
}
ORDER BY ?type ?label


# -----------------------------------------------------------------------------
# QUERY 7: Find papers by paper family type
# Description: Retrieves all papers of a specific structural family
# Parameters: $family - the paper family (imrad, argument, contribution, dsr, etc.)
# -----------------------------------------------------------------------------
# Name: findPapersByFamily
# Description: Find all papers belonging to a specific paper family

PREFIX paper: <http://example.org/ontology/paper#>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>

SELECT ?paper ?title ?family ?abstract
WHERE {
    ?paper a ?paperType ;
           paper:hasTitle ?title ;
           paper:paperFamily ?family .
    OPTIONAL { ?paper paper:hasAbstract ?abstract }
    FILTER(?paperType IN (paper:IMRADPaper, paper:ArgumentPaper, paper:ContributionPaper,
                          paper:DSRPaper, paper:NarrativePaper, paper:MonographPaper))
}
ORDER BY ?family ?title


# -----------------------------------------------------------------------------
# QUERY 8: Get author statistics
# Description: Count papers per author
# Parameters: None
# -----------------------------------------------------------------------------
# Name: getAuthorStatistics
# Description: Get statistics on papers per author

PREFIX paper: <http://example.org/ontology/paper#>
PREFIX foaf: <http://xmlns.com/foaf/0.1/>

SELECT ?authorName ?affiliation (COUNT(?work) AS ?paperCount)
WHERE {
    ?work paper:hasAuthor ?author .
    ?author foaf:name ?authorName .
    OPTIONAL { ?author foaf:affiliation ?affiliation }
}
GROUP BY ?authorName ?affiliation
ORDER BY DESC(?paperCount)


# -----------------------------------------------------------------------------
# QUERY 9: Find thesis milestones by status
# Description: Retrieves milestones filtered by their status
# Parameters: $status - the milestone status (pending, in-progress, completed)
# -----------------------------------------------------------------------------
# Name: findMilestonesByStatus
# Description: Find all milestones with a specific status

PREFIX thesis: <http://example.org/ontology/thesis#>
PREFIX paper: <http://example.org/ontology/paper#>

SELECT ?thesis ?thesisTitle ?milestoneName ?milestoneDate ?status
WHERE {
    ?thesis a thesis:Thesis ;
            paper:hasTitle ?thesisTitle ;
            thesis:hasSchedule ?schedule .
    ?schedule thesis:hasMilestone ?milestone .
    ?milestone thesis:milestoneName ?milestoneName ;
              thesis:milestoneDate ?milestoneDate ;
              thesis:milestoneStatus ?status .
}
ORDER BY ?thesis ?milestoneDate


# -----------------------------------------------------------------------------
# QUERY 10: Search papers by keyword
# Description: Full-text search on paper titles and abstracts
# Parameters: $keyword - the search term
# -----------------------------------------------------------------------------
# Name: searchPapersByKeyword
# Description: Search for papers containing a keyword in title or abstract

PREFIX paper: <http://example.org/ontology/paper#>
PREFIX foaf: <http://xmlns.com/foaf/0.1/>

SELECT DISTINCT ?paper ?title ?abstract
WHERE {
    ?paper a paper:Paper ;
           paper:hasTitle ?title .
    OPTIONAL { ?paper paper:hasAbstract ?abstract }
    OPTIONAL { ?paper paper:hasKeyword ?keyword }
    FILTER(
        CONTAINS(LCASE(?title), LCASE("$keyword")) ||
        CONTAINS(LCASE(?abstract), LCASE("$keyword")) ||
        CONTAINS(LCASE(?keyword), LCASE("$keyword"))
    )
}
ORDER BY ?title


# -----------------------------------------------------------------------------
# QUERY 11: Get committee members for a thesis defense
# Description: Lists all committee members and their roles for a defense
# Parameters: $thesisUri - the URI of the thesis
# -----------------------------------------------------------------------------
# Name: getDefenseCommittee
# Description: Get all committee members for a thesis defense

PREFIX thesis: <http://example.org/ontology/thesis#>
PREFIX paper: <http://example.org/ontology/paper#>
PREFIX foaf: <http://xmlns.com/foaf/0.1/>

SELECT ?thesis ?thesisTitle ?memberName ?role ?affiliation
WHERE {
    ?thesis a thesis:Thesis ;
            paper:hasTitle ?thesisTitle ;
            thesis:hasDefense ?defense .
    ?defense thesis:hasCommitteeMember ?member .
    ?member foaf:name ?memberName ;
            thesis:committeeRole ?role .
    OPTIONAL { ?member foaf:affiliation ?affiliation }
}
ORDER BY ?thesis ?role ?memberName


# -----------------------------------------------------------------------------
# QUERY 12: Find citation relationships
# Description: Retrieves citation network between papers
# Parameters: None
# -----------------------------------------------------------------------------
# Name: getCitationNetwork
# Description: Get the citation network between academic works

PREFIX paper: <http://example.org/ontology/paper#>

SELECT ?citingWork ?citingTitle ?citedWork ?citedTitle
WHERE {
    ?citingWork paper:cites ?citedWork ;
               paper:hasTitle ?citingTitle .
    ?citedWork paper:hasTitle ?citedTitle .
}
ORDER BY ?citingTitle ?citedTitle


# -----------------------------------------------------------------------------
# QUERY 13: Get papers by publication year
# Description: Retrieves papers published in a specific year
# Parameters: $year - the publication year
# -----------------------------------------------------------------------------
# Name: getPapersByYear
# Description: Find all papers published in a specific year

PREFIX paper: <http://example.org/ontology/paper#>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>

SELECT ?paper ?title ?year ?doi
WHERE {
    ?paper a paper:Paper ;
           paper:hasTitle ?title ;
           paper:publicationYear ?year .
    OPTIONAL { ?paper paper:hasDOI ?doi }
}
ORDER BY DESC(?year) ?title


# -----------------------------------------------------------------------------
# QUERY 14: Get section hierarchy
# Description: Retrieves the hierarchical structure of sections in a paper
# Parameters: $paperUri - the URI of the paper
# -----------------------------------------------------------------------------
# Name: getSectionHierarchy
# Description: Get the complete section hierarchy for a paper

PREFIX paper: <http://example.org/ontology/paper#>

SELECT ?paper ?paperTitle ?section ?heading ?level ?order ?parentHeading
WHERE {
    ?paper paper:hasTitle ?paperTitle ;
           paper:hasSection ?section .
    ?section paper:sectionHeading ?heading ;
             paper:sectionOrder ?order .
    OPTIONAL { ?section paper:sectionLevel ?level }
    OPTIONAL {
        ?section paper:hasParentSection ?parent .
        ?parent paper:sectionHeading ?parentHeading
    }
}
ORDER BY ?paper ?level ?order


# -----------------------------------------------------------------------------
# QUERY 15: Get overdue milestones
# Description: Finds milestones that are past their due date but not completed
# Parameters: None (uses current date)
# -----------------------------------------------------------------------------
# Name: getOverdueMilestones
# Description: Find milestones that are overdue

PREFIX thesis: <http://example.org/ontology/thesis#>
PREFIX paper: <http://example.org/ontology/paper#>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>

SELECT ?thesis ?thesisTitle ?milestoneName ?milestoneDate ?status
WHERE {
    ?thesis a thesis:Thesis ;
            paper:hasTitle ?thesisTitle ;
            thesis:hasSchedule ?schedule .
    ?schedule thesis:hasMilestone ?milestone .
    ?milestone thesis:milestoneName ?milestoneName ;
              thesis:milestoneDate ?milestoneDate ;
              thesis:milestoneStatus ?status .
    FILTER(?milestoneDate < NOW() && ?status != "completed")
}
ORDER BY ?milestoneDate


# -----------------------------------------------------------------------------
# QUERY 16: CONSTRUCT a paper summary graph
# Description: Constructs an RDF graph summarizing a paper
# Parameters: $paperUri - the URI of the paper
# -----------------------------------------------------------------------------
# Name: constructPaperSummary
# Description: Construct an RDF summary of a paper

PREFIX paper: <http://example.org/ontology/paper#>
PREFIX foaf: <http://xmlns.com/foaf/0.1/>
PREFIX dc: <http://purl.org/dc/terms/>

CONSTRUCT {
    ?paper dc:title ?title ;
           dc:creator ?authorName ;
           dc:abstract ?abstract ;
           dc:subject ?keyword .
}
WHERE {
    ?paper paper:hasTitle ?title ;
           paper:hasAuthor ?author .
    ?author foaf:name ?authorName .
    OPTIONAL { ?paper paper:hasAbstract ?abstract }
    OPTIONAL { ?paper paper:hasKeyword ?keyword }
}


# -----------------------------------------------------------------------------
# QUERY 17: ASK if paper has required IMRAD sections
# Description: Checks if an IMRAD paper has all required sections
# Parameters: $paperUri - the URI of the paper
# -----------------------------------------------------------------------------
# Name: validateIMRADStructure
# Description: Check if a paper has valid IMRAD structure

PREFIX paper: <http://example.org/ontology/paper#>

ASK {
    ?paper a paper:IMRADPaper ;
           paper:hasSection ?intro, ?methods, ?results, ?discussion .
    ?intro paper:sectionHeading ?introHeading .
    ?methods paper:sectionHeading ?methodsHeading .
    ?results paper:sectionHeading ?resultsHeading .
    ?discussion paper:sectionHeading ?discussionHeading .
    FILTER(
        CONTAINS(LCASE(?introHeading), "introduction") &&
        (CONTAINS(LCASE(?methodsHeading), "method") || CONTAINS(LCASE(?methodsHeading), "methodology")) &&
        CONTAINS(LCASE(?resultsHeading), "result") &&
        CONTAINS(LCASE(?discussionHeading), "discussion")
    )
}


# -----------------------------------------------------------------------------
# QUERY 18: Get thesis progress percentage
# Description: Calculates completion percentage based on milestones
# Parameters: $thesisUri - the URI of the thesis
# -----------------------------------------------------------------------------
# Name: getThesisProgress
# Description: Calculate thesis completion progress based on milestones

PREFIX thesis: <http://example.org/ontology/thesis#>
PREFIX paper: <http://example.org/ontology/paper#>

SELECT ?thesis ?title
       (COUNT(?milestone) AS ?totalMilestones)
       (COUNT(?completedMilestone) AS ?completedCount)
       (ROUND((COUNT(?completedMilestone) * 100.0 / COUNT(?milestone))) AS ?progressPercent)
WHERE {
    ?thesis a thesis:Thesis ;
            paper:hasTitle ?title ;
            thesis:hasSchedule ?schedule .
    ?schedule thesis:hasMilestone ?milestone .
    OPTIONAL {
        ?schedule thesis:hasMilestone ?completedMilestone .
        ?completedMilestone thesis:milestoneStatus "completed" .
    }
}
GROUP BY ?thesis ?title


# -----------------------------------------------------------------------------
# QUERY 19: Find co-authors
# Description: Finds all authors who have co-authored papers together
# Parameters: None
# -----------------------------------------------------------------------------
# Name: findCoAuthors
# Description: Find pairs of authors who have co-authored papers

PREFIX paper: <http://example.org/ontology/paper#>
PREFIX foaf: <http://xmlns.com/foaf/0.1/>

SELECT DISTINCT ?author1Name ?author2Name (COUNT(DISTINCT ?paper) AS ?collaborations)
WHERE {
    ?paper paper:hasAuthor ?author1, ?author2 .
    ?author1 foaf:name ?author1Name .
    ?author2 foaf:name ?author2Name .
    FILTER(STR(?author1) < STR(?author2))
}
GROUP BY ?author1Name ?author2Name
HAVING (COUNT(DISTINCT ?paper) > 0)
ORDER BY DESC(?collaborations)


# -----------------------------------------------------------------------------
# QUERY 20: Get paper with all details (DESCRIBE-like)
# Description: Retrieves comprehensive information about a paper
# Parameters: $paperUri - the URI of the paper
# -----------------------------------------------------------------------------
# Name: getPaperDetails
# Description: Get comprehensive details about a paper including all related entities

PREFIX paper: <http://example.org/ontology/paper#>
PREFIX foaf: <http://xmlns.com/foaf/0.1/>
PREFIX dc: <http://purl.org/dc/terms/>

SELECT ?paper ?title ?abstract ?family ?year ?doi ?publisherName
       (GROUP_CONCAT(DISTINCT ?authorName; separator=", ") AS ?authors)
       (GROUP_CONCAT(DISTINCT ?keyword; separator=", ") AS ?keywords)
       (COUNT(DISTINCT ?section) AS ?sectionCount)
WHERE {
    ?paper a paper:Paper ;
           paper:hasTitle ?title .
    OPTIONAL { ?paper paper:hasAbstract ?abstract }
    OPTIONAL { ?paper paper:paperFamily ?family }
    OPTIONAL { ?paper paper:publicationYear ?year }
    OPTIONAL { ?paper paper:hasDOI ?doi }
    OPTIONAL {
        ?paper paper:hasPublisher ?publisher .
        ?publisher foaf:name ?publisherName
    }
    OPTIONAL {
        ?paper paper:hasAuthor ?author .
        ?author foaf:name ?authorName
    }
    OPTIONAL { ?paper paper:hasKeyword ?keyword }
    OPTIONAL { ?paper paper:hasSection ?section }
}
GROUP BY ?paper ?title ?abstract ?family ?year ?doi ?publisherName
