<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Demo 1: RDF Parsing (Browser)</title>
  <style>
    body {
      font-family: 'Consolas', 'Monaco', monospace;
      max-width: 800px;
      margin: 40px auto;
      padding: 20px;
      background: #1e1e1e;
      color: #d4d4d4;
    }
    h1 {
      color: #4ec9b0;
      border-bottom: 2px solid #4ec9b0;
      padding-bottom: 10px;
    }
    pre {
      background: #2d2d2d;
      padding: 15px;
      border-radius: 5px;
      overflow-x: auto;
      border-left: 4px solid #569cd6;
    }
    .output {
      margin-top: 20px;
    }
    .success {
      color: #4ec9b0;
      font-weight: bold;
    }
    .error {
      color: #f48771;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>Demo 1: RDF Parsing (Browser)</h1>
  <p>This demo parses Turtle RDF using a minimal parser (same code as Node.js version).</p>

  <div class="output">
    <pre id="output">Running parser...</pre>
  </div>

  <script type="module">
    // Simple Turtle parser (minimal implementation for demo purposes)
    // IDENTICAL to Node.js version - proves cross-runtime compatibility
    function parseTurtleSimple(input) {
      const quads = [];
      const lines = input.split('\n').filter(l => {
        const trimmed = l.trim();
        return trimmed && !trimmed.startsWith('@prefix') && !trimmed.startsWith('#');
      });

      let currentSubject = null;
      let currentPredicate = null;

      for (const line of lines) {
        const trimmed = line.trim();
        if (!trimmed || trimmed === '.') continue;

        // Handle subject predicate object pattern
        const match = trimmed.match(/^(\S+)\s+(\S+)\s+(.+?)\s*[;.]?\s*$/);
        if (match) {
          const [, s, p, o] = match;

          currentSubject = s.startsWith('<') ? s.slice(1, -1) :
                           s.startsWith('ex:') ? `http://example.org/${s.slice(3)}` : s;

          currentPredicate = p.startsWith('<') ? p.slice(1, -1) :
                            p.startsWith('foaf:') ? `http://xmlns.com/foaf/0.1/${p.slice(5)}` : p;

          let object = o.replace(/[;.]$/, '').trim();
          if (object.startsWith('"') && object.endsWith('"')) {
            object = object.slice(1, -1);
          } else if (object.startsWith('<') && object.endsWith('>')) {
            object = object.slice(1, -1);
          } else if (object.startsWith('ex:')) {
            object = `http://example.org/${object.slice(3)}`;
          }

          quads.push({
            subject: { value: currentSubject },
            predicate: { value: currentPredicate },
            object: { value: object },
          });
        }
      }

      return quads;
    }

    const turtleInput = `
@prefix ex: <http://example.org/> .
@prefix foaf: <http://xmlns.com/foaf/0.1/> .

ex:alice foaf:name "Alice Smith" .
ex:alice foaf:age "30" .
ex:alice foaf:knows ex:bob .
ex:bob foaf:name "Bob Jones" .
ex:bob foaf:age "28" .
`;

    async function main() {
      const outputEl = document.getElementById('output');
      let log = '=== Demo 1: RDF Parsing (Browser) ===\n\n';

      try {
        const quads = parseTurtleSimple(turtleInput);

        log += `Parsed ${quads.length} triples:\n\n`;

        for (const quad of quads) {
          log += `Subject:   ${quad.subject.value}\n`;
          log += `Predicate: ${quad.predicate.value}\n`;
          log += `Object:    ${quad.object.value}\n`;
          log += '---\n';
        }

        log += `\n✅ Success: Parsed RDF in Browser\n`;
        log += `Total triples: ${quads.length}`;

        outputEl.textContent = log;
      } catch (error) {
        log += `\n❌ Error: ${error.message}\n`;
        outputEl.textContent = log;
        outputEl.className = 'error';
      }
    }

    main();
  </script>
</body>
</html>
