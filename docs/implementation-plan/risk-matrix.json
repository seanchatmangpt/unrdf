{
  "metadata": {
    "document": "KGC Probe Risk Matrix",
    "version": "1.0.0",
    "created": "2025-12-27",
    "agent": "Agent-2 (Code Goal Planner)",
    "methodology": "SPARC + Big Bang 80/20"
  },
  "risk_categories": [
    "forbidden_patterns",
    "integration",
    "performance",
    "quality",
    "resource"
  ],
  "severity_levels": {
    "critical": "Blocks release, requires immediate fix",
    "high": "Significant impact, must fix before release",
    "medium": "Moderate impact, should fix",
    "low": "Minor impact, nice to fix"
  },
  "risks": [
    {
      "id": "R001",
      "category": "forbidden_patterns",
      "title": "SPARQL Query Execution in Probe",
      "description": "Probe must only parse SPARQL, never execute queries",
      "severity": "critical",
      "probability": 0.3,
      "impact": 1.0,
      "detection": "Static analysis for SPARQL execution patterns",
      "detection_command": "grep -r 'execute\\|runQuery' src/agents/",
      "mitigation": "Guard in observation-guard.mjs blocks execution calls",
      "milestone_affected": ["M3"],
      "guard_reference": "forbidden:execute_sparql"
    },
    {
      "id": "R002",
      "category": "forbidden_patterns",
      "title": "Network I/O in Probe",
      "description": "Probe must not make HTTP/network calls",
      "severity": "critical",
      "probability": 0.2,
      "impact": 1.0,
      "detection": "Static analysis for fetch/http/net imports",
      "detection_command": "grep -r 'fetch\\|http\\|net\\|axios' src/",
      "mitigation": "ESLint rule blocks network modules",
      "milestone_affected": ["M3", "M4"],
      "guard_reference": "forbidden:network_io"
    },
    {
      "id": "R003",
      "category": "forbidden_patterns",
      "title": "File System Write in Probe",
      "description": "Probe must be read-only, no file writes",
      "severity": "critical",
      "probability": 0.25,
      "impact": 1.0,
      "detection": "Static analysis for fs.writeFile patterns",
      "detection_command": "grep -r 'writeFile\\|appendFile\\|createWriteStream' src/",
      "mitigation": "Guard blocks all write operations except storage backends",
      "milestone_affected": ["M2", "M3"],
      "guard_reference": "forbidden:file_write"
    },
    {
      "id": "R004",
      "category": "forbidden_patterns",
      "title": "Child Process Execution",
      "description": "Probe must not spawn child processes",
      "severity": "critical",
      "probability": 0.1,
      "impact": 1.0,
      "detection": "Static analysis for child_process imports",
      "detection_command": "grep -r 'child_process\\|spawn\\|exec\\|fork' src/",
      "mitigation": "ESLint rule blocks child_process module",
      "milestone_affected": ["M3"],
      "guard_reference": "forbidden:child_process"
    },
    {
      "id": "R005",
      "category": "forbidden_patterns",
      "title": "Path Traversal Vulnerability",
      "description": "Probe must not access files outside allowed directories",
      "severity": "critical",
      "probability": 0.35,
      "impact": 0.9,
      "detection": "Check for .. in file paths",
      "detection_command": "grep -r '\\.\\./' src/",
      "mitigation": "path-guard.mjs validates all file paths",
      "milestone_affected": ["M2", "M3"],
      "guard_reference": "forbidden:path_traversal"
    },
    {
      "id": "R006",
      "category": "forbidden_patterns",
      "title": "State Mutation",
      "description": "Probe must be deterministic, no mutable global state",
      "severity": "high",
      "probability": 0.4,
      "impact": 0.8,
      "detection": "Check for global variables and singletons",
      "detection_command": "grep -r 'global\\|window\\|process\\.' src/ | grep -v 'process.env'",
      "mitigation": "Pure functions, no shared mutable state",
      "milestone_affected": ["M3", "M4"],
      "guard_reference": "forbidden:state_mutation"
    },
    {
      "id": "R007",
      "category": "forbidden_patterns",
      "title": "Non-Deterministic Operations",
      "description": "Probe must not use Math.random() or Date.now() in output",
      "severity": "high",
      "probability": 0.45,
      "impact": 0.85,
      "detection": "Check for random/timestamp in hash computations",
      "detection_command": "grep -r 'Math.random\\|Date.now\\|new Date' src/ --include='*.mjs'",
      "mitigation": "Use deterministic timestamps from input, not current time",
      "milestone_affected": ["M3", "M4"],
      "guard_reference": "forbidden:non_deterministic"
    },
    {
      "id": "R008",
      "category": "forbidden_patterns",
      "title": "Eval/Dynamic Code Execution",
      "description": "Probe must not use eval() or Function()",
      "severity": "critical",
      "probability": 0.05,
      "impact": 1.0,
      "detection": "Static analysis for eval patterns",
      "detection_command": "grep -r 'eval\\|Function(' src/",
      "mitigation": "ESLint no-eval rule enforced",
      "milestone_affected": ["M3"],
      "guard_reference": "forbidden:eval"
    },
    {
      "id": "R009",
      "category": "forbidden_patterns",
      "title": "Dynamic Require",
      "description": "Probe must not use dynamic require() or import()",
      "severity": "high",
      "probability": 0.2,
      "impact": 0.7,
      "detection": "Check for dynamic import patterns",
      "detection_command": "grep -r 'require(\\s*[^\"'\\`]' src/",
      "mitigation": "Only static imports allowed",
      "milestone_affected": ["M3"],
      "guard_reference": "forbidden:dynamic_require"
    },
    {
      "id": "R010",
      "category": "forbidden_patterns",
      "title": "Receipt Tampering",
      "description": "Receipts must be immutable after creation",
      "severity": "critical",
      "probability": 0.15,
      "impact": 1.0,
      "detection": "Check for receipt mutation patterns",
      "detection_command": "grep -r 'receipt\\s*=' src/ | grep -v 'const receipt'",
      "mitigation": "Object.freeze() on all receipts",
      "milestone_affected": ["M4"],
      "guard_reference": "forbidden:receipt_tampering"
    },
    {
      "id": "R011",
      "category": "integration",
      "title": "oxigraph Integration Failure",
      "description": "createStore() or dataFactory may not work as expected",
      "severity": "high",
      "probability": 0.3,
      "impact": 0.9,
      "detection": "Integration test with oxigraph",
      "detection_command": "node -e \"import('@unrdf/oxigraph').then(o => console.log(!!o.createStore))\"",
      "mitigation": "Test oxigraph integration early in M2",
      "milestone_affected": ["M2"],
      "guard_reference": null
    },
    {
      "id": "R012",
      "category": "integration",
      "title": "kgc-substrate Integration Failure",
      "description": "KnowledgeStore wrapper may have API mismatches",
      "severity": "high",
      "probability": 0.35,
      "impact": 0.85,
      "detection": "Integration test with KnowledgeStore",
      "detection_command": "node -e \"import('@unrdf/kgc-substrate').then(k => console.log(!!k.KnowledgeStore))\"",
      "mitigation": "Verify KnowledgeStore API before M2 implementation",
      "milestone_affected": ["M2"],
      "guard_reference": null
    },
    {
      "id": "R013",
      "category": "integration",
      "title": "v6-core Receipt Integration Failure",
      "description": "BaseReceipt extension may break with version changes",
      "severity": "high",
      "probability": 0.25,
      "impact": 0.8,
      "detection": "Test BaseReceipt extension",
      "detection_command": "node -e \"import('@unrdf/v6-core/receipts/base-receipt.mjs').then(r => console.log(!!r.BaseReceipt))\"",
      "mitigation": "Lock v6-core version in package.json",
      "milestone_affected": ["M4"],
      "guard_reference": null
    },
    {
      "id": "R014",
      "category": "integration",
      "title": "kgc-cli Registration Failure",
      "description": "registerCommand() API may change",
      "severity": "medium",
      "probability": 0.2,
      "impact": 0.6,
      "detection": "Test CLI registration",
      "detection_command": "node -e \"import('@unrdf/kgc-cli').then(c => console.log(!!c.registerCommand))\"",
      "mitigation": "Verify kgc-cli API before M5",
      "milestone_affected": ["M5"],
      "guard_reference": null
    },
    {
      "id": "R015",
      "category": "performance",
      "title": "Latency Exceeds 100ms p99",
      "description": "Scan operation too slow for production use",
      "severity": "high",
      "probability": 0.4,
      "impact": 0.7,
      "detection": "Benchmark scan latency",
      "detection_command": "npm run benchmark -- probe.scan.latency",
      "mitigation": "Profile and optimize hot paths in M10",
      "milestone_affected": ["M10"],
      "guard_reference": null
    },
    {
      "id": "R016",
      "category": "performance",
      "title": "Memory Exceeds 500MB",
      "description": "Large document scans may exhaust memory",
      "severity": "high",
      "probability": 0.3,
      "impact": 0.75,
      "detection": "Profile memory usage",
      "detection_command": "node --max-old-space-size=512 --expose-gc test/memory.mjs",
      "mitigation": "Streaming observation processing, chunked merges",
      "milestone_affected": ["M4", "M8"],
      "guard_reference": null
    },
    {
      "id": "R017",
      "category": "performance",
      "title": "Throughput Below 10 docs/sec",
      "description": "Batch processing too slow",
      "severity": "medium",
      "probability": 0.35,
      "impact": 0.6,
      "detection": "Benchmark throughput",
      "detection_command": "npm run benchmark -- probe.scan.throughput",
      "mitigation": "Parallelize agent execution, optimize hashing",
      "milestone_affected": ["M10"],
      "guard_reference": null
    },
    {
      "id": "R018",
      "category": "quality",
      "title": "Test Coverage Below 80%",
      "description": "Insufficient test coverage for production",
      "severity": "high",
      "probability": 0.3,
      "impact": 0.7,
      "detection": "Run coverage report",
      "detection_command": "npx c8 --reporter=text npm test | grep 'All files'",
      "mitigation": "Add tests for uncovered branches in M6",
      "milestone_affected": ["M6"],
      "guard_reference": null
    },
    {
      "id": "R019",
      "category": "quality",
      "title": "OTEL Validation Score Below 80",
      "description": "Insufficient observability for production debugging",
      "severity": "high",
      "probability": 0.25,
      "impact": 0.8,
      "detection": "Run OTEL validation",
      "detection_command": "node validation/run-all.mjs comprehensive | grep 'Score:'",
      "mitigation": "Add spans and metrics to all critical paths",
      "milestone_affected": ["M8"],
      "guard_reference": null
    },
    {
      "id": "R020",
      "category": "quality",
      "title": "Error FP/FN Rate Above 1%",
      "description": "Too many false positives or negatives in error detection",
      "severity": "high",
      "probability": 0.35,
      "impact": 0.75,
      "detection": "Test on 100-doc corpus",
      "detection_command": "npm test -- test/error-accuracy.test.mjs",
      "mitigation": "Tune thresholds, improve detection logic",
      "milestone_affected": ["M8"],
      "guard_reference": null
    },
    {
      "id": "R021",
      "category": "resource",
      "title": "Agent-4 Overload",
      "description": "Agent-4 has too much work (84 hours on critical path)",
      "severity": "high",
      "probability": 0.5,
      "impact": 0.7,
      "detection": "Track agent progress",
      "detection_command": "Manual tracking of milestone completion",
      "mitigation": "Redistribute M3 agents to other available agents",
      "milestone_affected": ["M2", "M3", "M4"],
      "guard_reference": null
    },
    {
      "id": "R022",
      "category": "resource",
      "title": "Parallel Agent Coordination Failure",
      "description": "10 agents on M3 may produce conflicting code",
      "severity": "medium",
      "probability": 0.4,
      "impact": 0.5,
      "detection": "Git merge conflicts, test failures",
      "detection_command": "git status | grep 'both modified'",
      "mitigation": "Clear interface contracts, integration reviews",
      "milestone_affected": ["M3"],
      "guard_reference": null
    },
    {
      "id": "R023",
      "category": "resource",
      "title": "Missing External Dependencies",
      "description": "Required packages not available or incompatible",
      "severity": "medium",
      "probability": 0.2,
      "impact": 0.6,
      "detection": "npm install failures",
      "detection_command": "pnpm install",
      "mitigation": "Pin versions, verify availability upfront",
      "milestone_affected": ["M1"],
      "guard_reference": null
    },
    {
      "id": "R024",
      "category": "forbidden_patterns",
      "title": "YAML Parsing Size Limit Exceeded",
      "description": "Frontmatter YAML may exceed 10KB limit",
      "severity": "medium",
      "probability": 0.15,
      "impact": 0.5,
      "detection": "Check YAML size before parsing",
      "detection_command": "wc -c < frontmatter.yaml",
      "mitigation": "Guard rejects YAML > 10KB",
      "milestone_affected": ["M3"],
      "guard_reference": "limit:yaml_size"
    },
    {
      "id": "R025",
      "category": "forbidden_patterns",
      "title": "JSON Block Size Limit Exceeded",
      "description": "JSON block may exceed 1MB limit",
      "severity": "medium",
      "probability": 0.2,
      "impact": 0.5,
      "detection": "Check JSON size before parsing",
      "detection_command": "wc -c < block.json",
      "mitigation": "Guard rejects JSON > 1MB",
      "milestone_affected": ["M3"],
      "guard_reference": "limit:json_size"
    },
    {
      "id": "R026",
      "category": "forbidden_patterns",
      "title": "Receipt Chain Depth Exceeded",
      "description": "Receipt dependency chain > 10 levels",
      "severity": "medium",
      "probability": 0.1,
      "impact": 0.4,
      "detection": "DFS depth check in DAG validation",
      "detection_command": "Run dag-validation tests",
      "mitigation": "Guard rejects chains > 10 levels",
      "milestone_affected": ["M4"],
      "guard_reference": "limit:chain_depth"
    },
    {
      "id": "R027",
      "category": "forbidden_patterns",
      "title": "Receipt Count Exceeded",
      "description": "Document has > 1000 receipts",
      "severity": "low",
      "probability": 0.05,
      "impact": 0.3,
      "detection": "Count receipts in frontmatter",
      "detection_command": "jq '.receipts | length' frontmatter.json",
      "mitigation": "Guard rejects > 1000 receipts",
      "milestone_affected": ["M3"],
      "guard_reference": "limit:receipt_count"
    },
    {
      "id": "R028",
      "category": "forbidden_patterns",
      "title": "Concurrent Instance Violation",
      "description": "Multiple probe instances on same document",
      "severity": "low",
      "probability": 0.1,
      "impact": 0.3,
      "detection": "Lock file check",
      "detection_command": "ls -la .probe.lock",
      "mitigation": "Create lock file during scan",
      "milestone_affected": ["M4"],
      "guard_reference": "limit:concurrency"
    },
    {
      "id": "R029",
      "category": "integration",
      "title": "Merkle Tree Hash Mismatch",
      "description": "Receipt chain hashes don't verify correctly",
      "severity": "critical",
      "probability": 0.2,
      "impact": 0.95,
      "detection": "Merkle verification test",
      "detection_command": "npm test -- test/merkle.test.mjs",
      "mitigation": "Use canonical JSON (RFC 8785) for all hashing",
      "milestone_affected": ["M4"],
      "guard_reference": null
    },
    {
      "id": "R030",
      "category": "quality",
      "title": "Reproducibility Failure",
      "description": "Multiple scans produce different outputs",
      "severity": "critical",
      "probability": 0.25,
      "impact": 1.0,
      "detection": "Hash comparison of multiple runs",
      "detection_command": "for i in 1 2 3; do kgc probe scan doc.kgcmd | sha256sum; done | uniq | wc -l",
      "mitigation": "Remove all non-deterministic elements, use RFC 8785",
      "milestone_affected": ["M8"],
      "guard_reference": null
    }
  ],
  "summary": {
    "total_risks": 30,
    "by_severity": {
      "critical": 12,
      "high": 12,
      "medium": 5,
      "low": 1
    },
    "by_category": {
      "forbidden_patterns": 15,
      "integration": 5,
      "performance": 3,
      "quality": 4,
      "resource": 3
    },
    "highest_probability_risks": [
      {
        "id": "R021",
        "title": "Agent-4 Overload",
        "probability": 0.5
      },
      {
        "id": "R007",
        "title": "Non-Deterministic Operations",
        "probability": 0.45
      },
      {
        "id": "R022",
        "title": "Parallel Agent Coordination Failure",
        "probability": 0.4
      }
    ],
    "highest_impact_risks": [
      {
        "id": "R001",
        "title": "SPARQL Query Execution in Probe",
        "impact": 1.0
      },
      {
        "id": "R002",
        "title": "Network I/O in Probe",
        "impact": 1.0
      },
      {
        "id": "R030",
        "title": "Reproducibility Failure",
        "impact": 1.0
      }
    ]
  },
  "guard_policy_coverage": {
    "forbidden_operations": [
      "execute_sparql",
      "network_io",
      "file_write",
      "child_process",
      "path_traversal",
      "state_mutation",
      "non_deterministic",
      "eval",
      "dynamic_require",
      "receipt_tampering"
    ],
    "resource_limits": [
      "yaml_size",
      "json_size",
      "chain_depth",
      "receipt_count",
      "concurrency"
    ],
    "total_guards": 15,
    "coverage_percentage": 100
  }
}
