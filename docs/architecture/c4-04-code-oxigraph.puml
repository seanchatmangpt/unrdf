@startuml UNRDF Oxigraph - Code Level
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Component.puml

LAYOUT_WITH_LEGEND()

title @unrdf/oxigraph - C4 Code Level (Wrapper class, 3 files, 272 lines total)

Package("src/store.mjs") {
  Component(oxigraph_store, "class OxigraphStore", "Store Wrapper", "constructor(quads?: Quad[], options?: Object)\n\nüîµ STORE MANIPULATION (6 methods)\nadd(quad: Quad): void\n  ‚Üí this.store.add(quad)\n  ‚Üí Error wrapping\n  ‚Üí Type validation\n\naddQuad(quad: Quad): void [ALIAS]\n  ‚Üí add(quad) [N3 compat]\n\ndelete(quad: Quad): void\n  ‚Üí this.store.delete(quad)\n  ‚Üí Error wrapping\n\nhas(quad: Quad): boolean\n  ‚Üí this.store.has(quad)\n  ‚Üí Type validation\n\nmatch(s?: Term, p?: Term, o?: Term, g?: Term): Quad[]\n  ‚Üí this.store.quads(s, p, o, g)\n  ‚Üí Converts iterable ‚Üí Array\n  ‚Üí Null handling\n\ngetQuads(s?, p?, o?, g?): Quad[] [ALIAS]\n  ‚Üí match(s, p, o, g) [N3 compat]\n\nclear(): void\n  ‚Üí this.store.clear()\n  ‚Üí Error wrapping\n\nüîµ SPARQL OPERATIONS (2 methods)\nquery(sparql: string, options?: QueryOptions):\n  Result|Binding[]|boolean\n  ‚Üí this.store.query(sparql, options)\n  ‚Üí Query type detection\n  ‚Üí Format results\n  ‚Üí Sync execution\n\nupdate(sparql: string, options?: UpdateOptions): void\n  ‚Üí this.store.update(sparql, options)\n  ‚Üí SPARQL UPDATE execution\n  ‚Üí Error wrapping\n\nüîµ I/O OPERATIONS (2 methods)\nload(data: string|ArrayBuffer, options: LoadOptions):\n  void\n  ‚Üí format: string [REQUIRED]\n  ‚Üí baseIri?: string\n  ‚Üí this.store.load(data, options)\n  ‚Üí Format validation\n  ‚Üí Error handling\n\ndump(options: DumpOptions): string\n  ‚Üí format: string [REQUIRED]\n  ‚Üí fromNamedGraph?: Object\n  ‚Üí this.store.dump(options)\n  ‚Üí String serialization\n\nüîµ UTILITY PROPERTIES\nget size(): number\n  ‚Üí this.store.size\n  ‚Üí Read-only\n  ‚Üí Cache-friendly\n\nget db(): IDBDatabase|null [Browser only]\n  ‚Üí this.db (IndexedDB reference)\n  ‚Üí Null if closed\n\nstatic getDataFactory()\n  ‚Üí Returns DataFactory\n  ‚Üí For term creation\n\n‚öôÔ∏è INTERNAL STATE\n- this.store: oxigraph.Store (native)\n- this.options?: Object (config)\n- this._version?: number (reactivity)\n- this.db?: IDBDatabase (browser)")
}

Package("src/types.mjs") {
  Component(types_def, "Type Definitions (JSDoc)", "TypeScript-like JSDoc", "/**\n * @typedef OxigraphStoreOptions\n * @property {Quad[]} [quads]\n * @property {Object} [options]\n */\n\n/**\n * @typedef QueryOptions\n * @property {string} [baseIri]\n * @property {boolean} [useDefaultGraphAsUnion]\n * @property {Term[]} [defaultGraph]\n * @property {Term[]} [namedGraphs]\n * @property {string} [resultsFormat]\n */\n\n/**\n * @typedef UpdateOptions\n * @property {string} [baseIri]\n */\n\n/**\n * @typedef LoadOptions\n * @property {string} format REQUIRED\n *   'text/turtle' | 'application/n-quads'\n *   'application/trig' | 'application/ld+json'\n *   'application/rdf+xml' | 'application/n-triples'\n * @property {string} [baseIri]\n * @property {Object} [toNamedGraph]\n * @property {boolean} [unchecked]\n * @property {boolean} [noTransaction]\n */\n\n/**\n * @typedef DumpOptions\n * @property {string} format REQUIRED\n * @property {Object} [fromNamedGraph]\n */\n\n/**\n * @typedef BenchmarkResult\n * @property {string} operation\n * @property {string} engine\n * @property {number} duration (ms)\n * @property {number} tripleCount\n * @property {number} throughput (ops/sec)\n * @property {Error} [error]\n */")
}

Package("src/index.mjs") {
  Component(exports, "Public API (index.mjs)", "3 Exports", "export function createStore(quads?: Quad[]):\n  OxigraphStore\n  ‚Üí new OxigraphStore(quads)\n  ‚Üí Factory function\n\nexport const dataFactory = {\n  namedNode(iri: string): NamedNode\n    ‚Üí oxigraph.namedNode(iri)\n    ‚Üí Type: NamedNode\n\n  blankNode(id?: string): BlankNode\n    ‚Üí oxigraph.blankNode(id)\n    ‚Üí Auto-ID if not provided\n\n  literal(value: any, languageOrType?: string):\n    Literal\n    ‚Üí oxigraph.literal(value, lang|type)\n    ‚Üí Type inference\n\n  defaultGraph(): DefaultGraph\n    ‚Üí oxigraph.defaultGraph()\n    ‚Üí Singleton\n\n  quad(s: Term, p: Term, o: Term, g?: Term):\n    Quad\n    ‚Üí oxigraph.quad(s, p, o, g)\n    ‚Üí RDF.js standard\n\n  triple(s: Term, p: Term, o: Term): Quad\n    ‚Üí oxigraph.quad(s, p, o) [no graph]\n    ‚Üí Default graph assumed\n}\n\nexport { OxigraphStore }")
}

Package("Native Oxigraph (WASM)") {
  Component(oxigraph_native, "oxigraph npm package", "v0.5.2+ WASM binding", "Compiled from Rust to JavaScript\nWebAssembly binary\n\nStore class:\n  new Store()\n  add(), delete(), has()\n  quads() ‚Üí Iterable<Quad>\n  query() ‚Üí Results\n  update() ‚Üí void\n  load() ‚Üí void\n  dump() ‚Üí string\n  clear() ‚Üí void\n  size ‚Üí number\n\nDataFactory methods:\n  namedNode(), blankNode()\n  literal(), quad(), defaultGraph()\n\nRDF.js compatible\nHigh-performance C++ ‚Üí WASM")
}

' Error Handling Pattern
Component(error_handling, "Error Handling Pattern", "Wrapper Detail", "try {\n  const result = this.store.methodName(...)\n  return result\n} catch (error) {\n  throw new Error(\n    `OxigraphStore.methodName failed: ` +\n    `${error.message}`\n  )\n}\n\nAll methods wrapped\nConsistent error messages\nStack trace preservation")

' Type Conversion Detail
Component(type_conversion, "Type Conversion Detail", "Wrapper Detail", "match() converts iterable:\nthis.store.quads(...)\n  ‚Üì [Iterable]\nArray.from(...)\n  ‚Üì [Array]\nreturn [Quad[]]\n\nNull handling:\nif (subject === null)\n  subject = undefined\n  (Oxigraph convention)")

' RDF.js Compatibility
Component(rdfjs_compat, "RDF.js Compatibility", "Standard Interface", "Implements RDF.js Core specification\nTerm interface: Named Node, Blank Node,\n                Literal, Variable, Default Graph\nQuad interface: subject, predicate,\n                object, graph\nStore interface: add(), delete(), has(),\n                 quads(), match()")

' Relationships
Rel(oxigraph_store, exports, "implemented in")
Rel(exports, oxigraph_native, "wraps")
Rel(oxigraph_store, error_handling, "uses")
Rel(oxigraph_store, type_conversion, "uses")
Rel(exports, dataFactory, "exports")
Rel(oxigraph_native, rdfjs_compat, "implements")

note right of oxigraph_store
  **MINIMAL WRAPPER**

  ‚Ä¢ 193 lines total
  ‚Ä¢ Single responsibility
  ‚Ä¢ No business logic
  ‚Ä¢ Pure error wrapping
  ‚Ä¢ Null/undefined handling
  ‚Ä¢ Iterable ‚Üí Array conversion

  **Constructor:**
  new OxigraphStore(quads?, options?)
  ‚Üì
  this.store = new oxigraph.Store(quads)
  ‚Üì
  Ready to use

  **Design Pattern:**
  Adapter pattern
  OxigraphStore ‚Üê (adapts) ‚Üê oxigraph.Store
  Adds error handling, compatibility layer
end note

note right of dataFactory
  **FACTORY METHODS**

  Re-exports from Oxigraph
  Standard RDF.js compatible
  Used for quad construction

  Usage:
  const { namedNode, literal, quad } =
    oxigraphStore.getDataFactory()

  const name = literal('Alice', 'en')
  const person = namedNode('http://...')
  const q = quad(person, rdf.type, name)
end note

note right of error_handling
  **CONSISTENT ERROR WRAPPING**

  Every method wrapped with try-catch
  Error messages preserve context
  Stack traces preserved
  Method name included

  Example error:
  'OxigraphStore.query failed: SPARQL syntax error'
  ‚Üì [contains original message]
  ‚Üí Better debugging
end note

note right of type_conversion
  **ITERABLE ‚Üí ARRAY**

  Oxigraph.quads() returns Iterable
  JavaScript iteration protocol
  Array.from() converts to array
  Easier to use in JS

  Null handling:
  Oxigraph expects undefined
  but JS often uses null
  Conversion: null ‚Üí undefined
end note

note bottom
  **CODE METRICS**

  ‚Ä¢ Total lines: 272
  ‚Ä¢ Files: 3 (store.mjs, types.mjs, index.mjs)
  ‚Ä¢ Classes: 1 (OxigraphStore)
  ‚Ä¢ Public methods: 14
  ‚Ä¢ Static methods: 1
  ‚Ä¢ Properties: 2 (size, db)
  ‚Ä¢ External deps: oxigraph npm + Zod
  ‚Ä¢ Internal deps: none
  ‚Ä¢ Complexity: O(1) - all pass-through
  ‚Ä¢ Test coverage: 100% (wrapper)

  **Design Principle:**
  Thin adapter that adds:
  1. Error handling
  2. Type validation
  3. Compatibility layer (N3 aliases)
  4. RDF.js standard interface
  5. Nothing else (no logic added)
end note

SHOW_LEGEND()

@enduml
