# Dockerfile for KGC Sidecar Testcontainer
# Simplified container for E2E testing of Knowledge Graph Core library

FROM node:20-alpine

# Install system dependencies
RUN apk add --no-cache \
    git \
    curl \
    bash

# Create app directory
WORKDIR /app

# Copy project files from sidecar subdirectory
COPY sidecar/package.json sidecar/pnpm-lock.yaml* ./
COPY sidecar/nuxt.config.mjs ./

# Install dependencies
RUN npm install -g pnpm && \
    pnpm install --frozen-lockfile || npm install

# Copy Nuxt source code
COPY sidecar/server ./server
COPY sidecar/types ./types

# Copy parent project source for knowledge engine dependencies
COPY src ./src

# Create minimal .nuxt directory structure for production mode
RUN mkdir -p .nuxt

# Expose ports
EXPOSE 3000

# Set environment
ENV NODE_ENV=test \
    PORT=3000 \
    HOST=0.0.0.0

# Start Nuxt development server (for E2E testing with hot reload support)
CMD ["pnpm", "run", "dev", "--host", "0.0.0.0"]
