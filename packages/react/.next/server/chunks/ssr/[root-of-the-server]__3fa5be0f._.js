module.exports=[11902,(a,b,c)=>{"use strict";c._=function(a){return a&&a.__esModule?a:{default:a}}},91908,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={BailoutToCSRError:function(){return g},isBailoutToCSRError:function(){return h}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f="BAILOUT_TO_CLIENT_SIDE_RENDERING";class g extends Error{constructor(a){super(`Bail out to client-side rendering: ${a}`),this.reason=a,this.digest=f}}function h(a){return"object"==typeof a&&null!==a&&"digest"in a&&a.digest===f}},80479,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"BailoutToCSR",{enumerable:!0,get:function(){return e}});let d=a.r(91908);function e({reason:a,children:b}){throw Object.defineProperty(new d.BailoutToCSRError(a),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0})}},63003,(a,b,c)=>{"use strict";function d(a){return a.split("/").map(a=>encodeURIComponent(a)).join("/")}Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"encodeURIPath",{enumerable:!0,get:function(){return d}})},91380,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"PreloadChunks",{enumerable:!0,get:function(){return h}});let d=a.r(45623),e=a.r(936),f=a.r(56704),g=a.r(63003);function h({moduleIds:a}){let b=f.workAsyncStorage.getStore();if(void 0===b)return null;let c=[];if(b.reactLoadableManifest&&a){let d=b.reactLoadableManifest;for(let b of a){if(!d[b])continue;let a=d[b].files;c.push(...a)}}return 0===c.length?null:(0,d.jsx)(d.Fragment,{children:c.map(a=>{let c=`${b.assetPrefix}/_next/${(0,g.encodeURIPath)(a)}`;return a.endsWith(".css")?(0,d.jsx)("link",{precedence:"dynamic",href:c,rel:"stylesheet",as:"style",nonce:b.nonce},a):((0,e.preload)(c,{as:"script",fetchPriority:"low",nonce:b.nonce}),null)})})}},90232,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"default",{enumerable:!0,get:function(){return j}});let d=a.r(45623),e=a.r(88216),f=a.r(80479),g=a.r(91380);function h(a){return{default:a&&"default"in a?a.default:a}}let i={loader:()=>Promise.resolve(h(()=>null)),loading:null,ssr:!0},j=function(a){let b={...i,...a},c=(0,e.lazy)(()=>b.loader().then(h)),j=b.loading;function k(a){let h=j?(0,d.jsx)(j,{isLoading:!0,pastDelay:!0,error:null}):null,i=!b.ssr||!!b.loading,k=i?e.Suspense:e.Fragment,l=b.ssr?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(g.PreloadChunks,{moduleIds:b.modules}),(0,d.jsx)(c,{...a})]}):(0,d.jsx)(f.BailoutToCSR,{reason:"next/dynamic",children:(0,d.jsx)(c,{...a})});return(0,d.jsx)(k,{...i?{fallback:h}:{},children:l})}return k.displayName="LoadableComponent",k}},18265,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0}),Object.defineProperty(c,"default",{enumerable:!0,get:function(){return e}});let d=a.r(11902)._(a.r(90232));function e(a,b){let c={};"function"==typeof a&&(c.loader=a);let e={...c,...b};return(0,d.default)({...e,modules:e.loadableGenerated?.modules})}("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},37702,(a,b,c)=>{b.exports=a.x("worker_threads",()=>require("worker_threads"))},98409,a=>{"use strict";let b,c,d,e,f,g,h,i,j,k;var l,n,o,p,q,r,s,t=a.i(45623),u=a.i(88216),v=a.i(18265);function w(a){return a+.5|0}let x=(a,b,c)=>Math.max(Math.min(a,c),b);function y(a){return x(w(2.55*a),0,255)}function z(a){return x(w(255*a),0,255)}function A(a){return x(w(a/2.55)/100,0,1)}function B(a){return x(w(100*a),0,100)}let C={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},D=[..."0123456789ABCDEF"],E=a=>D[15&a],F=a=>D[(240&a)>>4]+D[15&a],G=a=>(240&a)>>4==(15&a),H=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function I(a,b,c){let d=b*Math.min(c,1-c),e=(b,e=(b+a/30)%12)=>c-d*Math.max(Math.min(e-3,9-e,1),-1);return[e(0),e(8),e(4)]}function J(a,b,c){let d=(d,e=(d+a/60)%6)=>c-c*b*Math.max(Math.min(e,4-e,1),0);return[d(5),d(3),d(1)]}function K(a,b,c){let d,e=I(a,1,.5);for(b+c>1&&(d=1/(b+c),b*=d,c*=d),d=0;d<3;d++)e[d]*=1-b-c,e[d]+=b;return e}function L(a){let b,c,d,e=a.r/255,f=a.g/255,g=a.b/255,h=Math.max(e,f,g),i=Math.min(e,f,g),j=(h+i)/2;h!==i&&(d=h-i,c=j>.5?d/(2-h-i):d/(h+i),b=60*(b=e===h?(f-g)/d+6*(f<g):f===h?(g-e)/d+2:(e-f)/d+4)+.5);return[0|b,c||0,j]}function M(a,b,c,d){return(Array.isArray(b)?a(b[0],b[1],b[2]):a(b,c,d)).map(z)}function N(a){return(a%360+360)%360}let O={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},P={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"},Q=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/,R=a=>a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055,S=a=>a<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4);function T(a,b,c){if(a){let d=L(a);d[b]=Math.max(0,Math.min(d[b]+d[b]*c,0===b?360:1)),a.r=(d=M(I,d,void 0,void 0))[0],a.g=d[1],a.b=d[2]}}function U(a,b){return a?Object.assign(b||{},a):a}function V(a){var b={r:0,g:0,b:0,a:255};return Array.isArray(a)?a.length>=3&&(b={r:a[0],g:a[1],b:a[2],a:255},a.length>3&&(b.a=z(a[3]))):(b=U(a,{r:0,g:0,b:0,a:1})).a=z(b.a),b}class W{constructor(a){let c;if(a instanceof W)return a;const d=typeof a;"object"===d?c=V(a):"string"===d&&(c=function(a){var b,c=a.length;return"#"===a[0]&&(4===c||5===c?b={r:255&17*C[a[1]],g:255&17*C[a[2]],b:255&17*C[a[3]],a:5===c?17*C[a[4]]:255}:(7===c||9===c)&&(b={r:C[a[1]]<<4|C[a[2]],g:C[a[3]]<<4|C[a[4]],b:C[a[5]]<<4|C[a[6]],a:9===c?C[a[7]]<<4|C[a[8]]:255})),b}(a)||function(a){b||((b=function(){let a,b,c,d,e,f={},g=Object.keys(P),h=Object.keys(O);for(a=0;a<g.length;a++){for(b=0,d=e=g[a];b<h.length;b++)c=h[b],e=e.replace(c,O[c]);c=parseInt(P[d],16),f[e]=[c>>16&255,c>>8&255,255&c]}return f}()).transparent=[0,0,0,0]);let c=b[a.toLowerCase()];return c&&{r:c[0],g:c[1],b:c[2],a:4===c.length?c[3]:255}}(a)||function(a){return"r"===a.charAt(0)?function(a){let b,c,d,e=Q.exec(a),f=255;if(e){if(e[7]!==b){let a=+e[7];f=e[8]?y(a):x(255*a,0,255)}return b=+e[1],c=+e[3],d=+e[5],b=255&(e[2]?y(b):x(b,0,255)),{r:b,g:c=255&(e[4]?y(c):x(c,0,255)),b:d=255&(e[6]?y(d):x(d,0,255)),a:f}}}(a):function(a){let b,c=H.exec(a),d=255;if(!c)return;c[5]!==b&&(d=c[6]?y(+c[5]):z(+c[5]));let e=N(+c[2]),f=c[3]/100,g=c[4]/100;return{r:(b="hwb"===c[1]?M(K,e,f,g):"hsv"===c[1]?M(J,e,f,g):M(I,e,f,g))[0],g:b[1],b:b[2],a:d}}(a)}(a)),this._rgb=c,this._valid=!!c}get valid(){return this._valid}get rgb(){var a=U(this._rgb);return a&&(a.a=A(a.a)),a}set rgb(a){this._rgb=V(a)}rgbString(){var a;return this._valid?(a=this._rgb)&&(a.a<255?`rgba(${a.r}, ${a.g}, ${a.b}, ${A(a.a)})`:`rgb(${a.r}, ${a.g}, ${a.b})`):void 0}hexString(){var a,b;let c,d;return this._valid?(b=G((c=a=this._rgb).r)&&G(c.g)&&G(c.b)&&G(c.a)?E:F,a?"#"+b(a.r)+b(a.g)+b(a.b)+(d=a.a,d<255?b(d):""):void 0):void 0}hslString(){return this._valid?function(a){if(!a)return;let b=L(a),c=b[0],d=B(b[1]),e=B(b[2]);return a.a<255?`hsla(${c}, ${d}%, ${e}%, ${A(a.a)})`:`hsl(${c}, ${d}%, ${e}%)`}(this._rgb):void 0}mix(a,b){if(a){let c,d=this.rgb,e=a.rgb,f=b===c?.5:b,g=2*f-1,h=d.a-e.a,i=((g*h==-1?g:(g+h)/(1+g*h))+1)/2;c=1-i,d.r=255&i*d.r+c*e.r+.5,d.g=255&i*d.g+c*e.g+.5,d.b=255&i*d.b+c*e.b+.5,d.a=f*d.a+(1-f)*e.a,this.rgb=d}return this}interpolate(a,b){var c,d;let e,f,g;return a&&(this._rgb=(c=this._rgb,d=a._rgb,e=S(A(c.r)),f=S(A(c.g)),g=S(A(c.b)),{r:z(R(e+b*(S(A(d.r))-e))),g:z(R(f+b*(S(A(d.g))-f))),b:z(R(g+b*(S(A(d.b))-g))),a:c.a+b*(d.a-c.a)})),this}clone(){return new W(this.rgb)}alpha(a){return this._rgb.a=z(a),this}clearer(a){let b=this._rgb;return b.a*=1-a,this}greyscale(){let a=this._rgb,b=w(.3*a.r+.59*a.g+.11*a.b);return a.r=a.g=a.b=b,this}opaquer(a){let b=this._rgb;return b.a*=1+a,this}negate(){let a=this._rgb;return a.r=255-a.r,a.g=255-a.g,a.b=255-a.b,this}lighten(a){return T(this._rgb,2,a),this}darken(a){return T(this._rgb,2,-a),this}saturate(a){return T(this._rgb,1,a),this}desaturate(a){return T(this._rgb,1,-a),this}rotate(a){var b,c;return b=this._rgb,(c=L(b))[0]=N(c[0]+a),b.r=(c=M(I,c,void 0,void 0))[0],b.g=c[1],b.b=c[2],this}}function X(){}let Y=(g=0,()=>g++);function Z(a){return null==a}function $(a){if(Array.isArray&&Array.isArray(a))return!0;let b=Object.prototype.toString.call(a);return"[object"===b.slice(0,7)&&"Array]"===b.slice(-6)}function _(a){return null!==a&&"[object Object]"===Object.prototype.toString.call(a)}function aa(a){return("number"==typeof a||a instanceof Number)&&isFinite(+a)}function ab(a,b){return aa(a)?a:b}function ac(a,b){return void 0===a?b:a}let ad=(a,b)=>"string"==typeof a&&a.endsWith("%")?parseFloat(a)/100*b:+a;function ae(a,b,c){if(a&&"function"==typeof a.call)return a.apply(c,b)}function af(a,b,c,d){let e,f,g;if($(a))if(f=a.length,d)for(e=f-1;e>=0;e--)b.call(c,a[e],e);else for(e=0;e<f;e++)b.call(c,a[e],e);else if(_(a))for(e=0,f=(g=Object.keys(a)).length;e<f;e++)b.call(c,a[g[e]],g[e])}function ag(a,b){let c,d,e,f;if(!a||!b||a.length!==b.length)return!1;for(c=0,d=a.length;c<d;++c)if(e=a[c],f=b[c],e.datasetIndex!==f.datasetIndex||e.index!==f.index)return!1;return!0}function ah(a){if($(a))return a.map(ah);if(_(a)){let b=Object.create(null),c=Object.keys(a),d=c.length,e=0;for(;e<d;++e)b[c[e]]=ah(a[c[e]]);return b}return a}function ai(a){return -1===["__proto__","prototype","constructor"].indexOf(a)}function aj(a,b,c,d){if(!ai(a))return;let e=b[a],f=c[a];_(e)&&_(f)?ak(e,f,d):b[a]=ah(f)}function ak(a,b,c){let d,e=$(b)?b:[b],f=e.length;if(!_(a))return a;let g=(c=c||{}).merger||aj;for(let b=0;b<f;++b){if(!_(d=e[b]))continue;let f=Object.keys(d);for(let b=0,e=f.length;b<e;++b)g(f[b],a,d,c)}return a}function al(a,b){return ak(a,b,{merger:am})}function am(a,b,c){if(!ai(a))return;let d=b[a],e=c[a];_(d)&&_(e)?al(d,e):Object.prototype.hasOwnProperty.call(b,a)||(b[a]=ah(e))}let an={"":a=>a,x:a=>a.x,y:a=>a.y};function ao(a,b){let c;return(an[b]||(an[b]=(c=function(a){let b=a.split("."),c=[],d="";for(let a of b)(d+=a).endsWith("\\")?d=d.slice(0,-1)+".":(c.push(d),d="");return c}(b),a=>{for(let b of c){if(""===b)break;a=a&&a[b]}return a})))(a)}function ap(a){return a.charAt(0).toUpperCase()+a.slice(1)}let aq=a=>void 0!==a,ar=a=>"function"==typeof a,as=(a,b)=>{if(a.size!==b.size)return!1;for(let c of a)if(!b.has(c))return!1;return!0},at=Math.PI,au=2*at,av=au+at,aw=at/180,ax=at/2,ay=at/4,az=2*at/3,aA=Math.log10,aB=Math.sign;function aC(a,b,c){return Math.abs(a-b)<c}function aD(a){let b=Math.round(a),c=Math.pow(10,Math.floor(aA(a=aC(a,b,a/1e3)?b:a))),d=a/c;return(d<=1?1:d<=2?2:d<=5?5:10)*c}function aE(a){return"symbol"!=typeof a&&("object"!=typeof a||null===a||!!(Symbol.toPrimitive in a||"toString"in a||"valueOf"in a))&&!isNaN(parseFloat(a))&&isFinite(a)}function aF(a,b,c){let d,e,f;for(d=0,e=a.length;d<e;d++)isNaN(f=a[d][c])||(b.min=Math.min(b.min,f),b.max=Math.max(b.max,f))}function aG(a){return at/180*a}function aH(a){if(!aa(a))return;let b=1,c=0;for(;Math.round(a*b)/b!==a;)b*=10,c++;return c}function aI(a,b){let c=b.x-a.x,d=b.y-a.y,e=Math.sqrt(c*c+d*d),f=Math.atan2(d,c);return f<-.5*at&&(f+=au),{angle:f,distance:e}}function aJ(a,b){return Math.sqrt(Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2))}function aK(a,b){return(a-b+av)%au-at}function aL(a){return(a%au+au)%au}function aM(a,b,c,d){let e=aL(a),f=aL(b),g=aL(c),h=aL(f-e),i=aL(g-e),j=aL(e-f),k=aL(e-g);return e===f||e===g||d&&f===g||h>i&&j<k}function aN(a,b,c){return Math.max(b,Math.min(c,a))}function aO(a,b,c,d=1e-6){return a>=Math.min(b,c)-d&&a<=Math.max(b,c)+d}function aP(a,b,c){let d;c=c||(c=>a[c]<b);let e=a.length-1,f=0;for(;e-f>1;)c(d=f+e>>1)?f=d:e=d;return{lo:f,hi:e}}let aQ=(a,b,c,d)=>aP(a,c,d?d=>{let e=a[d][b];return e<c||e===c&&a[d+1][b]===c}:d=>a[d][b]<c),aR=(a,b,c)=>aP(a,c,d=>a[d][b]>=c),aS=["push","pop","shift","splice","unshift"];function aT(a,b){let c=a._chartjs;if(!c)return;let d=c.listeners,e=d.indexOf(b);-1!==e&&d.splice(e,1),d.length>0||(aS.forEach(b=>{delete a[b]}),delete a._chartjs)}function aU(a){let b=new Set(a);return b.size===a.length?a:Array.from(b)}let aV=function(a){return a()},aW=a=>"start"===a?"left":"end"===a?"right":"center",aX=(a,b,c)=>"start"===a?b:"end"===a?c:(b+c)/2;function aY(a,b,c){let d=b.length,e=0,f=d;if(a._sorted){let{iScale:g,vScale:h,_parsed:i}=a,j=a.dataset&&a.dataset.options?a.dataset.options.spanGaps:null,k=g.axis,{min:l,max:n,minDefined:o,maxDefined:p}=g.getUserBounds();if(o){if(e=Math.min(aQ(i,k,l).lo,c?d:aQ(b,k,g.getPixelForValue(l)).lo),j){let a=i.slice(0,e+1).reverse().findIndex(a=>!Z(a[h.axis]));e-=Math.max(0,a)}e=aN(e,0,d-1)}if(p){let a=Math.max(aQ(i,g.axis,n,!0).hi+1,c?0:aQ(b,k,g.getPixelForValue(n),!0).hi+1);if(j){let b=i.slice(a-1).findIndex(a=>!Z(a[h.axis]));a+=Math.max(0,b)}f=aN(a,e,d)-e}else f=d-e}return{start:e,count:f}}function aZ(a){let{xScale:b,yScale:c,_scaleRanges:d}=a,e={xmin:b.min,xmax:b.max,ymin:c.min,ymax:c.max};if(!d)return a._scaleRanges=e,!0;let f=d.xmin!==b.min||d.xmax!==b.max||d.ymin!==c.min||d.ymax!==c.max;return Object.assign(d,e),f}let a$=a=>0===a||1===a,a_=(a,b,c)=>-(Math.pow(2,10*(a-=1))*Math.sin((a-b)*au/c)),a0=(a,b,c)=>Math.pow(2,-10*a)*Math.sin((a-b)*au/c)+1,a1={linear:a=>a,easeInQuad:a=>a*a,easeOutQuad:a=>-a*(a-2),easeInOutQuad:a=>(a/=.5)<1?.5*a*a:-.5*(--a*(a-2)-1),easeInCubic:a=>a*a*a,easeOutCubic:a=>(a-=1)*a*a+1,easeInOutCubic:a=>(a/=.5)<1?.5*a*a*a:.5*((a-=2)*a*a+2),easeInQuart:a=>a*a*a*a,easeOutQuart:a=>-((a-=1)*a*a*a-1),easeInOutQuart:a=>(a/=.5)<1?.5*a*a*a*a:-.5*((a-=2)*a*a*a-2),easeInQuint:a=>a*a*a*a*a,easeOutQuint:a=>(a-=1)*a*a*a*a+1,easeInOutQuint:a=>(a/=.5)<1?.5*a*a*a*a*a:.5*((a-=2)*a*a*a*a+2),easeInSine:a=>-Math.cos(a*ax)+1,easeOutSine:a=>Math.sin(a*ax),easeInOutSine:a=>-.5*(Math.cos(at*a)-1),easeInExpo:a=>0===a?0:Math.pow(2,10*(a-1)),easeOutExpo:a=>1===a?1:-Math.pow(2,-10*a)+1,easeInOutExpo:a=>a$(a)?a:a<.5?.5*Math.pow(2,10*(2*a-1)):.5*(-Math.pow(2,-10*(2*a-1))+2),easeInCirc:a=>a>=1?a:-(Math.sqrt(1-a*a)-1),easeOutCirc:a=>Math.sqrt(1-(a-=1)*a),easeInOutCirc:a=>(a/=.5)<1?-.5*(Math.sqrt(1-a*a)-1):.5*(Math.sqrt(1-(a-=2)*a)+1),easeInElastic:a=>a$(a)?a:a_(a,.075,.3),easeOutElastic:a=>a$(a)?a:a0(a,.075,.3),easeInOutElastic:a=>a$(a)?a:a<.5?.5*a_(2*a,.1125,.45):.5+.5*a0(2*a-1,.1125,.45),easeInBack:a=>a*a*(2.70158*a-1.70158),easeOutBack:a=>(a-=1)*a*(2.70158*a+1.70158)+1,easeInOutBack(a){let b=1.70158;return(a/=.5)<1?.5*(a*a*(((b*=1.525)+1)*a-b)):.5*((a-=2)*a*(((b*=1.525)+1)*a+b)+2)},easeInBounce:a=>1-a1.easeOutBounce(1-a),easeOutBounce:a=>a<.36363636363636365?7.5625*a*a:a<.7272727272727273?7.5625*(a-=.5454545454545454)*a+.75:a<.9090909090909091?7.5625*(a-=.8181818181818182)*a+.9375:7.5625*(a-=.9545454545454546)*a+.984375,easeInOutBounce:a=>a<.5?.5*a1.easeInBounce(2*a):.5*a1.easeOutBounce(2*a-1)+.5};function a2(a){if(a&&"object"==typeof a){let b=a.toString();return"[object CanvasPattern]"===b||"[object CanvasGradient]"===b}return!1}function a3(a){return a2(a)?a:new W(a)}function a4(a){return a2(a)?a:new W(a).saturate(.5).darken(.1).hexString()}let a5=["x","y","borderWidth","radius","tension"],a6=["color","borderColor","backgroundColor"],a7=new Map;function a8(a,b,c){var d;let e,f;return(e=b+JSON.stringify(d=(d=c)||{}),!(f=a7.get(e))&&(f=new Intl.NumberFormat(b,d),a7.set(e,f)),f).format(a)}let a9={values:a=>$(a)?a:""+a,numeric(a,b,c){let d;if(0===a)return"0";let e=this.chart.options.locale,f=a;if(c.length>1){var g,h;let b,e=Math.max(Math.abs(c[0].value),Math.abs(c[c.length-1].value));(e<1e-4||e>1e15)&&(d="scientific"),g=a,Math.abs(b=(h=c).length>3?h[2].value-h[1].value:h[1].value-h[0].value)>=1&&g!==Math.floor(g)&&(b=g-Math.floor(g)),f=b}let i=aA(Math.abs(f)),j=isNaN(i)?1:Math.max(Math.min(-1*Math.floor(i),20),0),k={notation:d,minimumFractionDigits:j,maximumFractionDigits:j};return Object.assign(k,this.options.ticks.format),a8(a,e,k)},logarithmic(a,b,c){return 0===a?"0":[1,2,3,5,10,15].includes(c[b].significand||a/Math.pow(10,Math.floor(aA(a))))||b>.8*c.length?a9.numeric.call(this,a,b,c):""}},ba=Object.create(null),bb=Object.create(null);function bc(a,b){if(!b)return a;let c=b.split(".");for(let b=0,d=c.length;b<d;++b){let d=c[b];a=a[d]||(a[d]=Object.create(null))}return a}function bd(a,b,c){return"string"==typeof b?ak(bc(a,b),c):ak(bc(a,""),b)}var be=new class{constructor(a,b){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=a=>a.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(a,b)=>a4(b.backgroundColor),this.hoverBorderColor=(a,b)=>a4(b.borderColor),this.hoverColor=(a,b)=>a4(b.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(a),this.apply(b)}set(a,b){return bd(this,a,b)}get(a){return bc(this,a)}describe(a,b){return bd(bb,a,b)}override(a,b){return bd(ba,a,b)}route(a,b,c,d){let e=bc(this,a),f=bc(this,c),g="_"+b;Object.defineProperties(e,{[g]:{value:e[b],writable:!0},[b]:{enumerable:!0,get(){let a=this[g],b=f[d];return _(a)?Object.assign({},b,a):ac(a,b)},set(a){this[g]=a}}})}apply(a){a.forEach(a=>a(this))}}({_scriptable:a=>!a.startsWith("on"),_indexable:a=>"events"!==a,hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[function(a){a.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),a.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:a=>"onProgress"!==a&&"onComplete"!==a&&"fn"!==a}),a.set("animations",{colors:{type:"color",properties:a6},numbers:{type:"number",properties:a5}}),a.describe("animations",{_fallback:"animation"}),a.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:a=>0|a}}}})},function(a){a.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})},function(a){a.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(a,b)=>b.lineWidth,tickColor:(a,b)=>b.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:a9.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),a.route("scale.ticks","color","","color"),a.route("scale.grid","color","","borderColor"),a.route("scale.border","color","","borderColor"),a.route("scale.title","color","","color"),a.describe("scale",{_fallback:!1,_scriptable:a=>!a.startsWith("before")&&!a.startsWith("after")&&"callback"!==a&&"parser"!==a,_indexable:a=>"borderDash"!==a&&"tickBorderDash"!==a&&"dash"!==a}),a.describe("scales",{_fallback:"scale"}),a.describe("scale.ticks",{_scriptable:a=>"backdropPadding"!==a&&"callback"!==a,_indexable:a=>"backdropPadding"!==a})}]);function bf(a,b,c,d,e){let f=b[e];return f||(f=b[e]=a.measureText(e).width,c.push(e)),f>d&&(d=f),d}function bg(a,b,c){let d=a.currentDevicePixelRatio,e=0!==c?Math.max(c/2,.5):0;return Math.round((b-e)*d)/d+e}function bh(a,b){(b||a)&&((b=b||a.getContext("2d")).save(),b.resetTransform(),b.clearRect(0,0,a.width,a.height),b.restore())}function bi(a,b,c,d){bj(a,b,c,d,null)}function bj(a,b,c,d,e){let f,g,h,i,j,k,l,n,o=b.pointStyle,p=b.rotation,q=b.radius,r=(p||0)*aw;if(o&&"object"==typeof o&&("[object HTMLImageElement]"===(f=o.toString())||"[object HTMLCanvasElement]"===f)){a.save(),a.translate(c,d),a.rotate(r),a.drawImage(o,-o.width/2,-o.height/2,o.width,o.height),a.restore();return}if(!isNaN(q)&&!(q<=0)){switch(a.beginPath(),o){default:e?a.ellipse(c,d,e/2,q,0,0,au):a.arc(c,d,q,0,au),a.closePath();break;case"triangle":k=e?e/2:q,a.moveTo(c+Math.sin(r)*k,d-Math.cos(r)*q),r+=az,a.lineTo(c+Math.sin(r)*k,d-Math.cos(r)*q),r+=az,a.lineTo(c+Math.sin(r)*k,d-Math.cos(r)*q),a.closePath();break;case"rectRounded":j=.516*q,g=Math.cos(r+ay)*(i=q-j),l=Math.cos(r+ay)*(e?e/2-j:i),h=Math.sin(r+ay)*i,n=Math.sin(r+ay)*(e?e/2-j:i),a.arc(c-l,d-h,j,r-at,r-ax),a.arc(c+n,d-g,j,r-ax,r),a.arc(c+l,d+h,j,r,r+ax),a.arc(c-n,d+g,j,r+ax,r+at),a.closePath();break;case"rect":if(!p){i=Math.SQRT1_2*q,k=e?e/2:i,a.rect(c-k,d-i,2*k,2*i);break}r+=ay;case"rectRot":l=Math.cos(r)*(e?e/2:q),g=Math.cos(r)*q,h=Math.sin(r)*q,n=Math.sin(r)*(e?e/2:q),a.moveTo(c-l,d-h),a.lineTo(c+n,d-g),a.lineTo(c+l,d+h),a.lineTo(c-n,d+g),a.closePath();break;case"crossRot":r+=ay;case"cross":l=Math.cos(r)*(e?e/2:q),g=Math.cos(r)*q,h=Math.sin(r)*q,n=Math.sin(r)*(e?e/2:q),a.moveTo(c-l,d-h),a.lineTo(c+l,d+h),a.moveTo(c+n,d-g),a.lineTo(c-n,d+g);break;case"star":l=Math.cos(r)*(e?e/2:q),g=Math.cos(r)*q,h=Math.sin(r)*q,n=Math.sin(r)*(e?e/2:q),a.moveTo(c-l,d-h),a.lineTo(c+l,d+h),a.moveTo(c+n,d-g),a.lineTo(c-n,d+g),r+=ay,l=Math.cos(r)*(e?e/2:q),g=Math.cos(r)*q,h=Math.sin(r)*q,n=Math.sin(r)*(e?e/2:q),a.moveTo(c-l,d-h),a.lineTo(c+l,d+h),a.moveTo(c+n,d-g),a.lineTo(c-n,d+g);break;case"line":g=e?e/2:Math.cos(r)*q,h=Math.sin(r)*q,a.moveTo(c-g,d-h),a.lineTo(c+g,d+h);break;case"dash":a.moveTo(c,d),a.lineTo(c+Math.cos(r)*(e?e/2:q),d+Math.sin(r)*q);break;case!1:a.closePath()}a.fill(),b.borderWidth>0&&a.stroke()}}function bk(a,b,c){return c=c||.5,!b||a&&a.x>b.left-c&&a.x<b.right+c&&a.y>b.top-c&&a.y<b.bottom+c}function bl(a,b){a.save(),a.beginPath(),a.rect(b.left,b.top,b.right-b.left,b.bottom-b.top),a.clip()}function bm(a){a.restore()}function bn(a,b,c,d,e){if(!b)return a.lineTo(c.x,c.y);if("middle"===e){let d=(b.x+c.x)/2;a.lineTo(d,b.y),a.lineTo(d,c.y)}else"after"===e!=!!d?a.lineTo(b.x,c.y):a.lineTo(c.x,b.y);a.lineTo(c.x,c.y)}function bo(a,b,c,d){if(!b)return a.lineTo(c.x,c.y);a.bezierCurveTo(d?b.cp1x:b.cp2x,d?b.cp1y:b.cp2y,d?c.cp2x:c.cp1x,d?c.cp2y:c.cp1y,c.x,c.y)}function bp(a,b,c,d,e,f={}){let g,h,i=$(b)?b:[b],j=f.strokeWidth>0&&""!==f.strokeColor;for(a.save(),a.font=e.string,f.translation&&a.translate(f.translation[0],f.translation[1]),Z(f.rotation)||a.rotate(f.rotation),f.color&&(a.fillStyle=f.color),f.textAlign&&(a.textAlign=f.textAlign),f.textBaseline&&(a.textBaseline=f.textBaseline),g=0;g<i.length;++g)h=i[g],f.backdrop&&function(a,b){let c=a.fillStyle;a.fillStyle=b.color,a.fillRect(b.left,b.top,b.width,b.height),a.fillStyle=c}(a,f.backdrop),j&&(f.strokeColor&&(a.strokeStyle=f.strokeColor),Z(f.strokeWidth)||(a.lineWidth=f.strokeWidth),a.strokeText(h,c,d,f.maxWidth)),a.fillText(h,c,d,f.maxWidth),function(a,b,c,d,e){if(e.strikethrough||e.underline){let f=a.measureText(d),g=b-f.actualBoundingBoxLeft,h=b+f.actualBoundingBoxRight,i=c-f.actualBoundingBoxAscent,j=c+f.actualBoundingBoxDescent,k=e.strikethrough?(i+j)/2:j;a.strokeStyle=a.fillStyle,a.beginPath(),a.lineWidth=e.decorationWidth||2,a.moveTo(g,k),a.lineTo(h,k),a.stroke()}}(a,c,d,h,f),d+=Number(e.lineHeight);a.restore()}function bq(a,b){let{x:c,y:d,w:e,h:f,radius:g}=b;a.arc(c+g.topLeft,d+g.topLeft,g.topLeft,1.5*at,at,!0),a.lineTo(c,d+f-g.bottomLeft),a.arc(c+g.bottomLeft,d+f-g.bottomLeft,g.bottomLeft,at,ax,!0),a.lineTo(c+e-g.bottomRight,d+f),a.arc(c+e-g.bottomRight,d+f-g.bottomRight,g.bottomRight,ax,0,!0),a.lineTo(c+e,d+g.topRight),a.arc(c+e-g.topRight,d+g.topRight,g.topRight,0,-ax,!0),a.lineTo(c+g.topLeft,d)}let br=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,bs=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/,bt=a=>+a||0;function bu(a,b){let c={},d=_(b),e=d?Object.keys(b):b,f=_(a)?d?c=>ac(a[c],a[b[c]]):b=>a[b]:()=>a;for(let a of e)c[a]=bt(f(a));return c}function bv(a){return bu(a,{top:"y",right:"x",bottom:"y",left:"x"})}function bw(a){return bu(a,["topLeft","topRight","bottomLeft","bottomRight"])}function bx(a){let b=bv(a);return b.width=b.left+b.right,b.height=b.top+b.bottom,b}function by(a,b){a=a||{},b=b||be.font;let c=ac(a.size,b.size);"string"==typeof c&&(c=parseInt(c,10));let d=ac(a.style,b.style);d&&!(""+d).match(bs)&&(console.warn('Invalid font style specified: "'+d+'"'),d=void 0);let e={family:ac(a.family,b.family),lineHeight:function(a,b){let c=(""+a).match(br);if(!c||"normal"===c[1])return 1.2*b;switch(a=+c[2],c[3]){case"px":return a;case"%":a/=100}return b*a}(ac(a.lineHeight,b.lineHeight),c),size:c,style:d,weight:ac(a.weight,b.weight),string:""};return e.string=!e||Z(e.size)||Z(e.family)?null:(e.style?e.style+" ":"")+(e.weight?e.weight+" ":"")+e.size+"px "+e.family,e}function bz(a,b,c,d){let e,f,g,h=!0;for(e=0,f=a.length;e<f;++e)if(void 0!==(g=a[e])&&(void 0!==b&&"function"==typeof g&&(g=g(b),h=!1),void 0!==c&&$(g)&&(g=g[c%g.length],h=!1),void 0!==g))return d&&!h&&(d.cacheable=!1),g}function bA(a,b){return Object.assign(Object.create(a),b)}function bB(a,b=[""],c,d,e=()=>a[0]){let f=c||a;return void 0===d&&(d=bK("_fallback",a)),new Proxy({[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:a,_rootScopes:f,_fallback:d,_getTarget:e,override:c=>bB([c,...a],b,f,d)},{deleteProperty:(b,c)=>(delete b[c],delete b._keys,delete a[0][c],!0),get:(c,d)=>bG(c,d,()=>(function(a,b,c,d){let e;for(let f of b)if(void 0!==(e=bK(bE(f,a),c)))return bF(a,e)?bI(c,d,a,e):e})(d,b,a,c)),getOwnPropertyDescriptor:(a,b)=>Reflect.getOwnPropertyDescriptor(a._scopes[0],b),getPrototypeOf:()=>Reflect.getPrototypeOf(a[0]),has:(a,b)=>bL(a).includes(b),ownKeys:a=>bL(a),set(a,b,c){let d=a._storage||(a._storage=e());return a[b]=d[b]=c,delete a._keys,!0}})}function bC(a,b,c,d){return new Proxy({_cacheable:!1,_proxy:a,_context:b,_subProxy:c,_stack:new Set,_descriptors:bD(a,d),setContext:b=>bC(a,b,c,d),override:e=>bC(a.override(e),b,c,d)},{deleteProperty:(b,c)=>(delete b[c],delete a[c],!0),get:(a,b,c)=>bG(a,b,()=>(function(a,b,c){let{_proxy:d,_context:e,_subProxy:f,_descriptors:g}=a,h=d[b];return ar(h)&&g.isScriptable(b)&&(h=function(a,b,c,d){let{_proxy:e,_context:f,_subProxy:g,_stack:h}=c;if(h.has(a))throw Error("Recursion detected: "+Array.from(h).join("->")+"->"+a);h.add(a);let i=b(f,g||d);return h.delete(a),bF(a,i)&&(i=bI(e._scopes,e,a,i)),i}(b,h,a,c)),$(h)&&h.length&&(h=function(a,b,c,d){let{_proxy:e,_context:f,_subProxy:g,_descriptors:h}=c;if(void 0!==f.index&&d(a))return b[f.index%b.length];if(_(b[0])){let c=b,d=e._scopes.filter(a=>a!==c);for(let i of(b=[],c)){let c=bI(d,e,a,i);b.push(bC(c,f,g&&g[a],h))}}return b}(b,h,a,g.isIndexable)),bF(b,h)&&(h=bC(h,e,f&&f[b],g)),h})(a,b,c)),getOwnPropertyDescriptor:(b,c)=>b._descriptors.allKeys?Reflect.has(a,c)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(a,c),getPrototypeOf:()=>Reflect.getPrototypeOf(a),has:(b,c)=>Reflect.has(a,c),ownKeys:()=>Reflect.ownKeys(a),set:(b,c,d)=>(a[c]=d,delete b[c],!0)})}function bD(a,b={scriptable:!0,indexable:!0}){let{_scriptable:c=b.scriptable,_indexable:d=b.indexable,_allKeys:e=b.allKeys}=a;return{allKeys:e,scriptable:c,indexable:d,isScriptable:ar(c)?c:()=>c,isIndexable:ar(d)?d:()=>d}}let bE=(a,b)=>a?a+ap(b):b,bF=(a,b)=>_(b)&&"adapters"!==a&&(null===Object.getPrototypeOf(b)||b.constructor===Object);function bG(a,b,c){if(Object.prototype.hasOwnProperty.call(a,b)||"constructor"===b)return a[b];let d=c();return a[b]=d,d}let bH=(a,b)=>!0===a?b:"string"==typeof a?ao(b,a):void 0;function bI(a,b,c,d){var e;let f=b._rootScopes,g=(e=b._fallback,ar(e)?e(c,d):e),h=[...a,...f],i=new Set;i.add(d);let j=bJ(i,h,c,g||c,d);return null!==j&&(void 0===g||g===c||null!==(j=bJ(i,h,g,j,d)))&&bB(Array.from(i),[""],f,g,()=>{var a,e,f;let g,h;return a=b,e=c,f=d,e in(g=a._getTarget())||(g[e]={}),$(h=g[e])&&_(f)?f:h||{}})}function bJ(a,b,c,d,e){for(;c;)c=function(a,b,c,d,e){for(let g of b){let b=bH(c,g);if(b){var f;a.add(b);let g=(f=b._fallback,ar(f)?f(c,e):f);if(void 0!==g&&g!==c&&g!==d)return g}else if(!1===b&&void 0!==d&&c!==d)return null}return!1}(a,b,c,d,e);return c}function bK(a,b){for(let c of b){if(!c)continue;let b=c[a];if(void 0!==b)return b}}function bL(a){let b=a._keys;return b||(b=a._keys=function(a){let b=new Set;for(let c of a)for(let a of Object.keys(c).filter(a=>!a.startsWith("_")))b.add(a);return Array.from(b)}(a._scopes)),b}function bM(a,b,c,d){let e,f,g,{iScale:h}=a,{key:i="r"}=this._parsing,j=Array(d);for(e=0;e<d;++e)g=b[f=e+c],j[e]={r:h.parse(ao(g,i),f)};return j}let bN=Number.EPSILON||1e-14,bO=(a,b)=>b<a.length&&!a[b].skip&&a[b],bP=a=>"x"===a?"y":"x";function bQ(a,b,c){return Math.max(Math.min(a,c),b)}let bR=a=>a.ownerDocument.defaultView.getComputedStyle(a,null),bS=["top","right","bottom","left"];function bT(a,b,c){let d={};c=c?"-"+c:"";for(let e=0;e<4;e++){let f=bS[e];d[f]=parseFloat(a[b+"-"+f+c])||0}return d.width=d.left+d.right,d.height=d.top+d.bottom,d}function bU(a,b){if("native"in a)return a;let{canvas:c,currentDevicePixelRatio:d}=b,e=bR(c),f="border-box"===e.boxSizing,g=bT(e,"padding"),h=bT(e,"border","width"),{x:i,y:j,box:k}=function(a,b){let c,d,e,f=a.touches,g=f&&f.length?f[0]:a,{offsetX:h,offsetY:i}=g,j=!1;if(e=a.target,(h>0||i>0)&&(!e||!e.shadowRoot))c=h,d=i;else{let a=b.getBoundingClientRect();c=g.clientX-a.left,d=g.clientY-a.top,j=!0}return{x:c,y:d,box:j}}(a,c),l=g.left+(k&&h.left),n=g.top+(k&&h.top),{width:o,height:p}=b;return f&&(o-=g.width+h.width,p-=g.height+h.height),{x:Math.round((i-l)/o*c.width/d),y:Math.round((j-n)/p*c.height/d)}}let bV=a=>Math.round(10*a)/10;function bW(a,b,c){let d=b||1,e=bV(a.height*d),f=bV(a.width*d);a.height=bV(a.height),a.width=bV(a.width);let g=a.canvas;return g.style&&(c||!g.style.height&&!g.style.width)&&(g.style.height=`${a.height}px`,g.style.width=`${a.width}px`),(a.currentDevicePixelRatio!==d||g.height!==e||g.width!==f)&&(a.currentDevicePixelRatio=d,g.height=e,g.width=f,a.ctx.setTransform(d,0,0,d,0,0),!0)}function bX(a,b,c,d){return{x:a.x+c*(b.x-a.x),y:a.y+c*(b.y-a.y)}}function bY(a,b,c,d){return{x:a.x+c*(b.x-a.x),y:"middle"===d?c<.5?a.y:b.y:"after"===d?c<1?a.y:b.y:c>0?b.y:a.y}}function bZ(a,b,c,d){let e={x:a.cp2x,y:a.cp2y},f={x:b.cp1x,y:b.cp1y},g=bX(a,e,c),h=bX(e,f,c),i=bX(f,b,c),j=bX(g,h,c),k=bX(h,i,c);return bX(j,k,c)}function b$(a,b,c){var d;return a?(d=c,{x:a=>b+b+d-a,setWidth(a){d=a},textAlign:a=>"center"===a?a:"right"===a?"left":"right",xPlus:(a,b)=>a-b,leftForLtr:(a,b)=>a-b}):{x:a=>a,setWidth(a){},textAlign:a=>a,xPlus:(a,b)=>a+b,leftForLtr:(a,b)=>a}}function b_(a,b){let c,d;("ltr"===b||"rtl"===b)&&(d=[(c=a.canvas.style).getPropertyValue("direction"),c.getPropertyPriority("direction")],c.setProperty("direction",b,"important"),a.prevTextDirection=d)}function b0(a,b){void 0!==b&&(delete a.prevTextDirection,a.canvas.style.setProperty("direction",b[0],b[1]))}function b1(a){return"angle"===a?{between:aM,compare:aK,normalize:aL}:{between:aO,compare:(a,b)=>a-b,normalize:a=>a}}function b2({start:a,end:b,count:c,loop:d,style:e}){return{start:a%c,end:b%c,loop:d&&(b-a+1)%c==0,style:e}}function b3(a,b,c){let d,e,f;if(!c)return[a];let{property:g,start:h,end:i}=c,j=b.length,{compare:k,between:l,normalize:n}=b1(g),{start:o,end:p,loop:q,style:r}=function(a,b,c){let d,{property:e,start:f,end:g}=c,{between:h,normalize:i}=b1(e),j=b.length,{start:k,end:l,loop:n}=a;if(n){for(k+=j,l+=j,d=0;d<j&&h(i(b[k%j][e]),f,g);++d)k--,l--;k%=j,l%=j}return l<k&&(l+=j),{start:k,end:l,loop:n,style:a.style}}(a,b,c),s=[],t=!1,u=null,v=()=>t||l(h,f,d)&&0!==k(h,f),w=()=>!t||0===k(i,d)||l(i,f,d);for(let a=o,c=o;a<=p;++a)(e=b[a%j]).skip||(d=n(e[g]))!==f&&(t=l(d,h,i),null===u&&v()&&(u=0===k(d,h)?a:c),null!==u&&w()&&(s.push(b2({start:u,end:a,loop:q,count:j,style:r})),u=null),c=a,f=d);return null!==u&&s.push(b2({start:u,end:p,loop:q,count:j,style:r})),s}function b4(a,b){let c=[],d=a.segments;for(let e=0;e<d.length;e++){let f=b3(d[e],a.points,b);f.length&&c.push(...f)}return c}function b5(a,b,c,d){return d&&d.setContext&&c?function(a,b,c,d){let e=a._chart.getContext(),f=b6(a.options),{_datasetIndex:g,options:{spanGaps:h}}=a,i=c.length,j=[],k=f,l=b[0].start,n=l;function o(a,b,d,e){let f=h?-1:1;if(a!==b){for(a+=i;c[a%i].skip;)a-=f;for(;c[b%i].skip;)b+=f;a%i!=b%i&&(j.push({start:a%i,end:b%i,loop:d,style:e}),k=e,l=b%i)}}for(let a of b){let b,f=c[(l=h?l:a.start)%i];for(n=l+1;n<=a.end;n++){let h=c[n%i];(function(a,b){if(!b)return!1;let c=[],d=function(a,b){return a2(b)?(c.includes(b)||c.push(b),c.indexOf(b)):b};return JSON.stringify(a,d)!==JSON.stringify(b,d)})(b=b6(d.setContext(bA(e,{type:"segment",p0:f,p1:h,p0DataIndex:(n-1)%i,p1DataIndex:n%i,datasetIndex:g}))),k)&&o(l,n-1,a.loop,k),f=h,k=b}l<n-1&&o(l,n-1,a.loop,k)}return j}(a,b,c,d):b}function b6(a){return{backgroundColor:a.backgroundColor,borderCapStyle:a.borderCapStyle,borderDash:a.borderDash,borderDashOffset:a.borderDashOffset,borderJoinStyle:a.borderJoinStyle,borderWidth:a.borderWidth,borderColor:a.borderColor}}function b7(a,b,c){return a.options.clip?a[c]:b[c]}function b8(a,b){let c=b._clip;if(c.disabled)return!1;let d=function(a,b){let{xScale:c,yScale:d}=a;return c&&d?{left:b7(c,b,"left"),right:b7(c,b,"right"),top:b7(d,b,"top"),bottom:b7(d,b,"bottom")}:b}(b,a.chartArea);return{left:!1===c.left?0:d.left-(!0===c.left?0:c.left),right:!1===c.right?a.width:d.right+(!0===c.right?0:c.right),top:!1===c.top?0:d.top-(!0===c.top?0:c.top),bottom:!1===c.bottom?a.height:d.bottom+(!0===c.bottom?0:c.bottom)}}var b9=new class{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(a,b,c,d){let e=b.listeners[d],f=b.duration;e.forEach(d=>d({chart:a,initial:b.initial,numSteps:f,currentStep:Math.min(c-b.start,f)}))}_refresh(){this._request||(this._running=!0,this._request=aV.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(a=Date.now()){let b=0;this._charts.forEach((c,d)=>{let e;if(!c.running||!c.items.length)return;let f=c.items,g=f.length-1,h=!1;for(;g>=0;--g)(e=f[g])._active?(e._total>c.duration&&(c.duration=e._total),e.tick(a),h=!0):(f[g]=f[f.length-1],f.pop());h&&(d.draw(),this._notify(d,c,a,"progress")),f.length||(c.running=!1,this._notify(d,c,a,"complete"),c.initial=!1),b+=f.length}),this._lastDate=a,0===b&&(this._running=!1)}_getAnims(a){let b=this._charts,c=b.get(a);return c||(c={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},b.set(a,c)),c}listen(a,b,c){this._getAnims(a).listeners[b].push(c)}add(a,b){b&&b.length&&this._getAnims(a).items.push(...b)}has(a){return this._getAnims(a).items.length>0}start(a){let b=this._charts.get(a);b&&(b.running=!0,b.start=Date.now(),b.duration=b.items.reduce((a,b)=>Math.max(a,b._duration),0),this._refresh())}running(a){if(!this._running)return!1;let b=this._charts.get(a);return!!b&&!!b.running&&!!b.items.length}stop(a){let b=this._charts.get(a);if(!b||!b.items.length)return;let c=b.items,d=c.length-1;for(;d>=0;--d)c[d].cancel();b.items=[],this._notify(a,b,Date.now(),"complete")}remove(a){return this._charts.delete(a)}};let ca="transparent",cb={boolean:(a,b,c)=>c>.5?b:a,color(a,b,c){let d=a3(a||ca),e=d.valid&&a3(b||ca);return e&&e.valid?e.mix(d,c).hexString():b},number:(a,b,c)=>a+(b-a)*c};class cc{constructor(a,b,c,d){const e=b[c];d=bz([a.to,d,e,a.from]);const f=bz([a.from,e,d]);this._active=!0,this._fn=a.fn||cb[a.type||typeof f],this._easing=a1[a.easing]||a1.linear,this._start=Math.floor(Date.now()+(a.delay||0)),this._duration=this._total=Math.floor(a.duration),this._loop=!!a.loop,this._target=b,this._prop=c,this._from=f,this._to=d,this._promises=void 0}active(){return this._active}update(a,b,c){if(this._active){this._notify(!1);let d=this._target[this._prop],e=c-this._start,f=this._duration-e;this._start=c,this._duration=Math.floor(Math.max(f,a.duration)),this._total+=e,this._loop=!!a.loop,this._to=bz([a.to,b,d,a.from]),this._from=bz([a.from,d,b])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(a){let b,c=a-this._start,d=this._duration,e=this._prop,f=this._from,g=this._loop,h=this._to;if(this._active=f!==h&&(g||c<d),!this._active){this._target[e]=h,this._notify(!0);return}if(c<0){this._target[e]=f;return}b=c/d%2,b=g&&b>1?2-b:b,b=this._easing(Math.min(1,Math.max(0,b))),this._target[e]=this._fn(f,h,b)}wait(){let a=this._promises||(this._promises=[]);return new Promise((b,c)=>{a.push({res:b,rej:c})})}_notify(a){let b=a?"res":"rej",c=this._promises||[];for(let a=0;a<c.length;a++)c[a][b]()}}class cd{constructor(a,b){this._chart=a,this._properties=new Map,this.configure(b)}configure(a){if(!_(a))return;let b=Object.keys(be.animation),c=this._properties;Object.getOwnPropertyNames(a).forEach(d=>{let e=a[d];if(!_(e))return;let f={};for(let a of b)f[a]=e[a];($(e.properties)&&e.properties||[d]).forEach(a=>{a!==d&&c.has(a)||c.set(a,f)})})}_animateOptions(a,b){let c=b.options,d=function(a,b){if(!b)return;let c=a.options;if(!c){a.options=b;return}return c.$shared&&(a.options=c=Object.assign({},c,{$shared:!1,$animations:{}})),c}(a,c);if(!d)return[];let e=this._createAnimations(d,c);return c.$shared&&(function(a,b){let c=[],d=Object.keys(b);for(let b=0;b<d.length;b++){let e=a[d[b]];e&&e.active()&&c.push(e.wait())}return Promise.all(c)})(a.options.$animations,c).then(()=>{a.options=c},()=>{}),e}_createAnimations(a,b){let c,d=this._properties,e=[],f=a.$animations||(a.$animations={}),g=Object.keys(b),h=Date.now();for(c=g.length-1;c>=0;--c){let i=g[c];if("$"===i.charAt(0))continue;if("options"===i){e.push(...this._animateOptions(a,b));continue}let j=b[i],k=f[i],l=d.get(i);if(k)if(l&&k.active()){k.update(l,j,h);continue}else k.cancel();if(!l||!l.duration){a[i]=j;continue}f[i]=k=new cc(l,a,i,j),e.push(k)}return e}update(a,b){if(0===this._properties.size)return void Object.assign(a,b);let c=this._createAnimations(a,b);if(c.length)return b9.add(this._chart,c),!0}}function ce(a,b){let c=a&&a.options||{},d=c.reverse,e=void 0===c.min?b:0,f=void 0===c.max?b:0;return{start:d?f:e,end:d?e:f}}function cf(a,b){let c,d,e=[],f=a._getSortedDatasetMetas(b);for(c=0,d=f.length;c<d;++c)e.push(f[c].index);return e}function cg(a,b,c,d={}){let e,f,g,h,i=a.keys,j="single"===d.mode;if(null===b)return;let k=!1;for(e=0,f=i.length;e<f;++e){if((g=+i[e])===c){if(k=!0,d.all)continue;break}aa(h=a.values[g])&&(j||0===b||aB(b)===aB(h))&&(b+=h)}return k||d.all?b:0}function ch(a,b){let c=a&&a.options.stacked;return c||void 0===c&&void 0!==b.stack}function ci(a,b,c,d){for(let e of b.getMatchingVisibleMetas(d).reverse()){let b=a[e.index];if(c&&b>0||!c&&b<0)return e.index}return null}function cj(a,b){let c,{chart:d,_cachedMeta:e}=a,f=d._stacks||(d._stacks={}),{iScale:g,vScale:h,index:i}=e,j=g.axis,k=h.axis,l=`${g.id}.${h.id}.${e.stack||e.type}`,n=b.length;for(let a=0;a<n;++a){let d=b[a],{[j]:g,[k]:n}=d;(c=(d._stacks||(d._stacks={}))[k]=function(a,b,c){let d=a[b]||(a[b]={});return d[c]||(d[c]={})}(f,l,g))[i]=n,c._top=ci(c,h,!0,e.type),c._bottom=ci(c,h,!1,e.type),(c._visualValues||(c._visualValues={}))[i]=n}}function ck(a,b){let c=a.scales;return Object.keys(c).filter(a=>c[a].axis===b).shift()}function cl(a,b){let c=a.controller.index,d=a.vScale&&a.vScale.axis;if(d)for(let e of b=b||a._parsed){let a=e._stacks;if(!a||void 0===a[d]||void 0===a[d][c])return;delete a[d][c],void 0!==a[d]._visualValues&&void 0!==a[d]._visualValues[c]&&delete a[d]._visualValues[c]}}let cm=a=>"reset"===a||"none"===a,cn=(a,b)=>b?a:Object.assign({},a);class co{static defaults={};static datasetElementType=null;static dataElementType=null;constructor(a,b){this.chart=a,this._ctx=a.ctx,this.index=b,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){let a=this._cachedMeta;this.configure(),this.linkScales(),a._stacked=ch(a.vScale,a),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(a){this.index!==a&&cl(this._cachedMeta),this.index=a}linkScales(){let a=this.chart,b=this._cachedMeta,c=this.getDataset(),d=(a,b,c,d)=>"x"===a?b:"r"===a?d:c,e=b.xAxisID=ac(c.xAxisID,ck(a,"x")),f=b.yAxisID=ac(c.yAxisID,ck(a,"y")),g=b.rAxisID=ac(c.rAxisID,ck(a,"r")),h=b.indexAxis,i=b.iAxisID=d(h,e,f,g),j=b.vAxisID=d(h,f,e,g);b.xScale=this.getScaleForId(e),b.yScale=this.getScaleForId(f),b.rScale=this.getScaleForId(g),b.iScale=this.getScaleForId(i),b.vScale=this.getScaleForId(j)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(a){return this.chart.scales[a]}_getOtherScale(a){let b=this._cachedMeta;return a===b.iScale?b.vScale:b.iScale}reset(){this._update("reset")}_destroy(){let a=this._cachedMeta;this._data&&aT(this._data,this),a._stacked&&cl(a)}_dataCheck(){let a=this.getDataset(),b=a.data||(a.data=[]),c=this._data;if(_(b)){let a=this._cachedMeta;this._data=function(a,b){let c,d,e,{iScale:f,vScale:g}=b,h="x"===f.axis?"x":"y",i="x"===g.axis?"x":"y",j=Object.keys(a),k=Array(j.length);for(c=0,d=j.length;c<d;++c)e=j[c],k[c]={[h]:e,[i]:a[e]};return k}(b,a)}else if(c!==b){if(c){aT(c,this);let a=this._cachedMeta;cl(a),a._parsed=[]}b&&Object.isExtensible(b)&&(b._chartjs?b._chartjs.listeners.push(this):(Object.defineProperty(b,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[this]}}),aS.forEach(a=>{let c="_onData"+ap(a),d=b[a];Object.defineProperty(b,a,{configurable:!0,enumerable:!1,value(...a){let e=d.apply(this,a);return b._chartjs.listeners.forEach(b=>{"function"==typeof b[c]&&b[c](...a)}),e}})}))),this._syncList=[],this._data=b}}addElements(){let a=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(a.dataset=new this.datasetElementType)}buildOrUpdateElements(a){let b=this._cachedMeta,c=this.getDataset(),d=!1;this._dataCheck();let e=b._stacked;b._stacked=ch(b.vScale,b),b.stack!==c.stack&&(d=!0,cl(b),b.stack=c.stack),this._resyncElements(a),(d||e!==b._stacked)&&(cj(this,b._parsed),b._stacked=ch(b.vScale,b))}configure(){let a=this.chart.config,b=a.datasetScopeKeys(this._type),c=a.getOptionScopes(this.getDataset(),b,!0);this.options=a.createResolver(c,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(a,b){let c,d,e,{_cachedMeta:f,_data:g}=this,{iScale:h,_stacked:i}=f,j=h.axis,k=0===a&&b===g.length||f._sorted,l=a>0&&f._parsed[a-1];if(!1===this._parsing)f._parsed=g,f._sorted=!0,e=g;else{e=$(g[a])?this.parseArrayData(f,g,a,b):_(g[a])?this.parseObjectData(f,g,a,b):this.parsePrimitiveData(f,g,a,b);let h=()=>null===d[j]||l&&d[j]<l[j];for(c=0;c<b;++c)f._parsed[c+a]=d=e[c],k&&(h()&&(k=!1),l=d);f._sorted=k}i&&cj(this,e)}parsePrimitiveData(a,b,c,d){let e,f,{iScale:g,vScale:h}=a,i=g.axis,j=h.axis,k=g.getLabels(),l=g===h,n=Array(d);for(e=0;e<d;++e)f=e+c,n[e]={[i]:l||g.parse(k[f],f),[j]:h.parse(b[f],f)};return n}parseArrayData(a,b,c,d){let e,f,g,{xScale:h,yScale:i}=a,j=Array(d);for(e=0;e<d;++e)g=b[f=e+c],j[e]={x:h.parse(g[0],f),y:i.parse(g[1],f)};return j}parseObjectData(a,b,c,d){let e,f,g,{xScale:h,yScale:i}=a,{xAxisKey:j="x",yAxisKey:k="y"}=this._parsing,l=Array(d);for(e=0;e<d;++e)g=b[f=e+c],l[e]={x:h.parse(ao(g,j),f),y:i.parse(ao(g,k),f)};return l}getParsed(a){return this._cachedMeta._parsed[a]}getDataElement(a){return this._cachedMeta.data[a]}applyStack(a,b,c){let d=this.chart,e=this._cachedMeta,f=b[a.axis];return cg({keys:cf(d,!0),values:b._stacks[a.axis]._visualValues},f,e.index,{mode:c})}updateRangeFromParsed(a,b,c,d){let e=c[b.axis],f=null===e?NaN:e,g=d&&c._stacks[b.axis];d&&g&&(d.values=g,f=cg(d,e,this._cachedMeta.index)),a.min=Math.min(a.min,f),a.max=Math.max(a.max,f)}getMinMax(a,b){let c,d,e,f=this._cachedMeta,g=f._parsed,h=f._sorted&&a===f.iScale,i=g.length,j=this._getOtherScale(a),k=(e=this.chart,b&&!f.hidden&&f._stacked&&{keys:cf(e,!0),values:null}),l={min:1/0,max:-1/0},{min:n,max:o}=function(a){let{min:b,max:c,minDefined:d,maxDefined:e}=a.getUserBounds();return{min:d?b:-1/0,max:e?c:1/0}}(j);function p(){let b=(d=g[c])[j.axis];return!aa(d[a.axis])||n>b||o<b}for(c=0;c<i&&(p()||(this.updateRangeFromParsed(l,a,d,k),!h));++c);if(h){for(c=i-1;c>=0;--c)if(!p()){this.updateRangeFromParsed(l,a,d,k);break}}return l}getAllParsedValues(a){let b,c,d,e=this._cachedMeta._parsed,f=[];for(b=0,c=e.length;b<c;++b)aa(d=e[b][a.axis])&&f.push(d);return f}getMaxOverflow(){return!1}getLabelAndValue(a){let b=this._cachedMeta,c=b.iScale,d=b.vScale,e=this.getParsed(a);return{label:c?""+c.getLabelForValue(e[c.axis]):"",value:d?""+d.getLabelForValue(e[d.axis]):""}}_update(a){var b;let c,d,e,f,g=this._cachedMeta;this.update(a||"default"),_(b=ac(this.options.clip,function(a,b,c){if(!1===c)return!1;let d=ce(a,c),e=ce(b,c);return{top:e.end,right:d.end,bottom:e.start,left:d.start}}(g.xScale,g.yScale,this.getMaxOverflow())))?(c=b.top,d=b.right,e=b.bottom,f=b.left):c=d=e=f=b,g._clip={top:c,right:d,bottom:e,left:f,disabled:!1===b}}update(a){}draw(){let a,b=this._ctx,c=this.chart,d=this._cachedMeta,e=d.data||[],f=c.chartArea,g=[],h=this._drawStart||0,i=this._drawCount||e.length-h,j=this.options.drawActiveElementsOnTop;for(d.dataset&&d.dataset.draw(b,f,h,i),a=h;a<h+i;++a){let c=e[a];c.hidden||(c.active&&j?g.push(c):c.draw(b,f))}for(a=0;a<g.length;++a)g[a].draw(b,f)}getStyle(a,b){let c=b?"active":"default";return void 0===a&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(c):this.resolveDataElementOptions(a||0,c)}getContext(a,b,c){var d,e;let f,g=this.getDataset();if(a>=0&&a<this._cachedMeta.data.length){let b=this._cachedMeta.data[a];(f=b.$context||(d=this.getContext(),b.$context=bA(d,{active:!1,dataIndex:a,parsed:void 0,raw:void 0,element:b,index:a,mode:"default",type:"data"}))).parsed=this.getParsed(a),f.raw=g.data[a],f.index=f.dataIndex=a}else(f=this.$context||(this.$context=bA(this.chart.getContext(),{active:!1,dataset:void 0,datasetIndex:e=this.index,index:e,mode:"default",type:"dataset"}))).dataset=g,f.index=f.datasetIndex=this.index;return f.active=!!b,f.mode=c,f}resolveDatasetElementOptions(a){return this._resolveElementOptions(this.datasetElementType.id,a)}resolveDataElementOptions(a,b){return this._resolveElementOptions(this.dataElementType.id,b,a)}_resolveElementOptions(a,b="default",c){let d="active"===b,e=this._cachedDataOpts,f=a+"-"+b,g=e[f],h=this.enableOptionSharing&&aq(c);if(g)return cn(g,h);let i=this.chart.config,j=i.datasetElementScopeKeys(this._type,a),k=d?[`${a}Hover`,"hover",a,""]:[a,""],l=i.getOptionScopes(this.getDataset(),j),n=Object.keys(be.elements[a]),o=()=>this.getContext(c,d,b),p=i.resolveNamedOptions(l,n,o,k);return p.$shared&&(p.$shared=h,e[f]=Object.freeze(cn(p,h))),p}_resolveAnimations(a,b,c){let d,e=this.chart,f=this._cachedDataOpts,g=`animation-${b}`,h=f[g];if(h)return h;if(!1!==e.options.animation){let e=this.chart.config,f=e.datasetAnimationScopeKeys(this._type,b),g=e.getOptionScopes(this.getDataset(),f);d=e.createResolver(g,this.getContext(a,c,b))}let i=new cd(e,d&&d.animations);return d&&d._cacheable&&(f[g]=Object.freeze(i)),i}getSharedOptions(a){if(a.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},a))}includeOptions(a,b){return!b||cm(a)||this.chart._animationsDisabled}_getSharedOptions(a,b){let c=this.resolveDataElementOptions(a,b),d=this._sharedOptions,e=this.getSharedOptions(c),f=this.includeOptions(b,e)||e!==d;return this.updateSharedOptions(e,b,c),{sharedOptions:e,includeOptions:f}}updateElement(a,b,c,d){cm(d)?Object.assign(a,c):this._resolveAnimations(b,d).update(a,c)}updateSharedOptions(a,b,c){a&&!cm(b)&&this._resolveAnimations(void 0,b).update(a,c)}_setStyle(a,b,c,d){a.active=d;let e=this.getStyle(b,d);this._resolveAnimations(b,c,d).update(a,{options:!d&&this.getSharedOptions(e)||e})}removeHoverStyle(a,b,c){this._setStyle(a,c,"active",!1)}setHoverStyle(a,b,c){this._setStyle(a,c,"active",!0)}_removeDatasetHoverStyle(){let a=this._cachedMeta.dataset;a&&this._setStyle(a,void 0,"active",!1)}_setDatasetHoverStyle(){let a=this._cachedMeta.dataset;a&&this._setStyle(a,void 0,"active",!0)}_resyncElements(a){let b=this._data,c=this._cachedMeta.data;for(let[a,b,c]of this._syncList)this[a](b,c);this._syncList=[];let d=c.length,e=b.length,f=Math.min(e,d);f&&this.parse(0,f),e>d?this._insertElements(d,e-d,a):e<d&&this._removeElements(e,d-e)}_insertElements(a,b,c=!0){let d,e=this._cachedMeta,f=e.data,g=a+b,h=a=>{for(a.length+=b,d=a.length-1;d>=g;d--)a[d]=a[d-b]};for(h(f),d=a;d<g;++d)f[d]=new this.dataElementType;this._parsing&&h(e._parsed),this.parse(a,b),c&&this.updateElements(f,a,b,"reset")}updateElements(a,b,c,d){}_removeElements(a,b){let c=this._cachedMeta;if(this._parsing){let d=c._parsed.splice(a,b);c._stacked&&cl(c,d)}c.data.splice(a,b)}_sync(a){if(this._parsing)this._syncList.push(a);else{let[b,c,d]=a;this[b](c,d)}this.chart._dataChanges.push([this.index,...a])}_onDataPush(){let a=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-a,a])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(a,b){b&&this._sync(["_removeElements",a,b]);let c=arguments.length-2;c&&this._sync(["_insertElements",a,c])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}function cp(a,b,c,d){if($(a)){let e,f,g,h,i,j;e=c.parse(a[0],d),g=Math.min(e,f=c.parse(a[1],d)),h=Math.max(e,f),i=g,j=h,Math.abs(g)>Math.abs(h)&&(i=h,j=g),b[c.axis]=j,b._custom={barStart:i,barEnd:j,start:e,end:f,min:g,max:h}}else b[c.axis]=c.parse(a,d);return b}function cq(a,b,c,d){let e,f,g,h,i=a.iScale,j=a.vScale,k=i.getLabels(),l=i===j,n=[];for(e=c,f=c+d;e<f;++e)h=b[e],(g={})[i.axis]=l||i.parse(k[e],e),n.push(cp(h,g,j,e));return n}function cr(a){return a&&void 0!==a.barStart&&void 0!==a.barEnd}function cs(a,b,c,d){var e,f,g;return d?ct((e=a,f=b,g=c,a=e===f?g:e===g?f:e),c,b):ct(a,b,c)}function ct(a,b,c){return"start"===a?b:"end"===a?c:a}class cu extends co{static id="bubble";static defaults={datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}};static overrides={scales:{x:{type:"linear"},y:{type:"linear"}}};initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(a,b,c,d){let e=super.parsePrimitiveData(a,b,c,d);for(let a=0;a<e.length;a++)e[a]._custom=this.resolveDataElementOptions(a+c).radius;return e}parseArrayData(a,b,c,d){let e=super.parseArrayData(a,b,c,d);for(let a=0;a<e.length;a++){let d=b[c+a];e[a]._custom=ac(d[2],this.resolveDataElementOptions(a+c).radius)}return e}parseObjectData(a,b,c,d){let e=super.parseObjectData(a,b,c,d);for(let a=0;a<e.length;a++){let d=b[c+a];e[a]._custom=ac(d&&d.r&&+d.r,this.resolveDataElementOptions(a+c).radius)}return e}getMaxOverflow(){let a=this._cachedMeta.data,b=0;for(let c=a.length-1;c>=0;--c)b=Math.max(b,a[c].size(this.resolveDataElementOptions(c))/2);return b>0&&b}getLabelAndValue(a){let b=this._cachedMeta,c=this.chart.data.labels||[],{xScale:d,yScale:e}=b,f=this.getParsed(a),g=d.getLabelForValue(f.x),h=e.getLabelForValue(f.y),i=f._custom;return{label:c[a]||"",value:"("+g+", "+h+(i?", "+i:"")+")"}}update(a){let b=this._cachedMeta.data;this.updateElements(b,0,b.length,a)}updateElements(a,b,c,d){let e="reset"===d,{iScale:f,vScale:g}=this._cachedMeta,{sharedOptions:h,includeOptions:i}=this._getSharedOptions(b,d),j=f.axis,k=g.axis;for(let l=b;l<b+c;l++){let b=a[l],c=!e&&this.getParsed(l),n={},o=n[j]=e?f.getPixelForDecimal(.5):f.getPixelForValue(c[j]),p=n[k]=e?g.getBasePixel():g.getPixelForValue(c[k]);n.skip=isNaN(o)||isNaN(p),i&&(n.options=h||this.resolveDataElementOptions(l,b.active?"active":d),e&&(n.options.radius=0)),this.updateElement(b,l,n,d)}}resolveDataElementOptions(a,b){let c=this.getParsed(a),d=super.resolveDataElementOptions(a,b);d.$shared&&(d=Object.assign({},d,{$shared:!1}));let e=d.radius;return"active"!==b&&(d.radius=0),d.radius+=ac(c&&c._custom,e),d}}class cv extends co{static id="doughnut";static defaults={datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"};static descriptors={_scriptable:a=>"spacing"!==a,_indexable:a=>"spacing"!==a&&!a.startsWith("borderDash")&&!a.startsWith("hoverBorderDash")};static overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(a){let b=a.data,{labels:{pointStyle:c,textAlign:d,color:e,useBorderRadius:f,borderRadius:g}}=a.legend.options;return b.labels.length&&b.datasets.length?b.labels.map((b,h)=>{let i=a.getDatasetMeta(0).controller.getStyle(h);return{text:b,fillStyle:i.backgroundColor,fontColor:e,hidden:!a.getDataVisibility(h),lineDash:i.borderDash,lineDashOffset:i.borderDashOffset,lineJoin:i.borderJoinStyle,lineWidth:i.borderWidth,strokeStyle:i.borderColor,textAlign:d,pointStyle:c,borderRadius:f&&(g||i.borderRadius),index:h}}):[]}},onClick(a,b,c){c.chart.toggleDataVisibility(b.index),c.chart.update()}}}};constructor(a,b){super(a,b),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(a,b){let c=this.getDataset().data,d=this._cachedMeta;if(!1===this._parsing)d._parsed=c;else{let e,f,g=a=>+c[a];if(_(c[a])){let{key:a="value"}=this._parsing;g=b=>+ao(c[b],a)}for(e=a,f=a+b;e<f;++e)d._parsed[e]=g(e)}}_getRotation(){return aG(this.options.rotation-90)}_getCircumference(){return aG(this.options.circumference)}_getRotationExtents(){let a=au,b=-au;for(let c=0;c<this.chart.data.datasets.length;++c)if(this.chart.isDatasetVisible(c)&&this.chart.getDatasetMeta(c).type===this._type){let d=this.chart.getDatasetMeta(c).controller,e=d._getRotation(),f=d._getCircumference();a=Math.min(a,e),b=Math.max(b,e+f)}return{rotation:a,circumference:b-a}}update(a){let b,{chartArea:c}=this.chart,d=this._cachedMeta,e=d.data,f=this.getMaxBorderWidth()+this.getMaxOffset(e)+this.options.spacing,g=Math.max((Math.min(c.width,c.height)-f)/2,0),h=Math.min((b=this.options.cutout,"string"==typeof b&&b.endsWith("%")?parseFloat(b)/100:b/g),1),i=this._getRingWeight(this.index),{circumference:j,rotation:k}=this._getRotationExtents(),{ratioX:l,ratioY:n,offsetX:o,offsetY:p}=function(a,b,c){let d=1,e=1,f=0,g=0;if(b<au){let h=a+b,i=Math.cos(a),j=Math.sin(a),k=Math.cos(h),l=Math.sin(h),n=(b,d,e)=>aM(b,a,h,!0)?1:Math.max(d,d*c,e,e*c),o=(b,d,e)=>aM(b,a,h,!0)?-1:Math.min(d,d*c,e,e*c),p=n(0,i,k),q=n(ax,j,l),r=o(at,i,k),s=o(at+ax,j,l);d=(p-r)/2,e=(q-s)/2,f=-(p+r)/2,g=-(q+s)/2}return{ratioX:d,ratioY:e,offsetX:f,offsetY:g}}(k,j,h),q=Math.max(Math.min((c.width-f)/l,(c.height-f)/n)/2,0),r=ad(this.options.radius,q),s=Math.max(r*h,0),t=(r-s)/this._getVisibleDatasetWeightTotal();this.offsetX=o*r,this.offsetY=p*r,d.total=this.calculateTotal(),this.outerRadius=r-t*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-t*i,0),this.updateElements(e,0,e.length,a)}_circumference(a,b){let c=this.options,d=this._cachedMeta,e=this._getCircumference();return b&&c.animation.animateRotate||!this.chart.getDataVisibility(a)||null===d._parsed[a]||d.data[a].hidden?0:this.calculateCircumference(d._parsed[a]*e/au)}updateElements(a,b,c,d){let e,f="reset"===d,g=this.chart,h=g.chartArea,i=g.options.animation,j=(h.left+h.right)/2,k=(h.top+h.bottom)/2,l=f&&i.animateScale,n=l?0:this.innerRadius,o=l?0:this.outerRadius,{sharedOptions:p,includeOptions:q}=this._getSharedOptions(b,d),r=this._getRotation();for(e=0;e<b;++e)r+=this._circumference(e,f);for(e=b;e<b+c;++e){let b=this._circumference(e,f),c=a[e],g={x:j+this.offsetX,y:k+this.offsetY,startAngle:r,endAngle:r+b,circumference:b,outerRadius:o,innerRadius:n};q&&(g.options=p||this.resolveDataElementOptions(e,c.active?"active":d)),r+=b,this.updateElement(c,e,g,d)}}calculateTotal(){let a,b=this._cachedMeta,c=b.data,d=0;for(a=0;a<c.length;a++){let e=b._parsed[a];null!==e&&!isNaN(e)&&this.chart.getDataVisibility(a)&&!c[a].hidden&&(d+=Math.abs(e))}return d}calculateCircumference(a){let b=this._cachedMeta.total;return b>0&&!isNaN(a)?Math.abs(a)/b*au:0}getLabelAndValue(a){let b=this._cachedMeta,c=this.chart,d=c.data.labels||[],e=a8(b._parsed[a],c.options.locale);return{label:d[a]||"",value:e}}getMaxBorderWidth(a){let b,c,d,e,f,g=0,h=this.chart;if(!a){for(b=0,c=h.data.datasets.length;b<c;++b)if(h.isDatasetVisible(b)){a=(d=h.getDatasetMeta(b)).data,e=d.controller;break}}if(!a)return 0;for(b=0,c=a.length;b<c;++b)"inner"!==(f=e.resolveDataElementOptions(b)).borderAlign&&(g=Math.max(g,f.borderWidth||0,f.hoverBorderWidth||0));return g}getMaxOffset(a){let b=0;for(let c=0,d=a.length;c<d;++c){let a=this.resolveDataElementOptions(c);b=Math.max(b,a.offset||0,a.hoverOffset||0)}return b}_getRingWeightOffset(a){let b=0;for(let c=0;c<a;++c)this.chart.isDatasetVisible(c)&&(b+=this._getRingWeight(c));return b}_getRingWeight(a){return Math.max(ac(this.chart.data.datasets[a].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}class cw extends co{static id="polarArea";static defaults={dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0};static overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(a){let b=a.data;if(b.labels.length&&b.datasets.length){let{labels:{pointStyle:c,color:d}}=a.legend.options;return b.labels.map((b,e)=>{let f=a.getDatasetMeta(0).controller.getStyle(e);return{text:b,fillStyle:f.backgroundColor,strokeStyle:f.borderColor,fontColor:d,lineWidth:f.borderWidth,pointStyle:c,hidden:!a.getDataVisibility(e),index:e}})}return[]}},onClick(a,b,c){c.chart.toggleDataVisibility(b.index),c.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}};constructor(a,b){super(a,b),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(a){let b=this._cachedMeta,c=this.chart,d=c.data.labels||[],e=a8(b._parsed[a].r,c.options.locale);return{label:d[a]||"",value:e}}parseObjectData(a,b,c,d){return bM.bind(this)(a,b,c,d)}update(a){let b=this._cachedMeta.data;this._updateRadius(),this.updateElements(b,0,b.length,a)}getMinMax(){let a=this._cachedMeta,b={min:1/0,max:-1/0};return a.data.forEach((a,c)=>{let d=this.getParsed(c).r;!isNaN(d)&&this.chart.getDataVisibility(c)&&(d<b.min&&(b.min=d),d>b.max&&(b.max=d))}),b}_updateRadius(){let a=this.chart,b=a.chartArea,c=a.options,d=Math.max(Math.min(b.right-b.left,b.bottom-b.top)/2,0),e=Math.max(c.cutoutPercentage?d/100*c.cutoutPercentage:1,0),f=(d-e)/a.getVisibleDatasetCount();this.outerRadius=d-f*this.index,this.innerRadius=this.outerRadius-f}updateElements(a,b,c,d){let e,f="reset"===d,g=this.chart,h=g.options.animation,i=this._cachedMeta.rScale,j=i.xCenter,k=i.yCenter,l=i.getIndexAngle(0)-.5*at,n=l,o=360/this.countVisibleElements();for(e=0;e<b;++e)n+=this._computeAngle(e,d,o);for(e=b;e<b+c;e++){let b=a[e],c=n,p=n+this._computeAngle(e,d,o),q=g.getDataVisibility(e)?i.getDistanceFromCenterForValue(this.getParsed(e).r):0;n=p,f&&(h.animateScale&&(q=0),h.animateRotate&&(c=p=l));let r={x:j,y:k,innerRadius:0,outerRadius:q,startAngle:c,endAngle:p,options:this.resolveDataElementOptions(e,b.active?"active":d)};this.updateElement(b,e,r,d)}}countVisibleElements(){let a=this._cachedMeta,b=0;return a.data.forEach((a,c)=>{!isNaN(this.getParsed(c).r)&&this.chart.getDataVisibility(c)&&b++}),b}_computeAngle(a,b,c){return this.chart.getDataVisibility(a)?aG(this.resolveDataElementOptions(a,b).angle||c):0}}class cx extends co{static id="radar";static defaults={datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}};static overrides={aspectRatio:1,scales:{r:{type:"radialLinear"}}};getLabelAndValue(a){let b=this._cachedMeta.vScale,c=this.getParsed(a);return{label:b.getLabels()[a],value:""+b.getLabelForValue(c[b.axis])}}parseObjectData(a,b,c,d){return bM.bind(this)(a,b,c,d)}update(a){let b=this._cachedMeta,c=b.dataset,d=b.data||[],e=b.iScale.getLabels();if(c.points=d,"resize"!==a){let b=this.resolveDatasetElementOptions(a);this.options.showLine||(b.borderWidth=0);let f={_loop:!0,_fullLoop:e.length===d.length,options:b};this.updateElement(c,void 0,f,a)}this.updateElements(d,0,d.length,a)}updateElements(a,b,c,d){let e=this._cachedMeta.rScale,f="reset"===d;for(let g=b;g<b+c;g++){let b=a[g],c=this.resolveDataElementOptions(g,b.active?"active":d),h=e.getPointPositionForValue(g,this.getParsed(g).r),i=f?e.xCenter:h.x,j=f?e.yCenter:h.y,k={x:i,y:j,angle:h.angle,skip:isNaN(i)||isNaN(j),options:c};this.updateElement(b,g,k,d)}}}function cy(){throw Error("This method is not implemented: Check that a complete date adapter is provided.")}class cz{static override(a){Object.assign(cz.prototype,a)}options;constructor(a){this.options=a||{}}init(){}formats(){return cy()}parse(){return cy()}format(){return cy()}add(){return cy()}diff(){return cy()}startOf(){return cy()}endOf(){return cy()}}function cA(a,b,c,d,e){let f=a.getSortedVisibleDatasetMetas(),g=c[b];for(let a=0,c=f.length;a<c;++a){let{index:c,data:h}=f[a],{lo:i,hi:j}=function(a,b,c,d){let{controller:e,data:f,_sorted:g}=a,h=e._cachedMeta.iScale,i=a.dataset&&a.dataset.options?a.dataset.options.spanGaps:null;if(h&&b===h.axis&&"r"!==b&&g&&f.length){let g=h._reversePixels?aR:aQ;if(d){if(e._sharedOptions){let a=f[0],d="function"==typeof a.getRange&&a.getRange(b);if(d){let a=g(f,b,c-d),e=g(f,b,c+d);return{lo:a.lo,hi:e.hi}}}}else{let d=g(f,b,c);if(i){let{vScale:b}=e._cachedMeta,{_parsed:c}=a,f=c.slice(0,d.lo+1).reverse().findIndex(a=>!Z(a[b.axis]));d.lo-=Math.max(0,f);let g=c.slice(d.hi).findIndex(a=>!Z(a[b.axis]));d.hi+=Math.max(0,g)}return d}}return{lo:0,hi:f.length-1}}(f[a],b,g,e);for(let a=i;a<=j;++a){let b=h[a];b.skip||d(b,c,a)}}}function cB(a,b,c,d,e){let f=[];return(e||a.isPointInArea(b))&&cA(a,c,b,function(c,g,h){(e||bk(c,a.chartArea,0))&&c.inRange(b.x,b.y,d)&&f.push({element:c,datasetIndex:g,index:h})},!0),f}function cC(a,b,c,d,e,f){let g,h,i,j,k,l;return f||a.isPointInArea(b)?"r"!==c||d?(g=[],h=-1!==c.indexOf("x"),i=-1!==c.indexOf("y"),j=function(a,b){return Math.sqrt(Math.pow(h?Math.abs(a.x-b.x):0,2)+Math.pow(i?Math.abs(a.y-b.y):0,2))},k=1/0,cA(a,c,b,function(c,h,i){let l=c.inRange(b.x,b.y,e);if(d&&!l)return;let n=c.getCenterPoint(e);if(!(f||a.isPointInArea(n))&&!l)return;let o=j(b,n);o<k?(g=[{element:c,datasetIndex:h,index:i}],k=o):o===k&&g.push({element:c,datasetIndex:h,index:i})}),g):(l=[],cA(a,c,b,function(a,c,d){let{startAngle:f,endAngle:g}=a.getProps(["startAngle","endAngle"],e),{angle:h}=aI(a,{x:b.x,y:b.y});aM(h,f,g)&&l.push({element:a,datasetIndex:c,index:d})}),l):[]}function cD(a,b,c,d,e){let f=[],g="x"===c?"inXRange":"inYRange",h=!1;return(cA(a,c,b,(a,d,i)=>{a[g]&&a[g](b[c],e)&&(f.push({element:a,datasetIndex:d,index:i}),h=h||a.inRange(b.x,b.y,e))}),d&&!h)?[]:f}var cE={modes:{index(a,b,c,d){let e=bU(b,a),f=c.axis||"x",g=c.includeInvisible||!1,h=c.intersect?cB(a,e,f,d,g):cC(a,e,f,!1,d,g),i=[];return h.length?(a.getSortedVisibleDatasetMetas().forEach(a=>{let b=h[0].index,c=a.data[b];c&&!c.skip&&i.push({element:c,datasetIndex:a.index,index:b})}),i):[]},dataset(a,b,c,d){let e=bU(b,a),f=c.axis||"xy",g=c.includeInvisible||!1,h=c.intersect?cB(a,e,f,d,g):cC(a,e,f,!1,d,g);if(h.length>0){let b=h[0].datasetIndex,c=a.getDatasetMeta(b).data;h=[];for(let a=0;a<c.length;++a)h.push({element:c[a],datasetIndex:b,index:a})}return h},point(a,b,c,d){let e=bU(b,a);return cB(a,e,c.axis||"xy",d,c.includeInvisible||!1)},nearest(a,b,c,d){let e=bU(b,a),f=c.axis||"xy",g=c.includeInvisible||!1;return cC(a,e,f,c.intersect,d,g)},x(a,b,c,d){let e=bU(b,a);return cD(a,e,"x",c.intersect,d)},y(a,b,c,d){let e=bU(b,a);return cD(a,e,"y",c.intersect,d)}}};let cF=["left","top","right","bottom"];function cG(a,b){return a.filter(a=>a.pos===b)}function cH(a,b){return a.filter(a=>-1===cF.indexOf(a.pos)&&a.box.axis===b)}function cI(a,b){return a.sort((a,c)=>{let d=b?c:a,e=b?a:c;return d.weight===e.weight?d.index-e.index:d.weight-e.weight})}function cJ(a,b,c,d){return Math.max(a[c],b[c])+Math.max(a[d],b[d])}function cK(a,b){a.top=Math.max(a.top,b.top),a.left=Math.max(a.left,b.left),a.bottom=Math.max(a.bottom,b.bottom),a.right=Math.max(a.right,b.right)}function cL(a,b,c,d){let e,f,g,h,i,j,k=[];for(e=0,f=a.length,i=0;e<f;++e){(h=(g=a[e]).box).update(g.width||b.w,g.height||b.h,function(a,b){let c=b.maxPadding;return function(a){let d={left:0,top:0,right:0,bottom:0};return a.forEach(a=>{d[a]=Math.max(b[a],c[a])}),d}(a?["left","right"]:["top","bottom"])}(g.horizontal,b));let{same:f,other:l}=function(a,b,c,d){let{pos:e,box:f}=c,g=a.maxPadding;if(!_(e)){c.size&&(a[e]-=c.size);let b=d[c.stack]||{size:0,count:1};b.size=Math.max(b.size,c.horizontal?f.height:f.width),c.size=b.size/b.count,a[e]+=c.size}f.getPadding&&cK(g,f.getPadding());let h=Math.max(0,b.outerWidth-cJ(g,a,"left","right")),i=Math.max(0,b.outerHeight-cJ(g,a,"top","bottom")),j=h!==a.w,k=i!==a.h;return a.w=h,a.h=i,c.horizontal?{same:j,other:k}:{same:k,other:j}}(b,c,g,d);i|=f&&k.length,j=j||l,h.fullSize||k.push(g)}return i&&cL(k,b,c,d)||j}function cM(a,b,c,d,e){a.top=c,a.left=b,a.right=b+d,a.bottom=c+e,a.width=d,a.height=e}function cN(a,b,c,d){let e=c.padding,{x:f,y:g}=b;for(let h of a){let a=h.box,i=d[h.stack]||{count:1,placed:0,weight:1},j=h.stackWeight/i.weight||1;if(h.horizontal){let d=b.w*j,f=i.size||a.height;aq(i.start)&&(g=i.start),a.fullSize?cM(a,e.left,g,c.outerWidth-e.right-e.left,f):cM(a,b.left+i.placed,g,d,f),i.start=g,i.placed+=d,g=a.bottom}else{let d=b.h*j,g=i.size||a.width;aq(i.start)&&(f=i.start),a.fullSize?cM(a,f,e.top,g,c.outerHeight-e.bottom-e.top):cM(a,f,b.top+i.placed,g,d),i.start=f,i.placed+=d,f=a.right}}b.x=f,b.y=g}var cO={addBox(a,b){a.boxes||(a.boxes=[]),b.fullSize=b.fullSize||!1,b.position=b.position||"top",b.weight=b.weight||0,b._layers=b._layers||function(){return[{z:0,draw(a){b.draw(a)}}]},a.boxes.push(b)},removeBox(a,b){let c=a.boxes?a.boxes.indexOf(b):-1;-1!==c&&a.boxes.splice(c,1)},configure(a,b,c){b.fullSize=c.fullSize,b.position=c.position,b.weight=c.weight},update(a,b,c,d){let e,f,g,h,i,j,k,l;if(!a)return;let n=bx(a.options.layout.padding),o=Math.max(b-n.width,0),p=Math.max(c-n.height,0),q=(f=cI((e=function(a){let b,c,d,e,f,g,h=[];for(b=0,c=(a||[]).length;b<c;++b)d=a[b],({position:e,options:{stack:f,stackWeight:g=1}}=d),h.push({index:b,box:d,pos:e,horizontal:d.isHorizontal(),weight:d.weight,stack:f&&e+f,stackWeight:g});return h}(a.boxes)).filter(a=>a.box.fullSize),!0),g=cI(cG(e,"left"),!0),h=cI(cG(e,"right")),i=cI(cG(e,"top"),!0),j=cI(cG(e,"bottom")),k=cH(e,"x"),l=cH(e,"y"),{fullSize:f,leftAndTop:g.concat(i),rightAndBottom:h.concat(l).concat(j).concat(k),chartArea:cG(e,"chartArea"),vertical:g.concat(h).concat(l),horizontal:i.concat(j).concat(k)}),r=q.vertical,s=q.horizontal;af(a.boxes,a=>{"function"==typeof a.beforeLayout&&a.beforeLayout()});let t=Object.freeze({outerWidth:b,outerHeight:c,padding:n,availableWidth:o,availableHeight:p,vBoxMaxWidth:o/2/(r.reduce((a,b)=>b.box.options&&!1===b.box.options.display?a:a+1,0)||1),hBoxMaxHeight:p/2}),u=Object.assign({},n);cK(u,bx(d));let v=Object.assign({maxPadding:u,w:o,h:p,x:n.left,y:n.top},n),w=function(a,b){let c,d,e,f=function(a){let b={};for(let c of a){let{stack:a,pos:d,stackWeight:e}=c;if(!a||!cF.includes(d))continue;let f=b[a]||(b[a]={count:0,placed:0,weight:0,size:0});f.count++,f.weight+=e}return b}(a),{vBoxMaxWidth:g,hBoxMaxHeight:h}=b;for(c=0,d=a.length;c<d;++c){let{fullSize:d}=(e=a[c]).box,i=f[e.stack],j=i&&e.stackWeight/i.weight;e.horizontal?(e.width=j?j*g:d&&b.availableWidth,e.height=h):(e.width=g,e.height=j?j*h:d&&b.availableHeight)}return f}(r.concat(s),t);cL(q.fullSize,v,t,w),cL(r,v,t,w),cL(s,v,t,w)&&cL(r,v,t,w);let x=v.maxPadding;function y(a){let b=Math.max(x[a]-v[a],0);return v[a]+=b,b}v.y+=y("top"),v.x+=y("left"),y("right"),y("bottom"),cN(q.leftAndTop,v,t,w),v.x+=v.w,v.y+=v.h,cN(q.rightAndBottom,v,t,w),a.chartArea={left:v.left,top:v.top,right:v.left+v.w,bottom:v.top+v.h,height:v.h,width:v.w},af(q.chartArea,b=>{let c=b.box;Object.assign(c,a.chartArea),c.update(v.w,v.h,{left:0,top:0,right:0,bottom:0})})}};class cP{acquireContext(a,b){}releaseContext(a){return!1}addEventListener(a,b,c){}removeEventListener(a,b,c){}getDevicePixelRatio(){return 1}getMaximumSize(a,b,c,d){return b=Math.max(0,b||a.width),c=c||a.height,{width:b,height:Math.max(0,d?Math.floor(b/d):c)}}isAttached(a){return!0}updateConfig(a){}}class cQ extends cP{acquireContext(a){return a&&a.getContext&&a.getContext("2d")||null}updateConfig(a){a.options.animation=!1}}class cR{static defaults={};static defaultRoutes=void 0;x;y;active=!1;options;$animations;tooltipPosition(a){let{x:b,y:c}=this.getProps(["x","y"],a);return{x:b,y:c}}hasValue(){return aE(this.x)&&aE(this.y)}getProps(a,b){let c=this.$animations;if(!b||!c)return this;let d={};return a.forEach(a=>{d[a]=c[a]&&c[a].active()?c[a]._to:this[a]}),d}}function cS(a,b,c,d,e){let f,g,h,i=ac(d,0),j=Math.min(ac(e,a.length),a.length),k=0;for(c=Math.ceil(c),e&&(c=(f=e-d)/Math.floor(f/c)),h=i;h<0;)h=Math.round(i+ ++k*c);for(g=Math.max(i,0);g<j;g++)g===h&&(b.push(a[g]),h=Math.round(i+ ++k*c))}let cT=(a,b,c)=>"top"===b||"left"===b?a[b]+c:a[b]-c,cU=(a,b)=>Math.min(b||a,a);function cV(a,b){let c=[],d=a.length/b,e=a.length,f=0;for(;f<e;f+=d)c.push(a[Math.floor(f)]);return c}function cW(a){return a.drawTicks?a.tickLength:0}function cX(a,b){if(!a.display)return 0;let c=by(a.font,b),d=bx(a.padding);return($(a.text)?a.text.length:1)*c.lineHeight+d.height}class cY extends cR{constructor(a){super(),this.id=a.id,this.type=a.type,this.options=void 0,this.ctx=a.ctx,this.chart=a.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(a){this.options=a.setContext(this.getContext()),this.axis=a.axis,this._userMin=this.parse(a.min),this._userMax=this.parse(a.max),this._suggestedMin=this.parse(a.suggestedMin),this._suggestedMax=this.parse(a.suggestedMax)}parse(a,b){return a}getUserBounds(){let{_userMin:a,_userMax:b,_suggestedMin:c,_suggestedMax:d}=this;return a=ab(a,1/0),b=ab(b,-1/0),c=ab(c,1/0),d=ab(d,-1/0),{min:ab(a,c),max:ab(b,d),minDefined:aa(a),maxDefined:aa(b)}}getMinMax(a){let b,{min:c,max:d,minDefined:e,maxDefined:f}=this.getUserBounds();if(e&&f)return{min:c,max:d};let g=this.getMatchingVisibleMetas();for(let h=0,i=g.length;h<i;++h)b=g[h].controller.getMinMax(this,a),e||(c=Math.min(c,b.min)),f||(d=Math.max(d,b.max));return c=f&&c>d?d:c,d=e&&c>d?c:d,{min:ab(c,ab(d,c)),max:ab(d,ab(c,d))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){let a=this.chart.data;return this.options.labels||(this.isHorizontal()?a.xLabels:a.yLabels)||a.labels||[]}getLabelItems(a=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(a))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){ae(this.options.beforeUpdate,[this])}update(a,b,c){let{beginAtZero:d,grace:e,ticks:f}=this.options,g=f.sampleSize;this.beforeUpdate(),this.maxWidth=a,this.maxHeight=b,this._margins=c=Object.assign({left:0,right:0,top:0,bottom:0},c),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+c.left+c.right:this.height+c.top+c.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=function(a,b,c){let{min:d,max:e}=a,f=ad(b,(e-d)/2),g=(a,b)=>c&&0===a?0:a+b;return{min:g(d,-Math.abs(f)),max:g(e,f)}}(this,e,d),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();let h=g<this.ticks.length;this._convertTicksToLabels(h?cV(this.ticks,g):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),f.display&&(f.autoSkip||"auto"===f.source)&&(this.ticks=function(a,b){var c;let d,e,f=a.options.ticks,g=(d=(c=a).options.offset,e=c._tickSize(),Math.floor(Math.min(c._length/e+ +!d,c._maxLength/e))),h=Math.min(f.maxTicksLimit||g,g),i=f.major.enabled?function(a){let b,c,d=[];for(b=0,c=a.length;b<c;b++)a[b].major&&d.push(b);return d}(b):[],j=i.length,k=i[0],l=i[j-1],n=[];if(j>h)return function(a,b,c,d){let e,f=0,g=c[0];for(e=0,d=Math.ceil(d);e<a.length;e++)e===g&&(b.push(a[e]),g=c[++f*d])}(b,n,i,j/h),n;let o=function(a,b,c){let d=function(a){let b,c,d=a.length;if(d<2)return!1;for(c=a[0],b=1;b<d;++b)if(a[b]-a[b-1]!==c)return!1;return c}(a),e=b.length/c;if(!d)return Math.max(e,1);let f=function(a){let b,c=[],d=Math.sqrt(a);for(b=1;b<d;b++)a%b==0&&(c.push(b),c.push(a/b));return d===(0|d)&&c.push(d),c.sort((a,b)=>a-b).pop(),c}(d);for(let a=0,b=f.length-1;a<b;a++){let b=f[a];if(b>e)return b}return Math.max(e,1)}(i,b,h);if(j>0){let a,c,d=j>1?Math.round((l-k)/(j-1)):null;for(cS(b,n,o,Z(d)?0:k-d,k),a=0,c=j-1;a<c;a++)cS(b,n,o,i[a],i[a+1]);return cS(b,n,o,l,Z(d)?b.length:l+d),n}return cS(b,n,o),n}(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),h&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let a,b,c=this.options.reverse;this.isHorizontal()?(a=this.left,b=this.right):(a=this.top,b=this.bottom,c=!c),this._startPixel=a,this._endPixel=b,this._reversePixels=c,this._length=b-a,this._alignToPixels=this.options.alignToPixels}afterUpdate(){ae(this.options.afterUpdate,[this])}beforeSetDimensions(){ae(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){ae(this.options.afterSetDimensions,[this])}_callHooks(a){this.chart.notifyPlugins(a,this.getContext()),ae(this.options[a],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){ae(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(a){let b,c,d,e=this.options.ticks;for(b=0,c=a.length;b<c;b++)(d=a[b]).label=ae(e.callback,[d.value,b,a],this)}afterTickToLabelConversion(){ae(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){ae(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){let a,b,c,d=this.options,e=d.ticks,f=cU(this.ticks.length,d.ticks.maxTicksLimit),g=e.minRotation||0,h=e.maxRotation,i=g;if(!this._isVisible()||!e.display||g>=h||f<=1||!this.isHorizontal()){this.labelRotation=g;return}let j=this._getLabelSizes(),k=j.widest.width,l=j.highest.height,n=aN(this.chart.width-k,0,this.maxWidth);k+6>(a=d.offset?this.maxWidth/f:n/(f-1))&&(a=n/(f-(d.offset?.5:1)),b=this.maxHeight-cW(d.grid)-e.padding-cX(d.title,this.chart.options.font),c=Math.sqrt(k*k+l*l),i=Math.max(g,Math.min(h,i=180/at*Math.min(Math.asin(aN((j.highest.height+6)/a,-1,1)),Math.asin(aN(b/c,-1,1))-Math.asin(aN(l/c,-1,1)))))),this.labelRotation=i}afterCalculateLabelRotation(){ae(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){ae(this.options.beforeFit,[this])}fit(){let a={width:0,height:0},{chart:b,options:{ticks:c,title:d,grid:e}}=this,f=this._isVisible(),g=this.isHorizontal();if(f){let f=cX(d,b.options.font);if(g?(a.width=this.maxWidth,a.height=cW(e)+f):(a.height=this.maxHeight,a.width=cW(e)+f),c.display&&this.ticks.length){let{first:b,last:d,widest:e,highest:f}=this._getLabelSizes(),h=2*c.padding,i=aG(this.labelRotation),j=Math.cos(i),k=Math.sin(i);if(g){let b=c.mirror?0:k*e.width+j*f.height;a.height=Math.min(this.maxHeight,a.height+b+h)}else{let b=c.mirror?0:j*e.width+k*f.height;a.width=Math.min(this.maxWidth,a.width+b+h)}this._calculatePadding(b,d,k,j)}}this._handleMargins(),g?(this.width=this._length=b.width-this._margins.left-this._margins.right,this.height=a.height):(this.width=a.width,this.height=this._length=b.height-this._margins.top-this._margins.bottom)}_calculatePadding(a,b,c,d){let{ticks:{align:e,padding:f},position:g}=this.options,h=0!==this.labelRotation,i="top"!==g&&"x"===this.axis;if(this.isHorizontal()){let g=this.getPixelForTick(0)-this.left,j=this.right-this.getPixelForTick(this.ticks.length-1),k=0,l=0;h?i?(k=d*a.width,l=c*b.height):(k=c*a.height,l=d*b.width):"start"===e?l=b.width:"end"===e?k=a.width:"inner"!==e&&(k=a.width/2,l=b.width/2),this.paddingLeft=Math.max((k-g+f)*this.width/(this.width-g),0),this.paddingRight=Math.max((l-j+f)*this.width/(this.width-j),0)}else{let c=b.height/2,d=a.height/2;"start"===e?(c=0,d=a.height):"end"===e&&(c=b.height,d=0),this.paddingTop=c+f,this.paddingBottom=d+f}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){ae(this.options.afterFit,[this])}isHorizontal(){let{axis:a,position:b}=this.options;return"top"===b||"bottom"===b||"x"===a}isFullSize(){return this.options.fullSize}_convertTicksToLabels(a){let b,c;for(this.beforeTickToLabelConversion(),this.generateTickLabels(a),b=0,c=a.length;b<c;b++)Z(a[b].label)&&(a.splice(b,1),c--,b--);this.afterTickToLabelConversion()}_getLabelSizes(){let a=this._labelSizes;if(!a){let b=this.options.ticks.sampleSize,c=this.ticks;b<c.length&&(c=cV(c,b)),this._labelSizes=a=this._computeLabelSizes(c,c.length,this.options.ticks.maxTicksLimit)}return a}_computeLabelSizes(a,b,c){let d,e,f,g,h,i,j,k,l,n,o,{ctx:p,_longestTextCache:q}=this,r=[],s=[],t=Math.floor(b/cU(b,c)),u=0,v=0;for(d=0;d<b;d+=t){if(g=a[d].label,p.font=i=(h=this._resolveTickFontOptions(d)).string,j=q[i]=q[i]||{data:{},gc:[]},k=h.lineHeight,l=n=0,Z(g)||$(g)){if($(g))for(e=0,f=g.length;e<f;++e)Z(o=g[e])||$(o)||(l=bf(p,j.data,j.gc,l,o),n+=k)}else l=bf(p,j.data,j.gc,l,g),n=k;r.push(l),s.push(n),u=Math.max(l,u),v=Math.max(n,v)}af(q,a=>{let c,d=a.gc,e=d.length/2;if(e>b){for(c=0;c<e;++c)delete a.data[d[c]];d.splice(0,e)}});let w=r.indexOf(u),x=s.indexOf(v),y=a=>({width:r[a]||0,height:s[a]||0});return{first:y(0),last:y(b-1),widest:y(w),highest:y(x),widths:r,heights:s}}getLabelForValue(a){return a}getPixelForValue(a,b){return NaN}getValueForPixel(a){}getPixelForTick(a){let b=this.ticks;return a<0||a>b.length-1?null:this.getPixelForValue(b[a].value)}getPixelForDecimal(a){this._reversePixels&&(a=1-a);let b=this._startPixel+a*this._length;return aN(this._alignToPixels?bg(this.chart,b,0):b,-32768,32767)}getDecimalForPixel(a){let b=(a-this._startPixel)/this._length;return this._reversePixels?1-b:b}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){let{min:a,max:b}=this;return a<0&&b<0?b:a>0&&b>0?a:0}getContext(a){var b,c;let d=this.ticks||[];if(a>=0&&a<d.length){let c=d[a];return c.$context||(b=this.getContext(),c.$context=bA(b,{tick:c,index:a,type:"tick"}))}return this.$context||(this.$context=(c=this.chart.getContext(),bA(c,{scale:this,type:"scale"})))}_tickSize(){let a=this.options.ticks,b=aG(this.labelRotation),c=Math.abs(Math.cos(b)),d=Math.abs(Math.sin(b)),e=this._getLabelSizes(),f=a.autoSkipPadding||0,g=e?e.widest.width+f:0,h=e?e.highest.height+f:0;return this.isHorizontal()?h*c>g*d?g/c:h/d:h*d<g*c?h/c:g/d}_isVisible(){let a=this.options.display;return"auto"!==a?!!a:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(a){let b,c,d,e,f,g,h,i,j,k,l,n,o=this.axis,p=this.chart,q=this.options,{grid:r,position:s,border:t}=q,u=r.offset,v=this.isHorizontal(),w=this.ticks.length+ +!!u,x=cW(r),y=[],z=t.setContext(this.getContext()),A=z.display?z.width:0,B=A/2,C=function(a){return bg(p,a,A)};if("top"===s)b=C(this.bottom),g=this.bottom-x,i=b-B,k=C(a.top)+B,n=a.bottom;else if("bottom"===s)b=C(this.top),k=a.top,n=C(a.bottom)-B,g=b+B,i=this.top+x;else if("left"===s)b=C(this.right),f=this.right-x,h=b-B,j=C(a.left)+B,l=a.right;else if("right"===s)b=C(this.left),j=a.left,l=C(a.right)-B,f=b+B,h=this.left+x;else if("x"===o){if("center"===s)b=C((a.top+a.bottom)/2+.5);else if(_(s)){let a=Object.keys(s)[0],c=s[a];b=C(this.chart.scales[a].getPixelForValue(c))}k=a.top,n=a.bottom,i=(g=b+B)+x}else if("y"===o){if("center"===s)b=C((a.left+a.right)/2);else if(_(s)){let a=Object.keys(s)[0],c=s[a];b=C(this.chart.scales[a].getPixelForValue(c))}h=(f=b-B)-x,j=a.left,l=a.right}let D=ac(q.ticks.maxTicksLimit,w),E=Math.max(1,Math.ceil(w/D));for(c=0;c<w;c+=E){let a=this.getContext(c),b=r.setContext(a),o=t.setContext(a),q=b.lineWidth,s=b.color,w=o.dash||[],x=o.dashOffset,z=b.tickWidth,A=b.tickColor,B=b.tickBorderDash||[],C=b.tickBorderDashOffset;void 0!==(d=function(a,b,c){let d,e=a.ticks.length,f=Math.min(b,e-1),g=a._startPixel,h=a._endPixel,i=a.getPixelForTick(f);if(!c||(d=1===e?Math.max(i-g,h-i):0===b?(a.getPixelForTick(1)-i)/2:(i-a.getPixelForTick(f-1))/2,!((i+=f<b?d:-d)<g-1e-6)&&!(i>h+1e-6)))return i}(this,c,u))&&(e=bg(p,d,q),v?f=h=j=l=e:g=i=k=n=e,y.push({tx1:f,ty1:g,tx2:h,ty2:i,x1:j,y1:k,x2:l,y2:n,width:q,color:s,borderDash:w,borderDashOffset:x,tickWidth:z,tickColor:A,tickBorderDash:B,tickBorderDashOffset:C}))}return this._ticksLength=w,this._borderValue=b,y}_computeLabelItems(a){let b,c,d,e,f,g,h,i,j,k,l,n=this.axis,o=this.options,{position:p,ticks:q}=o,r=this.isHorizontal(),s=this.ticks,{align:t,crossAlign:u,padding:v,mirror:w}=q,x=cW(o.grid),y=x+v,z=w?-v:y,A=-aG(this.labelRotation),B=[],C="middle";if("top"===p)f=this.bottom-z,g=this._getXAxisLabelAlignment();else if("bottom"===p)f=this.top+z,g=this._getXAxisLabelAlignment();else if("left"===p){let a=this._getYAxisLabelAlignment(x);g=a.textAlign,e=a.x}else if("right"===p){let a=this._getYAxisLabelAlignment(x);g=a.textAlign,e=a.x}else if("x"===n){if("center"===p)f=(a.top+a.bottom)/2+y;else if(_(p)){let a=Object.keys(p)[0],b=p[a];f=this.chart.scales[a].getPixelForValue(b)+y}g=this._getXAxisLabelAlignment()}else if("y"===n){if("center"===p)e=(a.left+a.right)/2-y;else if(_(p)){let a=Object.keys(p)[0],b=p[a];e=this.chart.scales[a].getPixelForValue(b)}g=this._getYAxisLabelAlignment(x).textAlign}"y"===n&&("start"===t?C="top":"end"===t&&(C="bottom"));let D=this._getLabelSizes();for(b=0,c=s.length;b<c;++b){let a;d=s[b].label;let n=q.setContext(this.getContext(b));h=this.getPixelForTick(b)+q.labelOffset,j=(i=this._resolveTickFontOptions(b)).lineHeight;let o=(k=$(d)?d.length:1)/2,t=n.color,v=n.textStrokeColor,x=n.textStrokeWidth,y=g;if(r?(e=h,"inner"===g&&(y=b===c-1?this.options.reverse?"left":"right":0===b?this.options.reverse?"right":"left":"center"),l="top"===p?"near"===u||0!==A?-k*j+j/2:"center"===u?-D.highest.height/2-o*j+j:-D.highest.height+j/2:"near"===u||0!==A?j/2:"center"===u?D.highest.height/2-o*j:D.highest.height-k*j,w&&(l*=-1),0===A||n.showLabelBackdrop||(e+=j/2*Math.sin(A))):(f=h,l=(1-k)*j/2),n.showLabelBackdrop){let d=bx(n.backdropPadding),e=D.heights[b],f=D.widths[b],h=l-d.top,i=0-d.left;switch(C){case"middle":h-=e/2;break;case"bottom":h-=e}switch(g){case"center":i-=f/2;break;case"right":i-=f;break;case"inner":b===c-1?i-=f:b>0&&(i-=f/2)}a={left:i,top:h,width:f+d.width,height:e+d.height,color:n.backdropColor}}B.push({label:d,font:i,textOffset:l,options:{rotation:A,color:t,strokeColor:v,strokeWidth:x,textAlign:y,textBaseline:C,translation:[e,f],backdrop:a}})}return B}_getXAxisLabelAlignment(){let{position:a,ticks:b}=this.options;if(-aG(this.labelRotation))return"top"===a?"left":"right";let c="center";return"start"===b.align?c="left":"end"===b.align?c="right":"inner"===b.align&&(c="inner"),c}_getYAxisLabelAlignment(a){let b,c,{position:d,ticks:{crossAlign:e,mirror:f,padding:g}}=this.options,h=this._getLabelSizes(),i=a+g,j=h.widest.width;return"left"===d?f?(c=this.right+g,"near"===e?b="left":"center"===e?(b="center",c+=j/2):(b="right",c+=j)):(c=this.right-i,"near"===e?b="right":"center"===e?(b="center",c-=j/2):(b="left",c=this.left)):"right"===d?f?(c=this.left+g,"near"===e?b="right":"center"===e?(b="center",c-=j/2):(b="left",c-=j)):(c=this.left+i,"near"===e?b="left":"center"===e?(b="center",c+=j/2):(b="right",c=this.right)):b="right",{textAlign:b,x:c}}_computeLabelArea(){if(this.options.ticks.mirror)return;let a=this.chart,b=this.options.position;return"left"===b||"right"===b?{top:0,left:this.left,bottom:a.height,right:this.right}:"top"===b||"bottom"===b?{top:this.top,left:0,bottom:this.bottom,right:a.width}:void 0}drawBackground(){let{ctx:a,options:{backgroundColor:b},left:c,top:d,width:e,height:f}=this;b&&(a.save(),a.fillStyle=b,a.fillRect(c,d,e,f),a.restore())}getLineWidthForValue(a){let b=this.options.grid;if(!this._isVisible()||!b.display)return 0;let c=this.ticks.findIndex(b=>b.value===a);return c>=0?b.setContext(this.getContext(c)).lineWidth:0}drawGrid(a){let b,c,d=this.options.grid,e=this.ctx,f=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(a)),g=(a,b,c)=>{c.width&&c.color&&(e.save(),e.lineWidth=c.width,e.strokeStyle=c.color,e.setLineDash(c.borderDash||[]),e.lineDashOffset=c.borderDashOffset,e.beginPath(),e.moveTo(a.x,a.y),e.lineTo(b.x,b.y),e.stroke(),e.restore())};if(d.display)for(b=0,c=f.length;b<c;++b){let a=f[b];d.drawOnChartArea&&g({x:a.x1,y:a.y1},{x:a.x2,y:a.y2},a),d.drawTicks&&g({x:a.tx1,y:a.ty1},{x:a.tx2,y:a.ty2},{color:a.tickColor,width:a.tickWidth,borderDash:a.tickBorderDash,borderDashOffset:a.tickBorderDashOffset})}}drawBorder(){let a,b,c,d,{chart:e,ctx:f,options:{border:g,grid:h}}=this,i=g.setContext(this.getContext()),j=g.display?i.width:0;if(!j)return;let k=h.setContext(this.getContext(0)).lineWidth,l=this._borderValue;this.isHorizontal()?(a=bg(e,this.left,j)-j/2,b=bg(e,this.right,k)+k/2,c=d=l):(c=bg(e,this.top,j)-j/2,d=bg(e,this.bottom,k)+k/2,a=b=l),f.save(),f.lineWidth=i.width,f.strokeStyle=i.color,f.beginPath(),f.moveTo(a,c),f.lineTo(b,d),f.stroke(),f.restore()}drawLabels(a){if(!this.options.ticks.display)return;let b=this.ctx,c=this._computeLabelArea();for(let d of(c&&bl(b,c),this.getLabelItems(a))){let a=d.options,c=d.font;bp(b,d.label,0,d.textOffset,c,a)}c&&bm(b)}drawTitle(){let a,b,{ctx:c,options:{position:d,title:e,reverse:f}}=this;if(!e.display)return;let g=by(e.font),h=bx(e.padding),i=e.align,j=g.lineHeight/2;"bottom"===d||"center"===d||_(d)?(j+=h.bottom,$(e.text)&&(j+=g.lineHeight*(e.text.length-1))):j+=h.top;let{titleX:k,titleY:l,maxWidth:n,rotation:o}=function(a,b,c,d){let e,f,g,{top:h,left:i,bottom:j,right:k,chart:l}=a,{chartArea:n,scales:o}=l,p=0,q=j-h,r=k-i;if(a.isHorizontal()){if(f=aX(d,i,k),_(c)){let a=Object.keys(c)[0],d=c[a];g=o[a].getPixelForValue(d)+q-b}else g="center"===c?(n.bottom+n.top)/2+q-b:cT(a,c,b);e=k-i}else{if(_(c)){let a=Object.keys(c)[0],d=c[a];f=o[a].getPixelForValue(d)-r+b}else f="center"===c?(n.left+n.right)/2-r+b:cT(a,c,b);g=aX(d,j,h),p="left"===c?-ax:ax}return{titleX:f,titleY:g,maxWidth:e,rotation:p}}(this,j,d,i);bp(c,e.text,0,0,g,{color:e.color,maxWidth:n,rotation:o,textAlign:(a=aW(i),(f&&"right"!==d||!f&&"right"===d)&&(a="left"===(b=a)?"right":"right"===b?"left":b),a),textBaseline:"middle",translation:[k,l]})}draw(a){this._isVisible()&&(this.drawBackground(),this.drawGrid(a),this.drawBorder(),this.drawTitle(),this.drawLabels(a))}_layers(){let a=this.options,b=a.ticks&&a.ticks.z||0,c=ac(a.grid&&a.grid.z,-1),d=ac(a.border&&a.border.z,0);return this._isVisible()&&this.draw===cY.prototype.draw?[{z:c,draw:a=>{this.drawBackground(),this.drawGrid(a),this.drawTitle()}},{z:d,draw:()=>{this.drawBorder()}},{z:b,draw:a=>{this.drawLabels(a)}}]:[{z:b,draw:a=>{this.draw(a)}}]}getMatchingVisibleMetas(a){let b,c,d=this.chart.getSortedVisibleDatasetMetas(),e=this.axis+"AxisID",f=[];for(b=0,c=d.length;b<c;++b){let c=d[b];c[e]!==this.id||a&&c.type!==a||f.push(c)}return f}_resolveTickFontOptions(a){return by(this.options.ticks.setContext(this.getContext(a)).font)}_maxDigits(){let a=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/a}}class cZ{constructor(a,b,c){this.type=a,this.scope=b,this.override=c,this.items=Object.create(null)}isForType(a){return Object.prototype.isPrototypeOf.call(this.type.prototype,a.prototype)}register(a){var b,c,d,e,f,g;let h,i,j=Object.getPrototypeOf(a);"id"in(b=j)&&"defaults"in b&&(i=this.register(j));let k=this.items,l=a.id,n=this.scope+"."+l;if(!l)throw Error("class does not have id: "+a);return l in k||(k[l]=a,c=a,d=n,e=i,h=ak(Object.create(null),[e?be.get(e):{},be.get(d),c.defaults]),be.set(d,h),c.defaultRoutes&&(f=d,Object.keys(g=c.defaultRoutes).forEach(a=>{let b=a.split("."),c=b.pop(),d=[f].concat(b).join("."),e=g[a].split("."),h=e.pop(),i=e.join(".");be.route(d,c,i,h)})),c.descriptors&&be.describe(d,c.descriptors),this.override&&be.override(a.id,a.overrides)),n}get(a){return this.items[a]}unregister(a){let b=this.items,c=a.id,d=this.scope;c in b&&delete b[c],d&&c in be[d]&&(delete be[d][c],this.override&&delete ba[c])}}var c$=new class{constructor(){this.controllers=new cZ(co,"datasets",!0),this.elements=new cZ(cR,"elements"),this.plugins=new cZ(Object,"plugins"),this.scales=new cZ(cY,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...a){this._each("register",a)}remove(...a){this._each("unregister",a)}addControllers(...a){this._each("register",a,this.controllers)}addElements(...a){this._each("register",a,this.elements)}addPlugins(...a){this._each("register",a,this.plugins)}addScales(...a){this._each("register",a,this.scales)}getController(a){return this._get(a,this.controllers,"controller")}getElement(a){return this._get(a,this.elements,"element")}getPlugin(a){return this._get(a,this.plugins,"plugin")}getScale(a){return this._get(a,this.scales,"scale")}removeControllers(...a){this._each("unregister",a,this.controllers)}removeElements(...a){this._each("unregister",a,this.elements)}removePlugins(...a){this._each("unregister",a,this.plugins)}removeScales(...a){this._each("unregister",a,this.scales)}_each(a,b,c){[...b].forEach(b=>{let d=c||this._getRegistryForType(b);c||d.isForType(b)||d===this.plugins&&b.id?this._exec(a,d,b):af(b,b=>{let d=c||this._getRegistryForType(b);this._exec(a,d,b)})})}_exec(a,b,c){let d=ap(a);ae(c["before"+d],[],c),b[a](c),ae(c["after"+d],[],c)}_getRegistryForType(a){for(let b=0;b<this._typedRegistries.length;b++){let c=this._typedRegistries[b];if(c.isForType(a))return c}return this.plugins}_get(a,b,c){let d=b.get(a);if(void 0===d)throw Error('"'+a+'" is not a registered '+c+".");return d}};class c_{constructor(){this._init=void 0}notify(a,b,c,d){if("beforeInit"===b&&(this._init=this._createDescriptors(a,!0),this._notify(this._init,a,"install")),void 0===this._init)return;let e=d?this._descriptors(a).filter(d):this._descriptors(a),f=this._notify(e,a,b,c);return"afterDestroy"===b&&(this._notify(e,a,"stop"),this._notify(this._init,a,"uninstall"),this._init=void 0),f}_notify(a,b,c,d){for(let e of(d=d||{},a)){let a=e.plugin;if(!1===ae(a[c],[b,d,e.options],a)&&d.cancelable)return!1}return!0}invalidate(){Z(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(a){if(this._cache)return this._cache;let b=this._cache=this._createDescriptors(a);return this._notifyStateChanges(a),b}_createDescriptors(a,b){let c=a&&a.config,d=ac(c.options&&c.options.plugins,{}),e=function(a){let b={},c=[],d=Object.keys(c$.plugins.items);for(let a=0;a<d.length;a++)c.push(c$.getPlugin(d[a]));let e=a.plugins||[];for(let a=0;a<e.length;a++){let d=e[a];-1===c.indexOf(d)&&(c.push(d),b[d.id]=!0)}return{plugins:c,localIds:b}}(c);return!1!==d||b?function(a,{plugins:b,localIds:c},d,e){let f=[],g=a.getContext();for(let i of b){var h;let b=i.id,j=(h=d[b],e||!1!==h?!0===h?{}:h:null);null!==j&&f.push({plugin:i,options:function(a,{plugin:b,local:c},d,e){let f=a.pluginScopeKeys(b),g=a.getOptionScopes(d,f);return c&&b.defaults&&g.push(b.defaults),a.createResolver(g,e,[""],{scriptable:!1,indexable:!1,allKeys:!0})}(a.config,{plugin:i,local:c[b]},j,g)})}return f}(a,e,d,b):[]}_notifyStateChanges(a){let b=this._oldCache||[],c=this._cache,d=(a,b)=>a.filter(a=>!b.some(b=>a.plugin.id===b.plugin.id));this._notify(d(b,c),a,"stop"),this._notify(d(c,b),a,"start")}}function c0(a,b){let c=be.datasets[a]||{};return((b.datasets||{})[a]||{}).indexAxis||b.indexAxis||c.indexAxis||"x"}function c1(a){if("x"===a||"y"===a||"r"===a)return a}function c2(a,...b){if(c1(a))return a;for(let d of b){var c;let b=d.axis||("top"===(c=d.position)||"bottom"===c?"x":"left"===c||"right"===c?"y":void 0)||a.length>1&&c1(a[0].toLowerCase());if(b)return b}throw Error(`Cannot determine type of '${a}' axis. Please provide 'axis' or 'position' option.`)}function c3(a,b,c){if(c[b+"AxisID"]===a)return{axis:b}}function c4(a){let b,c,d,e,f=a.options||(a.options={});f.plugins=ac(f.plugins,{}),b=ba[a.type]||{scales:{}},c=f.scales||{},d=c0(a.type,f),e=Object.create(null),Object.keys(c).forEach(f=>{let g=c[f];if(!_(g))return console.error(`Invalid scale configuration for scale: ${f}`);if(g._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${f}`);let h=c2(f,g,function(a,b){if(b.data&&b.data.datasets){let c=b.data.datasets.filter(b=>b.xAxisID===a||b.yAxisID===a);if(c.length)return c3(a,"x",c[0])||c3(a,"y",c[0])}return{}}(f,a),be.scales[g.type]),i=h===d?"_index_":"_value_",j=b.scales||{};e[f]=al(Object.create(null),[{axis:h},g,j[h],j[i]])}),a.data.datasets.forEach(b=>{let d=b.type||a.type,g=b.indexAxis||c0(d,f),h=(ba[d]||{}).scales||{};Object.keys(h).forEach(a=>{let d,f=(d=a,"_index_"===a?d=g:"_value_"===a&&(d="x"===g?"y":"x"),d),i=b[f+"AxisID"]||f;e[i]=e[i]||Object.create(null),al(e[i],[{axis:f},c[i],h[a]])})}),Object.keys(e).forEach(a=>{let b=e[a];al(b,[be.scales[b.type],be.scale])}),f.scales=e}function c5(a){return(a=a||{}).datasets=a.datasets||[],a.labels=a.labels||[],a}let c6=new Map,c7=new Set;function c8(a,b){let c=c6.get(a);return c||(c=b(),c6.set(a,c),c7.add(c)),c}let c9=(a,b,c)=>{let d=ao(b,c);void 0!==d&&a.add(d)};class da{constructor(a){this._config=function(a){return(a=a||{}).data=c5(a.data),c4(a),a}(a),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(a){this._config.type=a}get data(){return this._config.data}set data(a){this._config.data=c5(a)}get options(){return this._config.options}set options(a){this._config.options=a}get plugins(){return this._config.plugins}update(){let a=this._config;this.clearCache(),c4(a)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(a){return c8(a,()=>[[`datasets.${a}`,""]])}datasetAnimationScopeKeys(a,b){return c8(`${a}.transition.${b}`,()=>[[`datasets.${a}.transitions.${b}`,`transitions.${b}`],[`datasets.${a}`,""]])}datasetElementScopeKeys(a,b){return c8(`${a}-${b}`,()=>[[`datasets.${a}.elements.${b}`,`datasets.${a}`,`elements.${b}`,""]])}pluginScopeKeys(a){let b=a.id,c=this.type;return c8(`${c}-plugin-${b}`,()=>[[`plugins.${b}`,...a.additionalOptionScopes||[]]])}_cachedScopes(a,b){let c=this._scopeCache,d=c.get(a);return(!d||b)&&(d=new Map,c.set(a,d)),d}getOptionScopes(a,b,c){let{options:d,type:e}=this,f=this._cachedScopes(a,c),g=f.get(b);if(g)return g;let h=new Set;b.forEach(b=>{a&&(h.add(a),b.forEach(b=>c9(h,a,b))),b.forEach(a=>c9(h,d,a)),b.forEach(a=>c9(h,ba[e]||{},a)),b.forEach(a=>c9(h,be,a)),b.forEach(a=>c9(h,bb,a))});let i=Array.from(h);return 0===i.length&&i.push(Object.create(null)),c7.has(b)&&f.set(b,i),i}chartOptionScopes(){let{options:a,type:b}=this;return[a,ba[b]||{},be.datasets[b]||{},{type:b},be,bb]}resolveNamedOptions(a,b,c,d=[""]){let e={$shared:!0},{resolver:f,subPrefixes:g}=db(this._resolverCache,a,d),h=f;if(function(a,b){let{isScriptable:c,isIndexable:d}=bD(a);for(let e of b){let b=c(e),f=d(e),g=(f||b)&&a[e];if(b&&(ar(g)||dc(g))||f&&$(g))return!0}return!1}(f,b)){e.$shared=!1,c=ar(c)?c():c;let b=this.createResolver(a,c,g);h=bC(f,c,b)}for(let a of b)e[a]=h[a];return e}createResolver(a,b,c=[""],d){let{resolver:e}=db(this._resolverCache,a,c);return _(b)?bC(e,b,void 0,d):e}}function db(a,b,c){let d=a.get(b);d||(d=new Map,a.set(b,d));let e=c.join(),f=d.get(e);return f||(f={resolver:bB(b,c),subPrefixes:c.filter(a=>!a.toLowerCase().includes("hover"))},d.set(e,f)),f}let dc=a=>_(a)&&Object.getOwnPropertyNames(a).some(b=>ar(a[b])),dd=["top","bottom","left","right","chartArea"];function de(a,b){return"top"===a||"bottom"===a||-1===dd.indexOf(a)&&"x"===b}function df(a,b){return function(c,d){return c[a]===d[a]?c[b]-d[b]:c[a]-d[a]}}function dg(a){let b=a.chart,c=b.options.animation;b.notifyPlugins("afterRender"),ae(c&&c.onComplete,[a],b)}function dh(a){let b=a.chart,c=b.options.animation;ae(c&&c.onProgress,[a],b)}function di(a){return a&&a.length&&(a=a[0]),a&&a.canvas&&(a=a.canvas),a}let dj={},dk=a=>{let b=di(a);return Object.values(dj).filter(a=>a.canvas===b).pop()};class dl{static defaults=be;static instances=dj;static overrides=ba;static registry=c$;static version="4.5.1";static getChart=dk;static register(...a){c$.add(...a),dm()}static unregister(...a){c$.remove(...a),dm()}constructor(a,b){const c=this.config=new da(b),d=di(a),e=dk(d);if(e)throw Error("Canvas is already in use. Chart with ID '"+e.id+"' must be destroyed before the canvas with ID '"+e.canvas.id+"' can be reused.");const f=c.createResolver(c.chartOptionScopes(),this.getContext());this.platform=new(c.platform||cQ),this.platform.updateConfig(c);const g=this.platform.acquireContext(d,f.aspectRatio),h=g&&g.canvas,i=h&&h.height,j=h&&h.width;if(this.id=Y(),this.ctx=g,this.canvas=h,this.width=j,this.height=i,this._options=f,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new c_,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=function(a,b){let c;return function(...d){return b?(clearTimeout(c),c=setTimeout(a,b,d)):a.apply(this,d),b}}(a=>this.update(a),f.resizeDelay||0),this._dataChanges=[],dj[this.id]=this,!g||!h)return void console.error("Failed to create chart: can't acquire context from the given item");b9.listen(this,"complete",dg),b9.listen(this,"progress",dh),this._initialize(),this.attached&&this.update()}get aspectRatio(){let{options:{aspectRatio:a,maintainAspectRatio:b},width:c,height:d,_aspectRatio:e}=this;return Z(a)?b&&e?e:d?c/d:null:a}get data(){return this.config.data}set data(a){this.config.data=a}get options(){return this._options}set options(a){this.config.options=a}get registry(){return c$}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():bW(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return bh(this.canvas,this.ctx),this}stop(){return b9.stop(this),this}resize(a,b){b9.running(this)?this._resizeBeforeDraw={width:a,height:b}:this._resize(a,b)}_resize(a,b){let c=this.options,d=this.canvas,e=c.maintainAspectRatio&&this.aspectRatio,f=this.platform.getMaximumSize(d,a,b,e),g=c.devicePixelRatio||this.platform.getDevicePixelRatio(),h=this.width?"resize":"attach";this.width=f.width,this.height=f.height,this._aspectRatio=this.aspectRatio,bW(this,g,!0)&&(this.notifyPlugins("resize",{size:f}),ae(c.onResize,[this,f],this),this.attached&&this._doResize(h)&&this.render())}ensureScalesHaveIDs(){af(this.options.scales||{},(a,b)=>{a.id=b})}buildOrUpdateScales(){let a=this.options,b=a.scales,c=this.scales,d=Object.keys(c).reduce((a,b)=>(a[b]=!1,a),{}),e=[];b&&(e=e.concat(Object.keys(b).map(a=>{let c=b[a],d=c2(a,c),e="r"===d,f="x"===d;return{options:c,dposition:e?"chartArea":f?"bottom":"left",dtype:e?"radialLinear":f?"category":"linear"}}))),af(e,b=>{let e=b.options,f=e.id,g=c2(f,e),h=ac(e.type,b.dtype);(void 0===e.position||de(e.position,g)!==de(b.dposition))&&(e.position=b.dposition),d[f]=!0;let i=null;f in c&&c[f].type===h?i=c[f]:c[(i=new(c$.getScale(h))({id:f,type:h,ctx:this.ctx,chart:this})).id]=i,i.init(e,a)}),af(d,(a,b)=>{a||delete c[b]}),af(c,a=>{cO.configure(this,a,a.options),cO.addBox(this,a)})}_updateMetasets(){let a=this._metasets,b=this.data.datasets.length,c=a.length;if(a.sort((a,b)=>a.index-b.index),c>b){for(let a=b;a<c;++a)this._destroyDatasetMeta(a);a.splice(b,c-b)}this._sortedMetasets=a.slice(0).sort(df("order","index"))}_removeUnreferencedMetasets(){let{_metasets:a,data:{datasets:b}}=this;a.length>b.length&&delete this._stacks,a.forEach((a,c)=>{0===b.filter(b=>b===a._dataset).length&&this._destroyDatasetMeta(c)})}buildOrUpdateControllers(){let a,b,c=[],d=this.data.datasets;for(this._removeUnreferencedMetasets(),a=0,b=d.length;a<b;a++){let b=d[a],e=this.getDatasetMeta(a),f=b.type||this.config.type;if(e.type&&e.type!==f&&(this._destroyDatasetMeta(a),e=this.getDatasetMeta(a)),e.type=f,e.indexAxis=b.indexAxis||c0(f,this.options),e.order=b.order||0,e.index=a,e.label=""+b.label,e.visible=this.isDatasetVisible(a),e.controller)e.controller.updateIndex(a),e.controller.linkScales();else{let b=c$.getController(f),{datasetElementType:d,dataElementType:g}=be.datasets[f];Object.assign(b,{dataElementType:c$.getElement(g),datasetElementType:d&&c$.getElement(d)}),e.controller=new b(this,a),c.push(e.controller)}}return this._updateMetasets(),c}_resetElements(){af(this.data.datasets,(a,b)=>{this.getDatasetMeta(b).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(a){let b=this.config;b.update();let c=this._options=b.createResolver(b.chartOptionScopes(),this.getContext()),d=this._animationsDisabled=!c.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),!1===this.notifyPlugins("beforeUpdate",{mode:a,cancelable:!0}))return;let e=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let f=0;for(let a=0,b=this.data.datasets.length;a<b;a++){let{controller:b}=this.getDatasetMeta(a),c=!d&&-1===e.indexOf(b);b.buildOrUpdateElements(c),f=Math.max(+b.getMaxOverflow(),f)}f=this._minPadding=c.layout.autoPadding?f:0,this._updateLayout(f),d||af(e,a=>{a.reset()}),this._updateDatasets(a),this.notifyPlugins("afterUpdate",{mode:a}),this._layers.sort(df("z","_idx"));let{_active:g,_lastEvent:h}=this;h?this._eventHandler(h,!0):g.length&&this._updateHoverStyles(g,g,!0),this.render()}_updateScales(){af(this.scales,a=>{cO.removeBox(this,a)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){let a=this.options;as(new Set(Object.keys(this._listeners)),new Set(a.events))&&!!this._responsiveListeners===a.responsive||(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){let{_hiddenIndices:a}=this;for(let{method:c,start:d,count:e}of this._getUniformDataChanges()||[]){var b="_removeElements"===c?-e:e;for(let c of Object.keys(a)){let e=+c;if(e>=d){let f=a[c];delete a[c],(b>0||e>d)&&(a[e+b]=f)}}}}_getUniformDataChanges(){let a=this._dataChanges;if(!a||!a.length)return;this._dataChanges=[];let b=this.data.datasets.length,c=b=>new Set(a.filter(a=>a[0]===b).map((a,b)=>b+","+a.splice(1).join(","))),d=c(0);for(let a=1;a<b;a++)if(!as(d,c(a)))return;return Array.from(d).map(a=>a.split(",")).map(a=>({method:a[1],start:+a[2],count:+a[3]}))}_updateLayout(a){if(!1===this.notifyPlugins("beforeLayout",{cancelable:!0}))return;cO.update(this,this.width,this.height,a);let b=this.chartArea,c=b.width<=0||b.height<=0;this._layers=[],af(this.boxes,a=>{c&&"chartArea"===a.position||(a.configure&&a.configure(),this._layers.push(...a._layers()))},this),this._layers.forEach((a,b)=>{a._idx=b}),this.notifyPlugins("afterLayout")}_updateDatasets(a){if(!1!==this.notifyPlugins("beforeDatasetsUpdate",{mode:a,cancelable:!0})){for(let a=0,b=this.data.datasets.length;a<b;++a)this.getDatasetMeta(a).controller.configure();for(let b=0,c=this.data.datasets.length;b<c;++b)this._updateDataset(b,ar(a)?a({datasetIndex:b}):a);this.notifyPlugins("afterDatasetsUpdate",{mode:a})}}_updateDataset(a,b){let c=this.getDatasetMeta(a),d={meta:c,index:a,mode:b,cancelable:!0};!1!==this.notifyPlugins("beforeDatasetUpdate",d)&&(c.controller._update(b),d.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",d))}render(){!1!==this.notifyPlugins("beforeRender",{cancelable:!0})&&(b9.has(this)?this.attached&&!b9.running(this)&&b9.start(this):(this.draw(),dg({chart:this})))}draw(){let a;if(this._resizeBeforeDraw){let{width:a,height:b}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(a,b)}if(this.clear(),this.width<=0||this.height<=0||!1===this.notifyPlugins("beforeDraw",{cancelable:!0}))return;let b=this._layers;for(a=0;a<b.length&&b[a].z<=0;++a)b[a].draw(this.chartArea);for(this._drawDatasets();a<b.length;++a)b[a].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(a){let b,c,d=this._sortedMetasets,e=[];for(b=0,c=d.length;b<c;++b){let c=d[b];(!a||c.visible)&&e.push(c)}return e}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(!1===this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0}))return;let a=this.getSortedVisibleDatasetMetas();for(let b=a.length-1;b>=0;--b)this._drawDataset(a[b]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(a){let b=this.ctx,c={meta:a,index:a.index,cancelable:!0},d=b8(this,a);!1!==this.notifyPlugins("beforeDatasetDraw",c)&&(d&&bl(b,d),a.controller.draw(),d&&bm(b),c.cancelable=!1,this.notifyPlugins("afterDatasetDraw",c))}isPointInArea(a){return bk(a,this.chartArea,this._minPadding)}getElementsAtEventForMode(a,b,c,d){let e=cE.modes[b];return"function"==typeof e?e(this,a,c,d):[]}getDatasetMeta(a){let b=this.data.datasets[a],c=this._metasets,d=c.filter(a=>a&&a._dataset===b).pop();return d||(d={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:b&&b.order||0,index:a,_dataset:b,_parsed:[],_sorted:!1},c.push(d)),d}getContext(){return this.$context||(this.$context=bA(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(a){let b=this.data.datasets[a];if(!b)return!1;let c=this.getDatasetMeta(a);return"boolean"==typeof c.hidden?!c.hidden:!b.hidden}setDatasetVisibility(a,b){this.getDatasetMeta(a).hidden=!b}toggleDataVisibility(a){this._hiddenIndices[a]=!this._hiddenIndices[a]}getDataVisibility(a){return!this._hiddenIndices[a]}_updateVisibility(a,b,c){let d=c?"show":"hide",e=this.getDatasetMeta(a),f=e.controller._resolveAnimations(void 0,d);aq(b)?(e.data[b].hidden=!c,this.update()):(this.setDatasetVisibility(a,c),f.update(e,{visible:c}),this.update(b=>b.datasetIndex===a?d:void 0))}hide(a,b){this._updateVisibility(a,b,!1)}show(a,b){this._updateVisibility(a,b,!0)}_destroyDatasetMeta(a){let b=this._metasets[a];b&&b.controller&&b.controller._destroy(),delete this._metasets[a]}_stop(){let a,b;for(this.stop(),b9.remove(this),a=0,b=this.data.datasets.length;a<b;++a)this._destroyDatasetMeta(a)}destroy(){this.notifyPlugins("beforeDestroy");let{canvas:a,ctx:b}=this;this._stop(),this.config.clearCache(),a&&(this.unbindEvents(),bh(a,b),this.platform.releaseContext(b),this.canvas=null,this.ctx=null),delete dj[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...a){return this.canvas.toDataURL(...a)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){let a=this._listeners,b=this.platform,c=(c,d)=>{b.addEventListener(this,c,d),a[c]=d},d=(a,b,c)=>{a.offsetX=b,a.offsetY=c,this._eventHandler(a)};af(this.options.events,a=>c(a,d))}bindResponsiveEvents(){let a;this._responsiveListeners||(this._responsiveListeners={});let b=this._responsiveListeners,c=this.platform,d=(a,d)=>{c.addEventListener(this,a,d),b[a]=d},e=(a,d)=>{b[a]&&(c.removeEventListener(this,a,d),delete b[a])},f=(a,b)=>{this.canvas&&this.resize(a,b)},g=()=>{e("attach",g),this.attached=!0,this.resize(),d("resize",f),d("detach",a)};a=()=>{this.attached=!1,e("resize",f),this._stop(),this._resize(0,0),d("attach",g)},c.isAttached(this.canvas)?g():a()}unbindEvents(){af(this._listeners,(a,b)=>{this.platform.removeEventListener(this,b,a)}),this._listeners={},af(this._responsiveListeners,(a,b)=>{this.platform.removeEventListener(this,b,a)}),this._responsiveListeners=void 0}updateHoverStyle(a,b,c){let d,e,f,g=c?"set":"remove";for("dataset"===b&&this.getDatasetMeta(a[0].datasetIndex).controller["_"+g+"DatasetHoverStyle"](),e=0,f=a.length;e<f;++e){let b=(d=a[e])&&this.getDatasetMeta(d.datasetIndex).controller;b&&b[g+"HoverStyle"](d.element,d.datasetIndex,d.index)}}getActiveElements(){return this._active||[]}setActiveElements(a){let b=this._active||[],c=a.map(({datasetIndex:a,index:b})=>{let c=this.getDatasetMeta(a);if(!c)throw Error("No dataset found at index "+a);return{datasetIndex:a,element:c.data[b],index:b}});ag(c,b)||(this._active=c,this._lastEvent=null,this._updateHoverStyles(c,b))}notifyPlugins(a,b,c){return this._plugins.notify(this,a,b,c)}isPluginEnabled(a){return 1===this._plugins._cache.filter(b=>b.plugin.id===a).length}_updateHoverStyles(a,b,c){let d=this.options.hover,e=(a,b)=>a.filter(a=>!b.some(b=>a.datasetIndex===b.datasetIndex&&a.index===b.index)),f=e(b,a),g=c?a:e(a,b);f.length&&this.updateHoverStyle(f,d.mode,!1),g.length&&d.mode&&this.updateHoverStyle(g,d.mode,!0)}_eventHandler(a,b){let c={event:a,replay:b,cancelable:!0,inChartArea:this.isPointInArea(a)},d=b=>(b.options.events||this.options.events).includes(a.native.type);if(!1===this.notifyPlugins("beforeEvent",c,d))return;let e=this._handleEvent(a,b,c.inChartArea);return c.cancelable=!1,this.notifyPlugins("afterEvent",c,d),(e||c.changed)&&this.render(),this}_handleEvent(a,b,c){var d;let{_active:e=[],options:f}=this,g=this._getActiveElements(a,e,c,b),h="mouseup"===a.type||"click"===a.type||"contextmenu"===a.type,i=(d=this._lastEvent,c&&"mouseout"!==a.type?h?d:a:null);c&&(this._lastEvent=null,ae(f.onHover,[a,g,this],this),h&&ae(f.onClick,[a,g,this],this));let j=!ag(g,e);return(j||b)&&(this._active=g,this._updateHoverStyles(g,e,b)),this._lastEvent=i,j}_getActiveElements(a,b,c,d){if("mouseout"===a.type)return[];if(!c)return b;let e=this.options.hover;return this.getElementsAtEventForMode(a,e.mode,e,d)}}function dm(){return af(dl.instances,a=>a._plugins.invalidate())}function dn(a,b,c,d){return{x:c+a*Math.cos(b),y:d+a*Math.sin(b)}}function dp(a,b,c,d,e,f){var g,h,i,j;let k,l,n,o,{x:p,y:q,startAngle:r,pixelMargin:s,innerRadius:t}=b,u=Math.max(b.outerRadius+d+c-s,0),v=t>0?t+d+c+s:0,w=0,x=e-r;if(d){let a=u>0?u-d:0,b=((t>0?t-d:0)+a)/2;w=(x-(0!==b?x*b/(b+d):x))/2}let y=Math.max(.001,x*u-c/at)/u,z=(x-y)/2,A=r+z+w,B=e-z-w,{outerStart:C,outerEnd:D,innerStart:E,innerEnd:F}=(g=b,h=v,i=u,j=B-A,k=bu(g.options.borderRadius,["outerStart","outerEnd","innerStart","innerEnd"]),n=Math.min(l=(i-h)/2,j*h/2),{outerStart:(o=a=>{let b=(i-Math.min(l,a))*j/2;return aN(a,0,Math.min(l,b))})(k.outerStart),outerEnd:o(k.outerEnd),innerStart:aN(k.innerStart,0,n),innerEnd:aN(k.innerEnd,0,n)}),G=u-C,H=u-D,I=A+C/G,J=B-D/H,K=v+E,L=v+F,M=A+E/K,N=B-F/L;if(a.beginPath(),f){let b=(I+J)/2;if(a.arc(p,q,u,I,b),a.arc(p,q,u,b,J),D>0){let b=dn(H,J,p,q);a.arc(b.x,b.y,D,J,B+ax)}let c=dn(L,B,p,q);if(a.lineTo(c.x,c.y),F>0){let b=dn(L,N,p,q);a.arc(b.x,b.y,F,B+ax,N+Math.PI)}let d=(B-F/v+(A+E/v))/2;if(a.arc(p,q,v,B-F/v,d,!0),a.arc(p,q,v,d,A+E/v,!0),E>0){let b=dn(K,M,p,q);a.arc(b.x,b.y,E,M+Math.PI,A-ax)}let e=dn(G,A,p,q);if(a.lineTo(e.x,e.y),C>0){let b=dn(G,I,p,q);a.arc(b.x,b.y,C,A-ax,I)}}else{a.moveTo(p,q);let b=Math.cos(I)*u+p,c=Math.sin(I)*u+q;a.lineTo(b,c);let d=Math.cos(J)*u+p,e=Math.sin(J)*u+q;a.lineTo(d,e)}a.closePath()}class dq extends cR{static id="arc";static defaults={borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0,selfJoin:!1};static defaultRoutes={backgroundColor:"backgroundColor"};static descriptors={_scriptable:!0,_indexable:a=>"borderDash"!==a};circumference;endAngle;fullCircles;innerRadius;outerRadius;pixelMargin;startAngle;constructor(a){super(),this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,a&&Object.assign(this,a)}inRange(a,b,c){let{angle:d,distance:e}=aI(this.getProps(["x","y"],c),{x:a,y:b}),{startAngle:f,endAngle:g,innerRadius:h,outerRadius:i,circumference:j}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],c),k=(this.options.spacing+this.options.borderWidth)/2,l=ac(j,g-f),n=aM(d,f,g)&&f!==g,o=l>=au||n,p=aO(e,h+k,i+k);return o&&p}getCenterPoint(a){let{x:b,y:c,startAngle:d,endAngle:e,innerRadius:f,outerRadius:g}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],a),{offset:h,spacing:i}=this.options,j=(d+e)/2,k=(f+g+i+h)/2;return{x:b+Math.cos(j)*k,y:c+Math.sin(j)*k}}tooltipPosition(a){return this.getCenterPoint(a)}draw(a){let{options:b,circumference:c}=this,d=(b.offset||0)/4,e=(b.spacing||0)/2,f=b.circular;if(this.pixelMargin=.33*("inner"===b.borderAlign),this.fullCircles=c>au?Math.floor(c/au):0,0===c||this.innerRadius<0||this.outerRadius<0)return;a.save();let g=(this.startAngle+this.endAngle)/2;a.translate(Math.cos(g)*d,Math.sin(g)*d);let h=d*(1-Math.sin(Math.min(at,c||0)));a.fillStyle=b.backgroundColor,a.strokeStyle=b.borderColor,function(a,b,c,d,e){let{fullCircles:f,startAngle:g,circumference:h}=b,i=b.endAngle;if(f){dp(a,b,c,d,i,e);for(let b=0;b<f;++b)a.fill();isNaN(h)||(i=g+(h%au||au))}dp(a,b,c,d,i,e),a.fill()}(a,this,h,e,f),function(a,b,c,d,e){let{fullCircles:f,startAngle:g,circumference:h,options:i}=b,{borderWidth:j,borderJoinStyle:k,borderDash:l,borderDashOffset:n,borderRadius:o}=i,p="inner"===i.borderAlign;if(!j)return;a.setLineDash(l||[]),a.lineDashOffset=n,p?(a.lineWidth=2*j,a.lineJoin=k||"round"):(a.lineWidth=j,a.lineJoin=k||"bevel");let q=b.endAngle;if(f){dp(a,b,c,d,q,e);for(let b=0;b<f;++b)a.stroke();isNaN(h)||(q=g+(h%au||au))}p&&function(a,b,c){let{startAngle:d,pixelMargin:e,x:f,y:g,outerRadius:h,innerRadius:i}=b,j=e/h;a.beginPath(),a.arc(f,g,h,d-j,c+j),i>e?(j=e/i,a.arc(f,g,i,c+j,d-j,!0)):a.arc(f,g,e,c+ax,d-ax),a.closePath(),a.clip()}(a,b,q),i.selfJoin&&q-g>=at&&0===o&&"miter"!==k&&function(a,b,c){let{startAngle:d,x:e,y:f,outerRadius:g,innerRadius:h,options:i}=b,{borderWidth:j,borderJoinStyle:k}=i,l=Math.min(j/g,aL(d-c));if(a.beginPath(),a.arc(e,f,g-j/2,d+l/2,c-l/2),h>0){let b=Math.min(j/h,aL(d-c));a.arc(e,f,h+j/2,c-b/2,d+b/2,!0)}else{let b=Math.min(j/2,g*aL(d-c));if("round"===k)a.arc(e,f,b,c-at/2,d+at/2,!0);else if("bevel"===k){let g=2*b*b,h=-g*Math.cos(c+at/2)+e,i=-g*Math.sin(c+at/2)+f,j=g*Math.cos(d+at/2)+e,k=g*Math.sin(d+at/2)+f;a.lineTo(h,i),a.lineTo(j,k)}}a.closePath(),a.moveTo(0,0),a.rect(0,0,a.canvas.width,a.canvas.height),a.clip("evenodd")}(a,b,q),f||(dp(a,b,c,d,q,e),a.stroke())}(a,this,h,e,f),a.restore()}}function dr(a,b,c=b){a.lineCap=ac(c.borderCapStyle,b.borderCapStyle),a.setLineDash(ac(c.borderDash,b.borderDash)),a.lineDashOffset=ac(c.borderDashOffset,b.borderDashOffset),a.lineJoin=ac(c.borderJoinStyle,b.borderJoinStyle),a.lineWidth=ac(c.borderWidth,b.borderWidth),a.strokeStyle=ac(c.borderColor,b.borderColor)}function ds(a,b,c){a.lineTo(c.x,c.y)}function dt(a,b,c={}){let d=a.length,{start:e=0,end:f=d-1}=c,{start:g,end:h}=b,i=Math.max(e,g),j=Math.min(f,h);return{count:d,start:i,loop:b.loop,ilen:j<i&&!(e<g&&f<g||e>h&&f>h)?d+j-i:j-i}}function du(a,b,c,d){let e,f,g,{points:h,options:i}=b,{count:j,start:k,loop:l,ilen:n}=dt(h,c,d),o=i.stepped?bn:i.tension||"monotone"===i.cubicInterpolationMode?bo:ds,{move:p=!0,reverse:q}=d||{};for(e=0;e<=n;++e)(f=h[(k+(q?n-e:e))%j]).skip||(p?(a.moveTo(f.x,f.y),p=!1):o(a,g,f,q,i.stepped),g=f);return l&&o(a,g,f=h[(k+(q?n:0))%j],q,i.stepped),!!l}function dv(a,b,c,d){let e,f,g,h,i,j,k=b.points,{count:l,start:n,ilen:o}=dt(k,c,d),{move:p=!0,reverse:q}=d||{},r=0,s=0,t=a=>(n+(q?o-a:a))%l,u=()=>{h!==i&&(a.lineTo(r,i),a.lineTo(r,h),a.lineTo(r,j))};for(p&&(f=k[t(0)],a.moveTo(f.x,f.y)),e=0;e<=o;++e){if((f=k[t(e)]).skip)continue;let b=f.x,c=f.y,d=0|b;d===g?(c<h?h=c:c>i&&(i=c),r=(s*r+b)/++s):(u(),a.lineTo(b,c),g=d,s=0,h=i=c),j=c}u()}function dw(a){let b=a.options,c=b.borderDash&&b.borderDash.length;return a._decimated||a._loop||b.tension||"monotone"===b.cubicInterpolationMode||b.stepped||c?du:dv}let dx="function"==typeof Path2D;class dy extends cR{static id="line";static defaults={borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};static descriptors={_scriptable:!0,_indexable:a=>"borderDash"!==a&&"fill"!==a};constructor(a){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,a&&Object.assign(this,a)}updateControlPoints(a,b){let c=this.options;if((c.tension||"monotone"===c.cubicInterpolationMode)&&!c.stepped&&!this._pointsUpdated){let d=c.spanGaps?this._loop:this._fullLoop;!function(a,b,c,d,e){let f,g,h,i;if(b.spanGaps&&(a=a.filter(a=>!a.skip)),"monotone"===b.cubicInterpolationMode)!function(a,b="x"){let c,d,e,f=bP(b),g=a.length,h=Array(g).fill(0),i=Array(g),j=bO(a,0);for(c=0;c<g;++c)if(d=e,e=j,j=bO(a,c+1),e){if(j){let a=j[b]-e[b];h[c]=0!==a?(j[f]-e[f])/a:0}i[c]=d?j?aB(h[c-1])!==aB(h[c])?0:(h[c-1]+h[c])/2:h[c-1]:h[c]}!function(a,b,c){let d,e,f,g,h,i=a.length,j=bO(a,0);for(let k=0;k<i-1;++k)if(h=j,j=bO(a,k+1),h&&j){if(aC(b[k],0,bN)){c[k]=c[k+1]=0;continue}(g=Math.pow(d=c[k]/b[k],2)+Math.pow(e=c[k+1]/b[k],2))<=9||(f=3/Math.sqrt(g),c[k]=d*f*b[k],c[k+1]=e*f*b[k])}}(a,h,i),function(a,b,c="x"){let d,e,f,g=bP(c),h=a.length,i=bO(a,0);for(let j=0;j<h;++j){if(e=f,f=i,i=bO(a,j+1),!f)continue;let h=f[c],k=f[g];e&&(d=(h-e[c])/3,f[`cp1${c}`]=h-d,f[`cp1${g}`]=k-d*b[j]),i&&(d=(i[c]-h)/3,f[`cp2${c}`]=h+d,f[`cp2${g}`]=k+d*b[j])}}(a,i,b)}(a,e);else{let c=d?a[a.length-1]:a[0];for(f=0,g=a.length;f<g;++f)i=function(a,b,c,d){let e=a.skip?b:a,f=c.skip?b:c,g=aJ(b,e),h=aJ(f,b),i=g/(g+h),j=h/(g+h);i=isNaN(i)?0:i,j=isNaN(j)?0:j;let k=d*i,l=d*j;return{previous:{x:b.x-k*(f.x-e.x),y:b.y-k*(f.y-e.y)},next:{x:b.x+l*(f.x-e.x),y:b.y+l*(f.y-e.y)}}}(c,h=a[f],a[Math.min(f+1,g-!d)%g],b.tension),h.cp1x=i.previous.x,h.cp1y=i.previous.y,h.cp2x=i.next.x,h.cp2y=i.next.y,c=h}b.capBezierPoints&&function(a,b){let c,d,e,f,g,h=bk(a[0],b);for(c=0,d=a.length;c<d;++c)g=f,f=h,h=c<d-1&&bk(a[c+1],b),f&&(e=a[c],g&&(e.cp1x=bQ(e.cp1x,b.left,b.right),e.cp1y=bQ(e.cp1y,b.top,b.bottom)),h&&(e.cp2x=bQ(e.cp2x,b.left,b.right),e.cp2y=bQ(e.cp2y,b.top,b.bottom)))}(a,c)}(this._points,c,a,d,b),this._pointsUpdated=!0}}set points(a){this._points=a,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=function(a,b){let c=a.points,d=a.options.spanGaps,e=c.length;if(!e)return[];let f=!!a._loop,{start:g,end:h}=function(a,b,c,d){let e=0,f=b-1;if(c&&!d)for(;e<b&&!a[e].skip;)e++;for(;e<b&&a[e].skip;)e++;for(e%=b,c&&(f+=e);f>e&&a[f%b].skip;)f--;return{start:e,end:f%=b}}(c,e,f,d);if(!0===d)return b5(a,[{start:g,end:h,loop:f}],c,b);let i=h<g?h+e:h,j=!!a._fullLoop&&0===g&&h===e-1;return b5(a,function(a,b,c,d){let e,f=a.length,g=[],h=b,i=a[b];for(e=b+1;e<=c;++e){let c=a[e%f];c.skip||c.stop?i.skip||(d=!1,g.push({start:b%f,end:(e-1)%f,loop:d}),b=h=c.stop?e:null):(h=e,i.skip&&(b=e)),i=c}return null!==h&&g.push({start:b%f,end:h%f,loop:d}),g}(c,g,i,j),c,b)}(this,this.options.segment))}first(){let a=this.segments,b=this.points;return a.length&&b[a[0].start]}last(){let a=this.segments,b=this.points,c=a.length;return c&&b[a[c-1].end]}interpolate(a,b){let c,d,e=this.options,f=a[b],g=this.points,h=b4(this,{property:b,start:f,end:f});if(!h.length)return;let i=[],j=e.stepped?bY:e.tension||"monotone"===e.cubicInterpolationMode?bZ:bX;for(c=0,d=h.length;c<d;++c){let{start:d,end:k}=h[c],l=g[d],n=g[k];if(l===n){i.push(l);continue}let o=Math.abs((f-l[b])/(n[b]-l[b])),p=j(l,n,o,e.stepped);p[b]=a[b],i.push(p)}return 1===i.length?i[0]:i}pathSegment(a,b,c){return dw(this)(a,this,b,c)}path(a,b,c){let d=this.segments,e=dw(this),f=this._loop;for(let g of(b=b||0,c=c||this.points.length-b,d))f&=e(a,this,g,{start:b,end:b+c-1});return!!f}draw(a,b,c,d){let e=this.options||{};(this.points||[]).length&&e.borderWidth&&(a.save(),function(a,b,c,d){if(dx&&!b.options.segment){let e;(e=b._path)||(e=b._path=new Path2D,b.path(e,c,d)&&e.closePath()),dr(a,b.options),a.stroke(e)}else!function(a,b,c,d){let{segments:e,options:f}=b,g=dw(b);for(let h of e)dr(a,f,h.style),a.beginPath(),g(a,b,h,{start:c,end:c+d-1})&&a.closePath(),a.stroke()}(a,b,c,d)}(a,this,c,d),a.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}function dz(a,b,c,d){let e=a.options,{[c]:f}=a.getProps([c],d);return Math.abs(b-f)<e.radius+e.hitRadius}class dA extends cR{static id="point";parsed;skip;stop;static defaults={borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(a){super(),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,a&&Object.assign(this,a)}inRange(a,b,c){let d=this.options,{x:e,y:f}=this.getProps(["x","y"],c);return Math.pow(a-e,2)+Math.pow(b-f,2)<Math.pow(d.hitRadius+d.radius,2)}inXRange(a,b){return dz(this,a,"x",b)}inYRange(a,b){return dz(this,a,"y",b)}getCenterPoint(a){let{x:b,y:c}=this.getProps(["x","y"],a);return{x:b,y:c}}size(a){let b=(a=a||this.options||{}).radius||0,c=(b=Math.max(b,b&&a.hoverRadius||0))&&a.borderWidth||0;return(b+c)*2}draw(a,b){let c=this.options;!this.skip&&!(c.radius<.1)&&bk(this,b,this.size(c)/2)&&(a.strokeStyle=c.borderColor,a.lineWidth=c.borderWidth,a.fillStyle=c.backgroundColor,bi(a,c,this.x,this.y))}getRange(){let a=this.options||{};return a.radius+a.hitRadius}}function dB(a,b){let c,d,e,f,g,{x:h,y:i,base:j,width:k,height:l}=a.getProps(["x","y","base","width","height"],b);return a.horizontal?(g=l/2,c=Math.min(h,j),d=Math.max(h,j),e=i-g,f=i+g):(c=h-(g=k/2),d=h+g,e=Math.min(i,j),f=Math.max(i,j)),{left:c,top:e,right:d,bottom:f}}function dC(a,b,c,d){return a?0:aN(b,c,d)}function dD(a,b,c,d){let e=null===b,f=null===c,g=a&&!(e&&f)&&dB(a,d);return g&&(e||aO(b,g.left,g.right))&&(f||aO(c,g.top,g.bottom))}function dE(a,b){a.rect(b.x,b.y,b.w,b.h)}function dF(a,b,c={}){let d=a.x!==c.x?-b:0,e=a.y!==c.y?-b:0,f=(a.x+a.w!==c.x+c.w?b:0)-d,g=(a.y+a.h!==c.y+c.h?b:0)-e;return{x:a.x+d,y:a.y+e,w:a.w+f,h:a.h+g,radius:a.radius}}class dG extends cR{static id="bar";static defaults={borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(a){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,a&&Object.assign(this,a)}draw(a){var b,c,d;let e,f,g,h,i,j,k,l,{inflateAmount:n,options:{borderColor:o,backgroundColor:p}}=this,{inner:q,outer:r}=(f=(e=dB(this)).right-e.left,g=e.bottom-e.top,b=f/2,c=g/2,h=this.options.borderWidth,i=this.borderSkipped,j=bv(h),k={t:dC(i.top,j.top,0,c),r:dC(i.right,j.right,0,b),b:dC(i.bottom,j.bottom,0,c),l:dC(i.left,j.left,0,b)},l=function(a,b,c){let{enableBorderRadius:d}=a.getProps(["enableBorderRadius"]),e=a.options.borderRadius,f=bw(e),g=Math.min(b,c),h=a.borderSkipped,i=d||_(e);return{topLeft:dC(!i||h.top||h.left,f.topLeft,0,g),topRight:dC(!i||h.top||h.right,f.topRight,0,g),bottomLeft:dC(!i||h.bottom||h.left,f.bottomLeft,0,g),bottomRight:dC(!i||h.bottom||h.right,f.bottomRight,0,g)}}(this,f/2,g/2),{outer:{x:e.left,y:e.top,w:f,h:g,radius:l},inner:{x:e.left+k.l,y:e.top+k.t,w:f-k.l-k.r,h:g-k.t-k.b,radius:{topLeft:Math.max(0,l.topLeft-Math.max(k.t,k.l)),topRight:Math.max(0,l.topRight-Math.max(k.t,k.r)),bottomLeft:Math.max(0,l.bottomLeft-Math.max(k.b,k.l)),bottomRight:Math.max(0,l.bottomRight-Math.max(k.b,k.r))}}}),s=(d=r.radius).topLeft||d.topRight||d.bottomLeft||d.bottomRight?bq:dE;a.save(),(r.w!==q.w||r.h!==q.h)&&(a.beginPath(),s(a,dF(r,n,q)),a.clip(),s(a,dF(q,-n,r)),a.fillStyle=o,a.fill("evenodd")),a.beginPath(),s(a,dF(q,n)),a.fillStyle=p,a.fill(),a.restore()}inRange(a,b,c){return dD(this,a,b,c)}inXRange(a,b){return dD(this,a,null,b)}inYRange(a,b){return dD(this,null,a,b)}getCenterPoint(a){let{x:b,y:c,base:d,horizontal:e}=this.getProps(["x","y","base","horizontal"],a);return{x:e?(b+d)/2:b,y:e?c:(c+d)/2}}getRange(a){return"x"===a?this.width/2:this.height/2}}let dH=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],dI=dH.map(a=>a.replace("rgb(","rgba(").replace(")",", 0.5)"));function dJ(a,b,c,d){if(d)return;let e=b[a],f=c[a];return"angle"===a&&(e=aL(e),f=aL(f)),{property:a,start:e,end:f}}function dK(a,b,c){for(;b>a;b--){let a=c[b];if(!isNaN(a.x)&&!isNaN(a.y))break}return b}function dL(a,b,c,d){return a&&b?d(a[c],b[c]):a?a[c]:b?b[c]:0}function dM(a,b){let c=[],d=!1;return $(a)?(d=!0,c=a):c=function(a,b){let{x:c=null,y:d=null}=a||{},e=b.points,f=[];return b.segments.forEach(({start:a,end:b})=>{b=dK(a,b,e);let g=e[a],h=e[b];null!==d?(f.push({x:g.x,y:d}),f.push({x:h.x,y:d})):null!==c&&(f.push({x:c,y:g.y}),f.push({x:c,y:h.y}))}),f}(a,b),c.length?new dy({points:c,options:{tension:0},_loop:d,_fullLoop:d}):null}function dN(a){return a&&!1!==a.fill}class dO{constructor(a){this.x=a.x,this.y=a.y,this.radius=a.radius}pathSegment(a,b,c){let{x:d,y:e,radius:f}=this;return b=b||{start:0,end:au},a.arc(d,e,f,b.end,b.start,!0),!c.bounds}interpolate(a){let{x:b,y:c,radius:d}=this,e=a.angle;return{x:b+Math.cos(e)*d,y:c+Math.sin(e)*d,angle:e}}}function dP(a,b,c){let d=function(a){var b,c,d;let{chart:e,fill:f,line:g}=a;if(aa(f)){let a;return b=e,c=f,(a=b.getDatasetMeta(c))&&b.isDatasetVisible(c)?a.dataset:null}if("stack"===f)return function(a){let{scale:b,index:c,line:d}=a,e=[],f=d.segments,g=d.points,h=function(a,b){let c=[],d=a.getMatchingVisibleMetas("line");for(let a=0;a<d.length;a++){let e=d[a];if(e.index===b)break;e.hidden||c.unshift(e.dataset)}return c}(b,c);h.push(dM({x:null,y:b.bottom},d));for(let a=0;a<f.length;a++){let b=f[a];for(let a=b.start;a<=b.end;a++)!function(a,b,c){let d=[];for(let e=0;e<c.length;e++){let{first:f,last:g,point:h}=function(a,b,c){let d=a.interpolate(b,"x");if(!d)return{};let e=d.x,f=a.segments,g=a.points,h=!1,i=!1;for(let a=0;a<f.length;a++){let b=f[a],c=g[b.start].x,d=g[b.end].x;if(aO(e,c,d)){h=e===c,i=e===d;break}}return{first:h,last:i,point:d}}(c[e],b,"x");if(h&&(!f||!g)){if(f)d.unshift(h);else if(a.push(h),!g)break}}a.push(...d)}(e,g[a],h)}return new dy({points:e,options:{}})}(a);if("shape"===f)return!0;let h=((d=a).scale||{}).getPointPositionForValue?function(a){let{scale:b,fill:c}=a,d=b.options,e=b.getLabels().length,f=d.reverse?b.max:b.min,g="start"===c?f:"end"===c?b.options.reverse?b.min:b.max:_(c)?c.value:b.getBaseValue(),h=[];if(d.grid.circular){let a=b.getPointPositionForValue(0,f);return new dO({x:a.x,y:a.y,radius:b.getDistanceFromCenterForValue(g)})}for(let a=0;a<e;++a)h.push(b.getPointPositionForValue(a,g));return h}(d):function(a){let b,{scale:c={},fill:d}=a,e=(b=null,"start"===d?b=c.bottom:"end"===d?b=c.top:_(d)?b=c.getPixelForValue(d.value):c.getBasePixel&&(b=c.getBasePixel()),b);if(aa(e)){let a=c.isHorizontal();return{x:a?e:null,y:a?null:e}}return null}(d);return h instanceof dO?h:dM(h,g)}(b),{chart:e,index:f,line:g,scale:h,axis:i}=b,j=g.options,k=j.fill,l=j.backgroundColor,{above:n=l,below:o=l}=k||{},p=e.getDatasetMeta(f),q=b8(e,p);d&&g.points.length&&(bl(a,c),function(a,b){let{line:c,target:d,above:e,below:f,area:g,scale:h,clip:i}=b,j=c._loop?"angle":b.axis;a.save();let k=f;f!==e&&("x"===j?(dQ(a,d,g.top),dS(a,{line:c,target:d,color:e,scale:h,property:j,clip:i}),a.restore(),a.save(),dQ(a,d,g.bottom)):"y"===j&&(dR(a,d,g.left),dS(a,{line:c,target:d,color:f,scale:h,property:j,clip:i}),a.restore(),a.save(),dR(a,d,g.right),k=e)),dS(a,{line:c,target:d,color:k,scale:h,property:j,clip:i}),a.restore()}(a,{line:g,target:d,above:n,below:o,area:c,scale:h,axis:i,clip:q}),bm(a))}function dQ(a,b,c){let{segments:d,points:e}=b,f=!0,g=!1;for(let h of(a.beginPath(),d)){let{start:d,end:i}=h,j=e[d],k=e[dK(d,i,e)];f?(a.moveTo(j.x,j.y),f=!1):(a.lineTo(j.x,c),a.lineTo(j.x,j.y)),(g=!!b.pathSegment(a,h,{move:g}))?a.closePath():a.lineTo(k.x,c)}a.lineTo(b.first().x,c),a.closePath(),a.clip()}function dR(a,b,c){let{segments:d,points:e}=b,f=!0,g=!1;for(let h of(a.beginPath(),d)){let{start:d,end:i}=h,j=e[d],k=e[dK(d,i,e)];f?(a.moveTo(j.x,j.y),f=!1):(a.lineTo(c,j.y),a.lineTo(j.x,j.y)),(g=!!b.pathSegment(a,h,{move:g}))?a.closePath():a.lineTo(c,k.y)}a.lineTo(c,b.first().y),a.closePath(),a.clip()}function dS(a,b){let{line:c,target:d,property:e,color:f,scale:g,clip:h}=b;for(let{source:b,target:i,start:j,end:k}of function(a,b,c){let d=a.segments,e=a.points,f=b.points,g=[];for(let a of d){let{start:d,end:h}=a;h=dK(d,h,e);let i=dJ(c,e[d],e[h],a.loop);if(!b.segments){g.push({source:a,target:i,start:e[d],end:e[h]});continue}for(let d of b4(b,i)){let b=dJ(c,f[d.start],f[d.end],d.loop);for(let f of b3(a,e,b))g.push({source:f,target:d,start:{[c]:dL(i,b,"start",Math.max)},end:{[c]:dL(i,b,"end",Math.min)}})}}return g}(c,d,e)){let l,{style:{backgroundColor:n=f}={}}=b,o=!0!==d;a.save(),a.fillStyle=n,function(a,b,c,d){let e=b.chart.chartArea,{property:f,start:g,end:h}=d||{};if("x"===f||"y"===f){let b,d,i,j;"x"===f?(b=g,d=e.top,i=h,j=e.bottom):(b=e.left,d=g,i=e.right,j=h),a.beginPath(),c&&(b=Math.max(b,c.left),i=Math.min(i,c.right),d=Math.max(d,c.top),j=Math.min(j,c.bottom)),a.rect(b,d,i-b,j-d),a.clip()}}(a,g,h,o&&dJ(e,j,k)),a.beginPath();let p=!!c.pathSegment(a,b);if(o){p?a.closePath():dT(a,d,k,e);let b=!!d.pathSegment(a,i,{move:p,reverse:!0});(l=p&&b)||dT(a,d,j,e)}a.closePath(),a.fill(l?"evenodd":"nonzero"),a.restore()}}function dT(a,b,c,d){let e=b.interpolate(c,d);e&&a.lineTo(e.x,e.y)}var dU={id:"filler",afterDatasetsUpdate(a,b,c){let d,e,f,g,h=(a.data.datasets||[]).length,i=[];for(e=0;e<h;++e)f=(d=a.getDatasetMeta(e)).dataset,g=null,f&&f.options&&f instanceof dy&&(g={visible:a.isDatasetVisible(e),index:e,fill:function(a,b,c){var d,e,f,g;let h=function(a){let b=a.options,c=b.fill,d=ac(c&&c.target,c);return void 0===d&&(d=!!b.backgroundColor),!1!==d&&null!==d&&(!0===d?"origin":d)}(a);if(_(h))return!isNaN(h.value)&&h;let i=parseFloat(h);return aa(i)&&Math.floor(i)===i?(d=h[0],e=b,f=i,g=c,("-"===d||"+"===d)&&(f=e+f),f!==e&&!(f<0)&&!(f>=g)&&f):["origin","start","end","stack","shape"].indexOf(h)>=0&&h}(f,e,h),chart:a,axis:d.controller.options.indexAxis,scale:d.vScale,line:f}),d.$filler=g,i.push(g);for(e=0;e<h;++e)(g=i[e])&&!1!==g.fill&&(g.fill=function(a,b,c){let d,e=a[b].fill,f=[b];if(!c)return e;for(;!1!==e&&-1===f.indexOf(e);){if(!aa(e))return e;if(!(d=a[e]))break;if(d.visible)return e;f.push(e),e=d.fill}return!1}(i,e,c.propagate))},beforeDraw(a,b,c){let d="beforeDraw"===c.drawTime,e=a.getSortedVisibleDatasetMetas(),f=a.chartArea;for(let b=e.length-1;b>=0;--b){let c=e[b].$filler;c&&(c.line.updateControlPoints(f,c.axis),d&&c.fill&&dP(a.ctx,c,f))}},beforeDatasetsDraw(a,b,c){if("beforeDatasetsDraw"!==c.drawTime)return;let d=a.getSortedVisibleDatasetMetas();for(let b=d.length-1;b>=0;--b){let c=d[b].$filler;dN(c)&&dP(a.ctx,c,a.chartArea)}},beforeDatasetDraw(a,b,c){let d=b.meta.$filler;dN(d)&&"beforeDatasetDraw"===c.drawTime&&dP(a.ctx,d,a.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};let dV=(a,b)=>{let{boxHeight:c=b,boxWidth:d=b}=a;return a.usePointStyle&&(c=Math.min(c,b),d=a.pointStyleWidth||Math.min(d,b)),{boxWidth:d,boxHeight:c,itemHeight:Math.max(b,c)}};class dW extends cR{constructor(a){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=a.chart,this.options=a.options,this.ctx=a.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(a,b,c){this.maxWidth=a,this.maxHeight=b,this._margins=c,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){let a=this.options.labels||{},b=ae(a.generateLabels,[this.chart],this)||[];a.filter&&(b=b.filter(b=>a.filter(b,this.chart.data))),a.sort&&(b=b.sort((b,c)=>a.sort(b,c,this.chart.data))),this.options.reverse&&b.reverse(),this.legendItems=b}fit(){let a,b,{options:c,ctx:d}=this;if(!c.display){this.width=this.height=0;return}let e=c.labels,f=by(e.font),g=f.size,h=this._computeTitleHeight(),{boxWidth:i,itemHeight:j}=dV(e,g);d.font=f.string,this.isHorizontal()?(a=this.maxWidth,b=this._fitRows(h,g,i,j)+10):(b=this.maxHeight,a=this._fitCols(h,f,i,j)+10),this.width=Math.min(a,c.maxWidth||this.maxWidth),this.height=Math.min(b,c.maxHeight||this.maxHeight)}_fitRows(a,b,c,d){let{ctx:e,maxWidth:f,options:{labels:{padding:g}}}=this,h=this.legendHitBoxes=[],i=this.lineWidths=[0],j=d+g,k=a;e.textAlign="left",e.textBaseline="middle";let l=-1,n=-j;return this.legendItems.forEach((a,o)=>{let p=c+b/2+e.measureText(a.text).width;(0===o||i[i.length-1]+p+2*g>f)&&(k+=j,i[i.length-(o>0?0:1)]=0,n+=j,l++),h[o]={left:0,top:n,row:l,width:p,height:d},i[i.length-1]+=p+g}),k}_fitCols(a,b,c,d){let{ctx:e,maxHeight:f,options:{labels:{padding:g}}}=this,h=this.legendHitBoxes=[],i=this.columnSizes=[],j=f-a,k=g,l=0,n=0,o=0,p=0;return this.legendItems.forEach((a,f)=>{var q,r,s,t,u,v,w,x,y,z,A,B;let C,D,{itemWidth:E,itemHeight:F}=(q=c,r=b,s=e,t=a,u=d,{itemWidth:(v=t,w=q,x=r,y=s,(C=v.text)&&"string"!=typeof C&&(C=C.reduce((a,b)=>a.length>b.length?a:b)),w+x.size/2+y.measureText(C).width),itemHeight:(z=u,A=t,B=r.lineHeight,D=z,"string"!=typeof A.text&&(D=dX(A,B)),D)});f>0&&n+F+2*g>j&&(k+=l+g,i.push({width:l,height:n}),o+=l+g,p++,l=n=0),h[f]={left:o,top:n,col:p,width:E,height:F},l=Math.max(l,E),n+=F+g}),k+=l,i.push({width:l,height:n}),k}adjustHitBoxes(){if(!this.options.display)return;let a=this._computeTitleHeight(),{legendHitBoxes:b,options:{align:c,labels:{padding:d},rtl:e}}=this,f=b$(e,this.left,this.width);if(this.isHorizontal()){let e=0,g=aX(c,this.left+d,this.right-this.lineWidths[e]);for(let h of b)e!==h.row&&(e=h.row,g=aX(c,this.left+d,this.right-this.lineWidths[e])),h.top+=this.top+a+d,h.left=f.leftForLtr(f.x(g),h.width),g+=h.width+d}else{let e=0,g=aX(c,this.top+a+d,this.bottom-this.columnSizes[e].height);for(let h of b)h.col!==e&&(e=h.col,g=aX(c,this.top+a+d,this.bottom-this.columnSizes[e].height)),h.top=g,h.left+=this.left+d,h.left=f.leftForLtr(f.x(h.left),h.width),g+=h.height+d}}isHorizontal(){return"top"===this.options.position||"bottom"===this.options.position}draw(){if(this.options.display){let a=this.ctx;bl(a,this),this._draw(),bm(a)}}_draw(){let a,{options:b,columnSizes:c,lineWidths:d,ctx:e}=this,{align:f,labels:g}=b,h=be.color,i=b$(b.rtl,this.left,this.width),j=by(g.font),{padding:k}=g,l=j.size,n=l/2;this.drawTitle(),e.textAlign=i.textAlign("left"),e.textBaseline="middle",e.lineWidth=.5,e.font=j.string;let{boxWidth:o,boxHeight:p,itemHeight:q}=dV(g,l),r=function(a,b,c){if(isNaN(o)||o<=0||isNaN(p)||p<0)return;e.save();let d=ac(c.lineWidth,1);if(e.fillStyle=ac(c.fillStyle,h),e.lineCap=ac(c.lineCap,"butt"),e.lineDashOffset=ac(c.lineDashOffset,0),e.lineJoin=ac(c.lineJoin,"miter"),e.lineWidth=d,e.strokeStyle=ac(c.strokeStyle,h),e.setLineDash(ac(c.lineDash,[])),g.usePointStyle)bj(e,{radius:p*Math.SQRT2/2,pointStyle:c.pointStyle,rotation:c.rotation,borderWidth:d},i.xPlus(a,o/2),b+n,g.pointStyleWidth&&o);else{let f=b+Math.max((l-p)/2,0),g=i.leftForLtr(a,o),h=bw(c.borderRadius);e.beginPath(),Object.values(h).some(a=>0!==a)?bq(e,{x:g,y:f,w:o,h:p,radius:h}):e.rect(g,f,o,p),e.fill(),0!==d&&e.stroke()}e.restore()},s=function(a,b,c){bp(e,c.text,a,b+q/2,j,{strikethrough:c.hidden,textAlign:i.textAlign(c.textAlign)})},t=this.isHorizontal(),u=this._computeTitleHeight();a=t?{x:aX(f,this.left+k,this.right-d[0]),y:this.top+k+u,line:0}:{x:this.left+k,y:aX(f,this.top+u+k,this.bottom-c[0].height),line:0},b_(this.ctx,b.textDirection);let v=q+k;this.legendItems.forEach((h,l)=>{var p,q;e.strokeStyle=h.fontColor,e.fillStyle=h.fontColor;let w=e.measureText(h.text).width,x=i.textAlign(h.textAlign||(h.textAlign=g.textAlign)),y=o+n+w,z=a.x,A=a.y;if(i.setWidth(this.width),t?l>0&&z+y+k>this.right&&(A=a.y+=v,a.line++,z=a.x=aX(f,this.left+k,this.right-d[a.line])):l>0&&A+v>this.bottom&&(z=a.x=z+c[a.line].width+k,a.line++,A=a.y=aX(f,this.top+u+k,this.bottom-c[a.line].height)),r(i.x(z),A,h),p=z+o+n,q=t?z+y:this.right,z=x===(b.rtl?"left":"right")?q:"center"===x?(p+q)/2:p,s(i.x(z),A,h),t)a.x+=y+k;else if("string"!=typeof h.text){let b=j.lineHeight;a.y+=dX(h,b)+k}else a.y+=v}),b0(this.ctx,b.textDirection)}drawTitle(){let a,b=this.options,c=b.title,d=by(c.font),e=bx(c.padding);if(!c.display)return;let f=b$(b.rtl,this.left,this.width),g=this.ctx,h=c.position,i=d.size/2,j=e.top+i,k=this.left,l=this.width;if(this.isHorizontal())l=Math.max(...this.lineWidths),a=this.top+j,k=aX(b.align,k,this.right-l);else{let c=this.columnSizes.reduce((a,b)=>Math.max(a,b.height),0);a=j+aX(b.align,this.top,this.bottom-c-b.labels.padding-this._computeTitleHeight())}let n=aX(h,k,k+l);g.textAlign=f.textAlign(aW(h)),g.textBaseline="middle",g.strokeStyle=c.color,g.fillStyle=c.color,g.font=d.string,bp(g,c.text,n,a,d)}_computeTitleHeight(){let a=this.options.title,b=by(a.font),c=bx(a.padding);return a.display?b.lineHeight+c.height:0}_getLegendItemAt(a,b){let c,d,e;if(aO(a,this.left,this.right)&&aO(b,this.top,this.bottom)){for(c=0,e=this.legendHitBoxes;c<e.length;++c)if(aO(a,(d=e[c]).left,d.left+d.width)&&aO(b,d.top,d.top+d.height))return this.legendItems[c]}return null}handleEvent(a){var b,c;let d=this.options;if(b=a.type,c=d,("mousemove"!==b&&"mouseout"!==b||!c.onHover&&!c.onLeave)&&(!c.onClick||"click"!==b&&"mouseup"!==b))return;let e=this._getLegendItemAt(a.x,a.y);if("mousemove"===a.type||"mouseout"===a.type){let b=this._hoveredItem,c=null!==b&&null!==e&&b.datasetIndex===e.datasetIndex&&b.index===e.index;b&&!c&&ae(d.onLeave,[a,b,this],this),this._hoveredItem=e,e&&!c&&ae(d.onHover,[a,e,this],this)}else e&&ae(d.onClick,[a,e,this],this)}}function dX(a,b){return b*(a.text?a.text.length:0)}var dY={id:"legend",_element:dW,start(a,b,c){let d=a.legend=new dW({ctx:a.ctx,options:c,chart:a});cO.configure(a,d,c),cO.addBox(a,d)},stop(a){cO.removeBox(a,a.legend),delete a.legend},beforeUpdate(a,b,c){let d=a.legend;cO.configure(a,d,c),d.options=c},afterUpdate(a){let b=a.legend;b.buildLabels(),b.adjustHitBoxes()},afterEvent(a,b){b.replay||a.legend.handleEvent(b.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(a,b,c){let d=b.datasetIndex,e=c.chart;e.isDatasetVisible(d)?(e.hide(d),b.hidden=!0):(e.show(d),b.hidden=!1)},onHover:null,onLeave:null,labels:{color:a=>a.chart.options.color,boxWidth:40,padding:10,generateLabels(a){let b=a.data.datasets,{labels:{usePointStyle:c,pointStyle:d,textAlign:e,color:f,useBorderRadius:g,borderRadius:h}}=a.legend.options;return a._getSortedDatasetMetas().map(a=>{let i=a.controller.getStyle(c?0:void 0),j=bx(i.borderWidth);return{text:b[a.index].label,fillStyle:i.backgroundColor,fontColor:f,hidden:!a.visible,lineCap:i.borderCapStyle,lineDash:i.borderDash,lineDashOffset:i.borderDashOffset,lineJoin:i.borderJoinStyle,lineWidth:(j.width+j.height)/4,strokeStyle:i.borderColor,pointStyle:d||i.pointStyle,rotation:i.rotation,textAlign:e||i.textAlign,borderRadius:g&&(h||i.borderRadius),datasetIndex:a.index}},this)}},title:{color:a=>a.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:a=>!a.startsWith("on"),labels:{_scriptable:a=>!["generateLabels","filter","sort"].includes(a)}}};class dZ extends cR{constructor(a){super(),this.chart=a.chart,this.options=a.options,this.ctx=a.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(a,b){let c=this.options;if(this.left=0,this.top=0,!c.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=a,this.height=this.bottom=b;let d=$(c.text)?c.text.length:1;this._padding=bx(c.padding);let e=d*by(c.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=e:this.width=e}isHorizontal(){let a=this.options.position;return"top"===a||"bottom"===a}_drawArgs(a){let b,c,d,{top:e,left:f,bottom:g,right:h,options:i}=this,j=i.align,k=0;return this.isHorizontal()?(c=aX(j,f,h),d=e+a,b=h-f):("left"===i.position?(c=f+a,d=aX(j,g,e),k=-.5*at):(c=h-a,d=aX(j,e,g),k=.5*at),b=g-e),{titleX:c,titleY:d,maxWidth:b,rotation:k}}draw(){let a=this.ctx,b=this.options;if(!b.display)return;let c=by(b.font),d=c.lineHeight/2+this._padding.top,{titleX:e,titleY:f,maxWidth:g,rotation:h}=this._drawArgs(d);bp(a,b.text,0,0,c,{color:b.color,maxWidth:g,rotation:h,textAlign:aW(b.align),textBaseline:"middle",translation:[e,f]})}}var d$={id:"title",_element:dZ,start(a,b,c){let d;d=new dZ({ctx:a.ctx,options:c,chart:a}),cO.configure(a,d,c),cO.addBox(a,d),a.titleBlock=d},stop(a){let b=a.titleBlock;cO.removeBox(a,b),delete a.titleBlock},beforeUpdate(a,b,c){let d=a.titleBlock;cO.configure(a,d,c),d.options=c},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};new WeakMap;let d_={average(a){let b,c;if(!a.length)return!1;let d=new Set,e=0,f=0;for(b=0,c=a.length;b<c;++b){let c=a[b].element;if(c&&c.hasValue()){let a=c.tooltipPosition();d.add(a.x),e+=a.y,++f}}return 0!==f&&0!==d.size&&{x:[...d].reduce((a,b)=>a+b)/d.size,y:e/f}},nearest(a,b){let c,d,e;if(!a.length)return!1;let f=b.x,g=b.y,h=1/0;for(c=0,d=a.length;c<d;++c){let d=a[c].element;if(d&&d.hasValue()){let a=aJ(b,d.getCenterPoint());a<h&&(h=a,e=d)}}if(e){let a=e.tooltipPosition();f=a.x,g=a.y}return{x:f,y:g}}};function d0(a,b){return b&&($(b)?Array.prototype.push.apply(a,b):a.push(b)),a}function d1(a){return("string"==typeof a||a instanceof String)&&a.indexOf("\n")>-1?a.split("\n"):a}function d2(a,b){let c=a.chart.ctx,{body:d,footer:e,title:f}=a,{boxWidth:g,boxHeight:h}=b,i=by(b.bodyFont),j=by(b.titleFont),k=by(b.footerFont),l=f.length,n=e.length,o=d.length,p=bx(b.padding),q=p.height,r=0,s=d.reduce((a,b)=>a+b.before.length+b.lines.length+b.after.length,0);s+=a.beforeBody.length+a.afterBody.length,l&&(q+=l*j.lineHeight+(l-1)*b.titleSpacing+b.titleMarginBottom),s&&(q+=o*(b.displayColors?Math.max(h,i.lineHeight):i.lineHeight)+(s-o)*i.lineHeight+(s-1)*b.bodySpacing),n&&(q+=b.footerMarginTop+n*k.lineHeight+(n-1)*b.footerSpacing);let t=0,u=function(a){r=Math.max(r,c.measureText(a).width+t)};return c.save(),c.font=j.string,af(a.title,u),c.font=i.string,af(a.beforeBody.concat(a.afterBody),u),t=b.displayColors?g+2+b.boxPadding:0,af(d,a=>{af(a.before,u),af(a.lines,u),af(a.after,u)}),t=0,c.font=k.string,af(a.footer,u),c.restore(),{width:r+=p.width,height:q}}function d3(a,b,c){let d=c.yAlign||b.yAlign||function(a,b){let{y:c,height:d}=b;return c<d/2?"top":c>a.height-d/2?"bottom":"center"}(a,c);return{xAlign:c.xAlign||b.xAlign||function(a,b,c,d){let{x:e,width:f}=c,{width:g,chartArea:{left:h,right:i}}=a,j="center";return"center"===d?j=e<=(h+i)/2?"left":"right":e<=f/2?j="left":e>=g-f/2&&(j="right"),function(a,b,c,d){let{x:e,width:f}=d,g=c.caretSize+c.caretPadding;if("left"===a&&e+f+g>b.width||"right"===a&&e-f-g<0)return!0}(j,a,b,c)&&(j="center"),j}(a,b,c,d),yAlign:d}}function d4(a,b,c,d){let{caretSize:e,caretPadding:f,cornerRadius:g}=a,{xAlign:h,yAlign:i}=c,j=e+f,{topLeft:k,topRight:l,bottomLeft:n,bottomRight:o}=bw(g),p=function(a,b){let{x:c,width:d}=a;return"right"===b?c-=d:"center"===b&&(c-=d/2),c}(b,h),q=function(a,b,c){let{y:d,height:e}=a;return"top"===b?d+=c:"bottom"===b?d-=e+c:d-=e/2,d}(b,i,j);return"center"===i?"left"===h?p+=j:"right"===h&&(p-=j):"left"===h?p-=Math.max(k,n)+e:"right"===h&&(p+=Math.max(l,o)+e),{x:aN(p,0,d.width-b.width),y:aN(q,0,d.height-b.height)}}function d5(a,b,c){let d=bx(c.padding);return"center"===b?a.x+a.width/2:"right"===b?a.x+a.width-d.right:a.x+d.left}function d6(a,b){let c=b&&b.dataset&&b.dataset.tooltip&&b.dataset.tooltip.callbacks;return c?a.override(c):a}let d7={beforeTitle:X,title(a){if(a.length>0){let b=a[0],c=b.chart.data.labels,d=c?c.length:0;if(this&&this.options&&"dataset"===this.options.mode)return b.dataset.label||"";if(b.label)return b.label;if(d>0&&b.dataIndex<d)return c[b.dataIndex]}return""},afterTitle:X,beforeBody:X,beforeLabel:X,label(a){if(this&&this.options&&"dataset"===this.options.mode)return a.label+": "+a.formattedValue||a.formattedValue;let b=a.dataset.label||"";b&&(b+=": ");let c=a.formattedValue;return Z(c)||(b+=c),b},labelColor(a){let b=a.chart.getDatasetMeta(a.datasetIndex).controller.getStyle(a.dataIndex);return{borderColor:b.borderColor,backgroundColor:b.backgroundColor,borderWidth:b.borderWidth,borderDash:b.borderDash,borderDashOffset:b.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(a){let b=a.chart.getDatasetMeta(a.datasetIndex).controller.getStyle(a.dataIndex);return{pointStyle:b.pointStyle,rotation:b.rotation}},afterLabel:X,afterBody:X,beforeFooter:X,footer:X,afterFooter:X};function d8(a,b,c,d){let e=a[b].call(c,d);return void 0===e?d7[b].call(c,d):e}class d9 extends cR{static positioners=d_;constructor(a){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=a.chart,this.options=a.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(a){this.options=a,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){let a=this._cachedAnimations;if(a)return a;let b=this.chart,c=this.options.setContext(this.getContext()),d=c.enabled&&b.options.animation&&c.animations,e=new cd(this.chart,d);return d._cacheable&&(this._cachedAnimations=Object.freeze(e)),e}getContext(){var a;return this.$context||(this.$context=(a=this.chart.getContext(),bA(a,{tooltip:this,tooltipItems:this._tooltipItems,type:"tooltip"})))}getTitle(a,b){let{callbacks:c}=b,d=d8(c,"beforeTitle",this,a),e=d8(c,"title",this,a),f=d8(c,"afterTitle",this,a),g=[];return g=d0(g,d1(d)),g=d0(g,d1(e)),g=d0(g,d1(f))}getBeforeBody(a,b){return d0([],d1(d8(b.callbacks,"beforeBody",this,a)))}getBody(a,b){let{callbacks:c}=b,d=[];return af(a,a=>{let b={before:[],lines:[],after:[]},e=d6(c,a);d0(b.before,d1(d8(e,"beforeLabel",this,a))),d0(b.lines,d8(e,"label",this,a)),d0(b.after,d1(d8(e,"afterLabel",this,a))),d.push(b)}),d}getAfterBody(a,b){return d0([],d1(d8(b.callbacks,"afterBody",this,a)))}getFooter(a,b){let{callbacks:c}=b,d=d8(c,"beforeFooter",this,a),e=d8(c,"footer",this,a),f=d8(c,"afterFooter",this,a),g=[];return g=d0(g,d1(d)),g=d0(g,d1(e)),g=d0(g,d1(f))}_createItems(a){let b,c,d=this._active,e=this.chart.data,f=[],g=[],h=[],i=[];for(b=0,c=d.length;b<c;++b)i.push(function(a,b){let{element:c,datasetIndex:d,index:e}=b,f=a.getDatasetMeta(d).controller,{label:g,value:h}=f.getLabelAndValue(e);return{chart:a,label:g,parsed:f.getParsed(e),raw:a.data.datasets[d].data[e],formattedValue:h,dataset:f.getDataset(),dataIndex:e,datasetIndex:d,element:c}}(this.chart,d[b]));return a.filter&&(i=i.filter((b,c,d)=>a.filter(b,c,d,e))),a.itemSort&&(i=i.sort((b,c)=>a.itemSort(b,c,e))),af(i,b=>{let c=d6(a.callbacks,b);f.push(d8(c,"labelColor",this,b)),g.push(d8(c,"labelPointStyle",this,b)),h.push(d8(c,"labelTextColor",this,b))}),this.labelColors=f,this.labelPointStyles=g,this.labelTextColors=h,this.dataPoints=i,i}update(a,b){let c,d=this.options.setContext(this.getContext()),e=this._active,f=[];if(e.length){let a=d_[d.position].call(this,e,this._eventPosition);f=this._createItems(d),this.title=this.getTitle(f,d),this.beforeBody=this.getBeforeBody(f,d),this.body=this.getBody(f,d),this.afterBody=this.getAfterBody(f,d),this.footer=this.getFooter(f,d);let b=this._size=d2(this,d),g=Object.assign({},a,b),h=d3(this.chart,d,g),i=d4(d,g,h,this.chart);this.xAlign=h.xAlign,this.yAlign=h.yAlign,c={opacity:1,x:i.x,y:i.y,width:b.width,height:b.height,caretX:a.x,caretY:a.y}}else 0!==this.opacity&&(c={opacity:0});this._tooltipItems=f,this.$context=void 0,c&&this._resolveAnimations().update(this,c),a&&d.external&&d.external.call(this,{chart:this.chart,tooltip:this,replay:b})}drawCaret(a,b,c,d){let e=this.getCaretPosition(a,c,d);b.lineTo(e.x1,e.y1),b.lineTo(e.x2,e.y2),b.lineTo(e.x3,e.y3)}getCaretPosition(a,b,c){let d,e,f,g,h,i,{xAlign:j,yAlign:k}=this,{caretSize:l,cornerRadius:n}=c,{topLeft:o,topRight:p,bottomLeft:q,bottomRight:r}=bw(n),{x:s,y:t}=a,{width:u,height:v}=b;return"center"===k?(h=t+v/2,"left"===j?(e=(d=s)-l,g=h+l,i=h-l):(e=(d=s+u)+l,g=h-l,i=h+l),f=d):(e="left"===j?s+Math.max(o,q)+l:"right"===j?s+u-Math.max(p,r)-l:this.caretX,"top"===k?(h=(g=t)-l,d=e-l,f=e+l):(h=(g=t+v)+l,d=e+l,f=e-l),i=g),{x1:d,x2:e,x3:f,y1:g,y2:h,y3:i}}drawTitle(a,b,c){let d,e,f,g=this.title,h=g.length;if(h){let i=b$(c.rtl,this.x,this.width);for(f=0,a.x=d5(this,c.titleAlign,c),b.textAlign=i.textAlign(c.titleAlign),b.textBaseline="middle",d=by(c.titleFont),e=c.titleSpacing,b.fillStyle=c.titleColor,b.font=d.string;f<h;++f)b.fillText(g[f],i.x(a.x),a.y+d.lineHeight/2),a.y+=d.lineHeight+e,f+1===h&&(a.y+=c.titleMarginBottom-e)}}_drawColorBox(a,b,c,d,e){let f=this.labelColors[c],g=this.labelPointStyles[c],{boxHeight:h,boxWidth:i}=e,j=by(e.bodyFont),k=d5(this,"left",e),l=d.x(k),n=h<j.lineHeight?(j.lineHeight-h)/2:0,o=b.y+n;if(e.usePointStyle){let b={radius:Math.min(i,h)/2,pointStyle:g.pointStyle,rotation:g.rotation,borderWidth:1},c=d.leftForLtr(l,i)+i/2,j=o+h/2;a.strokeStyle=e.multiKeyBackground,a.fillStyle=e.multiKeyBackground,bi(a,b,c,j),a.strokeStyle=f.borderColor,a.fillStyle=f.backgroundColor,bi(a,b,c,j)}else{a.lineWidth=_(f.borderWidth)?Math.max(...Object.values(f.borderWidth)):f.borderWidth||1,a.strokeStyle=f.borderColor,a.setLineDash(f.borderDash||[]),a.lineDashOffset=f.borderDashOffset||0;let b=d.leftForLtr(l,i),c=d.leftForLtr(d.xPlus(l,1),i-2),g=bw(f.borderRadius);Object.values(g).some(a=>0!==a)?(a.beginPath(),a.fillStyle=e.multiKeyBackground,bq(a,{x:b,y:o,w:i,h:h,radius:g}),a.fill(),a.stroke(),a.fillStyle=f.backgroundColor,a.beginPath(),bq(a,{x:c,y:o+1,w:i-2,h:h-2,radius:g}),a.fill()):(a.fillStyle=e.multiKeyBackground,a.fillRect(b,o,i,h),a.strokeRect(b,o,i,h),a.fillStyle=f.backgroundColor,a.fillRect(c,o+1,i-2,h-2))}a.fillStyle=this.labelTextColors[c]}drawBody(a,b,c){let d,e,f,g,h,i,{body:j}=this,{bodySpacing:k,bodyAlign:l,displayColors:n,boxHeight:o,boxWidth:p,boxPadding:q}=c,r=by(c.bodyFont),s=r.lineHeight,t=0,u=b$(c.rtl,this.x,this.width),v=function(c){b.fillText(c,u.x(a.x+t),a.y+s/2),a.y+=s+k},w=u.textAlign(l);for(b.textAlign=l,b.textBaseline="middle",b.font=r.string,a.x=d5(this,w,c),b.fillStyle=c.bodyColor,af(this.beforeBody,v),t=n&&"right"!==w?"center"===l?p/2+q:p+2+q:0,f=0,h=j.length;f<h;++f){for(d=j[f],b.fillStyle=this.labelTextColors[f],af(d.before,v),e=d.lines,n&&e.length&&(this._drawColorBox(b,a,f,u,c),s=Math.max(r.lineHeight,o)),g=0,i=e.length;g<i;++g)v(e[g]),s=r.lineHeight;af(d.after,v)}t=0,s=r.lineHeight,af(this.afterBody,v),a.y-=k}drawFooter(a,b,c){let d,e,f=this.footer,g=f.length;if(g){let h=b$(c.rtl,this.x,this.width);for(a.x=d5(this,c.footerAlign,c),a.y+=c.footerMarginTop,b.textAlign=h.textAlign(c.footerAlign),b.textBaseline="middle",d=by(c.footerFont),b.fillStyle=c.footerColor,b.font=d.string,e=0;e<g;++e)b.fillText(f[e],h.x(a.x),a.y+d.lineHeight/2),a.y+=d.lineHeight+c.footerSpacing}}drawBackground(a,b,c,d){let{xAlign:e,yAlign:f}=this,{x:g,y:h}=a,{width:i,height:j}=c,{topLeft:k,topRight:l,bottomLeft:n,bottomRight:o}=bw(d.cornerRadius);b.fillStyle=d.backgroundColor,b.strokeStyle=d.borderColor,b.lineWidth=d.borderWidth,b.beginPath(),b.moveTo(g+k,h),"top"===f&&this.drawCaret(a,b,c,d),b.lineTo(g+i-l,h),b.quadraticCurveTo(g+i,h,g+i,h+l),"center"===f&&"right"===e&&this.drawCaret(a,b,c,d),b.lineTo(g+i,h+j-o),b.quadraticCurveTo(g+i,h+j,g+i-o,h+j),"bottom"===f&&this.drawCaret(a,b,c,d),b.lineTo(g+n,h+j),b.quadraticCurveTo(g,h+j,g,h+j-n),"center"===f&&"left"===e&&this.drawCaret(a,b,c,d),b.lineTo(g,h+k),b.quadraticCurveTo(g,h,g+k,h),b.closePath(),b.fill(),d.borderWidth>0&&b.stroke()}_updateAnimationTarget(a){let b=this.chart,c=this.$animations,d=c&&c.x,e=c&&c.y;if(d||e){let c=d_[a.position].call(this,this._active,this._eventPosition);if(!c)return;let f=this._size=d2(this,a),g=Object.assign({},c,this._size),h=d3(b,a,g),i=d4(a,g,h,b);(d._to!==i.x||e._to!==i.y)&&(this.xAlign=h.xAlign,this.yAlign=h.yAlign,this.width=f.width,this.height=f.height,this.caretX=c.x,this.caretY=c.y,this._resolveAnimations().update(this,i))}}_willRender(){return!!this.opacity}draw(a){let b=this.options.setContext(this.getContext()),c=this.opacity;if(!c)return;this._updateAnimationTarget(b);let d={width:this.width,height:this.height},e={x:this.x,y:this.y};c=.001>Math.abs(c)?0:c;let f=bx(b.padding),g=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;b.enabled&&g&&(a.save(),a.globalAlpha=c,this.drawBackground(e,a,d,b),b_(a,b.textDirection),e.y+=f.top,this.drawTitle(e,a,b),this.drawBody(e,a,b),this.drawFooter(e,a,b),b0(a,b.textDirection),a.restore())}getActiveElements(){return this._active||[]}setActiveElements(a,b){let c=this._active,d=a.map(({datasetIndex:a,index:b})=>{let c=this.chart.getDatasetMeta(a);if(!c)throw Error("Cannot find a dataset at index "+a);return{datasetIndex:a,element:c.data[b],index:b}}),e=!ag(c,d),f=this._positionChanged(d,b);(e||f)&&(this._active=d,this._eventPosition=b,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(a,b,c=!0){if(b&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;let d=this.options,e=this._active||[],f=this._getActiveElements(a,e,b,c),g=this._positionChanged(f,a),h=b||!ag(f,e)||g;return h&&(this._active=f,(d.enabled||d.external)&&(this._eventPosition={x:a.x,y:a.y},this.update(!0,b))),h}_getActiveElements(a,b,c,d){let e=this.options;if("mouseout"===a.type)return[];if(!d)return b.filter(a=>this.chart.data.datasets[a.datasetIndex]&&void 0!==this.chart.getDatasetMeta(a.datasetIndex).controller.getParsed(a.index));let f=this.chart.getElementsAtEventForMode(a,e.mode,e,c);return e.reverse&&f.reverse(),f}_positionChanged(a,b){let{caretX:c,caretY:d,options:e}=this,f=d_[e.position].call(this,a,b);return!1!==f&&(c!==f.x||d!==f.y)}}var ea={id:"tooltip",_element:d9,positioners:d_,afterInit(a,b,c){c&&(a.tooltip=new d9({chart:a,options:c}))},beforeUpdate(a,b,c){a.tooltip&&a.tooltip.initialize(c)},reset(a,b,c){a.tooltip&&a.tooltip.initialize(c)},afterDraw(a){let b=a.tooltip;if(b&&b._willRender()){let c={tooltip:b};if(!1===a.notifyPlugins("beforeTooltipDraw",{...c,cancelable:!0}))return;b.draw(a.ctx),a.notifyPlugins("afterTooltipDraw",c)}},afterEvent(a,b){if(a.tooltip){let c=b.replay;a.tooltip.handleEvent(b.event,c,b.inChartArea)&&(b.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(a,b)=>b.bodyFont.size,boxWidth:(a,b)=>b.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:d7},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:a=>"filter"!==a&&"itemSort"!==a&&"external"!==a,_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]};function eb(a){let b=this.getLabels();return a>=0&&a<b.length?b[a]:a}class ec extends cY{static id="category";static defaults={ticks:{callback:eb}};constructor(a){super(a),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(a){let b=this._addedLabels;if(b.length){let a=this.getLabels();for(let{index:c,label:d}of b)a[c]===d&&a.splice(c,1);this._addedLabels=[]}super.init(a)}parse(a,b){let c,d;if(Z(a))return null;let e=this.getLabels();return c=b=isFinite(b)&&e[b]===a?b:function(a,b,c,d){let e=a.indexOf(b);if(-1===e){var f;return f=c,"string"==typeof b?(f=a.push(b)-1,d.unshift({index:f,label:b})):isNaN(b)&&(f=null),f}return e!==a.lastIndexOf(b)?c:e}(e,a,ac(b,a),this._addedLabels),d=e.length-1,null===c?null:aN(Math.round(c),0,d)}determineDataLimits(){let{minDefined:a,maxDefined:b}=this.getUserBounds(),{min:c,max:d}=this.getMinMax(!0);"ticks"===this.options.bounds&&(a||(c=0),b||(d=this.getLabels().length-1)),this.min=c,this.max=d}buildTicks(){let a=this.min,b=this.max,c=this.options.offset,d=[],e=this.getLabels();e=0===a&&b===e.length-1?e:e.slice(a,b+1),this._valueRange=Math.max(e.length-!c,1),this._startValue=this.min-.5*!!c;for(let c=a;c<=b;c++)d.push({value:c});return d}getLabelForValue(a){return eb.call(this,a)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(a){return"number"!=typeof a&&(a=this.parse(a)),null===a?NaN:this.getPixelForDecimal((a-this._startValue)/this._valueRange)}getPixelForTick(a){let b=this.ticks;return a<0||a>b.length-1?null:this.getPixelForValue(b[a].value)}getValueForPixel(a){return Math.round(this._startValue+this.getDecimalForPixel(a)*this._valueRange)}getBasePixel(){return this.bottom}}function ed(a,b,{horizontal:c,minRotation:d}){let e=aG(d),f=(c?Math.sin(e):Math.cos(e))||.001,g=.75*b*(""+a).length;return Math.min(b/f,g)}class ee extends cY{constructor(a){super(a),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(a,b){return Z(a)||("number"==typeof a||a instanceof Number)&&!isFinite(+a)?null:+a}handleTickRangeOptions(){let{beginAtZero:a}=this.options,{minDefined:b,maxDefined:c}=this.getUserBounds(),{min:d,max:e}=this,f=a=>d=b?d:a,g=a=>e=c?e:a;if(a){let a=aB(d),b=aB(e);a<0&&b<0?g(0):a>0&&b>0&&f(0)}if(d===e){let b=0===e?1:Math.abs(.05*e);g(e+b),a||f(d-b)}this.min=d,this.max=e}getTickLimit(){let a,{maxTicksLimit:b,stepSize:c}=this.options.ticks;return c?(a=Math.ceil(this.max/c)-Math.floor(this.min/c)+1)>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${c} would result generating up to ${a} ticks. Limiting to 1000.`),a=1e3):(a=this.computeTickLimit(),b=b||11),b&&(a=Math.min(b,a)),a}computeTickLimit(){return 1/0}buildTicks(){let a=this.options,b=a.ticks,c=this.getTickLimit(),d=function(a,b){var c,d;let e,f,g,h,i,j=[],{bounds:k,step:l,min:n,max:o,precision:p,count:q,maxTicks:r,maxDigits:s,includeBounds:t}=a,u=l||1,v=r-1,{min:w,max:x}=b,y=!Z(n),z=!Z(o),A=!Z(q),B=(x-w)/(s+1),C=aD((x-w)/v/u)*u;if(C<1e-14&&!y&&!z)return[{value:w},{value:x}];(h=Math.ceil(x/C)-Math.floor(w/C))>v&&(C=aD(h*C/v/u)*u),Z(p)||(C=Math.ceil(C*(e=Math.pow(10,p)))/e),"ticks"===k?(f=Math.floor(w/C)*C,g=Math.ceil(x/C)*C):(f=w,g=x),y&&z&&l&&(c=(o-n)/l,d=C/1e3,(i=Math.round(c))-d<=c&&i+d>=c)?(h=Math.round(Math.min((o-n)/C,r)),C=(o-n)/h,f=n,g=o):A?(f=y?n:f,C=((g=z?o:g)-f)/(h=q-1)):h=aC(h=(g-f)/C,Math.round(h),C/1e3)?Math.round(h):Math.ceil(h);let D=Math.max(aH(C),aH(f));f=Math.round(f*(e=Math.pow(10,Z(p)?D:p)))/e,g=Math.round(g*e)/e;let E=0;for(y&&(t&&f!==n?(j.push({value:n}),f<n&&E++,aC(Math.round((f+E*C)*e)/e,n,ed(n,B,a))&&E++):f<n&&E++);E<h;++E){let a=Math.round((f+E*C)*e)/e;if(z&&a>o)break;j.push({value:a})}return z&&t&&g!==o?j.length&&aC(j[j.length-1].value,o,ed(o,B,a))?j[j.length-1].value=o:j.push({value:o}):z&&g!==o||j.push({value:g}),j}({maxTicks:c=Math.max(2,c),bounds:a.bounds,min:a.min,max:a.max,precision:b.precision,step:b.stepSize,count:b.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:b.minRotation||0,includeBounds:!1!==b.includeBounds},this._range||this);return"ticks"===a.bounds&&aF(d,this,"value"),a.reverse?(d.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),d}configure(){let a=this.ticks,b=this.min,c=this.max;if(super.configure(),this.options.offset&&a.length){let d=(c-b)/Math.max(a.length-1,1)/2;b-=d,c+=d}this._startValue=b,this._endValue=c,this._valueRange=c-b}getLabelForValue(a){return a8(a,this.chart.options.locale,this.options.ticks.format)}}class ef extends ee{static id="linear";static defaults={ticks:{callback:a9.numeric}};determineDataLimits(){let{min:a,max:b}=this.getMinMax(!0);this.min=aa(a)?a:0,this.max=aa(b)?b:1,this.handleTickRangeOptions()}computeTickLimit(){let a=this.isHorizontal(),b=a?this.width:this.height,c=aG(this.options.ticks.minRotation),d=(a?Math.sin(c):Math.cos(c))||.001;return Math.ceil(b/Math.min(40,this._resolveTickFontOptions(0).lineHeight/d))}getPixelForValue(a){return null===a?NaN:this.getPixelForDecimal((a-this._startValue)/this._valueRange)}getValueForPixel(a){return this._startValue+this.getDecimalForPixel(a)*this._valueRange}}let eg=a=>Math.floor(aA(a)),eh=(a,b)=>Math.pow(10,eg(a)+b);function ei(a){return 1==a/Math.pow(10,eg(a))}function ej(a,b,c){let d=Math.pow(10,c),e=Math.floor(a/d);return Math.ceil(b/d)-e}class ek extends cY{static id="logarithmic";static defaults={ticks:{callback:a9.logarithmic,major:{enabled:!0}}};constructor(a){super(a),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(a,b){let c=ee.prototype.parse.apply(this,[a,b]);if(0===c){this._zero=!0;return}return aa(c)&&c>0?c:null}determineDataLimits(){let{min:a,max:b}=this.getMinMax(!0);this.min=aa(a)?Math.max(0,a):null,this.max=aa(b)?Math.max(0,b):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!aa(this._userMin)&&(this.min=a===eh(this.min,0)?eh(this.min,-1):eh(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){let{minDefined:a,maxDefined:b}=this.getUserBounds(),c=this.min,d=this.max,e=b=>c=a?c:b,f=a=>d=b?d:a;c===d&&(c<=0?(e(1),f(10)):(e(eh(c,-1)),f(eh(d,1)))),c<=0&&e(eh(d,-1)),d<=0&&f(eh(c,1)),this.min=c,this.max=d}buildTicks(){let a=this.options,b=function(a,{min:b,max:c}){b=ab(a.min,b);let d=[],e=eg(b),f=function(a,b){let c=eg(b-a);for(;ej(a,b,c)>10;)c++;for(;10>ej(a,b,c);)c--;return Math.min(c,eg(a))}(b,c),g=f<0?Math.pow(10,Math.abs(f)):1,h=Math.pow(10,f),i=e>f?Math.pow(10,e):0,j=Math.round((b-i)*g)/g,k=Math.floor((b-i)/h/10)*h*10,l=Math.floor((j-k)/Math.pow(10,f)),n=ab(a.min,Math.round((i+k+l*Math.pow(10,f))*g)/g);for(;n<c;)d.push({value:n,major:ei(n),significand:l}),l>=10?l=l<15?15:20:l++,l>=20&&(l=2,g=++f>=0?1:g),n=Math.round((i+k+l*Math.pow(10,f))*g)/g;let o=ab(a.max,n);return d.push({value:o,major:ei(o),significand:l}),d}({min:this._userMin,max:this._userMax},this);return"ticks"===a.bounds&&aF(b,this,"value"),a.reverse?(b.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),b}getLabelForValue(a){return void 0===a?"0":a8(a,this.chart.options.locale,this.options.ticks.format)}configure(){let a=this.min;super.configure(),this._startValue=aA(a),this._valueRange=aA(this.max)-aA(a)}getPixelForValue(a){return((void 0===a||0===a)&&(a=this.min),null===a||isNaN(a))?NaN:this.getPixelForDecimal(a===this.min?0:(aA(a)-this._startValue)/this._valueRange)}getValueForPixel(a){let b=this.getDecimalForPixel(a);return Math.pow(10,this._startValue+b*this._valueRange)}}function el(a){let b=a.ticks;if(b.display&&a.display){let a=bx(b.backdropPadding);return ac(b.font&&b.font.size,be.font.size)+a.height}return 0}function em(a,b,c,d,e){return a===d||a===e?{start:b-c/2,end:b+c/2}:a<d||a>e?{start:b-c,end:b}:{start:b,end:b+c}}function en(a,b,c,d){let{ctx:e}=a;if(c)e.arc(a.xCenter,a.yCenter,b,0,au);else{let c=a.getPointPosition(0,b);e.moveTo(c.x,c.y);for(let f=1;f<d;f++)c=a.getPointPosition(f,b),e.lineTo(c.x,c.y)}}class eo extends ee{static id="radialLinear";static defaults={display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:a9.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback:a=>a,padding:5,centerPointLabels:!1}};static defaultRoutes={"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"};static descriptors={angleLines:{_fallback:"grid"}};constructor(a){super(a),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){let a=this._padding=bx(el(this.options)/2),b=this.width=this.maxWidth-a.width,c=this.height=this.maxHeight-a.height;this.xCenter=Math.floor(this.left+b/2+a.left),this.yCenter=Math.floor(this.top+c/2+a.top),this.drawingArea=Math.floor(Math.min(b,c)/2)}determineDataLimits(){let{min:a,max:b}=this.getMinMax(!1);this.min=aa(a)&&!isNaN(a)?a:0,this.max=aa(b)&&!isNaN(b)?b:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/el(this.options))}generateTickLabels(a){ee.prototype.generateTickLabels.call(this,a),this._pointLabels=this.getLabels().map((a,b)=>{let c=ae(this.options.pointLabels.callback,[a,b],this);return c||0===c?c:""}).filter((a,b)=>this.chart.getDataVisibility(b))}fit(){let a=this.options;a.display&&a.pointLabels.display?function(a){let b={l:a.left+a._padding.left,r:a.right-a._padding.right,t:a.top+a._padding.top,b:a.bottom-a._padding.bottom},c=Object.assign({},b),d=[],e=[],f=a._pointLabels.length,g=a.options.pointLabels,h=g.centerPointLabels?at/f:0;for(let k=0;k<f;k++){var i,j;let f=g.setContext(a.getPointLabelContext(k));e[k]=f.padding;let l=a.getPointPosition(k,a.drawingArea+e[k],h),n=by(f.font),o=(i=a.ctx,j=$(j=a._pointLabels[k])?j:[j],{w:function(a,b,c,d){let e,f,g,h,i,j=(d=d||{}).data=d.data||{},k=d.garbageCollect=d.garbageCollect||[];d.font!==b&&(j=d.data={},k=d.garbageCollect=[],d.font=b),a.save(),a.font=b;let l=0,n=c.length;for(e=0;e<n;e++)if(null==(h=c[e])||$(h)){if($(h))for(f=0,g=h.length;f<g;f++)null==(i=h[f])||$(i)||(l=bf(a,j,k,l,i))}else l=bf(a,j,k,l,h);a.restore();let o=k.length/2;if(o>c.length){for(e=0;e<o;e++)delete j[k[e]];k.splice(0,o)}return l}(i,n.string,j),h:j.length*n.lineHeight});d[k]=o;let p=aL(a.getIndexAngle(k)+h),q=Math.round(180/at*p);!function(a,b,c,d,e){let f=Math.abs(Math.sin(c)),g=Math.abs(Math.cos(c)),h=0,i=0;d.start<b.l?(h=(b.l-d.start)/f,a.l=Math.min(a.l,b.l-h)):d.end>b.r&&(h=(d.end-b.r)/f,a.r=Math.max(a.r,b.r+h)),e.start<b.t?(i=(b.t-e.start)/g,a.t=Math.min(a.t,b.t-i)):e.end>b.b&&(i=(e.end-b.b)/g,a.b=Math.max(a.b,b.b+i))}(c,b,p,em(q,l.x,o.w,0,180),em(q,l.y,o.h,90,270))}a.setCenterPoint(b.l-c.l,c.r-b.r,b.t-c.t,c.b-b.b),a._pointLabelItems=function(a,b,c){let d,e=[],f=a._pointLabels.length,g=a.options,{centerPointLabels:h,display:i}=g.pointLabels,j={extra:el(g)/2,additionalAngle:h?at/f:0};for(let g=0;g<f;g++){j.padding=c[g],j.size=b[g];let f=function(a,b,c){var d,e,f,g,h,i,j;let k=a.drawingArea,{extra:l,additionalAngle:n,padding:o,size:p}=c,q=a.getPointPosition(b,k+l+o,n),r=Math.round(180/at*aL(q.angle+ax)),s=(d=q.y,e=p.h,90===(f=r)||270===f?d-=e/2:(f>270||f<90)&&(d-=e),d),t=0===(g=r)||180===g?"center":g<180?"left":"right",u=(h=q.x,i=p.w,"right"===(j=t)?h-=i:"center"===j&&(h-=i/2),h);return{visible:!0,x:q.x,y:s,textAlign:t,left:u,top:s,right:u+p.w,bottom:s+p.h}}(a,g,j);e.push(f),"auto"===i&&(f.visible=function(a,b){if(!b)return!0;let{left:c,top:d,right:e,bottom:f}=a;return!(bk({x:c,y:d},b)||bk({x:c,y:f},b)||bk({x:e,y:d},b)||bk({x:e,y:f},b))}(f,d),f.visible&&(d=f))}return e}(a,d,e)}(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(a,b,c,d){this.xCenter+=Math.floor((a-b)/2),this.yCenter+=Math.floor((c-d)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(a,b,c,d))}getIndexAngle(a){return aL(a*(au/(this._pointLabels.length||1))+aG(this.options.startAngle||0))}getDistanceFromCenterForValue(a){if(Z(a))return NaN;let b=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-a)*b:(a-this.min)*b}getValueForDistanceFromCenter(a){if(Z(a))return NaN;let b=a/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-b:this.min+b}getPointLabelContext(a){let b=this._pointLabels||[];if(a>=0&&a<b.length){var c;let d=b[a];return c=this.getContext(),bA(c,{label:d,index:a,type:"pointLabel"})}}getPointPosition(a,b,c=0){let d=this.getIndexAngle(a)-ax+c;return{x:Math.cos(d)*b+this.xCenter,y:Math.sin(d)*b+this.yCenter,angle:d}}getPointPositionForValue(a,b){return this.getPointPosition(a,this.getDistanceFromCenterForValue(b))}getBasePosition(a){return this.getPointPositionForValue(a||0,this.getBaseValue())}getPointLabelPosition(a){let{left:b,top:c,right:d,bottom:e}=this._pointLabelItems[a];return{left:b,top:c,right:d,bottom:e}}drawBackground(){let{backgroundColor:a,grid:{circular:b}}=this.options;if(a){let c=this.ctx;c.save(),c.beginPath(),en(this,this.getDistanceFromCenterForValue(this._endValue),b,this._pointLabels.length),c.closePath(),c.fillStyle=a,c.fill(),c.restore()}}drawGrid(){let a,b,c,d=this.ctx,e=this.options,{angleLines:f,grid:g,border:h}=e,i=this._pointLabels.length;if(e.pointLabels.display&&function(a,b){let{ctx:c,options:{pointLabels:d}}=a;for(let e=b-1;e>=0;e--){let b=a._pointLabelItems[e];if(!b.visible)continue;let f=d.setContext(a.getPointLabelContext(e));!function(a,b,c){let{left:d,top:e,right:f,bottom:g}=c,{backdropColor:h}=b;if(!Z(h)){let c=bw(b.borderRadius),i=bx(b.backdropPadding);a.fillStyle=h;let j=d-i.left,k=e-i.top,l=f-d+i.width,n=g-e+i.height;Object.values(c).some(a=>0!==a)?(a.beginPath(),bq(a,{x:j,y:k,w:l,h:n,radius:c}),a.fill()):a.fillRect(j,k,l,n)}}(c,f,b);let g=by(f.font),{x:h,y:i,textAlign:j}=b;bp(c,a._pointLabels[e],h,i+g.lineHeight/2,g,{color:f.color,textAlign:j,textBaseline:"middle"})}}(this,i),g.display&&this.ticks.forEach((a,c)=>{if(0!==c||0===c&&this.min<0){b=this.getDistanceFromCenterForValue(a.value);let d=this.getContext(c),e=g.setContext(d),f=h.setContext(d);!function(a,b,c,d,e){let f=a.ctx,g=b.circular,{color:h,lineWidth:i}=b;(g||d)&&h&&i&&!(c<0)&&(f.save(),f.strokeStyle=h,f.lineWidth=i,f.setLineDash(e.dash||[]),f.lineDashOffset=e.dashOffset,f.beginPath(),en(a,c,g,d),f.closePath(),f.stroke(),f.restore())}(this,e,b,i,f)}}),f.display){for(d.save(),a=i-1;a>=0;a--){let g=f.setContext(this.getPointLabelContext(a)),{color:h,lineWidth:i}=g;i&&h&&(d.lineWidth=i,d.strokeStyle=h,d.setLineDash(g.borderDash),d.lineDashOffset=g.borderDashOffset,b=this.getDistanceFromCenterForValue(e.reverse?this.min:this.max),c=this.getPointPosition(a,b),d.beginPath(),d.moveTo(this.xCenter,this.yCenter),d.lineTo(c.x,c.y),d.stroke())}d.restore()}}drawBorder(){}drawLabels(){let a,b,c=this.ctx,d=this.options,e=d.ticks;if(!e.display)return;let f=this.getIndexAngle(0);c.save(),c.translate(this.xCenter,this.yCenter),c.rotate(f),c.textAlign="center",c.textBaseline="middle",this.ticks.forEach((f,g)=>{if(0===g&&this.min>=0&&!d.reverse)return;let h=e.setContext(this.getContext(g)),i=by(h.font);if(a=this.getDistanceFromCenterForValue(this.ticks[g].value),h.showLabelBackdrop){c.font=i.string,b=c.measureText(f.label).width,c.fillStyle=h.backdropColor;let d=bx(h.backdropPadding);c.fillRect(-b/2-d.left,-a-i.size/2-d.top,b+d.width,i.size+d.height)}bp(c,f.label,0,-a,i,{color:h.color,strokeColor:h.textStrokeColor,strokeWidth:h.textStrokeWidth})}),c.restore()}drawTitle(){}}let ep={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},eq=Object.keys(ep);function er(a,b){return a-b}function es(a,b){if(Z(b))return null;let c=a._adapter,{parser:d,round:e,isoWeekday:f}=a._parseOpts,g=b;return("function"==typeof d&&(g=d(g)),aa(g)||(g="string"==typeof d?c.parse(g,d):c.parse(g)),null===g)?null:(e&&(g="week"===e&&(aE(f)||!0===f)?c.startOf(g,"isoWeek",f):c.startOf(g,e)),+g)}function et(a,b,c,d){let e=eq.length;for(let f=eq.indexOf(a);f<e-1;++f){let a=ep[eq[f]],e=a.steps?a.steps:Number.MAX_SAFE_INTEGER;if(a.common&&Math.ceil((c-b)/(e*a.size))<=d)return eq[f]}return eq[e-1]}function eu(a,b,c){if(c){if(c.length){let{lo:d,hi:e}=aP(c,b);a[c[d]>=b?c[d]:c[e]]=!0}}else a[b]=!0}function ev(a,b,c){let d,e,f=[],g={},h=b.length;for(d=0;d<h;++d)g[e=b[d]]=d,f.push({value:e,major:!1});return 0!==h&&c?function(a,b,c,d){let e,f,g=a._adapter,h=+g.startOf(b[0].value,d),i=b[b.length-1].value;for(e=h;e<=i;e=+g.add(e,1,d))(f=c[e])>=0&&(b[f].major=!0);return b}(a,f,g,c):f}class ew extends cY{static id="time";static defaults={bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}};constructor(a){super(a),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(a,b={}){let c=a.time||(a.time={}),d=this._adapter=new cz(a.adapters.date);d.init(b),al(c.displayFormats,d.formats()),this._parseOpts={parser:c.parser,round:c.round,isoWeekday:c.isoWeekday},super.init(a),this._normalized=b.normalized}parse(a,b){return void 0===a?null:es(this,a)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){let a=this.options,b=this._adapter,c=a.time.unit||"day",{min:d,max:e,minDefined:f,maxDefined:g}=this.getUserBounds();function h(a){f||isNaN(a.min)||(d=Math.min(d,a.min)),g||isNaN(a.max)||(e=Math.max(e,a.max))}f&&g||(h(this._getLabelBounds()),("ticks"!==a.bounds||"labels"!==a.ticks.source)&&h(this.getMinMax(!1))),d=aa(d)&&!isNaN(d)?d:+b.startOf(Date.now(),c),e=aa(e)&&!isNaN(e)?e:+b.endOf(Date.now(),c)+1,this.min=Math.min(d,e-1),this.max=Math.max(d+1,e)}_getLabelBounds(){let a=this.getLabelTimestamps(),b=1/0,c=-1/0;return a.length&&(b=a[0],c=a[a.length-1]),{min:b,max:c}}buildTicks(){let a=this.options,b=a.time,c=a.ticks,d="labels"===c.source?this.getLabelTimestamps():this._generate();"ticks"===a.bounds&&d.length&&(this.min=this._userMin||d[0],this.max=this._userMax||d[d.length-1]);let e=this.min,f=function(a,b,c){let d=0,e=a.length;for(;d<e&&a[d]<b;)d++;for(;e>d&&a[e-1]>c;)e--;return d>0||e<a.length?a.slice(d,e):a}(d,e,this.max);return this._unit=b.unit||(c.autoSkip?et(b.minUnit,this.min,this.max,this._getLabelCapacity(e)):function(a,b,c,d,e){for(let f=eq.length-1;f>=eq.indexOf(c);f--){let c=eq[f];if(ep[c].common&&a._adapter.diff(e,d,c)>=b-1)return c}return eq[c?eq.indexOf(c):0]}(this,f.length,b.minUnit,this.min,this.max)),this._majorUnit=c.major.enabled&&"year"!==this._unit?function(a){for(let b=eq.indexOf(a)+1,c=eq.length;b<c;++b)if(ep[eq[b]].common)return eq[b]}(this._unit):void 0,this.initOffsets(d),a.reverse&&f.reverse(),ev(this,f,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(a=>+a.value))}initOffsets(a=[]){let b,c,d=0,e=0;this.options.offset&&a.length&&(b=this.getDecimalForValue(a[0]),d=1===a.length?1-b:(this.getDecimalForValue(a[1])-b)/2,c=this.getDecimalForValue(a[a.length-1]),e=1===a.length?c:(c-this.getDecimalForValue(a[a.length-2]))/2);let f=a.length<3?.5:.25;d=aN(d,0,f),e=aN(e,0,f),this._offsets={start:d,end:e,factor:1/(d+1+e)}}_generate(){let a,b,c=this._adapter,d=this.min,e=this.max,f=this.options,g=f.time,h=g.unit||et(g.minUnit,d,e,this._getLabelCapacity(d)),i=ac(f.ticks.stepSize,1),j="week"===h&&g.isoWeekday,k=aE(j)||!0===j,l={},n=d;if(k&&(n=+c.startOf(n,"isoWeek",j)),n=+c.startOf(n,k?"day":h),c.diff(e,d,h)>1e5*i)throw Error(d+" and "+e+" are too far apart with stepSize of "+i+" "+h);let o="data"===f.ticks.source&&this.getDataTimestamps();for(a=n,b=0;a<e;a=+c.add(a,i,h),b++)eu(l,a,o);return(a===e||"ticks"===f.bounds||1===b)&&eu(l,a,o),Object.keys(l).sort(er).map(a=>+a)}getLabelForValue(a){let b=this._adapter,c=this.options.time;return c.tooltipFormat?b.format(a,c.tooltipFormat):b.format(a,c.displayFormats.datetime)}format(a,b){let c=this.options.time.displayFormats,d=this._unit,e=b||c[d];return this._adapter.format(a,e)}_tickFormatFunction(a,b,c,d){let e=this.options,f=e.ticks.callback;if(f)return ae(f,[a,b,c],this);let g=e.time.displayFormats,h=this._unit,i=this._majorUnit,j=h&&g[h],k=i&&g[i],l=c[b],n=i&&k&&l&&l.major;return this._adapter.format(a,d||(n?k:j))}generateTickLabels(a){let b,c,d;for(b=0,c=a.length;b<c;++b)(d=a[b]).label=this._tickFormatFunction(d.value,b,a)}getDecimalForValue(a){return null===a?NaN:(a-this.min)/(this.max-this.min)}getPixelForValue(a){let b=this._offsets,c=this.getDecimalForValue(a);return this.getPixelForDecimal((b.start+c)*b.factor)}getValueForPixel(a){let b=this._offsets,c=this.getDecimalForPixel(a)/b.factor-b.end;return this.min+c*(this.max-this.min)}_getLabelSize(a){let b=this.options.ticks,c=this.ctx.measureText(a).width,d=aG(this.isHorizontal()?b.maxRotation:b.minRotation),e=Math.cos(d),f=Math.sin(d),g=this._resolveTickFontOptions(0).size;return{w:c*e+g*f,h:c*f+g*e}}_getLabelCapacity(a){let b=this.options.time,c=b.displayFormats,d=c[b.unit]||c.millisecond,e=this._tickFormatFunction(a,0,ev(this,[a],this._majorUnit),d),f=this._getLabelSize(e),g=Math.floor(this.isHorizontal()?this.width/f.w:this.height/f.h)-1;return g>0?g:1}getDataTimestamps(){let a,b,c=this._cache.data||[];if(c.length)return c;let d=this.getMatchingVisibleMetas();if(this._normalized&&d.length)return this._cache.data=d[0].controller.getAllParsedValues(this);for(a=0,b=d.length;a<b;++a)c=c.concat(d[a].controller.getAllParsedValues(this));return this._cache.data=this.normalize(c)}getLabelTimestamps(){let a,b,c=this._cache.labels||[];if(c.length)return c;let d=this.getLabels();for(a=0,b=d.length;a<b;++a)c.push(es(this,d[a]));return this._cache.labels=this._normalized?c:this.normalize(c)}normalize(a){return aU(a.sort(er))}}function ex(a,b,c){let d,e,f,g,h=0,i=a.length-1;c?(b>=a[h].pos&&b<=a[i].pos&&({lo:h,hi:i}=aQ(a,"pos",b)),{pos:d,time:f}=a[h],{pos:e,time:g}=a[i]):(b>=a[h].time&&b<=a[i].time&&({lo:h,hi:i}=aQ(a,"time",b)),{time:d,pos:f}=a[h],{time:e,pos:g}=a[i]);let j=e-d;return j?f+(g-f)*(b-d)/j:f}class ey extends ew{static id="timeseries";static defaults=ew.defaults;constructor(a){super(a),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){let a=this._getTimestampsForTable(),b=this._table=this.buildLookupTable(a);this._minPos=ex(b,this.min),this._tableRange=ex(b,this.max)-this._minPos,super.initOffsets(a)}buildLookupTable(a){let b,c,d,{min:e,max:f}=this,g=[],h=[];for(b=0,c=a.length;b<c;++b)(d=a[b])>=e&&d<=f&&g.push(d);if(g.length<2)return[{time:e,pos:0},{time:f,pos:1}];for(b=0,c=g.length;b<c;++b)Math.round((g[b+1]+g[b-1])/2)!==(d=g[b])&&h.push({time:d,pos:b/(c-1)});return h}_generate(){let a=this.min,b=this.max,c=super.getDataTimestamps();return c.includes(a)&&c.length||c.splice(0,0,a),c.includes(b)&&1!==c.length||c.push(b),c.sort((a,b)=>a-b)}_getTimestampsForTable(){let a=this._cache.all||[];if(a.length)return a;let b=this.getDataTimestamps(),c=this.getLabelTimestamps();return a=b.length&&c.length?this.normalize(b.concat(c)):b.length?b:c,a=this._cache.all=a}getDecimalForValue(a){return(ex(this._table,a)-this._minPos)/this._tableRange}getValueForPixel(a){let b=this._offsets,c=this.getDecimalForPixel(a)/b.factor-b.end;return ex(this._table,c*this._tableRange+this._minPos,!0)}}let ez="label";function eA(a,b){"function"==typeof a?a(b):a&&(a.current=b)}function eB(a,b,c=ez){let d=[];a.datasets=b.map(b=>{let e=a.datasets.find(a=>a[c]===b[c]);return!e||!b.data||d.includes(e)?{...b}:(d.push(e),Object.assign(e,b),e)})}let eC=(0,u.forwardRef)(function(a,b){let{height:c=150,width:d=300,redraw:e=!1,datasetIdKey:f,type:g,data:h,options:i,plugins:j=[],fallbackContent:k,updateMode:l,...n}=a,o=(0,u.useRef)(null),p=(0,u.useRef)(null),q=()=>{o.current&&(p.current=new dl(o.current,{type:g,data:function(a,b=ez){let c={labels:[],datasets:[]};return c.labels=a.labels,eB(c,a.datasets,b),c}(h,f),options:i&&{...i},plugins:j}),eA(b,p.current))},r=()=>{eA(b,null),p.current&&(p.current.destroy(),p.current=null)};return(0,u.useEffect)(()=>{var a;let b;!e&&p.current&&i&&(a=p.current,(b=a.options)&&i&&Object.assign(b,i))},[e,i]),(0,u.useEffect)(()=>{!e&&p.current&&(p.current.config.data.labels=h.labels)},[e,h.labels]),(0,u.useEffect)(()=>{!e&&p.current&&h.datasets&&eB(p.current.config.data,h.datasets,f)},[e,h.datasets]),(0,u.useEffect)(()=>{p.current&&(e?(r(),setTimeout(q)):p.current.update(l))},[e,i,h.labels,h.datasets,l]),(0,u.useEffect)(()=>{p.current&&(r(),setTimeout(q))},[g]),(0,u.useEffect)(()=>(q(),()=>r()),[]),(0,t.jsx)("canvas",{ref:o,role:"img",height:c,width:d,...n,children:k})});function eD(a,b){return dl.register(b),(0,u.forwardRef)((b,c)=>(0,t.jsx)(eC,{...b,ref:c,type:a}))}let eE=eD("line",class extends co{static id="line";static defaults={datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1};static overrides={scales:{_index_:{type:"category"},_value_:{type:"linear"}}};initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(a){let b=this._cachedMeta,{dataset:c,data:d=[],_dataset:e}=b,f=this.chart._animationsDisabled,{start:g,count:h}=aY(b,d,f);this._drawStart=g,this._drawCount=h,aZ(b)&&(g=0,h=d.length),c._chart=this.chart,c._datasetIndex=this.index,c._decimated=!!e._decimated,c.points=d;let i=this.resolveDatasetElementOptions(a);this.options.showLine||(i.borderWidth=0),i.segment=this.options.segment,this.updateElement(c,void 0,{animated:!f,options:i},a),this.updateElements(d,g,h,a)}updateElements(a,b,c,d){let e="reset"===d,{iScale:f,vScale:g,_stacked:h,_dataset:i}=this._cachedMeta,{sharedOptions:j,includeOptions:k}=this._getSharedOptions(b,d),l=f.axis,n=g.axis,{spanGaps:o,segment:p}=this.options,q=aE(o)?o:1/0,r=this.chart._animationsDisabled||e||"none"===d,s=b+c,t=a.length,u=b>0&&this.getParsed(b-1);for(let c=0;c<t;++c){let o=a[c],t=r?o:{};if(c<b||c>=s){t.skip=!0;continue}let v=this.getParsed(c),w=Z(v[n]),x=t[l]=f.getPixelForValue(v[l],c),y=t[n]=e||w?g.getBasePixel():g.getPixelForValue(h?this.applyStack(g,v,h):v[n],c);t.skip=isNaN(x)||isNaN(y)||w,t.stop=c>0&&Math.abs(v[l]-u[l])>q,p&&(t.parsed=v,t.raw=i.data[c]),k&&(t.options=j||this.resolveDataElementOptions(c,o.active?"active":d)),r||this.updateElement(o,c,t,d),u=v}}getMaxOverflow(){let a=this._cachedMeta,b=a.dataset,c=b.options&&b.options.borderWidth||0,d=a.data||[];return d.length?Math.max(c,d[0].size(this.resolveDataElementOptions(0)),d[d.length-1].size(this.resolveDataElementOptions(d.length-1)))/2:c}draw(){let a=this._cachedMeta;a.dataset.updateControlPoints(this.chart.chartArea,a.iScale.axis),super.draw()}}),eF=eD("bar",class extends co{static id="bar";static defaults={datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}};static overrides={scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}};parsePrimitiveData(a,b,c,d){return cq(a,b,c,d)}parseArrayData(a,b,c,d){return cq(a,b,c,d)}parseObjectData(a,b,c,d){let e,f,g,h,{iScale:i,vScale:j}=a,{xAxisKey:k="x",yAxisKey:l="y"}=this._parsing,n="x"===i.axis?k:l,o="x"===j.axis?k:l,p=[];for(e=c,f=c+d;e<f;++e)h=b[e],(g={})[i.axis]=i.parse(ao(h,n),e),p.push(cp(ao(h,o),g,j,e));return p}updateRangeFromParsed(a,b,c,d){super.updateRangeFromParsed(a,b,c,d);let e=c._custom;e&&b===this._cachedMeta.vScale&&(a.min=Math.min(a.min,e.min),a.max=Math.max(a.max,e.max))}getMaxOverflow(){return 0}getLabelAndValue(a){let{iScale:b,vScale:c}=this._cachedMeta,d=this.getParsed(a),e=d._custom,f=cr(e)?"["+e.start+", "+e.end+"]":""+c.getLabelForValue(d[c.axis]);return{label:""+b.getLabelForValue(d[b.axis]),value:f}}initialize(){this.enableOptionSharing=!0,super.initialize(),this._cachedMeta.stack=this.getDataset().stack}update(a){let b=this._cachedMeta;this.updateElements(b.data,0,b.data.length,a)}updateElements(a,b,c,d){let e="reset"===d,{index:f,_cachedMeta:{vScale:g}}=this,h=g.getBasePixel(),i=g.isHorizontal(),j=this._getRuler(),{sharedOptions:k,includeOptions:l}=this._getSharedOptions(b,d);for(let n=b;n<b+c;n++){let b=this.getParsed(n),c=e||Z(b[g.axis])?{base:h,head:h}:this._calculateBarValuePixels(n),o=this._calculateBarIndexPixels(n,j),p=(b._stacks||{})[g.axis],q={horizontal:i,base:c.base,enableBorderRadius:!p||cr(b._custom)||f===p._top||f===p._bottom,x:i?c.head:o.center,y:i?o.center:c.head,height:i?o.size:Math.abs(c.size),width:i?Math.abs(c.size):o.size};l&&(q.options=k||this.resolveDataElementOptions(n,a[n].active?"active":d));let r=q.options||a[n].options;!function(a,b,c,d){let e,f,g,h,i,j=b.borderSkipped,k={};if(!j){a.borderSkipped=k;return}if(!0===j){a.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}let{start:l,end:n,reverse:o,top:p,bottom:q}=(a.horizontal?(e=a.base>a.x,f="left",g="right"):(e=a.base<a.y,f="bottom",g="top"),e?(h="end",i="start"):(h="start",i="end"),{start:f,end:g,reverse:e,top:h,bottom:i});"middle"===j&&c&&(a.enableBorderRadius=!0,(c._top||0)===d?j=p:(c._bottom||0)===d?j=q:(k[cs(q,l,n,o)]=!0,j=p)),k[cs(j,l,n,o)]=!0,a.borderSkipped=k}(q,r,p,f),function(a,{inflateAmount:b},c){a.inflateAmount="auto"===b?.33*(1===c):b}(q,r,j.ratio),this.updateElement(a[n],n,q,d)}}_getStacks(a,b){let{iScale:c}=this._cachedMeta,d=c.getMatchingVisibleMetas(this._type).filter(a=>a.controller.options.grouped),e=c.options.stacked,f=[],g=this._cachedMeta.controller.getParsed(b),h=g&&g[c.axis],i=a=>{let b=a._parsed.find(a=>a[c.axis]===h),d=b&&b[a.vScale.axis];if(Z(d)||isNaN(d))return!0};for(let c of d)if(!(void 0!==b&&i(c))&&((!1===e||-1===f.indexOf(c.stack)||void 0===e&&void 0===c.stack)&&f.push(c.stack),c.index===a))break;return f.length||f.push(void 0),f}_getStackCount(a){return this._getStacks(void 0,a).length}_getAxisCount(){return this._getAxis().length}getFirstScaleIdForIndexAxis(){let a=this.chart.scales,b=this.chart.options.indexAxis;return Object.keys(a).filter(c=>a[c].axis===b).shift()}_getAxis(){let a={},b=this.getFirstScaleIdForIndexAxis();for(let c of this.chart.data.datasets)a[ac("x"===this.chart.options.indexAxis?c.xAxisID:c.yAxisID,b)]=!0;return Object.keys(a)}_getStackIndex(a,b,c){let d=this._getStacks(a,c),e=void 0!==b?d.indexOf(b):-1;return -1===e?d.length-1:e}_getRuler(){let a,b,c=this.options,d=this._cachedMeta,e=d.iScale,f=[];for(a=0,b=d.data.length;a<b;++a)f.push(e.getPixelForValue(this.getParsed(a)[e.axis],a));let g=c.barThickness;return{min:g||function(a){let b,c,d,e,f=a.iScale,g=function(a,b){if(!a._cache.$bar){let c=a.getMatchingVisibleMetas(b),d=[];for(let b=0,e=c.length;b<e;b++)d=d.concat(c[b].controller.getAllParsedValues(a));a._cache.$bar=aU(d.sort((a,b)=>a-b))}return a._cache.$bar}(f,a.type),h=f._length,i=()=>{32767!==d&&-32768!==d&&(aq(e)&&(h=Math.min(h,Math.abs(d-e)||h)),e=d)};for(b=0,c=g.length;b<c;++b)d=f.getPixelForValue(g[b]),i();for(b=0,e=void 0,c=f.ticks.length;b<c;++b)d=f.getPixelForTick(b),i();return h}(d),pixels:f,start:e._startPixel,end:e._endPixel,stackCount:this._getStackCount(),scale:e,grouped:c.grouped,ratio:g?1:c.categoryPercentage*c.barPercentage}}_calculateBarValuePixels(a){let b,c,{_cachedMeta:{vScale:d,_stacked:e,index:f},options:{base:g,minBarLength:h}}=this,i=g||0,j=this.getParsed(a),k=j._custom,l=cr(k),n=j[d.axis],o=0,p=e?this.applyStack(d,j,e):n;p!==n&&(o=p-n,p=n),l&&(n=k.barStart,p=k.barEnd-k.barStart,0!==n&&aB(n)!==aB(k.barEnd)&&(o=0),o+=n);let q=Z(g)||l?o:g,r=d.getPixelForValue(q);if(Math.abs(c=(b=this.chart.getDataVisibility(a)?d.getPixelForValue(o+p):r)-r)<h){var s;c=(0!==(s=c)?aB(s):(d.isHorizontal()?1:-1)*(d.min>=i?1:-1))*h,n===i&&(r-=c/2);let a=d.getPixelForDecimal(0),g=d.getPixelForDecimal(1),k=Math.min(a,g);b=(r=Math.max(Math.min(r,Math.max(a,g)),k))+c,e&&!l&&(j._stacks[d.axis]._visualValues[f]=d.getValueForPixel(b)-d.getValueForPixel(r))}if(r===d.getPixelForValue(i)){let a=aB(c)*d.getLineWidthForValue(i)/2;r+=a,c-=a}return{size:c,base:r,head:b,center:b+c/2}}_calculateBarIndexPixels(a,b){let c,d,e=b.scale,f=this.options,g=f.skipNull,h=ac(f.maxBarThickness,1/0),i=this._getAxisCount();if(b.grouped){var j,k;let e,l,n,o,p,q,r,s,t,u=g?this._getStackCount(a):b.stackCount,v="flex"===f.barThickness?(j=u*i,l=(e=b.pixels)[a],n=a>0?e[a-1]:null,o=a<e.length-1?e[a+1]:null,p=f.categoryPercentage,null===n&&(n=l-(null===o?b.end-b.start:o-l)),null===o&&(o=l+l-n),q=l-(l-Math.min(n,o))/2*p,{chunk:Math.abs(o-n)/2*p/j,ratio:f.barPercentage,start:q}):(k=u*i,Z(t=f.barThickness)?(r=b.min*f.categoryPercentage,s=f.barPercentage):(r=t*k,s=1),{chunk:r/k,ratio:s,start:b.pixels[a]-r/2}),w="x"===this.chart.options.indexAxis?this.getDataset().xAxisID:this.getDataset().yAxisID,x=this._getAxis().indexOf(ac(w,this.getFirstScaleIdForIndexAxis())),y=this._getStackIndex(this.index,this._cachedMeta.stack,g?a:void 0)+x;c=v.start+v.chunk*y+v.chunk/2,d=Math.min(h,v.chunk*v.ratio)}else c=e.getPixelForValue(this.getParsed(a)[e.axis],a),d=Math.min(h,b.min*b.ratio);return{base:c-d/2,head:c+d/2,center:c,size:d}}draw(){let a=this._cachedMeta,b=a.vScale,c=a.data,d=c.length,e=0;for(;e<d;++e)null===this.getParsed(e)[b.axis]||c[e].hidden||c[e].draw(this._ctx)}}),eG=eD("scatter",class extends co{static id="scatter";static defaults={datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1};static overrides={interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}};getLabelAndValue(a){let b=this._cachedMeta,c=this.chart.data.labels||[],{xScale:d,yScale:e}=b,f=this.getParsed(a),g=d.getLabelForValue(f.x),h=e.getLabelForValue(f.y);return{label:c[a]||"",value:"("+g+", "+h+")"}}update(a){let b=this._cachedMeta,{data:c=[]}=b,d=this.chart._animationsDisabled,{start:e,count:f}=aY(b,c,d);if(this._drawStart=e,this._drawCount=f,aZ(b)&&(e=0,f=c.length),this.options.showLine){this.datasetElementType||this.addElements();let{dataset:e,_dataset:f}=b;e._chart=this.chart,e._datasetIndex=this.index,e._decimated=!!f._decimated,e.points=c;let g=this.resolveDatasetElementOptions(a);g.segment=this.options.segment,this.updateElement(e,void 0,{animated:!d,options:g},a)}else this.datasetElementType&&(delete b.dataset,this.datasetElementType=!1);this.updateElements(c,e,f,a)}addElements(){let{showLine:a}=this.options;!this.datasetElementType&&a&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(a,b,c,d){let e="reset"===d,{iScale:f,vScale:g,_stacked:h,_dataset:i}=this._cachedMeta,j=this.resolveDataElementOptions(b,d),k=this.getSharedOptions(j),l=this.includeOptions(d,k),n=f.axis,o=g.axis,{spanGaps:p,segment:q}=this.options,r=aE(p)?p:1/0,s=this.chart._animationsDisabled||e||"none"===d,t=b>0&&this.getParsed(b-1);for(let j=b;j<b+c;++j){let b=a[j],c=this.getParsed(j),p=s?b:{},u=Z(c[o]),v=p[n]=f.getPixelForValue(c[n],j),w=p[o]=e||u?g.getBasePixel():g.getPixelForValue(h?this.applyStack(g,c,h):c[o],j);p.skip=isNaN(v)||isNaN(w)||u,p.stop=j>0&&Math.abs(c[n]-t[n])>r,q&&(p.parsed=c,p.raw=i.data[j]),l&&(p.options=k||this.resolveDataElementOptions(j,b.active?"active":d)),s||this.updateElement(b,j,p,d),t=c}this.updateSharedOptions(k,d,j)}getMaxOverflow(){let a=this._cachedMeta,b=a.data||[];if(!this.options.showLine){let a=0;for(let c=b.length-1;c>=0;--c)a=Math.max(a,b[c].size(this.resolveDataElementOptions(c))/2);return a>0&&a}let c=a.dataset,d=c.options&&c.options.borderWidth||0;return b.length?Math.max(d,b[0].size(this.resolveDataElementOptions(0)),b[b.length-1].size(this.resolveDataElementOptions(b.length-1)))/2:d}});function eH({data:a,detailed:b=!1}){let c=(0,u.useMemo)(()=>({labels:["Min (p5)","Median (p50)","Max (p95)"],datasets:[{label:"Single Operator",data:[a.singleOperator.range[0],a.singleOperator.latency,a.singleOperator.range[1]],backgroundColor:["rgba(34, 197, 94, 0.5)","rgba(6, 182, 212, 0.8)","rgba(168, 85, 247, 0.5)"],borderColor:["rgb(34, 197, 94)","rgb(6, 182, 212)","rgb(168, 85, 247)"],borderWidth:2},{label:"8-Operator Chain",data:[a.eightOperatorChain.range[0],a.eightOperatorChain.latency,a.eightOperatorChain.range[1]],backgroundColor:["rgba(59, 130, 246, 0.5)","rgba(6, 182, 212, 0.8)","rgba(236, 72, 153, 0.5)"],borderColor:["rgb(59, 130, 246)","rgb(6, 182, 212)","rgb(236, 72, 153)"],borderWidth:2}]}),[a]),d=(0,u.useMemo)(()=>({labels:["Throughput"],datasets:[{label:"Operations/Second",data:[a.throughput.opsPerSec/1e6],backgroundColor:"rgba(6, 182, 212, 0.8)",borderColor:"rgb(6, 182, 212)",borderWidth:2}]}),[a]);return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("div",{className:"section-header",children:"Performance Benchmarks"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("h3",{className:"card-header",children:"Operator Latency Distribution"}),(0,t.jsx)("div",{className:"relative h-64",children:(0,t.jsx)(eF,{data:c,options:{responsive:!0,maintainAspectRatio:!0,plugins:{legend:{labels:{color:"#cbd5e1",font:{size:12}}},tooltip:{callbacks:{label:a=>`${a.parsed.y.toFixed(3)} s`}}},scales:{y:{ticks:{color:"#94a3b8"},grid:{color:"rgba(148, 163, 184, 0.1)"},title:{display:!0,text:"Latency (s)",color:"#cbd5e1"}},x:{ticks:{color:"#94a3b8"},grid:{color:"rgba(148, 163, 184, 0.1)"}}}}})})]}),(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("h3",{className:"card-header",children:"Sustained Throughput"}),(0,t.jsx)("div",{className:"relative h-64",children:(0,t.jsx)(eF,{data:d,options:{responsive:!0,maintainAspectRatio:!0,indexAxis:"y",plugins:{legend:{labels:{color:"#cbd5e1",font:{size:12}}},tooltip:{callbacks:{label:a=>`${a.parsed.x.toFixed(2)}M ops/sec`}}},scales:{x:{ticks:{color:"#94a3b8"},grid:{color:"rgba(148, 163, 184, 0.1)"}},y:{ticks:{color:"#94a3b8"},grid:{display:!1}}}}})})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("div",{className:"text-xs text-slate-400 uppercase",children:"Single Operator"}),(0,t.jsx)("div",{className:"text-3xl font-bold text-cyan-400 mt-2",children:a.singleOperator.latency}),(0,t.jsx)("div",{className:"text-xs text-slate-400 mt-1",children:"s (median)"}),(0,t.jsxs)("div",{className:"text-xs text-slate-500 mt-2",children:["Range: ",a.singleOperator.range[0]," - ",a.singleOperator.range[1]," s"]})]}),(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("div",{className:"text-xs text-slate-400 uppercase",children:"8-Operator Chain"}),(0,t.jsx)("div",{className:"text-3xl font-bold text-cyan-400 mt-2",children:a.eightOperatorChain.latency}),(0,t.jsx)("div",{className:"text-xs text-slate-400 mt-1",children:"s (median)"}),(0,t.jsxs)("div",{className:"text-xs text-slate-500 mt-2",children:["Range: ",a.eightOperatorChain.range[0]," - ",a.eightOperatorChain.range[1]," s"]})]}),(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("div",{className:"text-xs text-slate-400 uppercase",children:"Throughput"}),(0,t.jsxs)("div",{className:"text-3xl font-bold text-cyan-400 mt-2",children:[(a.throughput.opsPerSec/1e6).toFixed(2),"M"]}),(0,t.jsx)("div",{className:"text-xs text-slate-400 mt-1",children:"ops/sec"}),(0,t.jsx)("div",{className:"text-xs text-slate-500 mt-2",children:"Sustained performance"})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("h3",{className:"card-header",children:"Information Processing Rate"}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-slate-400",children:"Total Rate"}),(0,t.jsxs)("div",{className:"text-2xl font-bold text-cyan-400",children:[a.informationProcessing.rate,"M"]}),(0,t.jsx)("div",{className:"text-xs text-slate-400",children:"nats/second"})]}),(0,t.jsx)("hr",{className:"border-slate-800"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-slate-400",children:"Per Operator"}),(0,t.jsxs)("div",{className:"text-lg font-semibold text-blue-400",children:[a.informationProcessing.perOperator," nats/s"]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-xs text-slate-400",children:"Per Chain"}),(0,t.jsxs)("div",{className:"text-lg font-semibold text-purple-400",children:[a.informationProcessing.totalPerChain," nats/s"]})]})]})]}),(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("h3",{className:"card-header",children:"Performance Characteristics"}),(0,t.jsxs)("ul",{className:"space-y-2",children:[(0,t.jsxs)("li",{className:"flex items-center gap-2 text-sm",children:[(0,t.jsx)("span",{className:"inline-block w-2 h-2 rounded-full bg-green-500"}),(0,t.jsx)("span",{className:"text-slate-300",children:"Consistent latency across all operators"})]}),(0,t.jsxs)("li",{className:"flex items-center gap-2 text-sm",children:[(0,t.jsx)("span",{className:"inline-block w-2 h-2 rounded-full bg-green-500"}),(0,t.jsx)("span",{className:"text-slate-300",children:"Zero memory allocations in hot path"})]}),(0,t.jsxs)("li",{className:"flex items-center gap-2 text-sm",children:[(0,t.jsx)("span",{className:"inline-block w-2 h-2 rounded-full bg-green-500"}),(0,t.jsx)("span",{className:"text-slate-300",children:"Deterministic execution time"})]}),(0,t.jsxs)("li",{className:"flex items-center gap-2 text-sm",children:[(0,t.jsx)("span",{className:"inline-block w-2 h-2 rounded-full bg-green-500"}),(0,t.jsx)("span",{className:"text-slate-300",children:"Linear scaling with operator count"})]}),(0,t.jsxs)("li",{className:"flex items-center gap-2 text-sm",children:[(0,t.jsx)("span",{className:"inline-block w-2 h-2 rounded-full bg-green-500"}),(0,t.jsx)("span",{className:"text-slate-300",children:"Production-grade reliability"})]})]})]})]}),b&&(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("h3",{className:"card-header",children:"Detailed Performance Metrics"}),(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"Metric"}),(0,t.jsx)("th",{children:"Value"}),(0,t.jsx)("th",{children:"Unit"}),(0,t.jsx)("th",{children:"Status"})]})}),(0,t.jsxs)("tbody",{children:[(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{className:"font-semibold",children:"Single Operator (p50)"}),(0,t.jsx)("td",{className:"text-cyan-400 font-semibold",children:a.singleOperator.latency}),(0,t.jsx)("td",{children:"s"}),(0,t.jsx)("td",{children:(0,t.jsx)("span",{className:"metric-badge success",children:" Target Met"})})]}),(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{className:"font-semibold",children:"8-Operator Chain (p50)"}),(0,t.jsx)("td",{className:"text-cyan-400 font-semibold",children:a.eightOperatorChain.latency}),(0,t.jsx)("td",{children:"s"}),(0,t.jsx)("td",{children:(0,t.jsx)("span",{className:"metric-badge success",children:" Target Met"})})]}),(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{className:"font-semibold",children:"Throughput (sustained)"}),(0,t.jsxs)("td",{className:"text-cyan-400 font-semibold",children:[(a.throughput.opsPerSec/1e6).toFixed(2),"M"]}),(0,t.jsx)("td",{children:"ops/sec"}),(0,t.jsx)("td",{children:(0,t.jsx)("span",{className:"metric-badge success",children:" Target Met"})})]}),(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{className:"font-semibold",children:"Information Processing Rate"}),(0,t.jsxs)("td",{className:"text-cyan-400 font-semibold",children:[a.informationProcessing.rate,"M"]}),(0,t.jsx)("td",{children:"nats/sec"}),(0,t.jsx)("td",{children:(0,t.jsx)("span",{className:"metric-badge success",children:" Achieved"})})]})]})]})})]})]})}function eI({data:a}){let b=(0,u.useMemo)(()=>{let b=a.entropyReduction.stages;return{labels:b.map(a=>a.operator),datasets:[{label:"Entropy (nats)",data:[50,50-b[0].reduction,50-b[0].reduction-b[1].reduction,50-b.slice(0,2).reduce((a,b)=>a+b.reduction,0)-b[2].reduction,50-b.slice(0,3).reduce((a,b)=>a+b.reduction,0)-b[3].reduction,50-b.slice(0,4).reduce((a,b)=>a+b.reduction,0)-b[4].reduction,50-b.slice(0,5).reduce((a,b)=>a+b.reduction,0)-b[5].reduction,50-b.slice(0,6).reduce((a,b)=>a+b.reduction,0)-b[6].reduction,1],borderColor:"rgb(6, 182, 212)",backgroundColor:"rgba(6, 182, 212, 0.1)",borderWidth:3,fill:!0,tension:.4,pointRadius:6,pointBackgroundColor:"rgb(6, 182, 212)",pointBorderColor:"rgba(6, 182, 212, 0.8)",pointBorderWidth:2},{label:"Reduction per operator (nats)",data:b.map(a=>a.reduction),borderColor:"rgb(168, 85, 247)",backgroundColor:"rgba(168, 85, 247, 0.1)",borderWidth:2,yAxisID:"y1",tension:.4,pointRadius:4,pointBackgroundColor:"rgb(168, 85, 247)"}]}},[a]);return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("div",{className:"section-header",children:"Entropy Reduction Cascade"}),(0,t.jsx)("div",{className:"card",children:(0,t.jsx)("div",{className:"relative h-96",children:(0,t.jsx)(eE,{data:b,options:{responsive:!0,maintainAspectRatio:!0,interaction:{mode:"index",intersect:!1},plugins:{legend:{labels:{color:"#cbd5e1",font:{size:12}}},tooltip:{callbacks:{label:a=>"y1"===a.dataset.yAxisID?`Reduction: ${a.parsed.y.toFixed(1)} nats`:`Entropy: ${a.parsed.y.toFixed(1)} nats`}}},scales:{y:{position:"left",ticks:{color:"#94a3b8"},grid:{color:"rgba(148, 163, 184, 0.1)"},title:{display:!0,text:"Entropy (nats)",color:"#cbd5e1"}},y1:{position:"right",ticks:{color:"#94a3b8"},grid:{drawOnChartArea:!1},title:{display:!0,text:"Reduction (nats)",color:"#cbd5e1"}},x:{ticks:{color:"#94a3b8"},grid:{color:"rgba(148, 163, 184, 0.1)"}}}}})})}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("h3",{className:"card-header",children:"Stage-by-Stage Analysis"}),(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"Operator"}),(0,t.jsx)("th",{children:"Entropy In"}),(0,t.jsx)("th",{children:"Entropy Out"}),(0,t.jsx)("th",{children:"Reduction"})]})}),(0,t.jsxs)("tbody",{children:[(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:"4",className:"font-semibold text-xs text-slate-400 bg-slate-800",children:"Initial State"})}),a.entropyReduction.stages.map((a,b)=>(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{className:"font-mono font-bold text-cyan-400",children:a.operator}),(0,t.jsx)("td",{className:"font-semibold",children:a.entropy.split("  ")[0]}),(0,t.jsx)("td",{className:"font-semibold",children:a.entropy.split("  ")[1]}),(0,t.jsxs)("td",{className:"font-semibold text-green-400",children:[a.reduction," nats"]})]},a.operator))]})]})})]}),(0,t.jsxs)("div",{className:"card space-y-4",children:[(0,t.jsx)("h3",{className:"card-header",children:"Key Insights"}),(0,t.jsxs)("div",{className:"bg-slate-800/50 rounded p-3 space-y-2",children:[(0,t.jsx)("div",{className:"text-xs text-slate-400 uppercase font-semibold",children:"Total Compression"}),(0,t.jsx)("div",{className:"text-3xl font-bold text-cyan-400",children:"49 nats"}),(0,t.jsx)("div",{className:"text-xs text-slate-400",children:"From 50 initial  1 observable"})]}),(0,t.jsxs)("div",{className:"bg-slate-800/50 rounded p-3 space-y-2",children:[(0,t.jsx)("div",{className:"text-xs text-slate-400 uppercase font-semibold",children:"Average Reduction"}),(0,t.jsx)("div",{className:"text-3xl font-bold text-purple-400",children:"6.1 nats"}),(0,t.jsx)("div",{className:"text-xs text-slate-400",children:"Per operator (49  8)"})]}),(0,t.jsxs)("div",{className:"bg-slate-800/50 rounded p-3 space-y-2",children:[(0,t.jsx)("div",{className:"text-xs text-slate-400 uppercase font-semibold",children:"Information Loss"}),(0,t.jsx)("div",{className:"text-2xl font-bold text-orange-400",children:"98%"}),(0,t.jsx)("div",{className:"text-xs text-slate-400",children:"Irreversibly lost to causally-unreachable space"})]}),(0,t.jsx)("p",{className:"text-sm text-slate-400 border-l-2 border-cyan-500 pl-3",children:"The entropy cascade demonstrates that transforming intent to observable outcome requires progressive information reduction. Some information is irreversibly lost, making opacity a mathematical inevitability."})]})]})]})}function eJ({data:a}){return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("div",{className:"section-header",children:"Information Theory Analysis"}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("h3",{className:"card-header",children:"Shannon Entropy Compression"}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex justify-between items-baseline mb-2",children:[(0,t.jsx)("span",{className:"text-sm text-slate-400",children:"User Intent ()"}),(0,t.jsx)("span",{className:"text-2xl font-bold text-orange-400",children:"50 nats"})]}),(0,t.jsx)("div",{className:"relative h-2 bg-slate-800 rounded-full overflow-hidden",children:(0,t.jsx)("div",{className:"h-full bg-gradient-to-r from-orange-500 to-red-500 rounded-full w-full"})})]}),(0,t.jsx)("div",{className:"text-center text-slate-400 text-sm",children:" Transform "}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex justify-between items-baseline mb-2",children:[(0,t.jsx)("span",{className:"text-sm text-slate-400",children:"Observable Outcome (A)"}),(0,t.jsx)("span",{className:"text-2xl font-bold text-green-400",children:"1 nat"})]}),(0,t.jsx)("div",{className:"relative h-2 bg-slate-800 rounded-full overflow-hidden",children:(0,t.jsx)("div",{className:"h-full bg-gradient-to-r from-green-500 to-cyan-500 rounded-full w-1"})})]})]})]}),(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("h3",{className:"card-header",children:"Mutual Information"}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"bg-slate-800/50 rounded p-4",children:[(0,t.jsx)("div",{className:"text-xs text-slate-400 uppercase mb-1",children:"I(; A)"}),(0,t.jsx)("div",{className:"text-4xl font-bold text-cyan-400",children:" 49 nats"}),(0,t.jsx)("div",{className:"text-xs text-slate-300 mt-2",children:"Information shared between intent and observable outcomes"})]}),(0,t.jsxs)("div",{className:"text-sm text-slate-400 space-y-1",children:[(0,t.jsx)("p",{children:" 98% of user intent influences observable outcomes"}),(0,t.jsx)("p",{children:" 2% irreversibly lost to causally-unreachable space"}),(0,t.jsx)("p",{children:" High determinism: most intent maps to measurable behavior"})]})]})]}),(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("h3",{className:"card-header",children:"Channel Capacity Constraint"}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"bg-slate-800/50 rounded p-4",children:[(0,t.jsx)("div",{className:"text-xs text-slate-400 uppercase mb-1",children:"C (per operator)"}),(0,t.jsx)("div",{className:"text-4xl font-bold text-purple-400",children:"6.1 nats"}),(0,t.jsx)("div",{className:"text-xs text-slate-300 mt-2",children:"Maximum information transfer per operator"})]}),(0,t.jsxs)("div",{className:"bg-slate-800/50 rounded p-4",children:[(0,t.jsx)("div",{className:"text-xs text-slate-400 uppercase mb-1",children:"Minimum Operators Required"}),(0,t.jsx)("div",{className:"text-2xl font-bold text-blue-400",children:"n_min  8.11  8"}),(0,t.jsx)("div",{className:"text-xs text-slate-300 mt-2",children:"Formula: n_min  (H() - H(A)) / C_max"}),(0,t.jsx)("div",{className:"text-xs text-slate-400 mt-2",children:"= (50 - 1) / 6.1  8.11"})]})]})]}),(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("h3",{className:"card-header",children:"Theoretical Implications"}),(0,t.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,t.jsxs)("div",{className:"border-l-2 border-cyan-500 pl-3 py-2",children:[(0,t.jsx)("div",{className:"font-semibold text-slate-200",children:"Opacity is Mathematical Inevitable"}),(0,t.jsx)("p",{className:"text-slate-400",children:"Some information must be irreversibly lost due to channel capacity limits."})]}),(0,t.jsxs)("div",{className:"border-l-2 border-blue-500 pl-3 py-2",children:[(0,t.jsx)("div",{className:"font-semibold text-slate-200",children:"Operator Necessity"}),(0,t.jsx)("p",{className:"text-slate-400",children:"Cannot compress 501 nats with fewer than 8 operators given 6.1 nat capacity."})]}),(0,t.jsxs)("div",{className:"border-l-2 border-purple-500 pl-3 py-2",children:[(0,t.jsx)("div",{className:"font-semibold text-slate-200",children:"Operator Sufficiency"}),(0,t.jsx)("p",{className:"text-slate-400",children:"8 operators empirically sufficient across all use cases with no additional benefit."})]})]})]})]})]})}function eK({data:a}){let b=(0,u.useMemo)(()=>{let b=a.fmea.topRisks;return{labels:b.map(a=>a.name),datasets:[{label:"RPN Before Mitigation",data:b.map(a=>a.before),backgroundColor:"rgba(239, 68, 68, 0.7)",borderColor:"rgb(239, 68, 68)",borderWidth:2},{label:"RPN After Mitigation",data:b.map(a=>a.after),backgroundColor:"rgba(34, 197, 94, 0.7)",borderColor:"rgb(34, 197, 94)",borderWidth:2}]}},[a]);return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("div",{className:"section-header",children:"FMEA Risk Analysis"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("div",{className:"text-xs text-slate-400 uppercase",children:"Total Failure Modes"}),(0,t.jsx)("div",{className:"text-3xl font-bold text-cyan-400 mt-2",children:a.fmea.totalFailureModes}),(0,t.jsx)("div",{className:"text-xs text-slate-500 mt-1",children:"Identified and analyzed"})]}),(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("div",{className:"text-xs text-slate-400 uppercase",children:"RPN Reduction"}),(0,t.jsxs)("div",{className:"text-3xl font-bold text-green-400 mt-2",children:[a.fmea.riskReduction,"%"]}),(0,t.jsx)("div",{className:"text-xs text-slate-500 mt-1",children:"Average risk decrease"})]}),(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("div",{className:"text-xs text-slate-400 uppercase",children:"Risk Categories"}),(0,t.jsx)("div",{className:"text-3xl font-bold text-purple-400 mt-2",children:a.fmea.categories}),(0,t.jsx)("div",{className:"text-xs text-slate-500 mt-1",children:"Mitigation strategies applied"})]})]}),(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("h3",{className:"card-header",children:"Top 5 Risk Priority Numbers (RPN)"}),(0,t.jsx)("div",{className:"relative h-80",children:(0,t.jsx)(eF,{data:b,options:{responsive:!0,maintainAspectRatio:!0,indexAxis:"y",plugins:{legend:{labels:{color:"#cbd5e1",font:{size:12}}},tooltip:{callbacks:{label:a=>`RPN: ${a.parsed.x}`}}},scales:{x:{ticks:{color:"#94a3b8"},grid:{color:"rgba(148, 163, 184, 0.1)"}},y:{ticks:{color:"#94a3b8"},grid:{display:!1}}}}})})]}),(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("h3",{className:"card-header",children:"Failure Mode Risk Assessment"}),(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"ID"}),(0,t.jsx)("th",{children:"Failure Mode"}),(0,t.jsx)("th",{children:"RPN Before"}),(0,t.jsx)("th",{children:"RPN After"}),(0,t.jsx)("th",{children:"Reduction"}),(0,t.jsx)("th",{children:"Mitigation Status"})]})}),(0,t.jsx)("tbody",{children:a.fmea.topRisks.map(a=>{let b=((a.before-a.after)/a.before*100).toFixed(0);return(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{className:"font-mono font-bold text-cyan-400",children:a.id}),(0,t.jsx)("td",{className:"font-semibold",children:a.name}),(0,t.jsx)("td",{className:"text-red-400 font-bold",children:a.before}),(0,t.jsx)("td",{className:"text-green-400 font-bold",children:a.after}),(0,t.jsxs)("td",{className:"text-green-400 font-semibold",children:[b,"%"]}),(0,t.jsx)("td",{children:(0,t.jsx)("span",{className:"metric-badge success",children:" Implemented"})})]},a.id)})})]})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("h3",{className:"card-header",children:"Parse-Time Mitigations"}),(0,t.jsxs)("ul",{className:"space-y-2 text-sm",children:[(0,t.jsxs)("li",{className:"flex gap-2",children:[(0,t.jsx)("span",{className:"inline-block w-1.5 h-1.5 rounded-full bg-cyan-400 mt-1.5"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-semibold text-slate-200",children:"Operator-Threshold Validation"}),(0,t.jsx)("div",{className:"text-xs text-slate-400",children:"Prevent invalid operator/threshold combinations"})]})]}),(0,t.jsxs)("li",{className:"flex gap-2",children:[(0,t.jsx)("span",{className:"inline-block w-1.5 h-1.5 rounded-full bg-cyan-400 mt-1.5"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-semibold text-slate-200",children:"Cron Expression Validation"}),(0,t.jsx)("div",{className:"text-xs text-slate-400",children:"Strict validation of scheduling expressions"})]})]}),(0,t.jsxs)("li",{className:"flex gap-2",children:[(0,t.jsx)("span",{className:"inline-block w-1.5 h-1.5 rounded-full bg-cyan-400 mt-1.5"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-semibold text-slate-200",children:"Interval Bounds Validation"}),(0,t.jsx)("div",{className:"text-xs text-slate-400",children:"Enforce safe timing constraints (10ms - 24hrs)"})]})]})]})]}),(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("h3",{className:"card-header",children:"Runtime Guards"}),(0,t.jsxs)("ul",{className:"space-y-2 text-sm",children:[(0,t.jsxs)("li",{className:"flex gap-2",children:[(0,t.jsx)("span",{className:"inline-block w-1.5 h-1.5 rounded-full bg-green-400 mt-1.5"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-semibold text-slate-200",children:"Non-Boolean Validation Guard"}),(0,t.jsx)("div",{className:"text-xs text-slate-400",children:"Coerce and warn on non-boolean validation returns"})]})]}),(0,t.jsxs)("li",{className:"flex gap-2",children:[(0,t.jsx)("span",{className:"inline-block w-1.5 h-1.5 rounded-full bg-green-400 mt-1.5"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-semibold text-slate-200",children:"Recursive Execution Guard"}),(0,t.jsx)("div",{className:"text-xs text-slate-400",children:"Prevent nested hook executions"})]})]}),(0,t.jsxs)("li",{className:"flex gap-2",children:[(0,t.jsx)("span",{className:"inline-block w-1.5 h-1.5 rounded-full bg-green-400 mt-1.5"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-semibold text-slate-200",children:"Stack Trace Preservation"}),(0,t.jsx)("div",{className:"text-xs text-slate-400",children:"Maintain error context through hook chains"})]})]})]})]})]})]})}function eL({data:a}){let b=(0,u.useMemo)(()=>({datasets:[{label:"JTBD Scenarios",data:a.jtbd.map(a=>({x:a.latency,y:a.reduction,label:a.name})),backgroundColor:"rgba(6, 182, 212, 0.7)",borderColor:"rgb(6, 182, 212)",borderWidth:2,pointRadius:8,pointHoverRadius:10}]}),[a]),c=(a.jtbd.reduce((a,b)=>a+b.latency,0)/a.jtbd.length).toFixed(2),d=(a.jtbd.reduce((a,b)=>a+b.reduction,0)/a.jtbd.length).toFixed(1);return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("div",{className:"section-header",children:"Jobs-To-Be-Done (JTBD) Validation"}),(0,t.jsx)("p",{className:"text-slate-400 text-sm max-w-2xl",children:"Customer-centric scenarios validating that the (O) calculus framework meets real-world e-commerce use cases. Each scenario demonstrates intent-to-outcome transformation with measurable latency and entropy reduction."}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("div",{className:"text-xs text-slate-400 uppercase",children:"Total Scenarios"}),(0,t.jsx)("div",{className:"text-3xl font-bold text-cyan-400 mt-2",children:a.jtbd.length}),(0,t.jsx)("div",{className:"text-xs text-slate-500 mt-1",children:"Validated use cases"})]}),(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("div",{className:"text-xs text-slate-400 uppercase",children:"Avg Latency"}),(0,t.jsx)("div",{className:"text-3xl font-bold text-cyan-400 mt-2",children:c}),(0,t.jsx)("div",{className:"text-xs text-slate-500 mt-1",children:"s per scenario"})]}),(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("div",{className:"text-xs text-slate-400 uppercase",children:"Avg Entropy "}),(0,t.jsx)("div",{className:"text-3xl font-bold text-cyan-400 mt-2",children:d}),(0,t.jsx)("div",{className:"text-xs text-slate-500 mt-1",children:"nats reduction"})]}),(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("div",{className:"text-xs text-slate-400 uppercase",children:"Success Rate"}),(0,t.jsx)("div",{className:"text-3xl font-bold text-green-400 mt-2",children:"100%"}),(0,t.jsx)("div",{className:"text-xs text-slate-500 mt-1",children:"All scenarios passing"})]})]}),(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("h3",{className:"card-header",children:"Latency vs. Entropy Reduction"}),(0,t.jsx)("div",{className:"relative h-80",children:(0,t.jsx)(eG,{data:b,options:{responsive:!0,maintainAspectRatio:!0,plugins:{legend:{labels:{color:"#cbd5e1",font:{size:12}}},tooltip:{callbacks:{label:a=>{let b=a.raw;return`${b.label}: ${b.x.toFixed(2)} s, ${b.y.toFixed(1)} nats`}}}},scales:{x:{type:"linear",position:"bottom",ticks:{color:"#94a3b8"},grid:{color:"rgba(148, 163, 184, 0.1)"},title:{display:!0,text:"Latency (s)",color:"#cbd5e1"}},y:{ticks:{color:"#94a3b8"},grid:{color:"rgba(148, 163, 184, 0.1)"},title:{display:!0,text:"Entropy Reduction (nats)",color:"#cbd5e1"}}}}})})]}),(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("h3",{className:"card-header",children:"Scenario Details"}),(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"JTBD ID"}),(0,t.jsx)("th",{children:"Scenario"}),(0,t.jsx)("th",{children:"Latency (s)"}),(0,t.jsx)("th",{children:"Entropy Reduction (nats)"}),(0,t.jsx)("th",{children:"Status"})]})}),(0,t.jsx)("tbody",{children:a.jtbd.map(a=>(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{className:"font-mono font-bold text-cyan-400",children:a.id}),(0,t.jsx)("td",{className:"font-semibold",children:a.name}),(0,t.jsx)("td",{className:"text-cyan-400 font-semibold",children:a.latency}),(0,t.jsx)("td",{className:"text-green-400 font-semibold",children:a.reduction.toFixed(1)}),(0,t.jsx)("td",{children:(0,t.jsx)("span",{className:"metric-badge success",children:" Passing"})})]},a.id))})]})})]}),(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("h3",{className:"card-header",children:"JTBD Methodology"}),(0,t.jsx)("p",{className:"text-sm text-slate-400 mb-4",children:"Jobs-To-Be-Done is a customer-centric methodology that focuses on understanding what customers are trying to accomplish. Each scenario represents a distinct job that our framework must successfully support."}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"bg-slate-800/50 rounded p-4 space-y-2",children:[(0,t.jsx)("div",{className:"font-semibold text-slate-200",children:"Transactional Jobs"}),(0,t.jsxs)("ul",{className:"text-xs text-slate-400 space-y-1",children:[(0,t.jsx)("li",{children:" Order fulfillment validation"}),(0,t.jsx)("li",{children:" Shipping address verification"}),(0,t.jsx)("li",{children:" Account consistency maintenance"})]})]}),(0,t.jsxs)("div",{className:"bg-slate-800/50 rounded p-4 space-y-2",children:[(0,t.jsx)("div",{className:"font-semibold text-slate-200",children:"Operational Jobs"}),(0,t.jsxs)("ul",{className:"text-xs text-slate-400 space-y-1",children:[(0,t.jsx)("li",{children:" Recurring purchase automation"}),(0,t.jsx)("li",{children:" Listing compliance checking"}),(0,t.jsx)("li",{children:" Bulk update processing"})]})]})]})]})]})}function eM({data:a}){let b=[{id:"",name:"Subject IRI Validation",purpose:"Validate subject term is valid RDF Named Node",complexity:"O(1)",successRate:"99.2%"},{id:"",name:"Predicate IRI Validation",purpose:"Enforce predicate term is RDF property URI",complexity:"O(1)",successRate:"98.8%"},{id:"",name:"Object Type Checking",purpose:"Validate object matches expected RDF term type",complexity:"O(1)",successRate:"97.1%"},{id:"",name:"Graph Resolution",purpose:"Bind quad to named graph or default graph",complexity:"O(1)",successRate:"99.5%"},{id:"",name:"Semantic Validation",purpose:"Enforce ontology constraints and domain rules",complexity:"O(log n)",successRate:"96.3%"},{id:"",name:"Transform Rules Application",purpose:"Apply quad transformations (term rewriting)",complexity:"O(n)",successRate:"94.7%"},{id:"",name:"Notification Emission",purpose:"Emit change signals for subscribers",complexity:"O(m)",successRate:"99.9%"},{id:"",name:"Outcome Observation",purpose:"Crystallize final observable state",complexity:"O(1)",successRate:"100%"}];return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("div",{className:"section-header",children:"Operator Cardinality & Information Flow"}),(0,t.jsx)("p",{className:"text-slate-400 text-sm max-w-2xl",children:"The (O) calculus defines 8 information-theoretic operators necessary and sufficient to transform user intent into deterministic outcomes. Each operator reduces entropy and serves a distinct semantic function."}),(0,t.jsxs)("div",{className:"card overflow-x-auto",children:[(0,t.jsx)("h3",{className:"card-header",children:"Operator Details"}),(0,t.jsxs)("table",{children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"Operator"}),(0,t.jsx)("th",{children:"Name"}),(0,t.jsx)("th",{children:"Purpose"}),(0,t.jsx)("th",{children:"Complexity"}),(0,t.jsx)("th",{children:"Success Rate"})]})}),(0,t.jsx)("tbody",{children:b.map(a=>(0,t.jsxs)("tr",{children:[(0,t.jsx)("td",{className:"font-mono font-bold text-cyan-400",children:a.id}),(0,t.jsx)("td",{className:"font-semibold",children:a.name}),(0,t.jsx)("td",{className:"text-sm text-slate-400",children:a.purpose}),(0,t.jsx)("td",{className:"font-mono text-sm",children:a.complexity}),(0,t.jsx)("td",{className:"text-green-400 font-semibold",children:a.successRate})]},a.id))})]})]}),(0,t.jsxs)("div",{className:"card space-y-4",children:[(0,t.jsx)("h3",{className:"card-header",children:"Operator Cardinality Theorem"}),(0,t.jsxs)("div",{className:"space-y-4 text-sm",children:[(0,t.jsx)("p",{className:"text-slate-400",children:"The number of operators required to transform user intent into observable outcomes is both information-theoretically necessary and empirically sufficient at exactly 8."}),(0,t.jsxs)("div",{className:"bg-slate-800/50 border border-slate-700 rounded-lg p-4 space-y-3 font-mono text-cyan-400 text-sm",children:[(0,t.jsx)("p",{className:"text-cyan-300",children:"n_min  (H() - H(A)) / C_max"}),(0,t.jsx)("p",{className:"text-cyan-300",children:"n_min  (50 - 1) / 6.1"}),(0,t.jsx)("p",{className:"text-green-400",children:"n_min  8.11  8 operators (necessary)"})]}),(0,t.jsxs)("p",{className:"text-slate-300 border-t border-slate-700 pt-3",children:[(0,t.jsx)("span",{className:"font-semibold",children:"Given:"})," H() = 50 nats (user intent entropy), H(A) = 1 nat (observable outcome entropy), C_max = 6.1 nats/operator (maximum channel capacity per operator)"]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("div",{className:"text-sm text-slate-400 uppercase tracking-wider mb-2",children:"Total Information Loss"}),(0,t.jsx)("div",{className:"text-2xl font-bold text-cyan-400",children:"49 nats"}),(0,t.jsx)("div",{className:"text-xs text-slate-400 mt-2",children:"50 initial  1 observable"})]}),(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("div",{className:"text-sm text-slate-400 uppercase tracking-wider mb-2",children:"Avg Reduction/Operator"}),(0,t.jsx)("div",{className:"text-2xl font-bold text-cyan-400",children:"6.1 nats"}),(0,t.jsx)("div",{className:"text-xs text-slate-400 mt-2",children:"49  8 operators"})]}),(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("div",{className:"text-sm text-slate-400 uppercase tracking-wider mb-2",children:"Determinism Guarantee"}),(0,t.jsx)("div",{className:"text-2xl font-bold text-green-400",children:"100%"}),(0,t.jsx)("div",{className:"text-xs text-slate-400 mt-2",children:"Per-operator reproducibility"})]})]}),(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("h3",{className:"card-header",children:"Information Flow Through Operator Chain"}),(0,t.jsx)("div",{className:"space-y-2",children:a.entropyReduction.stages.map((c,d)=>(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:"flex items-center gap-4 mb-1",children:[(0,t.jsx)("span",{className:"font-mono font-bold text-cyan-400 w-8",children:c.operator}),(0,t.jsx)("span",{className:"font-semibold flex-1",children:b[d]?.name||`Operator ${d+1}`}),(0,t.jsx)("span",{className:"text-sm text-slate-400 w-24 text-right",children:c.entropy})]}),(0,t.jsxs)("div",{className:"ml-12 h-6 bg-gradient-to-r from-cyan-500/20 to-blue-500/20 rounded border border-slate-700 flex items-center px-2 text-xs font-mono text-cyan-300",children:[" ",c.reduction," nats"]}),d<a.entropyReduction.stages.length-1&&(0,t.jsx)("div",{className:"ml-12 h-8 flex items-center justify-center text-slate-500",children:""})]},c.operator))})]}),(0,t.jsxs)("div",{className:"card space-y-4",children:[(0,t.jsx)("h3",{className:"card-header",children:"Theoretical Implications"}),(0,t.jsxs)("div",{className:"border-l-2 border-cyan-500 pl-4",children:[(0,t.jsx)("p",{className:"font-semibold text-slate-200 mb-1",children:"Information Channel Capacity"}),(0,t.jsx)("p",{className:"text-slate-400 text-sm",children:"Each operator has theoretical channel capacity C_i  6.1 nats. Some information is irreversibly lost (diverges to causally-unreachable space), proving opacity is mathematically inevitable."})]}),(0,t.jsxs)("div",{className:"border-l-2 border-blue-500 pl-4",children:[(0,t.jsx)("p",{className:"font-semibold text-slate-200 mb-1",children:"Operator Necessity"}),(0,t.jsx)("p",{className:"text-slate-400 text-sm",children:"Cannot achieve 501 nat compression with fewer than 8 operators given 6.1 nat/operator limit. Fewer operators means some information must be arbitrarily discarded (non-determinism)."})]}),(0,t.jsxs)("div",{className:"border-l-2 border-purple-500 pl-4",children:[(0,t.jsx)("p",{className:"font-semibold text-slate-200 mb-1",children:"Operator Sufficiency"}),(0,t.jsx)("p",{className:"text-slate-400 text-sm",children:"8 operators empirically sufficient across all JTBD scenarios. No additional operators needed; additional operators would merely re-compress already-compressed information with diminishing returns."})]})]})]})}dl.register(ec,ef,dA,dy,dG,d$,ea,dY,dU),dl.register(ec,ef,dA,dy,d$,ea,dY,dU),dl.register(ec,ef,dG,d$,ea,dY),dl.register(ef,dA,d$,ea,dY);let eN=1,eO=1;class eP{time=0;channels=new Map;animations=new Map;playing=!1;lastEngineTime=-1;constructor(){}addChannel(a){let{delay:b=0,duration:c=1/0,rate:d=1,repeat:e=1}=a,f=eN++,g={time:0,delay:b,duration:c,rate:d,repeat:e};return this._setChannelTime(g,this.time),this.channels.set(f,g),f}removeChannel(a){for(let[b,c]of(this.channels.delete(a),this.animations))c.channel===a&&this.detachAnimation(b)}isFinished(a){let b=this.channels.get(a);return void 0!==b&&this.time>=b.delay+b.duration*b.repeat}getTime(a){if(void 0===a)return this.time;let b=this.channels.get(a);return void 0===b?-1:b.time}setTime(a){for(let b of(this.time=Math.max(0,a),this.channels.values()))this._setChannelTime(b,this.time);for(let a of this.animations.values()){let{animation:b,channel:c}=a;b.setTime(this.getTime(c))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(a,b){let c=eO++;return this.animations.set(c,{animation:a,channel:b}),a.setTime(this.getTime(b)),c}detachAnimation(a){this.animations.delete(a)}update(a){this.playing&&(-1===this.lastEngineTime&&(this.lastEngineTime=a),this.setTime(this.time+(a-this.lastEngineTime)),this.lastEngineTime=a)}_setChannelTime(a,b){let c=b-a.delay;c>=a.duration*a.repeat?a.time=a.duration*a.rate:(a.time=Math.max(0,c)%a.duration,a.time*=a.rate)}}function eQ(a,b){if(!a)throw Error(b||"shadertools: assertion failed.")}let eR={number:{type:"number",validate:(a,b)=>Number.isFinite(a)&&"object"==typeof b&&(void 0===b.max||a<=b.max)&&(void 0===b.min||a>=b.min)},array:{type:"array",validate:(a,b)=>Array.isArray(a)||ArrayBuffer.isView(a)}};function eS(a){return Array.isArray(a)||ArrayBuffer.isView(a)?"array":typeof a}let eT={vertex:`\
#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,fragment:`\
#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`},eU=/void\s+main\s*\([^)]*\)\s*\{\n?/,eV=/}\n?[^{}]*$/,eW=[],eX="__LUMA_INJECT_DECLARATIONS__";function eY(a,b,c,d=!1){let e="vertex"===b;for(let b in c){let d=c[b];d.sort((a,b)=>a.order-b.order),eW.length=d.length;for(let a=0,b=d.length;a<b;++a)eW[a]=d[a].injection;let f=`${eW.join("\n")}
`;switch(b){case"vs:#decl":e&&(a=a.replace(eX,f));break;case"vs:#main-start":e&&(a=a.replace(eU,a=>a+f));break;case"vs:#main-end":e&&(a=a.replace(eV,a=>f+a));break;case"fs:#decl":e||(a=a.replace(eX,f));break;case"fs:#main-start":e||(a=a.replace(eU,a=>a+f));break;case"fs:#main-end":e||(a=a.replace(eV,a=>f+a));break;default:a=a.replace(b,a=>a+f)}}return a=a.replace(eX,""),d&&(a=a.replace(/\}\s*$/,a=>a+eT[b])),a}function eZ(a){a.map(a=>(function(a){var b;if(a.instance)return;eZ(a.dependencies||[]);let{propTypes:c={},deprecations:d=[],inject:e={}}=a,f={normalizedInjections:function(a){let b={vertex:{},fragment:{}};for(let c in a){let d=a[c];"string"==typeof d&&(d={order:0,injection:d}),b[function(a){let b=a.slice(0,2);switch(b){case"vs":return"vertex";case"fs":return"fragment";default:throw Error(b)}}(c)][c]=d}return b}(e),parsedDeprecations:((b=d).forEach(a=>{"function"===a.type?a.regex=RegExp(`\\b${a.old}\\(`):a.regex=RegExp(`${a.type} ${a.old};`)}),b)};c&&(f.propValidators=function(a){let b={};for(let[c,d]of Object.entries(a))b[c]=function(a){let b=eS(a);if("object"!==b)return{value:a,...eR[b],type:b};if("object"==typeof a)return a?void 0!==a.type?{...a,...eR[a.type],type:a.type}:void 0===a.value?{type:"object",value:a}:(b=eS(a.value),{...a,...eR[b],type:b}):{type:"object",value:null};throw Error("props")}(d);return b}(c)),a.instance=f;let g={};c&&(g=Object.entries(c).reduce((a,[b,c])=>{let d=c?.value;return d&&(a[b]=d),a},{})),a.defaultUniforms={...a.defaultUniforms,...g}})(a))}function e$(a,b,c){a.deprecations?.forEach(a=>{a.regex?.test(b)&&(a.deprecated?c.deprecated(a.old,a.new)():c.removed(a.old,a.new)())})}function e_(a){eZ(a);let b={},c={};!function a(b){let{modules:c,level:d,moduleMap:e,moduleDepth:f}=b;if(d>=5)throw Error("Possible loop in shader dependency graph");for(let a of c)e[a.name]=a,(void 0===f[a.name]||f[a.name]<d)&&(f[a.name]=d);for(let b of c)b.dependencies&&a({modules:b.dependencies,level:d+1,moduleMap:e,moduleDepth:f})}({modules:a,level:0,moduleMap:b,moduleDepth:c});let d=Object.keys(c).sort((a,b)=>c[b]-c[a]).map(a=>b[a]);return eZ(d),d}let e0=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,"#version 300 es\n"],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],e1=[...e0,[e4("attribute"),"in $1"],[e4("varying"),"out $1"]],e2=[...e0,[e4("varying"),"in $1"]];function e3(a,b){for(let[c,d]of b)a=a.replace(c,d);return a}function e4(a){return RegExp(`\\b${a}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function e5(a,b){let c="";for(let d in a){let e=a[d];if(c+=`void ${e.signature} {
`,e.header&&(c+=`  ${e.header}`),b[d]){let a=b[d];for(let b of(a.sort((a,b)=>a.order-b.order),a))c+=`  ${b.injection}
`}e.footer&&(c+=`  ${e.footer}`),c+="}\n"}return c}function e6(a){let b={vertex:{},fragment:{}};for(let c of a){let a,d;"string"!=typeof c?d=(a=c).hook:(a={},d=c);let[e,f]=(d=d.trim()).split(":"),g=d.replace(/\(.+/,""),h=Object.assign(a,{signature:f});switch(e){case"vs":b.vertex[g]=h;break;case"fs":b.fragment[g]=h;break;default:throw Error(e)}}return b}let e7=`

${eX}
`,e8=`\
precision highp float;
`;function e9(a,b){let{source:c,stage:d,language:e="glsl",modules:f,defines:g={},hookFunctions:h=[],inject:i={},prologue:j=!0,log:k}=b;eQ("string"==typeof c,"shader source must be a string");let l="glsl"===e?({name:function(a,b="unnamed"){let c=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(a);return c?c[1]:b}(c,void 0),language:"glsl",version:function(a){let b=100,c=a.match(/[^\s]+/g);if(c&&c.length>=2&&"#version"===c[0]){let a=parseInt(c[1],10);Number.isFinite(a)&&(b=a)}if(100!==b&&300!==b)throw Error(`Invalid GLSL version ${b}`);return b}(c)}).version:-1,n=a.shaderLanguageVersion,o=100===l?"#version 100":"#version 300 es",p=c.split("\n").slice(1).join("\n"),q={};f.forEach(a=>{Object.assign(q,a.defines)}),Object.assign(q,g);let r="";switch(e){case"wgsl":break;case"glsl":r=j?`\
${o}

// ----- PROLOGUE -------------------------
#define SHADER_TYPE_${d.toUpperCase()}

${function(a){switch(a?.gpu.toLowerCase()){case"apple":return`\
#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`\
#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`\
#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`\
#define AMD_GPU
`;default:return`\
#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}(a)}
${"fragment"===d?e8:""}

// ----- APPLICATION DEFINES -------------------------

${function(a={}){let b="";for(let c in a){let d=a[c];(d||Number.isFinite(d))&&(b+=`#define ${c.toUpperCase()} ${a[c]}
`)}return b}(q)}

`:`${o}
`}let s=e6(h),t={},u={},v={};for(let a in i){let b="string"==typeof i[a]?{injection:i[a],order:0}:i[a],c=/^(v|f)s:(#)?([\w-]+)$/.exec(a);if(c){let d=c[2],e=c[3];d?"decl"===e?u[a]=[b]:v[a]=[b]:t[a]=[b]}else v[a]=[b]}for(let a of f){k&&e$(a,p,k),r+=fb(a,d);let b=a.instance?.normalizedInjections[d]||{};for(let a in b){let c=/^(v|f)s:#([\w-]+)$/.exec(a);if(c){let d="decl"===c[2]?u:v;d[a]=d[a]||[],d[a].push(b[a])}else t[a]=t[a]||[],t[a].push(b[a])}}return r+="// ----- MAIN SHADER SOURCE -------------------------",r+=e7,r=eY(r,d,u)+e5(s[d],t)+p,r=eY(r,d,v),"glsl"===e&&l!==n&&(r=function(a,b){if(300!==Number(a.match(/^#version[ \t]+(\d+)/m)?.[1]||100))throw Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(b){case"vertex":return e3(a,e1);case"fragment":return e3(a,e2);default:throw Error(b)}}(r,d)),r.trim()}function fa(a){return function(b){let c={};for(let d of a){let a=d.getUniforms?.(b,c);Object.assign(c,a)}return c}}function fb(a,b){let c;switch(b){case"vertex":c=a.vs||"";break;case"fragment":c=a.fs||"";break;case"wgsl":c=a.source||"";break;default:eQ(!1)}if(!a.name)throw Error("Shader module must have a name");let d=a.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),e=`\
// ----- MODULE ${a.name} ---------------

`;return"wgsl"!==b&&(e+=`#define MODULE_${d}
`),e+=`${c}
`}let fc=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,fd=/^\s*\#\s*endif\s*$/;class fe{static defaultShaderAssembler;_hookFunctions=[];_defaultModules=[];static getDefaultShaderAssembler(){return fe.defaultShaderAssembler=fe.defaultShaderAssembler||new fe,fe.defaultShaderAssembler}addDefaultModule(a){this._defaultModules.find(b=>b.name===("string"==typeof a?a:a.name))||this._defaultModules.push(a)}removeDefaultModule(a){let b="string"==typeof a?a:a.name;this._defaultModules=this._defaultModules.filter(a=>a.name!==b)}addShaderHook(a,b){b&&(a=Object.assign(b,{hook:a})),this._hookFunctions.push(a)}assembleWGSLShader(a){var b;let c,d=this._getModuleList(a.modules),e=this._hookFunctions,{source:f,getUniforms:g}=(c=e_((b={...a,source:a.source,modules:d,hookFunctions:e}).modules||[]),{source:function(a,b){let{source:c,stage:d,modules:e,hookFunctions:f=[],inject:g={},log:h}=b;eQ("string"==typeof c,"shader source must be a string");let i="",j=e6(f),k={},l={},n={};for(let a in g){let b="string"==typeof g[a]?{injection:g[a],order:0}:g[a],c=/^(v|f)s:(#)?([\w-]+)$/.exec(a);if(c){let d=c[2],e=c[3];d?"decl"===e?l[a]=[b]:n[a]=[b]:k[a]=[b]}else n[a]=[b]}for(let a of e){h&&e$(a,c,h),i+=fb(a,"wgsl");let b=a.injections?.[d]||{};for(let a in b){let c=/^(v|f)s:#([\w-]+)$/.exec(a);if(c){let d="decl"===c[2]?l:n;d[a]=d[a]||[],d[a].push(b[a])}else k[a]=k[a]||[],k[a].push(b[a])}}return i+=e7,i=eY(i,d,l)+e5(j[d],k)+c,i=eY(i,d,n)}(b.platformInfo,{...b,source:b.source,stage:"vertex",modules:c}),getUniforms:fa(c)});return{source:"wgsl"===a.platformInfo.shaderLanguage?function(a,b){let c=a.split("\n"),d=[],e=!0;for(let a of c){let b=a.match(fc),c=a.match(fd);b?(b[1],e=!1):c?e=!0:e&&d.push(a)}return d.join("\n")}(f):f,getUniforms:g,modules:d}}assembleGLSLShaderPair(a){let b=this._getModuleList(a.modules),c=this._hookFunctions;return{...function(a){let{vs:b,fs:c}=a,d=e_(a.modules||[]);return{vs:e9(a.platformInfo,{...a,source:b,stage:"vertex",modules:d}),fs:e9(a.platformInfo,{...a,source:c,stage:"fragment",modules:d}),getUniforms:fa(d)}}({...a,vs:a.vs,fs:a.fs,modules:b,hookFunctions:c}),modules:b}}_getModuleList(a=[]){let b=Array(this._defaultModules.length+a.length),c={},d=0;for(let a=0,e=this._defaultModules.length;a<e;++a){let e=this._defaultModules[a],f=e.name;b[d++]=e,c[f]=!0}for(let e=0,f=a.length;e<f;++e){let f=a[e],g=f.name;c[g]||(b[d++]=f,c[g]=!0)}return b.length=d,eZ(b),b}}var ff=a.i(96893);let fg=`\
precision highp int;

// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  vec3 color;
};

struct PointLight {
  vec3 color;
  vec3 position;
  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform lightingUniforms {
  int enabled;
  int lightType;

  int directionalLightCount;
  int pointLightCount;

  vec3 ambientColor;

  vec3 lightColor0;
  vec3 lightPosition0;
  vec3 lightDirection0;
  vec3 lightAttenuation0;

  vec3 lightColor1;
  vec3 lightPosition1;
  vec3 lightDirection1;
  vec3 lightAttenuation1;

  vec3 lightColor2;
  vec3 lightPosition2;
  vec3 lightDirection2;
  vec3 lightAttenuation2;
} lighting;

PointLight lighting_getPointLight(int index) {
  switch (index) {
    case 0:
      return PointLight(lighting.lightColor0, lighting.lightPosition0, lighting.lightAttenuation0);
    case 1:
      return PointLight(lighting.lightColor1, lighting.lightPosition1, lighting.lightAttenuation1);
    case 2:
    default:  
      return PointLight(lighting.lightColor2, lighting.lightPosition2, lighting.lightAttenuation2);
  }
}

DirectionalLight lighting_getDirectionalLight(int index) {
  switch (index) {
    case 0:
      return DirectionalLight(lighting.lightColor0, lighting.lightDirection0);
    case 1:
      return DirectionalLight(lighting.lightColor1, lighting.lightDirection1);
    case 2:
    default:   
      return DirectionalLight(lighting.lightColor2, lighting.lightDirection2);
  }
} 

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

// #endif
`,fh=`\
// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  color: vec3<f32>,
};

struct PointLight {
  color: vec3<f32>,
  position: vec3<f32>,
  attenuation: vec3<f32>, // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  color: vec3<f32>,
  direction: vec3<f32>,
};

struct lightingUniforms {
  enabled: i32,
  pointLightCount: i32,
  directionalLightCount: i32,

  ambientColor: vec3<f32>,

  // TODO - support multiple lights by uncommenting arrays below
  lightType: i32,
  lightColor: vec3<f32>,
  lightDirection: vec3<f32>,
  lightPosition: vec3<f32>,
  lightAttenuation: vec3<f32>,

  // AmbientLight ambientLight;
  // PointLight pointLight[MAX_LIGHTS];
  // DirectionalLight directionalLight[MAX_LIGHTS];
};

// Binding 0:1 is reserved for lighting (Note: could go into separate bind group as it is stable across draw calls)
@binding(1) @group(0) var<uniform> lighting : lightingUniforms;

fn lighting_getPointLight(index: i32) -> PointLight {
  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);
}

fn lighting_getDirectionalLight(index: i32) -> DirectionalLight {
  return DirectionalLight(lighting.lightColor, lighting.lightDirection);
} 

fn getPointLightAttenuation(pointLight: PointLight, distance: f32) -> f32 {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}
`;(xI=xV||(xV={}))[xI.POINT=0]="POINT",xI[xI.DIRECTIONAL=1]="DIRECTIONAL";let fi={props:{},uniforms:{},name:"lighting",defines:{},uniformTypes:{enabled:"i32",lightType:"i32",directionalLightCount:"i32",pointLightCount:"i32",ambientColor:"vec3<f32>",lightColor0:"vec3<f32>",lightPosition0:"vec3<f32>",lightDirection0:"vec3<f32>",lightAttenuation0:"vec3<f32>",lightColor1:"vec3<f32>",lightPosition1:"vec3<f32>",lightDirection1:"vec3<f32>",lightAttenuation1:"vec3<f32>",lightColor2:"vec3<f32>",lightPosition2:"vec3<f32>",lightDirection2:"vec3<f32>",lightAttenuation2:"vec3<f32>"},defaultUniforms:{enabled:1,lightType:xV.POINT,directionalLightCount:0,pointLightCount:0,ambientColor:[.1,.1,.1],lightColor0:[1,1,1],lightPosition0:[1,1,2],lightDirection0:[1,1,1],lightAttenuation0:[1,0,0],lightColor1:[1,1,1],lightPosition1:[1,1,2],lightDirection1:[1,1,1],lightAttenuation1:[1,0,0],lightColor2:[1,1,1],lightPosition2:[1,1,2],lightDirection2:[1,1,1],lightAttenuation2:[1,0,0]},source:fh,vs:fg,fs:fg,getUniforms:function(a,b={}){if(!(a=a?{...a}:a))return{...fi.defaultUniforms};a.lights&&(a={...a,...function(a){let b={pointLights:[],directionalLights:[]};for(let c of a||[])switch(c.type){case"ambient":b.ambientLight=c;break;case"directional":b.directionalLights?.push(c);break;case"point":b.pointLights?.push(c)}return b}(a.lights),lights:void 0});let{ambientLight:c,pointLights:d,directionalLights:e}=a||{};if(!(c||d&&d.length>0||e&&e.length>0))return{...fi.defaultUniforms,enabled:0};let f={...fi.defaultUniforms,...b,...function({ambientLight:a,pointLights:b=[],directionalLights:c=[]}){let d={};d.ambientColor=fj(a);let e=0;for(let a of b){d.lightType=xV.POINT;let b=e;d[`lightColor${b}`]=fj(a),d[`lightPosition${b}`]=a.position,d[`lightAttenuation${b}`]=a.attenuation||[1,0,0],e++}for(let a of c){d.lightType=xV.DIRECTIONAL;let b=e;d[`lightColor${b}`]=fj(a),d[`lightDirection${b}`]=a.direction,e++}return e>5&&ff.log.warn("MAX_LIGHTS exceeded")(),d.directionalLightCount=c.length,d.pointLightCount=b.length,d}({ambientLight:c,pointLights:d,directionalLights:e})};return void 0!==a.enabled&&(f.enabled=+!!a.enabled),f}};function fj(a={}){let{color:b=[0,0,0],intensity:c=1}=a;return b.map(a=>a*c/255)}let fk=`\
uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;
`,fl=`\
#define MAX_LIGHTS 3

uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
  vec3 halfway_direction = normalize(light_direction + view_direction);
  float lambertian = dot(light_direction, normal_worldspace);
  float specular = 0.0;
  if (lambertian > 0.0) {
    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  vec3 view_direction = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  for (int i = 0; i < lighting.pointLightCount; i++) {
    PointLight pointLight = lighting_getPointLight(i);
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    float light_attenuation = getPointLightAttenuation(pointLight, distance(light_position_worldspace, position_worldspace));
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color / light_attenuation);
  }

  int totalLights = min(MAX_LIGHTS, lighting.pointLightCount + lighting.directionalLightCount);
  for (int i = lighting.pointLightCount; i < totalLights; i++) {
    DirectionalLight directionalLight = lighting_getDirectionalLight(i);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
}
`,fm=`\
struct phongMaterialUniforms {
  ambient: f32,
  diffuse: f32,
  shininess: f32,
  specularColor: vec3<f32>,
};

@binding(2) @group(0) var<uniform> phongMaterial : phongMaterialUniforms;

fn lighting_getLightColor(surfaceColor: vec3<f32>, light_direction: vec3<f32>, view_direction: vec3<f32>, normal_worldspace: vec3<f32>, color: vec3<f32>) -> vec3<f32> {
  let halfway_direction: vec3<f32> = normalize(light_direction + view_direction);
  var lambertian: f32 = dot(light_direction, normal_worldspace);
  var specular: f32 = 0.0;
  if (lambertian > 0.0) {
    let specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, phongMaterial.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * phongMaterial.diffuse * surfaceColor + specular * phongMaterial.specularColor) * color;
}

fn lighting_getLightColor2(surfaceColor: vec3<f32>, cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32> {
  var lightColor: vec3<f32> = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  let view_direction: vec3<f32> = normalize(cameraPosition - position_worldspace);
  lightColor = phongMaterial.ambient * surfaceColor * lighting.ambientColor;

  if (lighting.lightType == 0) {
    let pointLight: PointLight  = lighting_getPointLight(0);
    let light_position_worldspace: vec3<f32> = pointLight.position;
    let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  } else if (lighting.lightType == 1) {
    var directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
  /*
  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.pointLightCount) {
      break;
    }
    PointLight pointLight = lighting.pointLight[i];
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  }

  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.directionalLightCount) {
      break;
    }
    DirectionalLight directionalLight = lighting.directionalLight[i];
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  */
}

fn lighting_getSpecularLightColor(cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32>{
  var lightColor = vec3<f32>(0, 0, 0);
  let surfaceColor = vec3<f32>(0, 0, 0);

  if (lighting.enabled == 0) {
    let view_direction = normalize(cameraPosition - position_worldspace);

    switch (lighting.lightType) {
      case 0, default: {
        let pointLight: PointLight = lighting_getPointLight(0);
        let light_position_worldspace: vec3<f32> = pointLight.position;
        let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
      }
      case 1: {
        let directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
      }
    }
  }
  return lightColor;
}
`,fn={props:{},name:"gouraudMaterial",vs:fl.replace("phongMaterial","gouraudMaterial"),fs:fk.replace("phongMaterial","gouraudMaterial"),source:fm.replaceAll("phongMaterial","gouraudMaterial"),defines:{LIGHTING_VERTEX:!0},dependencies:[fi],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(a){let b={...a};return b.specularColor&&(b.specularColor=b.specularColor.map(a=>a/255)),{...fn.defaultUniforms,...b}}},fo={name:"phongMaterial",dependencies:[fi],source:fm,vs:fk,fs:fl,defines:{LIGHTING_FRAGMENT:!0},uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(a){let b={...a};return b.specularColor&&(b.specularColor=b.specularColor.map(a=>a/255)),{...fo.defaultUniforms,...b}}},fp=`\
uniform layerUniforms {
  uniform float opacity;
} layer;
`,fq={name:"layer",vs:fp,fs:fp,getUniforms:a=>({opacity:Math.pow(a.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},fr={name:"color",dependencies:[],source:`

struct ColorUniforms {
  opacity: f32,
};

var<private> color: ColorUniforms = ColorUniforms(1.0);
// TODO (kaapp) avoiding binding index collisions to handle layer opacity 
// requires some thought.
// @group(0) @binding(0) var<uniform> color: ColorUniforms;

@must_use
fn deckgl_premultiplied_alpha(fragColor: vec4<f32>) -> vec4<f32> {
    return vec4(fragColor.rgb * fragColor.a, fragColor.a); 
};
`,getUniforms:a=>({}),uniformTypes:{opacity:"f32"}},fs="#define SMOOTH_EDGE_RADIUS 0.5",ft={name:"geometry",source:`\
const SMOOTH_EDGE_RADIUS: f32 = 0.5;

struct VertexGeometry {
  position: vec4<f32>,
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

var<private> geometry_: VertexGeometry = VertexGeometry(
  vec4<f32>(0.0, 0.0, 1.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec2<f32>(0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0)
);

struct FragmentGeometry {
  uv: vec2<f32>,
};

var<private> fragmentGeometry: FragmentGeometry;

fn smoothedge(edge: f32, x: f32) -> f32 {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,vs:`\
${fs}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,fs:`\
${fs}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`},fu=`\
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,fv="undefined"!=typeof Float32Array?Float32Array:Array,fw=Math.random;function fx(a){return a>=0?Math.round(a):a%.5==0?Math.floor(a):Math.round(a)}function fy(){let a=new fv(16);return fv!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a}function fz(a){let b=new fv(16);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b[4]=a[4],b[5]=a[5],b[6]=a[6],b[7]=a[7],b[8]=a[8],b[9]=a[9],b[10]=a[10],b[11]=a[11],b[12]=a[12],b[13]=a[13],b[14]=a[14],b[15]=a[15],b}function fA(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a}function fB(a,b,c,d,e,f,g,h,i,j,k,l,n,o,p,q){let r=new fv(16);return r[0]=a,r[1]=b,r[2]=c,r[3]=d,r[4]=e,r[5]=f,r[6]=g,r[7]=h,r[8]=i,r[9]=j,r[10]=k,r[11]=l,r[12]=n,r[13]=o,r[14]=p,r[15]=q,r}function fC(a,b,c,d,e,f,g,h,i,j,k,l,n,o,p,q,r){return a[0]=b,a[1]=c,a[2]=d,a[3]=e,a[4]=f,a[5]=g,a[6]=h,a[7]=i,a[8]=j,a[9]=k,a[10]=l,a[11]=n,a[12]=o,a[13]=p,a[14]=q,a[15]=r,a}function fD(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function fE(a,b){if(a===b){let c=b[1],d=b[2],e=b[3],f=b[6],g=b[7],h=b[11];a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=c,a[6]=b[9],a[7]=b[13],a[8]=d,a[9]=f,a[11]=b[14],a[12]=e,a[13]=g,a[14]=h}else a[0]=b[0],a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=b[1],a[5]=b[5],a[6]=b[9],a[7]=b[13],a[8]=b[2],a[9]=b[6],a[10]=b[10],a[11]=b[14],a[12]=b[3],a[13]=b[7],a[14]=b[11],a[15]=b[15];return a}function fF(a,b){let c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],n=b[10],o=b[11],p=b[12],q=b[13],r=b[14],s=b[15],t=c*h-d*g,u=c*i-e*g,v=c*j-f*g,w=d*i-e*h,x=d*j-f*h,y=e*j-f*i,z=k*q-l*p,A=k*r-n*p,B=k*s-o*p,C=l*r-n*q,D=l*s-o*q,E=n*s-o*r,F=t*E-u*D+v*C+w*B-x*A+y*z;return F?(F=1/F,a[0]=(h*E-i*D+j*C)*F,a[1]=(e*D-d*E-f*C)*F,a[2]=(q*y-r*x+s*w)*F,a[3]=(n*x-l*y-o*w)*F,a[4]=(i*B-g*E-j*A)*F,a[5]=(c*E-e*B+f*A)*F,a[6]=(r*v-p*y-s*u)*F,a[7]=(k*y-n*v+o*u)*F,a[8]=(g*D-h*B+j*z)*F,a[9]=(d*B-c*D-f*z)*F,a[10]=(p*x-q*v+s*t)*F,a[11]=(l*v-k*x-o*t)*F,a[12]=(h*A-g*C-i*z)*F,a[13]=(c*C-d*A+e*z)*F,a[14]=(q*u-p*w-r*t)*F,a[15]=(k*w-l*u+n*t)*F,a):null}function fG(a,b){let c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=b[9],n=b[10],o=b[11],p=b[12],q=b[13],r=b[14],s=b[15],t=c*h-d*g,u=c*i-e*g,v=c*j-f*g,w=d*i-e*h,x=d*j-f*h,y=e*j-f*i,z=k*q-l*p,A=k*r-n*p,B=k*s-o*p,C=l*r-n*q,D=l*s-o*q,E=n*s-o*r;return a[0]=h*E-i*D+j*C,a[1]=e*D-d*E-f*C,a[2]=q*y-r*x+s*w,a[3]=n*x-l*y-o*w,a[4]=i*B-g*E-j*A,a[5]=c*E-e*B+f*A,a[6]=r*v-p*y-s*u,a[7]=k*y-n*v+o*u,a[8]=g*D-h*B+j*z,a[9]=d*B-c*D-f*z,a[10]=p*x-q*v+s*t,a[11]=l*v-k*x-o*t,a[12]=h*A-g*C-i*z,a[13]=c*C-d*A+e*z,a[14]=q*u-p*w-r*t,a[15]=k*w-l*u+n*t,a}function fH(a){let b=a[0],c=a[1],d=a[2],e=a[3],f=a[4],g=a[5],h=a[6],i=a[7],j=a[8],k=a[9],l=a[10],n=a[11],o=a[12],p=a[13],q=a[14],r=a[15],s=b*g-c*f,t=b*h-d*f,u=c*h-d*g,v=j*p-k*o,w=j*q-l*o,x=k*q-l*p;return i*(b*x-c*w+d*v)-e*(f*x-g*w+h*v)+r*(j*u-k*t+l*s)-n*(o*u-p*t+q*s)}function fI(a,b,c){let d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],n=b[9],o=b[10],p=b[11],q=b[12],r=b[13],s=b[14],t=b[15],u=c[0],v=c[1],w=c[2],x=c[3];return a[0]=u*d+v*h+w*l+x*q,a[1]=u*e+v*i+w*n+x*r,a[2]=u*f+v*j+w*o+x*s,a[3]=u*g+v*k+w*p+x*t,u=c[4],v=c[5],w=c[6],x=c[7],a[4]=u*d+v*h+w*l+x*q,a[5]=u*e+v*i+w*n+x*r,a[6]=u*f+v*j+w*o+x*s,a[7]=u*g+v*k+w*p+x*t,u=c[8],v=c[9],w=c[10],x=c[11],a[8]=u*d+v*h+w*l+x*q,a[9]=u*e+v*i+w*n+x*r,a[10]=u*f+v*j+w*o+x*s,a[11]=u*g+v*k+w*p+x*t,u=c[12],v=c[13],w=c[14],x=c[15],a[12]=u*d+v*h+w*l+x*q,a[13]=u*e+v*i+w*n+x*r,a[14]=u*f+v*j+w*o+x*s,a[15]=u*g+v*k+w*p+x*t,a}function fJ(a,b,c){let d,e,f,g,h,i,j,k,l,n,o,p,q=c[0],r=c[1],s=c[2];return b===a?(a[12]=b[0]*q+b[4]*r+b[8]*s+b[12],a[13]=b[1]*q+b[5]*r+b[9]*s+b[13],a[14]=b[2]*q+b[6]*r+b[10]*s+b[14],a[15]=b[3]*q+b[7]*r+b[11]*s+b[15]):(d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],n=b[9],o=b[10],p=b[11],a[0]=d,a[1]=e,a[2]=f,a[3]=g,a[4]=h,a[5]=i,a[6]=j,a[7]=k,a[8]=l,a[9]=n,a[10]=o,a[11]=p,a[12]=d*q+h*r+l*s+b[12],a[13]=e*q+i*r+n*s+b[13],a[14]=f*q+j*r+o*s+b[14],a[15]=g*q+k*r+p*s+b[15]),a}function fK(a,b,c){let d=c[0],e=c[1],f=c[2];return a[0]=b[0]*d,a[1]=b[1]*d,a[2]=b[2]*d,a[3]=b[3]*d,a[4]=b[4]*e,a[5]=b[5]*e,a[6]=b[6]*e,a[7]=b[7]*e,a[8]=b[8]*f,a[9]=b[9]*f,a[10]=b[10]*f,a[11]=b[11]*f,a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15],a}function fL(a,b,c,d){let e,f,g,h,i,j,k,l,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D=d[0],E=d[1],F=d[2],G=Math.sqrt(D*D+E*E+F*F);return G<1e-6?null:(D*=G=1/G,E*=G,F*=G,f=Math.sin(c),g=1-(e=Math.cos(c)),h=b[0],i=b[1],j=b[2],k=b[3],l=b[4],n=b[5],o=b[6],p=b[7],q=b[8],r=b[9],s=b[10],t=b[11],u=D*D*g+e,v=E*D*g+F*f,w=F*D*g-E*f,x=D*E*g-F*f,y=E*E*g+e,z=F*E*g+D*f,A=D*F*g+E*f,B=E*F*g-D*f,C=F*F*g+e,a[0]=h*u+l*v+q*w,a[1]=i*u+n*v+r*w,a[2]=j*u+o*v+s*w,a[3]=k*u+p*v+t*w,a[4]=h*x+l*y+q*z,a[5]=i*x+n*y+r*z,a[6]=j*x+o*y+s*z,a[7]=k*x+p*y+t*z,a[8]=h*A+l*B+q*C,a[9]=i*A+n*B+r*C,a[10]=j*A+o*B+s*C,a[11]=k*A+p*B+t*C,b!==a&&(a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a)}function fM(a,b,c){let d=Math.sin(c),e=Math.cos(c),f=b[4],g=b[5],h=b[6],i=b[7],j=b[8],k=b[9],l=b[10],n=b[11];return b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[4]=f*e+j*d,a[5]=g*e+k*d,a[6]=h*e+l*d,a[7]=i*e+n*d,a[8]=j*e-f*d,a[9]=k*e-g*d,a[10]=l*e-h*d,a[11]=n*e-i*d,a}function fN(a,b,c){let d=Math.sin(c),e=Math.cos(c),f=b[0],g=b[1],h=b[2],i=b[3],j=b[8],k=b[9],l=b[10],n=b[11];return b!==a&&(a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[0]=f*e-j*d,a[1]=g*e-k*d,a[2]=h*e-l*d,a[3]=i*e-n*d,a[8]=f*d+j*e,a[9]=g*d+k*e,a[10]=h*d+l*e,a[11]=i*d+n*e,a}function fO(a,b,c){let d=Math.sin(c),e=Math.cos(c),f=b[0],g=b[1],h=b[2],i=b[3],j=b[4],k=b[5],l=b[6],n=b[7];return b!==a&&(a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]),a[0]=f*e+j*d,a[1]=g*e+k*d,a[2]=h*e+l*d,a[3]=i*e+n*d,a[4]=j*e-f*d,a[5]=k*e-g*d,a[6]=l*e-h*d,a[7]=n*e-i*d,a}function fP(a,b){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=b[0],a[13]=b[1],a[14]=b[2],a[15]=1,a}function fQ(a,b){return a[0]=b[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=b[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=b[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function fR(a,b,c){let d,e,f,g=c[0],h=c[1],i=c[2],j=Math.sqrt(g*g+h*h+i*i);return j<1e-6?null:(g*=j=1/j,h*=j,i*=j,e=Math.sin(b),f=1-(d=Math.cos(b)),a[0]=g*g*f+d,a[1]=h*g*f+i*e,a[2]=i*g*f-h*e,a[3]=0,a[4]=g*h*f-i*e,a[5]=h*h*f+d,a[6]=i*h*f+g*e,a[7]=0,a[8]=g*i*f+h*e,a[9]=h*i*f-g*e,a[10]=i*i*f+d,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a)}function fS(a,b){let c=Math.sin(b),d=Math.cos(b);return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=d,a[6]=c,a[7]=0,a[8]=0,a[9]=-c,a[10]=d,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function fT(a,b){let c=Math.sin(b),d=Math.cos(b);return a[0]=d,a[1]=0,a[2]=-c,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=c,a[9]=0,a[10]=d,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function fU(a,b){let c=Math.sin(b),d=Math.cos(b);return a[0]=d,a[1]=c,a[2]=0,a[3]=0,a[4]=-c,a[5]=d,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function fV(a,b,c){let d=b[0],e=b[1],f=b[2],g=b[3],h=d+d,i=e+e,j=f+f,k=d*h,l=d*i,n=d*j,o=e*i,p=e*j,q=f*j,r=g*h,s=g*i,t=g*j;return a[0]=1-(o+q),a[1]=l+t,a[2]=n-s,a[3]=0,a[4]=l-t,a[5]=1-(k+q),a[6]=p+r,a[7]=0,a[8]=n+s,a[9]=p-r,a[10]=1-(k+o),a[11]=0,a[12]=c[0],a[13]=c[1],a[14]=c[2],a[15]=1,a}function fW(a,b){let c=new fv(3),d=-b[0],e=-b[1],f=-b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=d*d+e*e+f*f+g*g;return l>0?(c[0]=(h*g+k*d+i*f-j*e)*2/l,c[1]=(i*g+k*e+j*d-h*f)*2/l,c[2]=(j*g+k*f+h*e-i*d)*2/l):(c[0]=(h*g+k*d+i*f-j*e)*2,c[1]=(i*g+k*e+j*d-h*f)*2,c[2]=(j*g+k*f+h*e-i*d)*2),fV(a,b,c),a}function fX(a,b){return a[0]=b[12],a[1]=b[13],a[2]=b[14],a}function fY(a,b){let c=b[0],d=b[1],e=b[2],f=b[4],g=b[5],h=b[6],i=b[8],j=b[9],k=b[10];return a[0]=Math.sqrt(c*c+d*d+e*e),a[1]=Math.sqrt(f*f+g*g+h*h),a[2]=Math.sqrt(i*i+j*j+k*k),a}function fZ(a,b){let c=new fv(3);fY(c,b);let d=1/c[0],e=1/c[1],f=1/c[2],g=b[0]*d,h=b[1]*e,i=b[2]*f,j=b[4]*d,k=b[5]*e,l=b[6]*f,n=b[8]*d,o=b[9]*e,p=b[10]*f,q=g+k+p,r=0;return q>0?(r=2*Math.sqrt(q+1),a[3]=.25*r,a[0]=(l-o)/r,a[1]=(n-i)/r,a[2]=(h-j)/r):g>k&&g>p?(r=2*Math.sqrt(1+g-k-p),a[3]=(l-o)/r,a[0]=.25*r,a[1]=(h+j)/r,a[2]=(n+i)/r):k>p?(r=2*Math.sqrt(1+k-g-p),a[3]=(n-i)/r,a[0]=(h+j)/r,a[1]=.25*r,a[2]=(l+o)/r):(r=2*Math.sqrt(1+p-g-k),a[3]=(h-j)/r,a[0]=(n+i)/r,a[1]=(l+o)/r,a[2]=.25*r),a}function f$(a,b,c,d){b[0]=d[12],b[1]=d[13],b[2]=d[14];let e=d[0],f=d[1],g=d[2],h=d[4],i=d[5],j=d[6],k=d[8],l=d[9],n=d[10];c[0]=Math.sqrt(e*e+f*f+g*g),c[1]=Math.sqrt(h*h+i*i+j*j),c[2]=Math.sqrt(k*k+l*l+n*n);let o=1/c[0],p=1/c[1],q=1/c[2],r=e*o,s=f*p,t=g*q,u=h*o,v=i*p,w=j*q,x=k*o,y=l*p,z=n*q,A=r+v+z,B=0;return A>0?(B=2*Math.sqrt(A+1),a[3]=.25*B,a[0]=(w-y)/B,a[1]=(x-t)/B,a[2]=(s-u)/B):r>v&&r>z?(B=2*Math.sqrt(1+r-v-z),a[3]=(w-y)/B,a[0]=.25*B,a[1]=(s+u)/B,a[2]=(x+t)/B):v>z?(B=2*Math.sqrt(1+v-r-z),a[3]=(x-t)/B,a[0]=(s+u)/B,a[1]=.25*B,a[2]=(w+y)/B):(B=2*Math.sqrt(1+z-r-v),a[3]=(s-u)/B,a[0]=(x+t)/B,a[1]=(w+y)/B,a[2]=.25*B),a}function f_(a,b,c,d){let e=b[0],f=b[1],g=b[2],h=b[3],i=e+e,j=f+f,k=g+g,l=e*i,n=e*j,o=e*k,p=f*j,q=f*k,r=g*k,s=h*i,t=h*j,u=h*k,v=d[0],w=d[1],x=d[2];return a[0]=(1-(p+r))*v,a[1]=(n+u)*v,a[2]=(o-t)*v,a[3]=0,a[4]=(n-u)*w,a[5]=(1-(l+r))*w,a[6]=(q+s)*w,a[7]=0,a[8]=(o+t)*x,a[9]=(q-s)*x,a[10]=(1-(l+p))*x,a[11]=0,a[12]=c[0],a[13]=c[1],a[14]=c[2],a[15]=1,a}function f0(a,b,c,d,e){let f=b[0],g=b[1],h=b[2],i=b[3],j=f+f,k=g+g,l=h+h,n=f*j,o=f*k,p=f*l,q=g*k,r=g*l,s=h*l,t=i*j,u=i*k,v=i*l,w=d[0],x=d[1],y=d[2],z=e[0],A=e[1],B=e[2],C=(1-(q+s))*w,D=(o+v)*w,E=(p-u)*w,F=(o-v)*x,G=(1-(n+s))*x,H=(r+t)*x,I=(p+u)*y,J=(r-t)*y,K=(1-(n+q))*y;return a[0]=C,a[1]=D,a[2]=E,a[3]=0,a[4]=F,a[5]=G,a[6]=H,a[7]=0,a[8]=I,a[9]=J,a[10]=K,a[11]=0,a[12]=c[0]+z-(C*z+F*A+I*B),a[13]=c[1]+A-(D*z+G*A+J*B),a[14]=c[2]+B-(E*z+H*A+K*B),a[15]=1,a}function f1(a,b){let c=b[0],d=b[1],e=b[2],f=b[3],g=c+c,h=d+d,i=e+e,j=c*g,k=d*g,l=d*h,n=e*g,o=e*h,p=e*i,q=f*g,r=f*h,s=f*i;return a[0]=1-l-p,a[1]=k+s,a[2]=n-r,a[3]=0,a[4]=k-s,a[5]=1-j-p,a[6]=o+q,a[7]=0,a[8]=n+r,a[9]=o-q,a[10]=1-j-l,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function f2(a,b,c,d,e,f,g){let h=1/(c-b),i=1/(e-d),j=1/(f-g);return a[0]=2*f*h,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=2*f*i,a[6]=0,a[7]=0,a[8]=(c+b)*h,a[9]=(e+d)*i,a[10]=(g+f)*j,a[11]=-1,a[12]=0,a[13]=0,a[14]=g*f*2*j,a[15]=0,a}function f3(a,b,c,d,e){let f=1/Math.tan(b/2);if(a[0]=f/c,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=f,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,null!=e&&e!==1/0){let b=1/(d-e);a[10]=(e+d)*b,a[14]=2*e*d*b}else a[10]=-1,a[14]=-2*d;return a}function f4(a,b,c,d,e){let f=1/Math.tan(b/2);if(a[0]=f/c,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=f,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,null!=e&&e!==1/0){let b=1/(d-e);a[10]=e*b,a[14]=e*d*b}else a[10]=-1,a[14]=-d;return a}function f5(a,b,c,d){let e=Math.tan(b.upDegrees*Math.PI/180),f=Math.tan(b.downDegrees*Math.PI/180),g=Math.tan(b.leftDegrees*Math.PI/180),h=Math.tan(b.rightDegrees*Math.PI/180),i=2/(g+h),j=2/(e+f);return a[0]=i,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=j,a[6]=0,a[7]=0,a[8]=-((g-h)*i*.5),a[9]=(e-f)*j*.5,a[10]=d/(c-d),a[11]=-1,a[12]=0,a[13]=0,a[14]=d*c/(c-d),a[15]=0,a}function f6(a,b,c,d,e,f,g){let h=1/(b-c),i=1/(d-e),j=1/(f-g);return a[0]=-2*h,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*i,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*j,a[11]=0,a[12]=(b+c)*h,a[13]=(e+d)*i,a[14]=(g+f)*j,a[15]=1,a}function f7(a,b,c,d,e,f,g){let h=1/(b-c),i=1/(d-e),j=1/(f-g);return a[0]=-2*h,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*i,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=j,a[11]=0,a[12]=(b+c)*h,a[13]=(e+d)*i,a[14]=f*j,a[15]=1,a}function f8(a,b,c,d){let e,f,g,h,i,j,k,l,n,o,p=b[0],q=b[1],r=b[2],s=d[0],t=d[1],u=d[2],v=c[0],w=c[1],x=c[2];return 1e-6>Math.abs(p-v)&&1e-6>Math.abs(q-w)&&1e-6>Math.abs(r-x)?fD(a):(e=1/Math.sqrt((l=p-v)*l+(n=q-w)*n+(o=r-x)*o),l*=e,n*=e,o*=e,(e=Math.sqrt((f=t*o-u*n)*f+(g=u*l-s*o)*g+(h=s*n-t*l)*h))?(f*=e=1/e,g*=e,h*=e):(f=0,g=0,h=0),(e=Math.sqrt((i=n*h-o*g)*i+(j=o*f-l*h)*j+(k=l*g-n*f)*k))?(i*=e=1/e,j*=e,k*=e):(i=0,j=0,k=0),a[0]=f,a[1]=i,a[2]=l,a[3]=0,a[4]=g,a[5]=j,a[6]=n,a[7]=0,a[8]=h,a[9]=k,a[10]=o,a[11]=0,a[12]=-(f*p+g*q+h*r),a[13]=-(i*p+j*q+k*r),a[14]=-(l*p+n*q+o*r),a[15]=1,a)}function f9(a,b,c,d){let e=b[0],f=b[1],g=b[2],h=d[0],i=d[1],j=d[2],k=e-c[0],l=f-c[1],n=g-c[2],o=k*k+l*l+n*n;o>0&&(k*=o=1/Math.sqrt(o),l*=o,n*=o);let p=i*n-j*l,q=j*k-h*n,r=h*l-i*k;return(o=p*p+q*q+r*r)>0&&(p*=o=1/Math.sqrt(o),q*=o,r*=o),a[0]=p,a[1]=q,a[2]=r,a[3]=0,a[4]=l*r-n*q,a[5]=n*p-k*r,a[6]=k*q-l*p,a[7]=0,a[8]=k,a[9]=l,a[10]=n,a[11]=0,a[12]=e,a[13]=f,a[14]=g,a[15]=1,a}function ga(a){return`mat4(${a[0]}, ${a[1]}, ${a[2]}, ${a[3]}, ${a[4]}, ${a[5]}, ${a[6]}, ${a[7]}, ${a[8]}, ${a[9]}, ${a[10]}, ${a[11]}, ${a[12]}, ${a[13]}, ${a[14]}, ${a[15]})`}function gb(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1]+a[2]*a[2]+a[3]*a[3]+a[4]*a[4]+a[5]*a[5]+a[6]*a[6]+a[7]*a[7]+a[8]*a[8]+a[9]*a[9]+a[10]*a[10]+a[11]*a[11]+a[12]*a[12]+a[13]*a[13]+a[14]*a[14]+a[15]*a[15])}function gc(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a[3]=b[3]+c[3],a[4]=b[4]+c[4],a[5]=b[5]+c[5],a[6]=b[6]+c[6],a[7]=b[7]+c[7],a[8]=b[8]+c[8],a[9]=b[9]+c[9],a[10]=b[10]+c[10],a[11]=b[11]+c[11],a[12]=b[12]+c[12],a[13]=b[13]+c[13],a[14]=b[14]+c[14],a[15]=b[15]+c[15],a}function gd(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a[3]=b[3]-c[3],a[4]=b[4]-c[4],a[5]=b[5]-c[5],a[6]=b[6]-c[6],a[7]=b[7]-c[7],a[8]=b[8]-c[8],a[9]=b[9]-c[9],a[10]=b[10]-c[10],a[11]=b[11]-c[11],a[12]=b[12]-c[12],a[13]=b[13]-c[13],a[14]=b[14]-c[14],a[15]=b[15]-c[15],a}function ge(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a[3]=b[3]*c,a[4]=b[4]*c,a[5]=b[5]*c,a[6]=b[6]*c,a[7]=b[7]*c,a[8]=b[8]*c,a[9]=b[9]*c,a[10]=b[10]*c,a[11]=b[11]*c,a[12]=b[12]*c,a[13]=b[13]*c,a[14]=b[14]*c,a[15]=b[15]*c,a}function gf(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a[2]=b[2]+c[2]*d,a[3]=b[3]+c[3]*d,a[4]=b[4]+c[4]*d,a[5]=b[5]+c[5]*d,a[6]=b[6]+c[6]*d,a[7]=b[7]+c[7]*d,a[8]=b[8]+c[8]*d,a[9]=b[9]+c[9]*d,a[10]=b[10]+c[10]*d,a[11]=b[11]+c[11]*d,a[12]=b[12]+c[12]*d,a[13]=b[13]+c[13]*d,a[14]=b[14]+c[14]*d,a[15]=b[15]+c[15]*d,a}function gg(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]&&a[9]===b[9]&&a[10]===b[10]&&a[11]===b[11]&&a[12]===b[12]&&a[13]===b[13]&&a[14]===b[14]&&a[15]===b[15]}function gh(a,b){let c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],i=a[6],j=a[7],k=a[8],l=a[9],n=a[10],o=a[11],p=a[12],q=a[13],r=a[14],s=a[15],t=b[0],u=b[1],v=b[2],w=b[3],x=b[4],y=b[5],z=b[6],A=b[7],B=b[8],C=b[9],D=b[10],E=b[11],F=b[12],G=b[13],H=b[14],I=b[15];return Math.abs(c-t)<=1e-6*Math.max(1,Math.abs(c),Math.abs(t))&&Math.abs(d-u)<=1e-6*Math.max(1,Math.abs(d),Math.abs(u))&&Math.abs(e-v)<=1e-6*Math.max(1,Math.abs(e),Math.abs(v))&&Math.abs(f-w)<=1e-6*Math.max(1,Math.abs(f),Math.abs(w))&&Math.abs(g-x)<=1e-6*Math.max(1,Math.abs(g),Math.abs(x))&&Math.abs(h-y)<=1e-6*Math.max(1,Math.abs(h),Math.abs(y))&&Math.abs(i-z)<=1e-6*Math.max(1,Math.abs(i),Math.abs(z))&&Math.abs(j-A)<=1e-6*Math.max(1,Math.abs(j),Math.abs(A))&&Math.abs(k-B)<=1e-6*Math.max(1,Math.abs(k),Math.abs(B))&&Math.abs(l-C)<=1e-6*Math.max(1,Math.abs(l),Math.abs(C))&&Math.abs(n-D)<=1e-6*Math.max(1,Math.abs(n),Math.abs(D))&&Math.abs(o-E)<=1e-6*Math.max(1,Math.abs(o),Math.abs(E))&&Math.abs(p-F)<=1e-6*Math.max(1,Math.abs(p),Math.abs(F))&&Math.abs(q-G)<=1e-6*Math.max(1,Math.abs(q),Math.abs(G))&&Math.abs(r-H)<=1e-6*Math.max(1,Math.abs(r),Math.abs(H))&&Math.abs(s-I)<=1e-6*Math.max(1,Math.abs(s),Math.abs(I))}a.s(["add",()=>gc,"adjoint",()=>fG,"clone",()=>fz,"copy",()=>fA,"create",()=>fy,"decompose",()=>f$,"determinant",()=>fH,"equals",()=>gh,"exactEquals",()=>gg,"frob",()=>gb,"fromQuat",()=>f1,"fromQuat2",()=>fW,"fromRotation",()=>fR,"fromRotationTranslation",()=>fV,"fromRotationTranslationScale",()=>f_,"fromRotationTranslationScaleOrigin",()=>f0,"fromScaling",()=>fQ,"fromTranslation",()=>fP,"fromValues",()=>fB,"fromXRotation",()=>fS,"fromYRotation",()=>fT,"fromZRotation",()=>fU,"frustum",()=>f2,"getRotation",()=>fZ,"getScaling",()=>fY,"getTranslation",()=>fX,"identity",()=>fD,"invert",()=>fF,"lookAt",()=>f8,"mul",0,fI,"multiply",()=>fI,"multiplyScalar",()=>ge,"multiplyScalarAndAdd",()=>gf,"ortho",0,f6,"orthoNO",()=>f6,"orthoZO",()=>f7,"perspective",0,f3,"perspectiveFromFieldOfView",()=>f5,"perspectiveNO",()=>f3,"perspectiveZO",()=>f4,"rotate",()=>fL,"rotateX",()=>fM,"rotateY",()=>fN,"rotateZ",()=>fO,"scale",()=>fK,"set",()=>fC,"str",()=>ga,"sub",0,gd,"subtract",()=>gd,"targetTo",()=>f9,"translate",()=>fJ,"transpose",()=>fE],36385);var gi=a.i(36385),gi=gi;function gj(){let a=new fv(4);return fv!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0,a[3]=0),a}function gk(a){let b=new fv(4);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b[3]=a[3],b}function gl(a,b,c,d){let e=new fv(4);return e[0]=a,e[1]=b,e[2]=c,e[3]=d,e}function gm(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a}function gn(a,b,c,d,e){return a[0]=b,a[1]=c,a[2]=d,a[3]=e,a}function go(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a[3]=b[3]+c[3],a}function gp(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a[3]=b[3]-c[3],a}function gq(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a[2]=b[2]*c[2],a[3]=b[3]*c[3],a}function gr(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a[2]=b[2]/c[2],a[3]=b[3]/c[3],a}function gs(a,b){return a[0]=Math.ceil(b[0]),a[1]=Math.ceil(b[1]),a[2]=Math.ceil(b[2]),a[3]=Math.ceil(b[3]),a}function gt(a,b){return a[0]=Math.floor(b[0]),a[1]=Math.floor(b[1]),a[2]=Math.floor(b[2]),a[3]=Math.floor(b[3]),a}function gu(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a[2]=Math.min(b[2],c[2]),a[3]=Math.min(b[3],c[3]),a}function gv(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a[2]=Math.max(b[2],c[2]),a[3]=Math.max(b[3],c[3]),a}function gw(a,b){return a[0]=fx(b[0]),a[1]=fx(b[1]),a[2]=fx(b[2]),a[3]=fx(b[3]),a}function gx(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a[3]=b[3]*c,a}function gy(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a[2]=b[2]+c[2]*d,a[3]=b[3]+c[3]*d,a}function gz(a,b){let c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2],f=b[3]-a[3];return Math.sqrt(c*c+d*d+e*e+f*f)}function gA(a,b){let c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2],f=b[3]-a[3];return c*c+d*d+e*e+f*f}function gB(a){let b=a[0],c=a[1],d=a[2],e=a[3];return Math.sqrt(b*b+c*c+d*d+e*e)}function gC(a){let b=a[0],c=a[1],d=a[2],e=a[3];return b*b+c*c+d*d+e*e}function gD(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a[3]=-b[3],a}function gE(a,b){return a[0]=1/b[0],a[1]=1/b[1],a[2]=1/b[2],a[3]=1/b[3],a}function gF(a,b){let c=b[0],d=b[1],e=b[2],f=b[3],g=c*c+d*d+e*e+f*f;return g>0&&(g=1/Math.sqrt(g)),a[0]=c*g,a[1]=d*g,a[2]=e*g,a[3]=f*g,a}function gG(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]}function gH(a,b,c,d){let e=c[0]*d[1]-c[1]*d[0],f=c[0]*d[2]-c[2]*d[0],g=c[0]*d[3]-c[3]*d[0],h=c[1]*d[2]-c[2]*d[1],i=c[1]*d[3]-c[3]*d[1],j=c[2]*d[3]-c[3]*d[2],k=b[0],l=b[1],n=b[2],o=b[3];return a[0]=l*j-n*i+o*h,a[1]=-(k*j)+n*g-o*f,a[2]=k*i-l*g+o*e,a[3]=-(k*h)+l*f-n*e,a}function gI(a,b,c,d){let e=b[0],f=b[1],g=b[2],h=b[3];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a[2]=g+d*(c[2]-g),a[3]=h+d*(c[3]-h),a}function gJ(a,b){let c,d,e,f,g,h;b=void 0===b?1:b;do g=(c=2*fw()-1)*c+(d=2*fw()-1)*d;while(g>=1)do h=(e=2*fw()-1)*e+(f=2*fw()-1)*f;while(h>=1)let i=Math.sqrt((1-g)/h);return a[0]=b*c,a[1]=b*d,a[2]=b*e*i,a[3]=b*f*i,a}function gK(a,b,c){let d=b[0],e=b[1],f=b[2],g=b[3];return a[0]=c[0]*d+c[4]*e+c[8]*f+c[12]*g,a[1]=c[1]*d+c[5]*e+c[9]*f+c[13]*g,a[2]=c[2]*d+c[6]*e+c[10]*f+c[14]*g,a[3]=c[3]*d+c[7]*e+c[11]*f+c[15]*g,a}function gL(a,b,c){let d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2],j=c[3],k=j*d+h*f-i*e,l=j*e+i*d-g*f,n=j*f+g*e-h*d,o=-g*d-h*e-i*f;return a[0]=k*j+-(o*g)+-(l*i)- -(n*h),a[1]=l*j+-(o*h)+-(n*g)- -(k*i),a[2]=n*j+-(o*i)+-(k*h)- -(l*g),a[3]=b[3],a}function gM(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=0,a}function gN(a){return`vec4(${a[0]}, ${a[1]}, ${a[2]}, ${a[3]})`}function gO(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]}function gP(a,b){let c=a[0],d=a[1],e=a[2],f=a[3],g=b[0],h=b[1],i=b[2],j=b[3];return Math.abs(c-g)<=1e-6*Math.max(1,Math.abs(c),Math.abs(g))&&Math.abs(d-h)<=1e-6*Math.max(1,Math.abs(d),Math.abs(h))&&Math.abs(e-i)<=1e-6*Math.max(1,Math.abs(e),Math.abs(i))&&Math.abs(f-j)<=1e-6*Math.max(1,Math.abs(f),Math.abs(j))}let gQ=(h=gj(),function(a,b,c,d,e,f){let g,i;for(b||(b=4),c||(c=0),i=d?Math.min(d*b+c,a.length):a.length,g=c;g<i;g+=b)h[0]=a[g],h[1]=a[g+1],h[2]=a[g+2],h[3]=a[g+3],e(h,h,f),a[g]=h[0],a[g+1]=h[1],a[g+2]=h[2],a[g+3]=h[3];return a});a.s(["add",()=>go,"ceil",()=>gs,"clone",()=>gk,"copy",()=>gm,"create",()=>gj,"cross",()=>gH,"dist",0,gz,"distance",()=>gz,"div",0,gr,"divide",()=>gr,"dot",()=>gG,"equals",()=>gP,"exactEquals",()=>gO,"floor",()=>gt,"forEach",0,gQ,"fromValues",()=>gl,"inverse",()=>gE,"len",0,gB,"length",()=>gB,"lerp",()=>gI,"max",()=>gv,"min",()=>gu,"mul",0,gq,"multiply",()=>gq,"negate",()=>gD,"normalize",()=>gF,"random",()=>gJ,"round",()=>gw,"scale",()=>gx,"scaleAndAdd",()=>gy,"set",()=>gn,"sqrDist",0,gA,"sqrLen",0,gC,"squaredDistance",()=>gA,"squaredLength",()=>gC,"str",()=>gN,"sub",0,gp,"subtract",()=>gp,"transformMat4",()=>gK,"transformQuat",()=>gL,"zero",()=>gM],51887);var gR=a.i(51887),gR=gR,gS=a.i(11348);let gT=new gS.Log({id:"deck"});(xJ=xW||(xW={}))[xJ.Start=1]="Start",xJ[xJ.Move=2]="Move",xJ[xJ.End=4]="End",xJ[xJ.Cancel=8]="Cancel",(xK=xX||(xX={}))[xK.None=0]="None",xK[xK.Left=1]="Left",xK[xK.Right=2]="Right",xK[xK.Up=4]="Up",xK[xK.Down=8]="Down",xK[xK.Horizontal=3]="Horizontal",xK[xK.Vertical=12]="Vertical",xK[xK.All=15]="All",(xL=xY||(xY={}))[xL.Possible=1]="Possible",xL[xL.Began=2]="Began",xL[xL.Changed=4]="Changed",xL[xL.Ended=8]="Ended",xL[xL.Recognized=8]="Recognized",xL[xL.Cancelled=16]="Cancelled",xL[xL.Failed=32]="Failed";let gU="manipulation",gV="none",gW="pan-x",gX="pan-y";class gY{constructor(a,b){this.actions="",this.manager=a,this.set(b)}set(a){"compute"===a&&(a=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=a,this.actions=a)}update(){this.set(this.manager.options.touchAction)}compute(){let a=[];for(let b of this.manager.recognizers)b.options.enable&&(a=a.concat(b.getTouchAction()));var b=a.join(" ");if(b.includes(gV))return gV;let c=b.includes(gW),d=b.includes(gX);return c&&d?gV:c||d?c?gW:gX:b.includes(gU)?gU:"auto"}}function gZ(a){return a.trim().split(/\s+/g)}function g$(a,b,c){if(a)for(let d of gZ(b))a.addEventListener(d,c,!1)}function g_(a,b,c){if(a)for(let d of gZ(b))a.removeEventListener(d,c,!1)}function g0(a){return(a.ownerDocument||a).defaultView}function g1(a){let b=a.length;if(1===b)return{x:Math.round(a[0].clientX),y:Math.round(a[0].clientY)};let c=0,d=0,e=0;for(;e<b;)c+=a[e].clientX,d+=a[e].clientY,e++;return{x:Math.round(c/b),y:Math.round(d/b)}}function g2(a){let b=[],c=0;for(;c<a.pointers.length;)b[c]={clientX:Math.round(a.pointers[c].clientX),clientY:Math.round(a.pointers[c].clientY)},c++;return{timeStamp:Date.now(),pointers:b,center:g1(b),deltaX:a.deltaX,deltaY:a.deltaY}}function g3(a,b){let c=b.x-a.x,d=b.y-a.y;return Math.sqrt(c*c+d*d)}function g4(a,b){let c=b.clientX-a.clientX,d=b.clientY-a.clientY;return Math.sqrt(c*c+d*d)}function g5(a,b){let c=b.clientX-a.clientX;return 180*Math.atan2(b.clientY-a.clientY,c)/Math.PI}function g6(a,b){return a===b?xX.None:Math.abs(a)>=Math.abs(b)?a<0?xX.Left:xX.Right:b<0?xX.Up:xX.Down}function g7(a,b,c){return{x:b/a||0,y:c/a||0}}class g8{constructor(a){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=a=>{this.manager.options.enable&&this.handler(a)},this.manager=a,this.element=a.element,this.target=a.options.inputTarget||a.element}callback(a,b){var c;let d,e,f,g,h;c=this.manager,d=b.pointers.length,e=b.changedPointers.length,f=a&xW.Start&&d-e==0,g=a&(xW.End|xW.Cancel)&&d-e==0,b.isFirst=!!f,b.isFinal=!!g,f&&(c.session={}),b.eventType=a,h=function(a,b){var c,d;let e,f,g,h,i,{session:j}=a,{pointers:k}=b,{length:l}=k;j.firstInput||(j.firstInput=g2(b)),l>1&&!j.firstMultiple?j.firstMultiple=g2(b):1===l&&(j.firstMultiple=!1);let{firstInput:n,firstMultiple:o}=j,p=o?o.center:n.center,q=b.center=g1(k);b.timeStamp=Date.now(),b.deltaTime=b.timeStamp-n.timeStamp,e=q.x-p.x,b.angle=180*Math.atan2(q.y-p.y,e)/Math.PI,b.distance=g3(p,q);let{deltaX:r,deltaY:s}=(f=b.center,g=j.offsetDelta,h=j.prevDelta,i=j.prevInput,(b.eventType===xW.Start||i?.eventType===xW.End)&&(h=j.prevDelta={x:i?.deltaX||0,y:i?.deltaY||0},g=j.offsetDelta={x:f.x,y:f.y}),{deltaX:h.x+(f.x-g.x),deltaY:h.y+(f.y-g.y)});b.deltaX=r,b.deltaY=s,b.offsetDirection=g6(b.deltaX,b.deltaY);let t=g7(b.deltaTime,b.deltaX,b.deltaY);b.overallVelocityX=t.x,b.overallVelocityY=t.y,b.overallVelocity=Math.abs(t.x)>Math.abs(t.y)?t.x:t.y,b.scale=o?(c=o.pointers,g4(k[0],k[1])/g4(c[0],c[1])):1,b.rotation=o?(d=o.pointers,g5(k[1],k[0])-g5(d[1],d[0])):0,b.maxPointers=j.prevInput?b.pointers.length>j.prevInput.maxPointers?b.pointers.length:j.prevInput.maxPointers:b.pointers.length;let u=a.element;return function(a,b){let c=a;for(;c;){if(c===b)return!0;c=c.parentNode}return!1}(b.srcEvent.target,u)&&(u=b.srcEvent.target),b.target=u,!function(a,b){let c,d,e,f,g=a.lastInterval||b,h=b.timeStamp-g.timeStamp;if(b.eventType!==xW.Cancel&&(h>25||void 0===g.velocity)){let i=b.deltaX-g.deltaX,j=b.deltaY-g.deltaY,k=g7(h,i,j);d=k.x,e=k.y,c=Math.abs(k.x)>Math.abs(k.y)?k.x:k.y,f=g6(i,j),a.lastInterval=b}else c=g.velocity,d=g.velocityX,e=g.velocityY,f=g.direction;b.velocity=c,b.velocityX=d,b.velocityY=e,b.direction=f}(j,b),b}(c,b),c.emit("hammer.input",h),c.recognize(h),c.session.prevInput=h}init(){g$(this.element,this.evEl,this.domHandler),g$(this.target,this.evTarget,this.domHandler),g$(g0(this.element),this.evWin,this.domHandler)}destroy(){g_(this.element,this.evEl,this.domHandler),g_(this.target,this.evTarget,this.domHandler),g_(g0(this.element),this.evWin,this.domHandler)}}let g9={pointerdown:xW.Start,pointermove:xW.Move,pointerup:xW.End,pointercancel:xW.Cancel,pointerout:xW.Cancel};class ha extends g8{constructor(a){super(a),this.evEl="pointerdown",this.evWin="pointermove pointerup pointercancel",this.store=this.manager.session.pointerEvents=[],this.init()}handler(a){let{store:b}=this,c=!1,d=g9[a.type],e=a.pointerType,f="touch"===e,g=b.findIndex(b=>b.pointerId===a.pointerId);d&xW.Start&&(a.buttons||f)?g<0&&(b.push(a),g=b.length-1):d&(xW.End|xW.Cancel)&&(c=!0),!(g<0)&&(b[g]=a,this.callback(d,{pointers:b,changedPointers:[a],eventType:d,pointerType:e,srcEvent:a}),c&&b.splice(g,1))}}let hb=["","webkit","Moz","MS","ms","o"],hc={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class hd{constructor(a,b){this.options={...hc,...b,cssProps:{...hc.cssProps,...b.cssProps},inputTarget:b.inputTarget||a},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=a,this.input=new ha(this),this.touchAction=new gY(this,this.options.touchAction),this.toggleCssProps(!0)}set(a){return Object.assign(this.options,a),a.touchAction&&this.touchAction.update(),a.inputTarget&&(this.input.destroy(),this.input.target=a.inputTarget,this.input.init()),this}stop(a){this.session.stopped=a?2:1}recognize(a){let b,{session:c}=this;if(c.stopped)return;this.session.prevented&&a.srcEvent.preventDefault();let{recognizers:d}=this,{curRecognizer:e}=c;(!e||e&&e.state&xY.Recognized)&&(e=c.curRecognizer=null);let f=0;for(;f<d.length;)b=d[f],2!==c.stopped&&(!e||b===e||b.canRecognizeWith(e))?b.recognize(a):b.reset(),!e&&b.state&(xY.Began|xY.Changed|xY.Ended)&&(e=c.curRecognizer=b),f++}get(a){let{recognizers:b}=this;for(let c=0;c<b.length;c++)if(b[c].options.event===a)return b[c];return null}add(a){if(Array.isArray(a)){for(let b of a)this.add(b);return this}let b=this.get(a.options.event);return b&&this.remove(b),this.recognizers.push(a),a.manager=this,this.touchAction.update(),a}remove(a){if(Array.isArray(a)){for(let b of a)this.remove(b);return this}let b="string"==typeof a?this.get(a):a;if(b){let{recognizers:a}=this,c=a.indexOf(b);-1!==c&&(a.splice(c,1),this.touchAction.update())}return this}on(a,b){if(!a||!b)return;let{handlers:c}=this;for(let d of gZ(a))c[d]=c[d]||[],c[d].push(b)}off(a,b){if(!a)return;let{handlers:c}=this;for(let d of gZ(a))b?c[d]&&c[d].splice(c[d].indexOf(b),1):delete c[d]}emit(a,b){let c=this.handlers[a]&&this.handlers[a].slice();if(!c||!c.length)return;b.type=a,b.preventDefault=function(){b.srcEvent.preventDefault()};let d=0;for(;d<c.length;)c[d](b),d++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(a){let{element:b}=this;if(b){for(let[c,d]of Object.entries(this.options.cssProps)){let e=function(a,b){let c=b[0].toUpperCase()+b.slice(1);for(let d of hb){let e=d?d+c:b;if(e in a)return e}}(b.style,c);a?(this.oldCssProps[e]=b.style[e],b.style[e]=d):b.style[e]=this.oldCssProps[e]||""}a||(this.oldCssProps={})}}}let he=1;function hf(a){return a&xY.Cancelled?"cancel":a&xY.Ended?"end":a&xY.Changed?"move":a&xY.Began?"start":""}class hg{constructor(a){this.options=a,this.id=he++,this.state=xY.Possible,this.simultaneous={},this.requireFail=[]}set(a){return Object.assign(this.options,a),this.manager.touchAction.update(),this}recognizeWith(a){let b;if(Array.isArray(a)){for(let b of a)this.recognizeWith(b);return this}if("string"==typeof a){if(!(b=this.manager.get(a)))throw Error(`Cannot find recognizer ${a}`)}else b=a;let{simultaneous:c}=this;return c[b.id]||(c[b.id]=b,b.recognizeWith(this)),this}dropRecognizeWith(a){let b;if(Array.isArray(a)){for(let b of a)this.dropRecognizeWith(b);return this}return(b="string"==typeof a?this.manager.get(a):a)&&delete this.simultaneous[b.id],this}requireFailure(a){let b;if(Array.isArray(a)){for(let b of a)this.requireFailure(b);return this}if("string"==typeof a){if(!(b=this.manager.get(a)))throw Error(`Cannot find recognizer ${a}`)}else b=a;let{requireFail:c}=this;return -1===c.indexOf(b)&&(c.push(b),b.requireFailure(this)),this}dropRequireFailure(a){let b;if(Array.isArray(a)){for(let b of a)this.dropRequireFailure(b);return this}if(b="string"==typeof a?this.manager.get(a):a){let a=this.requireFail.indexOf(b);a>-1&&this.requireFail.splice(a,1)}return this}hasRequireFailures(){return!!this.requireFail.find(a=>a.options.enable)}canRecognizeWith(a){return!!this.simultaneous[a.id]}emit(a){if(!a)return;let{state:b}=this;b<xY.Ended&&this.manager.emit(this.options.event+hf(b),a),this.manager.emit(this.options.event,a),a.additionalEvent&&this.manager.emit(a.additionalEvent,a),b>=xY.Ended&&this.manager.emit(this.options.event+hf(b),a)}tryEmit(a){this.canEmit()?this.emit(a):this.state=xY.Failed}canEmit(){let a=0;for(;a<this.requireFail.length;){if(!(this.requireFail[a].state&(xY.Failed|xY.Possible)))return!1;a++}return!0}recognize(a){let b={...a};if(!this.options.enable){this.reset(),this.state=xY.Failed;return}this.state&(xY.Recognized|xY.Cancelled|xY.Failed)&&(this.state=xY.Possible),this.state=this.process(b),this.state&(xY.Began|xY.Changed|xY.Ended|xY.Cancelled)&&this.tryEmit(b)}getEventNames(){return[this.options.event]}reset(){}}class hh extends hg{attrTest(a){let b=this.options.pointers;return 0===b||a.pointers.length===b}process(a){let{state:b}=this,{eventType:c}=a,d=b&(xY.Began|xY.Changed),e=this.attrTest(a);return d&&(c&xW.Cancel||!e)?b|xY.Cancelled:d||e?c&xW.End?b|xY.Ended:b&xY.Began?b|xY.Changed:xY.Began:xY.Failed}}class hi extends hg{constructor(a={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...a}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[gU]}process(a){let{options:b}=this,c=a.pointers.length===b.pointers,d=a.distance<b.threshold,e=a.deltaTime<b.time;if(this.reset(),a.eventType&xW.Start&&0===this.count)return this.failTimeout();if(d&&e&&c){if(a.eventType!==xW.End)return this.failTimeout();let c=!this.pTime||a.timeStamp-this.pTime<b.interval,d=!this.pCenter||g3(this.pCenter,a.center)<b.posThreshold;if(this.pTime=a.timeStamp,this.pCenter=a.center,d&&c?this.count+=1:this.count=1,this._input=a,0==this.count%b.taps)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=xY.Recognized,this.tryEmit(this._input)},b.interval),xY.Began):xY.Recognized}return xY.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=xY.Failed},this.options.interval),xY.Failed}reset(){clearTimeout(this._timer)}emit(a){this.state===xY.Recognized&&(a.tapCount=this.count,this.manager.emit(this.options.event,a))}}let hj=["","start","move","end","cancel","up","down","left","right"];class hk extends hh{constructor(a={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:xX.All,...a}),this.pX=null,this.pY=null}getTouchAction(){let{options:{direction:a}}=this,b=[];return a&xX.Horizontal&&b.push(gX),a&xX.Vertical&&b.push(gW),b}getEventNames(){return hj.map(a=>this.options.event+a)}directionTest(a){let{options:b}=this,c=!0,{distance:d}=a,{direction:e}=a,f=a.deltaX,g=a.deltaY;return e&b.direction||(b.direction&xX.Horizontal?(e=0===f?xX.None:f<0?xX.Left:xX.Right,c=f!==this.pX,d=Math.abs(a.deltaX)):(e=0===g?xX.None:g<0?xX.Up:xX.Down,c=g!==this.pY,d=Math.abs(a.deltaY))),a.direction=e,c&&d>b.threshold&&!!(e&b.direction)}attrTest(a){return super.attrTest(a)&&(!!(this.state&xY.Began)||!(this.state&xY.Began)&&this.directionTest(a))}emit(a){this.pX=a.deltaX,this.pY=a.deltaY;let b=xX[a.direction].toLowerCase();b&&(a.additionalEvent=this.options.event+b),super.emit(a)}}let hl=["","start","move","end","cancel","in","out"];class hm{constructor(a,b,c){this.element=a,this.callback=b,this.options=c}}let hn="undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"";a.g,a.g;let ho=-1!==hn.indexOf("firefox");class hp extends hm{constructor(a,b,c){super(a,b,{enable:!0,...c}),this.handleEvent=a=>{if(!this.options.enable)return;let b=a.deltaY;globalThis.WheelEvent&&(ho&&a.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(b/=globalThis.devicePixelRatio),a.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(b*=40)),0!==b&&b%4.000244140625==0&&(b=Math.floor(b/4.000244140625)),a.shiftKey&&b&&(b*=.25),this.callback({type:"wheel",center:{x:a.clientX,y:a.clientY},delta:-b,srcEvent:a,pointerType:"mouse",target:a.target})},a.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(a,b){"wheel"===a&&(this.options.enable=b)}}let hq=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class hr extends hm{constructor(a,b,c){super(a,b,{enable:!0,...c}),this.handleEvent=a=>{this.handleOverEvent(a),this.handleOutEvent(a),this.handleEnterEvent(a),this.handleLeaveEvent(a),this.handleMoveEvent(a)},this.pressed=!1;const{enable:d}=this.options;this.enableMoveEvent=d,this.enableLeaveEvent=d,this.enableEnterEvent=d,this.enableOutEvent=d,this.enableOverEvent=d,hq.forEach(b=>a.addEventListener(b,this.handleEvent))}destroy(){hq.forEach(a=>this.element.removeEventListener(a,this.handleEvent))}enableEventType(a,b){switch(a){case"pointermove":this.enableMoveEvent=b;break;case"pointerover":this.enableOverEvent=b;break;case"pointerout":this.enableOutEvent=b;break;case"pointerenter":this.enableEnterEvent=b;break;case"pointerleave":this.enableLeaveEvent=b}}handleOverEvent(a){this.enableOverEvent&&"mouseover"===a.type&&this._emit("pointerover",a)}handleOutEvent(a){this.enableOutEvent&&"mouseout"===a.type&&this._emit("pointerout",a)}handleEnterEvent(a){this.enableEnterEvent&&"mouseenter"===a.type&&this._emit("pointerenter",a)}handleLeaveEvent(a){this.enableLeaveEvent&&"mouseleave"===a.type&&this._emit("pointerleave",a)}handleMoveEvent(a){if(this.enableMoveEvent)switch(a.type){case"mousedown":a.button>=0&&(this.pressed=!0);break;case"mousemove":0===a.buttons&&(this.pressed=!1),this.pressed||this._emit("pointermove",a);break;case"mouseup":this.pressed=!1}}_emit(a,b){this.callback({type:a,center:{x:b.clientX,y:b.clientY},srcEvent:b,pointerType:"mouse",target:b.target})}}let hs=["keydown","keyup"];class ht extends hm{constructor(a,b,c){super(a,b,{enable:!0,tabIndex:0,...c}),this.handleEvent=a=>{let b=a.target||a.srcElement;("INPUT"!==b.tagName||"text"!==b.type)&&"TEXTAREA"!==b.tagName&&(this.enableDownEvent&&"keydown"===a.type&&this.callback({type:"keydown",srcEvent:a,key:a.key,target:a.target}),this.enableUpEvent&&"keyup"===a.type&&this.callback({type:"keyup",srcEvent:a,key:a.key,target:a.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,a.tabIndex=this.options.tabIndex,a.style.outline="none",hs.forEach(b=>a.addEventListener(b,this.handleEvent))}destroy(){hs.forEach(a=>this.element.removeEventListener(a,this.handleEvent))}enableEventType(a,b){"keydown"===a&&(this.enableDownEvent=b),"keyup"===a&&(this.enableUpEvent=b)}}class hu extends hm{constructor(a,b,c){super(a,b,c),this.handleEvent=a=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:a.clientX,y:a.clientY},srcEvent:a,pointerType:"mouse",target:a.target})},a.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(a,b){"contextmenu"===a&&(this.options.enable=b)}}let hv={pointerdown:1,pointermove:2,pointerup:4,mousedown:1,mousemove:2,mouseup:4},hw={srcElement:"root",priority:0};class hx{constructor(a,b){this.handleEvent=a=>{if(this.isEmpty())return;let b=this._normalizeEvent(a),c=a.srcEvent.target;for(;c&&c!==b.rootElement;){if(this._emit(b,c),b.handled)return;c=c.parentNode}this._emit(b,"root")},this.eventManager=a,this.recognizerName=b,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(a,b,c,d=!1,e=!1){let{handlers:f,handlersByElement:g}=this,h={...hw,...c},i=g.get(h.srcElement);i||(i=[],g.set(h.srcElement,i));let j={type:a,handler:b,srcElement:h.srcElement,priority:h.priority};d&&(j.once=!0),e&&(j.passive=!0),f.push(j),this._active=this._active||!j.passive;let k=i.length-1;for(;k>=0&&!(i[k].priority>=j.priority);)k--;i.splice(k+1,0,j)}remove(a,b){let{handlers:c,handlersByElement:d}=this;for(let e=c.length-1;e>=0;e--){let f=c[e];if(f.type===a&&f.handler===b){c.splice(e,1);let a=d.get(f.srcElement);a.splice(a.indexOf(f),1),0===a.length&&d.delete(f.srcElement)}}this._active=c.some(a=>!a.passive)}_emit(a,b){let c=this.handlersByElement.get(b);if(c){let b=!1,d=()=>{a.handled=!0},e=()=>{a.handled=!0,b=!0},f=[];for(let g=0;g<c.length;g++){let{type:h,handler:i,once:j}=c[g];if(i({...a,type:h,stopPropagation:d,stopImmediatePropagation:e}),j&&f.push(c[g]),b)break}for(let a=0;a<f.length;a++){let{type:b,handler:c}=f[a];this.remove(b,c)}}}_normalizeEvent(a){let b=this.eventManager.getElement();return{...a,...function(a){let b=hv[a.srcEvent.type];if(!b)return null;let{buttons:c,button:d}=a.srcEvent,e=!1,f=!1,g=!1;return 2===b?(e=!!(1&c),f=!!(4&c),g=!!(2&c)):(e=0===d,f=1===d,g=2===d),{leftButton:e,middleButton:f,rightButton:g}}(a),...function(a,b){let c=a.center;if(!c)return null;let d=b.getBoundingClientRect(),e=d.width/b.offsetWidth||1,f=d.height/b.offsetHeight||1,g={x:(c.x-d.left-b.clientLeft)/e,y:(c.y-d.top-b.clientTop)/f};return{center:c,offsetCenter:g}}(a,b),preventDefault:()=>{a.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:b}}}class hy{constructor(a=null,b={}){if(this._onBasicInput=a=>{this.manager.emit(a.srcEvent.type,a)},this._onOtherEvent=a=>{this.manager.emit(a.type,a)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...b},this.events=new Map,this.element=a,!a)return;for(const b of(this.manager=new hd(a,this.options),this.options.recognizers)){const{recognizer:a,recognizeWith:c,requireFailure:d}=function(a){let b;if("recognizer"in a)return a;let c=Array.isArray(a)?[...a]:[a];return{recognizer:b="function"==typeof c[0]?new(c.shift())(c.shift()||{}):c.shift(),recognizeWith:"string"==typeof c[0]?[c[0]]:c[0],requireFailure:"string"==typeof c[1]?[c[1]]:c[1]}}(b);this.manager.add(a),c&&a.recognizeWith(c),d&&a.requireFailure(d)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new hp(a,this._onOtherEvent,{enable:!1}),this.moveInput=new hr(a,this._onOtherEvent,{enable:!1}),this.keyInput=new ht(a,this._onOtherEvent,{enable:!1,tabIndex:b.tabIndex}),this.contextmenuInput=new hu(a,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(a,b,c){this._addEventHandler(a,b,c,!1)}once(a,b,c){this._addEventHandler(a,b,c,!0)}watch(a,b,c){this._addEventHandler(a,b,c,!1,!0)}off(a,b){this._removeEventHandler(a,b)}_toggleRecognizer(a,b){let{manager:c}=this;if(!c)return;let d=c.get(a);d&&(d.set({enable:b}),c.touchAction.update()),this.wheelInput?.enableEventType(a,b),this.moveInput?.enableEventType(a,b),this.keyInput?.enableEventType(a,b),this.contextmenuInput?.enableEventType(a,b)}_addEventHandler(a,b,c,d,e){if("string"!=typeof a){for(let[f,g]of(c=b,Object.entries(a)))this._addEventHandler(f,g,c,d,e);return}let{manager:f,events:g}=this;if(!f)return;let h=g.get(a);!h&&(h=new hx(this,this._getRecognizerName(a)||a),g.set(a,h),f&&f.on(a,h.handleEvent)),h.add(a,b,c,d,e),h.isEmpty()||this._toggleRecognizer(h.recognizerName,!0)}_removeEventHandler(a,b){if("string"!=typeof a){for(let[b,c]of Object.entries(a))this._removeEventHandler(b,c);return}let{events:c}=this,d=c.get(a);if(d&&(d.remove(a,b),d.isEmpty())){let{recognizerName:a}=d,b=!1;for(let d of c.values())if(d.recognizerName===a&&!d.isEmpty()){b=!0;break}b||this._toggleRecognizer(a,!1)}}_getRecognizerName(a){return this.manager.recognizers.find(b=>b.getEventNames().includes(a))?.options.event}}let hz={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(hz,"IDENTITY",{get:()=>(gT.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});let hA={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},hB={common:0,meters:1,pixels:2},hC={click:"onClick",dblclick:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},hD={multipan:[hk,{threshold:10,direction:xX.Vertical,pointers:2}],pinch:[class extends hh{constructor(a={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...a})}getTouchAction(){return[gV]}getEventNames(){return hl.map(a=>this.options.event+a)}attrTest(a){return super.attrTest(a)&&(Math.abs(a.scale-1)>this.options.threshold||!!(this.state&xY.Began))}emit(a){if(1!==a.scale){let b=a.scale<1?"in":"out";a.additionalEvent=this.options.event+b}super.emit(a)}},{},null,["multipan"]],pan:[hk,{threshold:1},["pinch"],["multipan"]],dblclick:[hi,{event:"dblclick",taps:2}],click:[hi,{event:"click"},null,["dblclick"]]};function hE(a){let b,c={};return d=>{for(let e in d)if(!function(a,b){if(a===b)return!0;if(Array.isArray(a)){let c=a.length;if(!b||b.length!==c)return!1;for(let d=0;d<c;d++)if(a[d]!==b[d])return!1;return!0}return!1}(d[e],c[e])){b=a(d),c=d;break}return b}}let hF=[0,0,0,0],hG=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],hH=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],hI=[0,0,0],hJ=[0,0,0],hK=hE(function({viewport:a,devicePixelRatio:b,coordinateSystem:c,coordinateOrigin:d}){let{projectionCenter:e,viewProjectionMatrix:f,originCommon:g,cameraPosCommon:h,shaderCoordinateOrigin:i,geospatialOrigin:j}=function(a,b,c){let{viewMatrixUncentered:d,projectionMatrix:e}=a,{viewMatrix:f,viewProjectionMatrix:g}=a,h=hF,i=hF,j=a.cameraPosition,{geospatialOrigin:k,shaderCoordinateOrigin:l,offsetMode:n}=hL(a,b,c);return n&&(i=a.projectPosition(k||l),j=[j[0]-i[0],j[1]-i[1],j[2]-i[2]],i[3]=1,h=gR.transformMat4([],i,g),f=d||f,g=gi.multiply([],e,f),g=gi.multiply([],g,hG)),{viewMatrix:f,viewProjectionMatrix:g,projectionCenter:h,originCommon:i,cameraPosCommon:j,shaderCoordinateOrigin:l,geospatialOrigin:k}}(a,c,d),k=a.getDistanceScales(),l=[a.width*b,a.height*b],n=gR.transformMat4([],[0,0,-a.focalDistance,1],a.projectionMatrix)[3]||1,o={coordinateSystem:c,projectionMode:a.projectionMode,coordinateOrigin:i,commonOrigin:g.slice(0,3),center:e,pseudoMeters:!!a._pseudoMeters,viewportSize:l,devicePixelRatio:b,focalDistance:n,commonUnitsPerMeter:k.unitsPerMeter,commonUnitsPerWorldUnit:k.unitsPerMeter,commonUnitsPerWorldUnit2:hI,scale:a.scale,wrapLongitude:!1,viewProjectionMatrix:f,modelMatrix:hH,cameraPosition:h};if(j){let b=a.getDistanceScales(j);switch(c){case hz.METER_OFFSETS:o.commonUnitsPerWorldUnit=b.unitsPerMeter,o.commonUnitsPerWorldUnit2=b.unitsPerMeter2;break;case hz.LNGLAT:case hz.LNGLAT_OFFSETS:a._pseudoMeters||(o.commonUnitsPerMeter=b.unitsPerMeter),o.commonUnitsPerWorldUnit=b.unitsPerDegree,o.commonUnitsPerWorldUnit2=b.unitsPerDegree2;break;case hz.CARTESIAN:o.commonUnitsPerWorldUnit=[1,1,b.unitsPerMeter[2]],o.commonUnitsPerWorldUnit2=[0,0,b.unitsPerMeter2[2]]}}return o});function hL(a,b,c=hJ){let d;c.length<3&&(c=[c[0],c[1],0]);let e=c,f=!0;switch(d=b===hz.LNGLAT_OFFSETS||b===hz.METER_OFFSETS?c:a.isGeospatial?[Math.fround(a.longitude),Math.fround(a.latitude),0]:null,a.projectionMode){case hA.WEB_MERCATOR:(b===hz.LNGLAT||b===hz.CARTESIAN)&&(d=[0,0,0],f=!1);break;case hA.WEB_MERCATOR_AUTO_OFFSET:b===hz.LNGLAT?e=d:b===hz.CARTESIAN&&(e=[Math.fround(a.center[0]),Math.fround(a.center[1]),0],d=a.unprojectPosition(e),e[0]-=c[0],e[1]-=c[1],e[2]-=c[2]);break;case hA.IDENTITY:(e=a.position.map(Math.fround))[2]=e[2]||0;break;case hA.GLOBE:f=!1,d=null;break;default:f=!1}return{geospatialOrigin:d,shaderCoordinateOrigin:e,offsetMode:f}}let hM=Object.keys(hz).map(a=>`const COORDINATE_SYSTEM_${a}: i32 = ${hz[a]};`).join(""),hN=Object.keys(hA).map(a=>`const PROJECTION_MODE_${a}: i32 = ${hA[a]};`).join(""),hO=Object.keys(hB).map(a=>`const UNIT_${a.toUpperCase()}: i32 = ${hB[a]};`).join(""),hP=`\
${hM}
${hN}
${hO}

const TILE_SIZE: f32 = 512.0;
const PI: f32 = 3.1415926536;
const WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);
const ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);
const EARTH_RADIUS: f32 = 6370972.0; // meters
const GLOBE_RADIUS: f32 = 256.0;

// -----------------------------------------------------------------------------
// Uniform block (converted from GLSL uniform block)
// -----------------------------------------------------------------------------
struct ProjectUniforms {
  wrapLongitude: i32,
  coordinateSystem: i32,
  commonUnitsPerMeter: vec3<f32>,
  projectionMode: i32,
  scale: f32,
  commonUnitsPerWorldUnit: vec3<f32>,
  commonUnitsPerWorldUnit2: vec3<f32>,
  center: vec4<f32>,
  modelMatrix: mat4x4<f32>,
  viewProjectionMatrix: mat4x4<f32>,
  viewportSize: vec2<f32>,
  devicePixelRatio: f32,
  focalDistance: f32,
  cameraPosition: vec3<f32>,
  coordinateOrigin: vec3<f32>,
  commonOrigin: vec3<f32>,
  pseudoMeters: i32,
};

@group(0) @binding(0)
var<uniform> project: ProjectUniforms;

// -----------------------------------------------------------------------------
// Geometry data
// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,
// you might supply this via vertex attributes or a uniform. Here we define a
// uniform struct for demonstration.)
// -----------------------------------------------------------------------------

// Structure to carry additional geometry data used by deck.gl filters.
struct Geometry {
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  position: vec4<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

// @group(0) @binding(1)
var<private> geometry: Geometry;
`,hQ=`\
${hP}

// -----------------------------------------------------------------------------
// Functions
// -----------------------------------------------------------------------------

// Returns an adjustment factor for commonUnitsPerMeter
fn _project_size_at_latitude(lat: f32) -> f32 {
  let y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

// Overloaded version: scales a value in meters at a given latitude.
fn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);
}

// Computes a non-linear scale factor based on geometry.
// (Note: This function relies on "geometry" being provided.)
fn project_size() -> f32 {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
      project.pseudoMeters == 0) {
    if (geometry.position.w == 0.0) {
      return _project_size_at_latitude(geometry.worldPosition.y);
    }
    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    let y2 = y * y;
    let y4 = y2 * y2;
    let y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

// Overloads to scale offsets (meters to world units)
fn project_size_float(meters: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * project_size();
}

fn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {
  return meters * project.commonUnitsPerMeter.xy * project_size();
}

fn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {
  return meters * project.commonUnitsPerMeter * project_size();
}

fn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {
  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);
}

// Returns a rotation matrix aligning the zaxis with the given up vector.
fn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {
  let uz = normalize(up);
  let ux = select(
    vec3<f32>(1.0, 0.0, 0.0),
    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),
    abs(uz.z) == 1.0
  );
  let uy = cross(uz, ux);
  return mat3x3<f32>(ux, uy, uz);
}

// Since WGSL does not support "out" parameters, we return a struct.
struct RotationResult {
  needsRotation: bool,
  transform: mat3x3<f32>,
};

fn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    return RotationResult(true, project_get_orientation_matrix(commonPosition));
  } else {
    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed
  };
}

// Projects a normal vector from the current coordinate system to world space.
fn project_normal(vector: vec3<f32>) -> vec3<f32> {
  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);
  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
  let rotResult = project_needs_rotation(geometry.position.xyz);
  if (rotResult.needsRotation) {
    n = rotResult.transform * n;
  }
  return n;
}

// Applies a scale offset based on y-offset (dy)
fn project_offset_(offset: vec4<f32>) -> vec4<f32> {
  let dy: f32 = offset.y;
  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

// Projects lng/lat coordinates to a unit tile [0,1]
fn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {
  var x = lnglat.x;
  if (project.wrapLongitude != 0) {
    x = ((x + 180.0) % 360.0) - 180.0;
  }
  let y = clamp(lnglat.y, -89.9, 89.9);
  return vec2<f32>(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// Projects lng/lat/z coordinates for a globe projection.
fn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {
  let lambda = radians(lnglatz.x);
  let phi = radians(lnglatz.y);
  let cosPhi = cos(phi);
  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
  return vec3<f32>(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

// Projects positions (with an optional 64-bit low part) from the input
// coordinate system to the common space.
fn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {
  var position_world = project.modelMatrix * position;

  // Work around for a Mac+NVIDIA bug:
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_mercator_(position_world.xy),
        _project_size_at_latitude_m(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);
    }
  }
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
        return vec4<f32>(
          project_mercator_(position_world.xy) - project.commonOrigin.xy,
          project_size_float(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);
  }

  return project_offset_(position_world) +
         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));
}

// Overloaded versions for different input types.
fn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {
  return project_position_vec4_f64(position, ZERO_64_LOW);
}

fn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);
  return projected_position.xyz;
}

fn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

fn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

// Transforms a common space position to clip space.
fn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {
  return viewProjectionMatrix * position + center;
}

// Uses the project viewProjectionMatrix and center.
fn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {
  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);
}

// Returns a clip space offset corresponding to a given number of screen pixels.
fn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {
  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
  return offset * project.focalDistance;
}

fn project_meter_size_to_pixel(meters: f32) -> f32 {
  return project_size_float(meters) * project.scale;
}

fn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {
  if (unit == UNIT_METERS) {
    return project_meter_size_to_pixel(size);
  } else if (unit == UNIT_COMMON) {
    return size * project.scale;
  }
  // UNIT_PIXELS: no scaling applied.
  return size;
}

fn project_pixel_size_float(pixels: f32) -> f32 {
  return pixels / project.scale;
}

fn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {
  return pixels / project.scale;
}
`,hR=Object.keys(hz).map(a=>`const int COORDINATE_SYSTEM_${a} = ${hz[a]};`).join(""),hS=Object.keys(hA).map(a=>`const int PROJECTION_MODE_${a} = ${hA[a]};`).join(""),hT=Object.keys(hB).map(a=>`const int UNIT_${a.toUpperCase()} = ${hB[a]};`).join(""),hU={},hV={name:"project",dependencies:[{name:"fp32",vs:fu},ft],source:hQ,vs:`\
${hR}
${hS}
${hT}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`,getUniforms:function(a=hU){return"viewport"in a?function({viewport:a,devicePixelRatio:b=1,modelMatrix:c=null,coordinateSystem:d=hz.DEFAULT,coordinateOrigin:e=hJ,autoWrapLongitude:f=!1}){d===hz.DEFAULT&&(d=a.isGeospatial?hz.LNGLAT:hz.CARTESIAN);let g=hK({viewport:a,devicePixelRatio:b,coordinateSystem:d,coordinateOrigin:e});return g.wrapLongitude=f,g.modelMatrix=c||hH,g}(a):{}},uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},hW={name:"project32",dependencies:[hV],source:`\
// Define a structure to hold both the clip-space position and the common position.
struct ProjectResult {
  clipPosition: vec4<f32>,
  commonPosition: vec4<f32>,
};

// This function mimics the GLSL version with the 'out' parameter by returning both values.
fn project_position_to_clipspace_and_commonspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> ProjectResult {
  // Compute the projected position.
  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);

  // Start with the provided offset.
  var finalOffset: vec3<f32> = offset;

  // Get whether a rotation is needed and the rotation matrix.
  let rotationResult = project_needs_rotation(projectedPosition);

  // If rotation is needed, update the offset.
  if (rotationResult.needsRotation) {
    finalOffset = rotationResult.transform * offset;
  }

  // Compute the common position.
  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);

  // Convert to clip-space.
  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);

  return ProjectResult(clipPosition, commonPosition);
}

// A convenience overload that returns only the clip-space position.
fn project_position_to_clipspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> vec4<f32> {
  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;
}
`,vs:`\
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`};globalThis.mathgl=globalThis.mathgl||{config:{EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1}};let hX=globalThis.mathgl.config;function hY(a){return Array.isArray(a)||ArrayBuffer.isView(a)&&!(a instanceof DataView)}function hZ(a,b,c){return function(a,b,c){if(hY(a)){c=c||(a.clone?a.clone():Array(a.length));for(let d=0;d<c.length&&d<a.length;++d){let e="number"==typeof a?a:a[d];c[d]=b(e,d,c)}return c}return b(a)}(a,a=>Math.max(b,Math.min(c,a)))}function h$(a,b,c){return hY(a)?a.map((a,d)=>h$(a,b[d],c)):c*b+(1-c)*a}function h_(a,b,c){let d=hX.EPSILON;c&&(hX.EPSILON=c);try{if(a===b)return!0;if(hY(a)&&hY(b)){if(a.length!==b.length)return!1;for(let c=0;c<a.length;++c)if(!h_(a[c],b[c]))return!1;return!0}if(a&&a.equals)return a.equals(b);if(b&&b.equals)return b.equals(a);if("number"==typeof a&&"number"==typeof b)return Math.abs(a-b)<=hX.EPSILON*Math.max(1,Math.abs(a),Math.abs(b));return!1}finally{hX.EPSILON=d}}class h0 extends Array{clone(){return new this.constructor().copy(this)}fromArray(a,b=0){for(let c=0;c<this.ELEMENTS;++c)this[c]=a[c+b];return this.check()}toArray(a=[],b=0){for(let c=0;c<this.ELEMENTS;++c)a[b+c]=this[c];return a}toObject(a){return a}from(a){return Array.isArray(a)?this.copy(a):this.fromObject(a)}to(a){return a===this?this:hY(a)?this.toArray(a):this.toObject(a)}toTarget(a){return a?this.to(a):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(hX)}formatString(a){let b="";for(let c=0;c<this.ELEMENTS;++c)b+=(c>0?", ":"")+function(a,{precision:b=hX.precision}={}){return a=Math.round(a/hX.EPSILON)*hX.EPSILON,`${parseFloat(a.toPrecision(b))}`}(this[c],a);return`${a.printTypes?this.constructor.name:""}[${b}]`}equals(a){if(!a||this.length!==a.length)return!1;for(let b=0;b<this.ELEMENTS;++b)if(!h_(this[b],a[b]))return!1;return!0}exactEquals(a){if(!a||this.length!==a.length)return!1;for(let b=0;b<this.ELEMENTS;++b)if(this[b]!==a[b])return!1;return!0}negate(){for(let a=0;a<this.ELEMENTS;++a)this[a]=-this[a];return this.check()}lerp(a,b,c){if(void 0===c)return this.lerp(this,a,b);for(let d=0;d<this.ELEMENTS;++d){let e=a[d],f="number"==typeof b?b:b[d];this[d]=e+c*(f-e)}return this.check()}min(a){for(let b=0;b<this.ELEMENTS;++b)this[b]=Math.min(a[b],this[b]);return this.check()}max(a){for(let b=0;b<this.ELEMENTS;++b)this[b]=Math.max(a[b],this[b]);return this.check()}clamp(a,b){for(let c=0;c<this.ELEMENTS;++c)this[c]=Math.min(Math.max(this[c],a[c]),b[c]);return this.check()}add(...a){for(let b of a)for(let a=0;a<this.ELEMENTS;++a)this[a]+=b[a];return this.check()}subtract(...a){for(let b of a)for(let a=0;a<this.ELEMENTS;++a)this[a]-=b[a];return this.check()}scale(a){if("number"==typeof a)for(let b=0;b<this.ELEMENTS;++b)this[b]*=a;else for(let b=0;b<this.ELEMENTS&&b<a.length;++b)this[b]*=a[b];return this.check()}multiplyByScalar(a){for(let b=0;b<this.ELEMENTS;++b)this[b]*=a;return this.check()}check(){if(hX.debug&&!this.validate())throw Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let a=this.length===this.ELEMENTS;for(let b=0;b<this.ELEMENTS;++b)a=a&&Number.isFinite(this[b]);return a}sub(a){return this.subtract(a)}setScalar(a){for(let b=0;b<this.ELEMENTS;++b)this[b]=a;return this.check()}addScalar(a){for(let b=0;b<this.ELEMENTS;++b)this[b]+=a;return this.check()}subScalar(a){return this.addScalar(-a)}multiplyScalar(a){for(let b=0;b<this.ELEMENTS;++b)this[b]*=a;return this.check()}divideScalar(a){return this.multiplyByScalar(1/a)}clampScalar(a,b){for(let c=0;c<this.ELEMENTS;++c)this[c]=Math.min(Math.max(this[c],a),b);return this.check()}get elements(){return this}}function h1(a){if(!Number.isFinite(a))throw Error(`Invalid number ${JSON.stringify(a)}`);return a}function h2(a,b,c=""){if(hX.debug&&!function(a,b){if(a.length!==b)return!1;for(let b=0;b<a.length;++b)if(!Number.isFinite(a[b]))return!1;return!0}(a,b))throw Error(`math.gl: ${c} some fields set to invalid numbers'`);return a}function h3(a,b){if(!a)throw Error(`math.gl assertion ${b}`)}class h4 extends h0{get x(){return this[0]}set x(a){this[0]=h1(a)}get y(){return this[1]}set y(a){this[1]=h1(a)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let a=0;for(let b=0;b<this.ELEMENTS;++b)a+=this[b]*this[b];return a}magnitudeSquared(){return this.lengthSquared()}distance(a){return Math.sqrt(this.distanceSquared(a))}distanceSquared(a){let b=0;for(let c=0;c<this.ELEMENTS;++c){let d=this[c]-a[c];b+=d*d}return h1(b)}dot(a){let b=0;for(let c=0;c<this.ELEMENTS;++c)b+=this[c]*a[c];return h1(b)}normalize(){let a=this.magnitude();if(0!==a)for(let b=0;b<this.ELEMENTS;++b)this[b]/=a;return this.check()}multiply(...a){for(let b of a)for(let a=0;a<this.ELEMENTS;++a)this[a]*=b[a];return this.check()}divide(...a){for(let b of a)for(let a=0;a<this.ELEMENTS;++a)this[a]/=b[a];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(a){return this.distance(a)}distanceToSquared(a){return this.distanceSquared(a)}getComponent(a){return h3(a>=0&&a<this.ELEMENTS,"index is out of range"),h1(this[a])}setComponent(a,b){return h3(a>=0&&a<this.ELEMENTS,"index is out of range"),this[a]=b,this.check()}addVectors(a,b){return this.copy(a).add(b)}subVectors(a,b){return this.copy(a).subtract(b)}multiplyVectors(a,b){return this.copy(a).multiply(b)}addScaledVector(a,b){return this.add(new this.constructor(a).multiplyScalar(b))}}function h5(){let a=new fv(3);return fv!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function h6(a){let b=new fv(3);return b[0]=a[0],b[1]=a[1],b[2]=a[2],b}function h7(a){let b=a[0],c=a[1],d=a[2];return Math.sqrt(b*b+c*c+d*d)}function h8(a,b,c){let d=new fv(3);return d[0]=a,d[1]=b,d[2]=c,d}function h9(a,b){return a[0]=b[0],a[1]=b[1],a[2]=b[2],a}function ia(a,b,c,d){return a[0]=b,a[1]=c,a[2]=d,a}function ib(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a[2]=b[2]+c[2],a}function ic(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a[2]=b[2]-c[2],a}function id(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a[2]=b[2]*c[2],a}function ie(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a[2]=b[2]/c[2],a}function ig(a,b){return a[0]=Math.ceil(b[0]),a[1]=Math.ceil(b[1]),a[2]=Math.ceil(b[2]),a}function ih(a,b){return a[0]=Math.floor(b[0]),a[1]=Math.floor(b[1]),a[2]=Math.floor(b[2]),a}function ii(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a[2]=Math.min(b[2],c[2]),a}function ij(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a[2]=Math.max(b[2],c[2]),a}function ik(a,b){return a[0]=fx(b[0]),a[1]=fx(b[1]),a[2]=fx(b[2]),a}function il(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a[2]=b[2]*c,a}function im(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a[2]=b[2]+c[2]*d,a}function io(a,b){let c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2];return Math.sqrt(c*c+d*d+e*e)}function ip(a,b){let c=b[0]-a[0],d=b[1]-a[1],e=b[2]-a[2];return c*c+d*d+e*e}function iq(a){let b=a[0],c=a[1],d=a[2];return b*b+c*c+d*d}function ir(a,b){return a[0]=-b[0],a[1]=-b[1],a[2]=-b[2],a}function is(a,b){return a[0]=1/b[0],a[1]=1/b[1],a[2]=1/b[2],a}function it(a,b){let c=b[0],d=b[1],e=b[2],f=c*c+d*d+e*e;return f>0&&(f=1/Math.sqrt(f)),a[0]=b[0]*f,a[1]=b[1]*f,a[2]=b[2]*f,a}function iu(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]}function iv(a,b,c){let d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2];return a[0]=e*i-f*h,a[1]=f*g-d*i,a[2]=d*h-e*g,a}function iw(a,b,c,d){let e=b[0],f=b[1],g=b[2];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a[2]=g+d*(c[2]-g),a}function ix(a,b,c,d){let e=Math.acos(Math.min(Math.max(iu(b,c),-1),1)),f=Math.sin(e),g=Math.sin((1-d)*e)/f,h=Math.sin(d*e)/f;return a[0]=g*b[0]+h*c[0],a[1]=g*b[1]+h*c[1],a[2]=g*b[2]+h*c[2],a}function iy(a,b,c,d,e,f){let g=f*f,h=g*(2*f-3)+1,i=g*(f-2)+f,j=g*(f-1),k=g*(3-2*f);return a[0]=b[0]*h+c[0]*i+d[0]*j+e[0]*k,a[1]=b[1]*h+c[1]*i+d[1]*j+e[1]*k,a[2]=b[2]*h+c[2]*i+d[2]*j+e[2]*k,a}function iz(a,b,c,d,e,f){let g=1-f,h=g*g,i=f*f,j=h*g,k=3*f*h,l=3*i*g,n=i*f;return a[0]=b[0]*j+c[0]*k+d[0]*l+e[0]*n,a[1]=b[1]*j+c[1]*k+d[1]*l+e[1]*n,a[2]=b[2]*j+c[2]*k+d[2]*l+e[2]*n,a}function iA(a,b){b=void 0===b?1:b;let c=2*fw()*Math.PI,d=2*fw()-1,e=Math.sqrt(1-d*d)*b;return a[0]=Math.cos(c)*e,a[1]=Math.sin(c)*e,a[2]=d*b,a}function iB(a,b,c){let d=b[0],e=b[1],f=b[2],g=c[3]*d+c[7]*e+c[11]*f+c[15];return g=g||1,a[0]=(c[0]*d+c[4]*e+c[8]*f+c[12])/g,a[1]=(c[1]*d+c[5]*e+c[9]*f+c[13])/g,a[2]=(c[2]*d+c[6]*e+c[10]*f+c[14])/g,a}function iC(a,b,c){let d=b[0],e=b[1],f=b[2];return a[0]=d*c[0]+e*c[3]+f*c[6],a[1]=d*c[1]+e*c[4]+f*c[7],a[2]=d*c[2]+e*c[5]+f*c[8],a}function iD(a,b,c){let d=c[0],e=c[1],f=c[2],g=c[3],h=b[0],i=b[1],j=b[2],k=e*j-f*i,l=f*h-d*j,n=d*i-e*h,o=e*n-f*l,p=f*k-d*n,q=d*l-e*k,r=2*g;return k*=r,l*=r,n*=r,o*=2,p*=2,q*=2,a[0]=h+k+o,a[1]=i+l+p,a[2]=j+n+q,a}function iE(a,b,c,d){let e=[],f=[];return e[0]=b[0]-c[0],e[1]=b[1]-c[1],e[2]=b[2]-c[2],f[0]=e[0],f[1]=e[1]*Math.cos(d)-e[2]*Math.sin(d),f[2]=e[1]*Math.sin(d)+e[2]*Math.cos(d),a[0]=f[0]+c[0],a[1]=f[1]+c[1],a[2]=f[2]+c[2],a}function iF(a,b,c,d){let e=[],f=[];return e[0]=b[0]-c[0],e[1]=b[1]-c[1],e[2]=b[2]-c[2],f[0]=e[2]*Math.sin(d)+e[0]*Math.cos(d),f[1]=e[1],f[2]=e[2]*Math.cos(d)-e[0]*Math.sin(d),a[0]=f[0]+c[0],a[1]=f[1]+c[1],a[2]=f[2]+c[2],a}function iG(a,b,c,d){let e=[],f=[];return e[0]=b[0]-c[0],e[1]=b[1]-c[1],e[2]=b[2]-c[2],f[0]=e[0]*Math.cos(d)-e[1]*Math.sin(d),f[1]=e[0]*Math.sin(d)+e[1]*Math.cos(d),f[2]=e[2],a[0]=f[0]+c[0],a[1]=f[1]+c[1],a[2]=f[2]+c[2],a}function iH(a,b){let c=a[0],d=a[1],e=a[2],f=b[0],g=b[1],h=b[2],i=Math.sqrt((c*c+d*d+e*e)*(f*f+g*g+h*h));return Math.acos(Math.min(Math.max(i&&iu(a,b)/i,-1),1))}function iI(a){return a[0]=0,a[1]=0,a[2]=0,a}function iJ(a){return`vec3(${a[0]}, ${a[1]}, ${a[2]})`}function iK(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]}function iL(a,b){let c=a[0],d=a[1],e=a[2],f=b[0],g=b[1],h=b[2];return Math.abs(c-f)<=1e-6*Math.max(1,Math.abs(c),Math.abs(f))&&Math.abs(d-g)<=1e-6*Math.max(1,Math.abs(d),Math.abs(g))&&Math.abs(e-h)<=1e-6*Math.max(1,Math.abs(e),Math.abs(h))}let iM=(i=h5(),function(a,b,c,d,e,f){let g,h;for(b||(b=3),c||(c=0),h=d?Math.min(d*b+c,a.length):a.length,g=c;g<h;g+=b)i[0]=a[g],i[1]=a[g+1],i[2]=a[g+2],e(i,i,f),a[g]=i[0],a[g+1]=i[1],a[g+2]=i[2];return a});function iN(a,b,c){let d=b[0],e=b[1],f=b[2],g=c[3]*d+c[7]*e+c[11]*f||1;return a[0]=(c[0]*d+c[4]*e+c[8]*f)/g,a[1]=(c[1]*d+c[5]*e+c[9]*f)/g,a[2]=(c[2]*d+c[6]*e+c[10]*f)/g,a}a.s(["add",()=>ib,"angle",()=>iH,"bezier",()=>iz,"ceil",()=>ig,"clone",()=>h6,"copy",()=>h9,"create",()=>h5,"cross",()=>iv,"dist",0,io,"distance",()=>io,"div",0,ie,"divide",()=>ie,"dot",()=>iu,"equals",()=>iL,"exactEquals",()=>iK,"floor",()=>ih,"forEach",0,iM,"fromValues",()=>h8,"hermite",()=>iy,"inverse",()=>is,"len",0,h7,"length",()=>h7,"lerp",()=>iw,"max",()=>ij,"min",()=>ii,"mul",0,id,"multiply",()=>id,"negate",()=>ir,"normalize",()=>it,"random",()=>iA,"rotateX",()=>iE,"rotateY",()=>iF,"rotateZ",()=>iG,"round",()=>ik,"scale",()=>il,"scaleAndAdd",()=>im,"set",()=>ia,"slerp",()=>ix,"sqrDist",0,ip,"sqrLen",0,iq,"squaredDistance",()=>ip,"squaredLength",()=>iq,"str",()=>iJ,"sub",0,ic,"subtract",()=>ic,"transformMat3",()=>iC,"transformMat4",()=>iB,"transformQuat",()=>iD,"zero",()=>iI],72255);let iO=[0,0,0];class iP extends h4{static get ZERO(){return c||Object.freeze(c=new iP(0,0,0)),c}constructor(a=0,b=0,c=0){super(-0,-0,-0),1==arguments.length&&hY(a)?this.copy(a):(hX.debug&&(h1(a),h1(b),h1(c)),this[0]=a,this[1]=b,this[2]=c)}set(a,b,c){return this[0]=a,this[1]=b,this[2]=c,this.check()}copy(a){return this[0]=a[0],this[1]=a[1],this[2]=a[2],this.check()}fromObject(a){return hX.debug&&(h1(a.x),h1(a.y),h1(a.z)),this[0]=a.x,this[1]=a.y,this[2]=a.z,this.check()}toObject(a){return a.x=this[0],a.y=this[1],a.z=this[2],a}get ELEMENTS(){return 3}get z(){return this[2]}set z(a){this[2]=h1(a)}angle(a){return iH(this,a)}cross(a){return iv(this,this,a),this.check()}rotateX({radians:a,origin:b=iO}){return iE(this,this,b,a),this.check()}rotateY({radians:a,origin:b=iO}){return iF(this,this,b,a),this.check()}rotateZ({radians:a,origin:b=iO}){return iG(this,this,b,a),this.check()}transform(a){return this.transformAsPoint(a)}transformAsPoint(a){return iB(this,this,a),this.check()}transformAsVector(a){return iN(this,this,a),this.check()}transformByMatrix3(a){return iC(this,this,a),this.check()}transformByMatrix2(a){let b,c;return b=this[0],c=this[1],this[0]=a[0]*b+a[2]*c,this[1]=a[1]*b+a[3]*c,this[2]=this[2],this.check()}transformByQuaternion(a){return iD(this,this,a),this.check()}}class iQ extends h0{toString(){let a="[";if(hX.printRowMajor){a+="row-major:";for(let b=0;b<this.RANK;++b)for(let c=0;c<this.RANK;++c)a+=` ${this[c*this.RANK+b]}`}else{a+="column-major:";for(let b=0;b<this.ELEMENTS;++b)a+=` ${this[b]}`}return a+"]"}getElementIndex(a,b){return b*this.RANK+a}getElement(a,b){return this[b*this.RANK+a]}setElement(a,b,c){return this[b*this.RANK+a]=h1(c),this}getColumn(a,b=Array(this.RANK).fill(-0)){let c=a*this.RANK;for(let a=0;a<this.RANK;++a)b[a]=this[c+a];return b}setColumn(a,b){let c=a*this.RANK;for(let a=0;a<this.RANK;++a)this[c+a]=b[a];return this}}function iR(){let a=new fv(2);return fv!=Float32Array&&(a[0]=0,a[1]=0),a}function iS(a){let b=new fv(2);return b[0]=a[0],b[1]=a[1],b}function iT(a,b){let c=new fv(2);return c[0]=a,c[1]=b,c}function iU(a,b){return a[0]=b[0],a[1]=b[1],a}function iV(a,b,c){return a[0]=b,a[1]=c,a}function iW(a,b,c){return a[0]=b[0]+c[0],a[1]=b[1]+c[1],a}function iX(a,b,c){return a[0]=b[0]-c[0],a[1]=b[1]-c[1],a}function iY(a,b,c){return a[0]=b[0]*c[0],a[1]=b[1]*c[1],a}function iZ(a,b,c){return a[0]=b[0]/c[0],a[1]=b[1]/c[1],a}function i$(a,b){return a[0]=Math.ceil(b[0]),a[1]=Math.ceil(b[1]),a}function i_(a,b){return a[0]=Math.floor(b[0]),a[1]=Math.floor(b[1]),a}function i0(a,b,c){return a[0]=Math.min(b[0],c[0]),a[1]=Math.min(b[1],c[1]),a}function i1(a,b,c){return a[0]=Math.max(b[0],c[0]),a[1]=Math.max(b[1],c[1]),a}function i2(a,b){return a[0]=fx(b[0]),a[1]=fx(b[1]),a}function i3(a,b,c){return a[0]=b[0]*c,a[1]=b[1]*c,a}function i4(a,b,c,d){return a[0]=b[0]+c[0]*d,a[1]=b[1]+c[1]*d,a}function i5(a,b){let c=b[0]-a[0],d=b[1]-a[1];return Math.sqrt(c*c+d*d)}function i6(a,b){let c=b[0]-a[0],d=b[1]-a[1];return c*c+d*d}function i7(a){let b=a[0],c=a[1];return Math.sqrt(b*b+c*c)}function i8(a){let b=a[0],c=a[1];return b*b+c*c}function i9(a,b){return a[0]=-b[0],a[1]=-b[1],a}function ja(a,b){return a[0]=1/b[0],a[1]=1/b[1],a}function jb(a,b){let c=b[0],d=b[1],e=c*c+d*d;return e>0&&(e=1/Math.sqrt(e)),a[0]=b[0]*e,a[1]=b[1]*e,a}function jc(a,b){return a[0]*b[0]+a[1]*b[1]}function jd(a,b,c){let d=b[0]*c[1]-b[1]*c[0];return a[0]=a[1]=0,a[2]=d,a}function je(a,b,c,d){let e=b[0],f=b[1];return a[0]=e+d*(c[0]-e),a[1]=f+d*(c[1]-f),a}function jf(a,b){b=void 0===b?1:b;let c=2*fw()*Math.PI;return a[0]=Math.cos(c)*b,a[1]=Math.sin(c)*b,a}function jg(a,b,c){let d=b[0],e=b[1];return a[0]=c[0]*d+c[2]*e,a[1]=c[1]*d+c[3]*e,a}function jh(a,b,c){let d=b[0],e=b[1];return a[0]=c[0]*d+c[2]*e+c[4],a[1]=c[1]*d+c[3]*e+c[5],a}function ji(a,b,c){let d=b[0],e=b[1];return a[0]=c[0]*d+c[3]*e+c[6],a[1]=c[1]*d+c[4]*e+c[7],a}function jj(a,b,c){let d=b[0],e=b[1];return a[0]=c[0]*d+c[4]*e+c[12],a[1]=c[1]*d+c[5]*e+c[13],a}function jk(a,b,c,d){let e=b[0]-c[0],f=b[1]-c[1],g=Math.sin(d),h=Math.cos(d);return a[0]=e*h-f*g+c[0],a[1]=e*g+f*h+c[1],a}function jl(a,b){let c=a[0],d=a[1],e=b[0],f=b[1],g=Math.sqrt((c*c+d*d)*(e*e+f*f));return Math.acos(Math.min(Math.max(g&&(c*e+d*f)/g,-1),1))}function jm(a){return a[0]=0,a[1]=0,a}function jn(a){return`vec2(${a[0]}, ${a[1]})`}function jo(a,b){return a[0]===b[0]&&a[1]===b[1]}function jp(a,b){let c=a[0],d=a[1],e=b[0],f=b[1];return Math.abs(c-e)<=1e-6*Math.max(1,Math.abs(c),Math.abs(e))&&Math.abs(d-f)<=1e-6*Math.max(1,Math.abs(d),Math.abs(f))}let jq=(j=iR(),function(a,b,c,d,e,f){let g,h;for(b||(b=2),c||(c=0),h=d?Math.min(d*b+c,a.length):a.length,g=c;g<h;g+=b)j[0]=a[g],j[1]=a[g+1],e(j,j,f),a[g]=j[0],a[g+1]=j[1];return a});a.s(["add",()=>iW,"angle",()=>jl,"ceil",()=>i$,"clone",()=>iS,"copy",()=>iU,"create",()=>iR,"cross",()=>jd,"dist",0,i5,"distance",()=>i5,"div",0,iZ,"divide",()=>iZ,"dot",()=>jc,"equals",()=>jp,"exactEquals",()=>jo,"floor",()=>i_,"forEach",0,jq,"fromValues",()=>iT,"inverse",()=>ja,"len",0,i7,"length",()=>i7,"lerp",()=>je,"max",()=>i1,"min",()=>i0,"mul",0,iY,"multiply",()=>iY,"negate",()=>i9,"normalize",()=>jb,"random",()=>jf,"rotate",()=>jk,"round",()=>i2,"scale",()=>i3,"scaleAndAdd",()=>i4,"set",()=>iV,"sqrDist",0,i6,"sqrLen",0,i8,"squaredDistance",()=>i6,"squaredLength",()=>i8,"str",()=>jn,"sub",0,iX,"subtract",()=>iX,"transformMat2",()=>jg,"transformMat2d",()=>jh,"transformMat3",()=>ji,"transformMat4",()=>jj,"zero",()=>jm],77430),(xM=xZ||(xZ={}))[xM.COL0ROW0=0]="COL0ROW0",xM[xM.COL0ROW1=1]="COL0ROW1",xM[xM.COL0ROW2=2]="COL0ROW2",xM[xM.COL0ROW3=3]="COL0ROW3",xM[xM.COL1ROW0=4]="COL1ROW0",xM[xM.COL1ROW1=5]="COL1ROW1",xM[xM.COL1ROW2=6]="COL1ROW2",xM[xM.COL1ROW3=7]="COL1ROW3",xM[xM.COL2ROW0=8]="COL2ROW0",xM[xM.COL2ROW1=9]="COL2ROW1",xM[xM.COL2ROW2=10]="COL2ROW2",xM[xM.COL2ROW3=11]="COL2ROW3",xM[xM.COL3ROW0=12]="COL3ROW0",xM[xM.COL3ROW1=13]="COL3ROW1",xM[xM.COL3ROW2=14]="COL3ROW2",xM[xM.COL3ROW3=15]="COL3ROW3";let jr=45*Math.PI/180,js=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class jt extends iQ{static get IDENTITY(){return e||Object.freeze(e=new jt),e}static get ZERO(){return d||Object.freeze(d=new jt([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0])),d}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return xZ}constructor(a){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),1==arguments.length&&Array.isArray(a)?this.copy(a):this.identity()}copy(a){return this[0]=a[0],this[1]=a[1],this[2]=a[2],this[3]=a[3],this[4]=a[4],this[5]=a[5],this[6]=a[6],this[7]=a[7],this[8]=a[8],this[9]=a[9],this[10]=a[10],this[11]=a[11],this[12]=a[12],this[13]=a[13],this[14]=a[14],this[15]=a[15],this.check()}set(a,b,c,d,e,f,g,h,i,j,k,l,n,o,p,q){return this[0]=a,this[1]=b,this[2]=c,this[3]=d,this[4]=e,this[5]=f,this[6]=g,this[7]=h,this[8]=i,this[9]=j,this[10]=k,this[11]=l,this[12]=n,this[13]=o,this[14]=p,this[15]=q,this.check()}setRowMajor(a,b,c,d,e,f,g,h,i,j,k,l,n,o,p,q){return this[0]=a,this[1]=e,this[2]=i,this[3]=n,this[4]=b,this[5]=f,this[6]=j,this[7]=o,this[8]=c,this[9]=g,this[10]=k,this[11]=p,this[12]=d,this[13]=h,this[14]=l,this[15]=q,this.check()}toRowMajor(a){return a[0]=this[0],a[1]=this[4],a[2]=this[8],a[3]=this[12],a[4]=this[1],a[5]=this[5],a[6]=this[9],a[7]=this[13],a[8]=this[2],a[9]=this[6],a[10]=this[10],a[11]=this[14],a[12]=this[3],a[13]=this[7],a[14]=this[11],a[15]=this[15],a}identity(){return this.copy(js)}fromObject(a){return this.check()}fromQuaternion(a){return f1(this,a),this.check()}frustum(a){var b,c,d,e,f,g;let{left:h,right:i,bottom:j,top:k,near:l=.1,far:n=500}=a;return n===1/0?(b=this,c=h,d=i,e=j,f=k,g=l,b[0]=2*g/(d-c),b[1]=0,b[2]=0,b[3]=0,b[4]=0,b[5]=2*g/(f-e),b[6]=0,b[7]=0,b[8]=(d+c)/(d-c),b[9]=(f+e)/(f-e),b[10]=-1,b[11]=-1,b[12]=0,b[13]=0,b[14]=-2*g,b[15]=0):f2(this,h,i,j,k,l,n),this.check()}lookAt(a){let{eye:b,center:c=[0,0,0],up:d=[0,1,0]}=a;return f8(this,b,c,d),this.check()}ortho(a){let{left:b,right:c,bottom:d,top:e,near:f=.1,far:g=500}=a;return f6(this,b,c,d,e,f,g),this.check()}orthographic(a){let{fovy:b=jr,aspect:c=1,focalDistance:d=1,near:e=.1,far:f=500}=a;ju(b);let g=d*Math.tan(b/2),h=g*c;return this.ortho({left:-h,right:h,bottom:-g,top:g,near:e,far:f})}perspective(a){let{fovy:b=45*Math.PI/180,aspect:c=1,near:d=.1,far:e=500}=a;return ju(b),f3(this,b,c,d,e),this.check()}determinant(){return fH(this)}getScale(a=[-0,-0,-0]){return a[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),a[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),a[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),a}getTranslation(a=[-0,-0,-0]){return a[0]=this[12],a[1]=this[13],a[2]=this[14],a}getRotation(a,b){a=a||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],b=b||[-0,-0,-0];let c=this.getScale(b),d=1/c[0],e=1/c[1],f=1/c[2];return a[0]=this[0]*d,a[1]=this[1]*e,a[2]=this[2]*f,a[3]=0,a[4]=this[4]*d,a[5]=this[5]*e,a[6]=this[6]*f,a[7]=0,a[8]=this[8]*d,a[9]=this[9]*e,a[10]=this[10]*f,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}getRotationMatrix3(a,b){a=a||[-0,-0,-0,-0,-0,-0,-0,-0,-0],b=b||[-0,-0,-0];let c=this.getScale(b),d=1/c[0],e=1/c[1],f=1/c[2];return a[0]=this[0]*d,a[1]=this[1]*e,a[2]=this[2]*f,a[3]=this[4]*d,a[4]=this[5]*e,a[5]=this[6]*f,a[6]=this[8]*d,a[7]=this[9]*e,a[8]=this[10]*f,a}transpose(){return fE(this,this),this.check()}invert(){return fF(this,this),this.check()}multiplyLeft(a){return fI(this,a,this),this.check()}multiplyRight(a){return fI(this,this,a),this.check()}rotateX(a){return fM(this,this,a),this.check()}rotateY(a){return fN(this,this,a),this.check()}rotateZ(a){return fO(this,this,a),this.check()}rotateXYZ(a){return this.rotateX(a[0]).rotateY(a[1]).rotateZ(a[2])}rotateAxis(a,b){return fL(this,this,a,b),this.check()}scale(a){return fK(this,this,Array.isArray(a)?a:[a,a,a]),this.check()}translate(a){return fJ(this,this,a),this.check()}transform(a,b){return 4===a.length?(h2(b=gK(b||[-0,-0,-0,-0],a,this),4),b):this.transformAsPoint(a,b)}transformAsPoint(a,b){let c,{length:d}=a;switch(d){case 2:c=jj(b||[-0,-0],a,this);break;case 3:c=iB(b||[-0,-0,-0],a,this);break;default:throw Error("Illegal vector")}return h2(c,a.length),c}transformAsVector(a,b){let c;switch(a.length){case 2:var d;let e,f,g;d=b||[-0,-0],e=a[0],f=a[1],g=this[3]*e+this[7]*f||1,d[0]=(this[0]*e+this[4]*f)/g,d[1]=(this[1]*e+this[5]*f)/g,c=d;break;case 3:c=iN(b||[-0,-0,-0],a,this);break;default:throw Error("Illegal vector")}return h2(c,a.length),c}transformPoint(a,b){return this.transformAsPoint(a,b)}transformVector(a,b){return this.transformAsPoint(a,b)}transformDirection(a,b){return this.transformAsVector(a,b)}makeRotationX(a){return this.identity().rotateX(a)}makeTranslation(a,b,c){return this.identity().translate([a,b,c])}}function ju(a){if(a>2*Math.PI)throw Error("expected radians")}var gR=gR;function jv(a,b){let c=gR.transformMat4([],b,a);return gR.scale(c,c,1/c[3]),c}function jw(a,b){let c=a%b;return c<0?b+c:c}function jx(a,b,c){return a<b?b:a>c?c:a}let jy=Math.log2||function(a){return Math.log(a)*Math.LOG2E};var gi=gi,jz=a.i(77430),jz=jz,jA=a.i(72255),jA=jA;function jB(a,b){if(!a)throw Error(b||"@math.gl/web-mercator: assertion failed.")}let jC=Math.PI,jD=jC/4,jE=jC/180,jF=180/jC;function jG(a){let[b,c]=a;jB(Number.isFinite(b)),jB(Number.isFinite(c)&&c>=-90&&c<=90,"invalid latitude");let d=512*(jC+Math.log(Math.tan(jD+c*jE*.5)))/(2*jC);return[512*(b*jE+jC)/(2*jC),d]}function jH(a){let[b,c]=a,d=2*(Math.atan(Math.exp(c/512*(2*jC)-jC))-jD);return[(b/512*(2*jC)-jC)*jF,d*jF]}function jI(a){return 512/4003e4/Math.cos(a*jE)}function jJ(a){let{latitude:b,longitude:c,highPrecision:d=!1}=a;jB(Number.isFinite(b)&&Number.isFinite(c));let e=Math.cos(b*jE),f=512/360/e,g=512/4003e4/e,h={unitsPerMeter:[g,g,g],metersPerUnit:[1/g,1/g,1/g],unitsPerDegree:[512/360,f,g],degreesPerUnit:[1/(512/360),1/f,1/g]};if(d){let a=jE*Math.tan(b*jE)/e,c=512/4003e4*a,d=c/f*g;h.unitsPerDegree2=[0,512/360*a/2,c],h.unitsPerMeter2=[d,0,d]}return h}function jK(a,b){let[c,d,e]=a,[f,g,h]=b,{unitsPerMeter:i,unitsPerMeter2:j}=jJ({longitude:c,latitude:d,highPrecision:!0}),k=jG(a);k[0]+=f*(i[0]+j[0]*g),k[1]+=g*(i[1]+j[1]*g);let l=jH(k);return Number.isFinite(e)||Number.isFinite(h)?[l[0],l[1],(e||0)+(h||0)]:l}function jL(a){return 2*Math.atan(.5/a)*jF}function jM(a){return .5/Math.tan(.5*a*jE)}function jN(a,b){let[c,d,e=0]=a;return jB(Number.isFinite(c)&&Number.isFinite(d)&&Number.isFinite(e)),jv(b,[c,d,e,1])}function jO(a,b,c=0){let[d,e,f]=a;if(jB(Number.isFinite(d)&&Number.isFinite(e),"invalid pixel coordinate"),Number.isFinite(f))return jv(b,[d,e,f,1]);let g=jv(b,[d,e,0,1]),h=jv(b,[d,e,1,1]),i=g[2],j=h[2];return jz.lerp([],g,h,i===j?0:((c||0)-i)/(j-i))}var jz=jz;let jP=Math.PI/180;function jQ(a,b,c){let{pixelUnprojectionMatrix:d}=a,e=jv(d,[b,0,1,1]),f=jv(d,[b,a.height,1,1]),g=(c*a.distanceScales.unitsPerMeter[2]-e[2])/(f[2]-e[2]),h=jH(jz.lerp([],e,f,g));return h.push(c),h}var gi=gi,jz=jz,jA=jA,jz=jz;let jR=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,jS=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,jT=`
${jR}
${jS}
`,jU=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,jV=`
${jR}
${jU}
`,jW=hE(function({viewport:a,center:b}){return new jt(a.viewProjectionMatrix).invert().transform(b)}),jX=hE(function({viewport:a,shadowMatrices:b}){let c=[],d=a.pixelUnprojectionMatrix,e=a.isGeospatial?void 0:1,f=[[0,0,e],[a.width,0,e],[0,a.height,e],[a.width,a.height,e],[0,0,-1],[a.width,0,-1],[0,a.height,-1],[a.width,a.height,-1]].map(a=>(function(a,b){let[c,d,e]=a,f=jO([c,d,e],b);return Number.isFinite(e)?f:[f[0],f[1],0]})(a,d));for(let d of b){let b=d.clone().translate(new iP(a.center).negate()),e=f.map(a=>b.transform(a)),g=new jt().ortho({left:Math.min(...e.map(a=>a[0])),right:Math.max(...e.map(a=>a[0])),bottom:Math.min(...e.map(a=>a[1])),top:Math.max(...e.map(a=>a[1])),near:Math.min(...e.map(a=>-a[2])),far:Math.max(...e.map(a=>-a[2]))});c.push(g.multiplyRight(d))}return c}),jY=[0,0,0,1],jZ=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],j$={name:"shadow",dependencies:[hV],vs:jT,fs:jV,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:function(a){let{shadowEnabled:b=!0,project:c}=a;if(!b||!c||!a.shadowMatrices||!a.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:a.dummyShadowMap,shadow_uShadowMap1:a.dummyShadowMap};let d=hV.getUniforms(c),e=jW({viewport:c.viewport,center:d.center}),f=[],g=jX({shadowMatrices:a.shadowMatrices,viewport:c.viewport}).slice();for(let b=0;b<a.shadowMatrices.length;b++){let a=g[b],h=a.clone().translate(new iP(c.viewport.center).negate());d.coordinateSystem===hz.LNGLAT&&d.projectionMode===hA.WEB_MERCATOR?(g[b]=h,f[b]=e):(g[b]=a.clone().multiplyRight(jZ),f[b]=h.transform(e))}let h={drawShadowMap:!!a.drawToShadowMap,useShadowMap:!!a.shadowMaps&&a.shadowMaps.length>0,color:a.shadowColor||jY,lightId:a.shadowLightId||0,lightCount:a.shadowMatrices.length,shadow_uShadowMap0:a.dummyShadowMap,shadow_uShadowMap1:a.dummyShadowMap};for(let a=0;a<g.length;a++)h[`viewProjectionMatrix${a}`]=g[a],h[`projectCenter${a}`]=f[a];for(let b=0;b<2;b++)h[`shadow_uShadowMap${b}`]=a.shadowMaps&&a.shadowMaps[b]||a.dummyShadowMap;return h},uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},j_={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:[0,1,1,1]},vs:`\
uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,fs:`\
uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,getUniforms:function(a={},b){let c={};if(void 0===a.highlightedObjectColor||(null===a.highlightedObjectColor?c.isHighlightActive=!1:(c.isHighlightActive=!0,c.highlightedObjectColor=a.highlightedObjectColor.slice(0,3))),a.highlightColor){let b=Array.from(a.highlightColor,a=>a/255);Number.isFinite(b[3])||(b[3]=1),c.highlightColor=b}return void 0!==a.isActive&&(c.isActive=!!a.isActive,c.isAttribute=!!a.isAttribute),void 0!==a.useFloatColors&&(c.useFloatColors=!!a.useFloatColors),c}},j0={...j_,defaultUniforms:{...j_.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},j1=[ft],j2=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],j3=[],j4=Symbol.for("component"),j5=Symbol.for("propTypes"),j6=Symbol.for("deprecatedProps"),j7=Symbol.for("asyncPropDefaults"),j8=Symbol.for("asyncPropOriginal"),j9=Symbol.for("asyncPropResolved"),ka={};function kb(a){ka=a}function kc(a,b,c,d){gT.level>0&&ka[a]&&ka[a].call(null,b,c,d)}function kd(a,b=()=>!0){return Array.isArray(a)?function a(b,c,d){let e=-1;for(;++e<b.length;){let f=b[e];Array.isArray(f)?a(f,c,d):c(f)&&d.push(f)}return d}(a,b,[]):b(a)?[a]:[]}a.i(56786);var ke=a.i(5324);let kf=a=>null!==a&&"object"==typeof a,kg=a=>kf(a)&&a.constructor===({}).constructor,kh=a=>"undefined"!=typeof Response&&a instanceof Response||a&&a.arrayBuffer&&a.text&&a.json,ki=a=>"undefined"!=typeof Blob&&a instanceof Blob,kj=a=>{let b,c;return b=a,"undefined"!=typeof ReadableStream&&b instanceof ReadableStream||kf(b)&&"function"==typeof b.tee&&"function"==typeof b.cancel&&"function"==typeof b.getReader||kf(c=a)&&"function"==typeof c.read&&"function"==typeof c.pipe&&"boolean"==typeof c.readable};function kk(a,b){if(!a)throw Error(b||"loader assertion failed.")}function kl(a){return!!a&&(Array.isArray(a)&&(a=a[0]),Array.isArray(a?.extensions))}function km(a){let b;return kk(a,"null loader"),kk(kl(a),"invalid loader"),Array.isArray(a)&&(b=a[1],a={...a=a[0],options:{...a.options,...b}}),(a?.parseTextSync||a?.parseText)&&(a.text=!0),a.text||(a.binary=!0),a}let kn={};class ko extends Error{constructor(a,b){super(a),this.reason=b.reason,this.url=b.url,this.response=b.response}reason;url;response}let kp=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,kq=/^([-\w.]+\/[-\w.+]+)/;function kr(a,b){return a.toLowerCase()===b.toLowerCase()}function ks(a){let b=kp.exec(a);return b?b[1]:""}let kt=/\?.*/;function ku(a){return a.replace(kt,"")}function kv(a){return kh(a)?a.url:ki(a)?a.name||"":"string"==typeof a?a:""}function kw(a){if(kh(a)){let b,c=a.headers.get("content-type")||"",d=ku(a.url);return((b=kq.exec(c))?b[1]:c)||ks(d)}return ki(a)?a.type||"":"string"==typeof a?ks(a):""}async function kx(a){var b;if(kh(a))return a;let c={},d=kh(b=a)?b.headers["content-length"]||-1:ki(b)?b.size:"string"==typeof b?b.length:b instanceof ArrayBuffer||ArrayBuffer.isView(b)?b.byteLength:-1;d>=0&&(c["content-length"]=String(d));let e=kv(a),f=kw(a);f&&(c["content-type"]=f);let g=await kA(a);g&&(c["x-first-bytes"]=g),"string"==typeof a&&(a=new TextEncoder().encode(a));let h=new Response(a,{headers:c});return Object.defineProperty(h,"url",{value:e}),h}async function ky(a){if(!a.ok)throw await kz(a)}async function kz(a){let b=function(a){if(a.length<50)return a;let b=a.slice(a.length-15),c=a.substr(0,32);return`${c}...${b}`}(a.url),c=`Failed to fetch resource (${a.status}) ${a.statusText}: ${b}`;c=c.length>100?`${c.slice(0,100)}...`:c;let d={reason:a.statusText,url:a.url,response:a};try{let b=a.headers.get("Content-Type");d.reason=!a.bodyUsed&&b?.includes("application/json")?await a.json():await a.text()}catch(a){}return new ko(c,d)}async function kA(a){if("string"==typeof a)return`data:,${a.slice(0,5)}`;if(a instanceof Blob){let b=a.slice(0,5);return await new Promise(a=>{let c=new FileReader;c.onload=b=>a(b?.target?.result),c.readAsDataURL(b)})}if(a instanceof ArrayBuffer){let b=function(a){let b="",c=new Uint8Array(a);for(let a=0;a<c.byteLength;a++)b+=String.fromCharCode(c[a]);return btoa(b)}(a.slice(0,5));return`data:base64,${b}`}return null}async function kB(a,b){if("string"==typeof a){var c;let d=function(a){for(let b in kn)if(a.startsWith(b)){let c=kn[b];a=a.replace(b,c)}return a.startsWith("http://")||a.startsWith("https://")||(a=`${a}`),a}(a);return!((c=d).startsWith("http:")||c.startsWith("https:"))&&!d.startsWith("data:")&&globalThis.loaders?.fetchNode?globalThis.loaders?.fetchNode(d,b):await fetch(d,b)}return await kx(a)}let kC="4.3.3",kD=kC[0]>="0"&&kC[0]<="9"?`v${kC}`:"",kE=(k=new gS.Log({id:"loaders.gl"}),globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=k,globalThis.loaders.version=kD,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=k,k),kF=new gS.Log({id:"loaders.gl"});class kG{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}let kH={self:"undefined"!=typeof self&&self,window:!1,global:a.g,document:"undefined"!=typeof document&&document};kH.self||kH.window||kH.global,kH.window||kH.self||kH.global,kH.global||kH.self||kH.window,kH.document;let kI="object"!=typeof process||"[object process]"!==String(process),kJ="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);kJ&&parseFloat(kJ[1]);let kK={fetch:null,mimeType:void 0,nothrow:!1,log:new class{console;constructor(){this.console=console}log(...a){return this.console.log.bind(this.console,...a)}info(...a){return this.console.info.bind(this.console,...a)}warn(...a){return this.console.warn.bind(this.console,...a)}error(...a){return this.console.error.bind(this.console,...a)}},useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:kI,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},kL={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function kM(){globalThis.loaders=globalThis.loaders||{};let{loaders:a}=globalThis;return a._state||(a._state={}),a._state}function kN(){let a=kM();return a.globalOptions=a.globalOptions||{...kK},a.globalOptions}function kO(a,b,c,d,e){let f=b||"Top level",g=b?`${b}.`:"";for(let h in a){let i=!b&&kf(a[h]),j="baseUri"===h&&!b,k="workerUrl"===h&&b;if(!(h in c)&&!j&&!k){if(h in d)kF.warn(`${f} loader option '${g}${h}' no longer supported, use '${d[h]}'`)();else if(!i){let a=function(a,b){let c=a.toLowerCase(),d="";for(let e of b)for(let b in e.options){if(a===b)return`Did you mean '${e.id}.${b}'?`;let f=b.toLowerCase();(c.startsWith(f)||f.startsWith(c))&&(d=d||`Did you mean '${e.id}.${b}'?`)}return d}(h,e);kF.warn(`${f} loader option '${g}${h}' not recognized. ${a}`)()}}}}function kP(a,b){for(let c in b)c in b&&(kg(b[c])&&kg(a[c])?a[c]={...a[c],...b[c]}:a[c]=b[c])}function kQ(a,b){let c=kN(),d=a||c;return"function"==typeof d.fetch?d.fetch:kf(d.fetch)?a=>kB(a,d.fetch):b?.fetch?b?.fetch:kB}let kR={self:"undefined"!=typeof self&&self,window:!1,global:a.g,document:"undefined"!=typeof document&&document};kR.self||kR.window||kR.global,kR.window||kR.self||kR.global,kR.global||kR.self||kR.window,kR.document;let kS="object"!=typeof process||"[object process]"!==String(process),kT="undefined"!=typeof process&&process.version&&/v([0-9]*)/.exec(process.version);kT&&parseFloat(kT[1]);var kU=a.i(37702);kU.parentPort;let kV=kU.Worker;function kW(a,b){if(!a)throw Error(b||"loaders.gl assertion failed.")}let kX=new Map;function kY(a){let b=new Blob([a],{type:"application/javascript"});return URL.createObjectURL(b)}function kZ(a){return!!a&&!!(a instanceof ArrayBuffer||"undefined"!=typeof MessagePort&&a instanceof MessagePort||"undefined"!=typeof ImageBitmap&&a instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&a instanceof OffscreenCanvas)}let k$=()=>{};class k_{name;source;url;terminated=!1;worker;onMessage;onError;_loadableURL="";static isSupported(){return"undefined"!=typeof Worker&&kS||void 0!==kV&&!kS}constructor(a){const{name:b,source:c,url:d}=a;kW(c||d),this.name=b,this.source=c,this.url=d,this.onMessage=k$,this.onError=a=>console.log(a),this.worker=kS?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=k$,this.onError=k$,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(a,b){b=b||function a(b,c=!0,d){let e=d||new Set;if(b){if(kZ(b))e.add(b);else if(kZ(b.buffer))e.add(b.buffer);else if(ArrayBuffer.isView(b));else if(c&&"object"==typeof b)for(let d in b)a(b[d],c,e)}return void 0===d?Array.from(e):[]}(a),this.worker.postMessage(a,b)}_getErrorFromErrorEvent(a){let b="Failed to load ";return b+=`worker ${this.name} from ${this.url}. `,a.message&&(b+=`${a.message} in `),a.lineno&&(b+=`:${a.lineno}:${a.colno}`),Error(b)}_createBrowserWorker(){var a,b,c;let d;this._loadableURL=(kW((a={source:this.source,url:this.url}).source&&!a.url||!a.source&&a.url),(d=kX.get(a.source||a.url))||(a.url&&(d=(b=a.url).startsWith("http")?kY((c=b,`\
try {
  importScripts('${c}');
} catch (error) {
  console.error(error);
  throw error;
}`)):b,kX.set(a.url,d)),a.source&&(d=kY(a.source),kX.set(a.source,d))),kW(d),d);let e=new Worker(this._loadableURL,{name:this.name});return e.onmessage=a=>{a.data?this.onMessage(a.data):this.onError(Error("No data received"))},e.onerror=a=>{this.onError(this._getErrorFromErrorEvent(a)),this.terminated=!0},e.onmessageerror=a=>console.error(a),e}_createNodeWorker(){let a;if(this.url)a=new kV(this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`,{eval:!1});else if(this.source)a=new kV(this.source,{eval:!0});else throw Error("no worker");return a.on("message",a=>{this.onMessage(a)}),a.on("error",a=>{this.onError(a)}),a.on("exit",a=>{}),a}}class k0{name;workerThread;isRunning=!0;result;_resolve=()=>{};_reject=()=>{};constructor(a,b){this.name=a,this.workerThread=b,this.result=new Promise((a,b)=>{this._resolve=a,this._reject=b})}postMessage(a,b){this.workerThread.postMessage({source:"loaders.gl",type:a,payload:b})}done(a){kW(this.isRunning),this.isRunning=!1,this._resolve(a)}error(a){kW(this.isRunning),this.isRunning=!1,this._reject(a)}}class k1{name="unnamed";source;url;maxConcurrency=1;maxMobileConcurrency=1;onDebug=()=>{};reuseWorkers=!0;props={};jobQueue=[];idleQueue=[];count=0;isDestroyed=!1;static isSupported(){return k_.isSupported()}constructor(a){this.source=a.source,this.url=a.url,this.setProps(a)}destroy(){this.idleQueue.forEach(a=>a.destroy()),this.isDestroyed=!0}setProps(a){this.props={...this.props,...a},void 0!==a.name&&(this.name=a.name),void 0!==a.maxConcurrency&&(this.maxConcurrency=a.maxConcurrency),void 0!==a.maxMobileConcurrency&&(this.maxMobileConcurrency=a.maxMobileConcurrency),void 0!==a.reuseWorkers&&(this.reuseWorkers=a.reuseWorkers),void 0!==a.onDebug&&(this.onDebug=a.onDebug)}async startJob(a,b=(a,b,c)=>a.done(c),c=(a,b)=>a.error(b)){let d=new Promise(d=>(this.jobQueue.push({name:a,onMessage:b,onError:c,onStart:d}),this));return this._startQueuedJob(),await d}async _startQueuedJob(){if(!this.jobQueue.length)return;let a=this._getAvailableWorker();if(!a)return;let b=this.jobQueue.shift();if(b){this.onDebug({message:"Starting job",name:b.name,workerThread:a,backlog:this.jobQueue.length});let c=new k0(b.name,a);a.onMessage=a=>b.onMessage(c,a.type,a.payload),a.onError=a=>b.onError(c,a),b.onStart(c);try{await c.result}catch(a){console.error(`Worker exception: ${a}`)}finally{this.returnWorkerToQueue(a)}}}returnWorkerToQueue(a){!kS||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(a.destroy(),this.count--):this.idleQueue.push(a),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){return this.idleQueue.length>0?this.idleQueue.shift()||null:this.count<this._getMaxConcurrency()?(this.count++,new k_({name:`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`,source:this.source,url:this.url})):null}_getMaxConcurrency(){return this.maxConcurrency}}let k2={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class k3{props;workerPools=new Map;static _workerFarm;static isSupported(){return k_.isSupported()}static getWorkerFarm(a={}){return k3._workerFarm=k3._workerFarm||new k3({}),k3._workerFarm.setProps(a),k3._workerFarm}constructor(a){this.props={...k2},this.setProps(a),this.workerPools=new Map}destroy(){for(let a of this.workerPools.values())a.destroy();this.workerPools=new Map}setProps(a){for(let b of(this.props={...this.props,...a},this.workerPools.values()))b.setProps(this._getWorkerPoolProps())}getWorkerPool(a){let{name:b,source:c,url:d}=a,e=this.workerPools.get(b);return e||((e=new k1({name:b,source:c,url:d})).setProps(this._getWorkerPoolProps()),this.workerPools.set(b,e)),e}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}let k4=(globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.3"),globalThis._loadersgl_.version);async function k5(a,b,c,d,e){let f=a.id,g=function(a,b={}){let c=b[a.id]||{},d=kS?`${a.id}-worker.js`:`${a.id}-worker-node.js`,e=c.workerUrl;if(e||"compression"!==a.id||(e=b.workerUrl),"test"===b._workerType&&(e=kS?`modules/${a.module}/dist/${d}`:`modules/${a.module}/src/workers/${a.id}-worker-node.ts`),!e){let b=a.version;"latest"===b&&(b="latest");let c=b?`@${b}`:"";e=`https://unpkg.com/@loaders.gl/${a.module}${c}/dist/${d}`}return kW(e),e}(a,c),h=k3.getWorkerFarm(c).getWorkerPool({name:f,url:g});c=JSON.parse(JSON.stringify(c)),d=JSON.parse(JSON.stringify(d||{}));let i=await h.startJob("process-on-worker",k6.bind(null,e));i.postMessage("process",{input:b,options:c,context:d});let j=await i.result;return await j.result}async function k6(a,b,c,d){switch(c){case"done":b.done(d);break;case"error":b.error(Error(d.error));break;case"process":let{id:e,input:f,options:g}=d;try{let c=await a(f,g);b.postMessage("done",{id:e,result:c})}catch(c){let a=c instanceof Error?c.message:"unknown error";b.postMessage("error",{id:e,error:a})}break;default:console.warn(`parse-with-worker unknown message ${c}`)}}async function k7(a){let b=[];for await(let c of a)b.push(c);return function(...a){var b=a;let c=b.map(a=>a instanceof ArrayBuffer?new Uint8Array(a):a),d=new Uint8Array(c.reduce((a,b)=>a+b.byteLength,0)),e=0;for(let a of c)d.set(a,e),e+=a.byteLength;return d.buffer}(...b)}async function*k8(a,b){let c=b?.chunkSize||1048576,d=0;for(;d<a.size;){let b=d+c,e=await a.slice(d,b).arrayBuffer();d=b,yield e}}function k9(a){if(a&&"object"==typeof a&&a.isBuffer)return Buffer.isBuffer(a)?new Uint8Array(a.buffer,a.byteOffset,a.length).slice().buffer:a;if(a instanceof ArrayBuffer)return a;if(ArrayBuffer.isView(a))return 0===a.byteOffset&&a.byteLength===a.buffer.byteLength?a.buffer:a.buffer.slice(a.byteOffset,a.byteOffset+a.byteLength);if("string"==typeof a)return new TextEncoder().encode(a).buffer;if(a&&"object"==typeof a&&a._toArrayBuffer)return a._toArrayBuffer();throw Error("toArrayBuffer")}function la(a,b){return kI?lb(a,b):lc(a,b)}async function*lb(a,b){let c,d=a.getReader();try{for(;;){let a=c||d.read();b?._streamReadAhead&&(c=d.read());let{done:e,value:f}=await a;if(e)return;yield k9(f)}}catch(a){d.releaseLock()}}async function*lc(a,b){for await(let b of a)yield k9(b)}let ld="Cannot convert supplied data type";async function le(a,b,c){let d,e,f=a instanceof ArrayBuffer||ArrayBuffer.isView(a);if("string"==typeof a||f){let c;var g=a;if(b.text&&"string"==typeof g)return g;if((c=g)&&"object"==typeof c&&c.isBuffer&&(g=g.buffer),g instanceof ArrayBuffer){let a=g;return b.text&&!b.binary?new TextDecoder("utf8").decode(a):a}if(ArrayBuffer.isView(g)){if(b.text&&!b.binary)return new TextDecoder("utf8").decode(g);let a=g.buffer,c=g.byteLength||g.length;return(0!==g.byteOffset||c!==a.byteLength)&&(a=a.slice(g.byteOffset,g.byteOffset+c)),a}throw Error(ld)}if(ki(a)&&(a=await kx(a)),kh(a)){let c=a;return await ky(c),b.binary?await c.arrayBuffer():await c.text()}if(kj(a)&&(a=function(a,b){if("string"==typeof a)return function*(a,b){let c=b?.chunkSize||262144,d=0,e=new TextEncoder;for(;d<a.length;){let b=Math.min(a.length-d,c),f=a.slice(d,d+b);d+=b,yield e.encode(f)}}(a,b);if(a instanceof ArrayBuffer)return function*(a,b={}){let{chunkSize:c=262144}=b,d=0;for(;d<a.byteLength;){let b=Math.min(a.byteLength-d,c),e=new ArrayBuffer(b),f=new Uint8Array(a,d,b);new Uint8Array(e).set(f),d+=b,yield e}}(a,b);if(ki(a))return k8(a,b);if(kj(a))return la(a,b);if(kh(a))return la(a.body,b);throw Error("makeIterator")}(a,c)),(d=a)&&"function"==typeof d[Symbol.iterator]||(e=a)&&"function"==typeof e[Symbol.asyncIterator])return k7(a);throw Error(ld)}function lf(a){let b=a?a.lastIndexOf("/"):-1;return b>=0?a.substr(b+1):""}function lg(a){let b=a?a.lastIndexOf("/"):-1;return b>=0?a.substr(0,b):""}function lh(...a){return(a=a.map((b,c)=>(c&&(b=b.replace(RegExp("^/"),"")),c!==a.length-1&&(b=b.replace(RegExp("/$"),"")),b))).join("/")}function li(...a){let b,c=[];for(let b=0;b<a.length;b++)c[b]=a[b];let d="",e=!1;for(let a=c.length-1;a>=-1&&!e;a--){let f;a>=0?f=c[a]:(void 0===b&&(b=function(){if("undefined"!=typeof process&&void 0!==process.cwd)return process.cwd();let a=window.location?.pathname;return a?.slice(0,a.lastIndexOf("/")+1)||""}()),f=b),0!==f.length&&(d=`${f}/${d}`,e=f.charCodeAt(0)===lj)}return(d=function(a,b){let c,d="",e=-1,f=0,g=!1;for(let h=0;h<=a.length;++h){if(h<a.length)c=a.charCodeAt(h);else if(c===lj)break;else c=lj;if(c===lj){if(e===h-1||1===f);else if(e!==h-1&&2===f){if(d.length<2||!g||46!==d.charCodeAt(d.length-1)||46!==d.charCodeAt(d.length-2)){if(d.length>2){let a=d.length-1,b=a;for(;b>=0&&d.charCodeAt(b)!==lj;--b);if(b!==a){d=-1===b?"":d.slice(0,b),e=h,f=0,g=!1;continue}}else if(2===d.length||1===d.length){d="",e=h,f=0,g=!1;continue}}b&&(d.length>0?d+="/..":d="..",g=!0)}else{let b=a.slice(e+1,h);d.length>0?d+=`/${b}`:d=b,g=!1}e=h,f=0}else 46===c&&-1!==f?++f:f=-1}return d}(d,!e),e)?`/${d}`:d.length>0?d:"."}let lj=47;a.s(["dirname",()=>lg,"filename",()=>lf,"join",()=>lh,"resolve",()=>li],26656);var lk=a.i(26656),lk=lk,lk=lk;let ll=()=>{let a=kM();return a.loaderRegistry=a.loaderRegistry||[],a.loaderRegistry},lm=/\.([^.]+)$/;async function ln(a,b=[],c,d){if(!lp(a))return null;let e=lo(a,b,{...c,nothrow:!0},d);if(e)return e;if(ki(a)&&(e=lo(a=await a.slice(0,10).arrayBuffer(),b,c,d)),!e&&!c?.nothrow)throw Error(lq(a));return e}function lo(a,b=[],c,d){var e,f,g,h,i,j;let k,l,n,o,p,q,r;if(!lp(a))return null;if(b&&!Array.isArray(b))return km(b);let s=[];b&&(s=s.concat(b)),c?.ignoreRegisteredLoaders||s.push(...ll()),function(a){for(let b of a)km(b)}(s);let t=(e=a,f=s,g=c,h=d,k=kv(e),l=kw(e),n=ku(k)||h?.url,o=null,p="",g?.mimeType&&(o=lr(f,g?.mimeType),p=`match forced by supplied MIME type ${g?.mimeType}`),o=o||(i=f,(r=(q=(j=n)&&lm.exec(j))&&q[1])?function(a,b){for(let c of(b=b.toLowerCase(),a))for(let a of c.extensions)if(a.toLowerCase()===b)return c;return null}(i,r):null),p=p||(o?`matched url ${n}`:""),o=o||lr(f,l),p=p||(o?`matched MIME type ${l}`:""),o=o||function(a,b){if(!b)return null;for(let c of a)if("string"==typeof b){if(function(a,b){return b.testText?b.testText(a):(Array.isArray(b.tests)?b.tests:[b.tests]).some(b=>a.startsWith(b))}(b,c))return c}else if(ArrayBuffer.isView(b)){if(ls(b.buffer,b.byteOffset,c))return c}else if(b instanceof ArrayBuffer&&ls(b,0,c))return c;return null}(f,e),p=p||(o?`matched initial data ${lt(e)}`:""),g?.fallbackMimeType&&(o=o||lr(f,g?.fallbackMimeType),p=p||(o?`matched fallback MIME type ${l}`:"")),p&&kE.log(1,`selectLoader selected ${o?.name}: ${p}.`),o);if(!t&&!c?.nothrow)throw Error(lq(a));return t}function lp(a){return!(a instanceof Response)||204!==a.status}function lq(a){let b=kv(a),c=kw(a),d="No valid loader found (";d+=(b?`${lk.filename(b)}, `:"no url provided, ")+`MIME type: ${c?`"${c}"`:"not provided"}, `;let e=a?lt(a):"";return d+((e?` first bytes: "${e}"`:"first bytes: not available")+")")}function lr(a,b){for(let c of a)if(c.mimeTypes?.some(a=>kr(b,a))||kr(b,`application/x.${c.id}`))return c;return null}function ls(a,b,c){return(Array.isArray(c.tests)?c.tests:[c.tests]).some(c=>(function(a,b,c,d){if(d instanceof ArrayBuffer)return function(a,b,c){if(c=c||a.byteLength,a.byteLength<c||b.byteLength<c)return!1;let d=new Uint8Array(a),e=new Uint8Array(b);for(let a=0;a<d.length;++a)if(d[a]!==e[a])return!1;return!0}(d,a,d.byteLength);switch(typeof d){case"function":return d(a);case"string":let e=lu(a,b,d.length);return d===e;default:return!1}})(a,b,0,c))}function lt(a,b=5){return"string"==typeof a?a.slice(0,b):ArrayBuffer.isView(a)?lu(a.buffer,a.byteOffset,b):a instanceof ArrayBuffer?lu(a,0,b):""}function lu(a,b,c){if(a.byteLength<b+c)return"";let d=new DataView(a),e="";for(let a=0;a<c;a++)e+=String.fromCharCode(d.getUint8(b+a));return e}async function lv(a,b,c,d){var e,f,g,h,i,j,k;let l;!b||Array.isArray(b)||kl(b)||(d=void 0,c=b,b=void 0),a=await a,c=c||{};let n=kv(a),o=function(a,b){let c;if(a&&!Array.isArray(a))return a;if(a&&(c=Array.isArray(a)?a:[a]),b&&b.loaders){let a=Array.isArray(b.loaders)?b.loaders:[b.loaders];c=c?[...c,...a]:a}return c&&c.length?c:void 0}(b,d),p=await ln(a,o,c);if(!p)return null;return function(a,b){for(let c of(kO(a,null,kK,kL,b),b)){let d=a&&a[c.id]||{},e=c.options&&c.options[c.id]||{},f=c.deprecatedOptions&&c.deprecatedOptions[c.id]||{};kO(d,c.id,e,f,b)}}(e=c,f=Array.isArray(f=(f=o)||[])?f:[f]),d=function(a,b,c){if(c)return c;let d={fetch:kQ(b,a),...a};if(d.url){let a,b=ku(d.url);d.baseUrl=b,a=d.url.match(kt),d.queryString=a&&a[0],d.filename=lk.filename(b),d.baseUrl=lk.dirname(b)}return Array.isArray(d.loaders)||(d.loaders=null),d}({url:n,_parse:lv,loaders:o},(g=p,h=e,i=n,j=l={...g.options||{}},!(k=i)||"baseUri"in j||(j.baseUri=k),null===l.log&&(l.log=new kG),kP(l,kN()),kP(l,h),c=l),d||null),await lw(p,a,c,d)}async function lw(a,b,c,d){var e;if(!function(a,b=k4){kW(a,"no worker provided");a.version}(a),c=function a(b,c,d=0){if(d>3)return c;let e={...b};for(let[b,f]of Object.entries(c))f&&"object"==typeof f&&!Array.isArray(f)?e[b]=a(e[b]||{},c[b],d+1):e[b]=c[b];return e}(a.options||{},c),kh(b)){let a=b,{ok:c,redirected:e,status:f,statusText:g,type:h,url:i}=a;d.response={headers:Object.fromEntries(a.headers.entries()),ok:c,redirected:e,status:f,statusText:g,type:h,url:i}}if(b=await le(b,a,c),a.parseTextSync&&"string"==typeof b)return a.parseTextSync(b,c,d);if(e=c,k3.isSupported()&&(kS||e?._nodeWorkers)&&a.worker&&e?.worker)return await k5(a,b,c,d,lv);if(a.parseText&&"string"==typeof b)return await a.parseText(b,c,d);if(a.parse)return await a.parse(b,c,d);throw kW(!a.parseSync),Error(`${a.id} loader - no parser found and worker is disabled`)}async function lx(a,b,c,d){let e,f;Array.isArray(b)||kl(b)?(e=b,f=c):(e=[],f=b);let g=kQ(f),h=a;return"string"==typeof a&&(h=await g(a)),ki(a)&&(h=await g(a)),Array.isArray(e),await lv(h,e,f)}class ly{constructor(a,b,c){this._loadCount=0,this._subscribers=new Set,this.id=a,this.context=c,this.setData(b)}subscribe(a){this._subscribers.add(a)}unsubscribe(a){this._subscribers.delete(a)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(a,b){if(a===this._data&&!b)return;this._data=a;let c=++this._loadCount,d=a;for(let b of("string"==typeof a&&(d=lx(a)),d instanceof Promise?(this.isLoaded=!1,this._loader=d.then(a=>{this._loadCount===c&&(this.isLoaded=!0,this._error=void 0,this._content=a)}).catch(a=>{this._loadCount===c&&(this.isLoaded=!0,this._error=a||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=a),this._subscribers))b.onChange(this.getData())}}class lz{constructor(a){this.protocol=a.protocol||"resource://",this._context={device:a.device,gl:a.device?.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(a){return!!a.startsWith(this.protocol)||a in this._resources}add({resourceId:a,data:b,forceUpdate:c=!1,persistent:d=!0}){let e=this._resources[a];e?e.setData(b,c):(e=new ly(a,b,this._context),this._resources[a]=e),e.persistent=d}remove(a){let b=this._resources[a];b&&(b.delete(),delete this._resources[a])}unsubscribe({consumerId:a}){let b=this._consumers[a];if(b){for(let a in b){let c=b[a],d=this._resources[c.resourceId];d&&d.unsubscribe(c)}delete this._consumers[a],this.prune()}}subscribe({resourceId:a,onChange:b,consumerId:c,requestId:d="default"}){let{_resources:e,protocol:f}=this;a.startsWith(f)&&(e[a=a.replace(f,"")]||this.add({resourceId:a,data:null,persistent:!1}));let g=e[a];if(this._track(c,d,g,b),g)return g.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(let a in this._resources)this._resources[a].delete()}_track(a,b,c,d){let e=this._consumers,f=e[a]=e[a]||{},g=f[b],h=g&&g.resourceId&&this._resources[g.resourceId];h&&(h.unsubscribe(g),this.prune()),c&&(g?(g.onChange=d,g.resourceId=c.id):g={onChange:d,resourceId:c.id},f[b]=g,c.subscribe(g))}_prune(){for(let a of(this._pruneRequest=null,Object.keys(this._resources))){let b=this._resources[a];b.persistent||b.inUse()||(b.delete(),delete this._resources[a])}}}let lA=new class{constructor(a={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(a)}setOptions(a){Object.assign(this.opts,a)}allocate(a,b,{size:c=1,type:d,padding:e=0,copy:f=!1,initialize:g=!1,maxCount:h}){let i=d||a&&a.constructor||Float32Array,j=b*c+e;if(ArrayBuffer.isView(a)){if(j<=a.length)return a;if(j*a.BYTES_PER_ELEMENT<=a.buffer.byteLength)return new i(a.buffer,0,j)}let k=1/0;h&&(k=h*c+e);let l=this._allocate(i,j,g,k);return a&&f?l.set(a):g||l.fill(0,0,4),this._release(a),l}release(a){this._release(a)}_allocate(a,b,c,d){let e=Math.max(Math.ceil(b*this.opts.overAlloc),1);e>d&&(e=d);let f=this._pool,g=a.BYTES_PER_ELEMENT*e,h=f.findIndex(a=>a.byteLength>=g);if(h>=0){let b=new a(f.splice(h,1)[0],0,e);return c&&b.fill(0),b}return new a(e)}_release(a){if(!ArrayBuffer.isView(a))return;let b=this._pool,{buffer:c}=a,{byteLength:d}=c,e=b.findIndex(a=>a.byteLength>=d);e<0?b.push(c):(e>0||b.length<this.opts.poolSize)&&b.splice(e,0,c),b.length>this.opts.poolSize&&b.shift()}};function lB(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}let lC=new iP;function lD(a,b,c,d){lC.set(a,b,c);let e=lC.len();return{distance:d/e,normal:new iP(-a/e,-b/e,-c/e)}}function lE(a,b){let{size:c=1,startIndex:d=0}=b,e=void 0!==b.endIndex?b.endIndex:a.length,g=(e-d)/c;f=lA.allocate(f,g,{type:Float32Array,size:2*c});let h=d,i=0;for(;h<e;){for(let b=0;b<c;b++){let d=a[h++];f[i+b]=d,f[i+b+c]=d-Math.fround(d)}i+=2*c}return f.subarray(0,g*c*2)}function lF(a){let b=null,c=!1;for(let d of a)d&&(b?(c||(b=[[b[0][0],b[0][1]],[b[1][0],b[1][1]]],c=!0),b[0][0]=Math.min(b[0][0],d[0][0]),b[0][1]=Math.min(b[0][1],d[0][1]),b[1][0]=Math.max(b[1][0],d[1][0]),b[1][1]=Math.max(b[1][1],d[1][1])):b=d);return b}var gi=gi;let lG=Math.PI/180,lH=lB(),lI=[0,0,0],lJ={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};class lK{constructor(a={}){this._frustumPlanes={},this.id=a.id||this.constructor.displayName||"viewport",this.x=a.x||0,this.y=a.y||0,this.width=a.width||1,this.height=a.height||1,this.zoom=a.zoom||0,this.padding=a.padding,this.distanceScales=a.distanceScales||lJ,this.focalDistance=a.focalDistance||1,this.position=a.position||lI,this.modelMatrix=a.modelMatrix||null;const{longitude:b,latitude:c}=a;this.isGeospatial=Number.isFinite(c)&&Number.isFinite(b),this._initProps(a),this._initMatrices(a),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?hA.WEB_MERCATOR:hA.WEB_MERCATOR_AUTO_OFFSET:hA.IDENTITY}equals(a){return a instanceof lK&&(this===a||a.width===this.width&&a.height===this.height&&a.scale===this.scale&&h_(a.projectionMatrix,this.projectionMatrix)&&h_(a.viewMatrix,this.viewMatrix))}project(a,{topLeft:b=!0}={}){let c=jN(this.projectPosition(a),this.pixelProjectionMatrix),[d,e]=c,f=b?e:this.height-e;return 2===a.length?[d,f]:[d,f,c[2]]}unproject(a,{topLeft:b=!0,targetZ:c}={}){let[d,e,f]=a,g=b?e:this.height-e,h=c&&c*this.distanceScales.unitsPerMeter[2],i=jO([d,g,f],this.pixelUnprojectionMatrix,h),[j,k,l]=this.unprojectPosition(i);return Number.isFinite(f)?[j,k,l]:Number.isFinite(c)?[j,k,c]:[j,k]}projectPosition(a){let[b,c]=this.projectFlat(a);return[b,c,(a[2]||0)*this.distanceScales.unitsPerMeter[2]]}unprojectPosition(a){let[b,c]=this.unprojectFlat(a);return[b,c,(a[2]||0)*this.distanceScales.metersPerUnit[2]]}projectFlat(a){if(this.isGeospatial){let b=jG(a);return b[1]=hZ(b[1],-318,830),b}return a}unprojectFlat(a){return this.isGeospatial?jH(a):a}getBounds(a={}){let b={targetZ:a.z||0},c=this.unproject([0,0],b),d=this.unproject([this.width,0],b),e=this.unproject([0,this.height],b),f=this.unproject([this.width,this.height],b);return[Math.min(c[0],d[0],e[0],f[0]),Math.min(c[1],d[1],e[1],f[1]),Math.max(c[0],d[0],e[0],f[0]),Math.max(c[1],d[1],e[1],f[1])]}getDistanceScales(a){return a&&this.isGeospatial?jJ({longitude:a[0],latitude:a[1],highPrecision:!0}):this.distanceScales}containsPixel({x:a,y:b,width:c=1,height:d=1}){return a<this.x+this.width&&this.x<a+c&&b<this.y+this.height&&this.y<b+d}getFrustumPlanes(){var a;return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,{left:lD((a=this.viewProjectionMatrix)[3]+a[0],a[7]+a[4],a[11]+a[8],a[15]+a[12]),right:lD(a[3]-a[0],a[7]-a[4],a[11]-a[8],a[15]-a[12]),bottom:lD(a[3]+a[1],a[7]+a[5],a[11]+a[9],a[15]+a[13]),top:lD(a[3]-a[1],a[7]-a[5],a[11]-a[9],a[15]-a[13]),near:lD(a[3]+a[2],a[7]+a[6],a[11]+a[10],a[15]+a[14]),far:lD(a[3]-a[2],a[7]-a[6],a[11]-a[10],a[15]-a[14])}),this._frustumPlanes)}panByPosition(a,b){return null}_initProps(a){let b=a.longitude,c=a.latitude;this.isGeospatial&&(Number.isFinite(a.zoom)||(this.zoom=function(a){let{latitude:b}=a;return jB(Number.isFinite(b)),jy(4003e4*Math.cos(b*jE))-9}({latitude:c})+Math.log2(this.focalDistance)),this.distanceScales=a.distanceScales||jJ({latitude:c,longitude:b}));let d=Math.pow(2,this.zoom);this.scale=d;let{position:e,modelMatrix:f}=a,g=lI;if(e&&(g=f?new jt(f).transformAsVector(e,[]):e),this.isGeospatial){let a=this.projectPosition([b,c,0]);this.center=new iP(g).scale(this.distanceScales.unitsPerMeter).add(a)}else this.center=this.projectPosition(g)}_initMatrices(a){var b;let{viewMatrix:c=lH,projectionMatrix:d=null,orthographic:e=!1,fovyRadians:f,fovy:g=75,near:h=.1,far:i=1e3,padding:j=null,focalDistance:k=1}=a;this.viewMatrixUncentered=c,this.viewMatrix=new jt().multiplyRight(c).translate(new iP(this.center).negate()),this.projectionMatrix=d||function({width:a,height:b,orthographic:c,fovyRadians:d,focalDistance:e,padding:f,near:g,far:h}){let i=a/b,j=c?new jt().orthographic({fovy:d,aspect:i,focalDistance:e,near:g,far:h}):new jt().perspective({fovy:d,aspect:i,near:g,far:h});if(f){let{left:c=0,right:d=0,top:e=0,bottom:g=0}=f,h=hZ((c+a-d)/2,0,a)-a/2,i=hZ((e+b-g)/2,0,b)-b/2;j[8]-=2*h/a,j[9]+=2*i/b}return j}({width:this.width,height:this.height,orthographic:e,fovyRadians:f||g*lG,focalDistance:k,padding:j,near:h,far:i});let l=lB();gi.multiply(l,l,this.projectionMatrix),gi.multiply(l,l,this.viewMatrix),this.viewProjectionMatrix=l,this.viewMatrixInverse=gi.invert([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=[(b=this.viewMatrixInverse)[12],b[13],b[14]];let n=lB(),o=lB();gi.scale(n,n,[this.width/2,-this.height/2,1]),gi.translate(n,n,[1,-1,0]),gi.multiply(o,n,this.viewProjectionMatrix),this.pixelProjectionMatrix=o,this.pixelUnprojectionMatrix=gi.invert(lB(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||gT.warn("Pixel project matrix not invertible")()}}lK.displayName="Viewport";let lL=lK;class lM{constructor(a,b){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=a=>{kc("layerManager.activateViewport",this,a),a&&(this.context.viewport=a)};const{deck:c,stats:d,viewport:e,timeline:f}=b||{};this.layers=[],this.resourceManager=new lz({device:a,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:a,gl:a?.gl,deck:c,shaderAssembler:function(a){let b=fe.getDefaultShaderAssembler();for(let a of j1)b.addDefaultModule(a);for(let c of(b._hookFunctions.length=0,"glsl"===a?j2:j3))b.addShaderHook(c);return b}(a?.info?.shadingLanguage||"glsl"),defaultShaderModules:[fq],renderPass:void 0,stats:d||new ke.Stats({id:"deck.gl"}),viewport:e||new lL({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:f||new eP,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){for(let a of(this.resourceManager.finalize(),this.layers))this._finalizeLayer(a)}needsRedraw(a={clearRedrawFlags:!1}){let b=this._needsRedraw;for(let c of(a.clearRedrawFlags&&(this._needsRedraw=!1),this.layers)){let d=c.getNeedsRedraw(a);b=b||d}return b}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(a){this._needsRedraw=this._needsRedraw||a}setNeedsUpdate(a){this._needsUpdate=this._needsUpdate||a}getLayers({layerIds:a}={}){return a?this.layers.filter(b=>a.find(a=>0===b.id.indexOf(a))):this.layers}setProps(a){"debug"in a&&(this._debug=a.debug),"userData"in a&&(this.context.userData=a.userData),"layers"in a&&(this._nextLayers=a.layers),"onError"in a&&(this.context.onError=a.onError)}setLayers(a,b){kc("layerManager.setLayers",this,b,a),this._lastRenderedLayers=a;let c=kd(a,Boolean);for(let a of c)a.context=this.context;this._updateLayers(this.layers,c)}updateLayers(){let a=this.needsUpdate();a&&(this.setNeedsRedraw(`updating layers: ${a}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,a)),this._nextLayers=null}addDefaultShaderModule(a){let{defaultShaderModules:b}=this.context;b.find(b=>b.name===a.name)||(b.push(a),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(a){let{defaultShaderModules:b}=this.context,c=b.findIndex(b=>b.name===a.name);c>=0&&(b.splice(c,1),this._defaultShaderModulesChanged=!0)}_handleError(a,b,c){c.raiseError(b,`${a} of ${c}`)}_updateLayers(a,b){let c={};for(let b of a)c[b.id]?gT.warn(`Multiple old layers with same id ${b.id}`)():c[b.id]=b;if(this._defaultShaderModulesChanged){for(let b of a)b.setNeedsUpdate(),b.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}let d=[];this._updateSublayersRecursively(b,c,d),this._finalizeOldLayers(c);let e=!1;for(let a of d)if(a.hasUniformTransition()){e=`Uniform transition in ${a}`;break}this._needsUpdate=e,this.layers=d}_updateSublayersRecursively(a,b,c){for(let d of a){d.context=this.context;let a=b[d.id];null===a&&gT.warn(`Multiple new layers with same id ${d.id}`)(),b[d.id]=null;let e=null;try{this._debug&&a!==d&&d.validateProps(),a?(this._transferLayerState(a,d),this._updateLayer(d)):this._initializeLayer(d),c.push(d),e=d.isComposite?d.getSubLayers():null}catch(a){this._handleError("matching",a,d)}e&&this._updateSublayersRecursively(e,b,c)}}_finalizeOldLayers(a){for(let b in a){let c=a[b];c&&this._finalizeLayer(c)}}_initializeLayer(a){try{a._initialize(),a.lifecycle="Initialized"}catch(b){this._handleError("initialization",b,a)}}_transferLayerState(a,b){b._transferState(a),b.lifecycle="Matched. State transferred from previous layer",b!==a&&(a.lifecycle="Discarded. Awaiting garbage collection")}_updateLayer(a){try{a._update()}catch(b){this._handleError("update",b,a)}}_finalizeLayer(a){this._needsRedraw=this._needsRedraw||`finalized ${a}`,a.lifecycle="No longer matched. Awaiting garbage collection";try{a._finalize(),a.lifecycle="Finalized! Awaiting garbage collection"}catch(b){this._handleError("finalization",b,a)}}}function lN(a,b,c){if(a===b)return!0;if(!c||!a||!b)return!1;if(Array.isArray(a)){if(!Array.isArray(b)||a.length!==b.length)return!1;for(let d=0;d<a.length;d++)if(!lN(a[d],b[d],c-1))return!1;return!0}if(Array.isArray(b))return!1;if("object"==typeof a&&"object"==typeof b){let d=Object.keys(a),e=Object.keys(b);if(d.length!==e.length)return!1;for(let e of d)if(!b.hasOwnProperty(e)||!lN(a[e],b[e],c-1))return!1;return!0}return!1}class lO{constructor(a){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=a.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=a.eventManager,this._eventCallbacks={onViewStateChange:a.onViewStateChange,onInteractionStateChange:a.onInteractionStateChange},Object.seal(this),this.setProps(a)}finalize(){for(let a in this.controllers){let b=this.controllers[a];b&&b.finalize()}this.controllers={}}needsRedraw(a={clearRedrawFlags:!1}){let b=this._needsRedraw;return a.clearRedrawFlags&&(this._needsRedraw=!1),b}setNeedsUpdate(a){this._needsUpdate=this._needsUpdate||a,this._needsRedraw=this._needsRedraw||a}updateViewStates(){for(let a in this.controllers){let b=this.controllers[a];b&&b.updateTransition()}}getViewports(a){return a?this._viewports.filter(b=>b.containsPixel(a)):this._viewports}getViews(){let a={};return this.views.forEach(b=>{a[b.id]=b}),a}getView(a){return this.views.find(b=>b.id===a)}getViewState(a){let b="string"==typeof a?this.getView(a):a,c=b&&this.viewState[b.getViewStateId()]||this.viewState;return b?b.filterViewState(c):c}getViewport(a){return this._viewportMap[a]}unproject(a,b){let c=this.getViewports(),d={x:a[0],y:a[1]};for(let e=c.length-1;e>=0;--e){let f=c[e];if(f.containsPixel(d)){let c=a.slice();return c[0]-=f.x,c[1]-=f.y,f.unproject(c,b)}}return null}setProps(a){a.views&&this._setViews(a.views),a.viewState&&this._setViewState(a.viewState),("width"in a||"height"in a)&&this._setSize(a.width,a.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(a,b){(a!==this.width||b!==this.height)&&(this.width=a,this.height=b,this.setNeedsUpdate("Size changed"))}_setViews(a){a=kd(a,Boolean),this._diffViews(a,this.views)&&this.setNeedsUpdate("views changed"),this.views=a}_setViewState(a){a?(lN(a,this.viewState,3)||this.setNeedsUpdate("viewState changed"),this.viewState=a):gT.warn("missing `viewState` or `initialViewState`")()}_createController(a,b){return new b.type({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:b=>this.getView(a.id)?.makeViewport({viewState:b,width:this.width,height:this.height})})}_updateController(a,b,c,d){let e=a.controller;if(e&&c){let f={...b,...e,id:a.id,x:c.x,y:c.y,width:c.width,height:c.height};return d&&d.constructor===e.type||(d=this._createController(a,f)),d&&d.setProps(f),d}return null}_rebuildViewports(){let{views:a}=this,b=this.controllers;this._viewports=[],this.controllers={};let c=!1;for(let d=a.length;d--;){let e=a[d],f=this.getViewState(e),g=e.makeViewport({viewState:f,width:this.width,height:this.height}),h=b[e.id],i=!!e.controller;i&&!h&&(c=!0),(c||!i)&&h&&(h.finalize(),h=null),this.controllers[e.id]=this._updateController(e,f,g,h),g&&this._viewports.unshift(g)}for(let a in b){let c=b[a];c&&!this.controllers[a]&&c.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(a=>{a.id&&(this._viewportMap[a.id]=this._viewportMap[a.id]||a)})}_diffViews(a,b){return a.length!==b.length||a.some((c,d)=>!a[d].equals(b[d]))}}let lP=/([0-9]+\.?[0-9]*)(%|px)/;function lQ(a){switch(typeof a){case"number":return{position:a,relative:!1};case"string":let b=lP.exec(a);if(b&&b.length>=3){let a="%"===b[2],c=parseFloat(b[1]);return{position:a?c/100:c,relative:a}}default:throw Error(`Could not parse position string ${a}`)}}function lR(a,b){return a.relative?Math.round(a.position*b):a.position}class lS{constructor(a){const{id:b,x:c=0,y:d=0,width:e="100%",height:f="100%",padding:g=null}=a;this.id=b||this.constructor.displayName||"view",this.props={...a,id:this.id},this._x=lQ(c),this._y=lQ(d),this._width=lQ(e),this._height=lQ(f),this._padding=g&&{left:lQ(g.left||0),right:lQ(g.right||0),top:lQ(g.top||0),bottom:lQ(g.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(a){return this===a||this.constructor===a.constructor&&lN(this.props,a.props,2)}clone(a){return new this.constructor({...this.props,...a})}makeViewport({width:a,height:b,viewState:c}){c=this.filterViewState(c);let d=this.getDimensions({width:a,height:b});return d.height&&d.width?new(this.getViewportType(c))({...c,...this.props,...d}):null}getViewStateId(){let{viewState:a}=this.props;return"string"==typeof a?a:a?.id||this.id}filterViewState(a){if(this.props.viewState&&"object"==typeof this.props.viewState){if(!this.props.viewState.id)return this.props.viewState;let b={...a};for(let a in this.props.viewState)"id"!==a&&(b[a]=this.props.viewState[a]);return b}return a}getDimensions({width:a,height:b}){let c={x:lR(this._x,a),y:lR(this._y,b),width:lR(this._width,a),height:lR(this._height,b)};return this._padding&&(c.padding={left:lR(this._padding.left,a),top:lR(this._padding.top,b),right:lR(this._padding.right,a),bottom:lR(this._padding.bottom,b)}),c}get controller(){let a=this.props.controller;return a?!0===a?{type:this.ControllerType}:"function"==typeof a?{type:a}:{type:this.ControllerType,...a}:null}}var jz=jz;class lT extends lL{constructor(a={}){let b;const{latitude:c=0,longitude:d=0,zoom:e=0,pitch:f=0,bearing:g=0,nearZMultiplier:h=.1,farZMultiplier:i=1.01,nearZ:j,farZ:k,orthographic:l=!1,projectionMatrix:n,repeat:o=!1,worldOffset:p=0,position:q,padding:r,legacyMeterSizes:s=!1}=a;let{width:t,height:u,altitude:v=1.5}=a;const w=Math.pow(2,e);t=t||1,u=u||1;let x=null;if(n)b=jL(v=n[5]/2);else{let d;if(a.fovy?v=jM(b=a.fovy):b=jL(v),r){const{top:a=0,bottom:b=0}=r;d=[0,hZ((a+u-b)/2,0,u)-u/2]}x=function(a){let{width:b,height:c,altitude:d,pitch:e=0,offset:f,center:g,scale:h,nearZMultiplier:i=1,farZMultiplier:j=1}=a,{fovy:k=jL(1.5)}=a;void 0!==d&&(k=jL(d));let l=k*jE,n=e*jE,o=jM(k),p=o;g&&(p+=g[2]*h/Math.cos(n)/c);let q=l*(.5+(f?f[1]:0)/c),r=Math.sin(q)*p/Math.sin(jx(Math.PI/2-n-q,.01,Math.PI-.01));return{fov:l,aspect:b/c,focalDistance:o,near:i,far:Math.min((Math.sin(n)*r+p)*j,10*p)}}({width:t,height:u,scale:w,center:q&&[0,0,q[2]*jI(c)],offset:d,pitch:f,fovy:b,nearZMultiplier:h,farZMultiplier:i}),Number.isFinite(j)&&(x.near=j),Number.isFinite(k)&&(x.far=k)}let y=function(a){let{height:b,pitch:c,bearing:d,altitude:e,scale:f,center:g}=a,h=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];gi.translate(h,h,[0,0,-e]),gi.rotateX(h,h,-c*jE),gi.rotateZ(h,h,d*jE);let i=f/b;return gi.scale(h,h,[i,i,i]),g&&gi.translate(h,h,jA.negate([],g)),h}({height:u,pitch:f,bearing:g,scale:w,altitude:v});p&&(y=new jt().translate([512*p,0,0]).multiplyLeft(y)),super({...a,width:t,height:u,viewMatrix:y,longitude:d,latitude:c,zoom:e,...x,fovy:b,focalDistance:v}),this.latitude=c,this.longitude=d,this.zoom=e,this.pitch=f,this.bearing=g,this.altitude=v,this.fovy=b,this.orthographic=l,this._subViewports=o?[]:null,this._pseudoMeters=s,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){let a=this.getBounds(),b=Math.floor((a[0]+180)/360),c=Math.ceil((a[2]-180)/360);for(let a=b;a<=c;a++){let b=a?new lT({...this,worldOffset:a}):this;this._subViewports.push(b)}}return this._subViewports}projectPosition(a){if(this._pseudoMeters)return super.projectPosition(a);let[b,c]=this.projectFlat(a);return[b,c,(a[2]||0)*jI(a[1])]}unprojectPosition(a){if(this._pseudoMeters)return super.unprojectPosition(a);let[b,c]=this.unprojectFlat(a),d=(a[2]||0)/jI(c);return[b,c,d]}addMetersToLngLat(a,b){return jK(a,b)}panByPosition(a,b){let c=jO(b,this.pixelUnprojectionMatrix),d=this.projectFlat(a),e=jz.add([],d,jz.negate([],c)),f=jz.add([],this.center,e),[g,h]=this.unprojectFlat(f);return{longitude:g,latitude:h}}getBounds(a={}){let b=function(a,b=0){let c,d,{width:e,height:f,unproject:g}=a,h={targetZ:b},i=g([0,f],h),j=g([e,f],h);return(a.fovy?.5*a.fovy*jP:Math.atan(.5/a.altitude))>(90-a.pitch)*jP-.01?(c=jQ(a,0,b),d=jQ(a,e,b)):(c=g([0,0],h),d=g([e,0],h)),[i,j,d,c]}(this,a.z||0);return[Math.min(b[0][0],b[1][0],b[2][0],b[3][0]),Math.min(b[0][1],b[1][1],b[2][1],b[3][1]),Math.max(b[0][0],b[1][0],b[2][0],b[3][0]),Math.max(b[0][1],b[1][1],b[2][1],b[3][1])]}fitBounds(a,b={}){let{width:c,height:d}=this,{longitude:e,latitude:f,zoom:g}=function(a){let{width:b,height:c,bounds:d,minExtent:e=0,maxZoom:f=24,offset:g=[0,0]}=a,[[h,i],[j,k]]=d,l=function(a=0){return"number"==typeof a?{top:a,bottom:a,left:a,right:a}:(jB(Number.isFinite(a.top)&&Number.isFinite(a.bottom)&&Number.isFinite(a.left)&&Number.isFinite(a.right)),a)}(a.padding),n=jG([h,jx(k,-85.051129,85.051129)]),o=jG([j,jx(i,-85.051129,85.051129)]),p=[Math.max(Math.abs(o[0]-n[0]),e),Math.max(Math.abs(o[1]-n[1]),e)],q=[b-l.left-l.right-2*Math.abs(g[0]),c-l.top-l.bottom-2*Math.abs(g[1])];jB(q[0]>0&&q[1]>0);let r=q[0]/p[0],s=q[1]/p[1],t=(l.right-l.left)/2/r,u=(l.top-l.bottom)/2/s,v=jH([(o[0]+n[0])/2+t,(o[1]+n[1])/2+u]),w=Math.min(f,jy(Math.abs(Math.min(r,s))));return jB(Number.isFinite(w)),{longitude:v[0],latitude:v[1],zoom:w}}({width:c,height:d,bounds:a,...b});return new lT({width:c,height:d,longitude:e,latitude:f,zoom:g})}}lT.displayName="WebMercatorViewport";class lU{constructor(a){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=a}get inProgress(){return this._inProgress}start(a){this.cancel(),this.settings=a,this._inProgress=!0,this.settings.onStart?.(this)}end(){this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,this.settings.onEnd?.(this))}cancel(){this._inProgress&&(this.settings.onInterrupt?.(this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){if(!this._inProgress)return!1;if(null===this._handle){let{_timeline:a,settings:b}=this;this._handle=a.addChannel({delay:a.getTime(),duration:b.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),this.settings.onUpdate?.(this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}let lV=()=>{},lW=a=>a;class lX{constructor(a){this._onTransitionUpdate=a=>{let{time:b,settings:{interpolator:c,startProps:d,endProps:e,duration:f,easing:g}}=a,h=g(b/f),i=c.interpolateProps(d,e,h);this.propsInTransition=this.getControllerState({...this.props,...i}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=a.getControllerState,this.propsInTransition=null,this.transition=new lU(a.timeline),this.onViewStateChange=a.onViewStateChange||lV,this.onStateChange=a.onStateChange||lV}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(a){let b=!1,c=this.props;if(this.props=a,!c||this._shouldIgnoreViewportChange(c,a))return!1;if(this._isTransitionEnabled(a)){let d=c;if(this.transition.inProgress){let{interruption:a,endProps:b}=this.transition.settings;d={...c,...2===a?b:this.propsInTransition||c}}this._triggerTransition(d,a),b=!0}else this.transition.cancel();return b}updateTransition(){this.transition.update()}_isTransitionEnabled(a){let{transitionDuration:b,transitionInterpolator:c}=a;return(b>0||"auto"===b)&&!!c}_isUpdateDueToCurrentTransition(a){return!!this.transition.inProgress&&!!this.propsInTransition&&this.transition.settings.interpolator.arePropsEqual(a,this.propsInTransition)}_shouldIgnoreViewportChange(a,b){return this.transition.inProgress?3===this.transition.settings.interruption||this._isUpdateDueToCurrentTransition(b):!this._isTransitionEnabled(b)||b.transitionInterpolator.arePropsEqual(a,b)}_triggerTransition(a,b){let c=this.getControllerState(a),d=this.getControllerState(b).shortestPathFrom(c),e=b.transitionInterpolator,f=e.getDuration?e.getDuration(a,b):b.transitionDuration;if(0===f)return;let g=e.initializeProps(a,d);this.propsInTransition={};let h={duration:f,easing:b.transitionEasing||lW,interpolator:e,interruption:b.transitionInterruption||1,startProps:g.start,endProps:g.end,onStart:b.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(b.onTransitionInterrupt),onEnd:this._onTransitionEnd(b.onTransitionEnd)};this.transition.start(h),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(a){return b=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),a?.(b)}}}function lY(a,b){if(!a)throw Error(b||"deck.gl: assertion failed.")}class lZ{constructor(a){const{compare:b,extract:c,required:d}=a;this._propsToCompare=b,this._propsToExtract=c||b,this._requiredProps=d}arePropsEqual(a,b){for(let c of this._propsToCompare)if(!(c in a)||!(c in b)||!h_(a[c],b[c]))return!1;return!0}initializeProps(a,b){let c={},d={};for(let e of this._propsToExtract)(e in a||e in b)&&(c[e]=a[e],d[e]=b[e]);return this._checkRequiredProps(c),this._checkRequiredProps(d),{start:c,end:d}}getDuration(a,b){return b.transitionDuration}_checkRequiredProps(a){this._requiredProps&&this._requiredProps.forEach(b=>{let c=a[b];lY(Number.isFinite(c)||Array.isArray(c),`${b} is required for transition`)})}}let l$=["longitude","latitude","zoom","bearing","pitch"],l_=["longitude","latitude","zoom"];class l0 extends lZ{constructor(a={}){const b=Array.isArray(a)?a:a.transitionProps,c=Array.isArray(a)?{}:a;c.transitionProps=Array.isArray(b)?{compare:b,required:b}:b||{compare:l$,required:l_},super(c.transitionProps),this.opts=c}initializeProps(a,b){let c=super.initializeProps(a,b),{makeViewport:d,around:e}=this.opts;if(d&&e){let f=d(a),g=d(b),h=f.unproject(e);c.start.around=e,Object.assign(c.end,{around:g.project(h),aroundPosition:h,width:b.width,height:b.height})}return c}interpolateProps(a,b,c){let d={};for(let e of this._propsToExtract)d[e]=h$(a[e]||0,b[e]||0,c);if(b.aroundPosition&&this.opts.makeViewport){let e=this.opts.makeViewport({...b,...d});Object.assign(d,e.panByPosition(b.aroundPosition,h$(a.around,b.around,c)))}return d}}let l1={transitionDuration:0},l2=a=>1-(1-a)*(1-a),l3=["wheel"],l4=["panstart","panmove","panend"],l5=["pinchstart","pinchmove","pinchend"],l6=["multipanstart","multipanmove","multipanend"],l7=["dblclick"],l8=["keydown"],l9={};class ma{constructor(a){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new lX({...a,getControllerState:a=>new this.ControllerState(a),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=a.eventManager,this.onViewStateChange=a.onViewStateChange||(()=>{}),this.onStateChange=a.onStateChange||(()=>{}),this.makeViewport=a.makeViewport}set events(a){this.toggleEvents(this._customEvents,!1),this.toggleEvents(a,!0),this._customEvents=a,this.props&&this.setProps(this.props)}finalize(){for(let a in this._events)this._events[a]&&this.eventManager?.off(a,this.handleEvent);this.transitionManager.finalize()}handleEvent(a){this._controllerState=void 0;let b=this._eventStartBlocked;switch(a.type){case"panstart":return!b&&this._onPanStart(a);case"panmove":return this._onPan(a);case"panend":return this._onPanEnd(a);case"pinchstart":return!b&&this._onPinchStart(a);case"pinchmove":return this._onPinch(a);case"pinchend":return this._onPinchEnd(a);case"multipanstart":return!b&&this._onMultiPanStart(a);case"multipanmove":return this._onMultiPan(a);case"multipanend":return this._onMultiPanEnd(a);case"dblclick":return this._onDoubleClick(a);case"wheel":return this._onWheel(a);case"keydown":return this._onKeyDown(a);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(a){let{x:b,y:c}=this.props,{offsetCenter:d}=a;return[d.x-b,d.y-c]}isPointInBounds(a,b){let{width:c,height:d}=this.props;if(b&&b.handled)return!1;let e=a[0]>=0&&a[0]<=c&&a[1]>=0&&a[1]<=d;return e&&b&&b.stopPropagation(),e}isFunctionKeyPressed(a){let{srcEvent:b}=a;return!!(b.metaKey||b.altKey||b.ctrlKey||b.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(a){let b=setTimeout(()=>{this._eventStartBlocked===b&&(this._eventStartBlocked=null)},a);this._eventStartBlocked=b}setProps(a){a.dragMode&&(this.dragMode=a.dragMode),this.props=a,"transitionInterpolator"in a||(a.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(a);let{inertia:b}=a;this.inertia=Number.isFinite(b)?b:300*(!0===b);let{scrollZoom:c=!0,dragPan:d=!0,dragRotate:e=!0,doubleClickZoom:f=!0,touchZoom:g=!0,touchRotate:h=!1,keyboard:i=!0}=a,j=!!this.onViewStateChange;this.toggleEvents(l3,j&&c),this.toggleEvents(l4,j),this.toggleEvents(l5,j&&(g||h)),this.toggleEvents(l6,j&&h),this.toggleEvents(l7,j&&f),this.toggleEvents(l8,j&&i),this.scrollZoom=c,this.dragPan=d,this.dragRotate=e,this.doubleClickZoom=f,this.touchZoom=g,this.touchRotate=h,this.keyboard=i}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(a,b){this.eventManager&&a.forEach(a=>{this._events[a]!==b&&(this._events[a]=b,b?this.eventManager.on(a,this.handleEvent):this.eventManager.off(a,this.handleEvent))})}updateViewport(a,b=null,c={}){let d={...a.getViewportProps(),...b},e=this.controllerState!==a;if(this.state=a.getState(),this._setInteractionState(c),e){let a=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:d,interactionState:this._interactionState,oldViewState:a,viewId:this.props.id})}}_onTransition(a){this.onViewStateChange({...a,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(a){Object.assign(this._interactionState,a),this.onStateChange(this._interactionState)}_onPanStart(a){let b=this.getCenter(a);if(!this.isPointInBounds(b,a))return!1;let c=this.isFunctionKeyPressed(a)||a.rightButton||!1;(this.invertPan||"pan"===this.dragMode)&&(c=!c);let d=this.controllerState[c?"panStart":"rotateStart"]({pos:b});return this._panMove=c,this.updateViewport(d,l1,{isDragging:!0}),!0}_onPan(a){return!!this.isDragging()&&(this._panMove?this._onPanMove(a):this._onPanRotate(a))}_onPanEnd(a){return!!this.isDragging()&&(this._panMove?this._onPanMoveEnd(a):this._onPanRotateEnd(a))}_onPanMove(a){if(!this.dragPan)return!1;let b=this.getCenter(a),c=this.controllerState.pan({pos:b});return this.updateViewport(c,l1,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(a){let{inertia:b}=this;if(this.dragPan&&b&&a.velocity){let c=this.getCenter(a),d=[c[0]+a.velocityX*b/2,c[1]+a.velocityY*b/2],e=this.controllerState.pan({pos:d}).panEnd();this.updateViewport(e,{...this._getTransitionProps(),transitionDuration:b,transitionEasing:l2},{isDragging:!1,isPanning:!0})}else{let a=this.controllerState.panEnd();this.updateViewport(a,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(a){if(!this.dragRotate)return!1;let b=this.getCenter(a),c=this.controllerState.rotate({pos:b});return this.updateViewport(c,l1,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(a){let{inertia:b}=this;if(this.dragRotate&&b&&a.velocity){let c=this.getCenter(a),d=[c[0]+a.velocityX*b/2,c[1]+a.velocityY*b/2],e=this.controllerState.rotate({pos:d}).rotateEnd();this.updateViewport(e,{...this._getTransitionProps(),transitionDuration:b,transitionEasing:l2},{isDragging:!1,isRotating:!0})}else{let a=this.controllerState.rotateEnd();this.updateViewport(a,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(a){if(!this.scrollZoom)return!1;let b=this.getCenter(a);if(!this.isPointInBounds(b,a))return!1;a.srcEvent.preventDefault();let{speed:c=.01,smooth:d=!1}=!0===this.scrollZoom?{}:this.scrollZoom,{delta:e}=a,f=2/(1+Math.exp(-Math.abs(e*c)));e<0&&0!==f&&(f=1/f);let g=d?{...this._getTransitionProps({around:b}),transitionDuration:250}:l1,h=this.controllerState.zoom({pos:b,scale:f});return this.updateViewport(h,g,{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(a){let b=this.getCenter(a);if(!this.isPointInBounds(b,a))return!1;let c=this.controllerState.rotateStart({pos:b});return this.updateViewport(c,l1,{isDragging:!0}),!0}_onMultiPan(a){if(!this.touchRotate||!this.isDragging())return!1;let b=this.getCenter(a);b[0]-=a.deltaX;let c=this.controllerState.rotate({pos:b});return this.updateViewport(c,l1,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(a){if(!this.isDragging())return!1;let{inertia:b}=this;if(this.touchRotate&&b&&a.velocityY){let c=this.getCenter(a),d=[c[0],c[1]+=a.velocityY*b/2],e=this.controllerState.rotate({pos:d});this.updateViewport(e,{...this._getTransitionProps(),transitionDuration:b,transitionEasing:l2},{isDragging:!1,isRotating:!0}),this.blockEvents(b)}else{let a=this.controllerState.rotateEnd();this.updateViewport(a,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(a){let b=this.getCenter(a);if(!this.isPointInBounds(b,a))return!1;let c=this.controllerState.zoomStart({pos:b}).rotateStart({pos:b});return l9._startPinchRotation=a.rotation,l9._lastPinchEvent=a,this.updateViewport(c,l1,{isDragging:!0}),!0}_onPinch(a){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let b=this.controllerState;if(this.touchZoom){let{scale:c}=a,d=this.getCenter(a);b=b.zoom({pos:d,scale:c})}if(this.touchRotate){let{rotation:c}=a;b=b.rotate({deltaAngleX:l9._startPinchRotation-c})}return this.updateViewport(b,l1,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),l9._lastPinchEvent=a,!0}_onPinchEnd(a){if(!this.isDragging())return!1;let{inertia:b}=this,{_lastPinchEvent:c}=l9;if(this.touchZoom&&b&&c&&a.scale!==c.scale){let d=this.getCenter(a),e=this.controllerState.rotateEnd(),f=Math.log2(a.scale),g=(f-Math.log2(c.scale))/(a.deltaTime-c.deltaTime),h=Math.pow(2,f+g*b/2);e=e.zoom({pos:d,scale:h}).zoomEnd(),this.updateViewport(e,{...this._getTransitionProps({around:d}),transitionDuration:b,transitionEasing:l2},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(b)}else{let a=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(a,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return l9._startPinchRotation=null,l9._lastPinchEvent=null,!0}_onDoubleClick(a){if(!this.doubleClickZoom)return!1;let b=this.getCenter(a);if(!this.isPointInBounds(b,a))return!1;let c=this.isFunctionKeyPressed(a),d=this.controllerState.zoom({pos:b,scale:c?.5:2});return this.updateViewport(d,this._getTransitionProps({around:b}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(a){let b;if(!this.keyboard)return!1;let c=this.isFunctionKeyPressed(a),{zoomSpeed:d,moveSpeed:e,rotateSpeedX:f,rotateSpeedY:g}=!0===this.keyboard?{}:this.keyboard,{controllerState:h}=this,i={};switch(a.srcEvent.code){case"Minus":b=c?h.zoomOut(d).zoomOut(d):h.zoomOut(d),i.isZooming=!0;break;case"Equal":b=c?h.zoomIn(d).zoomIn(d):h.zoomIn(d),i.isZooming=!0;break;case"ArrowLeft":c?(b=h.rotateLeft(f),i.isRotating=!0):(b=h.moveLeft(e),i.isPanning=!0);break;case"ArrowRight":c?(b=h.rotateRight(f),i.isRotating=!0):(b=h.moveRight(e),i.isPanning=!0);break;case"ArrowUp":c?(b=h.rotateUp(g),i.isRotating=!0):(b=h.moveUp(e),i.isPanning=!0);break;case"ArrowDown":c?(b=h.rotateDown(g),i.isRotating=!0):(b=h.moveDown(e),i.isPanning=!0);break;default:return!1}return this.updateViewport(b,this._getTransitionProps(),i),!0}_getTransitionProps(a){let{transition:b}=this;return b&&b.transitionInterpolator?a?{...b,transitionInterpolator:new l0({...a,...b.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:b:l1}}class mb{constructor(a,b){this._viewportProps=this.applyConstraints(a),this._state=b}getViewportProps(){return this._viewportProps}getState(){return this._state}}class mc extends mb{constructor(a){const{width:b,height:c,latitude:d,longitude:e,zoom:f,bearing:g=0,pitch:h=0,altitude:i=1.5,position:j=[0,0,0],maxZoom:k=20,minZoom:l=0,maxPitch:n=60,minPitch:o=0,startPanLngLat:p,startZoomLngLat:q,startRotatePos:r,startBearing:s,startPitch:t,startZoom:u,normalize:v=!0}=a;lY(Number.isFinite(e)),lY(Number.isFinite(d)),lY(Number.isFinite(f)),super({width:b,height:c,latitude:d,longitude:e,zoom:f,bearing:g,pitch:h,altitude:i,maxZoom:k,minZoom:l,maxPitch:n,minPitch:o,normalize:v,position:j},{startPanLngLat:p,startZoomLngLat:q,startRotatePos:r,startBearing:s,startPitch:t,startZoom:u}),this.makeViewport=a.makeViewport}panStart({pos:a}){return this._getUpdatedState({startPanLngLat:this._unproject(a)})}pan({pos:a,startPos:b}){let c=this.getState().startPanLngLat||this._unproject(b);if(!c)return this;let d=this.makeViewport(this.getViewportProps()).panByPosition(c,a);return this._getUpdatedState(d)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:a}){return this._getUpdatedState({startRotatePos:a,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:a,deltaAngleX:b=0,deltaAngleY:c=0}){let d,{startRotatePos:e,startBearing:f,startPitch:g}=this.getState();return e&&void 0!==f&&void 0!==g?(d=a?this._getNewRotation(a,e,g,f):{bearing:f+b,pitch:g+c},this._getUpdatedState(d)):this}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:a}){return this._getUpdatedState({startZoomLngLat:this._unproject(a),startZoom:this.getViewportProps().zoom})}zoom({pos:a,startPos:b,scale:c}){let{startZoom:d,startZoomLngLat:e}=this.getState();if(e||(d=this.getViewportProps().zoom,e=this._unproject(b)||this._unproject(a)),!e)return this;let{maxZoom:f,minZoom:g}=this.getViewportProps(),h=d+Math.log2(c);h=hZ(h,g,f);let i=this.makeViewport({...this.getViewportProps(),zoom:h});return this._getUpdatedState({zoom:h,...i.panByPosition(e,a)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(a=2){return this._zoomFromCenter(a)}zoomOut(a=2){return this._zoomFromCenter(1/a)}moveLeft(a=100){return this._panFromCenter([a,0])}moveRight(a=100){return this._panFromCenter([-a,0])}moveUp(a=100){return this._panFromCenter([0,a])}moveDown(a=100){return this._panFromCenter([0,-a])}rotateLeft(a=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-a})}rotateRight(a=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+a})}rotateUp(a=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+a})}rotateDown(a=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-a})}shortestPathFrom(a){let b=a.getViewportProps(),c={...this.getViewportProps()},{bearing:d,longitude:e}=c;return Math.abs(d-b.bearing)>180&&(c.bearing=d<0?d+360:d-360),Math.abs(e-b.longitude)>180&&(c.longitude=e<0?e+360:e-360),c}applyConstraints(a){let{maxZoom:b,minZoom:c,zoom:d}=a;a.zoom=hZ(d,c,b);let{maxPitch:e,minPitch:f,pitch:g}=a;a.pitch=hZ(g,f,e);let{normalize:h=!0}=a;return h&&Object.assign(a,function(a){let{width:b,height:c,pitch:d=0}=a,{longitude:e,latitude:f,zoom:g,bearing:h=0}=a;(e<-180||e>180)&&(e=jw(e+180,360)-180),(h<-180||h>180)&&(h=jw(h+180,360)-180);let i=jy(c/512);if(g<=i)g=i,f=0;else{let a=c/2/Math.pow(2,g),b=jH([0,a])[1];if(f<b)f=b;else{let b=jH([0,512-a])[1];f>b&&(f=b)}}return{width:b,height:c,longitude:e,latitude:f,zoom:g,pitch:d,bearing:h}}(a)),a}_zoomFromCenter(a){let{width:b,height:c}=this.getViewportProps();return this.zoom({pos:[b/2,c/2],scale:a})}_panFromCenter(a){let{width:b,height:c}=this.getViewportProps();return this.pan({startPos:[b/2,c/2],pos:[b/2+a[0],c/2+a[1]]})}_getUpdatedState(a){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...a})}_unproject(a){let b=this.makeViewport(this.getViewportProps());return a&&b.unproject(a)}_getNewRotation(a,b,c,d){let e=a[0]-b[0],f=a[1]-b[1],g=a[1],h=b[1],{width:i,height:j}=this.getViewportProps(),k=0;f>0?Math.abs(j-h)>5&&(k=f/(h-j)*1.2):f<0&&h>5&&(k=1-g/h),k=hZ(k,-1,1);let{minPitch:l,maxPitch:n}=this.getViewportProps(),o=c;return k>0?o=c+k*(n-c):k<0&&(o=c-k*(l-c)),{pitch:o,bearing:d+e/i*180}}}class md extends ma{constructor(){super(...arguments),this.ControllerState=mc,this.transition={transitionDuration:300,transitionInterpolator:new l0({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(a){a.position=a.position||[0,0,0];let b=this.props;super.setProps(a),b&&b.height===a.height||this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...a,...this.state}))}}class me extends lS{constructor(a={}){super(a)}getViewportType(){return lT}get ControllerType(){return md}}me.displayName="MapView";let mf=[255,255,255],mg=0;class mh{constructor(a={}){this.type="ambient";const{color:b=mf}=a,{intensity:c=1}=a;this.id=a.id||`ambient-${mg++}`,this.color=b,this.intensity=c}}let mi=[255,255,255],mj=[0,0,-1],mk=0;class ml{constructor(a={}){this.type="directional";const{color:b=mi}=a,{intensity:c=1}=a,{direction:d=mj}=a,{_shadow:e=!1}=a;this.id=a.id||`directional-${mk++}`,this.color=b,this.intensity=c,this.type="directional",this.direction=new iP(d).normalize().toArray(),this.shadow=e}getProjectedLight(a){return this}}class mm{constructor(a,b={id:"pass"}){const{id:c}=b;this.id=c,this.device=a,this.props={...b}}setProps(a){Object.assign(this.props,a)}render(a){}cleanup(){}}class mn extends mm{constructor(){super(...arguments),this._lastRenderIndex=-1}render(a){let[b,c]=this.device.canvasContext.getDrawingBufferSize(),d=a.clearCanvas??!0,e=a.clearColor??(!!d&&[0,0,0,0]),f=a.colorMask??15,g={viewport:[0,0,b,c]};a.colorMask&&(g.colorMask=f),a.scissorRect&&(g.scissorRect=a.scissorRect);let h=this.device.beginRenderPass({framebuffer:a.target,parameters:g,clearColor:e,clearDepth:!!d&&1,clearStencil:!!d&&0});try{return this._drawLayers(h,a)}finally{h.end(),this.device.submit()}}_drawLayers(a,b){let{target:c,shaderModuleProps:d,viewports:e,views:f,onViewportActive:g,clearStack:h=!0}=b;b.pass=b.pass||"unknown",h&&(this._lastRenderIndex=-1);let i=[];for(let h of e){let e=f&&f[h.id];g?.(h);let j=this._getDrawLayerParams(h,b);for(let f of h.subViewports||[h]){let g=this._drawLayersInViewport(a,{target:c,shaderModuleProps:d,viewport:f,view:e,pass:b.pass,layers:b.layers},j);i.push(g)}}return i}_getDrawLayerParams(a,{layers:b,pass:c,isPicking:d=!1,layerFilter:e,cullRect:f,effects:g,shaderModuleProps:h},i=!1){let j=[],k=function a(b=0,c={}){let d={},e=(f,g)=>{let h,i=f.props._offset,j=f.id,k=f.parent&&f.parent.id;if(!k||k in c||e(f.parent,!1),k in d){let b=d[k]=d[k]||a(c[k],c);h=b(f,g),d[j]=b}else Number.isFinite(i)?(h=i+(c[k]||0),d[j]=null):h=b;return g&&h>=b&&(b=h+1),c[j]=h,h};return e}(this._lastRenderIndex+1),l={layer:b[0],viewport:a,isPicking:d,renderPass:c,cullRect:f},n={};for(let d=0;d<b.length;d++){let f=b[d],o=this._shouldDrawLayer(f,l,e,n),p={shouldDrawLayer:o};o&&!i&&(p.shouldDrawLayer=!0,p.layerRenderIndex=k(f,o),p.shaderModuleProps=this._getShaderModuleProps(f,g,c,h),p.layerParameters={...f.context.deck?.props.parameters,...this.getLayerParameters(f,d,a)}),j[d]=p}return j}_drawLayersInViewport(a,{layers:b,shaderModuleProps:c,pass:d,target:e,viewport:f,view:g},h){let i=function(a,{shaderModuleProps:b,target:c,viewport:d}){let e=b?.project?.devicePixelRatio??a.canvasContext.cssToDeviceRatio(),[,f]=a.canvasContext.getDrawingBufferSize(),g=c?c.height:f;return[d.x*e,g-(d.y+d.height)*e,d.width*e,d.height*e]}(this.device,{shaderModuleProps:c,target:e,viewport:f});if(g){let{clear:a,clearColor:b,clearDepth:c,clearStencil:d}=g.props;if(a){let a=[0,0,0,0],f=1,g=0;Array.isArray(b)?a=[...b.slice(0,3),b[3]||255].map(a=>a/255):!1===b&&(a=!1),void 0!==c&&(f=c),void 0!==d&&(g=d),this.device.beginRenderPass({framebuffer:e,parameters:{viewport:i,scissorRect:i},clearColor:a,clearDepth:f,clearStencil:g}).end()}}let j={totalCount:b.length,visibleCount:0,compositeCount:0,pickableCount:0};a.setParameters({viewport:i});for(let c=0;c<b.length;c++){let e=b[c],g=h[c],{shouldDrawLayer:i}=g;if(i&&e.props.pickable&&j.pickableCount++,e.isComposite&&j.compositeCount++,e.isDrawable&&g.shouldDrawLayer){let{layerRenderIndex:b,shaderModuleProps:c,layerParameters:h}=g;j.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,b),c.project&&(c.project.viewport=f),e.context.renderPass=a;try{e._drawLayer({renderPass:a,shaderModuleProps:c,uniforms:{layerIndex:b},parameters:h})}catch(a){e.raiseError(a,`drawing ${e} to ${d}`)}}}return j}shouldDrawLayer(a){return!0}getShaderModuleProps(a,b,c){return null}getLayerParameters(a,b,c){return a.props.parameters}_shouldDrawLayer(a,b,c,d){if(!(a.props.visible&&this.shouldDrawLayer(a)))return!1;b.layer=a;let e=a.parent;for(;e;){if(!e.props.visible||!e.filterSubLayer(b))return!1;b.layer=e,e=e.parent}if(c){let a=b.layer.id;if(a in d||(d[a]=c(b)),!d[a])return!1}return a.activateViewport(b.viewport),!0}_getShaderModuleProps(a,b,c,d){let e=this.device.canvasContext.cssToDeviceRatio(),f=a.internalState?.propsInTransition||a.props,g={layer:f,picking:{isActive:!1},project:{viewport:a.context.viewport,devicePixelRatio:e,modelMatrix:f.modelMatrix,coordinateSystem:f.coordinateSystem,coordinateOrigin:f.coordinateOrigin,autoWrapLongitude:a.wrapLongitude}};if(b)for(let c of b)mo(g,c.getShaderModuleProps?.(a,g));return mo(g,this.getShaderModuleProps(a,b,g),d)}}function mo(a,...b){for(let c of b)if(c)for(let b in c)a[b]?Object.assign(a[b],c[b]):a[b]=c[b];return a}class mp extends mn{constructor(a,b){super(a,b);const c=a.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),d=a.createTexture({format:"depth16unorm",width:1,height:1});this.fbo=a.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[c],depthStencilAttachment:d})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(a){let b=this.fbo,c=this.device.canvasContext.cssToDeviceRatio(),d=a.viewports[0],e=d.width*c,f=d.height*c;(e!==b.width||f!==b.height)&&b.resize({width:e,height:f}),super.render({...a,clearColor:[1,1,1,1],target:b,pass:"shadow"})}getLayerParameters(a,b,c){return{...a.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(a){return!1!==a.props.shadowEnabled}getShaderModuleProps(a,b,c){return{shadow:{project:c.project,drawToShadowMap:!0}}}}let mq={color:[255,255,255],intensity:1},mr=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],ms=[0,0,0,200/255];class mt{constructor(a={}){this.id="lighting-effect",this.shadowColor=ms,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(a)}setup(a){this.context=a;let{device:b,deck:c}=a;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(b),c._addDefaultShaderModule(j$),this.dummyShadowMap=b.createTexture({width:1,height:1}))}setProps(a){for(let b in this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[],a){let c=a[b];switch(c.type){case"ambient":this.ambientLight=c;break;case"directional":this.directionalLights.push(c);break;case"point":this.pointLights.push(c)}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(a=>a.shadow),this.context&&this.setup(this.context),this.props=a}preRender({layers:a,layerFilter:b,viewports:c,onViewportActive:d,views:e}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let f=0;f<this.shadowPasses.length;f++)this.shadowPasses[f].render({layers:a,layerFilter:b,viewports:c,onViewportActive:d,views:e,shaderModuleProps:{shadow:{shadowLightId:f,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(a,b){let c=this.shadow?{project:b.project,shadowMaps:this.shadowPasses.map(a=>a.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},d={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(b=>b.getProjectedLight({layer:a})),pointLights:this.pointLights.map(b=>b.getProjectedLight({layer:a}))},e=a.props.material;return{shadow:c,lighting:d,phongMaterial:e,gouraudMaterial:e}}cleanup(a){for(let a of this.shadowPasses)a.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,a.deck._removeDefaultShaderModule(j$))}_calculateMatrices(){let a=[];for(let b of this.directionalLights){let c=new jt().lookAt({eye:new iP(b.direction).negate()});a.push(c)}return a}_createShadowPasses(a){for(let b=0;b<this.directionalLights.length;b++){let c=new mp(a);this.shadowPasses[b]=c}}_applyDefaultLights(){let{ambientLight:a,pointLights:b,directionalLights:c}=this;a||0!==b.length||0!==c.length||(this.ambientLight=new mh(mq),this.directionalLights.push(new ml(mr[0]),new ml(mr[1])))}}let mu=new mt;class mv{constructor(a){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=a,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(a){let b=this._defaultEffects;if(!b.find(b=>b.id===a.id)){let c=b.findIndex(b=>(b.order??1/0)-(a.order??1/0)>0);c<0?b.push(a):b.splice(c,0,a),a.setup(this._context),this._setEffects(this.effects)}}setProps(a){"effects"in a&&!lN(a.effects,this.effects,1)&&this._setEffects(a.effects)}needsRedraw(a={clearRedrawFlags:!1}){let b=this._needsRedraw;return a.clearRedrawFlags&&(this._needsRedraw=!1),b}getEffects(){return this._resolvedEffects}_setEffects(a){let b={};for(let a of this.effects)b[a.id]=a;let c=[];for(let d of a){let a=b[d.id],e=d;a&&a!==d?a.setProps?(a.setProps(d.props),e=a):a.cleanup(this._context):a||d.setup(this._context),c.push(e),delete b[d.id]}for(let a in b)b[a].cleanup(this._context);this.effects=c,this._resolvedEffects=c.concat(this._defaultEffects),a.some(a=>a instanceof mt)||this._resolvedEffects.push(mu),this._needsRedraw="effects changed"}finalize(){for(let a of this._resolvedEffects)a.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class mw extends mn{shouldDrawLayer(a){let{operation:b}=a.props;return b.includes("draw")||b.includes("terrain")}}let mx={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant",blendAlphaDstFactor:"zero"};class my extends mn{constructor(){super(...arguments),this._colorEncoderState=null}render(a){return"pickingFBO"in a?this._drawPickingBuffer(a):super.render(a)}_drawPickingBuffer({layers:a,layerFilter:b,views:c,viewports:d,onViewportActive:e,pickingFBO:f,deviceRect:{x:g,y:h,width:i,height:j},cullRect:k,effects:l,pass:n="picking",pickZ:o,shaderModuleProps:p}){this.pickZ=o;let q=this._resetColorEncoder(o),r=super.render({target:f,layers:a,layerFilter:b,views:c,viewports:d,onViewportActive:e,cullRect:k,effects:l?.filter(a=>a.useInPicking),pass:n,isPicking:!0,shaderModuleProps:p,clearColor:[0,0,0,0],colorMask:15,scissorRect:[g,h,i,j]});return this._colorEncoderState=null,{decodePickingColor:q&&mz.bind(null,q),stats:r}}shouldDrawLayer(a){let{pickable:b,operation:c}=a.props;return b&&c.includes("draw")||c.includes("terrain")||c.includes("mask")}getShaderModuleProps(a,b,c){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(a,b,c){let d={...a.props.parameters},{pickable:e,operation:f}=a.props;return!this._colorEncoderState||f.includes("terrain")?d.blend=!1:e&&f.includes("draw")&&(Object.assign(d,mx),d.blend=!0,d.blendColor=function(a,b,c){let d,{byLayer:e,byAlpha:f}=a,g=e.get(b);return g?(g.viewports.push(c),d=g.a):(d=e.size+1)<=255?(g={a:d,layer:b,viewports:[c]},e.set(b,g),f[d]=g):(gT.warn("Too many pickable layers, only picking the first 255")(),d=0),[0,0,0,d/255]}(this._colorEncoderState,a,c)),d}_resetColorEncoder(a){return this._colorEncoderState=a?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function mz(a,b){let c=a.byAlpha[b[3]];return c&&{pickedLayer:c.layer,pickedViewports:c.viewports,pickedObjectIndex:c.layer.decodePickingColor(b)}}class mA{constructor(a){this.device=a,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new mw(a),this.pickLayersPass=new my(a),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(a){this.layerFilter!==a.layerFilter&&(this.layerFilter=a.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==a.drawPickingColors&&(this.drawPickingColors=a.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(a){if(!a.viewports.length)return;let b=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,c={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...a};c.effects&&this._preRender(c.effects,c);let d=this.lastPostProcessEffect?this.renderBuffers[0]:c.target;this.lastPostProcessEffect&&(c.clearColor=[0,0,0,0],c.clearCanvas=!0);let e=b.render({...c,target:d});c.effects&&(this.lastPostProcessEffect&&(c.clearCanvas=void 0===a.clearCanvas||a.clearCanvas),this._postRender(c.effects,c)),this.renderCount++,kc("deckRenderer.renderLayers",this,e,a)}needsRedraw(a={clearRedrawFlags:!1}){let b=this._needsRedraw;return a.clearRedrawFlags&&(this._needsRedraw=!1),b}finalize(){let{renderBuffers:a}=this;for(let b of a)b.delete();a.length=0}_preRender(a,b){for(let c of(this.lastPostProcessEffect=null,b.preRenderStats=b.preRenderStats||{},a))b.preRenderStats[c.id]=c.preRender(b),c.postRender&&(this.lastPostProcessEffect=c.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){let{renderBuffers:a}=this,b=this.device.canvasContext.getDrawingBufferSize(),[c,d]=b;for(let e of(0===a.length&&[0,1].map(b=>{let e=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"},width:c,height:d});a.push(this.device.createFramebuffer({id:`deck-renderbuffer-${b}`,colorAttachments:[e]}))}),a))e.resize(b)}_postRender(a,b){let{renderBuffers:c}=this,d={...b,inputBuffer:c[0],swapBuffer:c[1]};for(let e of a)if(e.postRender){d.target=e.id===this.lastPostProcessEffect?b.target:void 0;let a=e.postRender(d);d.inputBuffer=a,d.swapBuffer=a===c[0]?c[1]:c[0]}}}let mB={pickedColor:null,pickedObjectIndex:-1};function mC({pickedColors:a,decodePickingColor:b,deviceX:c,deviceY:d,deviceRadius:e,deviceRect:f}){let{x:g,y:h,width:i,height:j}=f,k=e*e,l=-1,n=0;for(let b=0;b<j;b++){let e=b+h-d,f=e*e;if(f>k)n+=4*i;else for(let b=0;b<i;b++){if(a[n+3]-1>=0){let a=b+g-c,d=a*a+f;d<=k&&(k=d,l=n)}n+=4}}if(l>=0){let c=a.slice(l,l+4),d=b(c);if(d){let a=Math.floor(l/4/i),b=l/4-a*i;return{...d,pickedColor:c,pickedX:g+b,pickedY:h+a}}gT.error("Picked non-existent layer. Is picking buffer corrupt?")()}return mB}function mD({pickedColors:a,decodePickingColor:b}){let c=new Map;if(a){for(let d=0;d<a.length;d+=4)if(a[d+3]-1>=0){let e=a.slice(d,d+4),f=e.join(",");if(!c.has(f)){let a=b(e);a?c.set(f,{...a,color:e}):gT.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(c.values())}function mE({pickInfo:a,viewports:b,pixelRatio:c,x:d,y:e,z:f}){let g,h=b[0];if(b.length>1&&(h=function(a,b){for(let c=a.length-1;c>=0;c--){let d=a[c];if(d.containsPixel(b))return d}return a[0]}(a?.pickedViewports||b,{x:d,y:e})),h){let a=[d-h.x,e-h.y];void 0!==f&&(a[2]=f),g=h.unproject(a)}return{color:null,layer:null,viewport:h,index:-1,picked:!1,x:d,y:e,pixel:[d,e],coordinate:g,devicePixel:a&&"pickedX"in a?[a.pickedX,a.pickedY]:void 0,pixelRatio:c}}function mF(a){let{pickInfo:b,lastPickedInfo:c,mode:d,layers:e}=a,{pickedColor:f,pickedLayer:g,pickedObjectIndex:h}=b,i=g?[g]:[];if("hover"===d){let a=c.index,b=c.layerId,d=g?g.props.id:null;if(d!==b||h!==a){if(d!==b){let a=e.find(a=>a.props.id===b);a&&i.unshift(a)}c.layerId=d,c.index=h,c.info=null}}let j=mE(a),k=new Map;return k.set(null,j),i.forEach(a=>{let b={...j};a===g&&(b.color=f,b.index=h,b.picked=!0);let e=(b=mG({layer:a,info:b,mode:d})).layer;a===g&&"hover"===d&&(c.info=b),k.set(e.id,b),"hover"===d&&e.updateAutoHighlight(b)}),k}function mG({layer:a,info:b,mode:c}){for(;a&&b;){let d=b.layer||null;b.sourceLayer=d,b.layer=a,b=a.getPickingInfo({info:b,mode:c,sourceLayer:d}),a=a.parent}return b}class mH{constructor(a){this._pickable=!0,this.device=a,this.pickLayersPass=new my(a),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(a){"layerFilter"in a&&(this.layerFilter=a.layerFilter),"_pickable"in a&&(this._pickable=a._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObjectAsync(a){return this._pickClosestObjectAsync(a)}pickObjectsAsync(a){return this._pickVisibleObjectsAsync(a)}pickObject(a){return this._pickClosestObject(a)}pickObjects(a){return this._pickVisibleObjects(a)}getLastPickedObject({x:a,y:b,layers:c,viewports:d},e=this.lastPickedInfo.info){let f=e&&e.layer&&e.layer.id,g=e&&e.viewport&&e.viewport.id,h=f?c.find(a=>a.id===f):null,i=g&&d.find(a=>a.id===g)||d[0],j=i&&i.unproject([a-i.x,b-i.y]);return{...e,x:a,y:b,viewport:i,coordinate:j,layer:h}}_resizeBuffer(){if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){let a=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=a}let{canvas:a}=this.device.getDefaultCanvasContext();this.pickingFBO?.resize({width:a.width,height:a.height}),this.depthFBO?.resize({width:a.width,height:a.height})}_getPickable(a){if(!1===this._pickable)return null;let b=a.filter(a=>this.pickLayersPass.shouldDrawLayer(a)&&!a.isComposite);return b.length?b:null}async _pickClosestObjectAsync({layers:a,views:b,viewports:c,x:d,y:e,radius:f=0,depth:g=1,mode:h="query",unproject3D:i,onViewportActive:j,effects:k}){let l,n=this.device.canvasContext.cssToDeviceRatio(),o=this._getPickable(a);if(!o||0===c.length)return{result:[],emptyInfo:mE({viewports:c,x:d,y:e,pixelRatio:n})};this._resizeBuffer();let p=this.device.canvasContext.cssToDevicePixels([d,e],!0),q=[p.x+Math.floor(p.width/2),p.y+Math.floor(p.height/2)],r=Math.round(f*n),{width:s,height:t}=this.pickingFBO,u=this._getPickingRect({deviceX:q[0],deviceY:q[1],deviceRadius:r,deviceWidth:s,deviceHeight:t}),v={x:d-f,y:e-f,width:2*f+1,height:2*f+1},w=[],x=new Set;for(let a=0;a<g;a++){let f,p;if((f=u?mC({...this._drawAndSample({layers:o,views:b,viewports:c,onViewportActive:j,deviceRect:u,cullRect:v,effects:k,pass:`picking:${h}`}),deviceX:q[0],deviceY:q[1],deviceRadius:r,deviceRect:u}):{pickedColor:null,pickedObjectIndex:-1}).pickedLayer&&i&&this.depthFBO){let{pickedColors:a}=this._drawAndSample({layers:[f.pickedLayer],views:b,viewports:c,onViewportActive:j,deviceRect:{x:f.pickedX,y:f.pickedY,width:1,height:1},cullRect:v,effects:k,pass:`picking:${h}:z`},!0);a[3]&&(p=a[0])}for(let b of(f.pickedLayer&&a+1<g&&(x.add(f.pickedLayer),f.pickedLayer.disablePickingIndex(f.pickedObjectIndex)),(l=mF({pickInfo:f,lastPickedInfo:this.lastPickedInfo,mode:h,layers:o,viewports:c,x:d,y:e,z:p,pixelRatio:n})).values()))b.layer&&w.push(b);if(!f.pickedColor)break}for(let a of x)a.restorePickingColors();return{result:w,emptyInfo:l.get(null)}}_pickClosestObject({layers:a,views:b,viewports:c,x:d,y:e,radius:f=0,depth:g=1,mode:h="query",unproject3D:i,onViewportActive:j,effects:k}){let l,n=this.device.canvasContext.cssToDeviceRatio(),o=this._getPickable(a);if(!o||0===c.length)return{result:[],emptyInfo:mE({viewports:c,x:d,y:e,pixelRatio:n})};this._resizeBuffer();let p=this.device.canvasContext.cssToDevicePixels([d,e],!0),q=[p.x+Math.floor(p.width/2),p.y+Math.floor(p.height/2)],r=Math.round(f*n),{width:s,height:t}=this.pickingFBO,u=this._getPickingRect({deviceX:q[0],deviceY:q[1],deviceRadius:r,deviceWidth:s,deviceHeight:t}),v={x:d-f,y:e-f,width:2*f+1,height:2*f+1},w=[],x=new Set;for(let a=0;a<g;a++){let f,p;if((f=u?mC({...this._drawAndSample({layers:o,views:b,viewports:c,onViewportActive:j,deviceRect:u,cullRect:v,effects:k,pass:`picking:${h}`}),deviceX:q[0],deviceY:q[1],deviceRadius:r,deviceRect:u}):{pickedColor:null,pickedObjectIndex:-1}).pickedLayer&&i&&this.depthFBO){let{pickedColors:a}=this._drawAndSample({layers:[f.pickedLayer],views:b,viewports:c,onViewportActive:j,deviceRect:{x:f.pickedX,y:f.pickedY,width:1,height:1},cullRect:v,effects:k,pass:`picking:${h}:z`},!0);a[3]&&(p=a[0])}for(let b of(f.pickedLayer&&a+1<g&&(x.add(f.pickedLayer),f.pickedLayer.disablePickingIndex(f.pickedObjectIndex)),(l=mF({pickInfo:f,lastPickedInfo:this.lastPickedInfo,mode:h,layers:o,viewports:c,x:d,y:e,z:p,pixelRatio:n})).values()))b.layer&&w.push(b);if(!f.pickedColor)break}for(let a of x)a.restorePickingColors();return{result:w,emptyInfo:l.get(null)}}async _pickVisibleObjectsAsync({layers:a,views:b,viewports:c,x:d,y:e,width:f=1,height:g=1,mode:h="query",maxObjects:i=null,onViewportActive:j,effects:k}){let l=this._getPickable(a);if(!l||0===c.length)return[];this._resizeBuffer();let n=this.device.canvasContext.cssToDeviceRatio(),o=this.device.canvasContext.cssToDevicePixels([d,e],!0),p=o.x,q=o.y+o.height,r=this.device.canvasContext.cssToDevicePixels([d+f,e+g],!0),s=r.x+r.width,t=r.y,u=this._drawAndSample({layers:l,views:b,viewports:c,onViewportActive:j,deviceRect:{x:p,y:t,width:s-p,height:q-t},cullRect:{x:d,y:e,width:f,height:g},effects:k,pass:`picking:${h}`}),v=mD(u),w=new Map,x=[],y=Number.isFinite(i);for(let a=0;a<v.length&&(!y||!(x.length>=i));a++){let b=v[a],c={color:b.pickedColor,layer:null,index:b.pickedObjectIndex,picked:!0,x:d,y:e,pixelRatio:n},f=(c=mG({layer:b.pickedLayer,info:c,mode:h})).layer.id;w.has(f)||w.set(f,new Set);let g=w.get(f),i=c.object??c.index;g.has(i)||(g.add(i),x.push(c))}return x}_pickVisibleObjects({layers:a,views:b,viewports:c,x:d,y:e,width:f=1,height:g=1,mode:h="query",maxObjects:i=null,onViewportActive:j,effects:k}){let l=this._getPickable(a);if(!l||0===c.length)return[];this._resizeBuffer();let n=this.device.canvasContext.cssToDeviceRatio(),o=this.device.canvasContext.cssToDevicePixels([d,e],!0),p=o.x,q=o.y+o.height,r=this.device.canvasContext.cssToDevicePixels([d+f,e+g],!0),s=r.x+r.width,t=r.y,u=this._drawAndSample({layers:l,views:b,viewports:c,onViewportActive:j,deviceRect:{x:p,y:t,width:s-p,height:q-t},cullRect:{x:d,y:e,width:f,height:g},effects:k,pass:`picking:${h}`}),v=mD(u),w=new Map,x=[],y=Number.isFinite(i);for(let a=0;a<v.length&&(!y||!(x.length>=i));a++){let b=v[a],c={color:b.pickedColor,layer:null,index:b.pickedObjectIndex,picked:!0,x:d,y:e,pixelRatio:n},f=(c=mG({layer:b.pickedLayer,info:c,mode:h})).layer.id;w.has(f)||w.set(f,new Set);let g=w.get(f),i=c.object??c.index;g.has(i)||(g.add(i),x.push(c))}return x}async _drawAndSampleAsync({layers:a,views:b,viewports:c,onViewportActive:d,deviceRect:e,cullRect:f,effects:g,pass:h},i=!1){let j=i?this.depthFBO:this.pickingFBO,k={layers:a,layerFilter:this.layerFilter,views:b,viewports:c,onViewportActive:d,pickingFBO:j,deviceRect:e,cullRect:f,effects:g,pass:h,pickZ:i,preRenderStats:{},isPicking:!0};for(let a of g)a.useInPicking&&(k.preRenderStats[a.id]=a.preRender(k));let{decodePickingColor:l}=this.pickLayersPass.render(k),{x:n,y:o,width:p,height:q}=e,r=new(i?Float32Array:Uint8Array)(p*q*4);return this.device.readPixelsToArrayWebGL(j,{sourceX:n,sourceY:o,sourceWidth:p,sourceHeight:q,target:r}),{pickedColors:r,decodePickingColor:l}}_drawAndSample({layers:a,views:b,viewports:c,onViewportActive:d,deviceRect:e,cullRect:f,effects:g,pass:h},i=!1){let j=i?this.depthFBO:this.pickingFBO,k={layers:a,layerFilter:this.layerFilter,views:b,viewports:c,onViewportActive:d,pickingFBO:j,deviceRect:e,cullRect:f,effects:g,pass:h,pickZ:i,preRenderStats:{},isPicking:!0};for(let a of g)a.useInPicking&&(k.preRenderStats[a.id]=a.preRender(k));let{decodePickingColor:l}=this.pickLayersPass.render(k),{x:n,y:o,width:p,height:q}=e,r=new(i?Float32Array:Uint8Array)(p*q*4);return this.device.readPixelsToArrayWebGL(j,{sourceX:n,sourceY:o,sourceWidth:p,sourceHeight:q,target:r}),{pickedColors:r,decodePickingColor:l}}_getPickingRect({deviceX:a,deviceY:b,deviceRadius:c,deviceWidth:d,deviceHeight:e}){let f=Math.max(0,a-c),g=Math.max(0,b-c),h=Math.min(d,a+c+1)-f,i=Math.min(e,b+c+1)-g;return h<=0||i<=0?null:{x:f,y:g,width:h,height:i}}}let mI={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},mJ="__root";class mK{constructor({deck:a,parentElement:b}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=a,b?.classList.add("deck-widget-container"),this.parentElement=b}getWidgets(){return this.resolvedWidgets}setProps(a){if(a.widgets&&!lN(a.widgets,this.widgets,1)){let b=a.widgets.filter(Boolean);this._setWidgets(b)}}finalize(){for(let a of this.getWidgets())this._removeWidget(a);for(let a in this.defaultWidgets.length=0,this.resolvedWidgets.length=0,this.containers)this.containers[a].remove()}addDefault(a){this.defaultWidgets.find(b=>b.id===a.id)||(this._addWidget(a),this.defaultWidgets.push(a),this._setWidgets(this.widgets))}onRedraw({viewports:a,layers:b}){let c=a.reduce((a,b)=>(a[b.id]=b,a),{});for(let d of this.getWidgets()){let{viewId:e}=d;if(e){let a=c[e];a&&(d.onViewportChange&&d.onViewportChange(a),d.onRedraw?.({viewports:[a],layers:b}))}else{if(d.onViewportChange)for(let b of a)d.onViewportChange(b);d.onRedraw?.({viewports:a,layers:b})}}this.lastViewports=c,this._updateContainers()}onHover(a,b){for(let c of this.getWidgets()){let{viewId:d}=c;d&&d!==a.viewport?.id||c.onHover?.(a,b)}}onEvent(a,b){let c=hC[b.type];if(c)for(let d of this.getWidgets()){let{viewId:e}=d;e&&e!==a.viewport?.id||d[c]?.(a,b)}}_setWidgets(a){let b={};for(let a of this.resolvedWidgets)b[a.id]=a;for(let a of(this.resolvedWidgets.length=0,this.defaultWidgets))b[a.id]=null,this.resolvedWidgets.push(a);for(let c of a){let a=b[c.id];a?a.viewId!==c.viewId||a.placement!==c.placement?(this._removeWidget(a),this._addWidget(c)):c!==a&&(a.setProps(c.props),c=a):this._addWidget(c),b[c.id]=null,this.resolvedWidgets.push(c)}for(let a in b){let c=b[a];c&&this._removeWidget(c)}this.widgets=a}_addWidget(a){let{viewId:b=null,placement:c="top-left"}=a;a.widgetManager=this,a.deck=this.deck,a.rootElement=a._onAdd({deck:this.deck,viewId:b}),a.rootElement&&this._getContainer(b,c).append(a.rootElement),a.updateHTML()}_removeWidget(a){a.onRemove?.(),a.rootElement&&a.rootElement.remove(),a.rootElement=void 0,a.deck=void 0,a.widgetManager=void 0}_getContainer(a,b){let c=a||mJ,d=this.containers[c];d||((d=document.createElement("div")).style.pointerEvents="none",d.style.position="absolute",d.style.overflow="hidden",this.parentElement?.append(d),this.containers[c]=d);let e=d.querySelector(`.${b}`);return e||((e=globalThis.document.createElement("div")).className=b,e.style.position="absolute",e.style.zIndex="2",Object.assign(e.style,mI[b]),d.append(e)),e}_updateContainers(){let a=this.deck.width,b=this.deck.height;for(let c in this.containers){let d=this.lastViewports[c]||null,e=c===mJ||d,f=this.containers[c];e?(f.style.display="block",f.style.left=`${d?d.x:0}px`,f.style.top=`${d?d.y:0}px`,f.style.width=`${d?d.width:a}px`,f.style.height=`${d?d.height:b}px`):f.style.display="none"}}}function mL(a,b){b&&Object.entries(b).map(([b,c])=>{b.startsWith("--")?a.style.setProperty(b,c):a.style[b]=c})}class mM{constructor(a){this.viewId=null,this.props={...this.constructor.defaultProps,...a},this.id=this.props.id}setProps(a){let b=this.props,c=this.rootElement;if(c&&b.className!==a.className&&(b.className&&c.classList.remove(b.className),a.className&&c.classList.add(a.className)),c&&!lN(b.style,a.style,1)){var d;(d=b.style)&&Object.keys(d).map(a=>{a.startsWith("--")?c.style.removeProperty(a):c.style[a]=""}),mL(c,a.style)}Object.assign(this.props,a),this.updateHTML()}updateHTML(){this.rootElement&&this.onRenderHTML(this.rootElement)}onCreateRootElement(){let a=["deck-widget",this.className,this.props.className],b=document.createElement("div");return a.filter(a=>"string"==typeof a&&a.length>0).forEach(a=>b.classList.add(a)),mL(b,this.props.style),b}_onAdd(a){return this.onAdd(a)??this.onCreateRootElement()}onAdd(a){}onRemove(){}onViewportChange(a){}onRedraw(a){}onHover(a,b){}onClick(a,b){}onDrag(a,b){}onDragStart(a,b){}onDragEnd(a,b){}}mM.defaultProps={id:"widget",style:{},className:""};let mN={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class mO extends mM{constructor(a={}){super(a),this.id="default-tooltip",this.placement="fill",this.className="deck-tooltip",this.isVisible=!1,this.setProps(a)}onCreateRootElement(){let a=document.createElement("div");return a.className=this.className,Object.assign(a.style,mN),a}onRenderHTML(a){}onViewportChange(a){this.isVisible&&a.id===this.lastViewport?.id&&a!==this.lastViewport&&this.setTooltip(null)}onHover(a){let{deck:b}=this,c=b&&b.props.getTooltip;if(!c)return;let d=c(a);this.lastViewport=a.viewport,this.setTooltip(d,a.x,a.y)}setTooltip(a,b,c){let d=this.rootElement;if(d){if("string"==typeof a)d.innerText=a;else if(a)a.text&&(d.innerText=a.text),a.html&&(d.innerHTML=a.html),a.className&&(d.className=a.className);else{this.isVisible=!1,d.style.display="none";return}this.isVisible=!0,d.style.display="block",d.style.transform=`translate(${b}px, ${c}px)`,a&&"object"==typeof a&&"style"in a&&Object.assign(d.style,a.style)}}}mO.defaultProps={...mM.defaultProps};let mP=globalThis.loaders?.parseImageNode,mQ="undefined"!=typeof Image,mR="undefined"!=typeof ImageBitmap,mS=!!kI||!!mP,mT=/^data:image\/svg\+xml/,mU=/\.svg((\?|#).*)?$/;function mV(a){return a&&(mT.test(a)||mU.test(a))}function mW(a,b){if(mV(b))throw Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(a)])}async function mX(a,b,c){let d=function(a,b){if(mV(b)){let b=new TextDecoder().decode(a);try{"function"==typeof unescape&&"function"==typeof encodeURIComponent&&(b=unescape(encodeURIComponent(b)))}catch(a){throw Error(a.message)}return`data:image/svg+xml;base64,${btoa(b)}`}return mW(a,b)}(a,c),e=self.URL||self.webkitURL,f="string"!=typeof d&&e.createObjectURL(d);try{return await mY(f||d,b)}finally{f&&e.revokeObjectURL(f)}}async function mY(a,b){let c=new Image;return(c.src=a,b.image&&b.image.decode&&c.decode)?(await c.decode(),c):await new Promise((a,b)=>{try{c.onload=()=>a(c),c.onerror=a=>{let c=a instanceof Error?a.message:"error";b(Error(c))}}catch(a){b(a)}})}let mZ={},m$=!0;async function m_(a,b,c){let d;d=mV(c)?await mX(a,b,c):mW(a,c);let e=b&&b.imagebitmap;return await m0(d,e)}async function m0(a,b=null){if((function(a){for(let b in a||mZ)return!1;return!0}(b)||!m$)&&(b=null),b)try{return await createImageBitmap(a,b)}catch(a){console.warn(a),m$=!1}return await createImageBitmap(a)}function m1(a){var b,c;let d,e,f,g,h=m2(a);return((d=m2(h)).byteLength>=24&&0x89504e47===d.getUint32(0,!1)?{mimeType:"image/png",width:d.getUint32(16,!1),height:d.getUint32(20,!1)}:null)||function(a){let b=m2(a);if(!(b.byteLength>=3&&65496===b.getUint16(0,!1)&&255===b.getUint8(2)))return null;let{tableMarkers:c,sofMarkers:d}=function(){let a=new Set([65499,65476,65484,65501,65534]);for(let b=65504;b<65520;++b)a.add(b);return{tableMarkers:a,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}(),e=2;for(;e+9<b.byteLength;){let a=b.getUint16(e,!1);if(d.has(a))return{mimeType:"image/jpeg",height:b.getUint16(e+5,!1),width:b.getUint16(e+7,!1)};if(!c.has(a))break;e+=2,e+=b.getUint16(e,!1)}return null}(h)||((e=m2(h)).byteLength>=10&&0x47494638===e.getUint32(0,!1)?{mimeType:"image/gif",width:e.getUint16(6,!0),height:e.getUint16(8,!0)}:null)||((f=m2(h)).byteLength>=14&&16973===f.getUint16(0,!1)&&f.getUint32(2,!0)===f.byteLength?{mimeType:"image/bmp",width:f.getUint32(18,!0),height:f.getUint32(22,!0)}:null)||((g=!function(a,b,c=0){let d=[...b].map(a=>a.charCodeAt(0));for(let b=0;b<d.length;++b)if(d[b]!==a[b+c])return!1;return!0}(c=new Uint8Array((b=h)instanceof DataView?b.buffer:b),"ftyp",4)||(96&c[8])==0?null:function(a){switch(String.fromCharCode(...a.slice(8,12)).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}(c))?{mimeType:g.mimeType,width:0,height:0}:null)}function m2(a){if(a instanceof DataView)return a;if(ArrayBuffer.isView(a))return new DataView(a.buffer);if(a instanceof ArrayBuffer)return new DataView(a);throw Error("toDataView")}async function m3(a,b){let{mimeType:c}=m1(a)||{},d=globalThis.loaders?.parseImageNode;return kk(d),await d(a,c)}let m4={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:"4.3.3",mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],parse:async function a(a,b,c){let d,e=((b=b||{}).image||{}).type||"auto",{url:f}=c||{};switch(function(a){switch(a){case"auto":case"data":if(mR)return"imagebitmap";if(mQ)return"image";if(mS)return"data";throw Error("Install '@loaders.gl/polyfills' to parse images under Node.js");default:return!function(a){switch(a){case"auto":return mR;case"imagebitmap":case"image":case"data":return;default:throw Error(`@loaders.gl/images: image ${a} not supported in this environment`)}}(a),a}}(e)){case"imagebitmap":d=await m_(a,b,f);break;case"image":d=await mX(a,b,f);break;case"data":d=await m3(a,b);break;default:kk(!1)}return"data"===e&&(d=function(a){switch(function(a){var b;let c=(b=a,"undefined"!=typeof ImageBitmap&&b instanceof ImageBitmap?"imagebitmap":"undefined"!=typeof Image&&b instanceof Image?"image":b&&"object"==typeof b&&b.data&&b.width&&b.height?"data":null);if(!c)throw Error("Not an image");return c}(a)){case"data":return a;case"image":case"imagebitmap":let b=document.createElement("canvas"),c=b.getContext("2d");if(!c)throw Error("getImageData");return b.width=a.width,b.height=a.height,c.drawImage(a,0,0),c.getImageData(0,0,a.width,a.height);default:throw Error("getImageData")}}(d)),d},tests:[a=>!!m1(new DataView(a))],options:{image:{type:"auto",decode:!0}}},m5={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:function(a){let b=a[0],c=a[a.length-1];return"{"===b&&"}"===c||"["===b&&"]"===c},parseTextSync:JSON.parse},m6=function(){let a="9.2.3",b=globalThis.deck&&globalThis.deck.VERSION;if(b&&b!==a)throw Error(`deck.gl - multiple versions detected: ${b} vs ${a}`);if(!b){gT.log(1,`deck.gl ${a}`)(),globalThis.deck={...globalThis.deck,VERSION:a,version:a,log:gT,_registerLoggers:kb};var c=[m5,[m4,{imagebitmap:{premultiplyAlpha:"none"}}]];let b=ll();for(let a of c=Array.isArray(c)?c:[c]){let c=km(a);b.find(a=>c===a)||b.unshift(c)}}return a}();var m7=a.i(34161),m8=a.i(69604);let m9="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.";class na{static defaultProps={...m7.Device.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0};stats=m8.lumaStats;log=ff.log;VERSION="9.2.4";spector;preregisteredAdapters=new Map;constructor(){if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw ff.log.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),ff.log.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),Error("luma.gl - multiple versions detected: see console log");ff.log.error("This version of luma.gl has already been initialized")()}ff.log.log(1,`${this.VERSION} - set luma.log.level=1 (or higher) to trace rendering`)(),globalThis.luma=this}async createDevice(a={}){let b={...na.defaultProps,...a},c=this.selectAdapter(b.type,b.adapters);if(!c)throw Error(m9);return b.waitForPageLoad&&await c.pageLoaded,await c.create(b)}async attachDevice(a,b){let c=this._getTypeFromHandle(a,b.adapters),d=c&&this.selectAdapter(c,b.adapters);if(!d)throw Error(m9);return await d?.attach?.(a,b)}registerAdapters(a){for(let b of a)this.preregisteredAdapters.set(b.type,b)}getSupportedAdapters(a=[]){return Array.from(this._getAdapterMap(a)).map(([,a])=>a).filter(a=>a.isSupported?.()).map(a=>a.type)}getBestAvailableAdapterType(a=[]){let b=this._getAdapterMap(a);for(let a of["webgpu","webgl","null"])if(b.get(a)?.isSupported?.())return a;return null}selectAdapter(a,b=[]){let c=a;"best-available"===a&&(c=this.getBestAvailableAdapterType(b));let d=this._getAdapterMap(b);return c&&d.get(c)||null}enforceWebGL2(a=!0,b=[]){let c=this._getAdapterMap(b).get("webgl");c||ff.log.warn("enforceWebGL2: webgl adapter not found")(),c?.enforceWebGL2?.(a)}setDefaultDeviceProps(a){Object.assign(na.defaultProps,a)}_getAdapterMap(a=[]){let b=new Map(this.preregisteredAdapters);for(let c of a)b.set(c.type,c);return b}_getTypeFromHandle(a,b=[]){return a instanceof WebGL2RenderingContext?"webgl":"undefined"!=typeof GPUDevice&&a instanceof GPUDevice||a?.queue?"webgpu":null===a?"null":(a instanceof WebGLRenderingContext?ff.log.warn("WebGL1 is not supported",a)():ff.log.warn("Unknown handle type",a)(),null)}}let nb=new na;var nc=a.i(7951);class nd{get pageLoaded(){return nf||(ne&&document.readyState,nf=Promise.resolve()),nf}}let ne=(0,nc.isBrowser)()&&"undefined"!=typeof document,nf=null,ng={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}};var nh=a.i(42931),ni=a.i(26315);let nj=new class extends nd{type="webgl";constructor(){super(),m7.Device.defaultProps={...m7.Device.defaultProps,...nh.DEFAULT_SPECTOR_PROPS}}enforceWebGL2(a){!function(a=!0){let b=HTMLCanvasElement.prototype;if(!a&&b.originalGetContext){b.getContext=b.originalGetContext,b.originalGetContext=void 0;return}b.originalGetContext=b.getContext,b.getContext=function(a,b){if("webgl"===a||"experimental-webgl"===a){let a=this.originalGetContext("webgl2",b);return a instanceof HTMLElement&&function(a){a.getExtension("EXT_color_buffer_float");let b={...ng,WEBGL_disjoint_timer_query:a.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:{drawBuffersWEBGL:b=>a.drawBuffers(b),COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067},OES_vertex_array_object:{VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES:()=>a.createVertexArray(),deleteVertexArrayOES:b=>a.deleteVertexArray(b),isVertexArrayOES:b=>a.isVertexArray(b),bindVertexArrayOES:b=>a.bindVertexArray(b)},ANGLE_instanced_arrays:{VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE:(...b)=>a.drawArraysInstanced(...b),drawElementsInstancedANGLE:(...b)=>a.drawElementsInstanced(...b),vertexAttribDivisorANGLE:(...b)=>a.vertexAttribDivisor(...b)}},c=a.getExtension;a.getExtension=function(d){let e=c.call(a,d);return e||(d in b?b[d]:null)};let d=a.getSupportedExtensions;a.getSupportedExtensions=function(){let c=d.apply(a)||[];return c?.concat(Object.keys(b))}}(a),a}return this.originalGetContext(a,b)}}(a)}isSupported(){return"undefined"!=typeof WebGL2RenderingContext}isDeviceHandle(a){return!!("undefined"!=typeof WebGL2RenderingContext&&a instanceof WebGL2RenderingContext)||("undefined"!=typeof WebGLRenderingContext&&a instanceof WebGLRenderingContext&&ff.log.warn("WebGL1 is not supported",a)(),!1)}async attach(b,c={}){var d;let{WebGLDevice:e}=await a.A(22607);if(b instanceof e)return b;if(b?.device instanceof e)return b.device;if(d=b,!("undefined"!=typeof WebGL2RenderingContext&&d instanceof WebGL2RenderingContext||d&&Number.isFinite(d._version)))throw Error("Invalid WebGL2RenderingContext");let f=!0===c.createCanvasContext?{}:c.createCanvasContext;return new e({...c,_handle:b,createCanvasContext:{canvas:b.canvas,autoResize:!1,...f}})}async create(b={}){let{WebGLDevice:c}=await a.A(22607);ff.log.groupCollapsed(1,"WebGLDevice created")();try{let a=[];for(let c of((b.debugWebGL||b.debug)&&a.push((0,ni.loadWebGLDeveloperTools)()),b.debugSpectorJS&&a.push((0,nh.loadSpectorJS)(b)),await Promise.allSettled(a)))"rejected"===c.status&&ff.log.error(`Failed to initialize debug libraries ${c.reason}`)();let d=new c(b),e=`\
${d._reused?"Reusing":"Created"} device with WebGL2 ${d.props.debug?"debug ":""}context: \
${d.info.vendor}, ${d.info.renderer} for canvas: ${d.canvasContext.id}`;return ff.log.probe(1,e)(),ff.log.table(1,d.info)(),d}finally{ff.log.groupEnd(1)()}}},nk=0;class nl{static defaultAnimationLoopProps={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:a=>console.error(a),stats:nb.stats.get(`animation-loop-${nk++}`),autoResizeViewport:!1};device=null;canvas=null;props;animationProps=null;timeline=null;stats;cpuTime;gpuTime;frameRate;display;needsRedraw="initialized";_initialized=!1;_running=!1;_animationFrameId=null;_nextFramePromise=null;_resolveNextFrame=null;_cpuStartTime=0;_error=null;constructor(a){if(this.props={...nl.defaultAnimationLoopProps,...a},!(a=this.props).device)throw Error("No device provided");this.stats=a.stats||new ke.Stats({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:a.autoResizeViewport}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}reportError(a){this.props.onError(a),this._error=a}setNeedsRedraw(a){return this.needsRedraw=this.needsRedraw||a,this}setProps(a){return"autoResizeViewport"in a&&(this.props.autoResizeViewport=a.autoResizeViewport||!1),this}async start(){if(this._running)return this;this._running=!0;try{let a;if(this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),!this._running)return null;return!1!==a&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this}catch(b){let a=b instanceof Error?b:Error("Unknown error");throw this.props.onError(a),a}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){return this.device?.isLost||this._error||(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers()),this}attachTimeline(a){return this.timeline=a,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(a=>{this._resolveNextFrame=a})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeViewport()}_setDisplay(a){this.display&&(this.display.destroy(),this.display.animationLoop=null),a&&(a.animationLoop=this),this.display=a}_requestAnimationFrame(){this._running&&(this._animationFrameId=setTimeout(this._animationFrame.bind(this),1e3/60))}_cancelAnimationFrame(){null!==this._animationFrameId&&(clearTimeout(this._animationFrameId),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(a){this.display?this.display._renderFrame(a):(this.props.onRender(this._getAnimationProps()),this.device?.submit())}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeViewport()}_initializeAnimationProps(){let a=this.device?.getDefaultCanvasContext();if(!this.device||!a)throw Error("loop");let b=a?.canvas,c=a.props.useDevicePixels;this.animationProps={animationLoop:this,device:this.device,canvasContext:a,canvas:b,useDevicePixels:c,timeline:this.timeline,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;let{width:a,height:b,aspect:c}=this._getSizeAndAspect();(a!==this.animationProps.width||b!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),c!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=a,this.animationProps.height=b,this.animationProps.aspect=c,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){if(this.device=await this.props.device,!this.device)throw Error("No device provided");this.canvas=this.device.getDefaultCanvasContext().canvas||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){let a=document.createElement("div");document.body.appendChild(a),a.style.position="relative";let b=document.createElement("div");b.style.position="absolute",b.style.left="10px",b.style.bottom="10px",b.style.width="300px",b.style.background="white",this.canvas instanceof HTMLCanvasElement&&a.appendChild(this.canvas),a.appendChild(b);let c=this.props.onAddHTML(b);c&&(b.innerHTML=c)}}_getSizeAndAspect(){if(!this.device)return{width:1,height:1,aspect:1};let[a,b]=this.device?.getDefaultCanvasContext().getDevicePixelSize()||[1,1],c=1,d=this.device?.getDefaultCanvasContext().canvas;return d&&d.clientHeight?c=d.clientWidth/d.clientHeight:a>0&&b>0&&(c=a/b),{width:a,height:b,aspect:c}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(a){a instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[a.offsetX,a.offsetY])}_onMouseleave(a){this._getAnimationProps()._mousePosition=null}}function nm(){}let nn={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:nm,onWebGLInitialized:nm,onResize:nm,onViewStateChange:nm,onInteractionStateChange:nm,onBeforeRender:nm,onAfterRender:nm,onLoad:nm,onError:a=>gT.error(a.message,a.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:({isDragging:a})=>a?"grabbing":"grab",getTooltip:null,debug:!1,drawPickingColors:!1};class no{constructor(a){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new ke.Stats({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=a=>{let{_pickRequest:b}=this;if("pointerleave"===a.type)b.x=-1,b.y=-1,b.radius=0;else{if(a.leftButton||a.rightButton)return;let c=a.offsetCenter;if(!c)return;b.x=c.x,b.y=c.y,b.radius=this.props.pickingRadius}this.layerManager&&(this.layerManager.context.mousePosition={x:b.x,y:b.y}),b.event=a},this._onEvent=a=>{let b=hC[a.type],c=a.offsetCenter;if(!b||!c||!this.layerManager)return;let d=this.layerManager.getLayers(),e=this.deckPicker.getLastPickedObject({x:c.x,y:c.y,layers:d,viewports:this.getViewports(c)},this._lastPointerDownInfo),{layer:f}=e,g=f&&(f[b]||f.props[b]),h=this.props[b],i=!1;g&&(i=g.call(f,e,a)),i||(h?.(e,a),this.widgetManager.onEvent(e,a))},this._onPointerDown=a=>{if(this.device?.type==="webgpu")return;let b=a.offsetCenter,c=this._pick("pickObject","pickObject Time",{x:b.x,y:b.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=c.result[0]||c.emptyInfo},this.props={...nn,...a},(a=this.props).viewState&&a.initialViewState&&gT.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,a.device&&(this.device=a.device);let b=this.device;if(!b&&a.gl){a.gl instanceof WebGLRenderingContext&&gT.error("WebGL1 context not supported.")();const c=this.props.deviceProps?.onResize;b=nj.attach(a.gl,{...this.props.deviceProps,onResize:(a,b)=>{let{width:d,height:e}=a.canvas;a.drawingBufferWidth=d,a.drawingBufferHeight=e,this._needsRedraw="Canvas resized",c?.(a,b)}})}b||(b=this._createDevice(a)),this.animationLoop=this._createAnimationLoop(b,a),this.setProps(a),a._typedArrayManagerProps&&lA.setOptions(a._typedArrayManagerProps),this.animationLoop.start()}finalize(){this.animationLoop?.stop(),this.animationLoop?.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager?.finalize(),this.layerManager=null,this.viewManager?.finalize(),this.viewManager=null,this.effectManager?.finalize(),this.effectManager=null,this.deckRenderer?.finalize(),this.deckRenderer=null,this.deckPicker?.finalize(),this.deckPicker=null,this.eventManager?.destroy(),this.eventManager=null,this.widgetManager?.finalize(),this.widgetManager=null,this.props.canvas||this.props.device||this.props.gl||!this.canvas||(this.canvas.parentElement?.removeChild(this.canvas),this.canvas=null)}setProps(a){this.stats.get("setProps Time").timeStart(),"onLayerHover"in a&&gT.removed("onLayerHover","onHover")(),"onLayerClick"in a&&gT.removed("onLayerClick","onClick")(),a.initialViewState&&!lN(this.props.initialViewState,a.initialViewState,3)&&(this.viewState=a.initialViewState),Object.assign(this.props,a),this._setCanvasSize(this.props);let b=Object.create(this.props);Object.assign(b,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),a.device&&a.device.id!==this.device?.id&&(this.animationLoop?.stop(),this.canvas!==a.device.canvasContext?.canvas&&(this.canvas?.remove(),this.eventManager?.destroy(),this.canvas=null),gT.log(`recreating animation loop for new device! id=${a.device.id}`)(),this.animationLoop=this._createAnimationLoop(a.device,a),this.animationLoop.start()),this.animationLoop?.setProps(b),void 0!==a.useDevicePixels&&this.device?.canvasContext&&this.device.canvasContext.setProps({useDevicePixels:a.useDevicePixels}),this.layerManager&&(this.viewManager.setProps(b),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(b),this.effectManager.setProps(b),this.deckRenderer.setProps(b),this.deckPicker.setProps(b),this.widgetManager.setProps(b)),this.stats.get("setProps Time").timeEnd()}needsRedraw(a={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let b=this._needsRedraw;a.clearRedrawFlags&&(this._needsRedraw=!1);let c=this.viewManager.needsRedraw(a),d=this.layerManager.needsRedraw(a),e=this.effectManager.needsRedraw(a),f=this.deckRenderer.needsRedraw(a);return b||c||d||e||f}redraw(a){if(!this.layerManager)return;let b=this.needsRedraw({clearRedrawFlags:!0});(b=a||b)&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(b):this._drawLayers(b))}get isInitialized(){return null!==this.viewManager}getViews(){return lY(this.viewManager),this.viewManager.views}getViewports(a){return lY(this.viewManager),this.viewManager.getViewports(a)}getCanvas(){return this.canvas}pickObject(a){let b=this._pick("pickObject","pickObject Time",a).result;return b.length?b[0]:null}pickMultipleObjects(a){return a.depth=a.depth||10,this._pick("pickObject","pickMultipleObjects Time",a).result}pickObjects(a){return this._pick("pickObjects","pickObjects Time",a)}_addResources(a,b=!1){for(let c in a)this.layerManager.resourceManager.add({resourceId:c,data:a[c],forceUpdate:b})}_removeResources(a){for(let b of a)this.layerManager.resourceManager.remove(b)}_addDefaultEffect(a){this.effectManager.addDefaultEffect(a)}_addDefaultShaderModule(a){this.layerManager.addDefaultShaderModule(a)}_removeDefaultShaderModule(a){this.layerManager?.removeDefaultShaderModule(a)}_pick(a,b,c){lY(this.deckPicker);let{stats:d}=this;d.get("Pick Count").incrementCount(),d.get(b).timeStart();let e=this.deckPicker[a]({layers:this.layerManager.getLayers(c),views:this.viewManager.getViews(),viewports:this.getViewports(c),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...c});return d.get(b).timeEnd(),e}_createCanvas(a){let b=a.canvas;return"string"==typeof b&&lY(b=document.getElementById(b)),b||((b=document.createElement("canvas")).id=a.id||"deckgl-overlay",a.width&&"number"==typeof a.width&&(b.width=a.width),a.height&&"number"==typeof a.height&&(b.height=a.height),(a.parent||document.body).appendChild(b)),Object.assign(b.style,a.style),b}_setCanvasSize(a){if(!this.canvas)return;let{width:b,height:c}=a;if(b||0===b){let a=Number.isFinite(b)?`${b}px`:b;this.canvas.style.width=a}if(c||0===c){let b=Number.isFinite(c)?`${c}px`:c;this.canvas.style.position=a.style?.position||"absolute",this.canvas.style.height=b}}_updateCanvasSize(){let{canvas:a}=this;if(!a)return;let b=a.clientWidth??a.width,c=a.clientHeight??a.height;(b!==this.width||c!==this.height)&&(this.width=b,this.height=c,this.viewManager?.setProps({width:b,height:c}),this.layerManager?.activateViewport(this.getViewports()[0]),this.props.onResize({width:b,height:c}))}_createAnimationLoop(a,b){let{gl:c,onError:d}=b;return new nl({device:a,autoResizeDrawingBuffer:!c,autoResizeViewport:!1,onInitialize:a=>this._setDevice(a.device),onRender:this._onRenderFrame.bind(this),onError:d})}_createDevice(a){let b=this.props.deviceProps?.createCanvasContext,c={adapters:[],...a.deviceProps};c.adapters.includes(nj)||c.adapters.push(nj);let d={alphaMode:this.props.deviceProps?.type==="webgpu"?"premultiplied":void 0},e=this.props.deviceProps?.onResize;return nb.createDevice({_reuseDevices:!0,type:"webgl",...c,createCanvasContext:{...d,..."object"==typeof b?b:void 0,canvas:this._createCanvas(a),useDevicePixels:this.props.useDevicePixels,autoResize:!0},onResize:(a,b)=>{this._needsRedraw="Canvas resized",e?.(a,b)}})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let{views:a}=this.props,b=Array.isArray(a)?a:a?[a]:[new me({id:"default-view"})];return b.length&&this.props.controller&&(b[0].props.controller=this.props.controller),b}_onContextLost(){let{onError:a}=this.props;this.animationLoop&&a&&a(Error("WebGL context is lost"))}_pickAndCallback(){if(this.device?.type==="webgpu")return;let{_pickRequest:a}=this;if(a.event){let{result:b,emptyInfo:c}=this._pick("pickObject","pickObject Time",a);this.cursorState.isHovering=b.length>0;let d=c,e=!1;for(let c of b)d=c,e=c.layer?.onHover(c,a.event)||e;e||(this.props.onHover?.(d,a.event),this.widgetManager.onHover(d,a.event)),a.event=null}}_updateCursor(){let a=this.props.parent||this.canvas;a&&(a.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(a){if(this.device=a,!this.animationLoop)return;this.canvas||(this.canvas=this.device.canvasContext?.canvas,!this.canvas.isConnected&&this.props.parent&&this.props.parent.insertBefore(this.canvas,this.props.parent.firstChild)),"webgl"===this.device.type&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),"webgl"===this.device.type&&this.props.onWebGLInitialized(this.device.gl);let b=new eP;for(let a in b.play(),this.animationLoop.attachTimeline(b),this.eventManager=new hy(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(hD).map(a=>{let[b,c,d,e]=hD[a],f=this.props.eventRecognizerOptions?.[a];return{recognizer:new b({...c,...f,event:a}),recognizeWith:d,requestFailure:e}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}}),hC)this.eventManager.on(a,this._onEvent);this.viewManager=new lO({timeline:b,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});let c=this.viewManager.getViewports()[0];this.layerManager=new lM(this.device,{deck:this,stats:this.stats,viewport:c,timeline:b}),this.effectManager=new mv({deck:this,device:this.device}),this.deckRenderer=new mA(this.device),this.deckPicker=new mH(this.device),this.widgetManager=new mK({deck:this,parentElement:this.canvas?.parentElement}),this.widgetManager.addDefault(new mO),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(a,b){let{device:c,gl:d}=this.layerManager.context;this.props.onBeforeRender({device:c,gl:d});let e={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...b};this.deckRenderer?.renderLayers(e),"screen"===e.pass&&this.widgetManager.onRedraw({viewports:e.viewports,layers:e.layers}),this.props.onAfterRender({device:c,gl:d})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60==0&&(this._getMetrics(),this.stats.reset(),gT.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this.device?.type!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(a){let b=this.props.onViewStateChange(a)||a.viewState;this.viewState&&(this.viewState={...this.viewState,[a.viewId]:b},!this.props.viewState&&this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(a){this.cursorState.isDragging=a.isDragging||!1,this.props.onInteractionStateChange(a)}_getFrameStats(){let{stats:a}=this;a.get("frameRate").timeEnd(),a.get("frameRate").timeStart();let b=this.animationLoop.stats;a.get("GPU Time").addTime(b.get("GPU Time").lastTiming),a.get("CPU Time").addTime(b.get("CPU Time").lastTiming)}_getMetrics(){let{metrics:a,stats:b}=this;a.fps=b.get("frameRate").getHz(),a.setPropsTime=b.get("setProps Time").time,a.updateAttributesTime=b.get("Update Attributes").time,a.framesRedrawn=b.get("Redraw Count").count,a.pickTime=b.get("pickObject Time").time+b.get("pickMultipleObjects Time").time+b.get("pickObjects Time").time,a.pickCount=b.get("Pick Count").count,a.gpuTime=b.get("GPU Time").time,a.cpuTime=b.get("CPU Time").time,a.gpuTimePerFrame=b.get("GPU Time").getAverageTime(),a.cpuTimePerFrame=b.get("CPU Time").getAverageTime();let c=nb.stats.get("Memory Usage");a.bufferMemory=c.get("Buffer Memory").count,a.textureMemory=c.get("Texture Memory").count,a.renderbufferMemory=c.get("Renderbuffer Memory").count,a.gpuMemory=c.get("GPU Memory").count}}no.defaultProps=nn,no.VERSION=m6;let np=u.useEffect;function nq(a,b){for(;a;){if(a===b)return!0;a=Object.getPrototypeOf(a)}return!1}var nr=a.i(3327),ns=a.i(2280),nt=a.i(10052);let nu=nt.getDataType;function nv(a,b,c){let d="webgpu"===c&&"uint8"===b.type?"unorm8":b.type;return{attribute:a,format:b.size>1?`${d}x${b.size}`:b.type,byteOffset:b.offset||0}}function nw(a){return a.stride||a.size*a.bytesPerElement}function nx(a,b){b.offset&&gT.removed("shaderAttribute.offset","vertexOffset, elementOffset")();let c=nw(a),d=(void 0!==b.vertexOffset?b.vertexOffset:a.vertexOffset||0)*c+(b.elementOffset||0)*a.bytesPerElement+(a.offset||0);return{...b,offset:d,stride:c}}class ny{constructor(a,b,c){let d;this._buffer=null,this.device=a,this.id=b.id||"",this.size=b.size||1;const e=b.logicalType||b.type,f="float64"===e;let{defaultValue:g}=b;g=Number.isFinite(g)?[g]:g||Array(this.size).fill(0),d=f?"float32":!e&&b.isIndexed?"uint32":e||"float32";let h=function(a){switch(a){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return(0,nt.getTypedArrayConstructor)(a)}}(e||d);this.doublePrecision=f,f&&!1===b.fp64&&(h=Float32Array),this.value=null,this.settings={...b,defaultType:h,defaultValue:g,logicalType:e,type:d,normalized:d.includes("norm"),size:this.size,bytesPerElement:h.BYTES_PER_ELEMENT},this.state={...c,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){let a=this.getAccessor();return a.vertexOffset?a.vertexOffset*nw(a):0}get numInstances(){return this.state.numInstances}set numInstances(a){this.state.numInstances=a}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),lA.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(a=this.id,b=null){let c={};if(this.state.constant){let d=this.value;if(b){let e=nx(this.getAccessor(),b),f=e.offset/d.BYTES_PER_ELEMENT,g=e.size||this.size;c[a]=d.subarray(f,f+g)}else c[a]=d}else c[a]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?c[`${a}64Low`]=c[a]:c[`${a}64Low`]=new Float32Array(this.size)),c}_getBufferLayout(a=this.id,b=null){let c=this.getAccessor(),d=[],e={name:this.id,byteStride:nw(c),attributes:d};if(this.doublePrecision){let e,f={high:e=nx(c,b||{}),low:{...e,offset:e.offset+4*c.size}};d.push(nv(a,{...c,...f.high},this.device.type),nv(`${a}64Low`,{...c,...f.low},this.device.type))}else if(b){let e=nx(c,b);d.push(nv(a,{...c,...e},this.device.type))}else d.push(nv(a,c,this.device.type));return e}setAccessor(a){this.state.bufferAccessor=a}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let a=null;if(this.state.constant&&this.value){let b=Array.from(this.value);a=[b,b]}else{let{value:b,numInstances:c,size:d}=this,e=c*d;if(b&&e&&b.length>=e){let c=Array(d).fill(1/0),f=Array(d).fill(-1/0);for(let a=0;a<e;)for(let e=0;e<d;e++){let d=b[a++];d<c[e]&&(c[e]=d),d>f[e]&&(f[e]=d)}a=[c,f]}}return this.state.bounds=a,a}setData(a){let b,{state:c}=this;b=ArrayBuffer.isView(a)?{value:a}:a instanceof nr.Buffer?{buffer:a}:a;let d={...this.settings,...b};if(ArrayBuffer.isView(b.value)){if(!b.type)if(this.doublePrecision&&b.value instanceof Float64Array)d.type="float32";else{let a=nu(b.value);d.type=d.normalized?a.replace("int","norm"):a}d.bytesPerElement=b.value.BYTES_PER_ELEMENT,d.stride=nw(d)}if(c.bounds=null,b.constant){let a=b.value;if(a=this._normalizeValue(a,[],0),this.settings.normalized&&(a=this.normalizeConstant(a)),!(!c.constant||!this._areValuesEqual(a,this.value)))return!1;c.externalBuffer=null,c.constant=!0,this.value=ArrayBuffer.isView(a)?a:new Float32Array(a)}else if(b.buffer)c.externalBuffer=b.buffer,c.constant=!1,this.value=b.value||null;else if(b.value){this._checkExternalBuffer(b);let a=b.value;c.externalBuffer=null,c.constant=!1,this.value=a;let{buffer:e}=this,f=nw(d),g=(d.vertexOffset||0)*f;if(this.doublePrecision&&a instanceof Float64Array&&(a=lE(a,d)),this.settings.isIndexed){let b=this.settings.defaultType;a.constructor!==b&&(a=new b(a))}let h=a.byteLength+g+2*f;(!e||e.byteLength<h)&&(e=this._createBuffer(h)),e.write(a,g)}return this.setAccessor(d),!0}updateSubBuffer(a={}){this.state.bounds=null;let b=this.value,{startOffset:c=0,endOffset:d}=a;this.buffer.write(this.doublePrecision&&b instanceof Float64Array?lE(b,{size:this.size,startIndex:c,endIndex:d}):b.subarray(c,d),c*b.BYTES_PER_ELEMENT+this.byteOffset)}allocate(a,b=!1){let{state:c}=this,d=c.allocatedValue,e=lA.allocate(d,a+1,{size:this.size,type:this.settings.defaultType,copy:b});this.value=e;let{byteOffset:f}=this,{buffer:g}=this;return(!g||g.byteLength<e.byteLength+f)&&(g=this._createBuffer(e.byteLength+f),b&&d&&g.write(d instanceof Float64Array?lE(d,this):d,f)),c.allocatedValue=e,c.constant=!1,c.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(a){let{value:b}=a;if(!ArrayBuffer.isView(b))throw Error(`Attribute ${this.id} value is not TypedArray`);let c=this.settings.defaultType,d=!1;if(this.doublePrecision&&(d=b.BYTES_PER_ELEMENT<4),d)throw Error(`Attribute ${this.id} does not support ${b.constructor.name}`);b instanceof c||!this.settings.normalized||"normalized"in a||gT.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(a){switch(this.settings.type){case"snorm8":return new Float32Array(a).map(a=>(a+128)/255*2-1);case"snorm16":return new Float32Array(a).map(a=>(a+32768)/65535*2-1);case"unorm8":return new Float32Array(a).map(a=>a/255);case"unorm16":return new Float32Array(a).map(a=>a/65535);default:return a}}_normalizeValue(a,b,c){let{defaultValue:d,size:e}=this.settings;if(Number.isFinite(a))return b[c]=a,b;if(!a){let a=e;for(;--a>=0;)b[c+a]=d[a];return b}switch(e){case 4:b[c+3]=Number.isFinite(a[3])?a[3]:d[3];case 3:b[c+2]=Number.isFinite(a[2])?a[2]:d[2];case 2:b[c+1]=Number.isFinite(a[1])?a[1]:d[1];case 1:b[c+0]=Number.isFinite(a[0])?a[0]:d[0];break;default:let f=e;for(;--f>=0;)b[c+f]=Number.isFinite(a[f])?a[f]:d[f]}return b}_areValuesEqual(a,b){if(!a||!b)return!1;let{size:c}=this;for(let d=0;d<c;d++)if(a[d]!==b[d])return!1;return!0}_createBuffer(a){this._buffer&&this._buffer.destroy();let{isIndexed:b,type:c}=this.settings;return this._buffer=this.device.createBuffer({...this._buffer?.props,id:this.id,usage:(b?nr.Buffer.INDEX:nr.Buffer.VERTEX)|nr.Buffer.COPY_DST,indexType:b?c:void 0,byteLength:a}),this._buffer}}let nz=[],nA=[];function nB(a){return a&&a[Symbol.asyncIterator]}let nC=[],nD=[[0,1/0]],nE={interpolation:{duration:0,easing:a=>a},spring:{stiffness:.05,damping:.5}};function nF(a,b){if(!a)return null;Number.isFinite(a)&&(a={type:"interpolation",duration:a});let c=a.type||"interpolation";return{...nE[c],...b,...a,type:c}}class nG extends ny{constructor(a,b){super(a,b,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:nD}),this.constant=!1,this.settings.update=b.update||(b.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(a){this.state.startIndices=a}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:a=!1}={}){let b=this.state.needsRedraw;return this.state.needsRedraw=b&&!a,b}layoutChanged(){return this.state.layoutChanged}setAccessor(a){var b,c;(b=this.state).layoutChanged||(c=this.getAccessor(),b.layoutChanged=a.type!==c.type||a.size!==c.size||nw(a)!==nw(c)||(a.offset||0)!==(c.offset||0)),super.setAccessor(a)}getUpdateTriggers(){let{accessor:a}=this.settings;return[this.id].concat("function"!=typeof a&&a||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(a){if(!a||!this.supportsTransition())return null;let{accessor:b}=this.settings,c=this.settings.transition;return nF(Array.isArray(b)?a[b.find(b=>a[b])]:a[b],c)}setNeedsUpdate(a=this.id,b){if(this.state.needsUpdate=this.state.needsUpdate||a,this.setNeedsRedraw(a),b){let{startRow:a=0,endRow:c=1/0}=b;this.state.updateRanges=function(a,b){if(a===nD||(b[0]<0&&(b[0]=0),b[0]>=b[1]))return a;let c=[],d=a.length,e=0;for(let f=0;f<d;f++){let d=a[f];d[1]<b[0]?(c.push(d),e=f+1):d[0]>b[1]?c.push(d):b=[Math.min(d[0],b[0]),Math.max(d[1],b[1])]}return c.splice(e,0,b),c}(this.state.updateRanges,[a,c])}else this.state.updateRanges=nD}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=nC}setNeedsRedraw(a=this.id){this.state.needsRedraw=this.state.needsRedraw||a}allocate(a){let{state:b,settings:c}=this;return!c.noAlloc&&!!c.update&&(super.allocate(a,b.updateRanges!==nD),!0)}updateBuffer({numInstances:a,data:b,props:c,context:d}){if(!this.needsUpdate())return!1;let{state:{updateRanges:e},settings:{update:f,noAlloc:g}}=this,h=!0;if(f){for(let[g,h]of e)f.call(d,this,{data:b,startRow:g,endRow:h,props:c,numInstances:a});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(let[b,c]of e){let d=Number.isFinite(b)?this.getVertexOffset(b):0,e=Number.isFinite(c)?this.getVertexOffset(c):g||!Number.isFinite(a)?this.value.length:a*this.size;super.updateSubBuffer({startOffset:d,endOffset:e})}this._checkAttributeArray()}else h=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),h}setConstantValue(a,b){let c="webgpu"===this.device.type;if(c||void 0===b||"function"==typeof b){if(c&&"function"!=typeof b){let a=this._normalizeValue(b,[],0);this._areValuesEqual(a,this.value)||this.setNeedsUpdate("WebGPU constant updated")}return!1}let d=this.settings.transform&&a?this.settings.transform.call(a,b):b;return this.setData({constant:!0,value:d})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0}setExternalBuffer(a){let{state:b}=this;return a?(this.clearNeedsUpdate(),b.lastExternalBuffer===a||(b.lastExternalBuffer=a,this.setNeedsRedraw(),this.setData(a),!0)):(b.lastExternalBuffer=null,!1)}setBinaryValue(a,b=null){let{state:c,settings:d}=this;if(!a)return c.binaryValue=null,c.binaryAccessor=null,!1;if(d.noAlloc)return!1;if(c.binaryValue===a)return this.clearNeedsUpdate(),!0;if(c.binaryValue=a,this.setNeedsRedraw(),d.transform||b!==this.startIndices){ArrayBuffer.isView(a)&&(a={value:a});let e=a;lY(ArrayBuffer.isView(e.value),`invalid ${d.accessor}`);let f=!!e.size&&e.size!==this.size;return c.binaryAccessor=function(a,b){let{size:c,stride:d,offset:e,startIndices:f,nested:g}=b,h=a.BYTES_PER_ELEMENT,i=d?d/h:c,j=e?e/h:0,k=Math.floor((a.length-j)/i);return(b,{index:d,target:e})=>{let h;if(!f){let b=d*i+j;for(let d=0;d<c;d++)e[d]=a[b+d];return e}let l=f[d],n=f[d+1]||k;if(g){h=Array(n-l);for(let b=l;b<n;b++){let d=b*i+j;e=Array(c);for(let b=0;b<c;b++)e[b]=a[d+b];h[b-l]=e}}else if(i===c)h=a.subarray(l*c+j,n*c+j);else{h=new a.constructor((n-l)*c);let b=0;for(let d=l;d<n;d++){let e=d*i+j;for(let d=0;d<c;d++)h[b++]=a[e+d]}}return h}}(e.value,{size:e.size||this.size,stride:e.stride,offset:e.offset,startIndices:b,nested:f}),!1}return this.clearNeedsUpdate(),this.setData(a),!0}getVertexOffset(a){let{startIndices:b}=this;return(b?a<b.length?b[a]:this.numInstances:a)*this.size}getValue(){let a=this.settings.shaderAttributes,b=super.getValue();if(!a)return b;for(let c in a)Object.assign(b,super.getValue(c,a[c]));return b}getBufferLayout(a){this.state.layoutChanged=!1;let b=this.settings.shaderAttributes,c=super._getBufferLayout(),{stepMode:d}=this.settings;if("dynamic"===d?c.stepMode=a?a.isInstanced?"instance":"vertex":"instance":c.stepMode=d??"vertex",!b)return c;for(let a in b){let d=super._getBufferLayout(a,b[a]);c.attributes.push(...d.attributes)}return c}_autoUpdater(a,{data:b,startRow:c,endRow:d,props:e,numInstances:f}){if(a.constant&&"webgpu"!==this.context.device.type)return;let{settings:g,state:h,value:i,size:j,startIndices:k}=a,{accessor:l,transform:n}=g,o=h.binaryAccessor||("function"==typeof l?l:e[l]);"function"!=typeof o&&"string"==typeof l&&(o=()=>e[l]),lY("function"==typeof o,`accessor "${l}" is not a function`);let p=a.getVertexOffset(c),{iterable:q,objectInfo:r}=function(a,b=0,c=1/0){let d=nz,e={index:-1,data:a,target:[]};return a?"function"==typeof a[Symbol.iterator]?d=a:a.length>0&&(nA.length=a.length,d=nA):d=nz,(b>0||Number.isFinite(c))&&(d=(Array.isArray(d)?d:Array.from(d)).slice(b,c),e.index=b-1),{iterable:d,objectInfo:e}}(b,c,d);for(let b of q){r.index++;let c=o(b,r);if(n&&(c=n.call(this,c)),k){let b=(r.index<k.length-1?k[r.index+1]:f)-k[r.index];if(c&&Array.isArray(c[0])){let b=p;for(let d of c)a._normalizeValue(d,i,b),b+=j}else c&&c.length>j?i.set(c,p):(a._normalizeValue(c,r.target,0),function({target:a,source:b,start:c=0,count:d=1}){let e=b.length,f=d*e,g=0;for(let d=c;g<e;g++)a[d++]=b[g];for(;g<f;)g<f-g?(a.copyWithin(c+g,c,c+g),g*=2):(a.copyWithin(c+g,c,c+f-g),g=f)}({target:i,source:r.target,start:p,count:b}));p+=b*j}else a._normalizeValue(c,i,p),p+=j}}_validateAttributeUpdaters(){let{settings:a}=this;if(!(a.noAlloc||"function"==typeof a.update))throw Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){let{value:a}=this,b=Math.min(4,this.size);if(a&&a.length>=b){let c=!0;switch(b){case 4:c=c&&Number.isFinite(a[3]);case 3:c=c&&Number.isFinite(a[2]);case 2:c=c&&Number.isFinite(a[1]);case 1:c=c&&Number.isFinite(a[0]);break;default:c=!1}if(!c)throw Error(`Illegal attribute generated for ${this.id}`)}}}let nH=`\
out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,nI=`#version 300 es
${nH}`;var nJ=a.i(10391),nK=a.i(45657),nL=a.i(82475),nM=a.i(55204);function nN(a){return Array.isArray(a)?0===a.length||"number"==typeof a[0]:ArrayBuffer.isView(a)&&!(a instanceof DataView)}class nO{name;uniforms={};modifiedUniforms={};modified=!0;bindingLayout={};needsRedraw="initialized";constructor(a){if(this.name=a?.name||"unnamed",a?.name&&a?.shaderLayout){const b=a?.shaderLayout.bindings?.find(b=>"uniform"===b.type&&b.name===a?.name);if(!b)throw Error(a?.name);for(const a of b.uniforms||[])this.bindingLayout[a.name]=a}}setUniforms(a){for(let[b,c]of Object.entries(a))this._setUniform(b,c),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${b}=${c}`)}setNeedsRedraw(a){this.needsRedraw=this.needsRedraw||a}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(a,b){!function(a,b,c=16){if(a!==b||!nN(a))return!1;if(nN(b)&&a.length===b.length){for(let c=0;c<a.length;++c)if(b[c]!==a[c])return!1}return!0}(this.uniforms[a],b)&&(this.uniforms[a]=nN(b)?b.slice():b,this.modifiedUniforms[a]=!0,this.modified=!0)}}var nP=a.i(42668),nQ=a.i(83045);class nR{layout={};byteLength;constructor(a,b={}){let c=0;for(const[d,e]of Object.entries(a)){const{type:a,components:f}=(0,nP.getVariableShaderTypeInfo)(e),g=f*(b?.[d]??1),h=c=(0,nt.alignTo)(c,g);c+=g,this.layout[d]={type:a,size:g,offset:h}}const d=4*(c+=(4-c%4)%4);this.byteLength=Math.max(d,1024)}getData(a){let b=(0,nQ.getScratchArrayBuffer)(this.byteLength),c={i32:new Int32Array(b),u32:new Uint32Array(b),f32:new Float32Array(b),f16:new Uint16Array(b)};for(let[b,d]of Object.entries(a)){let a=this.layout[b];if(!a){ff.log.warn(`Supplied uniform value ${b} not present in uniform block layout`)();continue}let{type:e,size:f,offset:g}=a,h=c[e];if(1===f){if("number"!=typeof d&&"boolean"!=typeof d){ff.log.warn(`Supplied value for single component uniform ${b} is not a number: ${d}`)();continue}h[g]=Number(d)}else{if(!nN(d)){ff.log.warn(`Supplied value for multi component / array uniform ${b} is not a numeric array: ${d}`)();continue}h.set(d,g)}}return new Uint8Array(b,0,this.byteLength)}has(a){return!!this.layout[a]}get(a){return this.layout[a]}}class nS{uniformBlocks=new Map;uniformBufferLayouts=new Map;uniformBuffers=new Map;constructor(a){for(const[b,c]of Object.entries(a)){const a=new nR(c.uniformTypes??{},c.uniformSizes??{});this.uniformBufferLayouts.set(b,a);const d=new nO({name:b});d.setUniforms(c.defaultUniforms||{}),this.uniformBlocks.set(b,d)}}destroy(){for(let a of this.uniformBuffers.values())a.destroy()}setUniforms(a){for(let[b,c]of Object.entries(a))this.uniformBlocks.get(b)?.setUniforms(c);this.updateUniformBuffers()}getUniformBufferByteLength(a){return this.uniformBufferLayouts.get(a)?.byteLength||0}getUniformBufferData(a){let b=this.uniformBlocks.get(a)?.getAllUniforms()||{};return this.uniformBufferLayouts.get(a)?.getData(b)}createUniformBuffer(a,b,c){c&&this.setUniforms(c);let d=this.getUniformBufferByteLength(b),e=a.createBuffer({usage:nr.Buffer.UNIFORM|nr.Buffer.COPY_DST,byteLength:d}),f=this.getUniformBufferData(b);return e.write(f),e}getManagedUniformBuffer(a,b){if(!this.uniformBuffers.get(b)){let c=this.getUniformBufferByteLength(b),d=a.createBuffer({usage:nr.Buffer.UNIFORM|nr.Buffer.COPY_DST,byteLength:c});this.uniformBuffers.set(b,d)}return this.uniformBuffers.get(b)}updateUniformBuffers(){let a=!1;for(let b of this.uniformBlocks.keys()){let c=this.updateUniformBuffer(b);a||=c}return a&&ff.log.log(3,`UniformStore.updateUniformBuffers(): ${a}`)(),a}updateUniformBuffer(a){let b=this.uniformBlocks.get(a),c=this.uniformBuffers.get(a),d=!1;if(c&&b?.needsRedraw){d||=b.needsRedraw;let e=this.getUniformBufferData(a);c=this.uniformBuffers.get(a),c?.write(e);let f=this.uniformBlocks.get(a)?.getAllUniforms();ff.log.log(4,`Writing to uniform buffer ${String(a)}`,e,f)()}return d}}var nT=a.i(13193);class nU{constructor(a,b){this.name=a,this.attributes=b,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}get isPointer(){return!1}getTypeName(){return this.name}}class nV{constructor(a,b,c){this.name=a,this.type=b,this.attributes=c,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class nW extends nU{constructor(a,b){super(a,b),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class nX extends nU{constructor(a,b){super(a,b),this.count=0,this.stride=0}get isArray(){return!0}getTypeName(){return`array<${this.format.getTypeName()}, ${this.count}>`}}class nY extends nU{constructor(a,b,c){super(a,c),this.format=b}get isPointer(){return!0}getTypeName(){return`&${this.format.getTypeName()}`}}class nZ extends nU{constructor(a,b,c,d){super(a,c),this.format=b,this.access=d}get isTemplate(){return!0}getTypeName(){let a=this.name;if(null!==this.format){if("vec2"===a||"vec3"===a||"vec4"===a||"mat2x2"===a||"mat2x3"===a||"mat2x4"===a||"mat3x2"===a||"mat3x3"===a||"mat3x4"===a||"mat4x2"===a||"mat4x3"===a||"mat4x4"===a){if("f32"===this.format.name)return a+"f";if("i32"===this.format.name)return a+"i";if("u32"===this.format.name)return a+"u";if("bool"===this.format.name)return a+"b";if("f16"===this.format.name)return a+"h"}a+=`<${this.format.name}>`}return a}}(xN=x$||(x$={}))[xN.Uniform=0]="Uniform",xN[xN.Storage=1]="Storage",xN[xN.Texture=2]="Texture",xN[xN.Sampler=3]="Sampler",xN[xN.StorageTexture=4]="StorageTexture";class n${constructor(a,b,c,d,e,f,g){this.name=a,this.type=b,this.group=c,this.binding=d,this.attributes=e,this.resourceType=f,this.access=g}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class n_{constructor(a,b){this.name=a,this.type=b}}class n0{constructor(a,b,c,d){this.name=a,this.type=b,this.locationType=c,this.location=d,this.interpolation=null}}class n1{constructor(a,b,c,d){this.name=a,this.type=b,this.locationType=c,this.location=d}}class n2{constructor(a,b,c,d){this.name=a,this.type=b,this.attributes=c,this.id=d}}class n3{constructor(a,b,c){this.name=a,this.type=b,this.attributes=c}}class n4{constructor(a,b=null,c){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=a,this.stage=b,this.attributes=c}}class n5{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}let n6=new Float32Array(1),n7=new Int32Array(n6.buffer),n8=new Uint16Array(1),n9=new Uint32Array(1),oa=new Float32Array(n9.buffer,0,1);function ob(a){return n9[0]=112+(a>>6&31)<<23|(63&a)<<17,oa[0]}function oc(a,b,c,d){let e=[0,0,0,0];for(let f=0;f<d;++f)switch(c){case"8unorm":e[f]=a[b]/255,b++;break;case"8snorm":e[f]=a[b]/255*2-1,b++;break;case"8uint":e[f]=a[b],b++;break;case"8sint":e[f]=a[b]-127,b++;break;case"16uint":e[f]=a[b]|a[b+1]<<8,b+=2;break;case"16sint":e[f]=(a[b]|a[b+1]<<8)-32768,b+=2;break;case"16float":e[f]=function(a){var b=(32768&a)>>15,c=(31744&a)>>10,d=1023&a;return 0==c?(b?-1:1)*6103515625e-14*(d/1024):31==c?d?NaN:1/0*(b?-1:1):(b?-1:1)*Math.pow(2,c-15)*(1+d/1024)}(a[b]|a[b+1]<<8),b+=2;break;case"32uint":case"32sint":e[f]=a[b]|a[b+1]<<8|a[b+2]<<16|a[b+3]<<24,b+=4;break;case"32float":e[f]=new Float32Array(a.buffer,b,1)[0],b+=4}return e}function od(a,b,c,d,e){for(let f=0;f<d;++f)switch(c){case"8unorm":a[b]=255*e[f],b++;break;case"8snorm":a[b]=.5*(e[f]+1)*255,b++;break;case"8uint":a[b]=e[f],b++;break;case"8sint":a[b]=e[f]+127,b++;break;case"16uint":new Uint16Array(a.buffer,b,1)[0]=e[f],b+=2;break;case"16sint":new Int16Array(a.buffer,b,1)[0]=e[f],b+=2;break;case"16float":{let c=function(a){n6[0]=a;let b=n7[0],c=b>>31&1,d=b>>23&255,e=8388607&b;if(255===d)return n8[0]=c<<15|31744|512*(0!==e),n8[0];if(0===d){if(0===e)return n8[0]=c<<15,n8[0];e|=8388608;let a=113;for(;!(8388608&e);)e<<=1,a--;return e&=8388607,(d=127-a)>0?(e=(e>>126-d)+(e>>127-d&1),n8[0]=c<<15|d<<10|e>>13):n8[0]=c<<15,n8[0]}return(d=d-127+15)>=31?n8[0]=c<<15|31744:d<=0?d<-10?n8[0]=c<<15:(e=(8388608|e)>>1-d,n8[0]=c<<15|e>>13):(e>>=13,n8[0]=c<<15|d<<10|e),n8[0]}(e[f]);new Uint16Array(a.buffer,b,1)[0]=c,b+=2;break}case"32uint":new Uint32Array(a.buffer,b,1)[0]=e[f],b+=4;break;case"32sint":new Int32Array(a.buffer,b,1)[0]=e[f],b+=4;break;case"32float":new Float32Array(a.buffer,b,1)[0]=e[f],b+=4}return e}let oe={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class of{constructor(){this.id=of._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(a){a(this)}searchBlock(a,b){if(a){for(let c of(b(og.instance),a))c instanceof Array?this.searchBlock(c,b):c.search(b);b(oh.instance)}}constEvaluate(a,b){throw Error("Cannot evaluate node")}constEvaluateString(a){return this.constEvaluate(a).toString()}}of._id=0;class og extends of{}og.instance=new og;class oh extends of{}oh.instance=new oh;let oi=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class oj extends of{constructor(){super()}}class ok extends oj{constructor(a,b,c,d,e,f){super(),this.calls=new Set,this.name=a,this.args=b,this.returnType=c,this.body=d,this.startLine=e,this.endLine=f}get astNodeType(){return"function"}search(a){if(this.attributes)for(let b of this.attributes)a(b);for(let b of(a(this),this.args))a(b);this.searchBlock(this.body,a)}}class ol extends oj{constructor(a){super(),this.expression=a}get astNodeType(){return"staticAssert"}search(a){this.expression.search(a)}}class om extends oj{constructor(a,b){super(),this.condition=a,this.body=b}get astNodeType(){return"while"}search(a){this.condition.search(a),this.searchBlock(this.body,a)}}class on extends oj{constructor(a,b){super(),this.body=a,this.loopId=b}get astNodeType(){return"continuing"}search(a){this.searchBlock(this.body,a)}}class oo extends oj{constructor(a,b,c,d){super(),this.init=a,this.condition=b,this.increment=c,this.body=d}get astNodeType(){return"for"}search(a){var b,c,d;null==(b=this.init)||b.search(a),null==(c=this.condition)||c.search(a),null==(d=this.increment)||d.search(a),this.searchBlock(this.body,a)}}class op extends oj{constructor(a,b,c,d,e){super(),this.attributes=null,this.name=a,this.type=b,this.storage=c,this.access=d,this.value=e}get astNodeType(){return"var"}search(a){var b;a(this),null==(b=this.value)||b.search(a)}}class oq extends oj{constructor(a,b,c){super(),this.attributes=null,this.name=a,this.type=b,this.value=c}get astNodeType(){return"override"}search(a){var b;null==(b=this.value)||b.search(a)}}class or extends oj{constructor(a,b,c,d,e){super(),this.attributes=null,this.name=a,this.type=b,this.storage=c,this.access=d,this.value=e}get astNodeType(){return"let"}search(a){var b;a(this),null==(b=this.value)||b.search(a)}}class os extends oj{constructor(a,b,c,d,e){super(),this.attributes=null,this.name=a,this.type=b,this.storage=c,this.access=d,this.value=e}get astNodeType(){return"const"}constEvaluate(a,b){return this.value.constEvaluate(a,b)}search(a){var b;a(this),null==(b=this.value)||b.search(a)}}(xO=x_||(x_={})).increment="++",xO.decrement="--",(xP=x_||(x_={})).parse=function(a){if("parse"==a)throw Error("Invalid value for IncrementOperator");return xP[a]};class ot extends oj{constructor(a,b){super(),this.operator=a,this.variable=b}get astNodeType(){return"increment"}search(a){this.variable.search(a)}}(xQ=x0||(x0={})).assign="=",xQ.addAssign="+=",xQ.subtractAssin="-=",xQ.multiplyAssign="*=",xQ.divideAssign="/=",xQ.moduloAssign="%=",xQ.andAssign="&=",xQ.orAssign="|=",xQ.xorAssign="^=",xQ.shiftLeftAssign="<<=",xQ.shiftRightAssign=">>=",(x0||(x0={})).parse=function(a){if("parse"==a)throw Error("Invalid value for AssignOperator");return a};class ou extends oj{constructor(a,b,c){super(),this.operator=a,this.variable=b,this.value=c}get astNodeType(){return"assign"}search(a){this.variable.search(a),this.value.search(a)}}class ov extends oj{constructor(a,b){super(),this.name=a,this.args=b}get astNodeType(){return"call"}isBuiltin(){return oi.has(this.name)}search(a){for(let b of this.args)b.search(a);a(this)}}class ow extends oj{constructor(a,b){super(),this.body=a,this.continuing=b}get astNodeType(){return"loop"}search(a){var b;this.searchBlock(this.body,a),null==(b=this.continuing)||b.search(a)}}class ox extends oj{constructor(a,b){super(),this.condition=a,this.cases=b}get astNodeType(){return"switch"}search(a){for(let b of(a(this),this.cases))b.search(a)}}class oy extends oj{constructor(a,b,c,d){super(),this.condition=a,this.body=b,this.elseif=c,this.else=d}get astNodeType(){return"if"}search(a){this.condition.search(a),this.searchBlock(this.body,a),this.searchBlock(this.elseif,a),this.searchBlock(this.else,a)}}class oz extends oj{constructor(a){super(),this.value=a}get astNodeType(){return"return"}search(a){var b;null==(b=this.value)||b.search(a)}}class oA extends oj{constructor(a){super(),this.name=a}get astNodeType(){return"enable"}}class oB extends oj{constructor(a){super(),this.extensions=a}get astNodeType(){return"requires"}}class oC extends oj{constructor(a,b){super(),this.severity=a,this.rule=b}get astNodeType(){return"diagnostic"}}class oD extends oj{constructor(a,b){super(),this.name=a,this.type=b}get astNodeType(){return"alias"}}class oE extends oj{constructor(){super()}get astNodeType(){return"discard"}}class oF extends oj{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}class oG extends oj{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}}class oH extends oj{constructor(a){super(),this.attributes=null,this.name=a}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(a){let b=a[0];if("f32"===b.name)return b;for(let c=1;c<a.length;++c){let d=oH._priority.get(b.name);oH._priority.get(a[c].name)<d&&(b=a[c])}return"x32"===b.name?oH.i32:b}getTypeName(){return this.name}}oH.x32=new oH("x32"),oH.f32=new oH("f32"),oH.i32=new oH("i32"),oH.u32=new oH("u32"),oH.f16=new oH("f16"),oH.bool=new oH("bool"),oH.void=new oH("void"),oH._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class oI extends oH{constructor(a){super(a)}}class oJ extends oH{constructor(a,b,c,d){super(a),this.members=b,this.startLine=c,this.endLine=d}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(a){for(let b=0;b<this.members.length;b++)if(this.members[b].name==a)return b;return -1}search(a){for(let b of this.members)a(b)}}class oK extends oH{constructor(a,b,c){super(a),this.format=b,this.access=c}get astNodeType(){return"template"}getTypeName(){let a=this.name;if(null!==this.format){if("vec2"===a||"vec3"===a||"vec4"===a||"mat2x2"===a||"mat2x3"===a||"mat2x4"===a||"mat3x2"===a||"mat3x3"===a||"mat3x4"===a||"mat4x2"===a||"mat4x3"===a||"mat4x4"===a){if("f32"===this.format.name)return a+"f";if("i32"===this.format.name)return a+"i";if("u32"===this.format.name)return a+"u";if("bool"===this.format.name)return a+"b";if("f16"===this.format.name)return a+"h"}a+=`<${this.format.name}>`}return a}}oK.vec2f=new oK("vec2",oH.f32,null),oK.vec3f=new oK("vec3",oH.f32,null),oK.vec4f=new oK("vec4",oH.f32,null),oK.vec2i=new oK("vec2",oH.i32,null),oK.vec3i=new oK("vec3",oH.i32,null),oK.vec4i=new oK("vec4",oH.i32,null),oK.vec2u=new oK("vec2",oH.u32,null),oK.vec3u=new oK("vec3",oH.u32,null),oK.vec4u=new oK("vec4",oH.u32,null),oK.vec2h=new oK("vec2",oH.f16,null),oK.vec3h=new oK("vec3",oH.f16,null),oK.vec4h=new oK("vec4",oH.f16,null),oK.vec2b=new oK("vec2",oH.bool,null),oK.vec3b=new oK("vec3",oH.bool,null),oK.vec4b=new oK("vec4",oH.bool,null),oK.mat2x2f=new oK("mat2x2",oH.f32,null),oK.mat2x3f=new oK("mat2x3",oH.f32,null),oK.mat2x4f=new oK("mat2x4",oH.f32,null),oK.mat3x2f=new oK("mat3x2",oH.f32,null),oK.mat3x3f=new oK("mat3x3",oH.f32,null),oK.mat3x4f=new oK("mat3x4",oH.f32,null),oK.mat4x2f=new oK("mat4x2",oH.f32,null),oK.mat4x3f=new oK("mat4x3",oH.f32,null),oK.mat4x4f=new oK("mat4x4",oH.f32,null),oK.mat2x2h=new oK("mat2x2",oH.f16,null),oK.mat2x3h=new oK("mat2x3",oH.f16,null),oK.mat2x4h=new oK("mat2x4",oH.f16,null),oK.mat3x2h=new oK("mat3x2",oH.f16,null),oK.mat3x3h=new oK("mat3x3",oH.f16,null),oK.mat3x4h=new oK("mat3x4",oH.f16,null),oK.mat4x2h=new oK("mat4x2",oH.f16,null),oK.mat4x3h=new oK("mat4x3",oH.f16,null),oK.mat4x4h=new oK("mat4x4",oH.f16,null),oK.mat2x2i=new oK("mat2x2",oH.i32,null),oK.mat2x3i=new oK("mat2x3",oH.i32,null),oK.mat2x4i=new oK("mat2x4",oH.i32,null),oK.mat3x2i=new oK("mat3x2",oH.i32,null),oK.mat3x3i=new oK("mat3x3",oH.i32,null),oK.mat3x4i=new oK("mat3x4",oH.i32,null),oK.mat4x2i=new oK("mat4x2",oH.i32,null),oK.mat4x3i=new oK("mat4x3",oH.i32,null),oK.mat4x4i=new oK("mat4x4",oH.i32,null),oK.mat2x2u=new oK("mat2x2",oH.u32,null),oK.mat2x3u=new oK("mat2x3",oH.u32,null),oK.mat2x4u=new oK("mat2x4",oH.u32,null),oK.mat3x2u=new oK("mat3x2",oH.u32,null),oK.mat3x3u=new oK("mat3x3",oH.u32,null),oK.mat3x4u=new oK("mat3x4",oH.u32,null),oK.mat4x2u=new oK("mat4x2",oH.u32,null),oK.mat4x3u=new oK("mat4x3",oH.u32,null),oK.mat4x4u=new oK("mat4x4",oH.u32,null);class oL extends oH{constructor(a,b,c,d){super(a),this.storage=b,this.type=c,this.access=d}get astNodeType(){return"pointer"}}class oM extends oH{constructor(a,b,c,d){super(a),this.attributes=b,this.format=c,this.count=d}get astNodeType(){return"array"}get isArray(){return!0}}class oN extends oH{constructor(a,b,c){super(a),this.format=b,this.access=c}get astNodeType(){return"sampler"}}class oO extends of{constructor(){super(),this.postfix=null}}class oP extends oO{constructor(a){super(),this.value=a}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class oQ extends oO{constructor(a,b){super(),this.type=a,this.args=b}get astNodeType(){return"createExpr"}search(a){if(a(this),this.args)for(let b of this.args)b.search(a)}constEvaluate(a,b){return b&&(b[0]=this.type),a.evalExpression(this,a.context)}}class oR extends oO{constructor(a,b){super(),this.cachedReturnValue=null,this.name=a,this.args=b}get astNodeType(){return"callExpr"}setCachedReturnValue(a){this.cachedReturnValue=a}get isBuiltin(){return oi.has(this.name)}constEvaluate(a,b){return a.evalExpression(this,a.context)}search(a){for(let b of this.args)b.search(a);a(this)}}class oS extends oO{constructor(a){super(),this.name=a}get astNodeType(){return"varExpr"}search(a){a(this),this.postfix&&this.postfix.search(a)}constEvaluate(a,b){return a.evalExpression(this,a.context)}}class oT extends oO{constructor(a,b){super(),this.name=a,this.initializer=b}get astNodeType(){return"constExpr"}constEvaluate(a,b){if(this.initializer){let b=a.evalExpression(this.initializer,a.context);return null!==b&&this.postfix?b.getSubData(a,this.postfix,a.context):b}return null}search(a){this.initializer.search(a)}}class oU extends oO{constructor(a,b){super(),this.value=a,this.type=b}get astNodeType(){return"literalExpr"}constEvaluate(a,b){return void 0!==b&&(b[0]=this.type),this.value}get isScalar(){return this.value instanceof o9}get isVector(){return this.value instanceof pa||this.value instanceof pb}get scalarValue(){return this.value instanceof o9?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof pa||this.value instanceof pb?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}}class oV extends oO{constructor(a,b){super(),this.type=a,this.value=b}get astNodeType(){return"bitcastExpr"}search(a){this.value.search(a)}}class oW extends oO{constructor(a){super(),this.index=a}search(a){this.index.search(a)}}class oX extends oO{constructor(){super()}}class oY extends oX{constructor(a,b){super(),this.operator=a,this.right=b}get astNodeType(){return"unaryOp"}constEvaluate(a,b){return a.evalExpression(this,a.context)}search(a){this.right.search(a)}}class oZ extends oX{constructor(a,b,c){super(),this.operator=a,this.left=b,this.right=c}get astNodeType(){return"binaryOp"}_getPromotedType(a,b){return a.name===b.name?a:"f32"===a.name||"f32"===b.name?oH.f32:"u32"===a.name||"u32"===b.name?oH.u32:oH.i32}constEvaluate(a,b){return a.evalExpression(this,a.context)}search(a){this.left.search(a),this.right.search(a)}}class o$ extends of{constructor(a){super(),this.body=a}search(a){a(this),this.searchBlock(this.body,a)}}class o_ extends oO{constructor(){super()}get astNodeType(){return"default"}}class o0 extends o${constructor(a,b){super(b),this.selectors=a}get astNodeType(){return"case"}search(a){this.searchBlock(this.body,a)}}class o1 extends o${constructor(a){super(a)}get astNodeType(){return"default"}search(a){this.searchBlock(this.body,a)}}class o2 extends of{constructor(a,b,c){super(),this.name=a,this.type=b,this.attributes=c}get astNodeType(){return"argument"}}class o3 extends of{constructor(a,b){super(),this.condition=a,this.body=b}get astNodeType(){return"elseif"}search(a){this.condition.search(a),this.searchBlock(this.body,a)}}class o4 extends of{constructor(a,b,c){super(),this.name=a,this.type=b,this.attributes=c}get astNodeType(){return"member"}}class o5 extends of{constructor(a,b){super(),this.name=a,this.value=b}get astNodeType(){return"attribute"}}class o6{constructor(a,b){this.parent=null,this.typeInfo=a,this.parent=b,this.id=o6._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(a,b,c,d){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(a,b,c){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.getTypeName()}>`}}o6._id=0;class o7 extends o6{constructor(){super(new nU("void",null),null)}toString(){return"void"}}o7.void=new o7;class o8 extends o6{constructor(a){super(new nY("pointer",a.typeInfo,null),null),this.reference=a}clone(){return this}setDataValue(a,b,c,d){this.reference.setDataValue(a,b,c,d)}getSubData(a,b,c){return b?this.reference.getSubData(a,b,c):this}toString(){return`&${this.reference.toString()}`}}class o9 extends o6{constructor(a,b,c=null){super(b,c),a instanceof Int32Array||a instanceof Uint32Array||a instanceof Float32Array?this.data=a:"x32"===this.typeInfo.name?a-Math.floor(a)!=0?this.data=new Float32Array([a]):this.data=a>=0?new Uint32Array([a]):new Int32Array([a]):"i32"===this.typeInfo.name||"bool"===this.typeInfo.name?this.data=new Int32Array([a]):"u32"===this.typeInfo.name?this.data=new Uint32Array([a]):"f32"===this.typeInfo.name||"f16"===this.typeInfo.name?this.data=new Float32Array([a]):console.error("ScalarData2: Invalid type",b)}clone(){if(this.data instanceof Float32Array)return new o9(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new o9(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new o9(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(a){this.data[0]=a}setDataValue(a,b,c,d){if(c)return void console.error("SetDataValue: Scalar data does not support postfix",c);if(!(b instanceof o9))return void console.error("SetDataValue: Invalid value",b);let e=b.data[0];"i32"===this.typeInfo.name||"u32"===this.typeInfo.name?e=Math.floor(e):"bool"===this.typeInfo.name&&(e=+!!e),this.data[0]=e}getSubData(a,b,c){return b?(console.error("getSubData: Scalar data does not support postfix",b),null):this}toString(){return`${this.value}`}}class pa extends o6{constructor(a,b,c=null){if(super(b,c),a instanceof Float32Array||a instanceof Uint32Array||a instanceof Int32Array)this.data=a;else{const b=this.typeInfo.name;"vec2f"===b||"vec3f"===b||"vec4f"===b?this.data=new Float32Array(a):"vec2i"===b||"vec3i"===b||"vec4i"===b?this.data=new Int32Array(a):"vec2u"===b||"vec3u"===b||"vec4u"===b?this.data=new Uint32Array(a):"vec2h"===b||"vec3h"===b||"vec4h"===b?this.data=new Float32Array(a):"vec2b"===b||"vec3b"===b||"vec4b"===b?this.data=new Int32Array(a):"vec2"===b||"vec3"===b||"vec4"===b?this.data=new Float32Array(a):console.error(`VectorData: Invalid type ${b}`)}}clone(){if(this.data instanceof Float32Array)return new pa(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new pa(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new pa(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(a,b,c,d){c instanceof oP?console.error("TODO: Set vector postfix"):b instanceof pa?this.data=b.data:console.error("SetDataValue: Invalid value",b)}getSubData(a,b,c){if(null===b)return this;let d=a.getTypeInfo("f32");if(this.typeInfo instanceof nZ)d=this.typeInfo.format||d;else{let b=this.typeInfo.name;"vec2f"===b||"vec3f"===b||"vec4f"===b?d=a.getTypeInfo("f32"):"vec2i"===b||"vec3i"===b||"vec4i"===b?d=a.getTypeInfo("i32"):"vec2b"===b||"vec3b"===b||"vec4b"===b?d=a.getTypeInfo("bool"):"vec2u"===b||"vec3u"===b||"vec4u"===b?d=a.getTypeInfo("u32"):"vec2h"===b||"vec3h"===b||"vec4h"===b?d=a.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${b}`)}let e=this;for(;null!==b&&null!==e;){if(b instanceof oW){let f=b.index,g=-1;if(f instanceof oU){if(!(f.value instanceof o9))return console.error(`GetSubData: Invalid array index ${f.value}`),null;g=f.value.value}else{let b=a.evalExpression(f,c);if(!(b instanceof o9))return console.error("GetSubData: Unknown index type",f),null;g=b.value}if(g<0||g>=e.data.length)return console.error("GetSubData: Index out of range",g),null;if(e.data instanceof Float32Array)return new o9(new Float32Array(e.data.buffer,e.data.byteOffset+4*g,1),d);if(e.data instanceof Int32Array)return new o9(new Int32Array(e.data.buffer,e.data.byteOffset+4*g,1),d);if(e.data instanceof Uint32Array)return new o9(new Uint32Array(e.data.buffer,e.data.byteOffset+4*g,1),d);throw"GetSubData: Invalid data type"}if(!(b instanceof oP))return console.error("GetSubData: Unknown postfix",b),null;{let c=b.value.toLowerCase();if(1===c.length){let a=0;if("x"===c||"r"===c)a=0;else if("y"===c||"g"===c)a=1;else if("z"===c||"b"===c)a=2;else{if("w"!==c&&"a"!==c)return console.error(`GetSubData: Unknown member ${c}`),null;a=3}if(this.data instanceof Float32Array)return new o9(new Float32Array(this.data.buffer,this.data.byteOffset+4*a,1),d,this);if(this.data instanceof Int32Array)return new o9(new Int32Array(this.data.buffer,this.data.byteOffset+4*a,1),d,this);if(this.data instanceof Uint32Array)return new o9(new Uint32Array(this.data.buffer,this.data.byteOffset+4*a,1),d,this)}let f=[];for(let a of c)"x"===a||"r"===a?f.push(this.data[0]):"y"===a||"g"===a?f.push(this.data[1]):"z"===a||"b"===a?f.push(this.data[2]):"w"===a||"a"===a?f.push(this.data[3]):console.error(`GetDataValue: Unknown member ${a}`);e=function(a,b,c){let d=b.length;return 2===d?"f32"===c?new pa(new Float32Array(b),a.getTypeInfo("vec2f")):"i32"===c||"bool"===c?new pa(new Int32Array(b),a.getTypeInfo("vec2i")):"u32"===c?new pa(new Uint32Array(b),a.getTypeInfo("vec2u")):"f16"===c?new pa(new Float32Array(b),a.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${c}`),null):3===d?"f32"===c?new pa(new Float32Array(b),a.getTypeInfo("vec3f")):"i32"===c||"bool"===c?new pa(new Int32Array(b),a.getTypeInfo("vec3i")):"u32"===c?new pa(new Uint32Array(b),a.getTypeInfo("vec3u")):"f16"===c?new pa(new Float32Array(b),a.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${c}`),null):4===d?"f32"===c?new pa(new Float32Array(b),a.getTypeInfo("vec4f")):"i32"===c||"bool"===c?new pa(new Int32Array(b),a.getTypeInfo("vec4i")):"u32"===c?new pa(new Uint32Array(b),a.getTypeInfo("vec4u")):"f16"===c?new pa(new Float32Array(b),a.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${c}`),null):(console.error(`getSubData: Invalid vector size ${b.length}`),null)}(a,f,d.name)}b=b.postfix}return e}toString(){let a=`${this.data[0]}`;for(let b=1;b<this.data.length;++b)a+=`, ${this.data[b]}`;return a}}class pb extends o6{constructor(a,b,c=null){super(b,c),a instanceof Float32Array?this.data=a:this.data=new Float32Array(a)}clone(){return new pb(new Float32Array(this.data),this.typeInfo,null)}setDataValue(a,b,c,d){c instanceof oP?console.error("TODO: Set matrix postfix"):b instanceof pb?this.data=b.data:console.error("SetDataValue: Invalid value",b)}getSubData(a,b,c){if(null===b)return this;let d=this.typeInfo.name;if(a.getTypeInfo("f32"),this.typeInfo instanceof nZ)this.typeInfo.format;else if(d.endsWith("f"))a.getTypeInfo("f32");else if(d.endsWith("i"))a.getTypeInfo("i32");else if(d.endsWith("u"))a.getTypeInfo("u32");else{if(!d.endsWith("h"))return console.error(`GetDataValue: Unknown type ${d}`),null;a.getTypeInfo("f16")}if(b instanceof oW){let e,f=b.index,g=-1;if(f instanceof oU){if(!(f.value instanceof o9))return console.error(`GetDataValue: Invalid array index ${f.value}`),null;g=f.value.value}else{let b=a.evalExpression(f,c);if(!(b instanceof o9))return console.error("GetDataValue: Unknown index type",f),null;g=b.value}if(g<0||g>=this.data.length)return console.error("GetDataValue: Index out of range",g),null;let h=d.endsWith("h")?"h":"f";if("mat2x2"===d||"mat2x2f"===d||"mat2x2h"===d||"mat3x2"===d||"mat3x2f"===d||"mat3x2h"===d||"mat4x2"===d||"mat4x2f"===d||"mat4x2h"===d)e=new pa(new Float32Array(this.data.buffer,this.data.byteOffset+2*g*4,2),a.getTypeInfo(`vec2${h}`));else if("mat2x3"===d||"mat2x3f"===d||"mat2x3h"===d||"mat3x3"===d||"mat3x3f"===d||"mat3x3h"===d||"mat4x3"===d||"mat4x3f"===d||"mat4x3h"===d)e=new pa(new Float32Array(this.data.buffer,this.data.byteOffset+3*g*4,3),a.getTypeInfo(`vec3${h}`));else{if("mat2x4"!==d&&"mat2x4f"!==d&&"mat2x4h"!==d&&"mat3x4"!==d&&"mat3x4f"!==d&&"mat3x4h"!==d&&"mat4x4"!==d&&"mat4x4f"!==d&&"mat4x4h"!==d)return console.error(`GetDataValue: Unknown type ${d}`),null;e=new pa(new Float32Array(this.data.buffer,this.data.byteOffset+4*g*4,4),a.getTypeInfo(`vec4${h}`))}return b.postfix?e.getSubData(a,b.postfix,c):e}return console.error("GetDataValue: Invalid postfix",b),null}toString(){let a=`${this.data[0]}`;for(let b=1;b<this.data.length;++b)a+=`, ${this.data[b]}`;return a}}class pc extends o6{constructor(a,b,c=0,d=null){super(b,d),this.buffer=a instanceof ArrayBuffer?a:a.buffer,this.offset=c}clone(){return new pc(new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size)).buffer,this.typeInfo,0,null)}setDataValue(a,b,c,d){if(null===b)return void console.log("setDataValue: NULL data.");let e=this.offset,f=this.typeInfo;for(;c;){if(c instanceof oW)if(f instanceof nX){let b=c.index;if(b instanceof oU){if(!(b.value instanceof o9))return void console.error(`SetDataValue: Invalid index type ${b.value}`);e+=b.value.value*f.stride}else{let c=a.evalExpression(b,d);if(!(c instanceof o9))return void console.error("SetDataValue: Unknown index type",b);e+=c.value*f.stride}f=f.format}else console.error(`SetDataValue: Type ${f.getTypeName()} is not an array`);else{if(!(c instanceof oP))return void console.error("SetDataValue: Unknown postfix type",c);{let a=c.value;if(f instanceof nW){let b=!1;for(let c of f.members)if(c.name===a){e+=c.offset,f=c.type,b=!0;break}if(!b)return void console.error(`SetDataValue: Member ${a} not found`)}else if(f instanceof nU){let c=f.getTypeName(),d=0;if("x"===a||"r"===a)d=0;else if("y"===a||"g"===a)d=1;else if("z"===a||"b"===a)d=2;else{if("w"!==a&&"a"!==a)return void console.error(`SetDataValue: Unknown member ${a}`);d=3}if(!(b instanceof o9))return void console.error("SetDataValue: Invalid value",b);let g=b.value;return"vec2f"===c?void(new Float32Array(this.buffer,e,2)[d]=g):"vec3f"===c?void(new Float32Array(this.buffer,e,3)[d]=g):"vec4f"===c?void(new Float32Array(this.buffer,e,4)[d]=g):"vec2i"===c?void(new Int32Array(this.buffer,e,2)[d]=g):"vec3i"===c?void(new Int32Array(this.buffer,e,3)[d]=g):"vec4i"===c?void(new Int32Array(this.buffer,e,4)[d]=g):"vec2u"===c?void(new Uint32Array(this.buffer,e,2)[d]=g):"vec3u"===c?void(new Uint32Array(this.buffer,e,3)[d]=g):"vec4u"===c?void(new Uint32Array(this.buffer,e,4)[d]=g):void console.error(`SetDataValue: Type ${c} is not a struct`)}}}c=c.postfix}this.setData(a,b,f,e,d)}setData(a,b,c,d,e){let f=c.getTypeName();if("f32"!==f&&"f16"!==f)if("i32"!==f&&"atomic<i32>"!==f&&"x32"!==f)if("u32"!==f&&"atomic<u32>"!==f)if("bool"!==f){if("vec2f"===f||"vec2h"===f){let a=new Float32Array(this.buffer,d,2);return void(b instanceof pa?(a[0]=b.data[0],a[1]=b.data[1]):(a[0]=b[0],a[1]=b[1]))}if("vec3f"===f||"vec3h"===f){let a=new Float32Array(this.buffer,d,3);return void(b instanceof pa?(a[0]=b.data[0],a[1]=b.data[1],a[2]=b.data[2]):(a[0]=b[0],a[1]=b[1],a[2]=b[2]))}if("vec4f"===f||"vec4h"===f){let a=new Float32Array(this.buffer,d,4);return void(b instanceof pa?(a[0]=b.data[0],a[1]=b.data[1],a[2]=b.data[2],a[3]=b.data[3]):(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3]))}if("vec2i"===f){let a=new Int32Array(this.buffer,d,2);return void(b instanceof pa?(a[0]=b.data[0],a[1]=b.data[1]):(a[0]=b[0],a[1]=b[1]))}if("vec3i"===f){let a=new Int32Array(this.buffer,d,3);return void(b instanceof pa?(a[0]=b.data[0],a[1]=b.data[1],a[2]=b.data[2]):(a[0]=b[0],a[1]=b[1],a[2]=b[2]))}if("vec4i"===f){let a=new Int32Array(this.buffer,d,4);return void(b instanceof pa?(a[0]=b.data[0],a[1]=b.data[1],a[2]=b.data[2],a[3]=b.data[3]):(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3]))}if("vec2u"===f){let a=new Uint32Array(this.buffer,d,2);return void(b instanceof pa?(a[0]=b.data[0],a[1]=b.data[1]):(a[0]=b[0],a[1]=b[1]))}if("vec3u"===f){let a=new Uint32Array(this.buffer,d,3);return void(b instanceof pa?(a[0]=b.data[0],a[1]=b.data[1],a[2]=b.data[2]):(a[0]=b[0],a[1]=b[1],a[2]=b[2]))}if("vec4u"===f){let a=new Uint32Array(this.buffer,d,4);return void(b instanceof pa?(a[0]=b.data[0],a[1]=b.data[1],a[2]=b.data[2],a[3]=b.data[3]):(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3]))}if("vec2b"===f){let a=new Uint32Array(this.buffer,d,2);return void(b instanceof pa?(a[0]=b.data[0],a[1]=b.data[1]):(a[0]=b[0],a[1]=b[1]))}if("vec3b"===f){let a=new Uint32Array(this.buffer,d,3);return void(b instanceof pa?(a[0]=b.data[0],a[1]=b.data[1],a[2]=b.data[2]):(a[0]=b[0],a[1]=b[1],a[2]=b[2]))}if("vec4b"===f){let a=new Uint32Array(this.buffer,d,4);return void(b instanceof pa?(a[0]=b.data[0],a[1]=b.data[1],a[2]=b.data[2],a[3]=b.data[3]):(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3]))}if("mat2x2f"===f||"mat2x2h"===f){let a=new Float32Array(this.buffer,d,4);return void(b instanceof pb?(a[0]=b.data[0],a[1]=b.data[1],a[2]=b.data[2],a[3]=b.data[3]):(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3]))}if("mat2x3f"===f||"mat2x3h"===f){let a=new Float32Array(this.buffer,d,6);return void(b instanceof pb?(a[0]=b.data[0],a[1]=b.data[1],a[2]=b.data[2],a[3]=b.data[3],a[4]=b.data[4],a[5]=b.data[5]):(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5]))}if("mat2x4f"===f||"mat2x4h"===f){let a=new Float32Array(this.buffer,d,8);return void(b instanceof pb?(a[0]=b.data[0],a[1]=b.data[1],a[2]=b.data[2],a[3]=b.data[3],a[4]=b.data[4],a[5]=b.data[5],a[6]=b.data[6],a[7]=b.data[7]):(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7]))}if("mat3x2f"===f||"mat3x2h"===f){let a=new Float32Array(this.buffer,d,6);return void(b instanceof pb?(a[0]=b.data[0],a[1]=b.data[1],a[2]=b.data[2],a[3]=b.data[3],a[4]=b.data[4],a[5]=b.data[5]):(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5]))}if("mat3x3f"===f||"mat3x3h"===f){let a=new Float32Array(this.buffer,d,9);return void(b instanceof pb?(a[0]=b.data[0],a[1]=b.data[1],a[2]=b.data[2],a[3]=b.data[3],a[4]=b.data[4],a[5]=b.data[5],a[6]=b.data[6],a[7]=b.data[7],a[8]=b.data[8]):(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8]))}if("mat3x4f"===f||"mat3x4h"===f){let a=new Float32Array(this.buffer,d,12);return void(b instanceof pb?(a[0]=b.data[0],a[1]=b.data[1],a[2]=b.data[2],a[3]=b.data[3],a[4]=b.data[4],a[5]=b.data[5],a[6]=b.data[6],a[7]=b.data[7],a[8]=b.data[8],a[9]=b.data[9],a[10]=b.data[10],a[11]=b.data[11]):(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11]))}if("mat4x2f"===f||"mat4x2h"===f){let a=new Float32Array(this.buffer,d,8);return void(b instanceof pb?(a[0]=b.data[0],a[1]=b.data[1],a[2]=b.data[2],a[3]=b.data[3],a[4]=b.data[4],a[5]=b.data[5],a[6]=b.data[6],a[7]=b.data[7]):(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7]))}if("mat4x3f"===f||"mat4x3h"===f){let a=new Float32Array(this.buffer,d,12);return void(b instanceof pb?(a[0]=b.data[0],a[1]=b.data[1],a[2]=b.data[2],a[3]=b.data[3],a[4]=b.data[4],a[5]=b.data[5],a[6]=b.data[6],a[7]=b.data[7],a[8]=b.data[8],a[9]=b.data[9],a[10]=b.data[10],a[11]=b.data[11]):(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11]))}if("mat4x4f"===f||"mat4x4h"===f){let a=new Float32Array(this.buffer,d,16);return void(b instanceof pb?(a[0]=b.data[0],a[1]=b.data[1],a[2]=b.data[2],a[3]=b.data[3],a[4]=b.data[4],a[5]=b.data[5],a[6]=b.data[6],a[7]=b.data[7],a[8]=b.data[8],a[9]=b.data[9],a[10]=b.data[10],a[11]=b.data[11],a[12]=b.data[12],a[13]=b.data[13],a[14]=b.data[14],a[15]=b.data[15]):(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]))}if(b instanceof pc){if(c===b.typeInfo)return void new Uint8Array(this.buffer,d,b.buffer.byteLength).set(new Uint8Array(b.buffer));console.error("SetDataValue: Type mismatch",f,b.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${f}`)}else b instanceof o9&&(new Int32Array(this.buffer,d,1)[0]=b.value);else b instanceof o9&&(new Uint32Array(this.buffer,d,1)[0]=b.value);else b instanceof o9&&(new Int32Array(this.buffer,d,1)[0]=b.value);else b instanceof o9&&(new Float32Array(this.buffer,d,1)[0]=b.value)}getSubData(a,b,c){var d,e,f;if(null===b)return this;let g=this.offset,h=this.typeInfo;for(;b;){if(b instanceof oW){let d=b.index,e=d instanceof oO?a.evalExpression(d,c):d,f=0;if(e instanceof o9?f=e.value:"number"==typeof e?f=e:console.error("GetDataValue: Invalid index type",d),h instanceof nX)g+=f*h.stride,h=h.format;else{let b=h.getTypeName();"mat4x4"===b||"mat4x4f"===b||"mat4x4h"===b?(g+=16*f,h=a.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${h.getTypeName()} is not an array`)}}else{if(!(b instanceof oP))return console.error("GetDataValue: Unknown postfix type",b),null;{let c=b.value;if(h instanceof nW){let a=!1;for(let b of h.members)if(b.name===c){g+=b.offset,h=b.type,a=!0;break}if(!a)return console.error(`GetDataValue: Member ${c} not found`),null}else if(h instanceof nU){let b=h.getTypeName();if("vec2f"===b||"vec3f"===b||"vec4f"===b||"vec2i"===b||"vec3i"===b||"vec4i"===b||"vec2u"===b||"vec3u"===b||"vec4u"===b||"vec2b"===b||"vec3b"===b||"vec4b"===b||"vec2h"===b||"vec3h"===b||"vec4h"===b||"vec2"===b||"vec3"===b||"vec4"===b){if(c.length>0&&c.length<5){let d="f",e=[];for(let f=0;f<c.length;++f){let h=c[f].toLowerCase(),i=0;if("x"===h||"r"===h)i=0;else if("y"===h||"g"===h)i=1;else if("z"===h||"b"===h)i=2;else{if("w"!==h&&"a"!==h)return console.error(`Unknown member ${c}`),null;i=3}if(1===c.length){if(b.endsWith("f"))return this.buffer.byteLength<g+4*i+4?(console.log("Insufficient buffer data"),null):new o9(new Float32Array(this.buffer,g+4*i,1),a.getTypeInfo("f32"),this);if(b.endsWith("h"))return new o9(new Float32Array(this.buffer,g+4*i,1),a.getTypeInfo("f16"),this);if(b.endsWith("i"))return new o9(new Int32Array(this.buffer,g+4*i,1),a.getTypeInfo("i32"),this);if(b.endsWith("b"))return new o9(new Int32Array(this.buffer,g+4*i,1),a.getTypeInfo("bool"),this);if(b.endsWith("u"))return new o9(new Uint32Array(this.buffer,g+4*i,1),a.getTypeInfo("i32"),this)}if("vec2f"===b)e.push(new Float32Array(this.buffer,g,2)[i]);else if("vec3f"===b){if(g+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;let a=new Float32Array(this.buffer,g,3);e.push(a[i])}else if("vec4f"===b)e.push(new Float32Array(this.buffer,g,4)[i]);else if("vec2i"===b)d="i",e.push(new Int32Array(this.buffer,g,2)[i]);else if("vec3i"===b)d="i",e.push(new Int32Array(this.buffer,g,3)[i]);else if("vec4i"===b)d="i",e.push(new Int32Array(this.buffer,g,4)[i]);else if("vec2u"===b){d="u";let a=new Uint32Array(this.buffer,g,2);e.push(a[i])}else"vec3u"===b?(d="u",e.push(new Uint32Array(this.buffer,g,3)[i])):"vec4u"===b&&(d="u",e.push(new Uint32Array(this.buffer,g,4)[i]))}return 2===e.length?h=a.getTypeInfo(`vec2${d}`):3===e.length?h=a.getTypeInfo(`vec3${d}`):4===e.length?h=a.getTypeInfo(`vec4${d}`):console.error(`GetDataValue: Invalid vector length ${e.length}`),new pa(e,h,null)}return console.error(`GetDataValue: Unknown member ${c}`),null}return console.error(`GetDataValue: Type ${b} is not a struct`),null}}}b=b.postfix}let i=h.getTypeName();return"f32"===i?new o9(new Float32Array(this.buffer,g,1),h,this):"i32"===i?new o9(new Int32Array(this.buffer,g,1),h,this):"u32"===i?new o9(new Uint32Array(this.buffer,g,1),h,this):"vec2f"===i?new pa(new Float32Array(this.buffer,g,2),h,this):"vec3f"===i?new pa(new Float32Array(this.buffer,g,3),h,this):"vec4f"===i?new pa(new Float32Array(this.buffer,g,4),h,this):"vec2i"===i?new pa(new Int32Array(this.buffer,g,2),h,this):"vec3i"===i?new pa(new Int32Array(this.buffer,g,3),h,this):"vec4i"===i?new pa(new Int32Array(this.buffer,g,4),h,this):"vec2u"===i?new pa(new Uint32Array(this.buffer,g,2),h,this):"vec3u"===i?new pa(new Uint32Array(this.buffer,g,3),h,this):"vec4u"===i?new pa(new Uint32Array(this.buffer,g,4),h,this):h instanceof nZ&&"atomic"===h.name?"u32"===(null==(d=h.format)?void 0:d.name)?new o9(new Uint32Array(this.buffer,g,1)[0],h.format,this):"i32"===(null==(e=h.format)?void 0:e.name)?new o9(new Int32Array(this.buffer,g,1)[0],h.format,this):(console.error(`GetDataValue: Invalid atomic format ${null==(f=h.format)?void 0:f.name}`),null):new pc(this.buffer,h,g,this)}toString(){let a="";if(this.typeInfo instanceof nX)if("f32"===this.typeInfo.format.name){let b=new Float32Array(this.buffer,this.offset);a=`[${b[0]}`;for(let c=1;c<b.length;++c)a+=`, ${b[c]}`}else if("i32"===this.typeInfo.format.name){let b=new Int32Array(this.buffer,this.offset);a=`[${b[0]}`;for(let c=1;c<b.length;++c)a+=`, ${b[c]}`}else if("u32"===this.typeInfo.format.name){let b=new Uint32Array(this.buffer,this.offset);a=`[${b[0]}`;for(let c=1;c<b.length;++c)a+=`, ${b[c]}`}else if("vec2f"===this.typeInfo.format.name){let b=new Float32Array(this.buffer,this.offset);a=`[${b[0]}, ${b[1]}]`;for(let c=1;c<b.length/2;++c)a+=`, [${b[2*c]}, ${b[2*c+1]}]`}else if("vec3f"===this.typeInfo.format.name){let b=new Float32Array(this.buffer,this.offset);a=`[${b[0]}, ${b[1]}, ${b[2]}]`;for(let c=4;c<b.length;c+=4)a+=`, [${b[c]}, ${b[c+1]}, ${b[c+2]}]`}else if("vec4f"===this.typeInfo.format.name){let b=new Float32Array(this.buffer,this.offset);a=`[${b[0]}, ${b[1]}, ${b[2]}, ${b[3]}]`;for(let c=4;c<b.length;c+=4)a+=`, [${b[c]}, ${b[c+1]}, ${b[c+2]}, ${b[c+3]}]`}else a="[...]";else this.typeInfo instanceof nW?a+="{...}":a="[...]";return a}}class pd extends o6{constructor(a,b,c,d){super(b,null),this.data=a,this.descriptor=c,this.view=d}clone(){return new pd(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var a,b;let c=this.descriptor.size;return c instanceof Array&&c.length>0?null!=(a=c[0])?a:0:c instanceof Object&&null!=(b=c.width)?b:0}get height(){var a,b;let c=this.descriptor.size;return c instanceof Array&&c.length>1?null!=(a=c[1])?a:0:c instanceof Object&&null!=(b=c.height)?b:0}get depthOrArrayLayers(){var a,b;let c=this.descriptor.size;return c instanceof Array&&c.length>2?null!=(a=c[2])?a:0:c instanceof Object&&null!=(b=c.depthOrArrayLayers)?b:0}get format(){var a;return this.descriptor&&null!=(a=this.descriptor.format)?a:"rgba8unorm"}get sampleCount(){var a;return this.descriptor&&null!=(a=this.descriptor.sampleCount)?a:1}get mipLevelCount(){var a;return this.descriptor&&null!=(a=this.descriptor.mipLevelCount)?a:1}get dimension(){var a;return this.descriptor&&null!=(a=this.descriptor.dimension)?a:"2d"}getMipLevelSize(a){if(a>=this.mipLevelCount)return[0,0,0];let b=[this.width,this.height,this.depthOrArrayLayers];for(let c=0;c<b.length;++c)b[c]=Math.max(1,b[c]>>a);return b}get texelByteSize(){let a=oe[this.format];return a?a.isDepthStencil?4:a.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){let a=oe[this.format];return!!a&&a.isDepthStencil}getGpuSize(){let a=this.format,b=oe[a],c=this.width;if(!a||c<=0||!b)return -1;let d=this.height,e=this.depthOrArrayLayers,f=this.dimension;return c/b.blockWidth*("1d"===f?1:d/b.blockHeight)*b.bytesPerBlock*e}getPixel(a,b,c=0,d=0){let e=this.texelByteSize,f=this.bytesPerRow,g=this.height;return function(a,b,c,d,e,f,g,h,i){let j=d*(g>>=e)*(f>>=e)+c*g+b*h;switch(i){case"r8unorm":return[oc(a,j,"8unorm",1)[0]];case"r8snorm":return[oc(a,j,"8snorm",1)[0]];case"r8uint":return[oc(a,j,"8uint",1)[0]];case"r8sint":return[oc(a,j,"8sint",1)[0]];case"rg8unorm":{let b=oc(a,j,"8unorm",2);return[b[0],b[1]]}case"rg8snorm":{let b=oc(a,j,"8snorm",2);return[b[0],b[1]]}case"rg8uint":{let b=oc(a,j,"8uint",2);return[b[0],b[1]]}case"rg8sint":{let b=oc(a,j,"8sint",2);return[b[0],b[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{let b=oc(a,j,"8unorm",4);return[b[0],b[1],b[2],b[3]]}case"rgba8snorm":{let b=oc(a,j,"8snorm",4);return[b[0],b[1],b[2],b[3]]}case"rgba8uint":{let b=oc(a,j,"8uint",4);return[b[0],b[1],b[2],b[3]]}case"rgba8sint":{let b=oc(a,j,"8sint",4);return[b[0],b[1],b[2],b[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{let b=oc(a,j,"8unorm",4);return[b[2],b[1],b[0],b[3]]}case"r16uint":return[oc(a,j,"16uint",1)[0]];case"r16sint":return[oc(a,j,"16sint",1)[0]];case"r16float":return[oc(a,j,"16float",1)[0]];case"rg16uint":{let b=oc(a,j,"16uint",2);return[b[0],b[1]]}case"rg16sint":{let b=oc(a,j,"16sint",2);return[b[0],b[1]]}case"rg16float":{let b=oc(a,j,"16float",2);return[b[0],b[1]]}case"rgba16uint":{let b=oc(a,j,"16uint",4);return[b[0],b[1],b[2],b[3]]}case"rgba16sint":{let b=oc(a,j,"16sint",4);return[b[0],b[1],b[2],b[3]]}case"rgba16float":{let b=oc(a,j,"16float",4);return[b[0],b[1],b[2],b[3]]}case"r32uint":return[oc(a,j,"32uint",1)[0]];case"r32sint":return[oc(a,j,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[oc(a,j,"32float",1)[0]];case"rg32uint":{let b=oc(a,j,"32uint",2);return[b[0],b[1]]}case"rg32sint":{let b=oc(a,j,"32sint",2);return[b[0],b[1]]}case"rg32float":{let b=oc(a,j,"32float",2);return[b[0],b[1]]}case"rgba32uint":{let b=oc(a,j,"32uint",4);return[b[0],b[1],b[2],b[3]]}case"rgba32sint":{let b=oc(a,j,"32sint",4);return[b[0],b[1],b[2],b[3]]}case"rgba32float":{let b=oc(a,j,"32float",4);return[b[0],b[1],b[2],b[3]]}case"rg11b10ufloat":{var k;let b=new Uint32Array(a.buffer,j,1)[0];return[ob(2047&b),ob((4192256&b)>>11),(k=(0xffc00000&b)>>22,n9[0]=112+(k>>5&31)<<23|(31&k)<<18,oa[0]),1]}}return null}(new Uint8Array(this.data[d]),a,b,c,d,g,f,e,this.format)}setPixel(a,b,c,d,e){let f=this.texelByteSize,g=this.bytesPerRow,h=this.height;!function(a,b,c,d,e,f,g,h,i,j){let k=d*(g>>=e)*(f>>=e)+c*g+b*h;switch(i){case"r8unorm":return od(a,k,"8unorm",1,j);case"r8snorm":return od(a,k,"8snorm",1,j);case"r8uint":return od(a,k,"8uint",1,j);case"r8sint":return od(a,k,"8sint",1,j);case"rg8unorm":return od(a,k,"8unorm",2,j);case"rg8snorm":return od(a,k,"8snorm",2,j);case"rg8uint":return od(a,k,"8uint",2,j);case"rg8sint":return od(a,k,"8sint",2,j);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return od(a,k,"8unorm",4,j);case"rgba8snorm":return od(a,k,"8snorm",4,j);case"rgba8uint":return od(a,k,"8uint",4,j);case"rgba8sint":return od(a,k,"8sint",4,j);case"r16uint":return od(a,k,"16uint",1,j);case"r16sint":return od(a,k,"16sint",1,j);case"r16float":return od(a,k,"16float",1,j);case"rg16uint":return od(a,k,"16uint",2,j);case"rg16sint":return od(a,k,"16sint",2,j);case"rg16float":return od(a,k,"16float",2,j);case"rgba16uint":return od(a,k,"16uint",4,j);case"rgba16sint":return od(a,k,"16sint",4,j);case"rgba16float":return od(a,k,"16float",4,j);case"r32uint":return od(a,k,"32uint",1,j);case"r32sint":return od(a,k,"32sint",1,j);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return od(a,k,"32float",1,j);case"rg32uint":return od(a,k,"32uint",2,j);case"rg32sint":return od(a,k,"32sint",2,j);case"rg32float":return od(a,k,"32float",2,j);case"rgba32uint":return od(a,k,"32uint",4,j);case"rgba32sint":return od(a,k,"32sint",4,j);case"rgba32float":return od(a,k,"32float",4,j);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}}(new Uint8Array(this.data[d]),a,b,c,d,h,g,f,this.format,e)}}(xR=x1||(x1={}))[xR.token=0]="token",xR[xR.keyword=1]="keyword",xR[xR.reserved=2]="reserved";class pe{constructor(a,b,c){this.name=a,this.type=b,this.rule=c}toString(){return this.name}}class pf{}pf.none=new pe("",x1.reserved,""),pf.eof=new pe("EOF",x1.token,""),pf.reserved={asm:new pe("asm",x1.reserved,"asm"),bf16:new pe("bf16",x1.reserved,"bf16"),do:new pe("do",x1.reserved,"do"),enum:new pe("enum",x1.reserved,"enum"),f16:new pe("f16",x1.reserved,"f16"),f64:new pe("f64",x1.reserved,"f64"),handle:new pe("handle",x1.reserved,"handle"),i8:new pe("i8",x1.reserved,"i8"),i16:new pe("i16",x1.reserved,"i16"),i64:new pe("i64",x1.reserved,"i64"),mat:new pe("mat",x1.reserved,"mat"),premerge:new pe("premerge",x1.reserved,"premerge"),regardless:new pe("regardless",x1.reserved,"regardless"),typedef:new pe("typedef",x1.reserved,"typedef"),u8:new pe("u8",x1.reserved,"u8"),u16:new pe("u16",x1.reserved,"u16"),u64:new pe("u64",x1.reserved,"u64"),unless:new pe("unless",x1.reserved,"unless"),using:new pe("using",x1.reserved,"using"),vec:new pe("vec",x1.reserved,"vec"),void:new pe("void",x1.reserved,"void")},pf.keywords={array:new pe("array",x1.keyword,"array"),atomic:new pe("atomic",x1.keyword,"atomic"),bool:new pe("bool",x1.keyword,"bool"),f32:new pe("f32",x1.keyword,"f32"),i32:new pe("i32",x1.keyword,"i32"),mat2x2:new pe("mat2x2",x1.keyword,"mat2x2"),mat2x3:new pe("mat2x3",x1.keyword,"mat2x3"),mat2x4:new pe("mat2x4",x1.keyword,"mat2x4"),mat3x2:new pe("mat3x2",x1.keyword,"mat3x2"),mat3x3:new pe("mat3x3",x1.keyword,"mat3x3"),mat3x4:new pe("mat3x4",x1.keyword,"mat3x4"),mat4x2:new pe("mat4x2",x1.keyword,"mat4x2"),mat4x3:new pe("mat4x3",x1.keyword,"mat4x3"),mat4x4:new pe("mat4x4",x1.keyword,"mat4x4"),ptr:new pe("ptr",x1.keyword,"ptr"),sampler:new pe("sampler",x1.keyword,"sampler"),sampler_comparison:new pe("sampler_comparison",x1.keyword,"sampler_comparison"),struct:new pe("struct",x1.keyword,"struct"),texture_1d:new pe("texture_1d",x1.keyword,"texture_1d"),texture_2d:new pe("texture_2d",x1.keyword,"texture_2d"),texture_2d_array:new pe("texture_2d_array",x1.keyword,"texture_2d_array"),texture_3d:new pe("texture_3d",x1.keyword,"texture_3d"),texture_cube:new pe("texture_cube",x1.keyword,"texture_cube"),texture_cube_array:new pe("texture_cube_array",x1.keyword,"texture_cube_array"),texture_multisampled_2d:new pe("texture_multisampled_2d",x1.keyword,"texture_multisampled_2d"),texture_storage_1d:new pe("texture_storage_1d",x1.keyword,"texture_storage_1d"),texture_storage_2d:new pe("texture_storage_2d",x1.keyword,"texture_storage_2d"),texture_storage_2d_array:new pe("texture_storage_2d_array",x1.keyword,"texture_storage_2d_array"),texture_storage_3d:new pe("texture_storage_3d",x1.keyword,"texture_storage_3d"),texture_depth_2d:new pe("texture_depth_2d",x1.keyword,"texture_depth_2d"),texture_depth_2d_array:new pe("texture_depth_2d_array",x1.keyword,"texture_depth_2d_array"),texture_depth_cube:new pe("texture_depth_cube",x1.keyword,"texture_depth_cube"),texture_depth_cube_array:new pe("texture_depth_cube_array",x1.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new pe("texture_depth_multisampled_2d",x1.keyword,"texture_depth_multisampled_2d"),texture_external:new pe("texture_external",x1.keyword,"texture_external"),u32:new pe("u32",x1.keyword,"u32"),vec2:new pe("vec2",x1.keyword,"vec2"),vec3:new pe("vec3",x1.keyword,"vec3"),vec4:new pe("vec4",x1.keyword,"vec4"),bitcast:new pe("bitcast",x1.keyword,"bitcast"),block:new pe("block",x1.keyword,"block"),break:new pe("break",x1.keyword,"break"),case:new pe("case",x1.keyword,"case"),continue:new pe("continue",x1.keyword,"continue"),continuing:new pe("continuing",x1.keyword,"continuing"),default:new pe("default",x1.keyword,"default"),diagnostic:new pe("diagnostic",x1.keyword,"diagnostic"),discard:new pe("discard",x1.keyword,"discard"),else:new pe("else",x1.keyword,"else"),enable:new pe("enable",x1.keyword,"enable"),fallthrough:new pe("fallthrough",x1.keyword,"fallthrough"),false:new pe("false",x1.keyword,"false"),fn:new pe("fn",x1.keyword,"fn"),for:new pe("for",x1.keyword,"for"),function:new pe("function",x1.keyword,"function"),if:new pe("if",x1.keyword,"if"),let:new pe("let",x1.keyword,"let"),const:new pe("const",x1.keyword,"const"),loop:new pe("loop",x1.keyword,"loop"),while:new pe("while",x1.keyword,"while"),private:new pe("private",x1.keyword,"private"),read:new pe("read",x1.keyword,"read"),read_write:new pe("read_write",x1.keyword,"read_write"),return:new pe("return",x1.keyword,"return"),requires:new pe("requires",x1.keyword,"requires"),storage:new pe("storage",x1.keyword,"storage"),switch:new pe("switch",x1.keyword,"switch"),true:new pe("true",x1.keyword,"true"),alias:new pe("alias",x1.keyword,"alias"),type:new pe("type",x1.keyword,"type"),uniform:new pe("uniform",x1.keyword,"uniform"),var:new pe("var",x1.keyword,"var"),override:new pe("override",x1.keyword,"override"),workgroup:new pe("workgroup",x1.keyword,"workgroup"),write:new pe("write",x1.keyword,"write"),r8unorm:new pe("r8unorm",x1.keyword,"r8unorm"),r8snorm:new pe("r8snorm",x1.keyword,"r8snorm"),r8uint:new pe("r8uint",x1.keyword,"r8uint"),r8sint:new pe("r8sint",x1.keyword,"r8sint"),r16uint:new pe("r16uint",x1.keyword,"r16uint"),r16sint:new pe("r16sint",x1.keyword,"r16sint"),r16float:new pe("r16float",x1.keyword,"r16float"),rg8unorm:new pe("rg8unorm",x1.keyword,"rg8unorm"),rg8snorm:new pe("rg8snorm",x1.keyword,"rg8snorm"),rg8uint:new pe("rg8uint",x1.keyword,"rg8uint"),rg8sint:new pe("rg8sint",x1.keyword,"rg8sint"),r32uint:new pe("r32uint",x1.keyword,"r32uint"),r32sint:new pe("r32sint",x1.keyword,"r32sint"),r32float:new pe("r32float",x1.keyword,"r32float"),rg16uint:new pe("rg16uint",x1.keyword,"rg16uint"),rg16sint:new pe("rg16sint",x1.keyword,"rg16sint"),rg16float:new pe("rg16float",x1.keyword,"rg16float"),rgba8unorm:new pe("rgba8unorm",x1.keyword,"rgba8unorm"),rgba8unorm_srgb:new pe("rgba8unorm_srgb",x1.keyword,"rgba8unorm_srgb"),rgba8snorm:new pe("rgba8snorm",x1.keyword,"rgba8snorm"),rgba8uint:new pe("rgba8uint",x1.keyword,"rgba8uint"),rgba8sint:new pe("rgba8sint",x1.keyword,"rgba8sint"),bgra8unorm:new pe("bgra8unorm",x1.keyword,"bgra8unorm"),bgra8unorm_srgb:new pe("bgra8unorm_srgb",x1.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new pe("rgb10a2unorm",x1.keyword,"rgb10a2unorm"),rg11b10float:new pe("rg11b10float",x1.keyword,"rg11b10float"),rg32uint:new pe("rg32uint",x1.keyword,"rg32uint"),rg32sint:new pe("rg32sint",x1.keyword,"rg32sint"),rg32float:new pe("rg32float",x1.keyword,"rg32float"),rgba16uint:new pe("rgba16uint",x1.keyword,"rgba16uint"),rgba16sint:new pe("rgba16sint",x1.keyword,"rgba16sint"),rgba16float:new pe("rgba16float",x1.keyword,"rgba16float"),rgba32uint:new pe("rgba32uint",x1.keyword,"rgba32uint"),rgba32sint:new pe("rgba32sint",x1.keyword,"rgba32sint"),rgba32float:new pe("rgba32float",x1.keyword,"rgba32float"),static_assert:new pe("static_assert",x1.keyword,"static_assert")},pf.tokens={decimal_float_literal:new pe("decimal_float_literal",x1.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new pe("hex_float_literal",x1.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new pe("int_literal",x1.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new pe("uint_literal",x1.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new pe("name",x1.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new pe("ident",x1.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new pe("and",x1.token,"&"),and_and:new pe("and_and",x1.token,"&&"),arrow:new pe("arrow ",x1.token,"->"),attr:new pe("attr",x1.token,"@"),forward_slash:new pe("forward_slash",x1.token,"/"),bang:new pe("bang",x1.token,"!"),bracket_left:new pe("bracket_left",x1.token,"["),bracket_right:new pe("bracket_right",x1.token,"]"),brace_left:new pe("brace_left",x1.token,"{"),brace_right:new pe("brace_right",x1.token,"}"),colon:new pe("colon",x1.token,":"),comma:new pe("comma",x1.token,","),equal:new pe("equal",x1.token,"="),equal_equal:new pe("equal_equal",x1.token,"=="),not_equal:new pe("not_equal",x1.token,"!="),greater_than:new pe("greater_than",x1.token,">"),greater_than_equal:new pe("greater_than_equal",x1.token,">="),shift_right:new pe("shift_right",x1.token,">>"),less_than:new pe("less_than",x1.token,"<"),less_than_equal:new pe("less_than_equal",x1.token,"<="),shift_left:new pe("shift_left",x1.token,"<<"),modulo:new pe("modulo",x1.token,"%"),minus:new pe("minus",x1.token,"-"),minus_minus:new pe("minus_minus",x1.token,"--"),period:new pe("period",x1.token,"."),plus:new pe("plus",x1.token,"+"),plus_plus:new pe("plus_plus",x1.token,"++"),or:new pe("or",x1.token,"|"),or_or:new pe("or_or",x1.token,"||"),paren_left:new pe("paren_left",x1.token,"("),paren_right:new pe("paren_right",x1.token,")"),semicolon:new pe("semicolon",x1.token,";"),star:new pe("star",x1.token,"*"),tilde:new pe("tilde",x1.token,"~"),underscore:new pe("underscore",x1.token,"_"),xor:new pe("xor",x1.token,"^"),plus_equal:new pe("plus_equal",x1.token,"+="),minus_equal:new pe("minus_equal",x1.token,"-="),times_equal:new pe("times_equal",x1.token,"*="),division_equal:new pe("division_equal",x1.token,"/="),modulo_equal:new pe("modulo_equal",x1.token,"%="),and_equal:new pe("and_equal",x1.token,"&="),or_equal:new pe("or_equal",x1.token,"|="),xor_equal:new pe("xor_equal",x1.token,"^="),shift_right_equal:new pe("shift_right_equal",x1.token,">>="),shift_left_equal:new pe("shift_left_equal",x1.token,"<<=")},pf.simpleTokens={"@":pf.tokens.attr,"{":pf.tokens.brace_left,"}":pf.tokens.brace_right,":":pf.tokens.colon,",":pf.tokens.comma,"(":pf.tokens.paren_left,")":pf.tokens.paren_right,";":pf.tokens.semicolon},pf.literalTokens={"&":pf.tokens.and,"&&":pf.tokens.and_and,"->":pf.tokens.arrow,"/":pf.tokens.forward_slash,"!":pf.tokens.bang,"[":pf.tokens.bracket_left,"]":pf.tokens.bracket_right,"=":pf.tokens.equal,"==":pf.tokens.equal_equal,"!=":pf.tokens.not_equal,">":pf.tokens.greater_than,">=":pf.tokens.greater_than_equal,">>":pf.tokens.shift_right,"<":pf.tokens.less_than,"<=":pf.tokens.less_than_equal,"<<":pf.tokens.shift_left,"%":pf.tokens.modulo,"-":pf.tokens.minus,"--":pf.tokens.minus_minus,".":pf.tokens.period,"+":pf.tokens.plus,"++":pf.tokens.plus_plus,"|":pf.tokens.or,"||":pf.tokens.or_or,"*":pf.tokens.star,"~":pf.tokens.tilde,_:pf.tokens.underscore,"^":pf.tokens.xor,"+=":pf.tokens.plus_equal,"-=":pf.tokens.minus_equal,"*=":pf.tokens.times_equal,"/=":pf.tokens.division_equal,"%=":pf.tokens.modulo_equal,"&=":pf.tokens.and_equal,"|=":pf.tokens.or_equal,"^=":pf.tokens.xor_equal,">>=":pf.tokens.shift_right_equal,"<<=":pf.tokens.shift_left_equal},pf.regexTokens={decimal_float_literal:pf.tokens.decimal_float_literal,hex_float_literal:pf.tokens.hex_float_literal,int_literal:pf.tokens.int_literal,uint_literal:pf.tokens.uint_literal,ident:pf.tokens.ident},pf.storage_class=[pf.keywords.function,pf.keywords.private,pf.keywords.workgroup,pf.keywords.uniform,pf.keywords.storage],pf.access_mode=[pf.keywords.read,pf.keywords.write,pf.keywords.read_write],pf.sampler_type=[pf.keywords.sampler,pf.keywords.sampler_comparison],pf.sampled_texture_type=[pf.keywords.texture_1d,pf.keywords.texture_2d,pf.keywords.texture_2d_array,pf.keywords.texture_3d,pf.keywords.texture_cube,pf.keywords.texture_cube_array],pf.multisampled_texture_type=[pf.keywords.texture_multisampled_2d],pf.storage_texture_type=[pf.keywords.texture_storage_1d,pf.keywords.texture_storage_2d,pf.keywords.texture_storage_2d_array,pf.keywords.texture_storage_3d],pf.depth_texture_type=[pf.keywords.texture_depth_2d,pf.keywords.texture_depth_2d_array,pf.keywords.texture_depth_cube,pf.keywords.texture_depth_cube_array,pf.keywords.texture_depth_multisampled_2d],pf.texture_external_type=[pf.keywords.texture_external],pf.any_texture_type=[...pf.sampled_texture_type,...pf.multisampled_texture_type,...pf.storage_texture_type,...pf.depth_texture_type,...pf.texture_external_type],pf.texel_format=[pf.keywords.r8unorm,pf.keywords.r8snorm,pf.keywords.r8uint,pf.keywords.r8sint,pf.keywords.r16uint,pf.keywords.r16sint,pf.keywords.r16float,pf.keywords.rg8unorm,pf.keywords.rg8snorm,pf.keywords.rg8uint,pf.keywords.rg8sint,pf.keywords.r32uint,pf.keywords.r32sint,pf.keywords.r32float,pf.keywords.rg16uint,pf.keywords.rg16sint,pf.keywords.rg16float,pf.keywords.rgba8unorm,pf.keywords.rgba8unorm_srgb,pf.keywords.rgba8snorm,pf.keywords.rgba8uint,pf.keywords.rgba8sint,pf.keywords.bgra8unorm,pf.keywords.bgra8unorm_srgb,pf.keywords.rgb10a2unorm,pf.keywords.rg11b10float,pf.keywords.rg32uint,pf.keywords.rg32sint,pf.keywords.rg32float,pf.keywords.rgba16uint,pf.keywords.rgba16sint,pf.keywords.rgba16float,pf.keywords.rgba32uint,pf.keywords.rgba32sint,pf.keywords.rgba32float],pf.const_literal=[pf.tokens.int_literal,pf.tokens.uint_literal,pf.tokens.decimal_float_literal,pf.tokens.hex_float_literal,pf.keywords.true,pf.keywords.false],pf.literal_or_ident=[pf.tokens.ident,pf.tokens.int_literal,pf.tokens.uint_literal,pf.tokens.decimal_float_literal,pf.tokens.hex_float_literal,pf.tokens.name],pf.element_count_expression=[pf.tokens.int_literal,pf.tokens.uint_literal,pf.tokens.ident],pf.template_types=[pf.keywords.vec2,pf.keywords.vec3,pf.keywords.vec4,pf.keywords.mat2x2,pf.keywords.mat2x3,pf.keywords.mat2x4,pf.keywords.mat3x2,pf.keywords.mat3x3,pf.keywords.mat3x4,pf.keywords.mat4x2,pf.keywords.mat4x3,pf.keywords.mat4x4,pf.keywords.atomic,pf.keywords.bitcast,...pf.any_texture_type],pf.attribute_name=[pf.tokens.ident,pf.keywords.block,pf.keywords.diagnostic],pf.assignment_operators=[pf.tokens.equal,pf.tokens.plus_equal,pf.tokens.minus_equal,pf.tokens.times_equal,pf.tokens.division_equal,pf.tokens.modulo_equal,pf.tokens.and_equal,pf.tokens.or_equal,pf.tokens.xor_equal,pf.tokens.shift_right_equal,pf.tokens.shift_left_equal],pf.increment_operators=[pf.tokens.plus_plus,pf.tokens.minus_minus];class pg{constructor(a,b,c,d,e){this.type=a,this.lexeme=b,this.line=c,this.start=d,this.end=e}toString(){return this.lexeme}isTemplateType(){return -1!=pf.template_types.indexOf(this.type)}isArrayType(){return this.type==pf.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class ph{constructor(a){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=null!=a?a:""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new pg(pf.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let a=this._advance();if("\n"==a)return this._line++,!0;if(this._isWhitespace(a))return!0;if("/"==a){if("/"==this._peekAhead()){for(;"\n"!=a;){if(this._isAtEnd())return!0;a=this._advance()}return this._line++,!0}if("*"==this._peekAhead()){this._advance();let b=1;for(;b>0&&!this._isAtEnd();)if("\n"==(a=this._advance()))this._line++;else if("*"==a){if("/"==this._peekAhead()&&(this._advance(),0==--b))break}else"/"==a&&"*"==this._peekAhead()&&(this._advance(),b++);return!0}}let b=pf.simpleTokens[a];if(b)return this._addToken(b),!0;let c=pf.none,d=this._isAlpha(a),e="_"===a;if(this._isAlphaNumeric(a)){let b=this._peekAhead();for(;this._isAlphaNumeric(b);)a+=this._advance(),b=this._peekAhead()}if(d){let b=pf.keywords[a];if(b)return this._addToken(b),!0}if(d||e)return this._addToken(pf.tokens.ident),!0;for(;;){let b=this._findType(a),d=this._peekAhead();if("-"==a&&this._tokens.length>0){if("="==d)return this._current++,a+=d,this._addToken(pf.tokens.minus_equal),!0;if("-"==d)return this._current++,a+=d,this._addToken(pf.tokens.minus_minus),!0;let c=this._tokens.length-1;if((-1!=pf.literal_or_ident.indexOf(this._tokens[c].type)||this._tokens[c].type==pf.tokens.paren_right)&&">"!=d)return this._addToken(b),!0}if(">"==a&&(">"==d||"="==d)){let a=!1,c=this._tokens.length-1;for(let b=0;b<5&&c>=0&&-1===pf.assignment_operators.indexOf(this._tokens[c].type);++b,--c)if(this._tokens[c].type===pf.tokens.less_than){c>0&&this._tokens[c-1].isArrayOrTemplateType()&&(a=!0);break}if(a)return this._addToken(b),!0}if(b===pf.none){let d=a,e=0;for(let a=0;a<2;++a)if(d+=this._peekAhead(a),(b=this._findType(d))!==pf.none){e=a;break}if(b===pf.none)return c!==pf.none&&(this._current--,this._addToken(c),!0);a=d,this._current+=e+1}if(c=b,this._isAtEnd())break;a+=this._advance()}return c!==pf.none&&(this._addToken(c),!0)}_findType(a){for(let b in pf.regexTokens){let c=pf.regexTokens[b];if(this._match(a,c.rule))return c}return pf.literalTokens[a]||pf.none}_match(a,b){let c=b.exec(a);return c&&0==c.index&&c[0]==a}_isAtEnd(){return this._current>=this._source.length}_isAlpha(a){return!this._isNumeric(a)&&!this._isWhitespace(a)&&"_"!==a&&"."!==a&&"("!==a&&")"!==a&&"["!==a&&"]"!==a&&"{"!==a&&"}"!==a&&","!==a&&";"!==a&&":"!==a&&"="!==a&&"!"!==a&&"<"!==a&&">"!==a&&"+"!==a&&"-"!==a&&"*"!==a&&"/"!==a&&"%"!==a&&"&"!==a&&"|"!==a&&"^"!==a&&"~"!==a&&"@"!==a&&"#"!==a&&"?"!==a&&"'"!==a&&"`"!==a&&'"'!==a&&"\\"!==a&&"\n"!==a&&"\r"!==a&&"	"!==a&&"\0"!==a}_isNumeric(a){return a>="0"&&a<="9"}_isAlphaNumeric(a){return this._isAlpha(a)||this._isNumeric(a)||"_"===a}_isWhitespace(a){return" "==a||"	"==a||"\r"==a}_advance(a=0){let b=this._source[this._current];return a=a||0,a++,this._current+=a,b}_peekAhead(a=0){return a=a||0,this._current+a>=this._source.length?"\0":this._source[this._current+a]}_addToken(a){let b=this._source.substring(this._start,this._current);this._tokens.push(new pg(a,b,this._line,this._start,this._current))}}function pi(a){return Array.isArray(a)||(null==a?void 0:a.buffer)instanceof ArrayBuffer}let pj=new Float32Array(1),pk=new Uint32Array(pj.buffer),pl=new Uint32Array(pj.buffer),pm=new Int32Array(1),pn=new Float32Array(pm.buffer),po=new Uint32Array(pm.buffer),pp=new Uint32Array(1),pq=new Float32Array(pp.buffer),pr=new Int32Array(pp.buffer);function ps(a,b,c){if(b===c)return a;if("f32"===b){if("i32"===c||"x32"===c)return pj[0]=a,pk[0];if("u32"===c)return pj[0]=a,pl[0]}else if("i32"===b||"x32"===b){if("f32"===c)return pm[0]=a,pn[0];if("u32"===c)return pm[0]=a,po[0]}else if("u32"===b){if("f32"===c)return pp[0]=a,pq[0];if("i32"===c||"x32"===c)return pp[0]=a,pr[0]}return console.error(`Unsupported cast from ${b} to ${c}`),a}class pt{constructor(a){this.resources=null,this.inUse=!1,this.info=null,this.node=a}}class pu{constructor(a,b){this.align=a,this.size=b}}class pv{constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new n5,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(a){return"texture_storage_1d"==a.name||"texture_storage_2d"==a.name||"texture_storage_2d_array"==a.name||"texture_storage_3d"==a.name}updateAST(a){for(let b of a)b instanceof ok&&this._functions.set(b.name,new pt(b));for(let b of a)if(b instanceof oJ){let a=this.getTypeInfo(b,null);a instanceof nW&&this.structs.push(a)}for(let b of a)if(b instanceof oD)this.aliases.push(this._getAliasInfo(b));else{if(b instanceof oq){let a=this._getAttributeNum(b.attributes,"id",0),c=null!=b.type?this.getTypeInfo(b.type,b.attributes):null;this.overrides.push(new n2(b.name,c,b.attributes,a));continue}if(this._isUniformVar(b)){let a=this._getAttributeNum(b.attributes,"group",0),c=this._getAttributeNum(b.attributes,"binding",0),d=this.getTypeInfo(b.type,b.attributes),e=new n$(b.name,d,a,c,b.attributes,x$.Uniform,b.access);e.access||(e.access="read"),this.uniforms.push(e);continue}if(this._isStorageVar(b)){let a=this._getAttributeNum(b.attributes,"group",0),c=this._getAttributeNum(b.attributes,"binding",0),d=this.getTypeInfo(b.type,b.attributes),e=this._isStorageTexture(d),f=new n$(b.name,d,a,c,b.attributes,e?x$.StorageTexture:x$.Storage,b.access);f.access||(f.access="read"),this.storage.push(f);continue}if(this._isTextureVar(b)){let a=this._getAttributeNum(b.attributes,"group",0),c=this._getAttributeNum(b.attributes,"binding",0),d=this.getTypeInfo(b.type,b.attributes),e=this._isStorageTexture(d),f=new n$(b.name,d,a,c,b.attributes,e?x$.StorageTexture:x$.Texture,b.access);f.access||(f.access="read"),e?this.storage.push(f):this.textures.push(f);continue}if(this._isSamplerVar(b)){let a=this._getAttributeNum(b.attributes,"group",0),c=this._getAttributeNum(b.attributes,"binding",0),d=this.getTypeInfo(b.type,b.attributes),e=new n$(b.name,d,a,c,b.attributes,x$.Sampler,b.access);this.samplers.push(e);continue}}for(let b of a)if(b instanceof ok){let a=this._getAttribute(b,"vertex"),c=this._getAttribute(b,"fragment"),d=this._getAttribute(b,"compute"),e=a||c||d,f=new n4(b.name,null==e?void 0:e.name,b.attributes);f.attributes=b.attributes,f.startLine=b.startLine,f.endLine=b.endLine,this.functions.push(f),this._functions.get(b.name).info=f,e&&(this._functions.get(b.name).inUse=!0,f.inUse=!0,f.resources=this._findResources(b,!!e),f.inputs=this._getInputs(b.args),f.outputs=this._getOutputs(b.returnType),this.entry[e.name].push(f)),f.arguments=b.args.map(a=>new n3(a.name,this.getTypeInfo(a.type,a.attributes),a.attributes)),f.returnType=b.returnType?this.getTypeInfo(b.returnType,b.attributes):null;continue}for(let a of this._functions.values())a.info&&(a.info.inUse=a.inUse,this._addCalls(a.node,a.info.calls));for(let a of this._functions.values())a.node.search(b=>{var c,d,e;if(b instanceof o5){if(b.value)if(pi(b.value))for(let d of b.value)for(let b of this.overrides)d===b.name&&(null==(c=a.info)||c.overrides.push(b));else for(let c of this.overrides)b.value===c.name&&(null==(d=a.info)||d.overrides.push(c))}else if(b instanceof oS)for(let c of this.overrides)b.name===c.name&&(null==(e=a.info)||e.overrides.push(c))});for(let a of this.uniforms)this._markStructsInUse(a.type);for(let a of this.storage)this._markStructsInUse(a.type)}getFunctionInfo(a){for(let b of this.functions)if(b.name==a)return b;return null}getStructInfo(a){for(let b of this.structs)if(b.name==a)return b;return null}getOverrideInfo(a){for(let b of this.overrides)if(b.name==a)return b;return null}_markStructsInUse(a){if(a)if(a.isStruct){if(a.inUse=!0,a.members)for(let b of a.members)this._markStructsInUse(b.type)}else if(a.isArray)this._markStructsInUse(a.format);else if(a.isTemplate)a.format&&this._markStructsInUse(a.format);else{let b=this._getAlias(a.name);b&&this._markStructsInUse(b)}}_addCalls(a,b){var c;for(let d of a.calls){let a=null==(c=this._functions.get(d.name))?void 0:c.info;a&&b.add(a)}}findResource(a,b,c){if(c){for(let d of this.entry.compute)if(d.name===c){for(let c of d.resources)if(c.group==a&&c.binding==b)return c}for(let d of this.entry.vertex)if(d.name===c){for(let c of d.resources)if(c.group==a&&c.binding==b)return c}for(let d of this.entry.fragment)if(d.name===c){for(let c of d.resources)if(c.group==a&&c.binding==b)return c}}for(let c of this.uniforms)if(c.group==a&&c.binding==b)return c;for(let c of this.storage)if(c.group==a&&c.binding==b)return c;for(let c of this.textures)if(c.group==a&&c.binding==b)return c;for(let c of this.samplers)if(c.group==a&&c.binding==b)return c;return null}_findResource(a){for(let b of this.uniforms)if(b.name==a)return b;for(let b of this.storage)if(b.name==a)return b;for(let b of this.textures)if(b.name==a)return b;for(let b of this.samplers)if(b.name==a)return b;return null}_markStructsFromAST(a){let b=this.getTypeInfo(a,null);this._markStructsInUse(b)}_findResources(a,b){let c=[],d=this,e=[];return a.search(f=>{if(f instanceof og)e.push({});else if(f instanceof oh)e.pop();else if(f instanceof op)b&&null!==f.type&&this._markStructsFromAST(f.type),e.length>0&&(e[e.length-1][f.name]=f);else if(f instanceof oQ)b&&null!==f.type&&this._markStructsFromAST(f.type);else if(f instanceof or)b&&null!==f.type&&this._markStructsFromAST(f.type),e.length>0&&(e[e.length-1][f.name]=f);else if(f instanceof oS){if(e.length>0&&e[e.length-1][f.name])return;let a=d._findResource(f.name);a&&c.push(a)}else if(f instanceof oR){let e=d._functions.get(f.name);e&&(b&&(e.inUse=!0),a.calls.add(e.node),null===e.resources&&(e.resources=d._findResources(e.node,b)),c.push(...e.resources))}else if(f instanceof ov){let e=d._functions.get(f.name);e&&(b&&(e.inUse=!0),a.calls.add(e.node),null===e.resources&&(e.resources=d._findResources(e.node,b)),c.push(...e.resources))}}),[...new Map(c.map(a=>[a.name,a])).values()]}getBindGroups(){let a=[];function b(b,c){b>=a.length&&(a.length=b+1),void 0===a[b]&&(a[b]=[]),c>=a[b].length&&(a[b].length=c+1)}for(let c of this.uniforms)b(c.group,c.binding),a[c.group][c.binding]=c;for(let c of this.storage)b(c.group,c.binding),a[c.group][c.binding]=c;for(let c of this.textures)b(c.group,c.binding),a[c.group][c.binding]=c;for(let c of this.samplers)b(c.group,c.binding),a[c.group][c.binding]=c;return a}_getOutputs(a,b){if(void 0===b&&(b=[]),a instanceof oJ)this._getStructOutputs(a,b);else{let c=this._getOutputInfo(a);null!==c&&b.push(c)}return b}_getStructOutputs(a,b){for(let c of a.members)if(c.type instanceof oJ)this._getStructOutputs(c.type,b);else{let a=this._getAttribute(c,"location")||this._getAttribute(c,"builtin");if(null!==a){let d=this.getTypeInfo(c.type,c.type.attributes),e=this._parseInt(a.value),f=new n1(c.name,d,a.name,e);b.push(f)}}}_getOutputInfo(a){let b=this._getAttribute(a,"location")||this._getAttribute(a,"builtin");if(null!==b){let c=this.getTypeInfo(a,a.attributes),d=this._parseInt(b.value);return new n1("",c,b.name,d)}return null}_getInputs(a,b){for(let c of(void 0===b&&(b=[]),a))if(c.type instanceof oJ)this._getStructInputs(c.type,b);else{let a=this._getInputInfo(c);null!==a&&b.push(a)}return b}_getStructInputs(a,b){for(let c of a.members)if(c.type instanceof oJ)this._getStructInputs(c.type,b);else{let a=this._getInputInfo(c);null!==a&&b.push(a)}}_getInputInfo(a){let b=this._getAttribute(a,"location")||this._getAttribute(a,"builtin");if(null!==b){let c=this._getAttribute(a,"interpolation"),d=this.getTypeInfo(a.type,a.attributes),e=this._parseInt(b.value),f=new n0(a.name,d,b.name,e);return null!==c&&(f.interpolation=this._parseString(c.value)),f}return null}_parseString(a){return a instanceof Array&&(a=a[0]),a}_parseInt(a){a instanceof Array&&(a=a[0]);let b=parseInt(a);return isNaN(b)?a:b}_getAlias(a){for(let b of this.aliases)if(b.name==a)return b.type;return null}_getAliasInfo(a){return new n_(a.name,this.getTypeInfo(a.type,null))}getTypeInfoByName(a){for(let b of this.structs)if(b.name==a)return b;for(let b of this.aliases)if(b.name==a)return b.type;return null}getTypeInfo(a,b=null){if(this._types.has(a))return this._types.get(a);if(a instanceof oL){let c=a.type?this.getTypeInfo(a.type,a.attributes):null,d=new nY(a.name,c,b);return this._types.set(a,d),this._updateTypeInfo(d),d}if(a instanceof oM){let c=a.format?this.getTypeInfo(a.format,a.attributes):null,d=new nX(a.name,b);return d.format=c,d.count=a.count,this._types.set(a,d),this._updateTypeInfo(d),d}if(a instanceof oJ){let c=new nW(a.name,b);for(let b of(c.startLine=a.startLine,c.endLine=a.endLine,a.members)){let a=this.getTypeInfo(b.type,b.attributes);c.members.push(new nV(b.name,a,b.attributes))}return this._types.set(a,c),this._updateTypeInfo(c),c}if(a instanceof oN){let c=a.format instanceof oH,d=a.format?c?this.getTypeInfo(a.format,null):new nU(a.format,null):null,e=new nZ(a.name,d,b,a.access);return this._types.set(a,e),this._updateTypeInfo(e),e}if(a instanceof oK){let c=a.format?this.getTypeInfo(a.format,null):null,d=new nZ(a.name,c,b,a.access);return this._types.set(a,d),this._updateTypeInfo(d),d}let c=new nU(a.name,b);return this._types.set(a,c),this._updateTypeInfo(c),c}_updateTypeInfo(a){var b,c,d;let e=this._getTypeSize(a);if(a.size=null!=(b=null==e?void 0:e.size)?b:0,a instanceof nX&&a.format){let b=this._getTypeSize(a.format);a.stride=Math.max(null!=(c=null==b?void 0:b.size)?c:0,null!=(d=null==b?void 0:b.align)?d:0),this._updateTypeInfo(a.format)}a instanceof nY&&this._updateTypeInfo(a.format),a instanceof nW&&this._updateStructInfo(a)}_updateStructInfo(a){let b=0,c=0,d=0,e=0;for(let f=0,g=a.members.length;f<g;++f){let g=a.members[f],h=this._getTypeSize(g);if(!h)continue;null!=this._getAlias(g.type.name)||g.type;let i=h.align,j=h.size;b=this._roundUp(i,b+c),c=j,d=b,e=Math.max(e,i),g.offset=b,g.size=j,this._updateTypeInfo(g.type)}a.size=this._roundUp(e,d+c),a.align=e}_getTypeSize(a){var b,c;if(null==a)return null;let d=this._getAttributeNum(a.attributes,"size",0),e=this._getAttributeNum(a.attributes,"align",0);if(a instanceof nV&&(a=a.type),a instanceof nU){let b=this._getAlias(a.name);null!==b&&(a=b)}{let c=pv._typeInfo[a.name];if(void 0!==c){let f="f16"===(null==(b=a.format)?void 0:b.name)?2:1;return new pu(Math.max(e,c.align/f),Math.max(d,c.size/f))}}{let b=pv._typeInfo[a.name.substring(0,a.name.length-1)];if(b){let c="h"===a.name[a.name.length-1]?2:1;return new pu(Math.max(e,b.align/c),Math.max(d,b.size/c))}}if(a instanceof nX){let b=a,f=8,g=8,h=this._getTypeSize(b.format);return null!==h&&(g=h.size,f=h.align),g=b.count*this._getAttributeNum(null!=(c=null==a?void 0:a.attributes)?c:null,"stride",this._roundUp(f,g)),d&&(g=d),new pu(Math.max(e,f),Math.max(d,g))}if(a instanceof nW){let b=0,c=0,f=0,g=0,h=0;for(let c of a.members){let a=this._getTypeSize(c.type);null!==a&&(b=Math.max(a.align,b),f=this._roundUp(a.align,f+g),g=a.size,h=f)}return c=this._roundUp(b,h+g),new pu(Math.max(e,b),Math.max(d,c))}return null}_isUniformVar(a){return a instanceof op&&"uniform"==a.storage}_isStorageVar(a){return a instanceof op&&"storage"==a.storage}_isTextureVar(a){return a instanceof op&&null!==a.type&&-1!=pv._textureTypes.indexOf(a.type.name)}_isSamplerVar(a){return a instanceof op&&null!==a.type&&-1!=pv._samplerTypes.indexOf(a.type.name)}_getAttribute(a,b){if(!a||!a.attributes)return null;for(let c of a.attributes)if(c.name==b)return c;return null}_getAttributeNum(a,b,c){if(null===a)return c;for(let d of a)if(d.name==b){let a=null!==d&&null!==d.value?d.value:c;return a instanceof Array&&(a=a[0]),"number"==typeof a?a:"string"==typeof a?parseInt(a):c}return c}_roundUp(a,b){return Math.ceil(b/a)*a}}pv._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},pv._textureTypes=pf.any_texture_type.map(a=>a.name),pv._samplerTypes=pf.sampler_type.map(a=>a.name);let pw=0;class px{constructor(a,b,c){this.id=pw++,this.name=a,this.value=b,this.node=c}clone(){return new px(this.name,this.value,this.node)}}class py{constructor(a){this.id=pw++,this.name=a.name,this.node=a}clone(){return new py(this.node)}}class pz{constructor(a){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",this.id=pw++,a&&(this.parent=a,this.currentFunctionName=a.currentFunctionName)}getVariable(a){var b;return this.variables.has(a)?null!=(b=this.variables.get(a))?b:null:this.parent?this.parent.getVariable(a):null}getFunction(a){var b;return this.functions.has(a)?null!=(b=this.functions.get(a))?b:null:this.parent?this.parent.getFunction(a):null}createVariable(a,b,c){this.variables.set(a,new px(a,b,null!=c?c:null))}setVariable(a,b,c){let d=this.getVariable(a);null!==d?d.value=b:this.createVariable(a,b,c)}getVariableValue(a){var b;let c=this.getVariable(a);return null!=(b=null==c?void 0:c.value)?b:null}clone(){return new pz(this)}}class pA{evalExpression(a,b){return null}getTypeInfo(a){return null}getVariableName(a,b){return""}}class pB{constructor(a){this.exec=a}getTypeInfo(a){return this.exec.getTypeInfo(a)}All(a,b){let c=this.exec.evalExpression(a.args[0],b),d=!0;if(c instanceof pa)return c.data.forEach(a=>{a||(d=!1)}),new o9(+!!d,this.getTypeInfo("bool"));throw Error(`All() expects a vector argument. Line ${a.line}`)}Any(a,b){let c=this.exec.evalExpression(a.args[0],b);if(c instanceof pa)return new o9(+!!c.data.some(a=>a),this.getTypeInfo("bool"));throw Error(`Any() expects a vector argument. Line ${a.line}`)}Select(a,b){let c=this.exec.evalExpression(a.args[2],b);if(!(c instanceof o9))throw Error(`Select() expects a bool condition. Line ${a.line}`);return c.value?this.exec.evalExpression(a.args[1],b):this.exec.evalExpression(a.args[0],b)}ArrayLength(a,b){let c=a.args[0];c instanceof oY&&(c=c.right);let d=this.exec.evalExpression(c,b);if(d instanceof pc&&0===d.typeInfo.size){let a=d.typeInfo;return new o9(d.buffer.byteLength/a.stride,this.getTypeInfo("u32"))}return new o9(d.typeInfo.size,this.getTypeInfo("u32"))}Abs(a,b){let c=this.exec.evalExpression(a.args[0],b);return c instanceof pa?new pa(c.data.map(a=>Math.abs(a)),c.typeInfo):new o9(Math.abs(c.value),c.typeInfo)}Acos(a,b){let c=this.exec.evalExpression(a.args[0],b);return c instanceof pa?new pa(c.data.map(a=>Math.acos(a)),c.typeInfo):new o9(Math.acos(c.value),c.typeInfo)}Acosh(a,b){let c=this.exec.evalExpression(a.args[0],b);return c instanceof pa?new pa(c.data.map(a=>Math.acosh(a)),c.typeInfo):new o9(Math.acosh(c.value),c.typeInfo)}Asin(a,b){let c=this.exec.evalExpression(a.args[0],b);return c instanceof pa?new pa(c.data.map(a=>Math.asin(a)),c.typeInfo):new o9(Math.asin(c.value),c.typeInfo)}Asinh(a,b){let c=this.exec.evalExpression(a.args[0],b);return c instanceof pa?new pa(c.data.map(a=>Math.asinh(a)),c.typeInfo):new o9(Math.asinh(c.value),c.typeInfo)}Atan(a,b){let c=this.exec.evalExpression(a.args[0],b);return c instanceof pa?new pa(c.data.map(a=>Math.atan(a)),c.typeInfo):new o9(Math.atan(c.value),c.typeInfo)}Atanh(a,b){let c=this.exec.evalExpression(a.args[0],b);return c instanceof pa?new pa(c.data.map(a=>Math.atanh(a)),c.typeInfo):new o9(Math.atanh(c.value),c.typeInfo)}Atan2(a,b){let c=this.exec.evalExpression(a.args[0],b),d=this.exec.evalExpression(a.args[1],b);return c instanceof pa&&d instanceof pa?new pa(c.data.map((a,b)=>Math.atan2(a,d.data[b])),c.typeInfo):new o9(Math.atan2(c.value,d.value),c.typeInfo)}Ceil(a,b){let c=this.exec.evalExpression(a.args[0],b);return c instanceof pa?new pa(c.data.map(a=>Math.ceil(a)),c.typeInfo):new o9(Math.ceil(c.value),c.typeInfo)}_clamp(a,b,c){return Math.min(Math.max(a,b),c)}Clamp(a,b){let c=this.exec.evalExpression(a.args[0],b),d=this.exec.evalExpression(a.args[1],b),e=this.exec.evalExpression(a.args[2],b);return c instanceof pa&&d instanceof pa&&e instanceof pa?new pa(c.data.map((a,b)=>this._clamp(a,d.data[b],e.data[b])),c.typeInfo):new o9(this._clamp(c.value,d.value,e.value),c.typeInfo)}Cos(a,b){let c=this.exec.evalExpression(a.args[0],b);return c instanceof pa?new pa(c.data.map(a=>Math.cos(a)),c.typeInfo):new o9(Math.cos(c.value),c.typeInfo)}Cosh(a,b){let c=this.exec.evalExpression(a.args[0],b);return c instanceof pa?new pa(c.data.map(a=>Math.cosh(a)),c.typeInfo):new o9(Math.cos(c.value),c.typeInfo)}CountLeadingZeros(a,b){let c=this.exec.evalExpression(a.args[0],b);return c instanceof pa?new pa(c.data.map(a=>Math.clz32(a)),c.typeInfo):new o9(Math.clz32(c.value),c.typeInfo)}_countOneBits(a){let b=0;for(;0!==a;)1&a&&b++,a>>=1;return b}CountOneBits(a,b){let c=this.exec.evalExpression(a.args[0],b);return c instanceof pa?new pa(c.data.map(a=>this._countOneBits(a)),c.typeInfo):new o9(this._countOneBits(c.value),c.typeInfo)}_countTrailingZeros(a){if(0===a)return 32;let b=0;for(;!(1&a);)a>>=1,b++;return b}CountTrailingZeros(a,b){let c=this.exec.evalExpression(a.args[0],b);return c instanceof pa?new pa(c.data.map(a=>this._countTrailingZeros(a)),c.typeInfo):new o9(this._countTrailingZeros(c.value),c.typeInfo)}Cross(a,b){let c=this.exec.evalExpression(a.args[0],b),d=this.exec.evalExpression(a.args[1],b);if(c instanceof pa&&d instanceof pa){if(3!==c.data.length||3!==d.data.length)return console.error(`Cross() expects 3D vectors. Line ${a.line}`),null;let b=c.data,e=d.data;return new pa([b[1]*e[2]-e[1]*b[2],b[2]*e[0]-e[2]*b[0],b[0]*e[1]-e[0]*b[1]],c.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${a.line}`),null}Degrees(a,b){let c=this.exec.evalExpression(a.args[0],b),d=180/Math.PI;return c instanceof pa?new pa(c.data.map(a=>a*d),c.typeInfo):new o9(c.value*d,this.getTypeInfo("f32"))}Determinant(a,b){let c=this.exec.evalExpression(a.args[0],b);if(c instanceof pb){let a=c.data,b=c.typeInfo.getTypeName(),d=b.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if("mat2x2"===b||"mat2x2f"===b||"mat2x2h"===b)return new o9(a[0]*a[3]-a[1]*a[2],d);if("mat2x3"===b||"mat2x3f"===b||"mat2x3h"===b)return new o9(a[0]*(a[4]*a[8]-a[5]*a[7])-a[1]*(a[3]*a[8]-a[5]*a[6])+a[2]*(a[3]*a[7]-a[4]*a[6]),d);if("mat2x4"===b||"mat2x4f"===b||"mat2x4h"===b)console.error(`TODO: Determinant for ${b}`);else if("mat3x2"===b||"mat3x2f"===b||"mat3x2h"===b)console.error(`TODO: Determinant for ${b}`);else{if("mat3x3"===b||"mat3x3f"===b||"mat3x3h"===b)return new o9(a[0]*(a[4]*a[8]-a[5]*a[7])-a[1]*(a[3]*a[8]-a[5]*a[6])+a[2]*(a[3]*a[7]-a[4]*a[6]),d);"mat3x4"===b||"mat3x4f"===b||"mat3x4h"===b||"mat4x2"===b||"mat4x2f"===b||"mat4x2h"===b||"mat4x3"===b||"mat4x3f"===b||"mat4x3h"===b?console.error(`TODO: Determinant for ${b}`):"mat4x4"!==b&&"mat4x4f"!==b&&"mat4x4h"!==b||console.error(`TODO: Determinant for ${b}`)}}return console.error(`Determinant expects a matrix argument. Line ${a.line}`),null}Distance(a,b){let c=this.exec.evalExpression(a.args[0],b),d=this.exec.evalExpression(a.args[1],b);if(c instanceof pa&&d instanceof pa){let a=0;for(let b=0;b<c.data.length;++b)a+=(c.data[b]-d.data[b])*(c.data[b]-d.data[b]);return new o9(Math.sqrt(a),this.getTypeInfo("f32"))}return new o9(Math.abs(c.value-d.value),c.typeInfo)}_dot(a,b){let c=0;for(let d=0;d<a.length;++d)c+=b[d]*a[d];return c}Dot(a,b){let c=this.exec.evalExpression(a.args[0],b),d=this.exec.evalExpression(a.args[1],b);return c instanceof pa&&d instanceof pa?new o9(this._dot(c.data,d.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${a.line}`),null)}Dot4U8Packed(a,b){return console.error(`TODO: dot4U8Packed. Line ${a.line}`),null}Dot4I8Packed(a,b){return console.error(`TODO: dot4I8Packed. Line ${a.line}`),null}Exp(a,b){let c=this.exec.evalExpression(a.args[0],b);return c instanceof pa?new pa(c.data.map(a=>Math.exp(a)),c.typeInfo):new o9(Math.exp(c.value),c.typeInfo)}Exp2(a,b){let c=this.exec.evalExpression(a.args[0],b);return c instanceof pa?new pa(c.data.map(a=>Math.pow(2,a)),c.typeInfo):new o9(Math.pow(2,c.value),c.typeInfo)}ExtractBits(a,b){let c=this.exec.evalExpression(a.args[0],b),d=this.exec.evalExpression(a.args[1],b),e=this.exec.evalExpression(a.args[2],b);if("u32"!==d.typeInfo.name&&"x32"!==d.typeInfo.name)return console.error(`ExtractBits() expects an i32 offset argument. Line ${a.line}`),null;if("u32"!==e.typeInfo.name&&"x32"!==e.typeInfo.name)return console.error(`ExtractBits() expects an i32 count argument. Line ${a.line}`),null;let f=d.value,g=e.value;return c instanceof pa?new pa(c.data.map(a=>a>>f&(1<<g)-1),c.typeInfo):"i32"!==c.typeInfo.name&&"x32"!==c.typeInfo.name?(console.error(`ExtractBits() expects an i32 argument. Line ${a.line}`),null):new o9(c.value>>f&(1<<g)-1,this.getTypeInfo("i32"))}FaceForward(a,b){let c=this.exec.evalExpression(a.args[0],b),d=this.exec.evalExpression(a.args[1],b),e=this.exec.evalExpression(a.args[2],b);return c instanceof pa&&d instanceof pa&&e instanceof pa?new pa(0>this._dot(d.data,e.data)?Array.from(c.data):c.data.map(a=>-a),c.typeInfo):(console.error(`FaceForward() expects vector arguments. Line ${a.line}`),null)}_firstLeadingBit(a){return 0===a?-1:31-Math.clz32(a)}FirstLeadingBit(a,b){let c=this.exec.evalExpression(a.args[0],b);return c instanceof pa?new pa(c.data.map(a=>this._firstLeadingBit(a)),c.typeInfo):new o9(this._firstLeadingBit(c.value),c.typeInfo)}_firstTrailingBit(a){return 0===a?-1:Math.log2(a&-a)}FirstTrailingBit(a,b){let c=this.exec.evalExpression(a.args[0],b);return c instanceof pa?new pa(c.data.map(a=>this._firstTrailingBit(a)),c.typeInfo):new o9(this._firstTrailingBit(c.value),c.typeInfo)}Floor(a,b){let c=this.exec.evalExpression(a.args[0],b);return c instanceof pa?new pa(c.data.map(a=>Math.floor(a)),c.typeInfo):new o9(Math.floor(c.value),c.typeInfo)}Fma(a,b){let c=this.exec.evalExpression(a.args[0],b),d=this.exec.evalExpression(a.args[1],b),e=this.exec.evalExpression(a.args[2],b);return c instanceof pa&&d instanceof pa&&e instanceof pa?c.data.length!==d.data.length||c.data.length!==e.data.length?(console.error(`Fma() expects vectors of the same length. Line ${a.line}`),null):new pa(c.data.map((a,b)=>a*d.data[b]+e.data[b]),c.typeInfo):new o9(c.value*d.value+e.value,c.typeInfo)}Fract(a,b){let c=this.exec.evalExpression(a.args[0],b);return c instanceof pa?new pa(c.data.map(a=>a-Math.floor(a)),c.typeInfo):new o9(c.value-Math.floor(c.value),c.typeInfo)}Frexp(a,b){return console.error(`TODO: frexp. Line ${a.line}`),null}InsertBits(a,b){let c=this.exec.evalExpression(a.args[0],b),d=this.exec.evalExpression(a.args[1],b),e=this.exec.evalExpression(a.args[2],b),f=this.exec.evalExpression(a.args[3],b);if("u32"!==e.typeInfo.name&&"x32"!==e.typeInfo.name)return console.error(`InsertBits() expects an i32 offset argument. Line ${a.line}`),null;let g=e.value,h=(1<<f.value)-1<<g,i=~h;return c instanceof pa&&d instanceof pa?new pa(c.data.map((a,b)=>a&i|d.data[b]<<g&h),c.typeInfo):new o9(c.value&i|d.value<<g&h,c.typeInfo)}InverseSqrt(a,b){let c=this.exec.evalExpression(a.args[0],b);return c instanceof pa?new pa(c.data.map(a=>1/Math.sqrt(a)),c.typeInfo):new o9(1/Math.sqrt(c.value),c.typeInfo)}Ldexp(a,b){return console.error(`TODO: ldexp. Line ${a.line}`),null}Length(a,b){let c=this.exec.evalExpression(a.args[0],b);if(c instanceof pa){let a=0;return c.data.forEach(b=>{a+=b*b}),new o9(Math.sqrt(a),this.getTypeInfo("f32"))}return new o9(Math.abs(c.value),c.typeInfo)}Log(a,b){let c=this.exec.evalExpression(a.args[0],b);return c instanceof pa?new pa(c.data.map(a=>Math.log(a)),c.typeInfo):new o9(Math.log(c.value),c.typeInfo)}Log2(a,b){let c=this.exec.evalExpression(a.args[0],b);return c instanceof pa?new pa(c.data.map(a=>Math.log2(a)),c.typeInfo):new o9(Math.log2(c.value),c.typeInfo)}Max(a,b){let c=this.exec.evalExpression(a.args[0],b),d=this.exec.evalExpression(a.args[1],b);return c instanceof pa&&d instanceof pa?new pa(c.data.map((a,b)=>Math.max(a,d.data[b])),c.typeInfo):new o9(Math.max(c.value,d.value),c.typeInfo)}Min(a,b){let c=this.exec.evalExpression(a.args[0],b),d=this.exec.evalExpression(a.args[1],b);return c instanceof pa&&d instanceof pa?new pa(c.data.map((a,b)=>Math.min(a,d.data[b])),c.typeInfo):new o9(Math.min(c.value,d.value),c.typeInfo)}Mix(a,b){let c=this.exec.evalExpression(a.args[0],b),d=this.exec.evalExpression(a.args[1],b),e=this.exec.evalExpression(a.args[2],b);return c instanceof pa&&d instanceof pa&&e instanceof pa?new pa(c.data.map((a,b)=>c.data[b]*(1-e.data[b])+d.data[b]*e.data[b]),c.typeInfo):new o9(c.value*(1-e.value)+d.value*e.value,c.typeInfo)}Modf(a,b){let c=this.exec.evalExpression(a.args[0],b),d=this.exec.evalExpression(a.args[1],b);return c instanceof pa&&d instanceof pa?new pa(c.data.map((a,b)=>a%d.data[b]),c.typeInfo):new o9(c.value%d.value,c.typeInfo)}Normalize(a,b){let c=this.exec.evalExpression(a.args[0],b);if(c instanceof pa){let d=this.Length(a,b).value;return new pa(c.data.map(a=>a/d),c.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${a.line}`),null}Pow(a,b){let c=this.exec.evalExpression(a.args[0],b),d=this.exec.evalExpression(a.args[1],b);return c instanceof pa&&d instanceof pa?new pa(c.data.map((a,b)=>Math.pow(a,d.data[b])),c.typeInfo):new o9(Math.pow(c.value,d.value),c.typeInfo)}QuantizeToF16(a,b){let c=this.exec.evalExpression(a.args[0],b);return c instanceof pa?new pa(c.data.map(a=>a),c.typeInfo):new o9(c.value,c.typeInfo)}Radians(a,b){let c=this.exec.evalExpression(a.args[0],b);return c instanceof pa?new pa(c.data.map(a=>a*Math.PI/180),c.typeInfo):new o9(c.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(a,b){let c=this.exec.evalExpression(a.args[0],b),d=this.exec.evalExpression(a.args[1],b);if(c instanceof pa&&d instanceof pa){let a=this._dot(c.data,d.data);return new pa(c.data.map((b,c)=>b-2*a*d.data[c]),c.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${a.line}`),null}Refract(a,b){let c=this.exec.evalExpression(a.args[0],b),d=this.exec.evalExpression(a.args[1],b),e=this.exec.evalExpression(a.args[2],b);if(c instanceof pa&&d instanceof pa&&e instanceof o9){let a=this._dot(d.data,c.data);return new pa(c.data.map((b,c)=>{let f=1-e.value*e.value*(1-a*a);if(f<0)return 0;let g=Math.sqrt(f);return e.value*b-(e.value*a+g)*d.data[c]}),c.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${a.line}`),null}ReverseBits(a,b){return console.error(`TODO: reverseBits. Line ${a.line}`),null}Round(a,b){let c=this.exec.evalExpression(a.args[0],b);return c instanceof pa?new pa(c.data.map(a=>Math.round(a)),c.typeInfo):new o9(Math.round(c.value),c.typeInfo)}Saturate(a,b){let c=this.exec.evalExpression(a.args[0],b);return c instanceof pa?new pa(c.data.map(a=>Math.min(Math.max(a,0),1)),c.typeInfo):new o9(Math.min(Math.max(c.value,0),1),c.typeInfo)}Sign(a,b){let c=this.exec.evalExpression(a.args[0],b);return c instanceof pa?new pa(c.data.map(a=>Math.sign(a)),c.typeInfo):new o9(Math.sign(c.value),c.typeInfo)}Sin(a,b){let c=this.exec.evalExpression(a.args[0],b);return c instanceof pa?new pa(c.data.map(a=>Math.sin(a)),c.typeInfo):new o9(Math.sin(c.value),c.typeInfo)}Sinh(a,b){let c=this.exec.evalExpression(a.args[0],b);return c instanceof pa?new pa(c.data.map(a=>Math.sinh(a)),c.typeInfo):new o9(Math.sinh(c.value),c.typeInfo)}_smoothstep(a,b,c){let d=Math.min(Math.max((c-a)/(b-a),0),1);return d*d*(3-2*d)}SmoothStep(a,b){let c=this.exec.evalExpression(a.args[0],b),d=this.exec.evalExpression(a.args[1],b),e=this.exec.evalExpression(a.args[2],b);return e instanceof pa&&c instanceof pa&&d instanceof pa?new pa(e.data.map((a,b)=>this._smoothstep(c.data[b],d.data[b],a)),e.typeInfo):new o9(this._smoothstep(c.value,d.value,e.value),e.typeInfo)}Sqrt(a,b){let c=this.exec.evalExpression(a.args[0],b);return c instanceof pa?new pa(c.data.map(a=>Math.sqrt(a)),c.typeInfo):new o9(Math.sqrt(c.value),c.typeInfo)}Step(a,b){let c=this.exec.evalExpression(a.args[0],b),d=this.exec.evalExpression(a.args[1],b);return d instanceof pa&&c instanceof pa?new pa(d.data.map((a,b)=>a<c.data[b]?0:1),d.typeInfo):new o9(d.value<c.value?0:1,c.typeInfo)}Tan(a,b){let c=this.exec.evalExpression(a.args[0],b);return c instanceof pa?new pa(c.data.map(a=>Math.tan(a)),c.typeInfo):new o9(Math.tan(c.value),c.typeInfo)}Tanh(a,b){let c=this.exec.evalExpression(a.args[0],b);return c instanceof pa?new pa(c.data.map(a=>Math.tanh(a)),c.typeInfo):new o9(Math.tanh(c.value),c.typeInfo)}_getTransposeType(a){let b=a.getTypeName();return"mat2x2f"===b||"mat2x2h"===b?a:"mat2x3f"===b?this.getTypeInfo("mat3x2f"):"mat2x3h"===b?this.getTypeInfo("mat3x2h"):"mat2x4f"===b?this.getTypeInfo("mat4x2f"):"mat2x4h"===b?this.getTypeInfo("mat4x2h"):"mat3x2f"===b?this.getTypeInfo("mat2x3f"):"mat3x2h"===b?this.getTypeInfo("mat2x3h"):"mat3x3f"===b||"mat3x3h"===b?a:"mat3x4f"===b?this.getTypeInfo("mat4x3f"):"mat3x4h"===b?this.getTypeInfo("mat4x3h"):"mat4x2f"===b?this.getTypeInfo("mat2x4f"):"mat4x2h"===b?this.getTypeInfo("mat2x4h"):"mat4x3f"===b?this.getTypeInfo("mat3x4f"):"mat4x3h"===b?this.getTypeInfo("mat3x4h"):("mat4x4f"===b||"mat4x4h"===b||console.error(`Invalid matrix type ${b}`),a)}Transpose(a,b){let c=this.exec.evalExpression(a.args[0],b);if(!(c instanceof pb))return console.error(`Transpose() expects a matrix argument. Line ${a.line}`),null;let d=this._getTransposeType(c.typeInfo);if("mat2x2"===c.typeInfo.name||"mat2x2f"===c.typeInfo.name||"mat2x2h"===c.typeInfo.name){let a=c.data;return new pb([a[0],a[2],a[1],a[3]],d)}if("mat2x3"===c.typeInfo.name||"mat2x3f"===c.typeInfo.name||"mat2x3h"===c.typeInfo.name){let a=c.data;return new pb([a[0],a[3],a[6],a[1],a[4],a[7]],d)}if("mat2x4"===c.typeInfo.name||"mat2x4f"===c.typeInfo.name||"mat2x4h"===c.typeInfo.name){let a=c.data;return new pb([a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13]],d)}if("mat3x2"===c.typeInfo.name||"mat3x2f"===c.typeInfo.name||"mat3x2h"===c.typeInfo.name){let a=c.data;return new pb([a[0],a[3],a[1],a[4],a[2],a[5]],d)}if("mat3x3"===c.typeInfo.name||"mat3x3f"===c.typeInfo.name||"mat3x3h"===c.typeInfo.name){let a=c.data;return new pb([a[0],a[3],a[6],a[1],a[4],a[7],a[2],a[5],a[8]],d)}if("mat3x4"===c.typeInfo.name||"mat3x4f"===c.typeInfo.name||"mat3x4h"===c.typeInfo.name){let a=c.data;return new pb([a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14]],d)}if("mat4x2"===c.typeInfo.name||"mat4x2f"===c.typeInfo.name||"mat4x2h"===c.typeInfo.name){let a=c.data;return new pb([a[0],a[4],a[1],a[5],a[2],a[6]],d)}if("mat4x3"===c.typeInfo.name||"mat4x3f"===c.typeInfo.name||"mat4x3h"===c.typeInfo.name){let a=c.data;return new pb([a[0],a[4],a[8],a[1],a[5],a[9],a[2],a[6],a[10]],d)}if("mat4x4"===c.typeInfo.name||"mat4x4f"===c.typeInfo.name||"mat4x4h"===c.typeInfo.name){let a=c.data;return new pb([a[0],a[4],a[8],a[12],a[1],a[5],a[9],a[13],a[2],a[6],a[10],a[14],a[3],a[7],a[11],a[15]],d)}return console.error(`Invalid matrix type ${c.typeInfo.name}`),null}Trunc(a,b){let c=this.exec.evalExpression(a.args[0],b);return c instanceof pa?new pa(c.data.map(a=>Math.trunc(a)),c.typeInfo):new o9(Math.trunc(c.value),c.typeInfo)}Dpdx(a,b){return console.error(`TODO: dpdx. Line ${a.line}`),null}DpdxCoarse(a,b){return console.error(`TODO: dpdxCoarse. Line ${a.line}`),null}DpdxFine(a,b){return console.error("TODO: dpdxFine"),null}Dpdy(a,b){return console.error("TODO: dpdy"),null}DpdyCoarse(a,b){return console.error("TODO: dpdyCoarse"),null}DpdyFine(a,b){return console.error("TODO: dpdyFine"),null}Fwidth(a,b){return console.error("TODO: fwidth"),null}FwidthCoarse(a,b){return console.error("TODO: fwidthCoarse"),null}FwidthFine(a,b){return console.error("TODO: fwidthFine"),null}TextureDimensions(a,b){let c=a.args[0],d=a.args.length>1?this.exec.evalExpression(a.args[1],b).value:0;if(c instanceof oS){let e=c.name,f=b.getVariableValue(e);if(f instanceof pd){if(d<0||d>=f.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${a.line}`),null;let b=f.getMipLevelSize(d),c=f.dimension;return"1d"===c?new o9(b[0],this.getTypeInfo("u32")):"3d"===c?new pa(b,this.getTypeInfo("vec3u")):"2d"===c?new pa(b.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${c} not found. Line ${a.line}`),null)}return console.error(`Texture ${e} not found. Line ${a.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${a.line}`),null}TextureGather(a,b){return console.error("TODO: textureGather"),null}TextureGatherCompare(a,b){return console.error("TODO: textureGatherCompare"),null}TextureLoad(a,b){let c=a.args[0],d=this.exec.evalExpression(a.args[1],b),e=a.args.length>2?this.exec.evalExpression(a.args[2],b).value:0;if(!(d instanceof pa)||2!==d.data.length)return console.error(`Invalid UV argument for textureLoad. Line ${a.line}`),null;if(c instanceof oS){let f=c.name,g=b.getVariableValue(f);if(g instanceof pd){let b=Math.floor(d.data[0]),c=Math.floor(d.data[1]);if(b<0||b>=g.width||c<0||c>=g.height)return console.error(`Texture ${f} out of bounds. Line ${a.line}`),null;let h=g.getPixel(b,c,0,e);return null===h?(console.error(`Invalid texture format for textureLoad. Line ${a.line}`),null):new pa(h,this.getTypeInfo("vec4f"))}return console.error(`Texture ${f} not found. Line ${a.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${a.line}`),null}TextureNumLayers(a,b){let c=a.args[0];if(c instanceof oS){let d=c.name,e=b.getVariableValue(d);return e instanceof pd?new o9(e.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${d} not found. Line ${a.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${a.line}`),null}TextureNumLevels(a,b){let c=a.args[0];if(c instanceof oS){let d=c.name,e=b.getVariableValue(d);return e instanceof pd?new o9(e.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${d} not found. Line ${a.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${a.line}`),null}TextureNumSamples(a,b){let c=a.args[0];if(c instanceof oS){let d=c.name,e=b.getVariableValue(d);return e instanceof pd?new o9(e.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${d} not found. Line ${a.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${a.line}`),null}TextureSample(a,b){return console.error("TODO: textureSample"),null}TextureSampleBias(a,b){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(a,b){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(a,b){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(a,b){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(a,b){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(a,b){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(a,b){let c=a.args[0],d=this.exec.evalExpression(a.args[1],b),e=4===a.args.length?this.exec.evalExpression(a.args[2],b).value:0,f=4===a.args.length?this.exec.evalExpression(a.args[3],b).data:this.exec.evalExpression(a.args[2],b).data;if(4!==f.length)return console.error(`Invalid value argument for textureStore. Line ${a.line}`),null;if(!(d instanceof pa)||2!==d.data.length)return console.error(`Invalid UV argument for textureStore. Line ${a.line}`),null;if(c instanceof oS){let g=c.name,h=b.getVariableValue(g);if(h instanceof pd){let b=h.getMipLevelSize(0),c=Math.floor(d.data[0]),i=Math.floor(d.data[1]);return c<0||c>=b[0]||i<0||i>=b[1]?console.error(`Texture ${g} out of bounds. Line ${a.line}`):h.setPixel(c,i,0,e,Array.from(f)),null}return console.error(`Texture ${g} not found. Line ${a.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${a.line}`),null}AtomicLoad(a,b){let c=a.args[0];c instanceof oY&&(c=c.right);let d=this.exec.getVariableName(c,b);return b.getVariable(d).value.getSubData(this.exec,c.postfix,b)}AtomicStore(a,b){let c=a.args[0];c instanceof oY&&(c=c.right);let d=this.exec.getVariableName(c,b),e=b.getVariable(d),f=a.args[1],g=this.exec.evalExpression(f,b),h=e.value.getSubData(this.exec,c.postfix,b);return h instanceof o9&&g instanceof o9&&(h.value=g.value),e.value instanceof pc&&e.value.setDataValue(this.exec,h,c.postfix,b),null}AtomicAdd(a,b){let c=a.args[0];c instanceof oY&&(c=c.right);let d=this.exec.getVariableName(c,b),e=b.getVariable(d),f=a.args[1],g=this.exec.evalExpression(f,b),h=e.value.getSubData(this.exec,c.postfix,b),i=new o9(h.value,h.typeInfo);return h instanceof o9&&g instanceof o9&&(h.value+=g.value),e.value instanceof pc&&e.value.setDataValue(this.exec,h,c.postfix,b),i}AtomicSub(a,b){let c=a.args[0];c instanceof oY&&(c=c.right);let d=this.exec.getVariableName(c,b),e=b.getVariable(d),f=a.args[1],g=this.exec.evalExpression(f,b),h=e.value.getSubData(this.exec,c.postfix,b),i=new o9(h.value,h.typeInfo);return h instanceof o9&&g instanceof o9&&(h.value-=g.value),e.value instanceof pc&&e.value.setDataValue(this.exec,h,c.postfix,b),i}AtomicMax(a,b){let c=a.args[0];c instanceof oY&&(c=c.right);let d=this.exec.getVariableName(c,b),e=b.getVariable(d),f=a.args[1],g=this.exec.evalExpression(f,b),h=e.value.getSubData(this.exec,c.postfix,b),i=new o9(h.value,h.typeInfo);return h instanceof o9&&g instanceof o9&&(h.value=Math.max(h.value,g.value)),e.value instanceof pc&&e.value.setDataValue(this.exec,h,c.postfix,b),i}AtomicMin(a,b){let c=a.args[0];c instanceof oY&&(c=c.right);let d=this.exec.getVariableName(c,b),e=b.getVariable(d),f=a.args[1],g=this.exec.evalExpression(f,b),h=e.value.getSubData(this.exec,c.postfix,b),i=new o9(h.value,h.typeInfo);return h instanceof o9&&g instanceof o9&&(h.value=Math.min(h.value,g.value)),e.value instanceof pc&&e.value.setDataValue(this.exec,h,c.postfix,b),i}AtomicAnd(a,b){let c=a.args[0];c instanceof oY&&(c=c.right);let d=this.exec.getVariableName(c,b),e=b.getVariable(d),f=a.args[1],g=this.exec.evalExpression(f,b),h=e.value.getSubData(this.exec,c.postfix,b),i=new o9(h.value,h.typeInfo);return h instanceof o9&&g instanceof o9&&(h.value=h.value&g.value),e.value instanceof pc&&e.value.setDataValue(this.exec,h,c.postfix,b),i}AtomicOr(a,b){let c=a.args[0];c instanceof oY&&(c=c.right);let d=this.exec.getVariableName(c,b),e=b.getVariable(d),f=a.args[1],g=this.exec.evalExpression(f,b),h=e.value.getSubData(this.exec,c.postfix,b),i=new o9(h.value,h.typeInfo);return h instanceof o9&&g instanceof o9&&(h.value=h.value|g.value),e.value instanceof pc&&e.value.setDataValue(this.exec,h,c.postfix,b),i}AtomicXor(a,b){let c=a.args[0];c instanceof oY&&(c=c.right);let d=this.exec.getVariableName(c,b),e=b.getVariable(d),f=a.args[1],g=this.exec.evalExpression(f,b),h=e.value.getSubData(this.exec,c.postfix,b),i=new o9(h.value,h.typeInfo);return h instanceof o9&&g instanceof o9&&(h.value=h.value^g.value),e.value instanceof pc&&e.value.setDataValue(this.exec,h,c.postfix,b),i}AtomicExchange(a,b){let c=a.args[0];c instanceof oY&&(c=c.right);let d=this.exec.getVariableName(c,b),e=b.getVariable(d),f=a.args[1],g=this.exec.evalExpression(f,b),h=e.value.getSubData(this.exec,c.postfix,b),i=new o9(h.value,h.typeInfo);return h instanceof o9&&g instanceof o9&&(h.value=g.value),e.value instanceof pc&&e.value.setDataValue(this.exec,h,c.postfix,b),i}AtomicCompareExchangeWeak(a,b){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(a,b){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(a,b){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(a,b){return console.error("TODO: pack4xI8"),null}Pack4xU8(a,b){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(a,b){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(a,b){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(a,b){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(a,b){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(a,b){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(a,b){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(a,b){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(a,b){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(a,b){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(a,b){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(a,b){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(a,b){return console.error("TODO: unpack2x16float"),null}StorageBarrier(a,b){return null}TextureBarrier(a,b){return null}WorkgroupBarrier(a,b){return null}WorkgroupUniformLoad(a,b){return null}SubgroupAdd(a,b){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(a,b){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(a,b){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(a,b){return console.error("TODO: subgroupAll"),null}SubgroupAnd(a,b){return console.error("TODO: subgroupAnd"),null}SubgroupAny(a,b){return console.error("TODO: subgroupAny"),null}SubgroupBallot(a,b){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(a,b){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(a,b){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(a,b){return console.error("TODO: subgroupElect"),null}SubgroupMax(a,b){return console.error("TODO: subgroupMax"),null}SubgroupMin(a,b){return console.error("TODO: subgroupMin"),null}SubgroupMul(a,b){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(a,b){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(a,b){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(a,b){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(a,b){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(a,b){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(a,b){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(a,b){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(a,b){return console.error("TODO: subgroupXor"),null}QuadBroadcast(a,b){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(a,b){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(a,b){return console.error("TODO: quadSwapX"),null}QuadSwapY(a,b){return console.error("TODO: quadSwapY"),null}}let pC={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},pD={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class pE extends pA{constructor(a,b){var c;super(),this.ast=null!=a?a:[],this.reflection=new pv,this.reflection.updateAST(this.ast),this.context=null!=(c=null==b?void 0:b.clone())?c:new pz,this.builtins=new pB(this),this.typeInfo={bool:this.getTypeInfo(oH.bool),i32:this.getTypeInfo(oH.i32),u32:this.getTypeInfo(oH.u32),f32:this.getTypeInfo(oH.f32),f16:this.getTypeInfo(oH.f16),vec2f:this.getTypeInfo(oK.vec2f),vec2u:this.getTypeInfo(oK.vec2u),vec2i:this.getTypeInfo(oK.vec2i),vec2h:this.getTypeInfo(oK.vec2h),vec3f:this.getTypeInfo(oK.vec3f),vec3u:this.getTypeInfo(oK.vec3u),vec3i:this.getTypeInfo(oK.vec3i),vec3h:this.getTypeInfo(oK.vec3h),vec4f:this.getTypeInfo(oK.vec4f),vec4u:this.getTypeInfo(oK.vec4u),vec4i:this.getTypeInfo(oK.vec4i),vec4h:this.getTypeInfo(oK.vec4h),mat2x2f:this.getTypeInfo(oK.mat2x2f),mat2x3f:this.getTypeInfo(oK.mat2x3f),mat2x4f:this.getTypeInfo(oK.mat2x4f),mat3x2f:this.getTypeInfo(oK.mat3x2f),mat3x3f:this.getTypeInfo(oK.mat3x3f),mat3x4f:this.getTypeInfo(oK.mat3x4f),mat4x2f:this.getTypeInfo(oK.mat4x2f),mat4x3f:this.getTypeInfo(oK.mat4x3f),mat4x4f:this.getTypeInfo(oK.mat4x4f)}}getVariableValue(a){var b,c;let d=null!=(c=null==(b=this.context.getVariable(a))?void 0:b.value)?c:null;if(null===d)return null;if(d instanceof o9)return d.value;if(d instanceof pa||d instanceof pb)return Array.from(d.data);if(d instanceof pc&&d.typeInfo instanceof nX){if("u32"===d.typeInfo.format.name)return Array.from(new Uint32Array(d.buffer,d.offset,d.typeInfo.count));if("i32"===d.typeInfo.format.name)return Array.from(new Int32Array(d.buffer,d.offset,d.typeInfo.count));if("f32"===d.typeInfo.format.name)return Array.from(new Float32Array(d.buffer,d.offset,d.typeInfo.count))}return console.error(`Unsupported return variable type ${d.typeInfo.name}`),null}execute(a){(a=null!=a?a:{}).constants&&this._setOverrides(a.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(a,b,c,d){let e=this.context.clone();(d=null!=d?d:{}).constants&&this._setOverrides(d.constants,e),this._execStatements(this.ast,e);let f=e.getFunction(a);if(!f)return void console.error(`Function ${a} not found`);if("number"==typeof b)b=[b,1,1];else{if(0===b.length)return void console.error("Invalid dispatch count");1===b.length?b=[b[0],1,1]:2===b.length?b=[b[0],b[1],1]:b.length>3&&(b=[b[0],b[1],b[2]])}let g=b[0],h=b[1],i=b[2],j=this.getTypeInfo("vec3u");e.setVariable("@num_workgroups",new pa(b,j));let k=this.reflection.getFunctionInfo(a);for(let b in null===k&&console.error(`Function ${a} not found in reflection data`),c)for(let a in c[b]){let d=c[b][a];e.variables.forEach(c=>{var e;let f=c.node;if(null==f?void 0:f.attributes){let g=null,h=null;for(let a of f.attributes)"binding"===a.name?g=a.value:"group"===a.name&&(h=a.value);if(a==g&&b==h){let g=!1;for(let d of k.resources)if(d.name===c.name&&d.group===parseInt(b)&&d.binding===parseInt(a)){g=!0;break}g&&(void 0!==d.texture&&void 0!==d.descriptor?c.value=new pd(d.texture,this.getTypeInfo(f.type),d.descriptor,null!=(e=d.texture.view)?e:null):void 0!==d.uniform?c.value=new pc(d.uniform,this.getTypeInfo(f.type)):c.value=new pc(d,this.getTypeInfo(f.type)))}}})}for(let a=0;a<i;++a)for(let b=0;b<h;++b)for(let c=0;c<g;++c)e.setVariable("@workgroup_id",new pa([c,b,a],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(f,[c,b,a],e)}execStatement(a,b){if(a instanceof oz)return this.evalExpression(a.value,b);if(a instanceof oF){if(a.condition){let c=this.evalExpression(a.condition,b);if(!(c instanceof o9))throw Error("Invalid break-if condition");if(!c.value)return null}return pE._breakObj}if(a instanceof oG)return pE._continueObj;if(a instanceof or)this._let(a,b);else if(a instanceof op)this._var(a,b);else if(a instanceof os)this._const(a,b);else if(a instanceof ok)this._function(a,b);else{if(a instanceof oy)return this._if(a,b);if(a instanceof ox)return this._switch(a,b);if(a instanceof oo)return this._for(a,b);if(a instanceof om)return this._while(a,b);if(a instanceof ow)return this._loop(a,b);if(a instanceof on){let c=b.clone();return c.currentFunctionName=b.currentFunctionName,this._execStatements(a.body,c)}if(a instanceof ou)this._assign(a,b);else if(a instanceof ot)this._increment(a,b);else{if(a instanceof oJ)return null;if(a instanceof oq){let c=a.name;null===b.getVariable(c)&&b.setVariable(c,new o9(0,this.getTypeInfo("u32")))}else if(a instanceof ov)this._call(a,b);else{if(a instanceof oC||a instanceof oD)return null;console.error("Invalid statement type.",a,`Line ${a.line}`)}}}return null}evalExpression(a,b){return a instanceof oZ?this._evalBinaryOp(a,b):a instanceof oU?this._evalLiteral(a,b):a instanceof oS?this._evalVariable(a,b):a instanceof oR?this._evalCall(a,b):a instanceof oQ?this._evalCreate(a,b):a instanceof oT?this._evalConst(a,b):a instanceof oV?this._evalBitcast(a,b):a instanceof oY?this._evalUnaryOp(a,b):(console.error("Invalid expression type",a,`Line ${a.line}`),null)}getTypeInfo(a){var b;if(a instanceof oH){let b=this.reflection.getTypeInfo(a);if(null!==b)return b}let c=null!=(b=this.typeInfo[a])?b:null;return null!==c||(c=this.reflection.getTypeInfoByName(a)),c}_setOverrides(a,b){for(let c in a){let d=a[c],e=this.reflection.getOverrideInfo(c);null!==e?(null===e.type&&(e.type=this.getTypeInfo("u32")),"u32"===e.type.name||"i32"===e.type.name||"f32"===e.type.name||"f16"===e.type.name?b.setVariable(c,new o9(d,e.type)):"bool"===e.type.name?b.setVariable(c,new o9(+!!d,e.type)):"vec2"===e.type.name||"vec3"===e.type.name||"vec4"===e.type.name||"vec2f"===e.type.name||"vec3f"===e.type.name||"vec4f"===e.type.name||"vec2i"===e.type.name||"vec3i"===e.type.name||"vec4i"===e.type.name||"vec2u"===e.type.name||"vec3u"===e.type.name||"vec4u"===e.type.name||"vec2h"===e.type.name||"vec3h"===e.type.name||"vec4h"===e.type.name?b.setVariable(c,new pa(d,e.type)):console.error(`Invalid constant type for ${c}`)):console.error(`Override ${c} does not exist in the shader.`)}}_dispatchWorkgroup(a,b,c){let d=[1,1,1];for(let b of a.node.attributes)if("workgroup_size"===b.name){if(b.value.length>0){let a=c.getVariableValue(b.value[0]);d[0]=a instanceof o9?a.value:parseInt(b.value[0])}if(b.value.length>1){let a=c.getVariableValue(b.value[1]);d[1]=a instanceof o9?a.value:parseInt(b.value[1])}if(b.value.length>2){let a=c.getVariableValue(b.value[2]);d[2]=a instanceof o9?a.value:parseInt(b.value[2])}}let e=this.getTypeInfo("vec3u"),f=this.getTypeInfo("u32");c.setVariable("@workgroup_size",new pa(d,e));let g=d[0],h=d[1],i=d[2];for(let j=0,k=0;j<i;++j)for(let i=0;i<h;++i)for(let h=0;h<g;++h,++k){let g=[h,i,j],l=[h+b[0]*d[0],i+b[1]*d[1],j+b[2]*d[2]];c.setVariable("@local_invocation_id",new pa(g,e)),c.setVariable("@global_invocation_id",new pa(l,e)),c.setVariable("@local_invocation_index",new o9(k,f)),this._dispatchExec(a,c)}}_dispatchExec(a,b){for(let c of a.node.args)for(let a of c.attributes)if("builtin"===a.name){let d=`@${a.value}`,e=b.getVariable(d);void 0!==e&&b.variables.set(c.name,e)}this._execStatements(a.node.body,b)}getVariableName(a,b){for(;a instanceof oY;)a=a.right;return a instanceof oS?a.name:(console.error("Unknown variable type",a,"Line",a.line),null)}_execStatements(a,b){for(let c of a){if(c instanceof Array){let a=b.clone(),d=this._execStatements(c,a);if(d)return d;continue}let a=this.execStatement(c,b);if(a)return a}return null}_call(a,b){let c=b.clone();c.currentFunctionName=a.name;let d=b.getFunction(a.name);if(d){for(let b=0;b<d.node.args.length;++b){let e=d.node.args[b],f=this.evalExpression(a.args[b],c);c.setVariable(e.name,f,e)}this._execStatements(d.node.body,c)}else a.isBuiltin?this._callBuiltinFunction(a,c):this.getTypeInfo(a.name)&&this._evalCreate(a,b)}_increment(a,b){let c=this.getVariableName(a.variable,b),d=b.getVariable(c);d?"++"===a.operator?d.value instanceof o9?d.value.value++:console.error(`Variable ${c} is not a scalar. Line ${a.line}`):"--"===a.operator?d.value instanceof o9?d.value.value--:console.error(`Variable ${c} is not a scalar. Line ${a.line}`):console.error(`Unknown increment operator ${a.operator}. Line ${a.line}`):console.error(`Variable ${c} not found. Line ${a.line}`)}_getVariableData(a,b){if(a instanceof oS){let c=this.getVariableName(a,b),d=b.getVariable(c);return null===d?(console.error(`Variable ${c} not found. Line ${a.line}`),null):d.value.getSubData(this,a.postfix,b)}if(a instanceof oY){if("*"===a.operator){let c=this._getVariableData(a.right,b);return c instanceof o8?c.reference.getSubData(this,a.postfix,b):(console.error(`Variable ${a.right} is not a pointer. Line ${a.line}`),null)}if("&"===a.operator)return new o8(this._getVariableData(a.right,b))}return null}_assign(a,b){let c=null,d="<var>",e=null;if(a.variable instanceof oY){let c=this._getVariableData(a.variable,b),d=this.evalExpression(a.value,b),e=a.operator;if("="===e){if(c instanceof o9||c instanceof pa||c instanceof pb){if(d instanceof o9||d instanceof pa||d instanceof pb&&c.data.length===d.data.length)return void c.data.set(d.data);console.error(`Invalid assignment. Line ${a.line}`)}else if(c instanceof pc&&d instanceof pc&&c.buffer.byteLength-c.offset>=d.buffer.byteLength-d.offset)return void(c.buffer.byteLength%4==0?new Uint32Array(c.buffer,c.offset,c.typeInfo.size/4).set(new Uint32Array(d.buffer,d.offset,d.typeInfo.size/4)):new Uint8Array(c.buffer,c.offset,c.typeInfo.size).set(new Uint8Array(d.buffer,d.offset,d.typeInfo.size)));return console.error(`Invalid assignment. Line ${a.line}`),null}if("+="===e)return c instanceof o9||c instanceof pa||c instanceof pb?d instanceof o9||d instanceof pa||d instanceof pb?void c.data.set(d.data.map((a,b)=>c.data[b]+a)):void console.error(`Invalid assignment . Line ${a.line}`):void console.error(`Invalid assignment. Line ${a.line}`);if("-="===e)return(c instanceof o9||c instanceof pa||c instanceof pb)&&(d instanceof o9||d instanceof pa||d instanceof pb)?void c.data.set(d.data.map((a,b)=>c.data[b]-a)):void console.error(`Invalid assignment. Line ${a.line}`)}if(a.variable instanceof oY){if("*"===a.variable.operator){d=this.getVariableName(a.variable.right,b);let e=b.getVariable(d);if(!(e&&e.value instanceof o8))return void console.error(`Variable ${d} is not a pointer. Line ${a.line}`);c=e.value.reference;let f=a.variable.postfix;if(!f){let b=a.variable.right;for(;b instanceof oY;){if(b.postfix){f=b.postfix;break}b=b.right}}f&&(c=c.getSubData(this,f,b))}}else{e=a.variable.postfix,d=this.getVariableName(a.variable,b);let f=b.getVariable(d);if(null===f)return void console.error(`Variable ${d} not found. Line ${a.line}`);c=f.value}if(c instanceof o8&&(c=c.reference),null===c)return void console.error(`Variable ${d} not found. Line ${a.line}`);let f=this.evalExpression(a.value,b),g=a.operator;if("="!==g){let d=c.getSubData(this,e,b);if(d instanceof pa&&f instanceof o9){let b=d.data,c=f.value;if("+="===g)for(let a=0;a<b.length;++a)b[a]+=c;else if("-="===g)for(let a=0;a<b.length;++a)b[a]-=c;else if("*="===g)for(let a=0;a<b.length;++a)b[a]*=c;else if("/="===g)for(let a=0;a<b.length;++a)b[a]/=c;else if("%="===g)for(let a=0;a<b.length;++a)b[a]%=c;else if("&="===g)for(let a=0;a<b.length;++a)b[a]&=c;else if("|="===g)for(let a=0;a<b.length;++a)b[a]|=c;else if("^="===g)for(let a=0;a<b.length;++a)b[a]^=c;else if("<<="===g)for(let a=0;a<b.length;++a)b[a]<<=c;else if(">>="===g)for(let a=0;a<b.length;++a)b[a]>>=c;else console.error(`Invalid operator ${g}. Line ${a.line}`)}else if(d instanceof pa&&f instanceof pa){let b=d.data,c=f.data;if(b.length!==c.length)return void console.error(`Vector length mismatch. Line ${a.line}`);if("+="===g)for(let a=0;a<b.length;++a)b[a]+=c[a];else if("-="===g)for(let a=0;a<b.length;++a)b[a]-=c[a];else if("*="===g)for(let a=0;a<b.length;++a)b[a]*=c[a];else if("/="===g)for(let a=0;a<b.length;++a)b[a]/=c[a];else if("%="===g)for(let a=0;a<b.length;++a)b[a]%=c[a];else if("&="===g)for(let a=0;a<b.length;++a)b[a]&=c[a];else if("|="===g)for(let a=0;a<b.length;++a)b[a]|=c[a];else if("^="===g)for(let a=0;a<b.length;++a)b[a]^=c[a];else if("<<="===g)for(let a=0;a<b.length;++a)b[a]<<=c[a];else if(">>="===g)for(let a=0;a<b.length;++a)b[a]>>=c[a];else console.error(`Invalid operator ${g}. Line ${a.line}`)}else{if(!(d instanceof o9&&f instanceof o9))return void console.error(`Invalid type for ${a.operator} operator. Line ${a.line}`);"+="===g?d.value+=f.value:"-="===g?d.value-=f.value:"*="===g?d.value*=f.value:"/="===g?d.value/=f.value:"%="===g?d.value%=f.value:"&="===g?d.value&=f.value:"|="===g?d.value|=f.value:"^="===g?d.value^=f.value:"<<="===g?d.value<<=f.value:">>="===g?d.value>>=f.value:console.error(`Invalid operator ${g}. Line ${a.line}`)}return void(c instanceof pc&&c.setDataValue(this,d,e,b))}if(c instanceof pc)c.setDataValue(this,f,e,b);else if(e){if(!(c instanceof pa||c instanceof pb))return void console.error(`Variable ${d} is not a vector or matrix. Line ${a.line}`);if(e instanceof oW){let g=this.evalExpression(e.index,b).value;if(c instanceof pa){if(!(f instanceof o9))return void console.error(`Invalid assignment to ${d}. Line ${a.line}`);c.data[g]=f.value}else{if(!(c instanceof pb))return void console.error(`Invalid assignment to ${d}. Line ${a.line}`);{let g=this.evalExpression(e.index,b).value;if(g<0||!(f instanceof pa))return void console.error(`Invalid assignment to ${d}. Line ${a.line}`);{let b=c.typeInfo.getTypeName();if("mat2x2"===b||"mat2x2f"===b||"mat2x2h"===b){if(!(g<2&&2===f.data.length))return void console.error(`Invalid assignment to ${d}. Line ${a.line}`);c.data[2*g]=f.data[0],c.data[2*g+1]=f.data[1]}else if("mat2x3"===b||"mat2x3f"===b||"mat2x3h"===b){if(!(g<2&&3===f.data.length))return void console.error(`Invalid assignment to ${d}. Line ${a.line}`);c.data[3*g]=f.data[0],c.data[3*g+1]=f.data[1],c.data[3*g+2]=f.data[2]}else if("mat2x4"===b||"mat2x4f"===b||"mat2x4h"===b){if(!(g<2&&4===f.data.length))return void console.error(`Invalid assignment to ${d}. Line ${a.line}`);c.data[4*g]=f.data[0],c.data[4*g+1]=f.data[1],c.data[4*g+2]=f.data[2],c.data[4*g+3]=f.data[3]}else if("mat3x2"===b||"mat3x2f"===b||"mat3x2h"===b){if(!(g<3&&2===f.data.length))return void console.error(`Invalid assignment to ${d}. Line ${a.line}`);c.data[2*g]=f.data[0],c.data[2*g+1]=f.data[1]}else if("mat3x3"===b||"mat3x3f"===b||"mat3x3h"===b){if(!(g<3&&3===f.data.length))return void console.error(`Invalid assignment to ${d}. Line ${a.line}`);c.data[3*g]=f.data[0],c.data[3*g+1]=f.data[1],c.data[3*g+2]=f.data[2]}else if("mat3x4"===b||"mat3x4f"===b||"mat3x4h"===b){if(!(g<3&&4===f.data.length))return void console.error(`Invalid assignment to ${d}. Line ${a.line}`);c.data[4*g]=f.data[0],c.data[4*g+1]=f.data[1],c.data[4*g+2]=f.data[2],c.data[4*g+3]=f.data[3]}else if("mat4x2"===b||"mat4x2f"===b||"mat4x2h"===b){if(!(g<4&&2===f.data.length))return void console.error(`Invalid assignment to ${d}. Line ${a.line}`);c.data[2*g]=f.data[0],c.data[2*g+1]=f.data[1]}else if("mat4x3"===b||"mat4x3f"===b||"mat4x3h"===b){if(!(g<4&&3===f.data.length))return void console.error(`Invalid assignment to ${d}. Line ${a.line}`);c.data[3*g]=f.data[0],c.data[3*g+1]=f.data[1],c.data[3*g+2]=f.data[2]}else{if("mat4x4"!==b&&"mat4x4f"!==b&&"mat4x4h"!==b||!(g<4&&4===f.data.length))return void console.error(`Invalid assignment to ${d}. Line ${a.line}`);c.data[4*g]=f.data[0],c.data[4*g+1]=f.data[1],c.data[4*g+2]=f.data[2],c.data[4*g+3]=f.data[3]}}}}}else if(e instanceof oP){let b=e.value;if(!(c instanceof pa))return void console.error(`Invalid assignment to ${b}. Variable ${d} is not a vector. Line ${a.line}`);if(f instanceof o9){if(b.length>1)return void console.error(`Invalid assignment to ${b} for variable ${d}. Line ${a.line}`);if("x"===b)c.data[0]=f.value;else if("y"===b){if(c.data.length<2)return void console.error(`Invalid assignment to ${b} for variable ${d}. Line ${a.line}`);c.data[1]=f.value}else if("z"===b){if(c.data.length<3)return void console.error(`Invalid assignment to ${b} for variable ${d}. Line ${a.line}`);c.data[2]=f.value}else if("w"===b){if(c.data.length<4)return void console.error(`Invalid assignment to ${b} for variable ${d}. Line ${a.line}`);c.data[3]=f.value}}else{if(!(f instanceof pa))return void console.error(`Invalid assignment to ${d}. Line ${a.line}`);if(b.length!==f.data.length)return void console.error(`Invalid assignment to ${b} for variable ${d}. Line ${a.line}`);for(let e=0;e<b.length;++e){let g=b[e];if("x"===g||"r"===g)c.data[0]=f.data[e];else if("y"===g||"g"===g){if(f.data.length<2)return void console.error(`Invalid assignment to ${g} for variable ${d}. Line ${a.line}`);c.data[1]=f.data[e]}else if("z"===g||"b"===g){if(f.data.length<3)return void console.error(`Invalid assignment to ${g} for variable ${d}. Line ${a.line}`);c.data[2]=f.data[e]}else{if("w"!==g&&"a"!==g||f.data.length<4)return void console.error(`Invalid assignment to ${g} for variable ${d}. Line ${a.line}`);c.data[3]=f.data[e]}}}}}else c instanceof o9&&f instanceof o9?c.value=f.value:c instanceof pa&&f instanceof pa||c instanceof pb&&f instanceof pb?c.data.set(f.data):console.error(`Invalid assignment to ${d}. Line ${a.line}`)}_function(a,b){let c=new py(a);b.functions.set(a.name,c)}_const(a,b){let c=null;null!==a.value&&(c=this.evalExpression(a.value,b)),b.createVariable(a.name,c,a)}_let(a,b){let c=null;if(null!==a.value){if(null===(c=this.evalExpression(a.value,b)))return void console.error(`Invalid value for variable ${a.name}. Line ${a.line}`);a.value instanceof oY||(c=c.clone())}else{let d=a.type.name;if("f32"===d||"i32"===d||"u32"===d||"bool"===d||"f16"===d||"vec2"===d||"vec3"===d||"vec4"===d||"vec2f"===d||"vec3f"===d||"vec4f"===d||"vec2i"===d||"vec3i"===d||"vec4i"===d||"vec2u"===d||"vec3u"===d||"vec4u"===d||"vec2h"===d||"vec3h"===d||"vec4h"===d||"vec2b"===d||"vec3b"===d||"vec4b"===d||"mat2x2"===d||"mat2x3"===d||"mat2x4"===d||"mat3x2"===d||"mat3x3"===d||"mat3x4"===d||"mat4x2"===d||"mat4x3"===d||"mat4x4"===d||"mat2x2f"===d||"mat2x3f"===d||"mat2x4f"===d||"mat3x2f"===d||"mat3x3f"===d||"mat3x4f"===d||"mat4x2f"===d||"mat4x3f"===d||"mat4x4f"===d||"mat2x2h"===d||"mat2x3h"===d||"mat2x4h"===d||"mat3x2h"===d||"mat3x3h"===d||"mat3x4h"===d||"mat4x2h"===d||"mat4x3h"===d||"mat4x4h"===d||"array"===d){let d=new oQ(a.type,[]);c=this._evalCreate(d,b)}}b.createVariable(a.name,c,a)}_var(a,b){let c=null;if(null!==a.value){if(null===(c=this.evalExpression(a.value,b)))return void console.error(`Invalid value for variable ${a.name}. Line ${a.line}`);a.value instanceof oY||(c=c.clone())}else{if(null===a.type)return void console.error(`Variable ${a.name} has no type. Line ${a.line}`);let d=a.type.name;if("f32"===d||"i32"===d||"u32"===d||"bool"===d||"f16"===d||"vec2"===d||"vec3"===d||"vec4"===d||"vec2f"===d||"vec3f"===d||"vec4f"===d||"vec2i"===d||"vec3i"===d||"vec4i"===d||"vec2u"===d||"vec3u"===d||"vec4u"===d||"vec2h"===d||"vec3h"===d||"vec4h"===d||"vec2b"===d||"vec3b"===d||"vec4b"===d||"mat2x2"===d||"mat2x3"===d||"mat2x4"===d||"mat3x2"===d||"mat3x3"===d||"mat3x4"===d||"mat4x2"===d||"mat4x3"===d||"mat4x4"===d||"mat2x2f"===d||"mat2x3f"===d||"mat2x4f"===d||"mat3x2f"===d||"mat3x3f"===d||"mat3x4f"===d||"mat4x2f"===d||"mat4x3f"===d||"mat4x4f"===d||"mat2x2h"===d||"mat2x3h"===d||"mat2x4h"===d||"mat3x2h"===d||"mat3x3h"===d||"mat3x4h"===d||"mat4x2h"===d||"mat4x3h"===d||"mat4x4h"===d||a.type instanceof oM||a.type instanceof oJ||a.type instanceof oK){let d=new oQ(a.type,[]);c=this._evalCreate(d,b)}}b.createVariable(a.name,c,a)}_switch(a,b){b=b.clone();let c=this.evalExpression(a.condition,b);if(!(c instanceof o9))return console.error(`Invalid if condition. Line ${a.line}`),null;let d=null;for(let e of a.cases)if(e instanceof o0)for(let f of e.selectors){if(f instanceof o_){d=e;continue}let g=this.evalExpression(f,b);if(!(g instanceof o9))return console.error(`Invalid case selector. Line ${a.line}`),null;if(g.value===c.value)return this._execStatements(e.body,b)}else e instanceof o1&&(d=e);return d?this._execStatements(d.body,b):null}_if(a,b){b=b.clone();let c=this.evalExpression(a.condition,b);if(!(c instanceof o9))return console.error(`Invalid if condition. Line ${a.line}`),null;if(c.value)return this._execStatements(a.body,b);for(let c of a.elseif){let d=this.evalExpression(c.condition,b);if(!(d instanceof o9))return console.error(`Invalid if condition. Line ${a.line}`),null;if(d.value)return this._execStatements(c.body,b)}return a.else?this._execStatements(a.else,b):null}_getScalarValue(a){return a instanceof o9?a.value:(console.error("Expected scalar value.",a),0)}_for(a,b){for(b=b.clone(),this.execStatement(a.init,b);this._getScalarValue(this.evalExpression(a.condition,b));){let c=this._execStatements(a.body,b);if(c===pE._breakObj)break;if(null!==c&&c!==pE._continueObj)return c;this.execStatement(a.increment,b)}return null}_loop(a,b){for(b=b.clone();;){let c=this._execStatements(a.body,b);if(c===pE._breakObj)break;if(c===pE._continueObj){if(a.continuing&&this._execStatements(a.continuing.body,b)===pE._breakObj)break}else if(null!==c)return c}return null}_while(a,b){for(b=b.clone();this._getScalarValue(this.evalExpression(a.condition,b));){let c=this._execStatements(a.body,b);if(c===pE._breakObj)break;if(c!==pE._continueObj&&null!==c)return c}return null}_evalBitcast(a,b){let c=this.evalExpression(a.value,b),d=a.type;if(c instanceof o9)return new o9(ps(c.value,c.typeInfo.name,d.name),this.getTypeInfo(d));if(c instanceof pa){let b=c.typeInfo.getTypeName(),e="";if(b.endsWith("f"))e="f32";else if(b.endsWith("i"))e="i32";else if(b.endsWith("u"))e="u32";else if(b.endsWith("b"))e="bool";else{if(!b.endsWith("h"))return console.error(`Unknown vector type ${b}. Line ${a.line}`),null;e="f16"}let f=d.getTypeName(),g="";if(f.endsWith("f"))g="f32";else if(f.endsWith("i"))g="i32";else if(f.endsWith("u"))g="u32";else if(f.endsWith("b"))g="bool";else{if(!f.endsWith("h"))return console.error(`Unknown vector type ${g}. Line ${a.line}`),null;g="f16"}return new pa(function(a,b,c){if(b===c)return a;let d=Array(a.length);for(let e=0;e<a.length;e++)d[e]=ps(a[e],b,c);return d}(Array.from(c.data),e,g),this.getTypeInfo(d))}return console.error(`TODO: bitcast for ${c.typeInfo.name}. Line ${a.line}`),null}_evalConst(a,b){return b.getVariableValue(a.name).clone().getSubData(this,a.postfix,b)}_evalCreate(a,b){var c;if(a instanceof oQ){if(null===a.type)return o7.void;switch(a.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(a,b);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(a,b);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(a,b)}}let d=a instanceof oQ?a.type.name:a.name,e=a instanceof oQ?this.getTypeInfo(a.type):this.getTypeInfo(a.name);if(null===e)return console.error(`Unknown type ${d}. Line ${a.line}`),null;if(0===e.size)return null;let f=new pc(new ArrayBuffer(e.size),e,0);if(e instanceof nW){if(a.args)for(let c=0;c<a.args.length;++c){let d=e.members[c],g=a.args[c],h=this.evalExpression(g,b);f.setData(this,h,d.type,d.offset,b)}}else if(e instanceof nX){let d=0;if(a.args)for(let g=0;g<a.args.length;++g){let h=a.args[g],i=this.evalExpression(h,b);null===e.format&&("x32"===(null==(c=i.typeInfo)?void 0:c.name)?e.format=this.getTypeInfo("i32"):e.format=i.typeInfo),f.setData(this,i,e.format,d,b),d+=e.stride}}else console.error(`Unknown type "${d}". Line ${a.line}`);return a instanceof oQ?f.getSubData(this,a.postfix,b):f}_evalLiteral(a,b){let c=this.getTypeInfo(a.type),d=c.name;return"x32"===d||"u32"===d||"f32"===d||"f16"===d||"i32"===d||"bool"===d?new o9(a.scalarValue,c):"vec2"===d||"vec3"===d||"vec4"===d||"vec2f"===d||"vec3f"===d||"vec4f"===d||"vec2h"===d||"vec3h"===d||"vec4h"===d||"vec2i"===d||"vec3i"===d||"vec4i"===d||"vec2u"===d||"vec3u"===d||"vec4u"===d?this._callConstructorVec(a,b):"mat2x2"===d||"mat2x3"===d||"mat2x4"===d||"mat3x2"===d||"mat3x3"===d||"mat3x4"===d||"mat4x2"===d||"mat4x3"===d||"mat4x4"===d||"mat2x2f"===d||"mat2x3f"===d||"mat2x4f"===d||"mat3x2f"===d||"mat3x3f"===d||"mat3x4f"===d||"mat4x2f"===d||"mat4x3f"===d||"mat4x4f"===d||"mat2x2h"===d||"mat2x3h"===d||"mat2x4h"===d||"mat3x2h"===d||"mat3x3h"===d||"mat3x4h"===d||"mat4x2h"===d||"mat4x3h"===d||"mat4x4h"===d?this._callConstructorMatrix(a,b):a.value}_evalVariable(a,b){let c=b.getVariableValue(a.name);return null===c?c:c.getSubData(this,a.postfix,b)}_maxFormatTypeInfo(a){let b=a[0];if("f32"===b.name)return b;for(let c=1;c<a.length;++c){let d=pE._priority.get(b.name);pE._priority.get(a[c].name)<d&&(b=a[c])}return"x32"===b.name?this.getTypeInfo("i32"):b}_evalUnaryOp(a,b){let c=this.evalExpression(a.right,b);if("&"===a.operator)return new o8(c);if("*"===a.operator)return c instanceof o8?c.reference.getSubData(this,a.postfix,b):(console.error(`Invalid dereference. Line ${a.line}`),null);let d=c instanceof o9?c.value:c instanceof pa?Array.from(c.data):null;switch(a.operator){case"+":if(pi(d))return new pa(d.map((a,b)=>+a),c.typeInfo);return new o9(+d,this._maxFormatTypeInfo([c.typeInfo,c.typeInfo]));case"-":if(pi(d))return new pa(d.map((a,b)=>-a),c.typeInfo);return new o9(-d,this._maxFormatTypeInfo([c.typeInfo,c.typeInfo]));case"!":if(pi(d))return new pa(d.map((a,b)=>+!a),c.typeInfo);return new o9(+!d,this._maxFormatTypeInfo([c.typeInfo,c.typeInfo]));case"~":if(pi(d))return new pa(d.map((a,b)=>~a),c.typeInfo);return new o9(~d,this._maxFormatTypeInfo([c.typeInfo,c.typeInfo]))}return console.error(`Invalid unary operator ${a.operator}. Line ${a.line}`),null}_evalBinaryOp(a,b){let c=this.evalExpression(a.left,b),d=this.evalExpression(a.right,b),e=c instanceof o9?c.value:c instanceof pa||c instanceof pb?Array.from(c.data):null,f=d instanceof o9?d.value:d instanceof pa||d instanceof pb?Array.from(d.data):null;switch(a.operator){case"+":if(pi(e)&&pi(f)){if(e.length!==f.length)return console.error(`Vector length mismatch. Line ${a.line}.`),null;return new pa(e.map((a,b)=>a+f[b]),c.typeInfo)}if(pi(e))return new pa(e.map((a,b)=>a+f),c.typeInfo);if(pi(f))return new pa(f.map((a,b)=>e+a),d.typeInfo);return new o9(e+f,this._maxFormatTypeInfo([c.typeInfo,d.typeInfo]));case"-":if(pi(e)&&pi(f)){if(e.length!==f.length)return console.error(`Vector length mismatch. Line ${a.line}.`),null;return new pa(e.map((a,b)=>a-f[b]),c.typeInfo)}if(pi(e))return new pa(e.map((a,b)=>a-f),c.typeInfo);if(pi(f))return new pa(f.map((a,b)=>e-a),d.typeInfo);return new o9(e-f,this._maxFormatTypeInfo([c.typeInfo,d.typeInfo]));case"*":if(pi(e)&&pi(f)){if(c instanceof pb&&d instanceof pb){let b=function(a,b,c,d){if(void 0===pD[b.name]||void 0===pD[d.name])return null;let e=pD[b.name][0],f=pD[b.name][1],g=pD[d.name][0];if(e!==pD[d.name][1])return null;let h=Array(g*f);for(let b=0;b<f;b++)for(let d=0;d<g;d++){let i=0;for(let g=0;g<e;g++)i+=a[g*f+b]*c[d*e+g];h[b*g+d]=i}return h}(e,c.typeInfo,f,d.typeInfo);if(null===b)return console.error(`Matrix multiplication failed. Line ${a.line}.`),null;let g=pD[d.typeInfo.name][0],h=pD[c.typeInfo.name][1];return new pb(b,this.getTypeInfo(`mat${g}x${h}f`))}if(c instanceof pb&&d instanceof pa){let b=function(a,b,c,d){if(void 0===pD[b.name]||void 0===pC[d.name])return null;let e=pD[b.name][0],f=pD[b.name][1];if(e!==c.length)return null;let g=Array(f);for(let b=0;b<f;b++){let d=0;for(let g=0;g<e;g++)d+=a[g*f+b]*c[g];g[b]=d}return g}(e,c.typeInfo,f,d.typeInfo);return null===b?(console.error(`Matrix vector multiplication failed. Line ${a.line}.`),null):new pa(b,d.typeInfo)}if(c instanceof pa&&d instanceof pb){let b=function(a,b,c,d){if(void 0===pC[b.name]||void 0===pD[d.name])return null;let e=pD[d.name][0],f=pD[d.name][1];if(f!==a.length)return null;let g=[];for(let b=0;b<e;b++){let d=0;for(let g=0;g<f;g++)d+=a[g]*c[g*e+b];g[b]=d}return g}(e,c.typeInfo,f,d.typeInfo);return null===b?(console.error(`Matrix vector multiplication failed. Line ${a.line}.`),null):new pa(b,c.typeInfo)}if(e.length!==f.length)return console.error(`Vector length mismatch. Line ${a.line}.`),null;return new pa(e.map((a,b)=>a*f[b]),c.typeInfo)}if(pi(e)){let a=e.map((a,b)=>a*f);return c instanceof pb?new pb(a,c.typeInfo):new pa(a,c.typeInfo)}if(pi(f)){let a=f.map((a,b)=>e*a);return d instanceof pb?new pb(a,d.typeInfo):new pa(a,d.typeInfo)}return new o9(e*f,this._maxFormatTypeInfo([c.typeInfo,d.typeInfo]));case"%":if(pi(e)&&pi(f)){if(e.length!==f.length)return console.error(`Vector length mismatch. Line ${a.line}.`),null;return new pa(e.map((a,b)=>a%f[b]),c.typeInfo)}if(pi(e))return new pa(e.map((a,b)=>a%f),c.typeInfo);if(pi(f))return new pa(f.map((a,b)=>e%a),d.typeInfo);return new o9(e%f,this._maxFormatTypeInfo([c.typeInfo,d.typeInfo]));case"/":if(pi(e)&&pi(f)){if(e.length!==f.length)return console.error(`Vector length mismatch. Line ${a.line}.`),null;return new pa(e.map((a,b)=>a/f[b]),c.typeInfo)}if(pi(e))return new pa(e.map((a,b)=>a/f),c.typeInfo);if(pi(f))return new pa(f.map((a,b)=>e/a),d.typeInfo);return new o9(e/f,this._maxFormatTypeInfo([c.typeInfo,d.typeInfo]));case"&":if(pi(e)&&pi(f)){if(e.length!==f.length)return console.error(`Vector length mismatch. Line ${a.line}.`),null;return new pa(e.map((a,b)=>a&f[b]),c.typeInfo)}if(pi(e))return new pa(e.map((a,b)=>a&f),c.typeInfo);if(pi(f))return new pa(f.map((a,b)=>e&a),d.typeInfo);return new o9(e&f,this._maxFormatTypeInfo([c.typeInfo,d.typeInfo]));case"|":if(pi(e)&&pi(f)){if(e.length!==f.length)return console.error(`Vector length mismatch. Line ${a.line}.`),null;return new pa(e.map((a,b)=>a|f[b]),c.typeInfo)}if(pi(e))return new pa(e.map((a,b)=>a|f),c.typeInfo);if(pi(f))return new pa(f.map((a,b)=>e|a),d.typeInfo);return new o9(e|f,this._maxFormatTypeInfo([c.typeInfo,d.typeInfo]));case"^":if(pi(e)&&pi(f)){if(e.length!==f.length)return console.error(`Vector length mismatch. Line ${a.line}.`),null;return new pa(e.map((a,b)=>a^f[b]),c.typeInfo)}if(pi(e))return new pa(e.map((a,b)=>a^f),c.typeInfo);if(pi(f))return new pa(f.map((a,b)=>e^a),d.typeInfo);return new o9(e^f,this._maxFormatTypeInfo([c.typeInfo,d.typeInfo]));case"<<":if(pi(e)&&pi(f)){if(e.length!==f.length)return console.error(`Vector length mismatch. Line ${a.line}.`),null;return new pa(e.map((a,b)=>a<<f[b]),c.typeInfo)}if(pi(e))return new pa(e.map((a,b)=>a<<f),c.typeInfo);if(pi(f))return new pa(f.map((a,b)=>e<<a),d.typeInfo);return new o9(e<<f,this._maxFormatTypeInfo([c.typeInfo,d.typeInfo]));case">>":if(pi(e)&&pi(f)){if(e.length!==f.length)return console.error(`Vector length mismatch. Line ${a.line}.`),null;return new pa(e.map((a,b)=>a>>f[b]),c.typeInfo)}if(pi(e))return new pa(e.map((a,b)=>a>>f),c.typeInfo);if(pi(f))return new pa(f.map((a,b)=>e>>a),d.typeInfo);return new o9(e>>f,this._maxFormatTypeInfo([c.typeInfo,d.typeInfo]));case">":if(pi(e)&&pi(f)){if(e.length!==f.length)return console.error(`Vector length mismatch. Line ${a.line}.`),null;return new pa(e.map((a,b)=>+(a>f[b])),c.typeInfo)}if(pi(e))return new pa(e.map((a,b)=>+(a>f)),c.typeInfo);if(pi(f))return new pa(f.map((a,b)=>+(e>a)),d.typeInfo);return new o9(+(e>f),this.getTypeInfo("bool"));case"<":if(pi(e)&&pi(f)){if(e.length!==f.length)return console.error(`Vector length mismatch. Line ${a.line}.`),null;return new pa(e.map((a,b)=>+(a<f[b])),c.typeInfo)}if(pi(e))return new pa(e.map((a,b)=>+(a<f)),c.typeInfo);if(pi(f))return new pa(f.map((a,b)=>+(e<a)),d.typeInfo);return new o9(+(e<f),this.getTypeInfo("bool"));case"==":if(pi(e)&&pi(f)){if(e.length!==f.length)return console.error(`Vector length mismatch. Line ${a.line}.`),null;return new pa(e.map((a,b)=>+(a===f[b])),c.typeInfo)}if(pi(e))return new pa(e.map((a,b)=>+(a==f)),c.typeInfo);if(pi(f))return new pa(f.map((a,b)=>+(e==a)),d.typeInfo);return new o9(+(e===f),this.getTypeInfo("bool"));case"!=":if(pi(e)&&pi(f)){if(e.length!==f.length)return console.error(`Vector length mismatch. Line ${a.line}.`),null;return new pa(e.map((a,b)=>+(a!==f[b])),c.typeInfo)}if(pi(e))return new pa(e.map((a,b)=>+(a!==f)),c.typeInfo);if(pi(f))return new pa(f.map((a,b)=>+(e!==a)),d.typeInfo);return new o9(+(e!==f),this.getTypeInfo("bool"));case">=":if(pi(e)&&pi(f)){if(e.length!==f.length)return console.error(`Vector length mismatch. Line ${a.line}.`),null;return new pa(e.map((a,b)=>+(a>=f[b])),c.typeInfo)}if(pi(e))return new pa(e.map((a,b)=>+(a>=f)),c.typeInfo);if(pi(f))return new pa(f.map((a,b)=>+(e>=a)),d.typeInfo);return new o9(+(e>=f),this.getTypeInfo("bool"));case"<=":if(pi(e)&&pi(f)){if(e.length!==f.length)return console.error(`Vector length mismatch. Line ${a.line}.`),null;return new pa(e.map((a,b)=>+(a<=f[b])),c.typeInfo)}if(pi(e))return new pa(e.map((a,b)=>+(a<=f)),c.typeInfo);if(pi(f))return new pa(f.map((a,b)=>+(e<=a)),d.typeInfo);return new o9(+(e<=f),this.getTypeInfo("bool"));case"&&":if(pi(e)&&pi(f)){if(e.length!==f.length)return console.error(`Vector length mismatch. Line ${a.line}.`),null;return new pa(e.map((a,b)=>a&&f[b]?1:0),c.typeInfo)}if(pi(e))return new pa(e.map((a,b)=>a&&f?1:0),c.typeInfo);if(pi(f))return new pa(f.map((a,b)=>e&&a?1:0),d.typeInfo);return new o9(e&&f?1:0,this.getTypeInfo("bool"));case"||":if(pi(e)&&pi(f)){if(e.length!==f.length)return console.error(`Vector length mismatch. Line ${a.line}.`),null;return new pa(e.map((a,b)=>a||f[b]?1:0),c.typeInfo)}if(pi(e))return new pa(e.map((a,b)=>a||f?1:0),c.typeInfo);if(pi(f))return new pa(f.map((a,b)=>e||a?1:0),d.typeInfo);return new o9(e||f?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${a.operator}. Line ${a.line}`),null}_evalCall(a,b){if(null!==a.cachedReturnValue)return a.cachedReturnValue;let c=b.clone();c.currentFunctionName=a.name;let d=b.getFunction(a.name);if(!d)return a.isBuiltin?this._callBuiltinFunction(a,c):this.getTypeInfo(a.name)?this._evalCreate(a,b):(console.error(`Unknown function "${a.name}". Line ${a.line}`),null);for(let b=0;b<d.node.args.length;++b){let e=d.node.args[b],f=this.evalExpression(a.args[b],c);c.createVariable(e.name,f,e)}return this._execStatements(d.node.body,c)}_callBuiltinFunction(a,b){switch(a.name){case"all":return this.builtins.All(a,b);case"any":return this.builtins.Any(a,b);case"select":return this.builtins.Select(a,b);case"arrayLength":return this.builtins.ArrayLength(a,b);case"abs":return this.builtins.Abs(a,b);case"acos":return this.builtins.Acos(a,b);case"acosh":return this.builtins.Acosh(a,b);case"asin":return this.builtins.Asin(a,b);case"asinh":return this.builtins.Asinh(a,b);case"atan":return this.builtins.Atan(a,b);case"atanh":return this.builtins.Atanh(a,b);case"atan2":return this.builtins.Atan2(a,b);case"ceil":return this.builtins.Ceil(a,b);case"clamp":return this.builtins.Clamp(a,b);case"cos":return this.builtins.Cos(a,b);case"cosh":return this.builtins.Cosh(a,b);case"countLeadingZeros":return this.builtins.CountLeadingZeros(a,b);case"countOneBits":return this.builtins.CountOneBits(a,b);case"countTrailingZeros":return this.builtins.CountTrailingZeros(a,b);case"cross":return this.builtins.Cross(a,b);case"degrees":return this.builtins.Degrees(a,b);case"determinant":return this.builtins.Determinant(a,b);case"distance":return this.builtins.Distance(a,b);case"dot":return this.builtins.Dot(a,b);case"dot4U8Packed":return this.builtins.Dot4U8Packed(a,b);case"dot4I8Packed":return this.builtins.Dot4I8Packed(a,b);case"exp":return this.builtins.Exp(a,b);case"exp2":return this.builtins.Exp2(a,b);case"extractBits":return this.builtins.ExtractBits(a,b);case"faceForward":return this.builtins.FaceForward(a,b);case"firstLeadingBit":return this.builtins.FirstLeadingBit(a,b);case"firstTrailingBit":return this.builtins.FirstTrailingBit(a,b);case"floor":return this.builtins.Floor(a,b);case"fma":return this.builtins.Fma(a,b);case"fract":return this.builtins.Fract(a,b);case"frexp":return this.builtins.Frexp(a,b);case"insertBits":return this.builtins.InsertBits(a,b);case"inverseSqrt":return this.builtins.InverseSqrt(a,b);case"ldexp":return this.builtins.Ldexp(a,b);case"length":return this.builtins.Length(a,b);case"log":return this.builtins.Log(a,b);case"log2":return this.builtins.Log2(a,b);case"max":return this.builtins.Max(a,b);case"min":return this.builtins.Min(a,b);case"mix":return this.builtins.Mix(a,b);case"modf":return this.builtins.Modf(a,b);case"normalize":return this.builtins.Normalize(a,b);case"pow":return this.builtins.Pow(a,b);case"quantizeToF16":return this.builtins.QuantizeToF16(a,b);case"radians":return this.builtins.Radians(a,b);case"reflect":return this.builtins.Reflect(a,b);case"refract":return this.builtins.Refract(a,b);case"reverseBits":return this.builtins.ReverseBits(a,b);case"round":return this.builtins.Round(a,b);case"saturate":return this.builtins.Saturate(a,b);case"sign":return this.builtins.Sign(a,b);case"sin":return this.builtins.Sin(a,b);case"sinh":return this.builtins.Sinh(a,b);case"smoothstep":return this.builtins.SmoothStep(a,b);case"sqrt":return this.builtins.Sqrt(a,b);case"step":return this.builtins.Step(a,b);case"tan":return this.builtins.Tan(a,b);case"tanh":return this.builtins.Tanh(a,b);case"transpose":return this.builtins.Transpose(a,b);case"trunc":return this.builtins.Trunc(a,b);case"dpdx":return this.builtins.Dpdx(a,b);case"dpdxCoarse":return this.builtins.DpdxCoarse(a,b);case"dpdxFine":return this.builtins.DpdxFine(a,b);case"dpdy":return this.builtins.Dpdy(a,b);case"dpdyCoarse":return this.builtins.DpdyCoarse(a,b);case"dpdyFine":return this.builtins.DpdyFine(a,b);case"fwidth":return this.builtins.Fwidth(a,b);case"fwidthCoarse":return this.builtins.FwidthCoarse(a,b);case"fwidthFine":return this.builtins.FwidthFine(a,b);case"textureDimensions":return this.builtins.TextureDimensions(a,b);case"textureGather":return this.builtins.TextureGather(a,b);case"textureGatherCompare":return this.builtins.TextureGatherCompare(a,b);case"textureLoad":return this.builtins.TextureLoad(a,b);case"textureNumLayers":return this.builtins.TextureNumLayers(a,b);case"textureNumLevels":return this.builtins.TextureNumLevels(a,b);case"textureNumSamples":return this.builtins.TextureNumSamples(a,b);case"textureSample":return this.builtins.TextureSample(a,b);case"textureSampleBias":return this.builtins.TextureSampleBias(a,b);case"textureSampleCompare":return this.builtins.TextureSampleCompare(a,b);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(a,b);case"textureSampleGrad":return this.builtins.TextureSampleGrad(a,b);case"textureSampleLevel":return this.builtins.TextureSampleLevel(a,b);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(a,b);case"textureStore":return this.builtins.TextureStore(a,b);case"atomicLoad":return this.builtins.AtomicLoad(a,b);case"atomicStore":return this.builtins.AtomicStore(a,b);case"atomicAdd":return this.builtins.AtomicAdd(a,b);case"atomicSub":return this.builtins.AtomicSub(a,b);case"atomicMax":return this.builtins.AtomicMax(a,b);case"atomicMin":return this.builtins.AtomicMin(a,b);case"atomicAnd":return this.builtins.AtomicAnd(a,b);case"atomicOr":return this.builtins.AtomicOr(a,b);case"atomicXor":return this.builtins.AtomicXor(a,b);case"atomicExchange":return this.builtins.AtomicExchange(a,b);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(a,b);case"pack4x8snorm":return this.builtins.Pack4x8snorm(a,b);case"pack4x8unorm":return this.builtins.Pack4x8unorm(a,b);case"pack4xI8":return this.builtins.Pack4xI8(a,b);case"pack4xU8":return this.builtins.Pack4xU8(a,b);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(a,b);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(a,b);case"pack2x16snorm":return this.builtins.Pack2x16snorm(a,b);case"pack2x16unorm":return this.builtins.Pack2x16unorm(a,b);case"pack2x16float":return this.builtins.Pack2x16float(a,b);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(a,b);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(a,b);case"unpack4xI8":return this.builtins.Unpack4xI8(a,b);case"unpack4xU8":return this.builtins.Unpack4xU8(a,b);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(a,b);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(a,b);case"unpack2x16float":return this.builtins.Unpack2x16float(a,b);case"storageBarrier":return this.builtins.StorageBarrier(a,b);case"textureBarrier":return this.builtins.TextureBarrier(a,b);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(a,b);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(a,b);case"subgroupAdd":return this.builtins.SubgroupAdd(a,b);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(a,b);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(a,b);case"subgroupAll":return this.builtins.SubgroupAll(a,b);case"subgroupAnd":return this.builtins.SubgroupAnd(a,b);case"subgroupAny":return this.builtins.SubgroupAny(a,b);case"subgroupBallot":return this.builtins.SubgroupBallot(a,b);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(a,b);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(a,b);case"subgroupElect":return this.builtins.SubgroupElect(a,b);case"subgroupMax":return this.builtins.SubgroupMax(a,b);case"subgroupMin":return this.builtins.SubgroupMin(a,b);case"subgroupMul":return this.builtins.SubgroupMul(a,b);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(a,b);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(a,b);case"subgroupOr":return this.builtins.SubgroupOr(a,b);case"subgroupShuffle":return this.builtins.SubgroupShuffle(a,b);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(a,b);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(a,b);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(a,b);case"subgroupXor":return this.builtins.SubgroupXor(a,b);case"quadBroadcast":return this.builtins.QuadBroadcast(a,b);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(a,b);case"quadSwapX":return this.builtins.QuadSwapX(a,b);case"quadSwapY":return this.builtins.QuadSwapY(a,b)}let c=b.getFunction(a.name);if(c){let d=b.clone();for(let b=0;b<c.node.args.length;++b){let e=c.node.args[b],f=this.evalExpression(a.args[b],d);d.setVariable(e.name,f,e)}return this._execStatements(c.node.body,d)}return null}_callConstructorValue(a,b){if(!a.args||0===a.args.length)return new o9(0,this.getTypeInfo(a.type));let c=this.evalExpression(a.args[0],b);return c.typeInfo=this.getTypeInfo(a.type),c.getSubData(this,a.postfix,b).clone()}_callConstructorVec(a,b){let c=this.getTypeInfo(a.type),d=a.type.getTypeName(),e=pC[d];if(void 0===e)return console.error(`Invalid vec constructor ${d}. Line ${a.line}`),null;let f=[];if(a instanceof oU)if(a.isVector)for(let b of a.vectorValue)f.push(b);else f.push(a.scalarValue);else if(a.args)for(let c of a.args){let a=this.evalExpression(c,b);if(a instanceof pa){let b=a.data;for(let a=0;a<b.length;++a){let c=b[a];f.push(c)}}else if(a instanceof o9){let b=a.value;f.push(b)}}if(a.type instanceof oK&&null===a.type.format&&(a.type.format=oK.f32),0===f.length)return new pa(Array(e).fill(0),c).getSubData(this,a.postfix,b);if(1===f.length)for(;f.length<e;)f.push(f[0]);return f.length<e?(console.error(`Invalid vec constructor. Line ${a.line}`),null):new pa(f.length>e?f.slice(0,e):f,c).getSubData(this,a.postfix,b)}_callConstructorMatrix(a,b){let c=this.getTypeInfo(a.type),d=a.type.getTypeName(),e=pD[d];if(void 0===e)return console.error(`Invalid matrix constructor ${d}. Line ${a.line}`),null;let f=[];if(a instanceof oU)if(a.isVector)for(let b of a.vectorValue)f.push(b);else f.push(a.scalarValue);else if(a.args)for(let c of a.args){let a=this.evalExpression(c,b);a instanceof pa?f.push(...a.data):a instanceof o9?f.push(a.value):a instanceof pb&&f.push(...a.data)}return(c instanceof nZ&&null===c.format&&(c.format=this.getTypeInfo("f32")),0===f.length)?new pb(Array(e[2]).fill(0),c).getSubData(this,a.postfix,b):f.length!==e[2]?(console.error(`Invalid matrix constructor. Line ${a.line}`),null):new pb(f,c).getSubData(this,a.postfix,b)}}pE._breakObj=new o6(new nU("BREAK",null),null),pE._continueObj=new o6(new nU("CONTINUE",null),null),pE._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class pF{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class pG{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new pF,this._exec=new pE,this._forwardTypeCount=0}parse(a){this._initialize(a),this._deferArrayCountEval.length=0;let b=[];for(;!this._isAtEnd();){let a=this._global_decl_or_directive();if(!a)break;b.push(a)}if(this._deferArrayCountEval.length>0){for(let a of this._deferArrayCountEval){let b=a.arrayType,c=a.countNode;if(c instanceof oS){let a=c.name,d=this._context.constants.get(a);if(d)try{b.count=d.constEvaluate(this._exec)}catch(a){}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(let a of b)a.search(a=>{a instanceof o4||a instanceof oL?a.type=this._forwardType(a.type):a instanceof oM?a.format=this._forwardType(a.format):a instanceof op||a instanceof or||a instanceof os?a.type=this._forwardType(a.type):a instanceof ok?a.returnType=this._forwardType(a.returnType):a instanceof o2&&(a.type=this._forwardType(a.type))});return b}_forwardType(a){if(a instanceof oI){let b=this._getType(a.name);if(b)return b}else a instanceof oL?a.type=this._forwardType(a.type):a instanceof oM&&(a.format=this._forwardType(a.format));return a}_initialize(a){if(a)if("string"==typeof a){let b=new ph(a);this._tokens=b.scanTokens()}else this._tokens=a;else this._tokens=[];this._current=0}_updateNode(a,b){return a.line=null!=b?b:this._currentLine,a}_error(a,b){return{token:a,message:b,toString:()=>`${b}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==pf.eof}_match(a){if(a instanceof pe)return!!this._check(a)&&(this._advance(),!0);for(let b=0,c=a.length;b<c;++b){let c=a[b];if(this._check(c))return this._advance(),!0}return!1}_consume(a,b){if(this._check(a))return this._advance();throw this._error(this._peek(),`${b}. Line:${this._currentLine}`)}_check(a){if(this._isAtEnd())return!1;let b=this._peek();if(a instanceof Array){let c=b.type,d=!1;for(let b of a){if(c===b)return!0;b===pf.tokens.name&&(d=!0)}if(d){let a=pf.tokens.name.rule.exec(b.lexeme);if(a&&0==a.index&&a[0]==b.lexeme)return!0}return!1}if(b.type===a)return!0;if(a===pf.tokens.name){let a=pf.tokens.name.rule.exec(b.lexeme);return a&&0==a.index&&a[0]==b.lexeme}return!1}_advance(){var a,b;return this._currentLine=null!=(b=null==(a=this._peek())?void 0:a.line)?b:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(pf.tokens.semicolon)&&!this._isAtEnd(););if(this._match(pf.keywords.alias)){let a=this._type_alias();return this._consume(pf.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([a]),a}if(this._match(pf.keywords.diagnostic)){let a=this._diagnostic();return this._consume(pf.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([a]),a}if(this._match(pf.keywords.requires)){let a=this._requires_directive();return this._consume(pf.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([a]),a}if(this._match(pf.keywords.enable)){let a=this._enable_directive();return this._consume(pf.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([a]),a}let a=this._attribute();if(this._check(pf.keywords.var)){let b=this._global_variable_decl();return null!=b&&(b.attributes=a),this._consume(pf.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([b]),b}if(this._check(pf.keywords.override)){let b=this._override_variable_decl();return null!=b&&(b.attributes=a),this._consume(pf.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([b]),b}if(this._check(pf.keywords.let)){let b=this._global_let_decl();return null!=b&&(b.attributes=a),this._consume(pf.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([b]),b}if(this._check(pf.keywords.const)){let b=this._global_const_decl();return null!=b&&(b.attributes=a),this._consume(pf.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([b]),b}if(this._check(pf.keywords.struct)){let b=this._struct_decl();return null!=b&&(b.attributes=a),this._exec.reflection.updateAST([b]),b}if(this._check(pf.keywords.fn)){let b=this._function_decl();return null!=b&&(b.attributes=a),this._exec.reflection.updateAST([b]),b}return null}_function_decl(){if(!this._match(pf.keywords.fn))return null;let a=this._currentLine,b=this._consume(pf.tokens.ident,"Expected function name.").toString();this._consume(pf.tokens.paren_left,"Expected '(' for function arguments.");let c=[];if(!this._check(pf.tokens.paren_right))do{if(this._check(pf.tokens.paren_right))break;let a=this._attribute(),b=this._consume(pf.tokens.name,"Expected argument name.").toString();this._consume(pf.tokens.colon,"Expected ':' for argument type.");let d=this._attribute(),e=this._type_decl();null!=e&&(e.attributes=d,c.push(this._updateNode(new o2(b,e,a))))}while(this._match(pf.tokens.comma))this._consume(pf.tokens.paren_right,"Expected ')' after function arguments.");let d=null;if(this._match(pf.tokens.arrow)){let a=this._attribute();null!=(d=this._type_decl())&&(d.attributes=a)}let e=this._compound_statement(),f=this._currentLine;return this._updateNode(new ok(b,c,d,e,a,f),a)}_compound_statement(){let a=[];for(this._consume(pf.tokens.brace_left,"Expected '{' for block.");!this._check(pf.tokens.brace_right);){let b=this._statement();null!==b&&a.push(b)}return this._consume(pf.tokens.brace_right,"Expected '}' for block."),a}_statement(){for(;this._match(pf.tokens.semicolon)&&!this._isAtEnd(););if(this._check(pf.tokens.attr)&&this._attribute(),this._check(pf.keywords.if))return this._if_statement();if(this._check(pf.keywords.switch))return this._switch_statement();if(this._check(pf.keywords.loop))return this._loop_statement();if(this._check(pf.keywords.for))return this._for_statement();if(this._check(pf.keywords.while))return this._while_statement();if(this._check(pf.keywords.continuing))return this._continuing_statement();if(this._check(pf.keywords.static_assert))return this._static_assert_statement();if(this._check(pf.tokens.brace_left))return this._compound_statement();let a=null;if(this._check(pf.keywords.return))a=this._return_statement();else if(this._check([pf.keywords.var,pf.keywords.let,pf.keywords.const]))a=this._variable_statement();else if(this._match(pf.keywords.discard))a=this._updateNode(new oE);else if(this._match(pf.keywords.break)){let b=this._updateNode(new oF);this._currentLoop.length>0&&(b.loopId=this._currentLoop[this._currentLoop.length-1].id),a=b,this._check(pf.keywords.if)&&(this._advance(),b.condition=this._optional_paren_expression())}else if(this._match(pf.keywords.continue)){let b=this._updateNode(new oG);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${b.line}`);b.loopId=this._currentLoop[this._currentLoop.length-1].id,a=b}else a=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return null!=a&&this._consume(pf.tokens.semicolon,"Expected ';' after statement."),a}_static_assert_statement(){if(!this._match(pf.keywords.static_assert))return null;let a=this._currentLine,b=this._optional_paren_expression();return this._updateNode(new ol(b),a)}_while_statement(){if(!this._match(pf.keywords.while))return null;let a=this._updateNode(new om(null,null));return this._currentLoop.push(a),a.condition=this._optional_paren_expression(),this._check(pf.tokens.attr)&&this._attribute(),a.body=this._compound_statement(),this._currentLoop.pop(),a}_continuing_statement(){let a=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(pf.keywords.continuing))return null;let b=this._currentLine,c=this._compound_statement();return this._updateNode(new on(c,a),b)}_for_statement(){if(!this._match(pf.keywords.for))return null;this._consume(pf.tokens.paren_left,"Expected '('.");let a=this._updateNode(new oo(null,null,null,null));return this._currentLoop.push(a),a.init=this._check(pf.tokens.semicolon)?null:this._for_init(),this._consume(pf.tokens.semicolon,"Expected ';'."),a.condition=this._check(pf.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(pf.tokens.semicolon,"Expected ';'."),a.increment=this._check(pf.tokens.paren_right)?null:this._for_increment(),this._consume(pf.tokens.paren_right,"Expected ')'."),this._check(pf.tokens.attr)&&this._attribute(),a.body=this._compound_statement(),this._currentLoop.pop(),a}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(pf.keywords.var)){let a=this._variable_decl();if(null===a)throw this._error(this._peek(),"Variable declaration expected.");let b=null;return this._match(pf.tokens.equal)&&(b=this._short_circuit_or_expression()),this._updateNode(new op(a.name,a.type,a.storage,a.access,b),a.line)}if(this._match(pf.keywords.let)){let a=this._currentLine,b=this._consume(pf.tokens.name,"Expected name for let.").toString(),c=null;if(this._match(pf.tokens.colon)){let a=this._attribute();null!=(c=this._type_decl())&&(c.attributes=a)}this._consume(pf.tokens.equal,"Expected '=' for let.");let d=this._short_circuit_or_expression();return this._updateNode(new or(b,c,null,null,d),a)}if(this._match(pf.keywords.const)){let a=this._currentLine,b=this._consume(pf.tokens.name,"Expected name for const.").toString(),c=null;if(this._match(pf.tokens.colon)){let a=this._attribute();null!=(c=this._type_decl())&&(c.attributes=a)}this._consume(pf.tokens.equal,"Expected '=' for const.");let d=this._short_circuit_or_expression();return null===c&&d instanceof oU&&(c=d.type),this._updateNode(new os(b,c,null,null,d),a)}return null}_increment_decrement_statement(){let a=this._current,b=this._unary_expression();if(null==b)return null;if(!this._check(pf.increment_operators))return this._current=a,null;let c=this._consume(pf.increment_operators,"Expected increment operator");return this._updateNode(new ot(c.type===pf.tokens.plus_plus?x_.increment:x_.decrement,b))}_assignment_statement(){let a=null,b=this._currentLine;if(this._check(pf.tokens.brace_right))return null;let c=this._match(pf.tokens.underscore);if(c||(a=this._unary_expression()),!c&&null==a)return null;let d=this._consume(pf.assignment_operators,"Expected assignment operator."),e=this._short_circuit_or_expression();return this._updateNode(new ou(x0.parse(d.lexeme),a,e),b)}_func_call_statement(){if(!this._check(pf.tokens.ident))return null;let a=this._currentLine,b=this._current,c=this._consume(pf.tokens.ident,"Expected function name."),d=this._argument_expression_list();return null===d?(this._current=b,null):this._updateNode(new ov(c.lexeme,d),a)}_loop_statement(){if(!this._match(pf.keywords.loop))return null;this._check(pf.tokens.attr)&&this._attribute(),this._consume(pf.tokens.brace_left,"Expected '{' for loop.");let a=this._updateNode(new ow([],null));this._currentLoop.push(a);let b=this._statement();for(;null!==b;){if(Array.isArray(b))for(let c of b)a.body.push(c);else a.body.push(b);if(b instanceof on){a.continuing=b;break}b=this._statement()}return this._currentLoop.pop(),this._consume(pf.tokens.brace_right,"Expected '}' for loop."),a}_switch_statement(){if(!this._match(pf.keywords.switch))return null;let a=this._updateNode(new ox(null,[]));if(this._currentLoop.push(a),a.condition=this._optional_paren_expression(),this._check(pf.tokens.attr)&&this._attribute(),this._consume(pf.tokens.brace_left,"Expected '{' for switch."),a.cases=this._switch_body(),null==a.cases||0==a.cases.length)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(pf.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),a}_switch_body(){let a=[],b=!1;for(;this._check([pf.keywords.default,pf.keywords.case]);){if(this._match(pf.keywords.case)){let c=this._case_selectors();for(let a of c)if(a instanceof o_){if(b)throw this._error(this._previous(),"Multiple default cases in switch statement.");b=!0;break}this._match(pf.tokens.colon),this._check(pf.tokens.attr)&&this._attribute(),this._consume(pf.tokens.brace_left,"Exected '{' for switch case.");let d=this._case_body();this._consume(pf.tokens.brace_right,"Exected '}' for switch case."),a.push(this._updateNode(new o0(c,d)))}if(this._match(pf.keywords.default)){if(b)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(pf.tokens.colon),this._check(pf.tokens.attr)&&this._attribute(),this._consume(pf.tokens.brace_left,"Exected '{' for switch default.");let c=this._case_body();this._consume(pf.tokens.brace_right,"Exected '}' for switch default."),a.push(this._updateNode(new o1(c)))}}return a}_case_selectors(){let a=[];for(this._match(pf.keywords.default)?a.push(this._updateNode(new o_)):a.push(this._shift_expression());this._match(pf.tokens.comma);)this._match(pf.keywords.default)?a.push(this._updateNode(new o_)):a.push(this._shift_expression());return a}_case_body(){if(this._match(pf.keywords.fallthrough))return this._consume(pf.tokens.semicolon,"Expected ';'"),[];let a=this._statement();if(null==a)return[];a instanceof Array||(a=[a]);let b=this._case_body();return 0==b.length?a:[...a,b[0]]}_if_statement(){if(!this._match(pf.keywords.if))return null;let a=this._currentLine,b=this._optional_paren_expression();this._check(pf.tokens.attr)&&this._attribute();let c=this._compound_statement(),d=[];this._match_elseif()&&(this._check(pf.tokens.attr)&&this._attribute(),d=this._elseif_statement(d));let e=null;return this._match(pf.keywords.else)&&(this._check(pf.tokens.attr)&&this._attribute(),e=this._compound_statement()),this._updateNode(new oy(b,c,d,e),a)}_match_elseif(){return this._tokens[this._current].type===pf.keywords.else&&this._tokens[this._current+1].type===pf.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(a=[]){let b=this._optional_paren_expression(),c=this._compound_statement();return a.push(this._updateNode(new o3(b,c))),this._match_elseif()&&(this._check(pf.tokens.attr)&&this._attribute(),this._elseif_statement(a)),a}_return_statement(){if(!this._match(pf.keywords.return))return null;let a=this._short_circuit_or_expression();return this._updateNode(new oz(a))}_short_circuit_or_expression(){let a=this._short_circuit_and_expr();for(;this._match(pf.tokens.or_or);)a=this._updateNode(new oZ(this._previous().toString(),a,this._short_circuit_and_expr()));return a}_short_circuit_and_expr(){let a=this._inclusive_or_expression();for(;this._match(pf.tokens.and_and);)a=this._updateNode(new oZ(this._previous().toString(),a,this._inclusive_or_expression()));return a}_inclusive_or_expression(){let a=this._exclusive_or_expression();for(;this._match(pf.tokens.or);)a=this._updateNode(new oZ(this._previous().toString(),a,this._exclusive_or_expression()));return a}_exclusive_or_expression(){let a=this._and_expression();for(;this._match(pf.tokens.xor);)a=this._updateNode(new oZ(this._previous().toString(),a,this._and_expression()));return a}_and_expression(){let a=this._equality_expression();for(;this._match(pf.tokens.and);)a=this._updateNode(new oZ(this._previous().toString(),a,this._equality_expression()));return a}_equality_expression(){let a=this._relational_expression();return this._match([pf.tokens.equal_equal,pf.tokens.not_equal])?this._updateNode(new oZ(this._previous().toString(),a,this._relational_expression())):a}_relational_expression(){let a=this._shift_expression();for(;this._match([pf.tokens.less_than,pf.tokens.greater_than,pf.tokens.less_than_equal,pf.tokens.greater_than_equal]);)a=this._updateNode(new oZ(this._previous().toString(),a,this._shift_expression()));return a}_shift_expression(){let a=this._additive_expression();for(;this._match([pf.tokens.shift_left,pf.tokens.shift_right]);)a=this._updateNode(new oZ(this._previous().toString(),a,this._additive_expression()));return a}_additive_expression(){let a=this._multiplicative_expression();for(;this._match([pf.tokens.plus,pf.tokens.minus]);)a=this._updateNode(new oZ(this._previous().toString(),a,this._multiplicative_expression()));return a}_multiplicative_expression(){let a=this._unary_expression();for(;this._match([pf.tokens.star,pf.tokens.forward_slash,pf.tokens.modulo]);)a=this._updateNode(new oZ(this._previous().toString(),a,this._unary_expression()));return a}_unary_expression(){return this._match([pf.tokens.minus,pf.tokens.bang,pf.tokens.tilde,pf.tokens.star,pf.tokens.and])?this._updateNode(new oY(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){let a=this._primary_expression(),b=this._postfix_expression();return b&&(a.postfix=b),a}_postfix_expression(){if(this._match(pf.tokens.bracket_left)){let a=this._short_circuit_or_expression();this._consume(pf.tokens.bracket_right,"Expected ']'.");let b=this._updateNode(new oW(a)),c=this._postfix_expression();return c&&(b.postfix=c),b}if(this._match(pf.tokens.period)){let a=this._consume(pf.tokens.name,"Expected member name."),b=this._postfix_expression(),c=this._updateNode(new oP(a.lexeme));return b&&(c.postfix=b),c}return null}_getStruct(a){return this._context.aliases.has(a)?this._context.aliases.get(a).type:this._context.structs.has(a)?this._context.structs.get(a):null}_getType(a){let b=this._getStruct(a);if(null!==b)return b;switch(a){case"void":return oH.void;case"bool":return oH.bool;case"i32":return oH.i32;case"u32":return oH.u32;case"f32":return oH.f32;case"f16":return oH.f16;case"vec2f":return oK.vec2f;case"vec3f":return oK.vec3f;case"vec4f":return oK.vec4f;case"vec2i":return oK.vec2i;case"vec3i":return oK.vec3i;case"vec4i":return oK.vec4i;case"vec2u":return oK.vec2u;case"vec3u":return oK.vec3u;case"vec4u":return oK.vec4u;case"vec2h":return oK.vec2h;case"vec3h":return oK.vec3h;case"vec4h":return oK.vec4h;case"mat2x2f":return oK.mat2x2f;case"mat2x3f":return oK.mat2x3f;case"mat2x4f":return oK.mat2x4f;case"mat3x2f":return oK.mat3x2f;case"mat3x3f":return oK.mat3x3f;case"mat3x4f":return oK.mat3x4f;case"mat4x2f":return oK.mat4x2f;case"mat4x3f":return oK.mat4x3f;case"mat4x4f":return oK.mat4x4f;case"mat2x2h":return oK.mat2x2h;case"mat2x3h":return oK.mat2x3h;case"mat2x4h":return oK.mat2x4h;case"mat3x2h":return oK.mat3x2h;case"mat3x3h":return oK.mat3x3h;case"mat3x4h":return oK.mat3x4h;case"mat4x2h":return oK.mat4x2h;case"mat4x3h":return oK.mat4x3h;case"mat4x4h":return oK.mat4x4h;case"mat2x2i":return oK.mat2x2i;case"mat2x3i":return oK.mat2x3i;case"mat2x4i":return oK.mat2x4i;case"mat3x2i":return oK.mat3x2i;case"mat3x3i":return oK.mat3x3i;case"mat3x4i":return oK.mat3x4i;case"mat4x2i":return oK.mat4x2i;case"mat4x3i":return oK.mat4x3i;case"mat4x4i":return oK.mat4x4i;case"mat2x2u":return oK.mat2x2u;case"mat2x3u":return oK.mat2x3u;case"mat2x4u":return oK.mat2x4u;case"mat3x2u":return oK.mat3x2u;case"mat3x3u":return oK.mat3x3u;case"mat3x4u":return oK.mat3x4u;case"mat4x2u":return oK.mat4x2u;case"mat4x3u":return oK.mat4x3u;case"mat4x4u":return oK.mat4x4u}return null}_validateTypeRange(a,b){if("i32"===b.name){if(a<-0x80000000||a>0x7fffffff)throw this._error(this._previous(),`Value out of range for i32: ${a}. Line: ${this._currentLine}.`)}else if("u32"===b.name&&(a<0||a>0xffffffff))throw this._error(this._previous(),`Value out of range for u32: ${a}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(pf.tokens.ident)){let a=this._previous().toString();if(this._check(pf.tokens.paren_left)){let b=this._argument_expression_list(),c=this._getType(a);return null!==c?this._updateNode(new oQ(c,b)):this._updateNode(new oR(a,b))}if(this._context.constants.has(a)){let b=this._context.constants.get(a);return this._updateNode(new oT(a,b.value))}return this._updateNode(new oS(a))}if(this._match(pf.tokens.int_literal)){let a=this._previous().toString(),b=a.endsWith("i")||a.endsWith("i")?oH.i32:a.endsWith("u")||a.endsWith("U")?oH.u32:oH.x32,c=parseInt(a);return this._validateTypeRange(c,b),this._updateNode(new oU(new o9(c,this._exec.getTypeInfo(b)),b))}if(this._match(pf.tokens.uint_literal)){let a=parseInt(this._previous().toString());return this._validateTypeRange(a,oH.u32),this._updateNode(new oU(new o9(a,this._exec.getTypeInfo(oH.u32)),oH.u32))}if(this._match([pf.tokens.decimal_float_literal,pf.tokens.hex_float_literal])){let a=this._previous().toString(),b=a.endsWith("h");b&&(a=a.substring(0,a.length-1));let c=parseFloat(a);this._validateTypeRange(c,b?oH.f16:oH.f32);let d=b?oH.f16:oH.f32;return this._updateNode(new oU(new o9(c,this._exec.getTypeInfo(d)),d))}if(this._match([pf.keywords.true,pf.keywords.false])){let a=this._previous().toString()===pf.keywords.true.rule;return this._updateNode(new oU(new o9(+!!a,this._exec.getTypeInfo(oH.bool)),oH.bool))}if(this._check(pf.tokens.paren_left))return this._paren_expression();if(this._match(pf.keywords.bitcast)){this._consume(pf.tokens.less_than,"Expected '<'.");let a=this._type_decl();this._consume(pf.tokens.greater_than,"Expected '>'.");let b=this._paren_expression();return this._updateNode(new oV(a,b))}let a=this._type_decl(),b=this._argument_expression_list();return this._updateNode(new oQ(a,b))}_argument_expression_list(){if(!this._match(pf.tokens.paren_left))return null;let a=[];do{if(this._check(pf.tokens.paren_right))break;let b=this._short_circuit_or_expression();a.push(b)}while(this._match(pf.tokens.comma))return this._consume(pf.tokens.paren_right,"Expected ')' for agument list"),a}_optional_paren_expression(){this._match(pf.tokens.paren_left);let a=this._short_circuit_or_expression();return this._match(pf.tokens.paren_right),a}_paren_expression(){this._consume(pf.tokens.paren_left,"Expected '('.");let a=this._short_circuit_or_expression();return this._consume(pf.tokens.paren_right,"Expected ')'."),a}_struct_decl(){if(!this._match(pf.keywords.struct))return null;let a=this._currentLine,b=this._consume(pf.tokens.ident,"Expected name for struct.").toString();this._consume(pf.tokens.brace_left,"Expected '{' for struct body.");let c=[];for(;!this._check(pf.tokens.brace_right);){let a=this._attribute(),b=this._consume(pf.tokens.name,"Expected variable name.").toString();this._consume(pf.tokens.colon,"Expected ':' for struct member type.");let d=this._attribute(),e=this._type_decl();null!=e&&(e.attributes=d),this._check(pf.tokens.brace_right)?this._match(pf.tokens.comma):this._consume(pf.tokens.comma,"Expected ',' for struct member."),c.push(this._updateNode(new o4(b,e,a)))}this._consume(pf.tokens.brace_right,"Expected '}' after struct body.");let d=this._currentLine,e=this._updateNode(new oJ(b,c,a,d),a);return this._context.structs.set(b,e),e}_global_variable_decl(){let a=this._variable_decl();if(!a)return null;if(this._match(pf.tokens.equal)&&(a.value=this._const_expression()),null!==a.type&&a.value instanceof oU){if("x32"!==a.value.type.name&&a.type.getTypeName()!==a.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${a.value.type.name} to ${a.type.name}. Line:${this._currentLine}`);a.value.isScalar&&this._validateTypeRange(a.value.scalarValue,a.type),a.value.type=a.type}else null===a.type&&a.value instanceof oU&&(a.type="x32"===a.value.type.name?oH.i32:a.value.type,a.value.isScalar&&this._validateTypeRange(a.value.scalarValue,a.type));return a}_override_variable_decl(){let a=this._override_decl();return a&&this._match(pf.tokens.equal)&&(a.value=this._const_expression()),a}_global_const_decl(){var a;if(!this._match(pf.keywords.const))return null;let b=this._consume(pf.tokens.name,"Expected variable name"),c=this._currentLine,d=null;if(this._match(pf.tokens.colon)){let a=this._attribute();null!=(d=this._type_decl())&&(d.attributes=a)}let e=null;this._consume(pf.tokens.equal,"const declarations require an assignment");let f=this._short_circuit_or_expression();try{let a=[oH.f32],c=f.constEvaluate(this._exec,a);c instanceof o9&&this._validateTypeRange(c.value,a[0]),a[0]instanceof oK&&null===a[0].format&&c.typeInfo instanceof nZ&&null!==c.typeInfo.format&&("f16"===c.typeInfo.format.name?a[0].format=oH.f16:"f32"===c.typeInfo.format.name?a[0].format=oH.f32:"i32"===c.typeInfo.format.name?a[0].format=oH.i32:"u32"===c.typeInfo.format.name?a[0].format=oH.u32:"bool"===c.typeInfo.format.name?a[0].format=oH.bool:console.error(`TODO: impelement template format type ${c.typeInfo.format.name}`)),e=this._updateNode(new oU(c,a[0])),this._exec.context.setVariable(b.toString(),c)}catch(a){e=f}if(null!==d&&e instanceof oU){if("x32"!==e.type.name&&d.getTypeName()!==e.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${e.type.name} to ${d.name}. Line:${this._currentLine}`);e.type=d,e.isScalar&&this._validateTypeRange(e.scalarValue,e.type)}else null===d&&e instanceof oU&&(d=null!=(a=null==e?void 0:e.type)?a:oH.f32)===oH.x32&&(d=oH.i32);let g=this._updateNode(new os(b.toString(),d,"","",e),c);return this._context.constants.set(g.name,g),g}_global_let_decl(){if(!this._match(pf.keywords.let))return null;let a=this._currentLine,b=this._consume(pf.tokens.name,"Expected variable name"),c=null;if(this._match(pf.tokens.colon)){let a=this._attribute();null!=(c=this._type_decl())&&(c.attributes=a)}let d=null;if(this._match(pf.tokens.equal)&&(d=this._const_expression()),null!==c&&d instanceof oU){if("x32"!==d.type.name&&c.getTypeName()!==d.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${d.type.name} to ${c.name}. Line:${this._currentLine}`);d.type=c}else null===c&&d instanceof oU&&(c="x32"===d.type.name?oH.i32:d.type);return d instanceof oU&&d.isScalar&&this._validateTypeRange(d.scalarValue,c),this._updateNode(new or(b.toString(),c,"","",d),a)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(pf.keywords.var))return null;let a=this._currentLine,b="",c="";this._match(pf.tokens.less_than)&&(b=this._consume(pf.storage_class,"Expected storage_class.").toString(),this._match(pf.tokens.comma)&&(c=this._consume(pf.access_mode,"Expected access_mode.").toString()),this._consume(pf.tokens.greater_than,"Expected '>'."));let d=this._consume(pf.tokens.name,"Expected variable name"),e=null;if(this._match(pf.tokens.colon)){let a=this._attribute();null!=(e=this._type_decl())&&(e.attributes=a)}return this._updateNode(new op(d.toString(),e,b,c,null),a)}_override_decl(){if(!this._match(pf.keywords.override))return null;let a=this._consume(pf.tokens.name,"Expected variable name"),b=null;if(this._match(pf.tokens.colon)){let a=this._attribute();null!=(b=this._type_decl())&&(b.attributes=a)}return this._updateNode(new oq(a.toString(),b,null))}_diagnostic(){this._consume(pf.tokens.paren_left,"Expected '('");let a=this._consume(pf.tokens.ident,"Expected severity control name.");this._consume(pf.tokens.comma,"Expected ','");let b=this._consume(pf.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(pf.tokens.period)&&(b+=`.${this._consume(pf.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(pf.tokens.paren_right,"Expected ')'"),this._updateNode(new oC(a.toString(),b))}_enable_directive(){let a=this._consume(pf.tokens.ident,"identity expected.");return this._updateNode(new oA(a.toString()))}_requires_directive(){let a=[this._consume(pf.tokens.ident,"identity expected.").toString()];for(;this._match(pf.tokens.comma);){let b=this._consume(pf.tokens.ident,"identity expected.");a.push(b.toString())}return this._updateNode(new oB(a))}_type_alias(){let a=this._consume(pf.tokens.ident,"identity expected.");this._consume(pf.tokens.equal,"Expected '=' for type alias.");let b=this._type_decl();if(null===b)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(b.name)&&(b=this._context.aliases.get(b.name).type);let c=this._updateNode(new oD(a.toString(),b));return this._context.aliases.set(c.name,c),c}_type_decl(){if(this._check([pf.tokens.ident,...pf.texel_format,pf.keywords.bool,pf.keywords.f32,pf.keywords.i32,pf.keywords.u32])){let a=this._advance().toString();if(this._context.structs.has(a))return this._context.structs.get(a);if(this._context.aliases.has(a))return this._context.aliases.get(a).type;if(!this._getType(a)){let b=this._updateNode(new oI(a));return this._forwardTypeCount++,b}return this._updateNode(new oH(a))}let a=this._texture_sampler_types();if(a)return a;if(this._check(pf.template_types)){let a=this._advance().toString(),b=null,c=null;return this._match(pf.tokens.less_than)&&(b=this._type_decl(),c=null,this._match(pf.tokens.comma)&&(c=this._consume(pf.access_mode,"Expected access_mode for pointer").toString()),this._consume(pf.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new oK(a,b,c))}if(this._match(pf.keywords.ptr)){let a=this._previous().toString();this._consume(pf.tokens.less_than,"Expected '<' for pointer.");let b=this._consume(pf.storage_class,"Expected storage_class for pointer");this._consume(pf.tokens.comma,"Expected ',' for pointer.");let c=this._type_decl(),d=null;return this._match(pf.tokens.comma)&&(d=this._consume(pf.access_mode,"Expected access_mode for pointer").toString()),this._consume(pf.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new oL(a,b.toString(),c,d))}let b=this._attribute();if(this._match(pf.keywords.array)){let a=null,c=-1,d=this._previous(),e=null;if(this._match(pf.tokens.less_than)){a=this._type_decl(),this._context.aliases.has(a.name)&&(a=this._context.aliases.get(a.name).type);let b="";if(this._match(pf.tokens.comma)){e=this._shift_expression();try{b=e.constEvaluate(this._exec).toString(),e=null}catch(a){b="1"}}this._consume(pf.tokens.greater_than,"Expected '>' for array."),c=b?parseInt(b):0}let f=this._updateNode(new oM(d.toString(),b,a,c));return e&&this._deferArrayCountEval.push({arrayType:f,countNode:e}),f}return null}_texture_sampler_types(){if(this._match(pf.sampler_type)||this._match(pf.depth_texture_type))return this._updateNode(new oN(this._previous().toString(),null,null));if(this._match(pf.sampled_texture_type)||this._match(pf.multisampled_texture_type)){let a=this._previous();this._consume(pf.tokens.less_than,"Expected '<' for sampler type.");let b=this._type_decl();return this._consume(pf.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new oN(a.toString(),b,null))}if(this._match(pf.storage_texture_type)){let a=this._previous();this._consume(pf.tokens.less_than,"Expected '<' for sampler type.");let b=this._consume(pf.texel_format,"Invalid texel format.").toString();this._consume(pf.tokens.comma,"Expected ',' after texel format.");let c=this._consume(pf.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(pf.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new oN(a.toString(),b,c))}return null}_attribute(){let a=[];for(;this._match(pf.tokens.attr);){let b=this._consume(pf.attribute_name,"Expected attribute name"),c=this._updateNode(new o5(b.toString(),null));if(this._match(pf.tokens.paren_left)){if(c.value=this._consume(pf.literal_or_ident,"Expected attribute value").toString(),this._check(pf.tokens.comma)){this._advance();do{let a=this._consume(pf.literal_or_ident,"Expected attribute value").toString();c.value instanceof Array||(c.value=[c.value]),c.value.push(a)}while(this._match(pf.tokens.comma))}this._consume(pf.tokens.paren_right,"Expected ')'")}a.push(c)}return 0==a.length?null:a}}class pH extends pv{constructor(a){super(),a&&this.update(a)}update(a){let b=(new pG).parse(a);this.updateAST(b)}}function pI(a){return a?.format?`${a.name}<${a.format.name}>`:a.name}var pJ=a.i(64356);let pK={};function pL(a="id"){pK[a]=pK[a]||1;let b=pK[a]++;return`${a}-${b}`}class pM{id;userData={};topology;bufferLayout=[];vertexCount;indices;attributes;constructor(a){if(this.id=a.id||pL("geometry"),this.topology=a.topology,this.indices=a.indices||null,this.attributes=a.attributes,this.vertexCount=a.vertexCount,this.bufferLayout=a.bufferLayout||[],this.indices&&!(this.indices.usage&nr.Buffer.INDEX))throw Error("Index buffer must have INDEX usage")}destroy(){for(let a of(this.indices?.destroy(),Object.values(this.attributes)))a.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(a){return a.byteLength/12}}var pN=a.i(74968);class pO extends pN.Resource{get[Symbol.toStringTag](){return"ComputePipeline"}hash="";shaderLayout;constructor(a,b){super(a,b,pO.defaultProps),this.shaderLayout=b.shaderLayout}static defaultProps={...pN.Resource.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0}}class pP{static defaultProps={...nM.RenderPipeline.defaultProps};static getDefaultPipelineFactory(a){return a._lumaData.defaultPipelineFactory=a._lumaData.defaultPipelineFactory||new pP(a),a._lumaData.defaultPipelineFactory}device;cachingEnabled;destroyPolicy;debug;_hashCounter=0;_hashes={};_renderPipelineCache={};_computePipelineCache={};get[Symbol.toStringTag](){return"PipelineFactory"}toString(){return`PipelineFactory(${this.device.id})`}constructor(a){this.device=a,this.cachingEnabled=a.props._cachePipelines,this.destroyPolicy=a.props._cacheDestroyPolicy,this.debug=a.props.debugFactories}createRenderPipeline(a){if(!this.cachingEnabled)return this.device.createRenderPipeline(a);let b={...nM.RenderPipeline.defaultProps,...a},c=this._renderPipelineCache,d=this._hashRenderPipeline(b),e=c[d]?.pipeline;return e?(c[d].useCount++,this.debug&&ff.log.warn(`${this}: ${c[d].pipeline} reused, count=${c[d].useCount}, (id=${a.id})`)()):((e=this.device.createRenderPipeline({...b,id:b.id?`${b.id}-cached`:pL("unnamed-cached")})).hash=d,c[d]={pipeline:e,useCount:1},this.debug&&ff.log.warn(`${this}: ${e} created, count=${c[d].useCount}`)()),e}createComputePipeline(a){if(!this.cachingEnabled)return this.device.createComputePipeline(a);let b={...pO.defaultProps,...a},c=this._computePipelineCache,d=this._hashComputePipeline(b),e=c[d]?.pipeline;return e?(c[d].useCount++,this.debug&&ff.log.warn(`${this}: ${c[d].pipeline} reused, count=${c[d].useCount}, (id=${a.id})`)()):((e=this.device.createComputePipeline({...b,id:b.id?`${b.id}-cached`:void 0})).hash=d,c[d]={pipeline:e,useCount:1},this.debug&&ff.log.warn(`${this}: ${e} created, count=${c[d].useCount}`)()),e}release(a){if(!this.cachingEnabled)return void a.destroy();let b=this._getCache(a),c=a.hash;b[c].useCount--,0===b[c].useCount?(this._destroyPipeline(a),this.debug&&ff.log.warn(`${this}: ${a} released and destroyed`)()):b[c].useCount<0?(ff.log.error(`${this}: ${a} released, useCount < 0, resetting`)(),b[c].useCount=0):this.debug&&ff.log.warn(`${this}: ${a} released, count=${b[c].useCount}`)()}_destroyPipeline(a){let b=this._getCache(a);switch(this.destroyPolicy){case"never":return!1;case"unused":return delete b[a.hash],a.destroy(),!0}}_getCache(a){let b;if(a instanceof pO&&(b=this._computePipelineCache),a instanceof nM.RenderPipeline&&(b=this._renderPipelineCache),!b)throw Error(`${this}`);if(!b[a.hash])throw Error(`${this}: ${a} matched incorrect entry`);return b}_hashComputePipeline(a){let{type:b}=this.device,c=this._getHash(a.shader.source);return`${b}/C/${c}`}_hashRenderPipeline(a){let b=a.vs?this._getHash(a.vs.source):0,c=a.fs?this._getHash(a.fs.source):0,d=this._getHash(JSON.stringify(a.bufferLayout)),{type:e}=this.device;if("webgl"===e)return`${e}/R/${b}/${c}V-BL${d}`;{let f=this._getHash(JSON.stringify(a.parameters));return`${e}/R/${b}/${c}V-T${a.topology}P${f}BL${d}`}}_getHash(a){return void 0===this._hashes[a]&&(this._hashes[a]=this._hashCounter++),this._hashes[a]}}var pQ=a.i(34295);class pR{static defaultProps={...pQ.Shader.defaultProps};static getDefaultShaderFactory(a){return a._lumaData.defaultShaderFactory||=new pR(a),a._lumaData.defaultShaderFactory}device;cachingEnabled;destroyPolicy;debug;_cache={};get[Symbol.toStringTag](){return"ShaderFactory"}toString(){return`${this[Symbol.toStringTag]}(${this.device.id})`}constructor(a){this.device=a,this.cachingEnabled=a.props._cacheShaders,this.destroyPolicy=a.props._cacheDestroyPolicy,this.debug=!0}createShader(a){if(!this.cachingEnabled)return this.device.createShader(a);let b=this._hashShader(a),c=this._cache[b];if(c)c.useCount++,this.debug&&ff.log.warn(`${this}: Reusing shader ${c.shader.id} count=${c.useCount}`)();else{let d=this.device.createShader({...a,id:a.id?`${a.id}-cached`:void 0});this._cache[b]=c={shader:d,useCount:1},this.debug&&ff.log.warn(`${this}: Created new shader ${d.id}`)()}return c.shader}release(a){if(!this.cachingEnabled)return void a.destroy();let b=this._hashShader(a),c=this._cache[b];if(c)if(c.useCount--,0===c.useCount)"unused"===this.destroyPolicy&&(delete this._cache[b],c.shader.destroy(),this.debug&&ff.log.warn(`${this}: Releasing shader ${a.id}, destroyed`)());else if(c.useCount<0)throw Error(`ShaderFactory: Shader ${a.id} released too many times`);else this.debug&&ff.log.warn(`${this}: Releasing shader ${a.id} count=${c.useCount}`)()}_hashShader(a){return`${a.stage}:${a.source}`}}let pS=null,pT=null;class pU{bufferLayouts;constructor(a){this.bufferLayouts=a}getBufferLayout(a){return this.bufferLayouts.find(b=>b.name===a)||null}getAttributeNamesForBuffer(a){return a.attributes?a.attributes?.map(a=>a.attribute):[a.name]}mergeBufferLayouts(a,b){let c=[...a];for(let a of b){let b=c.findIndex(b=>b.name===a.name);b<0?c.push(a):c[b]=a}return c}getBufferIndex(a){let b=this.bufferLayouts.findIndex(b=>b.name===a);return -1===b&&ff.log.warn(`BufferLayout: Missing buffer for "${a}".`)(),b}}class pV{options={disableWarnings:!1};modules;moduleUniforms;moduleBindings;constructor(a,b){for(const c of(Object.assign(this.options,b),e_(Object.values(a).filter(a=>a.dependencies))))a[c.name]=c;for(const[b,c]of(ff.log.log(1,"Creating ShaderInputs with modules",Object.keys(a))(),this.modules=a,this.moduleUniforms={},this.moduleBindings={},Object.entries(a)))this._addModule(c),c.name&&b!==c.name&&!this.options.disableWarnings&&ff.log.warn(`Module name: ${b} vs ${c.name}`)()}destroy(){}setProps(a){for(let b of Object.keys(a)){let c=a[b]||{},d=this.modules[b];if(!d){this.options.disableWarnings||ff.log.warn(`Module ${b} not found`)();continue}let e=this.moduleUniforms[b],f=this.moduleBindings[b],{uniforms:g,bindings:h}=function(a){let b={bindings:{},uniforms:{}};return Object.keys(a).forEach(c=>{let d=a[c];(!ArrayBuffer.isView(d)||d instanceof DataView)&&(Array.isArray(d)?0!==d.length&&"number"!=typeof d[0]:1)&&"number"!=typeof d&&"boolean"!=typeof d?b.bindings[c]=d:b.uniforms[c]=d}),b}(d.getUniforms?.(c,e)||c);this.moduleUniforms[b]={...e,...g},this.moduleBindings[b]={...f,...h}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){let a={};for(let b of Object.values(this.moduleBindings))Object.assign(a,b);return a}getDebugTable(){let a={};for(let[b,c]of Object.entries(this.moduleUniforms))for(let[d,e]of Object.entries(c))a[`${b}.${d}`]={type:this.modules[b].uniformTypes?.[d],value:String(e)};return a}_addModule(a){let b=a.name;this.moduleUniforms[b]=a.defaultUniforms||{},this.moduleBindings[b]={}}}async function pW(a,b){let c=new Image;return c.crossOrigin=b?.crossOrigin||"anonymous",c.src=a.startsWith("http")?a:""+a,await c.decode(),b?await createImageBitmap(c,b):await createImageBitmap(c)}let pX=["+X","-X","+Y","-Y","+Z","-Z"],pY=["+X","-X","+Y","-Y","+Z","-Z"];class pZ{device;id;props;texture;sampler;view;ready;isReady=!1;destroyed=!1;resolveReady=()=>{};rejectReady=()=>{};get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}constructor(a,b){this.device=a;const c=pL("async-texture");this.props={...pZ.defaultProps,id:c,...b},this.id=this.props.id,b={...b},"string"==typeof b?.data&&"2d"===b.dimension&&(b.data=pW(b.data)),b.mipmaps&&(b.mipLevels="auto"),this.ready=new Promise((a,b)=>{this.resolveReady=()=>{this.isReady=!0,a()},this.rejectReady=b}),this.initAsync(b)}async initAsync(a){let b=a.data,c=await p$(b).then(void 0,this.rejectReady);if(this.destroyed)return;let d=this.props.width&&this.props.height?{width:this.props.width,height:this.props.height}:this.getTextureDataSize(c);if(!d)throw Error("Texture size could not be determined");let e={...d,...a,data:void 0,mipLevels:1},f=this.device.getMipLevelCount(e.width,e.height);if(e.mipLevels="auto"===this.props.mipLevels?f:Math.min(f,this.props.mipLevels),this.texture=this.device.createTexture(e),this.sampler=this.texture.sampler,this.view=this.texture.view,a.data)switch(this.props.dimension){case"1d":this._setTexture1DData(this.texture,c);break;case"2d":this._setTexture2DData(c);break;case"3d":this._setTexture3DData(this.texture,c);break;case"2d-array":this._setTextureArrayData(this.texture,c);break;case"cube":this._setTextureCubeData(this.texture,c);break;case"cube-array":this._setTextureCubeArrayData(this.texture,c)}this.props.mipmaps&&this.generateMipmaps(),ff.log.info(1,`${this} loaded`),this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}generateMipmaps(){this.texture.generateMipmapsWebGL()}setSampler(a={}){this.texture.setSampler(a instanceof nL.Sampler?a:this.device.createSampler(a))}resize(a){if(!this.isReady)throw Error("Cannot resize texture before it is ready");if(a.width===this.texture.width&&a.height===this.texture.height)return!1;if(this.texture){let b=this.texture;this.texture=b.clone(a),b.destroy()}return!0}isTextureLevelData(a){return ArrayBuffer.isView(a?.data)}getTextureDataSize(a){if(!a||ArrayBuffer.isView(a))return null;if(Array.isArray(a))return this.getTextureDataSize(a[0]);if(this.device.isExternalImage(a))return this.device.getExternalImageSize(a);if(a&&"object"==typeof a&&a.constructor===Object){let b=Object.values(a)[0];return{width:b.width,height:b.height}}throw Error("texture size deduction failed")}getCubeFaceDepth(a){switch(a){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw Error(a)}}setTextureData(a){}_setTexture1DData(a,b){throw Error("setTexture1DData not supported in WebGL.")}_setTexture2DData(a,b=0){if(!this.texture)throw Error("Texture not initialized");let c=this._normalizeTextureData(a);c.length>1&&!1!==this.props.mipmaps&&ff.log.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let a=0;a<c.length;a++){let d=c[a];this.device.isExternalImage(d)?this.texture.copyExternalImage({image:d,depth:b,mipLevel:a,flipY:!0}):this.texture.copyImageData({data:d.data,mipLevel:a})}}_setTexture3DData(a,b){if(this.texture?.props.dimension!=="3d")throw Error(this.id);for(let a=0;a<b.length;a++)this._setTexture2DData(b[a],a)}_setTextureCubeData(a,b){if(this.texture?.props.dimension!=="cube")throw Error(this.id);for(let[a,c]of Object.entries(b)){let b=pY.indexOf(a);this._setTexture2DData(c,b)}}_setTextureArrayData(a,b){if(this.texture?.props.dimension!=="2d-array")throw Error(this.id);for(let a=0;a<b.length;a++)this._setTexture2DData(b[a],a)}_setTextureCubeArrayData(a,b){throw Error("setTextureCubeArrayData not supported in WebGL2.")}_setTextureCubeFaceData(a,b,c,d=0){Array.isArray(b)&&b.length>1&&!1!==this.props.mipmaps&&ff.log.warn(`${this.id} has mipmap and multiple LODs.`)();let e=pX.indexOf(c);this._setTexture2DData(b,e)}_normalizeTextureData(a){let b=this.texture;return ArrayBuffer.isView(a)?[{data:a,width:b.width,height:b.height}]:Array.isArray(a)?a:[a]}static defaultProps={...nJ.Texture.defaultProps,data:null,mipmaps:!1}}async function p$(a){if(Array.isArray(a=await a))return await Promise.all(a.map(p$));if(a&&"object"==typeof a&&a.constructor===Object){let b=a,c=await Promise.all(Object.values(b)),d=Object.keys(b),e={};for(let a=0;a<d.length;a++)e[d[a]]=c[a];return e}return a}class p_{static defaultProps={...nM.RenderPipeline.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:fe.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0};device;id;source;vs;fs;pipelineFactory;shaderFactory;userData={};parameters;topology;bufferLayout;isInstanced=void 0;instanceCount=0;vertexCount;indexBuffer=null;bufferAttributes={};constantAttributes={};bindings={};vertexArray;transformFeedback=null;pipeline;shaderInputs;_uniformStore;_attributeInfos={};_gpuGeometry=null;props;_pipelineNeedsUpdate="newly created";_needsRedraw="initializing";_destroyed=!1;_lastDrawTimestamp=-1;get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}constructor(a,b){this.props={...p_.defaultProps,...b},b=this.props,this.id=b.id||pL("model"),this.device=a,Object.assign(this.userData,b.userData);const c=Object.fromEntries(this.props.modules?.map(a=>[a.name,a])||[]),d=b.shaderInputs||new pV(c,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(d);const e=function(a){return{type:a.type,shaderLanguage:a.info.shadingLanguage,shaderLanguageVersion:a.info.shadingLanguageVersion,gpu:a.info.gpu,features:a.features}}(a),f=(this.props.modules?.length>0?this.props.modules:this.shaderInputs?.getModules())||[];if("webgpu"===this.device.type&&this.props.source){const{source:a,getUniforms:b}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:e,...this.props,modules:f});this.source=a,this._getModuleUniforms=b,this.props.shaderLayout||=function(a){let b,c={attributes:[],bindings:[]};try{b=function(a){try{return new pH(a)}catch(b){if(b instanceof Error)throw b;let a="WGSL parse error";throw"object"==typeof b&&b?.message&&(a+=`: ${b.message} `),"object"==typeof b&&b?.token&&(a+=b.token.line||""),Error(a,{cause:b})}}(a)}catch(a){return ff.log.error(a.message)(),c}for(let a of b.uniforms){let b=[];for(let c of a.type?.members||[])b.push({name:c.name,type:pI(c.type)});c.bindings.push({type:"uniform",name:a.name,group:a.group,location:a.binding,members:b})}for(let a of b.textures)c.bindings.push({type:"texture",name:a.name,group:a.group,location:a.binding});for(let a of b.samplers)c.bindings.push({type:"sampler",name:a.name,group:a.group,location:a.binding});let d=b.entry.vertex[0],e=d?.inputs.length||0;for(let a=0;a<e;a++){let b=d.inputs[a];if("location"===b.locationType){let a=pI(b.type);c.attributes.push({name:b.name,location:Number(b.location),type:a})}}return c}(this.source)}else{const{vs:a,fs:b,getUniforms:c}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:e,...this.props,modules:f});this.vs=a,this.fs=b,this._getModuleUniforms=c}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,b.geometry&&this.setGeometry(b.geometry),this.pipelineFactory=b.pipelineFactory||pP.getDefaultPipelineFactory(this.device),this.shaderFactory=b.shaderFactory||pR.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=a.createVertexArray({shaderLayout:this.pipeline.shaderLayout,bufferLayout:this.pipeline.bufferLayout}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in b&&(this.isInstanced=b.isInstanced),b.instanceCount&&this.setInstanceCount(b.instanceCount),b.vertexCount&&this.setVertexCount(b.vertexCount),b.indexBuffer&&this.setIndexBuffer(b.indexBuffer),b.attributes&&this.setAttributes(b.attributes),b.constantAttributes&&this.setConstantAttributes(b.constantAttributes),b.bindings&&this.setBindings(b.bindings),b.transformFeedback&&(this.transformFeedback=b.transformFeedback),Object.seal(this)}destroy(){this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),this._gpuGeometry?.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");let a=this._needsRedraw;return this._needsRedraw=!1,a}setNeedsRedraw(a){this._needsRedraw||=a}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(a){let b,c=this._areBindingsLoading();if(c)return ff.log.info(2,`>>> DRAWING ABORTED ${this.id}: ${c} not loaded`)(),!1;try{a.pushDebugGroup(`${this}.predraw(${a})`),this.predraw()}finally{a.popDebugGroup()}try{a.pushDebugGroup(`${this}.draw(${a})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();let c=this._getBindings();this.pipeline.setBindings(c,{disableWarnings:this.props.disableWarnings});let{indexBuffer:d}=this.vertexArray,e=d?d.byteLength/("uint32"===d.indexType?4:2):void 0;b=this.pipeline.draw({renderPass:a,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:e,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{a.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(a),b?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",b}setGeometry(a){this._gpuGeometry?.destroy();let b=a&&function(a,b){if(b instanceof pM)return b;let c=function(a,b){if(!b.indices)return;let c=b.indices.value;return a.createBuffer({usage:nr.Buffer.INDEX,data:c})}(a,b),{attributes:d,bufferLayout:e}=function(a,b){let c=[],d={};for(let[e,f]of Object.entries(b.attributes)){let b=e;switch(e){case"POSITION":b="positions";break;case"NORMAL":b="normals";break;case"TEXCOORD_0":b="texCoords";break;case"COLOR_0":b="colors"}if(f){d[b]=a.createBuffer({data:f.value,id:`${e}-buffer`});let{value:g,size:h,normalized:i}=f;c.push({name:b,format:(0,pJ.getVertexFormatFromAttribute)(g,h,i)})}}return{attributes:d,bufferLayout:c,vertexCount:b._calculateVertexCount(b.attributes,b.indices)}}(a,b);return new pM({topology:b.topology||"triangle-list",bufferLayout:e,vertexCount:b.vertexCount,indices:c,attributes:d})}(this.device,a);if(b){this.setTopology(b.topology||"triangle-list");let a=new pU(this.bufferLayout);this.bufferLayout=a.mergeBufferLayouts(b.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(b)}this._gpuGeometry=b}setTopology(a){a!==this.topology&&(this.topology=a,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(a){let b=new pU(this.bufferLayout);this.bufferLayout=this._gpuGeometry?b.mergeBufferLayouts(a,this._gpuGeometry.bufferLayout):a,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({shaderLayout:this.pipeline.shaderLayout,bufferLayout:this.pipeline.bufferLayout}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(a){!function a(b,c,d){if(b===c)return!0;if(!d||!b||!c)return!1;if(Array.isArray(b)){if(!Array.isArray(c)||b.length!==c.length)return!1;for(let e=0;e<b.length;e++)if(!a(b[e],c[e],d-1))return!1;return!0}if(Array.isArray(c))return!1;if("object"==typeof b&&"object"==typeof c){let e=Object.keys(b),f=Object.keys(c);if(e.length!==f.length)return!1;for(let f of e)if(!c.hasOwnProperty(f)||!a(b[f],c[f],d-1))return!1;return!0}return!1}(a,this.parameters,2)&&(this.parameters=a,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(a){this.instanceCount=a,void 0===this.isInstanced&&a>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(a){this.vertexCount=a,this.setNeedsRedraw("vertexCount")}setShaderInputs(a){for(let[c,d]of(this.shaderInputs=a,this._uniformStore=new nS(this.shaderInputs.modules),Object.entries(this.shaderInputs.modules))){var b;if((b=d).uniformTypes&&!function(a){for(let b in a)return!1;return!0}(b.uniformTypes)){let a=this._uniformStore.getManagedUniformBuffer(this.device,c);this.bindings[`${c}Uniforms`]=a}}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(a){Object.assign(this.bindings,a),this.setNeedsRedraw("bindings")}setTransformFeedback(a){this.transformFeedback=a,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(a){this.vertexArray.setIndexBuffer(a),this.setNeedsRedraw("indexBuffer")}setAttributes(a,b){var c,d;let e,f,g=b?.disableWarnings??this.props.disableWarnings;a.indices&&ff.log.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)(),this.bufferLayout=(c=this.pipeline.shaderLayout,d=this.bufferLayout,e=Object.fromEntries(c.attributes.map(a=>[a.name,a.location])),(f=d.slice()).sort((a,b)=>{let c=a.attributes?a.attributes.map(a=>a.attribute):[a.name],d=b.attributes?b.attributes.map(a=>a.attribute):[b.name];return Math.min(...c.map(a=>e[a]))-Math.min(...d.map(a=>e[a]))}),f);let h=new pU(this.bufferLayout);for(let[b,c]of Object.entries(a)){let a=h.getBufferLayout(b);if(!a){g||ff.log.warn(`Model(${this.id}): Missing layout for buffer "${b}".`)();continue}let d=h.getAttributeNamesForBuffer(a),e=!1;for(let a of d){let b=this._attributeInfos[a];if(b){let a="webgpu"===this.device.type?h.getBufferIndex(b.bufferName):b.location;this.vertexArray.setBuffer(a,c),e=!0}}e||g||ff.log.warn(`Model(${this.id}): Ignoring buffer "${c.id}" for unknown attribute "${b}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(a,b){for(let[c,d]of Object.entries(a)){let a=this._attributeInfos[c];a?this.vertexArray.setConstantWebGL(a.location,d):(b?.disableWarnings??this.props.disableWarnings)||ff.log.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${c}"`)()}this.setNeedsRedraw("constants")}_areBindingsLoading(){for(let a of Object.values(this.bindings))if(a instanceof pZ&&!a.isReady)return a.id;return!1}_getBindings(){let a={};for(let[b,c]of Object.entries(this.bindings))c instanceof pZ?c.isReady&&(a[b]=c.texture):a[b]=c;return a}_getBindingsUpdateTimestamp(){let a=0;for(let b of Object.values(this.bindings))b instanceof nK.TextureView?a=Math.max(a,b.texture.updateTimestamp):b instanceof nr.Buffer||b instanceof nJ.Texture?a=Math.max(a,b.updateTimestamp):b instanceof pZ?a=b.texture?Math.max(a,b.texture.updateTimestamp):1/0:b instanceof nL.Sampler||(a=Math.max(a,b.buffer.updateTimestamp));return a}_setGeometryAttributes(a){let b={...a.attributes};for(let[a]of Object.entries(b))this.pipeline.shaderLayout.attributes.find(b=>b.name===a)||"positions"===a||delete b[a];this.vertexCount=a.vertexCount,this.setIndexBuffer(a.indices||null),this.setAttributes(a.attributes,{disableWarnings:!0}),this.setAttributes(b,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(a){this._pipelineNeedsUpdate||=a,this.setNeedsRedraw(a)}_updatePipeline(){if(this._pipelineNeedsUpdate){let a=null,b=null;this.pipeline&&(ff.log.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),a=this.pipeline.vs,b=this.pipeline.fs),this._pipelineNeedsUpdate=!1;let c=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders}),d=null;this.source?d=c:this.fs&&(d=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:c,fs:d}),this._attributeInfos=(0,nT.getAttributeInfosFromLayouts)(this.pipeline.shaderLayout,this.bufferLayout),a&&this.shaderFactory.release(a),b&&this.shaderFactory.release(b)}return this.pipeline}_lastLogTime=0;_logOpen=!1;_logDrawCallStart(){let a=ff.log.level>3?0:1e4;ff.log.level<2||Date.now()-this._lastLogTime<a||(this._lastLogTime=Date.now(),this._logOpen=!0,ff.log.group(2,`>>> DRAWING MODEL ${this.id}`,{collapsed:ff.log.level<=2})())}_logDrawCallEnd(){if(this._logOpen){let a=function(a,b){let c={},d="Values";if(0===a.attributes.length&&!a.varyings?.length)return{"No attributes or varyings":{[d]:"N/A"}};for(let b of a.attributes)if(b){let a=`${b.location} ${b.name}: ${b.type}`;c[`in ${a}`]={[d]:b.stepMode||"vertex"}}for(let b of a.varyings||[]){let a=`${b.location} ${b.name}`;c[`out ${a}`]={[d]:JSON.stringify(b)}}return c}(this.pipeline.shaderLayout,this.id);ff.log.table(2,a)();let b=this.shaderInputs.getDebugTable();ff.log.table(2,b)();let c=this._getAttributeDebugTable();ff.log.table(2,this._attributeInfos)(),ff.log.table(2,c)(),ff.log.groupEnd(2)(),this._logOpen=!1}}_drawCount=0;_logFramebuffer(a){let b=this.device.props.debugFramebuffers;if(this._drawCount++,!b)return;let c=a.props.framebuffer;c&&function(a,{id:b,minimap:c,opaque:d,top:e="0",left:f="0",rgbaScale:g=1}){pS||((pS=document.createElement("canvas")).id=b,pS.title=b,pS.style.zIndex="100",pS.style.position="absolute",pS.style.top=e,pS.style.left=f,pS.style.border="blue 5px solid",pS.style.transform="scaleY(-1)",document.body.appendChild(pS),pT=pS.getContext("2d")),(pS.width!==a.width||pS.height!==a.height)&&(pS.width=a.width/2,pS.height=a.height/2,pS.style.width="400px",pS.style.height="400px");let h=a.device.readPixelsToArrayWebGL(a),i=pT?.createImageData(a.width,a.height);if(i){for(let a=0;a<h.length;a+=4)i.data[0+a+0]=h[a+0]*g,i.data[0+a+1]=h[a+1]*g,i.data[0+a+2]=h[a+2]*g,i.data[0+a+3]=d?255:h[a+3]*g;pT?.putImageData(i,0,0)}}(c,{id:c.id,minimap:!0})}_getAttributeDebugTable(){let a={};for(let[b,c]of Object.entries(this._attributeInfos)){let d=this.vertexArray.attributes[c.location];a[c.location]={name:b,type:c.shaderType,values:d?this._getBufferOrConstantValues(d,c.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){let{indexBuffer:b}=this.vertexArray,c="uint32"===b.indexType?new Uint32Array(b.debugData):new Uint16Array(b.debugData);a.indices={name:"indices",type:b.indexType,values:c.toString()}}return a}_getBufferOrConstantValues(a,b){let c=(0,nt.getTypedArrayConstructor)(b);return(a instanceof nr.Buffer?new c(a.debugData):a).toString()}}class p0{device;model;transformFeedback;static defaultProps={...p_.defaultProps,outputs:void 0,feedbackBuffers:void 0};static isSupported(a){return a?.info?.type==="webgl"}constructor(a,b=p0.defaultProps){if(!p0.isSupported(a))throw Error("BufferTransform not yet implemented on WebGPU");this.device=a,this.model=new p_(this.device,{id:b.id||"buffer-transform-model",fs:b.fs||function(a){let{input:b,inputChannels:c,output:d}={};if(!b)return nI;if(!c)throw Error("inputChannels");let e=function(a){switch(a){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw Error(`invalid channels: ${a}`)}}(c),f=function(a,b){switch(b){case 1:return`vec4(${a}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${a}, 0.0, 1.0)`;case 3:return`vec4(${a}, 1.0)`;case 4:return a;default:throw Error(`invalid channels: ${b}`)}}(b,c);return`\
#version 300 es
in ${e} ${b};
out vec4 ${d};
void main() {
  ${d} = ${f};
}`}(),topology:b.topology||"point-list",varyings:b.outputs||b.varyings,...b}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:b.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(a){a?.inputBuffers&&this.model.setAttributes(a.inputBuffers),a?.outputBuffers&&this.transformFeedback.setBuffers(a.outputBuffers);let b=this.device.beginRenderPass(a);this.model.draw(b),b.end()}getBuffer(a){return this.transformFeedback.getBuffer(a)}readAsync(a){let b=this.getBuffer(a);if(!b)throw Error("BufferTransform#getBuffer");if(b instanceof nr.Buffer)return b.readAsync();let{buffer:c,byteOffset:d=0,byteLength:e=c.byteLength}=b;return c.readAsync(d,e)}}function p1(a,b=[],c=0){let d=Math.fround(a),e=a-d;return b[c]=d,b[c+1]=e,b}let p2={name:"fp64arithmetic",vs:`\

uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,defaultUniforms:{ONE:1},uniformTypes:{ONE:"f32"},fp64ify:p1,fp64LowPart:function(a){return a-Math.fround(a)},fp64ifyMatrix4:function(a){let b=new Float32Array(32);for(let c=0;c<4;++c)for(let d=0;d<4;++d){let e=4*c+d;p1(a[4*d+c],b,2*e)}return b}};function p3(a){let{source:b,target:c,start:d=0,size:e,getData:f}=a,g=a.end||c.length,h=b.length,i=g-d;if(h>i)return void c.set(b.subarray(0,i),d);if(c.set(b,d),!f)return;let j=h;for(;j<i;){let a=f(j,b);for(let b=0;b<e;b++)c[d+j]=a[b]||0,j++}}function p4(a){switch(a){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw Error(`No defined attribute type for size "${a}"`)}}function p5(a){switch(a){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw Error("invalid type size")}}function p6(a){a.push(a.shift())}function p7({device:a,source:b,target:c}){return(!c||c.byteLength<b.byteLength)&&(c?.destroy(),c=a.createBuffer({byteLength:b.byteLength,usage:b.usage})),c}function p8({device:a,buffer:b,attribute:c,fromLength:d,toLength:e,fromStartIndices:f,getData:g=a=>a}){let h=c.doublePrecision&&c.value instanceof Float64Array?2:1,i=c.size*h,j=c.byteOffset,k=c.settings.bytesPerElement<4?j/c.settings.bytesPerElement*4:j,l=c.startIndices,n=f&&l,o=c.isConstant;if(!n&&b&&d>=e)return b;let p=c.value instanceof Float64Array?Float32Array:c.value.constructor,q=o?c.value:new p(c.getBuffer().readSyncWebGL(j,e*p.BYTES_PER_ELEMENT).buffer);if(c.settings.normalized&&!o){let a=g;g=(b,d)=>c.normalizeConstant(a(b,d))}let r=o?(a,b)=>g(q,b):(a,b)=>g(q.subarray(a+j,a+j+i),b),s=new Float32Array(b?b.readSyncWebGL(k,4*d).buffer:0),t=new Float32Array(e);return!function({source:a,target:b,size:c,getData:d,sourceStartIndices:e,targetStartIndices:f}){if(!e||!f)return p3({source:a,target:b,size:c,getData:d});let g=0,h=0,i=d&&((a,b)=>d(a+h,b)),j=Math.min(e.length,f.length);for(let d=1;d<j;d++){let j=e[d]*c,k=f[d]*c;p3({source:a.subarray(g,j),target:b,start:h,end:k,size:c,getData:i}),g=j,h=k}h<b.length&&p3({source:[],target:b,start:h,size:c,getData:i})}({source:s,target:t,sourceStartIndices:f,targetStartIndices:l,size:i,getData:r}),(!b||b.byteLength<t.byteLength+k)&&(b?.destroy(),b=a.createBuffer({byteLength:t.byteLength+k,usage:35050})),b.write(t,k),b}class p9{constructor({device:a,attribute:b,timeline:c}){this.buffers=[],this.currentLength=0,this.device=a,this.transition=new lU(c),this.attribute=b,this.attributeInTransition=function(a){let{device:b,settings:c,value:d}=a,e=new nG(b,c);return e.setData({value:d instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:c.normalized}),e}(b),this.currentStartIndices=b.startIndices}get inProgress(){return this.transition.inProgress}start(a,b,c=1/0){this.settings=a,this.currentStartIndices=this.attribute.startIndices,this.currentLength=function(a,b){let{doublePrecision:c,settings:d,value:e,size:f}=a,g=c&&e instanceof Float64Array?2:1,h=0,{shaderAttributes:i}=a.settings;if(i)for(let a of Object.values(i))h=Math.max(h,a.vertexOffset??0);return(d.noAlloc?e.length:(b+h)*f)*g}(this.attribute,b),this.transition.start({...a,duration:c})}update(){let a=this.transition.update();return a&&this.onUpdate(),a}setBuffer(a){this.attributeInTransition.setData({buffer:a,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){for(let a of(this.cancel(),this.buffers))a.destroy();this.buffers.length=0}}let qa={name:"interpolation",vs:`\
uniform interpolationUniforms {
  float time;
} interpolation;
`,uniformTypes:{time:"f32"}},qb=`\
#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,qc=`\
#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function qd(a){return a.doublePrecision&&a.value instanceof Float64Array}let qe={name:"spring",vs:`\
uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,uniformTypes:{damping:"f32",stiffness:"f32"}},qf=`\
#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,qg=`\
#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`,qh={interpolation:class extends p9{constructor({device:a,attribute:b,timeline:c}){super({device:a,attribute:b,timeline:c}),this.type="interpolation",this.transform=function(a,b){let c=b.size,d=p4(c),e=p5(c),f=b.getBufferLayout();return qd(b)?new p0(a,{vs:qc,bufferLayout:[{name:"aFrom",byteStride:8*c,attributes:[{attribute:"aFrom",format:e,byteOffset:0},{attribute:"aFrom64Low",format:e,byteOffset:4*c}]},{name:"aTo",byteStride:8*c,attributes:[{attribute:"aTo",format:e,byteOffset:0},{attribute:"aTo64Low",format:e,byteOffset:4*c}]}],modules:[p2,qa],defines:{ATTRIBUTE_TYPE:d,ATTRIBUTE_SIZE:c},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new p0(a,{vs:qb,bufferLayout:[{name:"aFrom",format:e},{name:"aTo",format:f.attributes[0].format}],modules:[qa],defines:{ATTRIBUTE_TYPE:d},varyings:["vCurrent"],disableWarnings:!0})}(a,b)}start(a,b){let c=this.currentLength,d=this.currentStartIndices;if(super.start(a,b,a.duration),a.duration<=0)return void this.transition.cancel();let{buffers:e,attribute:f}=this;p6(e),e[0]=p8({device:this.device,buffer:e[0],attribute:f,fromLength:c,toLength:this.currentLength,fromStartIndices:d,getData:a.enter}),e[1]=p7({device:this.device,source:e[0],target:e[1]}),this.setBuffer(e[1]);let{transform:g}=this,h=g.model,i=Math.floor(this.currentLength/f.size);qd(f)&&(i/=2),h.setVertexCount(i),f.isConstant?(h.setAttributes({aFrom:e[0]}),h.setConstantAttributes({aTo:f.value})):h.setAttributes({aFrom:e[0],aTo:f.getBuffer()}),g.transformFeedback.setBuffers({vCurrent:e[1]})}onUpdate(){let{duration:a,easing:b}=this.settings,{time:c}=this.transition,d=c/a;b&&(d=b(d));let{model:e}=this.transform,f={time:d};e.shaderInputs.setProps({interpolation:f}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}},spring:class extends p9{constructor({device:a,attribute:b,timeline:c}){var d,e;super({device:a,attribute:b,timeline:c}),this.type="spring",this.texture=a.createTexture({data:new Uint8Array(4),format:"rgba8unorm",width:1,height:1}),this.framebuffer=(d=a,e=this.texture,d.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[e]})),this.transform=function(a,b){let c=p4(b.size),d=p5(b.size);return new p0(a,{vs:qf,fs:qg,bufferLayout:[{name:"aPrev",format:d},{name:"aCur",format:d},{name:"aTo",format:b.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[qe],defines:{ATTRIBUTE_TYPE:c},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}(a,b)}start(a,b){let c=this.currentLength,d=this.currentStartIndices;super.start(a,b);let{buffers:e,attribute:f}=this;for(let b=0;b<2;b++)e[b]=p8({device:this.device,buffer:e[b],attribute:f,fromLength:c,toLength:this.currentLength,fromStartIndices:d,getData:a.enter});e[2]=p7({device:this.device,source:e[0],target:e[2]}),this.setBuffer(e[1]);let{model:g}=this.transform;g.setVertexCount(Math.floor(this.currentLength/f.size)),f.isConstant?g.setConstantAttributes({aTo:f.value}):g.setAttributes({aTo:f.getBuffer()})}onUpdate(){let{buffers:a,transform:b,framebuffer:c,transition:d}=this,e=this.settings;b.model.setAttributes({aPrev:a[0],aCur:a[1]}),b.transformFeedback.setBuffers({vNext:a[2]});let f={stiffness:e.stiffness,damping:e.damping};b.model.shaderInputs.setProps({spring:f}),b.run({framebuffer:c,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),p6(a),this.setBuffer(a[1]),this.device.readPixelsToArrayWebGL(c)[0]>0||d.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}};class qi{constructor(a,{id:b,timeline:c}){if(!a)throw Error("AttributeTransitionManager is constructed without device");this.id=b,this.device=a,this.timeline=c,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(let a in this.transitions)this._removeTransition(a)}update({attributes:a,transitions:b,numInstances:c}){for(let d in this.numInstances=c||1,a){let c=a[d],e=c.getTransitionSetting(b);e&&this._updateAttribute(d,c,e)}for(let c in this.transitions){let d=a[c];d&&d.getTransitionSetting(b)||this._removeTransition(c)}}hasAttribute(a){let b=this.transitions[a];return b&&b.inProgress}getAttributes(){let a={};for(let b in this.transitions){let c=this.transitions[b];c.inProgress&&(a[b]=c.attributeInTransition)}return a}run(){if(0===this.numInstances)return!1;for(let a in this.transitions)this.transitions[a].update()&&(this.needsRedraw=!0);let a=this.needsRedraw;return this.needsRedraw=!1,a}_removeTransition(a){this.transitions[a].delete(),delete this.transitions[a]}_updateAttribute(a,b,c){let d=this.transitions[a],e=!d||d.type!==c.type;if(e){d&&this._removeTransition(a);let f=qh[c.type];f?this.transitions[a]=new f({attribute:b,timeline:this.timeline,device:this.device}):(gT.error(`unsupported transition type '${c.type}'`)(),e=!1)}(e||b.needsRedraw())&&(this.needsRedraw=!0,this.transitions[a].start(c,this.numInstances))}}let qj="attributeManager.invalidate";class qk{constructor(a,{id:b="attribute-manager",stats:c,timeline:d}={}){this.mergeBoundsMemoized=hE(lF),this.id=b,this.device=a,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=c,this.attributeTransitionManager=new qi(a,{id:`${b}-transitions`,timeline:d}),Object.seal(this)}finalize(){for(let a in this.attributes)this.attributes[a].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(a={clearRedrawFlags:!1}){let b=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!a.clearRedrawFlags,b&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(a){this._add(a)}addInstanced(a){this._add(a,{stepMode:"instance"})}remove(a){for(let b of a)void 0!==this.attributes[b]&&(this.attributes[b].delete(),delete this.attributes[b])}invalidate(a,b){let c=this._invalidateTrigger(a,b);kc(qj,this,a,c)}invalidateAll(a){for(let b in this.attributes)this.attributes[b].setNeedsUpdate(b,a);kc(qj,this,"all")}update({data:a,numInstances:b,startIndices:c=null,transitions:d,props:e={},buffers:f={},context:g={}}){let h=!1;for(let d in kc("attributeManager.updateStart",this),this.stats&&this.stats.get("Update Attributes").timeStart(),this.attributes){let i=this.attributes[d],j=i.settings.accessor;i.startIndices=c,i.numInstances=b,e[d]&&gT.removed(`props.${d}`,`data.attributes.${d}`)(),i.setExternalBuffer(f[d])||i.setBinaryValue("string"==typeof j?f[j]:void 0,a.startIndices)||"string"==typeof j&&!f[j]&&i.setConstantValue(g,e[j])||i.needsUpdate()&&(h=!0,this._updateAttribute({attribute:i,numInstances:b,data:a,props:e,context:g})),this.needsRedraw=this.needsRedraw||i.needsRedraw()}h&&kc("attributeManager.updateEnd",this,b),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:b,transitions:d})}updateTransition(){let{attributeTransitionManager:a}=this,b=a.run();return this.needsRedraw=this.needsRedraw||b,b}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(a){let b=a.map(a=>this.attributes[a]?.getBounds());return this.mergeBoundsMemoized(b)}getChangedAttributes(a={clearChangedFlags:!1}){let{attributes:b,attributeTransitionManager:c}=this,d={...c.getAttributes()};for(let e in b){let f=b[e];f.needsRedraw(a)&&!c.hasAttribute(e)&&(d[e]=f)}return d}getBufferLayouts(a){return Object.values(this.getAttributes()).map(b=>b.getBufferLayout(a))}_add(a,b){for(let c in a){let d=a[c],e={...d,id:c,size:d.isIndexed&&1||d.size||1,...b};this.attributes[c]=new nG(this.device,e)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){let a={};for(let b in this.attributes)this.attributes[b].getUpdateTriggers().forEach(c=>{a[c]||(a[c]=[]),a[c].push(b)});this.updateTriggers=a}_invalidateTrigger(a,b){let{attributes:c,updateTriggers:d}=this,e=d[a];return e&&e.forEach(a=>{let d=c[a];d&&d.setNeedsUpdate(d.id,b)}),e}_updateAttribute(a){let{attribute:b,numInstances:c}=a;(kc("attribute.updateStart",b),b.constant)?b.setConstantValue(a.context,b.value):(b.allocate(c)&&kc("attribute.allocate",b,c),b.updateBuffer(a)&&(this.needsRedraw=!0,kc("attribute.updateEnd",b,c)))}}function ql(a,b,c,d,e){let f=b-a;return(c-b)*e+-f*d+f+b}function qm(a,b){if(Array.isArray(a)){let c=0;for(let d=0;d<a.length;d++){let e=a[d]-b[d];c+=e*e}return Math.sqrt(c)}return Math.abs(a-b)}let qn={interpolation:class extends lU{get value(){return this._value}_onUpdate(){let{time:a,settings:{fromValue:b,toValue:c,duration:d,easing:e}}=this,f=e(a/d);this._value=h$(b,c,f)}},spring:class extends lU{get value(){return this._currValue}_onUpdate(){let{fromValue:a,toValue:b,damping:c,stiffness:d}=this.settings,{_prevValue:e=a,_currValue:f=a}=this,g=function(a,b,c,d,e){if(Array.isArray(c)){let f=[];for(let g=0;g<c.length;g++)f[g]=ql(a[g],b[g],c[g],d,e);return f}return ql(a,b,c,d,e)}(e,f,b,c,d),h=qm(g,b),i=qm(g,f);h<1e-5&&i<1e-5&&(g=b,this.end()),this._prevValue=f,this._currValue=g}}};class qo{constructor(a){this.transitions=new Map,this.timeline=a}get active(){return this.transitions.size>0}add(a,b,c,d){let{transitions:e}=this;if(e.has(a)){let c=e.get(a),{value:d=c.settings.fromValue}=c;b=d,this.remove(a)}if(!(d=nF(d)))return;let f=qn[d.type];if(!f)return void gT.error(`unsupported transition type '${d.type}'`)();let g=new f(this.timeline);g.start({...d,fromValue:b,toValue:c}),e.set(a,g)}remove(a){let{transitions:b}=this;b.has(a)&&(b.get(a).cancel(),b.delete(a))}update(){let a={};for(let[b,c]of this.transitions)c.update(),a[b]=c.value,c.inProgress||this.remove(b);return a}clear(){for(let a of this.transitions.keys())this.remove(a)}}function qp({newProps:a,oldProps:b,ignoreProps:c={},propTypes:d={},triggerName:e="props"}){if(b===a)return!1;if("object"!=typeof a||null===a||"object"!=typeof b||null===b)return`${e} changed shallowly`;for(let f of Object.keys(a))if(!(f in c)){if(!(f in b))return`${e}.${f} added`;let c=qq(a[f],b[f],d[f]);if(c)return`${e}.${f} ${c}`}for(let f of Object.keys(b))if(!(f in c)){if(!(f in a))return`${e}.${f} dropped`;if(!Object.hasOwnProperty.call(a,f)){let c=qq(a[f],b[f],d[f]);if(c)return`${e}.${f} ${c}`}}return!1}function qq(a,b,c){let d=c&&c.equal;return d&&!d(a,b,c)||!d&&(d=a&&b&&a.equals)&&!d.call(a,b)?"changed deeply":d||b===a?null:"changed shallowly"}function qr(a,b,c){let d=a.updateTriggers[c];d=null==d?{}:d;let e=b.updateTriggers[c];return qp({oldProps:e=null==e?{}:e,newProps:d,triggerName:c})}function qs(a,b){if(!b)return a;let c={...a,...b};if("defines"in b&&(c.defines={...a.defines,...b.defines}),"modules"in b&&(c.modules=(a.modules||[]).concat(b.modules),b.modules.some(a=>"project64"===a.name))){let a=c.modules.findIndex(a=>"project32"===a.name);a>=0&&c.modules.splice(a,1)}if("inject"in b)if(a.inject){let d={...a.inject};for(let a in b.inject)d[a]=(d[a]||"")+b.inject[a];c.inject=d}else c.inject=b.inject;return c}var jA=jA,gR=gR;let qt=[0,0,0];function qu(a,b,c=!1){let d=b.projectPosition(a);if(c&&b instanceof lT){let[c,e,f=0]=a,g=b.getDistanceScales([c,e]);d[2]=f*g.unitsPerMeter[2]}return d}function qv(a,{viewport:b,modelMatrix:c,coordinateSystem:d,coordinateOrigin:e,offsetMode:f}){let[g,h,i=0]=a;switch(c&&([g,h,i]=gR.transformMat4([],[g,h,i,1],c)),d){case hz.LNGLAT:return qu([g,h,i],b,f);case hz.LNGLAT_OFFSETS:return qu([g+e[0],h+e[1],i+(e[2]||0)],b,f);case hz.METER_OFFSETS:return qu(jK(e,[g,h,i]),b,f);case hz.CARTESIAN:default:return b.isGeospatial?[g+e[0],h+e[1],i+e[2]]:b.projectPosition([g,h,i])}}let qw={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},qx={},qy={boolean:{validate:(a,b)=>!0,equal:(a,b,c)=>!!a==!!b},number:{validate:(a,b)=>Number.isFinite(a)&&(!("max"in b)||a<=b.max)&&(!("min"in b)||a>=b.min)},color:{validate:(a,b)=>b.optional&&!a||qA(a)&&(3===a.length||4===a.length),equal:(a,b,c)=>lN(a,b,1)},accessor:{validate(a,b){let c=qB(a);return"function"===c||c===qB(b.value)},equal:(a,b,c)=>"function"==typeof b||lN(a,b,1)},array:{validate:(a,b)=>b.optional&&!a||qA(a),equal(a,b,c){let{compare:d}=c,e=Number.isInteger(d)?d:+!!d;return d?lN(a,b,e):a===b}},object:{equal(a,b,c){if(c.ignore)return!0;let{compare:d}=c,e=Number.isInteger(d)?d:+!!d;return d?lN(a,b,e):a===b}},function:{validate:(a,b)=>b.optional&&!a||"function"==typeof a,equal:(a,b,c)=>!c.compare&&!1!==c.ignore||a===b},data:{transform:(a,b,c)=>{if(!a)return a;let{dataTransform:d}=c.props;return d?d(a):"string"==typeof a.shape&&a.shape.endsWith("-table")&&Array.isArray(a.data)?a.data:a}},image:{transform:(a,b,c)=>{let d=c.context;return d&&d.device?function(a,b,c,d){if(c instanceof nJ.Texture)return c;c.constructor&&"Object"!==c.constructor.name&&(c={data:c});let e=null;c.compressed&&(e={minFilter:"linear",mipmapFilter:c.data.length>1?"nearest":"linear"});let{width:f,height:g}=c.data,h=b.createTexture({...c,sampler:{...qw,...e,...d},mipLevels:b.getMipLevelCount(f,g)});return h.generateMipmapsWebGL(),qx[h.id]=a,h}(c.id,d.device,a,{...b.parameters,...c.props.textureParameters}):null},release:(a,b,c)=>{var d;d=c.id,a&&a instanceof nJ.Texture&&qx[a.id]===d&&(a.delete(),delete qx[a.id])}}};function qz(a,b){return"type"in b?{name:a,...qy[b.type],...b}:"value"in b?{name:a,type:qB(b.value),...b}:{name:a,type:"object",value:b}}function qA(a){return Array.isArray(a)||ArrayBuffer.isView(a)}function qB(a){return qA(a)?"array":null===a?"null":typeof a}function qC(a,b){return Object.prototype.hasOwnProperty.call(a,b)}let qD=0;class qE{constructor(...a){this.props=function(a,b){let c;for(let a=b.length-1;a>=0;a--){let d=b[a];"extensions"in d&&(c=d.extensions)}let d=Object.create(function a(b,c){var d,e;if(!(b instanceof qF.constructor))return{};let f="_mergedDefaultProps";if(c)for(let a of c){let b=a.constructor;b&&(f+=`:${b.extensionName||b.name}`)}let g=qC(d=b,e=f)&&d[e];return g||(b[f]=function(b,c){var d;let e;if(!b.prototype)return null;let f=a(Object.getPrototypeOf(b)),g=function(a){let b={},c={},d={};for(let[e,f]of Object.entries(a)){let a=f?.deprecatedFor;if(a)d[e]=Array.isArray(a)?a:[a];else{let a=function(a,b){switch(qB(b)){case"object":return qz(a,b);case"array":return qz(a,{type:"array",value:b,compare:!1});case"boolean":return qz(a,{type:"boolean",value:b});case"number":return qz(a,{type:"number",value:b});case"function":return qz(a,{type:"function",value:b,compare:!0});default:return{name:a,type:"unknown",value:b}}}(e,f);b[e]=a,c[e]=a.value}}return{propTypes:b,defaultProps:c,deprecatedProps:d}}(function(a,b){return qC(a,b)&&a[b]}(b,"defaultProps")||{}),h=Object.assign(Object.create(null),f,g.defaultProps),i=Object.assign(Object.create(null),f?.[j5],g.propTypes),j=Object.assign(Object.create(null),f?.[j6],g.deprecatedProps);for(let b of c){let c=a(b.constructor);c&&(Object.assign(h,c),Object.assign(i,c[j5]),Object.assign(j,c[j6]))}return Object.defineProperties(h,{id:{writable:!0,value:((e=(d=b).componentName)||gT.warn(`${d.name}.componentName not specified`)(),e||d.name)}}),function(a,b){let c={},d={};for(let a in b){let e=b[a],{name:f,value:g}=e;e.async&&(c[f]=g,d[f]=function(a){return{enumerable:!0,set(b){"string"==typeof b||b instanceof Promise||nB(b)?this[j8][a]=b:this[j9][a]=b},get(){if(this[j9]){if(a in this[j9])return this[j9][a]||this[j7][a];if(a in this[j8]){let b=this[j4]&&this[j4].internalState;if(b&&b.hasAsyncProp(a))return b.getAsyncProp(a)||this[j7][a]}}return this[j7][a]}}}(f))}a[j7]=c,a[j8]={},Object.defineProperties(a,d)}(h,i),function(a,b){for(let c in b)Object.defineProperty(a,c,{enumerable:!1,set(a){let d=`${this.id}: ${c}`;for(let d of b[c])qC(this,d)||(this[d]=a);gT.deprecated(d,b[c].join("/"))()}})}(h,j),h[j5]=i,h[j6]=j,0!==c.length||qC(b,"_propTypes")||(b._propTypes=i),h}(b,c||[]))}(a.constructor,c));d[j4]=a,d[j8]={},d[j9]={};for(let a=0;a<b.length;++a){let c=b[a];for(let a in c)d[a]=c[a]}return Object.freeze(d),d}(this,a),this.id=this.props.id,this.count=qD++}clone(a){let{props:b}=this,c={};for(let a in b[j7])a in b[j9]?c[a]=b[j9][a]:a in b[j8]&&(c[a]=b[j8][a]);return new this.constructor({...b,...c,...a})}}qE.componentName="Component",qE.defaultProps={};let qF=qE,qG=Object.freeze({});class qH{constructor(a){this.component=a,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(let a in this.asyncProps){let b=this.asyncProps[a];b&&b.type&&b.type.release&&b.type.release(b.resolvedValue,b.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||qG}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(a){return a in this.asyncProps}getAsyncProp(a){let b=this.asyncProps[a];return b&&b.resolvedValue}isAsyncPropLoading(a){if(a){let b=this.asyncProps[a];return!!(b&&b.pendingLoadCount>0&&b.pendingLoadCount!==b.resolvedLoadCount)}for(let a in this.asyncProps)if(this.isAsyncPropLoading(a))return!0;return!1}reloadAsyncProp(a,b){this._watchPromise(a,Promise.resolve(b))}setAsyncProps(a){this.component=a[j4]||this.component;let b=a[j9]||{},c=a[j8]||a,d=a[j7]||{};for(let a in b){let c=b[a];this._createAsyncPropData(a,d[a]),this._updateAsyncProp(a,c),b[a]=this.getAsyncProp(a)}for(let a in c){let b=c[a];this._createAsyncPropData(a,d[a]),this._updateAsyncProp(a,b)}}_fetch(a,b){return null}_onResolve(a,b){}_onError(a,b){}_updateAsyncProp(a,b){if(this._didAsyncInputValueChange(a,b)){if("string"==typeof b&&(b=this._fetch(a,b)),b instanceof Promise)return void this._watchPromise(a,b);if(nB(b))return void this._resolveAsyncIterable(a,b);this._setPropValue(a,b)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps)for(let a in this.oldAsyncProps=Object.create(this.oldProps),this.asyncProps)Object.defineProperty(this.oldAsyncProps,a,{enumerable:!0,value:this.oldProps[a]})}_didAsyncInputValueChange(a,b){let c=this.asyncProps[a];return b!==c.resolvedValue&&b!==c.lastValue&&(c.lastValue=b,!0)}_setPropValue(a,b){this._freezeAsyncOldProps();let c=this.asyncProps[a];c&&(b=this._postProcessValue(c,b),c.resolvedValue=b,c.pendingLoadCount++,c.resolvedLoadCount=c.pendingLoadCount)}_setAsyncPropValue(a,b,c){let d=this.asyncProps[a];d&&c>=d.resolvedLoadCount&&void 0!==b&&(this._freezeAsyncOldProps(),d.resolvedValue=b,d.resolvedLoadCount=c,this.onAsyncPropUpdated(a,b))}_watchPromise(a,b){let c=this.asyncProps[a];if(c){c.pendingLoadCount++;let d=c.pendingLoadCount;b.then(b=>{this.component&&(b=this._postProcessValue(c,b),this._setAsyncPropValue(a,b,d),this._onResolve(a,b))}).catch(b=>{this._onError(a,b)})}}async _resolveAsyncIterable(a,b){if("data"!==a)return void this._setPropValue(a,b);let c=this.asyncProps[a];if(!c)return;c.pendingLoadCount++;let d=c.pendingLoadCount,e=[],f=0;for await(let c of b){if(!this.component)return;let{dataTransform:b}=this.component.props;Object.defineProperty(e=b?b(c,e):e.concat(c),"__diff",{enumerable:!1,value:[{startRow:f,endRow:e.length}]}),f=e.length,this._setAsyncPropValue(a,e,d)}this._onResolve(a,e)}_postProcessValue(a,b){let c=a.type;return c&&this.component&&(c.release&&c.release(a.resolvedValue,c,this.component),c.transform)?c.transform(b,c,this.component):b}_createAsyncPropData(a,b){if(!this.asyncProps[a]){let c=this.component&&this.component.props[j5];this.asyncProps[a]={type:c&&c[a],lastValue:null,resolvedValue:b,pendingLoadCount:0,resolvedLoadCount:0}}}}class qI extends qH{constructor({attributeManager:a,layer:b}){super(b),this.attributeManager=a,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(a,b){let c=this.layer,d=c?.props.fetch;return d?d(b,{propName:a,layer:c}):super._fetch(a,b)}_onResolve(a,b){let c=this.layer;if(c){let d=c.props.onDataLoad;"data"===a&&d&&d(b,{propName:a,layer:c})}}_onError(a,b){let c=this.layer;c&&c.raiseError(b,`loading ${a} of ${this.layer}`)}}let qJ=Object.freeze([]),qK=hE(({oldViewport:a,viewport:b})=>a.equals(b)),qL=new Uint8ClampedArray(0),qM={data:{type:"data",value:qJ,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:a=>a&&a.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(a,{propName:b,layer:c,loaders:d,loadOptions:e,signal:f})=>{let{resourceManager:g}=c.context;e=e||c.getLoadOptions(),d=d||c.props.loaders,f&&(e={...e,fetch:{...e?.fetch,signal:f}});let h=g.contains(a);return(h||e||(g.add({resourceId:a,data:lx(a,d),persistent:!1}),h=!0),h)?g.subscribe({resourceId:a,onChange:a=>c.internalState?.reloadAsyncProp(b,a),consumerId:c.id,requestId:b}):lx(a,d,e)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:hz.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:a})=>[0,-(100*a)]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class qN extends qF{constructor(){super(...arguments),this.internalState=null,this.lifecycle="Awaiting state",this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let a=this;for(;a.parent;)a=a.parent;return a}toString(){let a=this.constructor.layerName||this.constructor.name;return`${a}({id: '${this.props.id}'})`}project(a){lY(this.internalState);let b=this.internalState.viewport||this.context.viewport,[c,d,e]=jN(qv(a,{viewport:b,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),b.pixelProjectionMatrix);return 2===a.length?[c,d]:[c,d,e]}unproject(a){return lY(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(a)}projectPosition(a,b){return lY(this.internalState),function(a,b){let{viewport:c,coordinateSystem:d,coordinateOrigin:e,modelMatrix:f,fromCoordinateSystem:g,fromCoordinateOrigin:h}=function(a){let{viewport:b,modelMatrix:c,coordinateOrigin:d}=a,{coordinateSystem:e,fromCoordinateSystem:f,fromCoordinateOrigin:g}=a;return e===hz.DEFAULT&&(e=b.isGeospatial?hz.LNGLAT:hz.CARTESIAN),void 0===f&&(f=e),void 0===g&&(g=d),{viewport:b,coordinateSystem:e,coordinateOrigin:d,modelMatrix:c,fromCoordinateSystem:f,fromCoordinateOrigin:g}}(b),{autoOffset:i=!0}=b,{geospatialOrigin:j=qt,shaderCoordinateOrigin:k=qt,offsetMode:l=!1}=i?hL(c,d,e):{},n=qv(a,{viewport:c,modelMatrix:f,coordinateSystem:g,coordinateOrigin:h,offsetMode:l});if(l){let a=c.projectPosition(j||k);jA.sub(n,n,a)}return n}(a,{viewport:this.internalState.viewport||this.context.viewport,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...b})}get isComposite(){return!1}get isDrawable(){return!0}setState(a){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,a),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return!!this.internalState&&!this.internalState.isAsyncPropLoading()}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){let a=this.state;return a&&(a.models||a.model&&[a.model])||[]}setShaderModuleProps(...a){for(let b of this.getModels())b.shaderInputs.setProps(...a)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){let{coordinateSystem:a}=this.props;return a===hz.DEFAULT||a===hz.LNGLAT||a===hz.CARTESIAN}onHover(a,b){return!!this.props.onHover&&(this.props.onHover(a,b)||!1)}onClick(a,b){return!!this.props.onClick&&(this.props.onClick(a,b)||!1)}nullPickingColor(){return[0,0,0]}encodePickingColor(a,b=[]){return b[0]=a+1&255,b[1]=a+1>>8&255,b[2]=a+1>>8>>8&255,b}decodePickingColor(a){lY(a instanceof Uint8Array);let[b,c,d]=a;return b+256*c+65536*d-1}getNumInstances(){if(Number.isFinite(this.props.numInstances))return this.props.numInstances;if(this.state&&void 0!==this.state.numInstances)return this.state.numInstances;var a,b,c=this.props.data;if(null===(a=c)||"object"!=typeof a)throw Error("count(): argument not an object");if("function"==typeof c.count)return c.count();if(Number.isFinite(c.size))return c.size;if(Number.isFinite(c.length))return c.length;if(null!==(b=c)&&"object"==typeof b&&b.constructor===Object)return Object.keys(c).length;throw Error("count(): argument not a container")}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){return this.getAttributeManager()?.getBounds(["positions","instancePositions"])}getShaders(a){for(let b of(a=qs(a,{disableWarnings:!0,modules:this.context.defaultShaderModules}),this.props.extensions))a=qs(a,b.getShaders.call(this,b));return a}shouldUpdateState(a){return a.changeFlags.propsOrDataChanged}updateState(a){let b=this.getAttributeManager(),{dataChanged:c}=a.changeFlags;if(c&&b)if(Array.isArray(c))for(let a of c)b.invalidateAll(a);else b.invalidateAll();if(b){let{props:c}=a,d=this.internalState.hasPickingBuffer,e=Number.isInteger(c.highlightedObjectIndex)||c.pickable||c.extensions.some(a=>a.getNeedsPickingBuffer.call(this,a));if(d!==e){this.internalState.hasPickingBuffer=e;let{pickingColors:a,instancePickingColors:c}=b.attributes,d=a||c;d&&(e&&d.constant&&(d.constant=!1,b.invalidate(d.id)),d.value||e||(d.constant=!0,d.value=[0,0,0]))}}}finalizeState(a){for(let a of this.getModels())a.destroy();let b=this.getAttributeManager();b&&b.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(a){for(let b of this.getModels())b.draw(a.renderPass)}getPickingInfo({info:a,mode:b,sourceLayer:c}){let{index:d}=a;return d>=0&&Array.isArray(this.props.data)&&(a.object=this.props.data[d]),a}raiseError(a,b){b&&(a=Error(`${b}: ${a.message}`,{cause:a})),this.props.onError?.(a)||this.context?.onError?.(a,this)}getNeedsRedraw(a={clearRedrawFlags:!1}){return this._getNeedsRedraw(a)}needsUpdate(){return!!this.internalState&&(this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()))}hasUniformTransition(){return this.internalState?.uniformTransitions.active||!1}activateViewport(a){if(!this.internalState)return;let b=this.internalState.viewport;this.internalState.viewport=a,b&&qK({oldViewport:b,viewport:a})||(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(a="all"){let b=this.getAttributeManager();b&&("all"===a?b.invalidateAll():b.invalidate(a))}updateAttributes(a){let b=!1;for(let c in a)a[c].layoutChanged()&&(b=!0);for(let c of this.getModels())this._setModelAttributes(c,a,b)}_updateAttributes(){let a=this.getAttributeManager();if(!a)return;let b=this.props,c=this.getNumInstances(),d=this.getStartIndices();a.update({data:b.data,numInstances:c,startIndices:d,props:b,transitions:b.transitions,buffers:b.data.attributes,context:this});let e=a.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(e)}_updateAttributeTransition(){let a=this.getAttributeManager();a&&a.updateTransition()}_updateUniformTransition(){let{uniformTransitions:a}=this.internalState;if(a.active){let b=a.update(),c=Object.create(this.props);for(let a in b)Object.defineProperty(c,a,{value:b[a]});return c}return this.props}calculateInstancePickingColors(a,{numInstances:b}){if(a.constant)return;let c=Math.floor(qL.length/4);if(this.internalState.usesPickingColorCache=!0,c<b){b>0xffffff&&gT.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")();let a=Math.floor((qL=lA.allocate(qL,b,{size:4,copy:!0,maxCount:Math.max(b,0xffffff)})).length/4),d=[0,0,0];for(let b=c;b<a;b++)this.encodePickingColor(b,d),qL[4*b+0]=d[0],qL[4*b+1]=d[1],qL[4*b+2]=d[2],qL[4*b+3]=0}a.value=qL.subarray(0,4*b)}_setModelAttributes(a,b,c=!1){if(!Object.keys(b).length)return;if(c){let c=this.getAttributeManager();a.setBufferLayout(c.getBufferLayouts(a)),b=c.getAttributes()}let d=a.userData?.excludeAttributes||{},e={},f={};for(let c in b){if(d[c])continue;let g=b[c].getValue();for(let d in g){let h=g[d];h instanceof nr.Buffer?b[c].settings.isIndexed?a.setIndexBuffer(h):e[d]=h:h&&(f[d]=h)}}a.setAttributes(e),a.setConstantAttributes(f)}disablePickingIndex(a){let b=this.props.data;if(!("attributes"in b))return void this._disablePickingIndex(a);let{pickingColors:c,instancePickingColors:d}=this.getAttributeManager().attributes,e=c||d,f=e&&b.attributes&&b.attributes[e.id];if(f&&f.value){let c=f.value,d=this.encodePickingColor(a);for(let a=0;a<b.length;a++){let b=e.getVertexOffset(a);c[b]===d[0]&&c[b+1]===d[1]&&c[b+2]===d[2]&&this._disablePickingIndex(a)}}else this._disablePickingIndex(a)}_disablePickingIndex(a){let{pickingColors:b,instancePickingColors:c}=this.getAttributeManager().attributes,d=b||c;if(!d)return;let e=d.getVertexOffset(a),f=d.getVertexOffset(a+1);d.buffer.write(new Uint8Array(f-e),e)}restorePickingColors(){let{pickingColors:a,instancePickingColors:b}=this.getAttributeManager().attributes,c=a||b;c&&(this.internalState.usesPickingColorCache&&c.value.buffer!==qL.buffer&&(c.value=qL.subarray(0,c.value.length)),c.updateSubBuffer({startOffset:0}))}_initialize(){lY(!this.internalState),lY(Number.isFinite(this.props.coordinateSystem)),kc("layer.initialize",this);let a=this._getAttributeManager();for(let b of(a&&a.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new qI({attributeManager:a,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(gT.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),a)}),this.internalState.uniformTransitions=new qo(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context),this.props.extensions))b.initializeState.call(this,this.context,b);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(a){kc("layer.matched",this,this===a);let{state:b,internalState:c}=a;this!==a&&(this.internalState=c,this.state=b,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){let a=this.needsUpdate();if(kc("layer.update",this,a),!a)return;let b=this.props,c=this.context,d=this.internalState,e=c.viewport,f=this._updateUniformTransition();d.propsInTransition=f,c.viewport=d.viewport||e,this.props=f;try{let a=this._getUpdateParams(),b=this.getModels();if(c.device)this.updateState(a);else try{this.updateState(a)}catch(a){}for(let b of this.props.extensions)b.updateState.call(this,a,b);this.setNeedsRedraw(),this._updateAttributes();let d=this.getModels()[0]!==b[0];this._postUpdate(a,d)}finally{c.viewport=e,this.props=b,this._clearChangeFlags(),d.needsUpdate=!1,d.resetOldProps()}}_finalize(){for(let a of(kc("layer.finalize",this),this.finalizeState(this.context),this.props.extensions))a.finalizeState.call(this,this.context,a)}_drawLayer({renderPass:a,shaderModuleProps:b=null,uniforms:c={},parameters:d={}}){this._updateAttributeTransition();let e=this.props,f=this.context;this.props=this.internalState.propsInTransition||e;try{b&&this.setShaderModuleProps(b);let{getPolygonOffset:e}=this.props,g=e&&e(c)||[0,0];for(let a of(f.device instanceof ns.WebGLDevice&&f.device.setParametersWebGL({polygonOffset:g}),this.getModels()))"webgpu"===a.device.type?a.setParameters({...a.parameters,...d}):a.setParameters(d);if(f.device instanceof ns.WebGLDevice)f.device.withParametersWebGL(d,()=>{let e={renderPass:a,shaderModuleProps:b,uniforms:c,parameters:d,context:f};for(let a of this.props.extensions)a.draw.call(this,e,a);this.draw(e)});else{let e={renderPass:a,shaderModuleProps:b,uniforms:c,parameters:d,context:f};for(let a of this.props.extensions)a.draw.call(this,e,a);this.draw(e)}}finally{this.props=e}}getChangeFlags(){return this.internalState?.changeFlags}setChangeFlags(a){if(!this.internalState)return;let{changeFlags:b}=this.internalState;for(let c in a)if(a[c]){let d=!1;if("dataChanged"===c){let e=a[c],f=b[c];e&&Array.isArray(f)&&(b.dataChanged=Array.isArray(e)?f.concat(e):e,d=!0)}b[c]||(b[c]=a[c],d=!0),d&&kc("layer.changeFlag",this,c,a)}let c=!!(b.dataChanged||b.updateTriggersChanged||b.propsChanged||b.extensionsChanged);b.propsOrDataChanged=c,b.somethingChanged=c||b.viewportChanged||b.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(a,b){let c,d,e,f=(c=qp({newProps:a,oldProps:b,propTypes:a[j5],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),d=function(a,b){if(null===b)return"oldProps is null, initial diff";let c=!1,{dataComparator:d,_dataDiff:e}=a;return d?d(a.data,b.data)||(c="Data comparator detected a change"):a.data!==b.data&&(c="A new data container was supplied"),c&&e&&(c=e(a.data,b.data)||c),c}(a,b),e=!1,d||(e=function(a,b){if(null===b||"all"in a.updateTriggers&&qr(a,b,"all"))return{all:!0};let c={},d=!1;for(let e in a.updateTriggers)"all"!==e&&qr(a,b,e)&&(c[e]=!0,d=!0);return!!d&&c}(a,b)),{dataChanged:d,propsChanged:c,updateTriggersChanged:e,extensionsChanged:function(a,b){if(null===b)return!0;let c=b.extensions,{extensions:d}=a;if(d===c)return!1;if(!c||!d||d.length!==c.length)return!0;for(let a=0;a<d.length;a++)if(!d[a].equals(c[a]))return!0;return!1}(a,b),transitionsChanged:function(a,b){if(!a.transitions)return!1;let c={},d=a[j5],e=!1;for(let f in a.transitions){let g=d[f],h=g&&g.type;("number"===h||"color"===h||"array"===h)&&qq(a[f],b[f],g)&&(c[f]=!0,e=!0)}return!!e&&c}(a,b)});if(f.updateTriggersChanged)for(let a in f.updateTriggersChanged)f.updateTriggersChanged[a]&&this.invalidateAttribute(a);if(f.transitionsChanged)for(let c in f.transitionsChanged)this.internalState.uniformTransitions.add(c,b[c],a[c],a.transitions?.[c]);return this.setChangeFlags(f)}validateProps(){!function(a){let b=a[j5];for(let c in b){let d=b[c],{validate:e}=d;if(e&&!e(a[c],d))throw Error(`Invalid prop ${c}: ${a[c]}`)}}(this.props)}updateAutoHighlight(a){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(a)}_updateAutoHighlight(a){let b={highlightedObjectColor:a.picked?a.color:null},{highlightColor:c}=this.props;a.picked&&"function"==typeof c&&(b.highlightColor=c(a)),this.setShaderModuleProps({picking:b}),this.setNeedsRedraw()}_getAttributeManager(){let a=this.context;return new qk(a.device,{id:this.props.id,stats:a.stats,timeline:a.timeline})}_postUpdate(a,b){let{props:c,oldProps:d}=a,e=this.state.model;e?.isInstanced&&e.setInstanceCount(this.getNumInstances());let{autoHighlight:f,highlightedObjectIndex:g,highlightColor:h}=c;if(b||d.autoHighlight!==f||d.highlightedObjectIndex!==g||d.highlightColor!==h){let a={};Array.isArray(h)&&(a.highlightColor=h),(b||d.autoHighlight!==f||g!==d.highlightedObjectIndex)&&(a.highlightedObjectColor=Number.isFinite(g)&&g>=0?this.encodePickingColor(g):null),this.setShaderModuleProps({picking:a})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(a){if(!this.internalState)return!1;let b=!1;b=this.internalState.needsRedraw&&this.id;let c=this.getAttributeManager(),d=!!c&&c.getNeedsRedraw(a);if(b=b||d)for(let a of this.props.extensions)a.onNeedsRedraw.call(this,a);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!a.clearRedrawFlags,b}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}qN.defaultProps=qM,qN.layerName="Layer";let qO=qN,qP={position:"absolute",zIndex:-1};function qQ(a){return a&&"object"==typeof a&&"type"in a||!1}let qR=(0,u.createContext)(),qS={mixBlendMode:null};function qT(a){a.redrawReason&&(a.deck._drawLayers(a.redrawReason),a.redrawReason=null)}let qU=u.forwardRef(function(a,b){let[c,d]=(0,u.useState)(0),e=(0,u.useRef)({control:null,version:c,forceUpdate:()=>d(a=>a+1)}).current,f=(0,u.useRef)(null),g=(0,u.useRef)(null),h=(0,u.useMemo)(()=>(function({children:a,layers:b=[],views:c=null}){let d=[],e=[],f={};return u.Children.forEach(function a(b){if("function"==typeof b)return(0,u.createElement)(lS,{},b);if(Array.isArray(b))return b.map(a);if(qQ(b)){if(b.type===u.Fragment)return a(b.props.children);nq(b.type,lS)}return b}(a),a=>{if(qQ(a)){let b=a.type;if(nq(b,qO)){let c=function(a,b){let c={},d=a.defaultProps||{};for(let a in b)d[a]!==b[a]&&(c[a]=b[a]);return new a(c)}(b,a.props);e.push(c)}else d.push(a);if(nq(b,lS)&&b!==lS&&a.props.id){let c=new b(a.props);f[c.id]=c}}else a&&d.push(a)}),Object.keys(f).length>0&&(Array.isArray(c)?c.forEach(a=>{f[a.id]=a}):c&&(f[c.id]=c),c=Object.values(f)),{layers:b=e.length>0?[...e,...b]:b,children:d,views:c}})(a),[a.layers,a.views,a.children]),i=!0,j=b=>i&&a.viewState?(e.viewStateUpdateRequested=b,null):(e.viewStateUpdateRequested=null,a.onViewStateChange?.(b)),k=b=>{i?e.interactionStateUpdateRequested=b:(e.interactionStateUpdateRequested=null,a.onInteractionStateChange?.(b))},l=(0,u.useMemo)(()=>{let b={widgets:[],...a,style:null,width:"100%",height:"100%",parent:f.current,canvas:g.current,layers:h.layers,views:h.views,onViewStateChange:j,onInteractionStateChange:k};return delete b._customRender,e.deck&&e.deck.setProps(b),b},[a]);(0,u.useEffect)(()=>{var b;let c;return c=new(a.Deck||no)({...b={...l,parent:f.current,canvas:g.current},_customRender:b.deviceProps?.adapters?.[0]?.type==="webgpu"?void 0:a=>{e.redrawReason=a;let b=c.getViewports();e.lastRenderedViewports!==b?e.forceUpdate():qT(e)}}),e.deck=c,()=>e.deck?.finalize()},[]),np(()=>{qT(e);let{viewStateUpdateRequested:a,interactionStateUpdateRequested:b}=e;a&&j(a),b&&k(b),e.deck?.isInitialized&&e.deck.redraw("Initial render")}),(0,u.useImperativeHandle)(b,()=>({get deck(){return e.deck},pickObject:a=>e.deck.pickObject(a),pickMultipleObjects:a=>e.deck.pickMultipleObjects(a),pickObjects:a=>e.deck.pickObjects(a)}),[]);let n=e.deck&&e.deck.isInitialized?e.deck.getViewports():void 0,{ContextProvider:o,width:p="100%",height:q="100%",id:r,style:s}=a,{containerStyle:t,canvasStyle:v}=(0,u.useMemo)(()=>(function({width:a,height:b,style:c}){let d={position:"absolute",zIndex:0,left:0,top:0,width:a,height:b},e={left:0,top:0};if(c)for(let a in c)a in qS?e[a]=c[a]:d[a]=c[a];return{containerStyle:d,canvasStyle:e}})({width:p,height:q,style:s}),[p,q,s]);if(!e.viewStateUpdateRequested&&e.lastRenderedViewports===n||e.version!==c){e.lastRenderedViewports=n,e.version=c;let a=function({children:a,deck:b,ContextProvider:c=qR.Provider}){let{viewManager:d}=b||{};if(!d||!d.views.length)return[];let e={},f=d.views[0].id;for(let b of a){let a=f,c=b;qQ(b)&&nq(b.type,lS)&&(a=b.props.id||f,c=b.props.children);let g=d.getViewport(a),h=d.getViewState(a);if(g){h.padding=g.padding;let{x:b,y:d,width:f,height:i}=g;c=function a(b,c){if("function"==typeof b)return b(c);if(Array.isArray(b))return b.map(b=>a(b,c));if(qQ(b)){var d;if(d=b,d.props?.mapStyle)return c.style=qP,(0,u.cloneElement)(b,c);if(function(a){let b=a.type;return b&&b.deckGLViewProps}(b))return(0,u.cloneElement)(b,c)}return b}(c,{x:b,y:d,width:f,height:i,viewport:g,viewState:h}),e[a]||(e[a]={viewport:g,children:[]}),e[a].children.push(c)}}return Object.keys(e).map(a=>{let{viewport:d,children:f}=e[a],{x:g,y:h,width:i,height:j}=d,k=`view-${a}`,l=(0,u.createElement)("div",{key:k,id:k,style:{position:"absolute",left:g,top:h,width:i,height:j}},...f),n={deck:b,viewport:d,container:b.canvas.offsetParent,eventManager:b.eventManager,onViewStateChange:c=>{c.viewId=a,b._onViewStateChange(c)},widgets:[]},o=`view-${a}-context`;return(0,u.createElement)(c,{key:o,value:n},l)})}({children:h.children,deck:e.deck,ContextProvider:o}),b=(0,u.createElement)("canvas",{key:"canvas",id:r||"deckgl-overlay",ref:g,style:v});e.control=(0,u.createElement)("div",{id:`${r||"deckgl"}-wrapper`,ref:f,style:t},[b,a])}return i=!1,e.control});class qV{id;topology;vertexCount;indices;attributes;userData={};constructor(a){const{attributes:b={},indices:c=null,vertexCount:d=null}=a;for(const[d,e]of(this.id=a.id||pL("geometry"),this.topology=a.topology,c&&(this.indices=ArrayBuffer.isView(c)?{value:c,size:1}:c),this.attributes={},Object.entries(b))){const a=ArrayBuffer.isView(e)?{value:e}:e;if(!ArrayBuffer.isView(a.value))throw Error(`${this._print(d)}: must be typed array or object with value as typed array`);if("POSITION"!==d&&"positions"!==d||a.size||(a.size=3),"indices"===d){if(this.indices)throw Error("Multiple indices detected");this.indices=a}else this.attributes[d]=a}this.indices&&void 0!==this.indices.isIndexed&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=d||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(a){return`Geometry ${this.id} attribute ${a}`}_setAttributes(a,b){return this}_calculateVertexCount(a,b){if(b)return b.value.length;let c=1/0;for(let b of Object.values(a)){let{value:a,size:d,constant:e}=b;!e&&a&&void 0!==d&&d>=1&&(c=Math.min(c,a.length/d))}return c}}let qW=`\
uniform scatterplotUniforms {
  float radiusScale;
  float radiusMinPixels;
  float radiusMaxPixels;
  float lineWidthScale;
  float lineWidthMinPixels;
  float lineWidthMaxPixels;
  float stroked;
  float filled;
  bool antialiasing;
  bool billboard;
  highp int radiusUnits;
  highp int lineWidthUnits;
} scatterplot;
`,qX={name:"scatterplot",vs:qW,fs:qW,source:"",uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}},qY=`\
#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),
scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),
scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
);
outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
float edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;
if (scatterplot.billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,qZ=`\
#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = scatterplot.antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (scatterplot.stroked > 0.5) {
float isLine = scatterplot.antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (scatterplot.filled > 0.5) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (scatterplot.filled < 0.5) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,q$=`\
// Main shaders

struct ScatterplotUniforms {
  radiusScale: f32,
  radiusMinPixels: f32,
  radiusMaxPixels: f32,
  lineWidthScale: f32,
  lineWidthMinPixels: f32,
  lineWidthMaxPixels: f32,
  stroked: f32,
  filled: i32,
  antialiasing: i32,
  billboard: i32,
  radiusUnits: i32,
  lineWidthUnits: i32,
};

struct ConstantAttributeUniforms {
 instancePositions: vec3<f32>,
 instancePositions64Low: vec3<f32>,
 instanceRadius: f32,
 instanceLineWidths: f32,
 instanceFillColors: vec4<f32>,
 instanceLineColors: vec4<f32>,
 instancePickingColors: vec3<f32>,

 instancePositionsConstant: i32,
 instancePositions64LowConstant: i32,
 instanceRadiusConstant: i32,
 instanceLineWidthsConstant: i32,
 instanceFillColorsConstant: i32,
 instanceLineColorsConstant: i32,
 instancePickingColorsConstant: i32
};

@group(0) @binding(2) var<uniform> scatterplot: ScatterplotUniforms;

struct ConstantAttributes {
  instancePositions: vec3<f32>,
  instancePositions64Low: vec3<f32>,
  instanceRadius: f32,
  instanceLineWidths: f32,
  instanceFillColors: vec4<f32>,
  instanceLineColors: vec4<f32>,
  instancePickingColors: vec3<f32>
};

const constants = ConstantAttributes(
  vec3<f32>(0.0),
  vec3<f32>(0.0),
  0.0,
  0.0,
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec3<f32>(0.0)
);

struct Attributes {
  @builtin(instance_index) instanceIndex : u32,
  @builtin(vertex_index) vertexIndex : u32,
  @location(0) positions: vec3<f32>,
  @location(1) instancePositions: vec3<f32>,
  @location(2) instancePositions64Low: vec3<f32>,
  @location(3) instanceRadius: f32,
  @location(4) instanceLineWidths: f32,
  @location(5) instanceFillColors: vec4<f32>,
  @location(6) instanceLineColors: vec4<f32>,
  @location(7) instancePickingColors: vec3<f32>
};

struct Varyings {
  @builtin(position) position: vec4<f32>,
  @location(0) vFillColor: vec4<f32>,
  @location(1) vLineColor: vec4<f32>,
  @location(2) unitPosition: vec2<f32>,
  @location(3) innerUnitRadius: f32,
  @location(4) outerRadiusPixels: f32,
};

@vertex
fn vertexMain(attributes: Attributes) -> Varyings {
  var varyings: Varyings;

  // Draw an inline geometry constant array clip space triangle to verify that rendering works.
  // var positions = array<vec2<f32>, 3>(vec2(0.0, 0.5), vec2(-0.5, -0.5), vec2(0.5, -0.5));
  // if (attributes.instanceIndex == 0) {
  //   varyings.position = vec4<f32>(positions[attributes.vertexIndex], 0.0, 1.0);
  //   return varyings;
  // }

  // var geometry: Geometry;
  // geometry.worldPosition = instancePositions;

  // Multiply out radius and clamp to limits
  varyings.outerRadiusPixels = clamp(
    project_unit_size_to_pixel(scatterplot.radiusScale * attributes.instanceRadius, scatterplot.radiusUnits),
    scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
  );

  // Multiply out line width and clamp to limits
  let lineWidthPixels = clamp(
    project_unit_size_to_pixel(scatterplot.lineWidthScale * attributes.instanceLineWidths, scatterplot.lineWidthUnits),
    scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
  );

  // outer radius needs to offset by half stroke width
  varyings.outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
  // Expand geometry to accommodate edge smoothing
  let edgePadding = select(
    (varyings.outerRadiusPixels + SMOOTH_EDGE_RADIUS) / varyings.outerRadiusPixels,
    1.0,
    scatterplot.antialiasing != 0
  );

  // position on the containing square in [-1, 1] space
  varyings.unitPosition = edgePadding * attributes.positions.xy;
  geometry.uv = varyings.unitPosition;
  geometry.pickingColor = attributes.instancePickingColors;

  varyings.innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / varyings.outerRadiusPixels;

  if (scatterplot.billboard != 0) {
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, vec3<f32>(0.0)); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
    let offset = attributes.positions; // * edgePadding * varyings.outerRadiusPixels;
    // DECKGL_FILTER_SIZE(offset, geometry);
    let clipPixels = project_pixel_size_to_clipspace(offset.xy);
    varyings.position.x = clipPixels.x;
    varyings.position.y = clipPixels.y;
  } else {
    let offset = edgePadding * attributes.positions * project_pixel_size_float(varyings.outerRadiusPixels);
    // DECKGL_FILTER_SIZE(offset, geometry);
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, offset); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
  }

  // Apply opacity to instance color, or return instance picking color
  varyings.vFillColor = vec4<f32>(attributes.instanceFillColors.rgb, attributes.instanceFillColors.a * color.opacity);
  // DECKGL_FILTER_COLOR(varyings.vFillColor, geometry);
  varyings.vLineColor = vec4<f32>(attributes.instanceLineColors.rgb, attributes.instanceLineColors.a * color.opacity);
  // DECKGL_FILTER_COLOR(varyings.vLineColor, geometry);

  return varyings;
}

@fragment
fn fragmentMain(varyings: Varyings) -> @location(0) vec4<f32> {
  // var geometry: Geometry;
  // geometry.uv = unitPosition;

  let distToCenter = length(varyings.unitPosition) * varyings.outerRadiusPixels;
  let inCircle = select(
    smoothedge(distToCenter, varyings.outerRadiusPixels),
    step(distToCenter, varyings.outerRadiusPixels),
    scatterplot.antialiasing != 0
  );

  if (inCircle == 0.0) {
    discard;
  }

  var fragColor: vec4<f32>;

  if (scatterplot.stroked != 0) {
    let isLine = select(
      smoothedge(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      step(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      scatterplot.antialiasing != 0
    );

    if (scatterplot.filled != 0) {
      fragColor = mix(varyings.vFillColor, varyings.vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        discard;
      }
      fragColor = vec4<f32>(varyings.vLineColor.rgb, varyings.vLineColor.a * isLine);
    }
  } else if (scatterplot.filled == 0) {
    discard;
  } else {
    fragColor = varyings.vFillColor;
  }

  fragColor.a *= inCircle;
  // DECKGL_FILTER_COLOR(fragColor, geometry);

  // Apply premultiplied alpha as required by transparent canvas
  fragColor = deckgl_premultiplied_alpha(fragColor);

  return fragColor;
  // return vec4<f32>(0, 0, 1, 1);
}
`,q_=[0,0,0,255],q0={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:a=>a.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:q_},getLineColor:{type:"accessor",value:q_},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class q1 extends qO{getShaders(){return super.getShaders({vs:qY,fs:qZ,source:q$,modules:[hW,fr,j0,qX]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(a){super.updateState(a),a.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:a}){let{radiusUnits:b,radiusScale:c,radiusMinPixels:d,radiusMaxPixels:e,stroked:f,filled:g,billboard:h,antialiasing:i,lineWidthUnits:j,lineWidthScale:k,lineWidthMinPixels:l,lineWidthMaxPixels:n}=this.props,o={stroked:f,filled:g,billboard:h,antialiasing:i,radiusUnits:hB[b],radiusScale:c,radiusMinPixels:d,radiusMaxPixels:e,lineWidthUnits:hB[j],lineWidthScale:k,lineWidthMinPixels:l,lineWidthMaxPixels:n},p=this.state.model;p.shaderInputs.setProps({scatterplot:o}),"webgpu"===this.context.device.type&&(p.instanceCount=this.props.data.length),p.draw(this.context.renderPass)}_getModel(){let a="webgpu"===this.context.device.type?{depthWriteEnabled:!0,depthCompare:"less-equal"}:void 0;return new p_(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new qV({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array([-1,-1,0,1,-1,0,-1,1,0,1,1,0])}}}),isInstanced:!0,parameters:a})}}q1.defaultProps=q0,q1.layerName="ScatterplotLayer";let q2=`\
uniform arcUniforms {
  bool greatCircle;
  bool useShortestPath;
  float numSegments;
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  highp int widthUnits;
} arc;
`,q3={name:"arc",vs:q2,fs:q2,uniformTypes:{greatCircle:"f32",useShortestPath:"f32",numSegments:"f32",widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",widthUnits:"i32"}},q4=`\
#version 300 es
#define SHADER_NAME arc-layer-vertex-shader
in vec4 instanceSourceColors;
in vec4 instanceTargetColors;
in vec3 instanceSourcePositions;
in vec3 instanceSourcePositions64Low;
in vec3 instanceTargetPositions;
in vec3 instanceTargetPositions64Low;
in vec3 instancePickingColors;
in float instanceWidths;
in float instanceHeights;
in float instanceTilts;
out vec4 vColor;
out vec2 uv;
out float isValid;
float paraboloid(float distance, float sourceZ, float targetZ, float ratio) {
float deltaZ = targetZ - sourceZ;
float dh = distance * instanceHeights;
if (dh == 0.0) {
return sourceZ + deltaZ * ratio;
}
float unitZ = deltaZ / dh;
float p2 = unitZ * unitZ + 1.0;
float dir = step(deltaZ, 0.0);
float z0 = mix(sourceZ, targetZ, dir);
float r = mix(ratio, 1.0 - ratio, dir);
return sqrt(r * (p2 - r)) * dh + z0;
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
vec2 dir_screenspace = normalize(line_clipspace * project.viewportSize);
dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
return dir_screenspace * offset_direction * width / 2.0;
}
float getSegmentRatio(float index) {
return smoothstep(0.0, 1.0, index / (arc.numSegments - 1.0));
}
vec3 interpolateFlat(vec3 source, vec3 target, float segmentRatio) {
float distance = length(source.xy - target.xy);
float z = paraboloid(distance, source.z, target.z, segmentRatio);
float tiltAngle = radians(instanceTilts);
vec2 tiltDirection = normalize(target.xy - source.xy);
vec2 tilt = vec2(-tiltDirection.y, tiltDirection.x) * z * sin(tiltAngle);
return vec3(
mix(source.xy, target.xy, segmentRatio) + tilt,
z * cos(tiltAngle)
);
}
float getAngularDist (vec2 source, vec2 target) {
vec2 sourceRadians = radians(source);
vec2 targetRadians = radians(target);
vec2 sin_half_delta = sin((sourceRadians - targetRadians) / 2.0);
vec2 shd_sq = sin_half_delta * sin_half_delta;
float a = shd_sq.y + cos(sourceRadians.y) * cos(targetRadians.y) * shd_sq.x;
return 2.0 * asin(sqrt(a));
}
vec3 interpolateGreatCircle(vec3 source, vec3 target, vec3 source3D, vec3 target3D, float angularDist, float t) {
vec2 lngLat;
if(abs(angularDist - PI) < 0.001) {
lngLat = (1.0 - t) * source.xy + t * target.xy;
} else {
float a = sin((1.0 - t) * angularDist);
float b = sin(t * angularDist);
vec3 p = source3D.yxz * a + target3D.yxz * b;
lngLat = degrees(vec2(atan(p.y, -p.x), atan(p.z, length(p.xy))));
}
float z = paraboloid(angularDist * EARTH_RADIUS, source.z, target.z, t);
return vec3(lngLat, z);
}
void main(void) {
geometry.worldPosition = instanceSourcePositions;
geometry.worldPositionAlt = instanceTargetPositions;
float segmentIndex = float(gl_VertexID / 2);
float segmentSide = mod(float(gl_VertexID), 2.) == 0. ? -1. : 1.;
float segmentRatio = getSegmentRatio(segmentIndex);
float prevSegmentRatio = getSegmentRatio(max(0.0, segmentIndex - 1.0));
float nextSegmentRatio = getSegmentRatio(min(arc.numSegments - 1.0, segmentIndex + 1.0));
float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
isValid = 1.0;
uv = vec2(segmentRatio, segmentSide);
geometry.uv = uv;
geometry.pickingColor = instancePickingColors;
vec4 curr;
vec4 next;
vec3 source;
vec3 target;
if ((arc.greatCircle || project.projectionMode == PROJECTION_MODE_GLOBE) && project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
source = project_globe_(vec3(instanceSourcePositions.xy, 0.0));
target = project_globe_(vec3(instanceTargetPositions.xy, 0.0));
float angularDist = getAngularDist(instanceSourcePositions.xy, instanceTargetPositions.xy);
vec3 prevPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, prevSegmentRatio);
vec3 currPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, segmentRatio);
vec3 nextPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, nextSegmentRatio);
if (abs(currPos.x - prevPos.x) > 180.0) {
indexDir = -1.0;
isValid = 0.0;
} else if (abs(currPos.x - nextPos.x) > 180.0) {
indexDir = 1.0;
isValid = 0.0;
}
nextPos = indexDir < 0.0 ? prevPos : nextPos;
nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;
if (isValid == 0.0) {
nextPos.x += nextPos.x > 0.0 ? -360.0 : 360.0;
float t = ((currPos.x > 0.0 ? 180.0 : -180.0) - currPos.x) / (nextPos.x - currPos.x);
currPos = mix(currPos, nextPos, t);
segmentRatio = mix(segmentRatio, nextSegmentRatio, t);
}
vec3 currPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, segmentRatio);
vec3 nextPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, nextSegmentRatio);
curr = project_position_to_clipspace(currPos, currPos64Low, vec3(0.0), geometry.position);
next = project_position_to_clipspace(nextPos, nextPos64Low, vec3(0.0));
} else {
vec3 source_world = instanceSourcePositions;
vec3 target_world = instanceTargetPositions;
if (arc.useShortestPath) {
source_world.x = mod(source_world.x + 180., 360.0) - 180.;
target_world.x = mod(target_world.x + 180., 360.0) - 180.;
float deltaLng = target_world.x - source_world.x;
if (deltaLng > 180.) target_world.x -= 360.;
if (deltaLng < -180.) source_world.x -= 360.;
}
source = project_position(source_world, instanceSourcePositions64Low);
target = project_position(target_world, instanceTargetPositions64Low);
float antiMeridianX = 0.0;
if (arc.useShortestPath) {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
antiMeridianX = -(project.coordinateOrigin.x + 180.) / 360. * TILE_SIZE;
}
float thresholdRatio = (antiMeridianX - source.x) / (target.x - source.x);
if (prevSegmentRatio <= thresholdRatio && nextSegmentRatio > thresholdRatio) {
isValid = 0.0;
indexDir = sign(segmentRatio - thresholdRatio);
segmentRatio = thresholdRatio;
}
}
nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;
vec3 currPos = interpolateFlat(source, target, segmentRatio);
vec3 nextPos = interpolateFlat(source, target, nextSegmentRatio);
if (arc.useShortestPath) {
if (nextPos.x < antiMeridianX) {
currPos.x += TILE_SIZE;
nextPos.x += TILE_SIZE;
}
}
curr = project_common_position_to_clipspace(vec4(currPos, 1.0));
next = project_common_position_to_clipspace(vec4(nextPos, 1.0));
geometry.position = vec4(currPos, 1.0);
}
float widthPixels = clamp(
project_size_to_pixel(instanceWidths * arc.widthScale, arc.widthUnits),
arc.widthMinPixels, arc.widthMaxPixels
);
vec3 offset = vec3(
getExtrusionOffset((next.xy - curr.xy) * indexDir, segmentSide, widthPixels),
0.0);
DECKGL_FILTER_SIZE(offset, geometry);
DECKGL_FILTER_GL_POSITION(curr, geometry);
gl_Position = curr + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio);
vColor = vec4(color.rgb, color.a * layer.opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,q5=`\
#version 300 es
#define SHADER_NAME arc-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 uv;
in float isValid;
out vec4 fragColor;
void main(void) {
if (isValid == 0.0) {
discard;
}
fragColor = vColor;
geometry.uv = uv;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,q6=[0,0,0,255],q7={getSourcePosition:{type:"accessor",value:a=>a.sourcePosition},getTargetPosition:{type:"accessor",value:a=>a.targetPosition},getSourceColor:{type:"accessor",value:q6},getTargetColor:{type:"accessor",value:q6},getWidth:{type:"accessor",value:1},getHeight:{type:"accessor",value:1},getTilt:{type:"accessor",value:0},greatCircle:!1,numSegments:{type:"number",value:50,min:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class q8 extends qO{getBounds(){return this.getAttributeManager()?.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:q4,fs:q5,modules:[hW,j0,q3]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceSourceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getSourceColor",defaultValue:q6},instanceTargetColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getTargetColor",defaultValue:q6},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1},instanceHeights:{size:1,transition:!0,accessor:"getHeight",defaultValue:1},instanceTilts:{size:1,transition:!0,accessor:"getTilt",defaultValue:0}})}updateState(a){super.updateState(a),a.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:a}){let{widthUnits:b,widthScale:c,widthMinPixels:d,widthMaxPixels:e,greatCircle:f,wrapLongitude:g,numSegments:h}=this.props,i={numSegments:h,widthUnits:hB[b],widthScale:c,widthMinPixels:d,widthMaxPixels:e,greatCircle:f,useShortestPath:g},j=this.state.model;j.shaderInputs.setProps({arc:i}),j.setVertexCount(2*h),j.draw(this.context.renderPass)}_getModel(){return new p_(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),topology:"triangle-strip",isInstanced:!0})}}function q9({data:a}){let{jtbd:b=[]}=a||{},c=(0,u.useMemo)(()=>[{id:"",name:"Validation",lat:40.6928,lon:-74.006,entropy:50,color:[255,165,0]},{id:"",name:"Temporal",lat:40.6978,lon:-73.986,entropy:45.8,color:[255,140,0]},{id:"",name:"Geographic",lat:40.7028,lon:-73.966,entropy:40,color:[255,100,0]},{id:"",name:"Batch",lat:40.7078,lon:-73.946,entropy:32.9,color:[255,69,0]},{id:"",name:"Threshold",lat:40.7128,lon:-73.926,entropy:26.6,color:[220,20,60]},{id:"",name:"Cascading",lat:40.7128+.005,lon:-73.906,entropy:20.4,color:[178,34,52]},{id:"",name:"Complex",lat:40.7228,lon:-73.886,entropy:14.2,color:[139,0,0]},{id:"",name:"Deterministic",lat:40.7278,lon:-73.866,entropy:8,color:[75,0,130]}],[]),d=(0,u.useMemo)(()=>{let a=[];for(let b=0;b<c.length-1;b++){let d=c[b],e=c[b+1];a.push({sourcePosition:[d.lon,d.lat],targetPosition:[e.lon,e.lat],entropy:d.entropy-e.entropy})}return a},[c]),e=(0,u.useMemo)(()=>b.map((a,b)=>({position:[-74.256+.08*b,40.7128+.02+.04*Math.random()],latency:a.latency,reduction:a.reduction,name:a.name,color:[100+20*b,150,200],size:Math.min(100*a.reduction,5e4)})),[b]),f=[new q8({id:"operator-flow",data:d,getSourcePosition:a=>a.sourcePosition,getTargetPosition:a=>a.targetPosition,getSourceColor:a=>[100,150,255,200],getTargetColor:a=>[100,100,255,100],getWidth:a=>2*a.entropy,widthScale:20,widthMinPixels:2,interactive:!0,pickable:!0}),new q1({id:"operators",data:c,getPosition:a=>[a.lon,a.lat],getRadius:a=>1e3*Math.sqrt(a.entropy),getColor:a=>a.color,radiusScale:6,radiusMinPixels:15,radiusMaxPixels:40,interactive:!0,pickable:!0,autoHighlight:!0,onHover:a=>{a.object?document.body.style.cursor="pointer":document.body.style.cursor="default"}}),new q1({id:"jtbd-scenarios",data:e,getPosition:a=>a.position,getRadius:a=>a.size,getColor:a=>a.color,radiusScale:10,radiusMinPixels:8,radiusMaxPixels:30,interactive:!0,pickable:!0,autoHighlight:!0})];return(0,t.jsxs)("div",{className:"card space-y-4 h-96",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-cyan-400",children:"Geographic Operator Distribution"}),(0,t.jsx)("p",{className:"text-sm text-slate-400",children:"Information cascade across 8 operators with JTBD scenario density. Arc width represents entropy reduction per operator."})]}),(0,t.jsxs)("div",{className:"relative h-96 rounded border border-slate-700 overflow-hidden bg-slate-950",children:[(0,t.jsx)(qU,{layers:f,initialViewState:{longitude:-74.006,latitude:40.7128,zoom:10,pitch:45,bearing:0},controller:!0,onViewStateChange:({viewState:a})=>{}}),(0,t.jsxs)("div",{className:"absolute bottom-4 left-4 bg-slate-900/80 border border-slate-700 rounded p-3 text-xs text-slate-300 backdrop-blur",children:[(0,t.jsx)("div",{className:"font-semibold text-cyan-400 mb-2",children:"Map Controls"}),(0,t.jsx)("div",{children:" Drag to rotate |  Scroll to zoom | Right-click drag to tilt"}),(0,t.jsxs)("div",{className:"mt-2 space-y-1",children:[(0,t.jsx)("div",{children:" Orange: Operators - (high entropy)"}),(0,t.jsx)("div",{children:" Red: Operators - (medium entropy)"}),(0,t.jsx)("div",{children:" Purple:  (deterministic output)"}),(0,t.jsx)("div",{children:" Blue: JTBD scenarios (density heatmap)"})]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-xs",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("div",{className:"font-semibold text-cyan-400",children:"Operator Cascade"}),c.slice(0,4).map(a=>(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:`rgb(${a.color.join(",")})`}}),(0,t.jsxs)("span",{className:"text-slate-300",children:[a.id,": ",a.name]})]},a.id))]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("div",{className:"font-semibold text-cyan-400",children:"Entropy Levels"}),c.slice(4).map(a=>(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:`rgb(${a.color.join(",")})`}}),(0,t.jsxs)("span",{className:"text-slate-300",children:[a.id,": ",a.entropy.toFixed(1)," nats"]})]},a.id))]})]})]})}function ra(a,b){(null==b||b>a.length)&&(b=a.length);for(var c=0,d=Array(b);c<b;c++)d[c]=a[c];return d}function rb(a,b){if(!(a instanceof b))throw TypeError("Cannot call a class as a function")}function rc(a,b,c){return b&&function(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,rh(d.key),d)}}(a.prototype,b),Object.defineProperty(a,"prototype",{writable:!1}),a}function rd(a,b){var c="undefined"!=typeof Symbol&&a[Symbol.iterator]||a["@@iterator"];if(!c){if(Array.isArray(a)||(c=rj(a))||b){c&&(a=c);var d=0,e=function(){};return{s:e,n:function(){return d>=a.length?{done:!0}:{done:!1,value:a[d++]}},e:function(a){throw a},f:e}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var f,g=!0,h=!1;return{s:function(){c=c.call(a)},n:function(){var a=c.next();return g=a.done,a},e:function(a){h=!0,f=a},f:function(){try{g||null==c.return||c.return()}finally{if(h)throw f}}}}function re(a,b,c){return(b=rh(b))in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function rf(a,b){return function(a){if(Array.isArray(a))return a}(a)||function(a,b){var c=null==a?null:"undefined"!=typeof Symbol&&a[Symbol.iterator]||a["@@iterator"];if(null!=c){var d,e,f,g,h=[],i=!0,j=!1;try{if(f=(c=c.call(a)).next,0===b){if(Object(c)!==c)return;i=!1}else for(;!(i=(d=f.call(c)).done)&&(h.push(d.value),h.length!==b);i=!0);}catch(a){j=!0,e=a}finally{try{if(!i&&null!=c.return&&(g=c.return(),Object(g)!==g))return}finally{if(j)throw e}}return h}}(a,b)||rj(a,b)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function rg(a){return function(a){if(Array.isArray(a))return ra(a)}(a)||function(a){if("undefined"!=typeof Symbol&&null!=a[Symbol.iterator]||null!=a["@@iterator"])return Array.from(a)}(a)||rj(a)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function rh(a){var b=function(a,b){if("object"!=typeof a||!a)return a;var c=a[Symbol.toPrimitive];if(void 0!==c){var d=c.call(a,b);if("object"!=typeof d)return d;throw TypeError("@@toPrimitive must return a primitive value.")}return String(a)}(a,"string");return"symbol"==typeof b?b:b+""}function ri(a){return(ri="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a})(a)}function rj(a,b){if(a){if("string"==typeof a)return ra(a,b);var c=({}).toString.call(a).slice(8,-1);return"Object"===c&&a.constructor&&(c=a.constructor.name),"Map"===c||"Set"===c?Array.from(a):"Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c)?ra(a,b):void 0}}q8.layerName="ArcLayer",q8.defaultProps=q7;var rk=ri(""),rl=ri({}),rm=ri(function(){}),rn="undefined"==typeof HTMLElement?"undefined":ri(HTMLElement),ro=function(a){return a&&a.instanceString&&rq(a.instanceString)?a.instanceString():null},rp=function(a){return null!=a&&ri(a)==rk},rq=function(a){return null!=a&&ri(a)===rm},rr=function(a){return!rv(a)&&(Array.isArray?Array.isArray(a):null!=a&&a instanceof Array)},rs=function(a){return null!=a&&ri(a)===rl&&!rr(a)&&a.constructor===Object},rt=function(a){return null!=a&&ri(a)===ri(1)&&!isNaN(a)},ru=function(a){if("undefined"!==rn)return null!=a&&a instanceof HTMLElement},rv=function(a){return rw(a)||rx(a)},rw=function(a){return"collection"===ro(a)&&a._private.single},rx=function(a){return"collection"===ro(a)&&!a._private.single},ry=function(a){return"core"===ro(a)},rz=function(a){return"stylesheet"===ro(a)},rA=function(a){return null==a||!!(""===a||a.match(/^\s+$/))},rB=function(a){return null!=a&&ri(a)===rl&&rq(a.then)},rC=function(a,b){b||(b=function(){if(1==arguments.length)return arguments[0];if(0==arguments.length)return"undefined";for(var a=[],b=0;b<arguments.length;b++)a.push(arguments[b]);return a.join("$")});var c=function(){var d,e=arguments,f=b.apply(this,e),g=c.cache;return(d=g[f])||(d=g[f]=a.apply(this,e)),d};return c.cache={},c},rD=rC(function(a){return a.replace(/([A-Z])/g,function(a){return"-"+a.toLowerCase()})}),rE=rC(function(a){return a.replace(/(-\w)/g,function(a){return a[1].toUpperCase()})}),rF=rC(function(a,b){return a+b[0].toUpperCase()+b.substring(1)},function(a,b){return a+"$"+b}),rG=function(a){return rA(a)?a:a.charAt(0).toUpperCase()+a.substring(1)},rH=function(a,b){return a.slice(-1*b.length)===b},rI="(?:[-+]?(?:(?:\\d+|\\d*\\.\\d+)(?:[Ee][+-]?\\d+)?))",rJ="rgb[a]?\\(("+rI+"[%]?)\\s*,\\s*("+rI+"[%]?)\\s*,\\s*("+rI+"[%]?)(?:\\s*,\\s*("+rI+"))?\\)",rK="rgb[a]?\\((?:"+rI+"[%]?)\\s*,\\s*(?:"+rI+"[%]?)\\s*,\\s*(?:"+rI+"[%]?)(?:\\s*,\\s*(?:"+rI+"))?\\)",rL="hsl[a]?\\(("+rI+")\\s*,\\s*("+rI+"[%])\\s*,\\s*("+rI+"[%])(?:\\s*,\\s*("+rI+"))?\\)",rM="hsl[a]?\\((?:"+rI+")\\s*,\\s*(?:"+rI+"[%])\\s*,\\s*(?:"+rI+"[%])(?:\\s*,\\s*(?:"+rI+"))?\\)",rN=function(a,b){return a<b?-1:+(a>b)},rO=null!=Object.assign?Object.assign.bind(Object):function(a){for(var b=arguments,c=1;c<b.length;c++){var d=b[c];if(null!=d)for(var e=Object.keys(d),f=0;f<e.length;f++){var g=e[f];a[g]=d[g]}}return a},rP=function(a){if((4===a.length||7===a.length)&&"#"===a[0]){var b,c,d;return 4===a.length?(b=parseInt(a[1]+a[1],16),c=parseInt(a[2]+a[2],16),d=parseInt(a[3]+a[3],16)):(b=parseInt(a[1]+a[2],16),c=parseInt(a[3]+a[4],16),d=parseInt(a[5]+a[6],16)),[b,c,d]}},rQ=function(a){function b(a,b,c){return(c<0&&(c+=1),c>1&&(c-=1),c<1/6)?a+(b-a)*6*c:c<.5?b:c<2/3?a+(b-a)*(2/3-c)*6:a}var c,d,e,f,g,h,i,j,k=RegExp("^"+rL+"$").exec(a);if(k){if((d=parseInt(k[1]))<0?d=(360- -1*d%360)%360:d>360&&(d%=360),d/=360,(e=parseFloat(k[2]))<0||e>100||(e/=100,(f=parseFloat(k[3]))<0||f>100)||(f/=100,void 0!==(g=k[4])&&((g=parseFloat(g))<0||g>1)))return;if(0===e)h=i=j=Math.round(255*f);else{var l=f<.5?f*(1+e):f+e-f*e,n=2*f-l;h=Math.round(255*b(n,l,d+1/3)),i=Math.round(255*b(n,l,d)),j=Math.round(255*b(n,l,d-1/3))}c=[h,i,j,g]}return c},rR=function(a){var b,c=RegExp("^"+rJ+"$").exec(a);if(c){b=[];for(var d=[],e=1;e<=3;e++){var f=c[e];if("%"===f[f.length-1]&&(d[e]=!0),f=parseFloat(f),d[e]&&(f=f/100*255),f<0||f>255)return;b.push(Math.floor(f))}var g=d[1]||d[2]||d[3],h=d[1]&&d[2]&&d[3];if(g&&!h)return;var i=c[4];if(void 0!==i){if((i=parseFloat(i))<0||i>1)return;b.push(i)}}return b},rS=function(a){return(rr(a)?a:null)||rT[a.toLowerCase()]||rP(a)||rR(a)||rQ(a)},rT={transparent:[0,0,0,0],aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],grey:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},rU=function(a){for(var b=a.map,c=a.keys,d=c.length,e=0;e<d;e++){var f=c[e];if(rs(f))throw Error("Tried to set map with object key");e<c.length-1?(null==b[f]&&(b[f]={}),b=b[f]):b[f]=a.value}},rV=function(a){for(var b=a.map,c=a.keys,d=c.length,e=0;e<d;e++){var f=c[e];if(rs(f))throw Error("Tried to get map with object key");if(null==(b=b[f]))break}return b},rW="undefined"!=typeof globalThis?globalThis:a.g;function rX(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}function rY(){return x3?x2:(x3=1,x2=function(a){var b=typeof a;return null!=a&&("object"==b||"function"==b)})}function rZ(){if(x7)return x6;x7=1;var a=x5?x4:(x5=1,x4="object"==typeof rW&&rW&&rW.Object===Object&&rW),b="object"==typeof self&&self&&self.Object===Object&&self;return x6=a||b||Function("return this")()}function r$(){return yf?ye:(yf=1,ye=rZ().Symbol)}function r_(){if(yl)return yk;yl=1;var a=r$(),b=function(){if(yh)return yg;yh=1;var a=r$(),b=Object.prototype,c=b.hasOwnProperty,d=b.toString,e=a?a.toStringTag:void 0;return yg=function(a){var b=c.call(a,e),f=a[e];try{a[e]=void 0;var g=!0}catch(a){}var h=d.call(a);return g&&(b?a[e]=f:delete a[e]),h}}(),c=function(){if(yj)return yi;yj=1;var a=Object.prototype.toString;return yi=function(b){return a.call(b)}}(),d=a?a.toStringTag:void 0;return yk=function(a){return null==a?void 0===a?"[object Undefined]":"[object Null]":d&&d in Object(a)?b(a):c(a)}}function r0(){if(yp)return yo;yp=1;var a=r_(),b=yn?ym:(yn=1,ym=function(a){return null!=a&&"object"==typeof a});return yo=function(c){return"symbol"==typeof c||b(c)&&"[object Symbol]"==a(c)}}var r1=rX(function(){if(yt)return ys;yt=1;var a=rY(),b=function(){if(x9)return x8;x9=1;var a=rZ();return x8=function(){return a.Date.now()}}(),c=function(){if(yr)return yq;yr=1;var a=function(){if(yd)return yc;yd=1;var a=function(){if(yb)return ya;yb=1;var a=/\s/;return ya=function(b){for(var c=b.length;c--&&a.test(b.charAt(c)););return c}}(),b=/^\s+/;return yc=function(c){return c?c.slice(0,a(c)+1).replace(b,""):c}}(),b=rY(),c=r0(),d=0/0,e=/^[-+]0x[0-9a-f]+$/i,f=/^0b[01]+$/i,g=/^0o[0-7]+$/i,h=parseInt;return yq=function(i){if("number"==typeof i)return i;if(c(i))return d;if(b(i)){var j="function"==typeof i.valueOf?i.valueOf():i;i=b(j)?j+"":j}if("string"!=typeof i)return 0===i?i:+i;i=a(i);var k=f.test(i);return k||g.test(i)?h(i.slice(2),k?2:8):e.test(i)?d:+i}}(),d=Math.max,e=Math.min;return ys=function(f,g,h){var i,j,k,l,n,o,p=0,q=!1,r=!1,s=!0;if("function"!=typeof f)throw TypeError("Expected a function");function t(a){var b=i,c=j;return i=j=void 0,p=a,l=f.apply(c,b)}function u(a){var b=a-o,c=a-p;return void 0===o||b>=g||b<0||r&&c>=k}function v(){var a,c,d,f=b();if(u(f))return w(f);n=setTimeout(v,(a=f-o,c=f-p,d=g-a,r?e(d,k-c):d))}function w(a){return(n=void 0,s&&i)?t(a):(i=j=void 0,l)}function x(){var a,c=b(),d=u(c);if(i=arguments,j=this,o=c,d){if(void 0===n)return p=a=o,n=setTimeout(v,g),q?t(a):l;if(r)return clearTimeout(n),n=setTimeout(v,g),t(o)}return void 0===n&&(n=setTimeout(v,g)),l}return g=c(g)||0,a(h)&&(q=!!h.leading,k=(r="maxWait"in h)?d(c(h.maxWait)||0,g):k,s="trailing"in h?!!h.trailing:s),x.cancel=function(){void 0!==n&&clearTimeout(n),p=0,i=o=j=n=void 0},x.flush=function(){return void 0===n?l:w(b())},x}}()),r2=function(){return Date.now()},r3=function(a){a&&setTimeout(function(){a(r2())},1e3/60)},r4=function(a){return r3(a)},r5=function(a){for(var b,c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9261,d=c;!(b=a.next()).done;)d=65599*d+b.value|0;return d},r6=function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9261;return 65599*b+a|0},r7=function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5381;return(b<<5)+b+a|0},r8=function(a){return 2097152*a[0]+a[1]},r9=function(a,b){return[r6(a[0],b[0]),r7(a[1],b[1])]},sa=function(a,b){var c={value:0,done:!1},d=0,e=a.length;return r5({next:function(){return d<e?c.value=a[d++]:c.done=!0,c}},b)},sb=function(a,b){var c={value:0,done:!1},d=0,e=a.length;return r5({next:function(){return d<e?c.value=a.charCodeAt(d++):c.done=!0,c}},b)},sc=function(){return sd(arguments)},sd=function(a){for(var b,c=0;c<a.length;c++){var d=a[c];b=0===c?sb(d):sb(d,b)}return b},se=!0,sf=null!=console.warn,sg=null!=console.trace,sh=Number.MAX_SAFE_INTEGER||0x1fffffffffffff,si=function(){return!0},sj=function(){return!1},sk=function(){return 0},sl=function(){},sm=function(a){throw Error(a)},sn=function(a){if(void 0===a)return se;se=!!a},so=function(a){sn()&&(sf?console.warn(a):(console.log(a),sg&&console.trace()))},sp=function(a){return null==a?a:rr(a)?a.slice():rs(a)?rO({},a):a},sq=function(a,b){for(b=a="";a++<36;b+=51*a&52?(15^a?8^Math.random()*(20^a?16:4):4).toString(16):"-");return b},sr={},ss=function(){return sr},st=function(a){var b=Object.keys(a);return function(c){for(var d={},e=0;e<b.length;e++){var f=b[e],g=null==c?void 0:c[f];d[f]=void 0===g?a[f]:g}return d}},su=function(a,b,c){for(var d=a.length-1;d>=0;d--)a[d]===b&&a.splice(d,1)},sv=function(a){a.splice(0,a.length)},sw=function(a,b){for(var c=0;c<b.length;c++){var d=b[c];a.push(d)}},sx=function(a,b,c){return c&&(b=rF(c,b)),a[b]},sy=function(a,b,c,d){c&&(b=rF(c,b)),a[b]=d},sz=rc(function a(){rb(this,a),this._obj={}},[{key:"set",value:function(a,b){return this._obj[a]=b,this}},{key:"delete",value:function(a){return this._obj[a]=void 0,this}},{key:"clear",value:function(){this._obj={}}},{key:"has",value:function(a){return void 0!==this._obj[a]}},{key:"get",value:function(a){return this._obj[a]}}]),sA="undefined"!=typeof Map?Map:sz,sB=rc(function a(b){if(rb(this,a),this._obj=Object.create(null),this.size=0,null!=b){var c;c=null!=b.instanceString&&b.instanceString()===this.instanceString()?b.toArray():b;for(var d=0;d<c.length;d++)this.add(c[d])}},[{key:"instanceString",value:function(){return"set"}},{key:"add",value:function(a){var b=this._obj;1!==b[a]&&(b[a]=1,this.size++)}},{key:"delete",value:function(a){var b=this._obj;1===b[a]&&(b[a]=0,this.size--)}},{key:"clear",value:function(){this._obj=Object.create(null)}},{key:"has",value:function(a){return 1===this._obj[a]}},{key:"toArray",value:function(){var a=this;return Object.keys(this._obj).filter(function(b){return a.has(b)})}},{key:"forEach",value:function(a,b){return this.toArray().forEach(a,b)}}]),sC=("undefined"==typeof Set?"undefined":ri(Set))!=="undefined"?Set:sB,sD=function(a,b){var c=!(arguments.length>2)||void 0===arguments[2]||arguments[2];if(void 0===a||void 0===b||!ry(a))return void sm("An element must have a core reference and parameters set");var d=b.group;if(null==d&&(d=b.data&&null!=b.data.source&&null!=b.data.target?"edges":"nodes"),"nodes"!==d&&"edges"!==d)return void sm("An element must be of type `nodes` or `edges`; you specified `"+d+"`");this.length=1,this[0]=this;var e=this._private={cy:a,single:!0,data:b.data||{},position:b.position||{x:0,y:0},autoWidth:void 0,autoHeight:void 0,autoPadding:void 0,compoundBoundsClean:!1,listeners:[],group:d,style:{},rstyle:{},styleCxts:[],styleKeys:{},removed:!0,selected:!!b.selected,selectable:void 0===b.selectable||!!b.selectable,locked:!!b.locked,grabbed:!1,grabbable:void 0===b.grabbable||!!b.grabbable,pannable:void 0===b.pannable?"edges"===d:!!b.pannable,active:!1,classes:new sC,animation:{current:[],queue:[]},rscratch:{},scratch:b.scratch||{},edges:[],children:[],parent:b.parent&&b.parent.isNode()?b.parent:null,traversalCache:{},backgrounding:!1,bbCache:null,bbCacheShift:{x:0,y:0},bodyBounds:null,overlayBounds:null,labelBounds:{all:null,source:null,target:null,main:null},arrowBounds:{source:null,target:null,"mid-source":null,"mid-target":null}};if(null==e.position.x&&(e.position.x=0),null==e.position.y&&(e.position.y=0),b.renderedPosition){var f=b.renderedPosition,g=a.pan(),h=a.zoom();e.position={x:(f.x-g.x)/h,y:(f.y-g.y)/h}}var i=[];rr(b.classes)?i=b.classes:rp(b.classes)&&(i=b.classes.split(/\s+/));for(var j=0,k=i.length;j<k;j++){var l=i[j];l&&""!==l&&e.classes.add(l)}this.createEmitter(),(void 0===c||c)&&this.restore();var n=b.style||b.css;n&&(so("Setting a `style` bypass at element creation should be done only when absolutely necessary.  Try to use the stylesheet instead."),this.style(n))},sE=function(a){return a={bfs:a.bfs||!a.dfs,dfs:a.dfs||!a.bfs},function(b,c,d){rs(b)&&!rv(b)&&(b=(e=b).roots||e.root,c=e.visit,d=e.directed),d=2!=arguments.length||rq(c)?d:c,c=rq(c)?c:function(){};for(var e,f,g,h=this._private.cy,i=b=rp(b)?this.filter(b):b,j=[],k=[],l={},n={},o={},p=0,q=this.byGroup(),r=q.nodes,s=q.edges,t=0;t<i.length;t++){var u=i[t],v=u.id();u.isNode()&&(j.unshift(u),a.bfs&&(o[v]=!0,k.push(u)),n[v]=0)}for(;0!==j.length&&(0===(g=function(){var b,e=a.bfs?j.shift():j.pop(),g=e.id();if(a.dfs){if(o[g])return 0;o[g]=!0,k.push(e)}var h=n[g],i=l[g],q=null!=i?i.source():null,t=null!=i?i.target():null,u=null==i?void 0:e.same(q)?t[0]:q[0];if(!0===(b=c(e,i,u,p++,h)))return f=e,1;if(!1===b)return 1;for(var v=e.connectedEdges().filter(function(a){return(!d||a.source().same(e))&&s.has(a)}),w=0;w<v.length;w++){var x=v[w],y=x.connectedNodes().filter(function(a){return!a.same(e)&&r.has(a)}),z=y.id();0===y.length||o[z]||(y=y[0],j.push(y),a.bfs&&(o[z]=!0,k.push(y)),l[z]=x,n[z]=n[g]+1)}}())||1!==g););for(var w=h.collection(),x=0;x<k.length;x++){var y=k[x],z=l[y.id()];null!=z&&w.push(z),w.push(y)}return{path:h.collection(w),found:h.collection(f)}}},sF={breadthFirstSearch:sE({bfs:!0}),depthFirstSearch:sE({dfs:!0})};sF.bfs=sF.breadthFirstSearch,sF.dfs=sF.depthFirstSearch;var sG={exports:{}},sH=sG.exports,sI=rX(yw?yv:(yw=1,yv=function(){return yu?sG.exports:(yu=1,(function(){var a,b,c,d,e,f,g,h,i,j,k,l,n,o,p;c=Math.floor,j=Math.min,b=function(a,b){return a<b?-1:+(a>b)},i=function(a,d,e,f,g){var h;if(null==e&&(e=0),null==g&&(g=b),e<0)throw Error("lo must be non-negative");for(null==f&&(f=a.length);e<f;)0>g(d,a[h=c((e+f)/2)])?f=h:e=h+1;return[].splice.apply(a,[e,e-e].concat(d)),d},f=function(a,c,d){return null==d&&(d=b),a.push(c),o(a,0,a.length-1,d)},e=function(a,c){var d,e;return null==c&&(c=b),d=a.pop(),a.length?(e=a[0],a[0]=d,p(a,0,c)):e=d,e},h=function(a,c,d){var e;return null==d&&(d=b),e=a[0],a[0]=c,p(a,0,d),e},g=function(a,c,d){var e;return null==d&&(d=b),a.length&&0>d(a[0],c)&&(c=(e=[a[0],c])[0],a[0]=e[1],p(a,0,d)),c},d=function(a,d){var e,f,g,h,i,j;for(null==d&&(d=b),h=(function(){j=[];for(var b=0,d=c(a.length/2);0<=d?b<d:b>d;0<=d?b++:b--)j.push(b);return j}).apply(this).reverse(),i=[],f=0,g=h.length;f<g;f++)e=h[f],i.push(p(a,e,d));return i},n=function(a,c,d){var e;if(null==d&&(d=b),-1!==(e=a.indexOf(c)))return o(a,0,e,d),p(a,e,d)},k=function(a,c,e){var f,h,i,j;if(null==e&&(e=b),!(f=a.slice(0,c)).length)return f;for(d(f,e),h=0,i=(j=a.slice(c)).length;h<i;h++)g(f,j[h],e);return f.sort(e).reverse()},l=function(a,c,f){var g,h,k,l,n,o,p,q,r;if(null==f&&(f=b),10*c<=a.length){if(!(k=a.slice(0,c).sort(f)).length)return k;for(l=0,h=k[k.length-1],o=(p=a.slice(c)).length;l<o;l++)0>f(g=p[l],h)&&(i(k,g,0,null,f),k.pop(),h=k[k.length-1]);return k}for(d(a,f),r=[],n=0,q=j(c,a.length);0<=q?n<q:n>q;0<=q?++n:--n)r.push(e(a,f));return r},o=function(a,c,d,e){var f,g,h;for(null==e&&(e=b),f=a[d];d>c;){if(0>e(f,g=a[h=d-1>>1])){a[d]=g,d=h;continue}break}return a[d]=f},p=function(a,c,d){var e,f,g,h,i;for(null==d&&(d=b),f=a.length,i=c,g=a[c],e=2*c+1;e<f;)(h=e+1)<f&&!(0>d(a[e],a[h]))&&(e=h),a[c]=a[e],e=2*(c=e)+1;return a[c]=g,o(a,i,c,d)},a=function(){function a(a){this.cmp=null!=a?a:b,this.nodes=[]}return a.push=f,a.pop=e,a.replace=h,a.pushpop=g,a.heapify=d,a.updateItem=n,a.nlargest=k,a.nsmallest=l,a.prototype.push=function(a){return f(this.nodes,a,this.cmp)},a.prototype.pop=function(){return e(this.nodes,this.cmp)},a.prototype.peek=function(){return this.nodes[0]},a.prototype.contains=function(a){return -1!==this.nodes.indexOf(a)},a.prototype.replace=function(a){return h(this.nodes,a,this.cmp)},a.prototype.pushpop=function(a){return g(this.nodes,a,this.cmp)},a.prototype.heapify=function(){return d(this.nodes,this.cmp)},a.prototype.updateItem=function(a){return n(this.nodes,a,this.cmp)},a.prototype.clear=function(){return this.nodes=[]},a.prototype.empty=function(){return 0===this.nodes.length},a.prototype.size=function(){return this.nodes.length},a.prototype.clone=function(){var b;return(b=new a).nodes=this.nodes.slice(0),b},a.prototype.toArray=function(){return this.nodes.slice(0)},a.prototype.insert=a.prototype.push,a.prototype.top=a.prototype.peek,a.prototype.front=a.prototype.peek,a.prototype.has=a.prototype.contains,a.prototype.copy=a.prototype.clone,a}(),sG.exports=a}).call(sH),sG.exports)}())),sJ=st({root:null,weight:function(a){return 1},directed:!1}),sK=st({root:null,goal:null,weight:function(a){return 1},heuristic:function(a){return 0},directed:!1}),sL=st({weight:function(a){return 1},directed:!1}),sM=st({weight:function(a){return 1},directed:!1,root:null}),sN=Math.sqrt(2),sO=function(a,b,c){0===c.length&&sm("Karger-Stein must be run on a connected (sub)graph");for(var d=c[a],e=d[1],f=d[2],g=b[e],h=b[f],i=c.length-1;i>=0;i--){var j=c[i],k=j[1],l=j[2];(b[k]===g&&b[l]===h||b[k]===h&&b[l]===g)&&c.splice(i,1)}for(var n=0;n<c.length;n++){var o=c[n];o[1]===h?(c[n]=o.slice(),c[n][1]=g):o[2]===h&&(c[n]=o.slice(),c[n][2]=g)}for(var p=0;p<b.length;p++)b[p]===h&&(b[p]=g);return c},sP=function(a,b,c,d){for(;c>d;)b=sO(Math.floor(Math.random()*b.length),a,b),c--;return b},sQ=function(a,b,c){return{x:a.x*b+c.x,y:a.y*b+c.y}},sR=function(a,b,c){return{x:(a.x-c.x)/b,y:(a.y-c.y)/b}},sS=function(a){return{x:a[0],y:a[1]}},sT=function(a){for(var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.length,d=1/0,e=b;e<c;e++){var f=a[e];isFinite(f)&&(d=Math.min(f,d))}return d},sU=function(a){for(var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.length,d=-1/0,e=b;e<c;e++){var f=a[e];isFinite(f)&&(d=Math.max(f,d))}return d},sV=function(a){for(var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.length,d=0,e=0,f=b;f<c;f++){var g=a[f];isFinite(g)&&(d+=g,e++)}return d/e},sW=function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:a.length,d=!(arguments.length>3)||void 0===arguments[3]||arguments[3],e=!(arguments.length>4)||void 0===arguments[4]||arguments[4],f=!(arguments.length>5)||void 0===arguments[5]||arguments[5];d?a=a.slice(b,c):(c<a.length&&a.splice(c,a.length-c),b>0&&a.splice(0,b));for(var g=0,h=a.length-1;h>=0;h--){var i=a[h];f?!isFinite(i)&&(a[h]=-1/0,g++):a.splice(h,1)}e&&a.sort(function(a,b){return a-b});var j=a.length,k=Math.floor(j/2);return j%2!=0?a[k+1+g]:(a[k-1+g]+a[k+g])/2},sX=function(a,b){return Math.atan2(b,a)-Math.PI/2},sY=Math.log2||function(a){return Math.log(a)/Math.log(2)},sZ=function(a){return a>0?1:a<0?-1:0},s$=function(a,b){return Math.sqrt(s_(a,b))},s_=function(a,b){var c=b.x-a.x,d=b.y-a.y;return c*c+d*d},s0=function(a){for(var b=a.length,c=0,d=0;d<b;d++)c+=a[d];for(var e=0;e<b;e++)a[e]=a[e]/c;return a},s1=function(a,b,c,d){return(1-d)*(1-d)*a+2*(1-d)*d*b+d*d*c},s2=function(a,b,c,d){return{x:s1(a.x,b.x,c.x,d),y:s1(a.y,b.y,c.y,d)}},s3=function(a,b,c,d){var e={x:b.x-a.x,y:b.y-a.y},f=s$(a,b),g={x:e.x/f,y:e.y/f};return c=null==c?0:c,d=null!=d?d:c*f,{x:a.x+g.x*d,y:a.y+g.y*d}},s4=function(a,b,c){return Math.max(a,Math.min(c,b))},s5=function(a){if(null==a)return{x1:1/0,y1:1/0,x2:-1/0,y2:-1/0,w:0,h:0};if(null!=a.x1&&null!=a.y1){if(null!=a.x2&&null!=a.y2&&a.x2>=a.x1&&a.y2>=a.y1)return{x1:a.x1,y1:a.y1,x2:a.x2,y2:a.y2,w:a.x2-a.x1,h:a.y2-a.y1};else if(null!=a.w&&null!=a.h&&a.w>=0&&a.h>=0)return{x1:a.x1,y1:a.y1,x2:a.x1+a.w,y2:a.y1+a.h,w:a.w,h:a.h}}},s6=function(a){a.x1=1/0,a.y1=1/0,a.x2=-1/0,a.y2=-1/0,a.w=0,a.h=0},s7=function(a,b){a.x1=Math.min(a.x1,b.x1),a.x2=Math.max(a.x2,b.x2),a.w=a.x2-a.x1,a.y1=Math.min(a.y1,b.y1),a.y2=Math.max(a.y2,b.y2),a.h=a.y2-a.y1},s8=function(a,b,c){a.x1=Math.min(a.x1,b),a.x2=Math.max(a.x2,b),a.w=a.x2-a.x1,a.y1=Math.min(a.y1,c),a.y2=Math.max(a.y2,c),a.h=a.y2-a.y1},s9=function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return a.x1-=b,a.x2+=b,a.y1-=b,a.y2+=b,a.w=a.x2-a.x1,a.h=a.y2-a.y1,a},ta=function(a){var b,c,d,e,f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0];if(1===f.length)b=c=d=e=f[0];else if(2===f.length)b=d=f[0],e=c=f[1];else if(4===f.length){var g=rf(f,4);b=g[0],c=g[1],d=g[2],e=g[3]}return a.x1-=e,a.x2+=c,a.y1-=b,a.y2+=d,a.w=a.x2-a.x1,a.h=a.y2-a.y1,a},tb=function(a,b){a.x1=b.x1,a.y1=b.y1,a.x2=b.x2,a.y2=b.y2,a.w=a.x2-a.x1,a.h=a.y2-a.y1},tc=function(a,b){return!(a.x1>b.x2)&&!(b.x1>a.x2)&&!(a.x2<b.x1)&&!(b.x2<a.x1)&&!(a.y2<b.y1)&&!(b.y2<a.y1)&&!(a.y1>b.y2)&&!(b.y1>a.y2)&&!0},td=function(a,b,c){return a.x1<=b&&b<=a.x2&&a.y1<=c&&c<=a.y2},te=function(a,b){return td(a,b.x,b.y)},tf=function(a,b){return td(a,b.x1,b.y1)&&td(a,b.x2,b.y2)},tg=null!=(yx=Math.hypot)?yx:function(a,b){return Math.sqrt(a*a+b*b)},th=function(a,b,c,d,e,f,g){var h,i,j=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"auto",k="auto"===j?tF(e,f):j,l=e/2,n=f/2,o=(k=Math.min(k,l,n))!==l,p=k!==n;if(o){var q=c-l+k-g,r=d-n-g,s=c+l-k+g;if((h=tx(a,b,c,d,q,r,s,r,!1)).length>0)return h}if(p){var t=c+l+g,u=d-n+k-g,v=d+n-k+g;if((h=tx(a,b,c,d,t,u,t,v,!1)).length>0)return h}if(o){var w=c-l+k-g,x=d+n+g,y=c+l-k+g;if((h=tx(a,b,c,d,w,x,y,x,!1)).length>0)return h}if(p){var z=c-l-g,A=d-n+k-g,B=d+n-k+g;if((h=tx(a,b,c,d,z,A,z,B,!1)).length>0)return h}var C=c-l+k,D=d-n+k;if((i=tv(a,b,c,d,C,D,k+g)).length>0&&i[0]<=C&&i[1]<=D)return[i[0],i[1]];var E=c+l-k,F=d-n+k;if((i=tv(a,b,c,d,E,F,k+g)).length>0&&i[0]>=E&&i[1]<=F)return[i[0],i[1]];var G=c+l-k,H=d+n-k;if((i=tv(a,b,c,d,G,H,k+g)).length>0&&i[0]>=G&&i[1]>=H)return[i[0],i[1]];var I=c-l+k,J=d+n-k;return(i=tv(a,b,c,d,I,J,k+g)).length>0&&i[0]<=I&&i[1]>=J?[i[0],i[1]]:[]},ti=function(a,b,c,d,e,f,g){var h=Math.min(c,e),i=Math.max(c,e),j=Math.min(d,f),k=Math.max(d,f);return h-g<=a&&a<=i+g&&j-g<=b&&b<=k+g},tj=function(a,b,c,d,e,f,g,h,i){var j={x1:Math.min(c,g,e)-i,x2:Math.max(c,g,e)+i,y1:Math.min(d,h,f)-i,y2:Math.max(d,h,f)+i};return!(a<j.x1)&&!(a>j.x2)&&!(b<j.y1)&&!(b>j.y2)},tk=function(a,b,c,d){var e=b*b-4*a*(c-=d);if(e<0)return[];var f=Math.sqrt(e),g=2*a;return[(-b+f)/g,(-b-f)/g]},tl=function(a,b,c,d,e){var f,g,h,i,j,k,l,n;if(0===a&&(a=1e-5),b/=a,c/=a,d/=a,f=(g=(3*c-b*b)/9)*g*g+(h=(-(27*d)+b*(9*c-b*b*2))/54)*h,e[1]=0,l=b/3,f>0){j=(j=h+Math.sqrt(f))<0?-Math.pow(-j,1/3):Math.pow(j,1/3),k=(k=h-Math.sqrt(f))<0?-Math.pow(-k,1/3):Math.pow(k,1/3),e[0]=-l+j+k,l+=(j+k)/2,e[4]=e[2]=-l,l=Math.sqrt(3)*(-k+j)/2,e[3]=l,e[5]=-l;return}if(e[5]=e[3]=0,0===f){n=h<0?-Math.pow(-h,1/3):Math.pow(h,1/3),e[0]=-l+2*n,e[4]=e[2]=-(n+l);return}i=Math.acos(h/Math.sqrt(i=(g=-g)*g*g)),n=2*Math.sqrt(g),e[0]=-l+n*Math.cos(i/3),e[2]=-l+n*Math.cos((i+2*Math.PI)/3),e[4]=-l+n*Math.cos((i+4*Math.PI)/3)},tm=function(a,b,c,d,e,f,g,h){var i,j=[];tl(c*c-4*c*e+2*c*g+4*e*e-4*e*g+g*g+d*d-4*d*f+2*d*h+4*f*f-4*f*h+h*h,9*c*e-3*c*c-3*c*g-6*e*e+3*e*g+9*d*f-3*d*d-3*d*h-6*f*f+3*f*h,3*c*c-6*c*e+c*g-c*a+2*e*e+2*e*a-g*a+3*d*d-6*d*f+d*h-d*b+2*f*f+2*f*b-h*b,c*e-c*c+c*a-e*a+d*f-d*d+d*b-f*b,j);for(var k=[],l=0;l<6;l+=2)1e-7>Math.abs(j[l+1])&&j[l]>=0&&j[l]<=1&&k.push(j[l]);k.push(1),k.push(0);for(var n=-1,o=0;o<k.length;o++)i=Math.pow(Math.pow(1-k[o],2)*c+2*(1-k[o])*k[o]*e+k[o]*k[o]*g-a,2)+Math.pow(Math.pow(1-k[o],2)*d+2*(1-k[o])*k[o]*f+k[o]*k[o]*h-b,2),n>=0?i<n&&(n=i):n=i;return n},tn=function(a,b,c,d,e,f){var g=[a-c,b-d],h=[e-c,f-d],i=h[0]*h[0]+h[1]*h[1],j=g[0]*g[0]+g[1]*g[1],k=g[0]*h[0]+g[1]*h[1],l=k*k/i;return k<0?j:l>i?(a-e)*(a-e)+(b-f)*(b-f):j-l},to=function(a,b,c){for(var d,e,f,g,h=0,i=0;i<c.length/2;i++)if(d=c[2*i],e=c[2*i+1],i+1<c.length/2?(f=c[(i+1)*2],g=c[(i+1)*2+1]):(f=c[(i+1-c.length/2)*2],g=c[(i+1-c.length/2)*2+1]),d==a&&f==a);else{if((!(d>=a)||!(a>=f))&&(!(d<=a)||!(a<=f)))continue;(a-d)/(f-d)*(g-e)+e>b&&h++}return h%2!=0},tp=function(a,b,c,d,e,f,g,h,i){var j,k=Array(c.length);null!=h[0]?(j=Math.atan(h[1]/h[0]),h[0]<0?j+=Math.PI/2:j=-j-Math.PI/2):j=h;for(var l=Math.cos(-j),n=Math.sin(-j),o=0;o<k.length/2;o++)k[2*o]=f/2*(c[2*o]*l-c[2*o+1]*n),k[2*o+1]=g/2*(c[2*o+1]*l+c[2*o]*n),k[2*o]+=d,k[2*o+1]+=e;return to(a,b,i>0?tr(ts(k,-i)):k)},tq=function(a,b,c,d,e,f,g,h){for(var i=Array(2*c.length),j=0;j<h.length;j++){var k=h[j];if(i[4*j+0]=k.startX,i[4*j+1]=k.startY,i[4*j+2]=k.stopX,i[4*j+3]=k.stopY,Math.pow(k.cx-a,2)+Math.pow(k.cy-b,2)<=Math.pow(k.radius,2))return!0}return to(a,b,i)},tr=function(a){for(var b,c,d,e,f,g,h,i,j=Array(a.length/2),k=0;k<a.length/4;k++){b=a[4*k],c=a[4*k+1],d=a[4*k+2],e=a[4*k+3],k<a.length/4-1?(f=a[(k+1)*4],g=a[(k+1)*4+1],h=a[(k+1)*4+2],i=a[(k+1)*4+3]):(f=a[0],g=a[1],h=a[2],i=a[3]);var l=tx(b,c,d,e,f,g,h,i,!0);j[2*k]=l[0],j[2*k+1]=l[1]}return j},ts=function(a,b){for(var c,d,e,f,g=Array(2*a.length),h=0;h<a.length/2;h++){c=a[2*h],d=a[2*h+1],h<a.length/2-1?(e=a[(h+1)*2],f=a[(h+1)*2+1]):(e=a[0],f=a[1]);var i=f-d,j=-(e-c),k=Math.sqrt(i*i+j*j),l=i/k,n=j/k;g[4*h]=c+l*b,g[4*h+1]=d+n*b,g[4*h+2]=e+l*b,g[4*h+3]=f+n*b}return g},tt=function(a,b,c,d,e,f){var g=c-a,h=d-b,i=Math.sqrt((g/=e)*g+(h/=f)*h),j=i-1;if(j<0)return[];var k=j/i;return[(c-a)*k+a,(d-b)*k+b]},tu=function(a,b,c,d,e,f,g){return a-=e,b-=f,(a/=c/2+g)*a+(b/=d/2+g)*b<=1},tv=function(a,b,c,d,e,f,g){var h=[c-a,d-b],i=[a-e,b-f],j=h[0]*h[0]+h[1]*h[1],k=2*(i[0]*h[0]+i[1]*h[1]),l=k*k-4*j*(i[0]*i[0]+i[1]*i[1]-g*g);if(l<0)return[];var n=(-k+Math.sqrt(l))/(2*j),o=(-k-Math.sqrt(l))/(2*j),p=Math.min(n,o),q=Math.max(n,o),r=[];if(p>=0&&p<=1&&r.push(p),q>=0&&q<=1&&r.push(q),0===r.length)return[];var s=r[0]*h[0]+a,t=r[0]*h[1]+b;return r.length>1?r[0]==r[1]?[s,t]:[s,t,r[1]*h[0]+a,r[1]*h[1]+b]:[s,t]},tw=function(a,b,c){return b<=a&&a<=c||c<=a&&a<=b?a:a<=b&&b<=c||c<=b&&b<=a?b:c},tx=function(a,b,c,d,e,f,g,h,i){var j=a-e,k=c-a,l=g-e,n=b-f,o=d-b,p=h-f,q=l*n-p*j,r=k*n-o*j,s=p*k-l*o;if(0!==s){var t=q/s,u=r/s;return -.001<=t&&t<=1.001&&-.001<=u&&u<=1.001||i?[a+t*k,b+t*o]:[]}return 0!==q&&0!==r?[]:tw(a,c,g)===g?[g,h]:tw(a,c,e)===e?[e,f]:tw(e,g,c)===c?[c,d]:[]},ty=function(a,b,c,d,e){var f=[],g=d/2,h=e/2;f.push({x:b+g*a[0],y:c+h*a[1]});for(var i=1;i<a.length/2;i++)f.push({x:b+g*a[2*i],y:c+h*a[2*i+1]});return f},tz=function(a,b,c,d,e,f,g,h){var i,j,k,l,n,o,p=[],q=Array(c.length),r=!0;if(null==f&&(r=!1),r){for(var s=0;s<q.length/2;s++)q[2*s]=c[2*s]*f+d,q[2*s+1]=c[2*s+1]*g+e;j=h>0?tr(ts(q,-h)):q}else j=c;for(var t=0;t<j.length/2;t++)k=j[2*t],l=j[2*t+1],t<j.length/2-1?(n=j[(t+1)*2],o=j[(t+1)*2+1]):(n=j[0],o=j[1]),0!==(i=tx(a,b,d,e,k,l,n,o)).length&&p.push(i[0],i[1]);return p},tA=function(a,b,c,d,e,f,g,h,i){var j,k=[],l=Array(2*c.length);i.forEach(function(c,f){0===f?(l[l.length-2]=c.startX,l[l.length-1]=c.startY):(l[4*f-2]=c.startX,l[4*f-1]=c.startY),l[4*f]=c.stopX,l[4*f+1]=c.stopY,0!==(j=tv(a,b,d,e,c.cx,c.cy,c.radius)).length&&k.push(j[0],j[1])});for(var n=0;n<l.length/4;n++)0!==(j=tx(a,b,d,e,l[4*n],l[4*n+1],l[4*n+2],l[4*n+3],!1)).length&&k.push(j[0],j[1]);if(k.length>2){for(var o=[k[0],k[1]],p=Math.pow(o[0]-a,2)+Math.pow(o[1]-b,2),q=1;q<k.length/2;q++){var r=Math.pow(k[2*q]-a,2)+Math.pow(k[2*q+1]-b,2);r<=p&&(o[0]=k[2*q],o[1]=k[2*q+1],p=r)}return o}return k},tB=function(a,b,c){var d=[a[0]-b[0],a[1]-b[1]],e=Math.sqrt(d[0]*d[0]+d[1]*d[1]),f=(e-c)/e;return f<0&&(f=1e-5),[b[0]+f*d[0],b[1]+f*d[1]]},tC=function(a,b){var c=tE(a,b);return tD(c)},tD=function(a){for(var b,c,d=a.length/2,e=1/0,f=1/0,g=-1/0,h=-1/0,i=0;i<d;i++)b=a[2*i],c=a[2*i+1],e=Math.min(e,b),g=Math.max(g,b),f=Math.min(f,c),h=Math.max(h,c);for(var j=2/(g-e),k=2/(h-f),l=0;l<d;l++)b=a[2*l]=a[2*l]*j,c=a[2*l+1]=a[2*l+1]*k,e=Math.min(e,b),g=Math.max(g,b),f=Math.min(f,c),h=Math.max(h,c);if(f<-1)for(var n=0;n<d;n++)c=a[2*n+1]=a[2*n+1]+(-1-f);return a},tE=function(a,b){var c,d=1/a*2*Math.PI,e=a%2==0?Math.PI/2+d/2:Math.PI/2;e+=b;for(var f=Array(2*a),g=0;g<a;g++)c=g*d+e,f[2*g]=Math.cos(c),f[2*g+1]=Math.sin(-c);return f},tF=function(a,b){return Math.min(a/4,b/4,8)},tG=function(a,b){return Math.min(a/10,b/10,8)},tH=function(){return 8},tI=function(a,b){return{heightOffset:Math.min(15,.05*b),widthOffset:Math.min(100,.25*a),ctrlPtOffsetPct:.05}};function tJ(a,b){function c(a){for(var b=[],c=0;c<a.length;c++){var d=a[c],e=a[(c+1)%a.length],f={x:e.x-d.x,y:e.y-d.y},g={x:-f.y,y:f.x},h=Math.sqrt(g.x*g.x+g.y*g.y);b.push({x:g.x/h,y:g.y/h})}return b}function d(a,b){var c,d=1/0,e=-1/0,f=rd(a);try{for(f.s();!(c=f.n()).done;){var g=c.value,h=g.x*b.x+g.y*b.y;d=Math.min(d,h),e=Math.max(e,h)}}catch(a){f.e(a)}finally{f.f()}return{min:d,max:e}}var e,f=rd([].concat(rg(c(a)),rg(c(b))));try{for(f.s();!(e=f.n()).done;){var g=e.value,h=d(a,g),i=d(b,g);if(h.max<i.min||i.max<h.min)return!1}}catch(a){f.e(a)}finally{f.f()}return!0}var tK=st({dampingFactor:.8,precision:1e-6,iterations:200,weight:function(a){return 1}}),tL=st({root:null,weight:function(a){return 1},directed:!1,alpha:0}),tM={degreeCentralityNormalized:function(a){a=tL(a);var b=this.cy(),c=this.nodes(),d=c.length;if(a.directed){for(var e={},f={},g=0,h=0,i=0;i<d;i++){var j=c[i],k=j.id();a.root=j;var l=this.degreeCentrality(a);g<l.indegree&&(g=l.indegree),h<l.outdegree&&(h=l.outdegree),e[k]=l.indegree,f[k]=l.outdegree}return{indegree:function(a){return 0==g?0:(rp(a)&&(a=b.filter(a)),e[a.id()]/g)},outdegree:function(a){return 0===h?0:(rp(a)&&(a=b.filter(a)),f[a.id()]/h)}}}for(var n={},o=0,p=0;p<d;p++){var q=c[p];a.root=q;var r=this.degreeCentrality(a);o<r.degree&&(o=r.degree),n[q.id()]=r.degree}return{degree:function(a){return 0===o?0:(rp(a)&&(a=b.filter(a)),n[a.id()]/o)}}},degreeCentrality:function(a){a=tL(a);var b=this.cy(),c=this,d=a,e=d.root,f=d.weight,g=d.directed,h=d.alpha;if(e=b.collection(e)[0],g){for(var i=e.connectedEdges(),j=i.filter(function(a){return a.target().same(e)&&c.has(a)}),k=i.filter(function(a){return a.source().same(e)&&c.has(a)}),l=j.length,n=k.length,o=0,p=0,q=0;q<j.length;q++)o+=f(j[q]);for(var r=0;r<k.length;r++)p+=f(k[r]);return{indegree:Math.pow(l,1-h)*Math.pow(o,h),outdegree:Math.pow(n,1-h)*Math.pow(p,h)}}for(var s=e.connectedEdges().intersection(c),t=s.length,u=0,v=0;v<s.length;v++)u+=f(s[v]);return{degree:Math.pow(t,1-h)*Math.pow(u,h)}}};tM.dc=tM.degreeCentrality,tM.dcn=tM.degreeCentralityNormalised=tM.degreeCentralityNormalized;var tN=st({harmonic:!0,weight:function(){return 1},directed:!1,root:null}),tO={closenessCentralityNormalized:function(a){for(var b=tN(a),c=b.harmonic,d=b.weight,e=b.directed,f=this.cy(),g={},h=0,i=this.nodes(),j=this.floydWarshall({weight:d,directed:e}),k=0;k<i.length;k++){for(var l=0,n=i[k],o=0;o<i.length;o++)if(k!==o){var p=j.distance(n,i[o]);c?l+=1/p:l+=p}c||(l=1/l),h<l&&(h=l),g[n.id()]=l}return{closeness:function(a){return 0==h?0:g[a=rp(a)?f.filter(a)[0].id():a.id()]/h}}},closenessCentrality:function(a){var b=tN(a),c=b.root,d=b.weight,e=b.directed,f=b.harmonic;c=this.filter(c)[0];for(var g=this.dijkstra({root:c,weight:d,directed:e}),h=0,i=this.nodes(),j=0;j<i.length;j++){var k=i[j];if(!k.same(c)){var l=g.distanceTo(k);f?h+=1/l:h+=l}}return f?h:1/h}};tO.cc=tO.closenessCentrality,tO.ccn=tO.closenessCentralityNormalised=tO.closenessCentralityNormalized;var tP=st({weight:null,directed:!1}),tQ={betweennessCentrality:function(a){for(var b=tP(a),c=b.directed,d=b.weight,e=null!=d,f=this.cy(),g=this.nodes(),h={},i={},j=0,k=function(a,b){i[a]=b,b>j&&(j=b)},l=function(a){return i[a]},n=0;n<g.length;n++){var o=g[n],p=o.id();c?h[p]=o.outgoers().nodes():h[p]=o.openNeighborhood().nodes(),k(p,0)}for(var q=0;q<g.length;q++)!function(){for(var a=g[q].id(),b=[],c={},i={},j={},n=new sI(function(a,b){return j[a]-j[b]}),o=0;o<g.length;o++){var p=g[o].id();c[p]=[],i[p]=0,j[p]=1/0}for(i[a]=1,j[a]=0,n.push(a);!n.empty();){var r=n.pop();if(b.push(r),e)for(var s=0;s<h[r].length;s++){var t=h[r][s],u=f.getElementById(r),v=d(u.edgesTo(t).length>0?u.edgesTo(t)[0]:t.edgesTo(u)[0]);j[t=t.id()]>j[r]+v&&(j[t]=j[r]+v,0>n.nodes.indexOf(t)?n.push(t):n.updateItem(t),i[t]=0,c[t]=[]),j[t]==j[r]+v&&(i[t]=i[t]+i[r],c[t].push(r))}else for(var w=0;w<h[r].length;w++){var x=h[r][w].id();j[x]==1/0&&(n.push(x),j[x]=j[r]+1),j[x]==j[r]+1&&(i[x]=i[x]+i[r],c[x].push(r))}}for(var y={},z=0;z<g.length;z++)y[g[z].id()]=0;for(;b.length>0;){for(var A=b.pop(),B=0;B<c[A].length;B++){var C=c[A][B];y[C]=y[C]+i[C]/i[A]*(1+y[A])}A!=g[q].id()&&k(A,l(A)+y[A])}}();var r={betweenness:function(a){return l(f.collection(a).id())},betweennessNormalized:function(a){return 0==j?0:l(f.collection(a).id())/j}};return r.betweennessNormalised=r.betweennessNormalized,r}};tQ.bc=tQ.betweennessCentrality;var tR=st({expandFactor:2,inflateFactor:2,multFactor:1,maxIterations:20,attributes:[function(a){return 1}]}),tS=function(a,b){for(var c=0,d=0;d<b.length;d++)c+=b[d](a);return c},tT=function(a,b,c){for(var d=0;d<b;d++)a[d*b+d]=c},tU=function(a,b){for(var c,d=0;d<b;d++){c=0;for(var e=0;e<b;e++)c+=a[e*b+d];for(var f=0;f<b;f++)a[f*b+d]=a[f*b+d]/c}},tV=function(a,b,c){for(var d=Array(c*c),e=0;e<c;e++){for(var f=0;f<c;f++)d[e*c+f]=0;for(var g=0;g<c;g++)for(var h=0;h<c;h++)d[e*c+h]+=a[e*c+g]*b[g*c+h]}return d},tW=function(a,b,c){for(var d=a.slice(0),e=1;e<c;e++)a=tV(a,d,b);return a},tX=function(a,b,c){for(var d=Array(b*b),e=0;e<b*b;e++)d[e]=Math.pow(a[e],c);return tU(d,b),d},tY=function(a,b,c,d){for(var e=0;e<c;e++)if(Math.round(a[e]*Math.pow(10,d))/Math.pow(10,d)!=Math.round(b[e]*Math.pow(10,d))/Math.pow(10,d))return!1;return!0},tZ=function(a,b,c,d){for(var e=[],f=0;f<b;f++){for(var g=[],h=0;h<b;h++)Math.round(1e3*a[f*b+h])/1e3>0&&g.push(c[h]);0!==g.length&&e.push(d.collection(g))}return e},t$=function(a,b){for(var c=0;c<a.length;c++)if(!b[c]||a[c].id()!==b[c].id())return!1;return!0},t_=function(a){for(var b=0;b<a.length;b++)for(var c=0;c<a.length;c++)b!=c&&t$(a[b],a[c])&&a.splice(c,1);return a},t0=function(a){for(var b=this.nodes(),c=this.edges(),d=this.cy(),e=tR(a),f={},g=0;g<b.length;g++)f[b[g].id()]=g;for(var h,i=b.length,j=i*i,k=Array(j),l=0;l<j;l++)k[l]=0;for(var n=0;n<c.length;n++){var o=c[n],p=f[o.source().id()],q=f[o.target().id()],r=tS(o,e.attributes);k[p*i+q]+=r,k[q*i+p]+=r}tT(k,i,e.multFactor),tU(k,i);for(var s=!0,t=0;s&&t<e.maxIterations;)s=!1,tY(k=tX(h=tW(k,i,e.expandFactor),i,e.inflateFactor),h,j,4)||(s=!0),t++;var u=tZ(k,i,b,d);return t_(u)},t1=function(a){return a},t2=function(a,b){return Math.abs(b-a)},t3=function(a,b,c){return a+t2(b,c)},t4=function(a,b,c){return a+Math.pow(c-b,2)},t5=function(a){return Math.sqrt(a)},t6=function(a,b,c){return Math.max(a,t2(b,c))},t7=function(a,b,c,d,e){for(var f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:t1,g=d,h=0;h<a;h++)g=e(g,b(h),c(h));return f(g)},t8={euclidean:function(a,b,c){return a>=2?t7(a,b,c,0,t4,t5):t7(a,b,c,0,t3)},squaredEuclidean:function(a,b,c){return t7(a,b,c,0,t4)},manhattan:function(a,b,c){return t7(a,b,c,0,t3)},max:function(a,b,c){return t7(a,b,c,-1/0,t6)}};function t9(a,b,c,d,e,f){var g;return(g=rq(a)?a:t8[a]||t8.euclidean,0===b&&rq(a))?g(e,f):g(b,c,d,e,f)}t8["squared-euclidean"]=t8.squaredEuclidean,t8.squaredeuclidean=t8.squaredEuclidean;var ua=st({k:2,m:2,sensitivityThreshold:1e-4,distance:"euclidean",maxIterations:10,attributes:[],testMode:!1,testCentroids:null}),ub=function(a){return ua(a)},uc=function(a,b,c,d,e){var f="kMedoids"!==e?function(a){return c[a]}:function(a){return d[a](c)};return t9(a,d.length,f,function(a){return d[a](b)},c,b)},ud=function(a,b,c){for(var d=c.length,e=Array(d),f=Array(d),g=Array(b),h=null,i=0;i<d;i++)e[i]=a.min(c[i]).value,f[i]=a.max(c[i]).value;for(var j=0;j<b;j++){h=[];for(var k=0;k<d;k++)h[k]=Math.random()*(f[k]-e[k])+e[k];g[j]=h}return g},ue=function(a,b,c,d,e){for(var f=1/0,g=0,h=0;h<b.length;h++){var i=uc(c,a,b[h],d,e);i<f&&(f=i,g=h)}return g},uf=function(a,b,c){for(var d=[],e=null,f=0;f<b.length;f++)c[(e=b[f]).id()]===a&&d.push(e);return d},ug=function(a,b,c){for(var d=0;d<a.length;d++)for(var e=0;e<a[d].length;e++)if(Math.abs(a[d][e]-b[d][e])>c)return!1;return!0},uh=function(a,b,c){for(var d=0;d<c;d++)if(a===b[d])return!0;return!1},ui=function(a,b){var c=Array(b);if(a.length<50)for(var d=0;d<b;d++){for(var e=a[Math.floor(Math.random()*a.length)];uh(e,c,d);)e=a[Math.floor(Math.random()*a.length)];c[d]=e}else for(var f=0;f<b;f++)c[f]=a[Math.floor(Math.random()*a.length)];return c},uj=function(a,b,c){for(var d=0,e=0;e<b.length;e++)d+=uc("manhattan",b[e],a,c,"kMedoids");return d},uk=function(a,b,c,d,e){for(var f,g,h=0;h<b.length;h++)for(var i=0;i<a.length;i++)d[h][i]=Math.pow(c[h][i],e.m);for(var j=0;j<a.length;j++)for(var k=0;k<e.attributes.length;k++){f=0,g=0;for(var l=0;l<b.length;l++)f+=d[l][j]*e.attributes[k](b[l]),g+=d[l][j];a[j][k]=f/g}},ul=function(a,b,c,d,e){for(var f,g=0;g<a.length;g++)b[g]=a[g].slice();for(var h=2/(e.m-1),i=0;i<c.length;i++)for(var j=0;j<d.length;j++){f=0;for(var k=0;k<c.length;k++)f+=Math.pow(uc(e.distance,d[j],c[i],e.attributes,"cmeans")/uc(e.distance,d[j],c[k],e.attributes,"cmeans"),h);a[j][i]=1/f}},um=function(a,b,c,d){for(var e,f,g=Array(c.k),h=0;h<g.length;h++)g[h]=[];for(var i=0;i<b.length;i++){e=-1/0,f=-1;for(var j=0;j<b[0].length;j++)b[i][j]>e&&(e=b[i][j],f=j);g[f].push(a[i])}for(var k=0;k<g.length;k++)g[k]=d.collection(g[k]);return g},un=function(a){var b,c,d,e,f=this.cy(),g=this.nodes(),h=ub(a);d=Array(g.length);for(var i=0;i<g.length;i++)d[i]=Array(h.k);c=Array(g.length);for(var j=0;j<g.length;j++)c[j]=Array(h.k);for(var k=0;k<g.length;k++){for(var l=0,n=0;n<h.k;n++)c[k][n]=Math.random(),l+=c[k][n];for(var o=0;o<h.k;o++)c[k][o]=c[k][o]/l}b=Array(h.k);for(var p=0;p<h.k;p++)b[p]=Array(h.attributes.length);e=Array(g.length);for(var q=0;q<g.length;q++)e[q]=Array(h.k);for(var r=!0,s=0;r&&s<h.maxIterations;)r=!1,uk(b,g,c,e,h),ul(c,d,b,g,h),ug(c,d,h.sensitivityThreshold)||(r=!0),s++;return{clusters:um(g,c,h,f),degreeOfMembership:c}},uo=st({distance:"euclidean",linkage:"min",mode:"threshold",threshold:1/0,addDendrogram:!1,dendrogramDepth:0,attributes:[]}),up={single:"min",complete:"max"},uq=function(a){var b=uo(a),c=up[b.linkage];return null!=c&&(b.linkage=c),b},ur=function(a,b,c,d,e){for(var f,g,h=0,i=1/0,j=e.attributes,k=function(a,b){return t9(e.distance,j.length,function(b){return j[b](a)},function(a){return j[a](b)},a,b)},l=0;l<a.length;l++){var n=a[l].key,o=c[n][d[n]];o<i&&(h=n,i=o)}if("threshold"===e.mode&&i>=e.threshold||"dendrogram"===e.mode&&1===a.length)return!1;var p=b[h],q=b[d[h]];g="dendrogram"===e.mode?{left:p,right:q,key:p.key}:{value:p.value.concat(q.value),key:p.key},a[p.index]=g,a.splice(q.index,1),b[p.key]=g;for(var r=0;r<a.length;r++){var s=a[r];p.key===s.key?f=1/0:"min"===e.linkage?(f=c[p.key][s.key],c[p.key][s.key]>c[q.key][s.key]&&(f=c[q.key][s.key])):"max"===e.linkage?(f=c[p.key][s.key],c[p.key][s.key]<c[q.key][s.key]&&(f=c[q.key][s.key])):f="mean"===e.linkage?(c[p.key][s.key]*p.size+c[q.key][s.key]*q.size)/(p.size+q.size):"dendrogram"===e.mode?k(s.value,p.value):k(s.value[0],p.value[0]),c[p.key][s.key]=c[s.key][p.key]=f}for(var t=0;t<a.length;t++){var u=a[t].key;if(d[u]===p.key||d[u]===q.key){for(var v=u,w=0;w<a.length;w++){var x=a[w].key;c[u][x]<c[u][v]&&(v=x)}d[u]=v}a[t].index=t}return p.key=q.key=p.index=q.index=null,!0},us=function(a,b,c){a&&(a.value?b.push(a.value):(a.left&&us(a.left,b),a.right&&us(a.right,b)))},ut=function(a,b){if(!a)return"";if(a.left&&a.right){var c=ut(a.left,b),d=ut(a.right,b),e=b.add({group:"nodes",data:{id:c+","+d}});return b.add({group:"edges",data:{source:c,target:e.id()}}),b.add({group:"edges",data:{source:d,target:e.id()}}),e.id()}if(a.value)return a.value.id()},uu=function(a,b,c){if(!a)return[];var d=[],e=[],f=[];if(0===b)return a.left&&us(a.left,d),a.right&&us(a.right,e),f=d.concat(e),[c.collection(f)];if(1===b)if(a.value)return[c.collection(a.value)];else return a.left&&us(a.left,d),a.right&&us(a.right,e),[c.collection(d),c.collection(e)];return a.value?[c.collection(a.value)]:(a.left&&(d=uu(a.left,b-1,c)),a.right&&(e=uu(a.right,b-1,c)),d.concat(e))},uv=function(a){for(var b,c=this.cy(),d=this.nodes(),e=uq(a),f=e.attributes,g=function(a,b){return t9(e.distance,f.length,function(b){return f[b](a)},function(a){return f[a](b)},a,b)},h=[],i=[],j=[],k=[],l=0;l<d.length;l++){var n={value:"dendrogram"===e.mode?d[l]:[d[l]],key:l,index:l};h[l]=n,k[l]=n,i[l]=[],j[l]=0}for(var o=0;o<h.length;o++)for(var p=0;p<=o;p++){var q=void 0;q="dendrogram"===e.mode?o===p?1/0:g(h[o].value,h[p].value):o===p?1/0:g(h[o].value[0],h[p].value[0]),i[o][p]=q,i[p][o]=q,q<i[o][j[o]]&&(j[o]=p)}for(var r=ur(h,k,i,j,e);r;)r=ur(h,k,i,j,e);return"dendrogram"===e.mode?(b=uu(h[0],e.dendrogramDepth,c),e.addDendrogram&&ut(h[0],c)):(b=Array(h.length),h.forEach(function(a,d){a.key=a.index=null,b[d]=c.collection(a.value)})),b},uw=st({distance:"euclidean",preference:"median",damping:.8,maxIterations:1e3,minIterations:100,attributes:[]}),ux=function(a){var b=a.damping,c=a.preference;.5<=b&&b<1||sm("Damping must range on [0.5, 1).  Got: ".concat(b));var d=["median","mean","min","max"];return d.some(function(a){return a===c})||rt(c)||sm("Preference must be one of [".concat(d.map(function(a){return"'".concat(a,"'")}).join(", "),"] or a number.  Got: ").concat(c)),uw(a)},uy=function(a,b,c,d){var e=function(a,b){return d[b](a)};return-t9(a,d.length,function(a){return e(b,a)},function(a){return e(c,a)},b,c)},uz=function(a,b){return"median"===b?sW(a):"mean"===b?sV(a):"min"===b?sT(a):"max"===b?sU(a):b},uA=function(a,b,c){for(var d=[],e=0;e<a;e++)b[e*a+e]+c[e*a+e]>0&&d.push(e);return d},uB=function(a,b,c){for(var d=[],e=0;e<a;e++){for(var f=-1,g=-1/0,h=0;h<c.length;h++){var i=c[h];b[e*a+i]>g&&(f=i,g=b[e*a+i])}f>0&&d.push(f)}for(var j=0;j<c.length;j++)d[c[j]]=c[j];return d},uC=function(a,b,c){for(var d=uB(a,b,c),e=0;e<c.length;e++){for(var f=[],g=0;g<d.length;g++)d[g]===c[e]&&f.push(g);for(var h=-1,i=-1/0,j=0;j<f.length;j++){for(var k=0,l=0;l<f.length;l++)k+=b[f[l]*a+f[j]];k>i&&(h=j,i=k)}c[e]=f[h]}return uB(a,b,c)},uD=function(a){for(var b,c,d,e,f,g,h,i=this.cy(),j=this.nodes(),k=ux(a),l={},n=0;n<j.length;n++)l[j[n].id()]=n;d=Array(c=(b=j.length)*b);for(var o=0;o<c;o++)d[o]=-1/0;for(var p=0;p<b;p++)for(var q=0;q<b;q++)p!==q&&(d[p*b+q]=uy(k.distance,j[p],j[q],k.attributes));e=uz(d,k.preference);for(var r=0;r<b;r++)d[r*b+r]=e;f=Array(c);for(var s=0;s<c;s++)f[s]=0;g=Array(c);for(var t=0;t<c;t++)g[t]=0;for(var u=Array(b),v=Array(b),w=Array(b),x=0;x<b;x++)u[x]=0,v[x]=0,w[x]=0;for(var y=Array(b*k.minIterations),z=0;z<y.length;z++)y[z]=0;for(h=0;h<k.maxIterations;h++){for(var A=0;A<b;A++){for(var B=-1/0,C=-1/0,D=-1,E=0,F=0;F<b;F++)u[F]=f[A*b+F],(E=g[A*b+F]+d[A*b+F])>=B?(C=B,B=E,D=F):E>C&&(C=E);for(var G=0;G<b;G++)f[A*b+G]=(1-k.damping)*(d[A*b+G]-B)+k.damping*u[G];f[A*b+D]=(1-k.damping)*(d[A*b+D]-C)+k.damping*u[D]}for(var H=0;H<b;H++){for(var I=0,J=0;J<b;J++)u[J]=g[J*b+H],v[J]=Math.max(0,f[J*b+H]),I+=v[J];I-=v[H],v[H]=f[H*b+H],I+=v[H];for(var K=0;K<b;K++)g[K*b+H]=(1-k.damping)*Math.min(0,I-v[K])+k.damping*u[K];g[H*b+H]=(1-k.damping)*(I-v[H])+k.damping*u[H]}for(var L=0,M=0;M<b;M++){var N=+(g[M*b+M]+f[M*b+M]>0);y[h%k.minIterations*b+M]=N,L+=N}if(L>0&&(h>=k.minIterations-1||h==k.maxIterations-1)){for(var O=0,P=0;P<b;P++){w[P]=0;for(var Q=0;Q<k.minIterations;Q++)w[P]+=y[Q*b+P];(0===w[P]||w[P]===k.minIterations)&&O++}if(O===b)break}}for(var R=uA(b,f,g),S=uC(b,d,R),T={},U=0;U<R.length;U++)T[R[U]]=[];for(var V=0;V<j.length;V++){var W=S[l[j[V].id()]];null!=W&&T[W].push(j[V])}for(var X=Array(R.length),Y=0;Y<R.length;Y++)X[Y]=i.collection(T[R[Y]]);return X},uE=st({root:void 0,directed:!1}),uF=function(){var a=this,b={},c=0,d=0,e=[],f=[],g={},h=function(c,d){for(var g=f.length-1,h=[],i=a.spawn();f[g].x!=c||f[g].y!=d;)h.push(f.pop().edge),g--;h.push(f.pop().edge),h.forEach(function(c){var d=c.connectedNodes().intersection(a);i.merge(c),d.forEach(function(c){var d=c.id(),e=c.connectedEdges().intersection(a);i.merge(c),b[d].cutVertex?i.merge(e.filter(function(a){return a.isLoop()})):i.merge(e)})}),e.push(i)},i=function(j,k,l){j===l&&(d+=1),b[k]={id:c,low:c++,cutVertex:!1};var n,o,p,q,r=a.getElementById(k).connectedEdges().intersection(a);0===r.size()?e.push(a.spawn(a.getElementById(k))):r.forEach(function(a){n=a.source().id(),o=a.target().id(),(p=n===k?o:n)!==l&&(g[q=a.id()]||(g[q]=!0,f.push({x:k,y:p,edge:a})),p in b?b[k].low=Math.min(b[k].low,b[p].id):(i(j,p,k),b[k].low=Math.min(b[k].low,b[p].low),b[k].id<=b[p].low&&(b[k].cutVertex=!0,h(k,p))))})};a.forEach(function(a){if(a.isNode()){var c=a.id();c in b||(d=0,i(c,c),b[c].cutVertex=d>1)}});var j=Object.keys(b).filter(function(a){return b[a].cutVertex}).map(function(b){return a.getElementById(b)});return{cut:a.spawn(j),components:e}},uG=function(){var a=this,b={},c=0,d=[],e=[],f=a.spawn(a),g=function(h){if(e.push(h),b[h]={index:c,low:c++,explored:!1},a.getElementById(h).connectedEdges().intersection(a).forEach(function(a){var c=a.target().id();c!==h&&(c in b||g(c),b[c].explored||(b[h].low=Math.min(b[h].low,b[c].low)))}),b[h].index===b[h].low){for(var i=a.spawn();;){var j=e.pop();if(i.merge(a.getElementById(j)),b[j].low=b[h].index,b[j].explored=!0,j===h)break}var k=i.edgesWith(i),l=i.merge(k);d.push(l),f=f.difference(l)}};return a.forEach(function(a){if(a.isNode()){var c=a.id();c in b||g(c)}}),{cut:f,components:d}},uH={};[sF,{dijkstra:function(a){if(!rs(a)){var b=arguments;a={root:b[0],weight:b[1],directed:b[2]}}var c=sJ(a),d=c.root,e=c.weight,f=c.directed,g=this,h=rp(d)?this.filter(d)[0]:d[0],i={},j={},k={},l=this.byGroup(),n=l.nodes,o=l.edges;o.unmergeBy(function(a){return a.isLoop()});for(var p=function(a){return i[a.id()]},q=new sI(function(a,b){return p(a)-p(b)}),r=0;r<n.length;r++){var s=n[r];i[s.id()]=s.same(h)?0:1/0,q.push(s)}for(;q.size()>0;){var t=q.pop(),u=p(t);if(k[t.id()]=u,u!==1/0)for(var v=t.neighborhood().intersect(n),w=0;w<v.length;w++){var x=v[w],y=x.id(),z=function(a,b){for(var c,d=(f?a.edgesTo(b):a.edgesWith(b)).intersect(o),g=1/0,h=0;h<d.length;h++){var i=d[h],j=e(i);(j<g||!c)&&(g=j,c=i)}return{edge:c,dist:g}}(t,x),A=u+z.dist;A<p(x)&&(i[x.id()]=A,q.updateItem(x),j[y]={node:t,edge:z.edge})}}return{distanceTo:function(a){return k[(rp(a)?n.filter(a)[0]:a[0]).id()]},pathTo:function(a){var b=rp(a)?n.filter(a)[0]:a[0],c=[],d=b,e=d.id();if(b.length>0)for(c.unshift(b);j[e];){var f=j[e];c.unshift(f.edge),c.unshift(f.node),e=(d=f.node).id()}return g.spawn(c)}}}},{kruskal:function(a){a=a||function(a){return 1};for(var b=this.byGroup(),c=b.nodes,d=b.edges,e=c.length,f=Array(e),g=function(a){for(var b=0;b<f.length;b++)if(f[b].has(a))return b},h=0;h<e;h++)f[h]=this.spawn(c[h]);for(var i=d.sort(function(b,c){return a(b)-a(c)}),j=0;j<i.length;j++){var k=i[j],l=k.source()[0],n=k.target()[0],o=g(l),p=g(n),q=f[o],r=f[p];o!==p&&(c.merge(k),q.merge(r),f.splice(p,1))}return c}},{aStar:function(a){var b,c,d=this.cy(),e=sK(a),f=e.root,g=e.goal,h=e.heuristic,i=e.directed,j=e.weight;f=d.collection(f)[0],g=d.collection(g)[0];var k=f.id(),l=g.id(),n={},o={},p={},q=new sI(function(a,b){return o[a.id()]-o[b.id()]}),r=new sC,s={},t={},u=function(a,b){q.push(a),r.add(b)};u(f,k),n[k]=0,o[k]=h(f);for(var v=0;q.size()>0;){if(c=(b=q.pop()).id(),r.delete(c),v++,c===l){for(var w=[],x=g,y=l,z=t[y];w.unshift(x),null!=z&&w.unshift(z),null!=(x=s[y]);)z=t[y=x.id()];return{found:!0,distance:n[c],path:this.spawn(w),steps:v}}p[c]=!0;for(var A=b._private.edges,B=0;B<A.length;B++){var C=A[B];if(this.hasElementWithId(C.id())&&(!i||C.data("source")===c)){var D=C.source(),E=C.target(),F=D.id()!==c?D:E,G=F.id();if(this.hasElementWithId(G)&&!p[G]){var H=n[c]+j(C);if(!r.has(G)){n[G]=H,o[G]=H+h(F),u(F,G),s[G]=b,t[G]=C;continue}H<n[G]&&(n[G]=H,o[G]=H+h(F),s[G]=b,t[G]=C)}}}}return{found:!1,distance:void 0,path:void 0,steps:v}}},{floydWarshall:function(a){for(var b=this.cy(),c=sL(a),d=c.weight,e=c.directed,f=this.byGroup(),g=f.nodes,h=f.edges,i=g.length,j=i*i,k=function(a){return g.indexOf(a)},l=function(a){return g[a]},n=Array(j),o=0;o<j;o++){var p=o%i;(o-p)/i===p?n[o]=0:n[o]=1/0}for(var q=Array(j),r=Array(j),s=0;s<h.length;s++){var t=h[s],u=t.source()[0],v=t.target()[0];if(u!==v){var w=k(u),x=k(v),y=w*i+x,z=d(t);if(n[y]>z&&(n[y]=z,q[y]=x,r[y]=t),!e){var A=x*i+w;!e&&n[A]>z&&(n[A]=z,q[A]=w,r[A]=t)}}}for(var B=0;B<i;B++)for(var C=0;C<i;C++)for(var D=C*i+B,E=0;E<i;E++){var F=C*i+E,G=B*i+E;n[D]+n[G]<n[F]&&(n[F]=n[D]+n[G],q[F]=q[D])}var H=function(a){return k((rp(a)?b.filter(a):a)[0])};return{distance:function(a,b){return n[H(a)*i+H(b)]},path:function(a,c){var d,e=H(a),f=H(c),g=l(e);if(e===f)return g.collection();if(null==q[e*i+f])return b.collection();var h=b.collection(),j=e;for(h.merge(g);e!==f;)j=e,e=q[e*i+f],d=r[j*i+e],h.merge(d),h.merge(l(e));return h}}}},{bellmanFord:function(a){var b=this,c=sM(a),d=c.weight,e=c.directed,f=c.root,g=this,h=this.cy(),i=this.byGroup(),j=i.edges,k=i.nodes,l=k.length,n=new sA,o=!1,p=[];f=h.collection(f)[0],j.unmergeBy(function(a){return a.isLoop()});for(var q=j.length,r=function(a){var b=n.get(a.id());return b||(b={},n.set(a.id(),b)),b},s=function(a){return(rp(a)?h.$(a):a)[0]},t=0;t<l;t++){var u=k[t],v=r(u);u.same(f)?v.dist=0:v.dist=1/0,v.pred=null,v.edge=null}for(var w=!1,x=function(a,b,c,d,e,f){var g=d.dist+f;g<e.dist&&!c.same(d.edge)&&(e.dist=g,e.pred=a,e.edge=c,w=!0)},y=1;y<l;y++){w=!1;for(var z=0;z<q;z++){var A=j[z],B=A.source(),C=A.target(),D=d(A),E=r(B),F=r(C);x(B,C,A,E,F,D),e||x(C,B,A,F,E,D)}if(!w)break}if(w)for(var G=[],H=0;H<q;H++){var I=j[H],J=I.source(),K=I.target(),L=d(I),M=r(J).dist,N=r(K).dist;if(M+L<N||!e&&N+L<M)if(o||(so("Graph contains a negative weight cycle for Bellman-Ford"),o=!0),!1!==a.findNegativeWeightCycles){var O=[];M+L<N&&O.push(J),!e&&N+L<M&&O.push(K);for(var P=O.length,Q=0;Q<P;Q++){var R=O[Q],S=[R];S.push(r(R).edge);for(var T=r(R).pred;-1===S.indexOf(T);)S.push(T),S.push(r(T).edge),T=r(T).pred;for(var U=(S=S.slice(S.indexOf(T)))[0].id(),V=0,W=2;W<S.length;W+=2)S[W].id()<U&&(U=S[W].id(),V=W);(S=S.slice(V).concat(S.slice(0,V))).push(S[0]);var X=S.map(function(a){return a.id()}).join(",");-1===G.indexOf(X)&&(p.push(g.spawn(S)),G.push(X))}}else break}return{distanceTo:function(a){return r(s(a)).dist},pathTo:function(a){for(var c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:f,d=s(a),e=[],h=d;;){if(null==h)return b.spawn();var i=r(h),j=i.edge,k=i.pred;if(e.unshift(h[0]),h.same(c)&&e.length>0)break;null!=j&&e.unshift(j),h=k}return g.spawn(e)},hasNegativeWeightCycle:o,negativeWeightCycles:p}}},{kargerStein:function(){var a=this,b=this.byGroup(),c=b.nodes,d=b.edges;d.unmergeBy(function(a){return a.isLoop()});var e=c.length,f=d.length,g=Math.ceil(Math.pow(Math.log(e)/Math.LN2,2)),h=Math.floor(e/sN);if(e<2)return void sm("At least 2 nodes are required for Karger-Stein algorithm");for(var i=[],j=0;j<f;j++){var k=d[j];i.push([j,c.indexOf(k.source()),c.indexOf(k.target())])}for(var l=1/0,n=[],o=Array(e),p=Array(e),q=Array(e),r=function(a,b){for(var c=0;c<e;c++)b[c]=a[c]},s=0;s<=g;s++){for(var t=0;t<e;t++)p[t]=t;var u=sP(p,i.slice(),e,h),v=u.slice();r(p,q);var w=sP(p,u,h,2),x=sP(q,v,h,2);w.length<=x.length&&w.length<l?(l=w.length,n=w,r(p,o)):x.length<=w.length&&x.length<l&&(l=x.length,n=x,r(q,o))}for(var y=this.spawn(n.map(function(a){return d[a[0]]})),z=this.spawn(),A=this.spawn(),B=o[0],C=0;C<o.length;C++){var D=o[C],E=c[C];D===B?z.merge(E):A.merge(E)}var F=function(b){var c=a.spawn();return b.forEach(function(b){c.merge(b),b.connectedEdges().forEach(function(b){a.contains(b)&&!y.contains(b)&&c.merge(b)})}),c};return{cut:y,components:[F(z),F(A)],partition1:z,partition2:A}}},{pageRank:function(a){for(var b,c=tK(a),d=c.dampingFactor,e=c.precision,f=c.iterations,g=c.weight,h=this._private.cy,i=this.byGroup(),j=i.nodes,k=i.edges,l=j.length,n=l*l,o=k.length,p=Array(n),q=Array(l),r=(1-d)/l,s=0;s<l;s++){for(var t=0;t<l;t++)p[s*l+t]=0;q[s]=0}for(var u=0;u<o;u++){var v=k[u],w=v.data("source"),x=v.data("target");if(w!==x){var y=j.indexOfId(w),z=j.indexOfId(x),A=g(v),B=z*l+y;p[B]+=A,q[y]+=A}}for(var C=1/l+r,D=0;D<l;D++)if(0===q[D])for(var E=0;E<l;E++)p[E*l+D]=C;else for(var F=0;F<l;F++){var G=F*l+D;p[G]=p[G]/q[D]+r}for(var H=Array(l),I=Array(l),J=0;J<l;J++)H[J]=1;for(var K=0;K<f;K++){for(var L=0;L<l;L++)I[L]=0;for(var M=0;M<l;M++)for(var N=0;N<l;N++){var O=M*l+N;I[M]+=p[O]*H[N]}s0(I),b=H,H=I,I=b;for(var P=0,Q=0;Q<l;Q++){var R=b[Q]-H[Q];P+=R*R}if(P<e)break}return{rank:function(a){return a=h.collection(a)[0],H[j.indexOf(a)]}}}},tM,tO,tQ,{markovClustering:t0,mcl:t0},{kMeans:function(a){var b,c=this.cy(),d=this.nodes(),e=null,f=ub(a),g=Array(f.k),h={};f.testMode?"number"==typeof f.testCentroids?(f.testCentroids,b=ud(d,f.k,f.attributes)):b="object"===ri(f.testCentroids)?f.testCentroids:ud(d,f.k,f.attributes):b=ud(d,f.k,f.attributes);for(var i=!0,j=0;i&&j<f.maxIterations;){for(var k=0;k<d.length;k++)h[(e=d[k]).id()]=ue(e,b,f.distance,f.attributes,"kMeans");i=!1;for(var l=0;l<f.k;l++){var n=uf(l,d,h);if(0!==n.length){for(var o=f.attributes.length,p=b[l],q=Array(o),r=Array(o),s=0;s<o;s++){r[s]=0;for(var t,u=0;u<n.length;u++)e=n[u],r[s]+=f.attributes[s](e);q[s]=r[s]/n.length,t=q[s],Math.abs(p[s]-t)<=f.sensitivityThreshold||(i=!0)}b[l]=q,g[l]=c.collection(n)}}j++}return g},kMedoids:function(a){var b,c,d=this.cy(),e=this.nodes(),f=null,g=ub(a),h=Array(g.k),i={},j=Array(g.k);g.testMode?"number"==typeof g.testCentroids||(b="object"===ri(g.testCentroids)?g.testCentroids:ui(e,g.k)):b=ui(e,g.k);for(var k=!0,l=0;k&&l<g.maxIterations;){for(var n=0;n<e.length;n++)i[(f=e[n]).id()]=ue(f,b,g.distance,g.attributes,"kMedoids");k=!1;for(var o=0;o<b.length;o++){var p=uf(o,e,i);if(0!==p.length){j[o]=uj(b[o],p,g.attributes);for(var q=0;q<p.length;q++)(c=uj(p[q],p,g.attributes))<j[o]&&(j[o]=c,b[o]=p[q],k=!0);h[o]=d.collection(p)}}l++}return h},fuzzyCMeans:un,fcm:un},{hierarchicalClustering:uv,hca:uv},{affinityPropagation:uD,ap:uD},{hierholzer:function(a){if(!rs(a)){var b,c,d,e=arguments;a={root:e[0],directed:e[1]}}var f=uE(a),g=f.root,h=f.directed,i=!1;g&&(d=rp(g)?this.filter(g)[0].id():g[0].id());var j={},k={};h?this.forEach(function(a){var d=a.id();if(a.isNode()){var e=a.indegree(!0),f=a.outdegree(!0),g=e-f,h=f-e;1==g?b?i=!0:b=d:1==h?c?i=!0:c=d:(h>1||g>1)&&(i=!0),j[d]=[],a.outgoers().forEach(function(a){a.isEdge()&&j[d].push(a.id())})}else k[d]=[void 0,a.target().id()]}):this.forEach(function(a){var d=a.id();a.isNode()?(a.degree(!0)%2&&(b?c?i=!0:c=d:b=d),j[d]=[],a.connectedEdges().forEach(function(a){return j[d].push(a.id())})):k[d]=[a.source().id(),a.target().id()]});var l={found:!1,trail:void 0};if(i)return l;if(c&&b)if(h){if(d&&c!=d)return l;d=c}else{if(d&&c!=d&&b!=d)return l;d||(d=c)}else d||(d=this[0].id());var n=function(a){for(var b,c,d,e=a,f=[a];j[e].length;)c=k[b=j[e].shift()][0],e!=(d=k[b][1])?(j[d]=j[d].filter(function(a){return a!=b}),e=d):h||e==c||(j[c]=j[c].filter(function(a){return a!=b}),e=c),f.unshift(b),f.unshift(e);return f},o=[],p=[];for(p=n(d);1!=p.length;)0==j[p[0]].length?(o.unshift(this.getElementById(p.shift())),o.unshift(this.getElementById(p.shift()))):p=n(p.shift()).concat(p);for(var q in o.unshift(this.getElementById(p.shift())),j)if(j[q].length)return l;return l.found=!0,l.trail=this.spawn(o,!0),l}},{hopcroftTarjanBiconnected:uF,htbc:uF,htb:uF,hopcroftTarjanBiconnectedComponents:uF},{tarjanStronglyConnected:uG,tsc:uG,tscc:uG,tarjanStronglyConnectedComponents:uG}].forEach(function(a){rO(uH,a)});var uI=function(a){if(!(this instanceof uI))return new uI(a);this.id="Thenable/1.0.7",this.state=0,this.fulfillValue=void 0,this.rejectReason=void 0,this.onFulfilled=[],this.onRejected=[],this.proxy={then:this.then.bind(this)},"function"==typeof a&&a.call(this,this.fulfill.bind(this),this.reject.bind(this))};uI.prototype={fulfill:function(a){return uJ(this,1,"fulfillValue",a)},reject:function(a){return uJ(this,2,"rejectReason",a)},then:function(a,b){var c=new uI;return this.onFulfilled.push(uM(a,c,"fulfill")),this.onRejected.push(uM(b,c,"reject")),uK(this),c.proxy}};var uJ=function(a,b,c,d){return 0===a.state&&(a.state=b,a[c]=d,uK(a)),a},uK=function(a){1===a.state?uL(a,"onFulfilled",a.fulfillValue):2===a.state&&uL(a,"onRejected",a.rejectReason)},uL=function(a,b,c){if(0!==a[b].length){var d=a[b];a[b]=[];var e=function(){for(var a=0;a<d.length;a++)d[a](c)};"function"==typeof setImmediate?setImmediate(e):setTimeout(e,0)}},uM=function(a,b,c){return function(d){if("function"!=typeof a)b[c].call(b,d);else{var e;try{e=a(d)}catch(a){b.reject(a);return}uN(b,e)}}},uN=function(a,b){if(a===b||a.proxy===b)return void a.reject(TypeError("cannot resolve promise with itself"));if("object"===ri(b)&&null!==b||"function"==typeof b)try{c=b.then}catch(b){a.reject(b);return}if("function"==typeof c){var c,d=!1;try{c.call(b,function(c){d||(d=!0,c===b?a.reject(TypeError("circular thenable chain")):uN(a,c))},function(b){d||(d=!0,a.reject(b))})}catch(b){d||a.reject(b)}return}a.fulfill(b)};uI.all=function(a){return new uI(function(b,c){for(var d=Array(a.length),e=0,f=function(c,f){d[c]=f,++e===a.length&&b(d)},g=0;g<a.length;g++)!function(b){var d=a[b];null!=d&&null!=d.then?d.then(function(a){f(b,a)},function(a){c(a)}):f(b,d)}(g)})},uI.resolve=function(a){return new uI(function(b,c){b(a)})},uI.reject=function(a){return new uI(function(b,c){c(a)})};var uO="undefined"!=typeof Promise?Promise:uI,uP=function(a,b,c){var d=ry(a),e=this._private=rO({duration:1e3},b,c);if(e.target=a,e.style=e.style||e.css,e.started=!1,e.playing=!1,e.hooked=!1,e.applying=!1,e.progress=0,e.completes=[],e.frames=[],e.complete&&rq(e.complete)&&e.completes.push(e.complete),!d){var f=a.position();e.startPosition=e.startPosition||{x:f.x,y:f.y},e.startStyle=e.startStyle||a.cy().style().getAnimationStartStyle(a,e.style)}if(d){var g=a.pan();e.startPan={x:g.x,y:g.y},e.startZoom=a.zoom()}this.length=1,this[0]=this},uQ=uP.prototype;function uR(){return yz?yy:(yz=1,yy=Array.isArray)}function uS(){if(yP)return yO;yP=1;var a=function(){if(yL)return yK;yL=1;var a=function(){if(yD)return yC;yD=1;var a=r_(),b=rY();return yC=function(c){if(!b(c))return!1;var d=a(c);return"[object Function]"==d||"[object GeneratorFunction]"==d||"[object AsyncFunction]"==d||"[object Proxy]"==d}}(),b=function(){if(yH)return yG;yH=1;var a,b=yF?yE:(yF=1,yE=rZ()["__core-js_shared__"]),c=(a=/[^.]+$/.exec(b&&b.keys&&b.keys.IE_PROTO||""))?"Symbol(src)_1."+a:"";return yG=function(a){return!!c&&c in a}}(),c=rY(),d=function(){if(yJ)return yI;yJ=1;var a=Function.prototype.toString;return yI=function(b){if(null!=b){try{return a.call(b)}catch(a){}try{return b+""}catch(a){}}return""}}(),e=/^\[object .+?Constructor\]$/,f=Object.prototype,g=Function.prototype.toString,h=f.hasOwnProperty,i=RegExp("^"+g.call(h).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");return yK=function(f){return!(!c(f)||b(f))&&(a(f)?i:e).test(d(f))}}(),b=yN?yM:(yN=1,yM=function(a,b){return null==a?void 0:a[b]});return yO=function(c,d){var e=b(c,d);return a(e)?e:void 0}}function uT(){return yR?yQ:(yR=1,yQ=uS()(Object,"create"))}function uU(){return y5?y4:(y5=1,y4=function(a,b){return a===b||a!=a&&b!=b})}function uV(){if(y7)return y6;y7=1;var a=uU();return y6=function(b,c){for(var d=b.length;d--;)if(a(b[d][0],c))return d;return -1}}function uW(){if(zp)return zo;zp=1;var a=zn?zm:(zn=1,zm=function(a){var b=typeof a;return"string"==b||"number"==b||"symbol"==b||"boolean"==b?"__proto__"!==a:null===a});return zo=function(b,c){var d=b.__data__;return a(c)?d["string"==typeof c?"string":"hash"]:d.map}}function uX(){if(zF)return zE;zF=1;var a=function(){if(zD)return zC;zD=1;var a=function(){if(zB)return zA;zB=1;var a=function(){if(zz)return zy;zz=1;var a=function(){if(zl)return zk;zl=1;var a=function(){if(y1)return y0;y1=1;var a=function(){if(yT)return yS;yT=1;var a=uT();return yS=function(){this.__data__=a?a(null):{},this.size=0}}(),b=yV?yU:(yV=1,yU=function(a){var b=this.has(a)&&delete this.__data__[a];return this.size-=!!b,b}),c=function(){if(yX)return yW;yX=1;var a=uT(),b=Object.prototype.hasOwnProperty;return yW=function(c){var d=this.__data__;if(a){var e=d[c];return"__lodash_hash_undefined__"===e?void 0:e}return b.call(d,c)?d[c]:void 0}}(),d=function(){if(yZ)return yY;yZ=1;var a=uT(),b=Object.prototype.hasOwnProperty;return yY=function(c){var d=this.__data__;return a?void 0!==d[c]:b.call(d,c)}}(),e=function(){if(y_)return y$;y_=1;var a=uT();return y$=function(b,c){var d=this.__data__;return this.size+=+!this.has(b),d[b]=a&&void 0===c?"__lodash_hash_undefined__":c,this}}();function f(a){var b=-1,c=null==a?0:a.length;for(this.clear();++b<c;){var d=a[b];this.set(d[0],d[1])}}return f.prototype.clear=a,f.prototype.delete=b,f.prototype.get=c,f.prototype.has=d,f.prototype.set=e,y0=f}(),b=function(){if(zh)return zg;zh=1;var a=y3?y2:(y3=1,y2=function(){this.__data__=[],this.size=0}),b=function(){if(y9)return y8;y9=1;var a=uV(),b=Array.prototype.splice;return y8=function(c){var d=this.__data__,e=a(d,c);return!(e<0)&&(e==d.length-1?d.pop():b.call(d,e,1),--this.size,!0)}}(),c=function(){if(zb)return za;zb=1;var a=uV();return za=function(b){var c=this.__data__,d=a(c,b);return d<0?void 0:c[d][1]}}(),d=function(){if(zd)return zc;zd=1;var a=uV();return zc=function(b){return a(this.__data__,b)>-1}}(),e=function(){if(zf)return ze;zf=1;var a=uV();return ze=function(b,c){var d=this.__data__,e=a(d,b);return e<0?(++this.size,d.push([b,c])):d[e][1]=c,this}}();function f(a){var b=-1,c=null==a?0:a.length;for(this.clear();++b<c;){var d=a[b];this.set(d[0],d[1])}}return f.prototype.clear=a,f.prototype.delete=b,f.prototype.get=c,f.prototype.has=d,f.prototype.set=e,zg=f}(),c=zj?zi:(zj=1,zi=uS()(rZ(),"Map"));return zk=function(){this.size=0,this.__data__={hash:new a,map:new(c||b),string:new a}}}(),b=function(){if(zr)return zq;zr=1;var a=uW();return zq=function(b){var c=a(this,b).delete(b);return this.size-=!!c,c}}(),c=function(){if(zt)return zs;zt=1;var a=uW();return zs=function(b){return a(this,b).get(b)}}(),d=function(){if(zv)return zu;zv=1;var a=uW();return zu=function(b){return a(this,b).has(b)}}(),e=function(){if(zx)return zw;zx=1;var a=uW();return zw=function(b,c){var d=a(this,b),e=d.size;return d.set(b,c),this.size+=+(d.size!=e),this}}();function f(a){var b=-1,c=null==a?0:a.length;for(this.clear();++b<c;){var d=a[b];this.set(d[0],d[1])}}return f.prototype.clear=a,f.prototype.delete=b,f.prototype.get=c,f.prototype.has=d,f.prototype.set=e,zy=f}();function b(c,d){if("function"!=typeof c||null!=d&&"function"!=typeof d)throw TypeError("Expected a function");var e=function(){var a=arguments,b=d?d.apply(this,a):a[0],f=e.cache;if(f.has(b))return f.get(b);var g=c.apply(this,a);return e.cache=f.set(b,g)||f,g};return e.cache=new(b.Cache||a),e}return b.Cache=a,zA=b}();return zC=function(b){var c=a(b,function(a){return 500===d.size&&d.clear(),a}),d=c.cache;return c}}(),b=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,c=/\\(\\)?/g;return zE=a(function(a){var d=[];return 46===a.charCodeAt(0)&&d.push(""),a.replace(b,function(a,b,e,f){d.push(e?f.replace(c,"$1"):b||a)}),d})}function uY(){return zH?zG:(zH=1,zG=function(a,b){for(var c=-1,d=null==a?0:a.length,e=Array(d);++c<d;)e[c]=b(a[c],c,a);return e})}function uZ(){if(zL)return zK;zL=1;var a=function(){if(zJ)return zI;zJ=1;var a=r$(),b=uY(),c=uR(),d=r0(),e=a?a.prototype:void 0,f=e?e.toString:void 0;return zI=function a(e){if("string"==typeof e)return e;if(c(e))return b(e,a)+"";if(d(e))return f?f.call(e):"";var g=e+"";return"0"==g&&1/e==-1/0?"-0":g}}();return zK=function(b){return null==b?"":a(b)}}function u$(){if(zN)return zM;zN=1;var a=uR(),b=function(){if(yB)return yA;yB=1;var a=uR(),b=r0(),c=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,d=/^\w*$/;return yA=function(e,f){if(a(e))return!1;var g=typeof e;return!!("number"==g||"symbol"==g||"boolean"==g||null==e||b(e))||d.test(e)||!c.test(e)||null!=f&&e in Object(f)}}(),c=uX(),d=uZ();return zM=function(e,f){return a(e)?e:b(e,f)?[e]:c(d(e))}}function u_(){if(zP)return zO;zP=1;var a=r0();return zO=function(b){if("string"==typeof b||a(b))return b;var c=b+"";return"0"==c&&1/b==-1/0?"-0":c}}rO(uQ,{instanceString:function(){return"animation"},hook:function(){var a=this._private;if(!a.hooked){var b=a.target._private.animation;(a.queue?b.queue:b.current).push(this),rv(a.target)&&a.target.cy().addToAnimationPool(a.target),a.hooked=!0}return this},play:function(){var a=this._private;return 1===a.progress&&(a.progress=0),a.playing=!0,a.started=!1,a.stopped=!1,this.hook(),this},playing:function(){return this._private.playing},apply:function(){var a=this._private;return a.applying=!0,a.started=!1,a.stopped=!1,this.hook(),this},applying:function(){return this._private.applying},pause:function(){var a=this._private;return a.playing=!1,a.started=!1,this},stop:function(){var a=this._private;return a.playing=!1,a.started=!1,a.stopped=!0,this},rewind:function(){return this.progress(0)},fastforward:function(){return this.progress(1)},time:function(a){var b=this._private;return void 0===a?b.progress*b.duration:this.progress(a/b.duration)},progress:function(a){var b=this._private,c=b.playing;return void 0===a?b.progress:(c&&this.pause(),b.progress=a,b.started=!1,c&&this.play(),this)},completed:function(){return 1===this._private.progress},reverse:function(){var a=this._private,b=a.playing;b&&this.pause(),a.progress=1-a.progress,a.started=!1;var c=function(b,c){var d=a[b];null!=d&&(a[b]=a[c],a[c]=d)};if(c("zoom","startZoom"),c("pan","startPan"),c("position","startPosition"),a.style)for(var d=0;d<a.style.length;d++){var e=a.style[d],f=e.name,g=a.startStyle[f];a.startStyle[f]=e,a.style[d]=g}return b&&this.play(),this},promise:function(a){var b,c=this._private;return b="frame"===a?c.frames:c.completes,new uO(function(a,c){b.push(function(){a()})})}}),uQ.complete=uQ.completed,uQ.run=uQ.play,uQ.running=uQ.playing;var u0=rX(function(){if(zT)return zS;zT=1;var a=function(){if(zR)return zQ;zR=1;var a=u$(),b=u_();return zQ=function(c,d){d=a(d,c);for(var e=0,f=d.length;null!=c&&e<f;)c=c[b(d[e++])];return e&&e==f?c:void 0}}();return zS=function(b,c,d){var e=null==b?void 0:a(b,c);return void 0===e?d:e}}()),u1=rX(function(){if(z3)return z2;z3=1;var a=function(){if(z1)return z0;z1=1;var a=function(){if(zZ)return zY;zZ=1;var a=function(){if(zX)return zW;zX=1;var a=function(){if(zV)return zU;zV=1;var a=uS();return zU=function(){try{var b=a(Object,"defineProperty");return b({},"",{}),b}catch(a){}}()}();return zW=function(b,c,d){"__proto__"==c&&a?a(b,c,{configurable:!0,enumerable:!0,value:d,writable:!0}):b[c]=d}}(),b=uU(),c=Object.prototype.hasOwnProperty;return zY=function(d,e,f){var g=d[e];c.call(d,e)&&b(g,f)&&(void 0!==f||e in d)||a(d,e,f)}}(),b=u$(),c=function(){if(z_)return z$;z_=1;var a=/^(?:0|[1-9]\d*)$/;return z$=function(b,c){var d=typeof b;return!!(c=null==c?0x1fffffffffffff:c)&&("number"==d||"symbol"!=d&&a.test(b))&&b>-1&&b%1==0&&b<c}}(),d=rY(),e=u_();return z0=function(f,g,h,i){if(!d(f))return f;g=b(g,f);for(var j=-1,k=g.length,l=k-1,n=f;null!=n&&++j<k;){var o=e(g[j]),p=h;if("__proto__"===o||"constructor"===o||"prototype"===o)break;if(j!=l){var q=n[o];void 0===(p=i?i(q,o,n):void 0)&&(p=d(q)?q:c(g[j+1])?[]:{})}a(n,o,p),n=n[o]}return f}}();return z2=function(b,c,d){return null==b?b:a(b,c,d)}}()),u2=rX(function(){if(z7)return z6;z7=1;var a=uY(),b=z5?z4:(z5=1,z4=function(a,b){var c=-1,d=a.length;for(b||(b=Array(d));++c<d;)b[c]=a[c];return b}),c=uR(),d=r0(),e=uX(),f=u_(),g=uZ();return z6=function(h){return c(h)?a(h,f):d(h)?[h]:b(e(g(h)))}}()),u3={};[{animated:function(){return function(){var a=void 0!==this.length;if(!(this._private.cy||this).styleEnabled())return!1;var b=(a?this:[this])[0];if(b)return b._private.animation.current.length>0}},clearQueue:function(){return function(){var a=void 0!==this.length?this:[this];if(!(this._private.cy||this).styleEnabled())return this;for(var b=0;b<a.length;b++)a[b]._private.animation.queue=[];return this}},delay:function(){return function(a,b){return(this._private.cy||this).styleEnabled()?this.animate({delay:a,duration:a,complete:b}):this}},delayAnimation:function(){return function(a,b){return(this._private.cy||this).styleEnabled()?this.animation({delay:a,duration:a,complete:b}):this}},animation:function(){return function(a,b){var c=void 0!==this.length,d=c?this:[this],e=this._private.cy||this,f=!c,g=!f;if(!e.styleEnabled())return this;var h=e.style();if(0===Object.keys(a=rO({},a,b)).length)return new uP(d[0],a);switch(void 0===a.duration&&(a.duration=400),a.duration){case"slow":a.duration=600;break;case"fast":a.duration=200}if(g&&(a.style=h.getPropsList(a.style||a.css),a.css=void 0),g&&null!=a.renderedPosition){var i=a.renderedPosition,j=e.pan(),k=e.zoom();a.position=sR(i,k,j)}if(f&&null!=a.panBy){var l=a.panBy,n=e.pan();a.pan={x:n.x+l.x,y:n.y+l.y}}var o=a.center||a.centre;if(f&&null!=o){var p=e.getCenterPan(o.eles,a.zoom);null!=p&&(a.pan=p)}if(f&&null!=a.fit){var q=a.fit,r=e.getFitViewport(q.eles||q.boundingBox,q.padding);null!=r&&(a.pan=r.pan,a.zoom=r.zoom)}if(f&&rs(a.zoom)){var s=e.getZoomedViewport(a.zoom);null!=s?(s.zoomed&&(a.zoom=s.zoom),s.panned&&(a.pan=s.pan)):a.zoom=null}return new uP(d[0],a)}},animate:function(){return function(a,b){var c=void 0!==this.length?this:[this];if(!(this._private.cy||this).styleEnabled())return this;b&&(a=rO({},a,b));for(var d=0;d<c.length;d++){var e=c[d],f=e.animated()&&(void 0===a.queue||a.queue);e.animation(a,f?{queue:!0}:void 0).play()}return this}},stop:function(){return function(a,b){var c=void 0!==this.length?this:[this],d=this._private.cy||this;if(!d.styleEnabled())return this;for(var e=0;e<c.length;e++){for(var f=c[e]._private,g=f.animation.current,h=0;h<g.length;h++){var i=g[h]._private;b&&(i.duration=0)}a&&(f.animation.queue=[]),b||(f.animation.current=[])}return d.notify("draw"),this}}},{data:function(a){return a=rO({},{field:"data",bindingEvent:"data",allowBinding:!1,allowSetting:!1,allowGetting:!1,settingEvent:"data",settingTriggersEvent:!1,triggerFnName:"trigger",immutableKeys:{},updateStyle:!1,beforeGet:function(a){},beforeSet:function(a,b){},onSet:function(a){},canSet:function(a){return!0}},a),function(b,c){var d,e=a,f=void 0!==this.length,g=f?this:[this],h=f?this[0]:this;if(rp(b)){var i,j=-1!==b.indexOf(".")&&u2(b);if(e.allowGetting&&void 0===c)return h&&(e.beforeGet(h),i=j&&void 0===h._private[e.field][b]?u0(h._private[e.field],j):h._private[e.field][b]),i;if(e.allowSetting&&void 0!==c&&!e.immutableKeys[b]){var k=re({},b,c);e.beforeSet(this,k);for(var l=0,n=g.length;l<n;l++){var o=g[l];e.canSet(o)&&(j&&void 0===h._private[e.field][b]?u1(o._private[e.field],j,c):o._private[e.field][b]=c)}e.updateStyle&&this.updateStyle(),e.onSet(this),e.settingTriggersEvent&&this[e.triggerFnName](e.settingEvent)}}else if(e.allowSetting&&rs(b)){var p,q,r=Object.keys(b);e.beforeSet(this,b);for(var s=0;s<r.length;s++)if(q=b[p=r[s]],!e.immutableKeys[p])for(var t=0;t<g.length;t++){var u=g[t];e.canSet(u)&&(u._private[e.field][p]=q)}e.updateStyle&&this.updateStyle(),e.onSet(this),e.settingTriggersEvent&&this[e.triggerFnName](e.settingEvent)}else if(e.allowBinding&&rq(b))this.on(e.bindingEvent,b);else if(e.allowGetting&&void 0===b)return h&&(e.beforeGet(h),d=h._private[e.field]),d;return this}},removeData:function(a){return a=rO({},{field:"data",event:"data",triggerFnName:"trigger",triggerEvent:!1,immutableKeys:{}},a),function(b){var c=a,d=void 0!==this.length?this:[this];if(rp(b)){for(var e=b.split(/\s+/),f=e.length,g=0;g<f;g++){var h=e[g];if(!rA(h)&&!c.immutableKeys[h])for(var i=0,j=d.length;i<j;i++)d[i]._private[c.field][h]=void 0}c.triggerEvent&&this[c.triggerFnName](c.event)}else if(void 0===b){for(var k=0,l=d.length;k<l;k++)for(var n=d[k]._private[c.field],o=Object.keys(n),p=0;p<o.length;p++){var q=o[p];c.immutableKeys[q]||(n[q]=void 0)}c.triggerEvent&&this[c.triggerFnName](c.event)}return this}}},{eventAliasesOn:function(a){a.addListener=a.listen=a.bind=a.on,a.unlisten=a.unbind=a.off=a.removeListener,a.trigger=a.emit,a.pon=a.promiseOn=function(a,b){var c=this,d=Array.prototype.slice.call(arguments,0);return new uO(function(a,b){var e=d.concat([function(b){c.off.apply(c,f),a(b)}]),f=e.concat([]);c.on.apply(c,e)})}}}].forEach(function(a){rO(u3,a)});var u4={animate:u3.animate(),animation:u3.animation(),animated:u3.animated(),clearQueue:u3.clearQueue(),delay:u3.delay(),delayAnimation:u3.delayAnimation(),stop:u3.stop()},u5={classes:function(a){if(void 0===a){var b=[];return this[0]._private.classes.forEach(function(a){return b.push(a)}),b}rr(a)||(a=(a||"").match(/\S+/g)||[]);for(var c=[],d=new sC(a),e=0;e<this.length;e++){for(var f=this[e],g=f._private,h=g.classes,i=!1,j=0;j<a.length;j++){var k=a[j];if(!h.has(k)){i=!0;break}}i||(i=h.size!==a.length),i&&(g.classes=d,c.push(f))}return c.length>0&&this.spawn(c).updateStyle().emit("class"),this},addClass:function(a){return this.toggleClass(a,!0)},hasClass:function(a){var b=this[0];return null!=b&&b._private.classes.has(a)},toggleClass:function(a,b){rr(a)||(a=a.match(/\S+/g)||[]);for(var c=void 0===b,d=[],e=0,f=this.length;e<f;e++)for(var g=this[e],h=g._private.classes,i=!1,j=0;j<a.length;j++){var k=a[j],l=h.has(k),n=!1;b||c&&!l?(h.add(k),n=!0):(!b||c&&l)&&(h.delete(k),n=!0),!i&&n&&(d.push(g),i=!0)}return d.length>0&&this.spawn(d).updateStyle().emit("class"),this},removeClass:function(a){return this.toggleClass(a,!1)},flashClass:function(a,b){var c=this;if(null==b)b=250;else if(0===b)return c;return c.addClass(a),setTimeout(function(){c.removeClass(a)},b),c}};u5.className=u5.classNames=u5.classes;var u6={metaChar:"[\\!\\\"\\#\\$\\%\\&\\'\\(\\)\\*\\+\\,\\.\\/\\:\\;\\<\\=\\>\\?\\@\\[\\]\\^\\`\\{\\|\\}\\~]",comparatorOp:"=|\\!=|>|>=|<|<=|\\$=|\\^=|\\*=",boolOp:"\\?|\\!|\\^",string:"\"(?:\\\\\"|[^\"])*\"|'(?:\\\\'|[^'])*'",number:rI,meta:"degree|indegree|outdegree",separator:"\\s*,\\s*",descendant:"\\s+",child:"\\s+>\\s+",subject:"\\$",group:"node|edge|\\*",directedEdge:"\\s+->\\s+",undirectedEdge:"\\s+<->\\s+"};for(xU=0,u6.variable="(?:[\\w-.]|(?:\\\\"+u6.metaChar+"))+",u6.className="(?:[\\w-]|(?:\\\\"+u6.metaChar+"))+",u6.value=u6.string+"|"+u6.number,u6.id=u6.variable,xS=u6.comparatorOp.split("|");xU<xS.length;xU++)xT=xS[xU],u6.comparatorOp+="|@"+xT;for(xU=0,xS=u6.comparatorOp.split("|");xU<xS.length;xU++)(xT=xS[xU]).indexOf("!")>=0||"="!==xT&&(u6.comparatorOp+="|\\!"+xT);var u7=function(){return{checks:[]}},u8=[{selector:":selected",matches:function(a){return a.selected()}},{selector:":unselected",matches:function(a){return!a.selected()}},{selector:":selectable",matches:function(a){return a.selectable()}},{selector:":unselectable",matches:function(a){return!a.selectable()}},{selector:":locked",matches:function(a){return a.locked()}},{selector:":unlocked",matches:function(a){return!a.locked()}},{selector:":visible",matches:function(a){return a.visible()}},{selector:":hidden",matches:function(a){return!a.visible()}},{selector:":transparent",matches:function(a){return a.transparent()}},{selector:":grabbed",matches:function(a){return a.grabbed()}},{selector:":free",matches:function(a){return!a.grabbed()}},{selector:":removed",matches:function(a){return a.removed()}},{selector:":inside",matches:function(a){return!a.removed()}},{selector:":grabbable",matches:function(a){return a.grabbable()}},{selector:":ungrabbable",matches:function(a){return!a.grabbable()}},{selector:":animated",matches:function(a){return a.animated()}},{selector:":unanimated",matches:function(a){return!a.animated()}},{selector:":parent",matches:function(a){return a.isParent()}},{selector:":childless",matches:function(a){return a.isChildless()}},{selector:":child",matches:function(a){return a.isChild()}},{selector:":orphan",matches:function(a){return a.isOrphan()}},{selector:":nonorphan",matches:function(a){return a.isChild()}},{selector:":compound",matches:function(a){return a.isNode()?a.isParent():a.source().isParent()||a.target().isParent()}},{selector:":loop",matches:function(a){return a.isLoop()}},{selector:":simple",matches:function(a){return a.isSimple()}},{selector:":active",matches:function(a){return a.active()}},{selector:":inactive",matches:function(a){return!a.active()}},{selector:":backgrounding",matches:function(a){return a.backgrounding()}},{selector:":nonbackgrounding",matches:function(a){return!a.backgrounding()}}].sort(function(a,b){return -1*rN(a.selector,b.selector)}),u9=function(){for(var a,b={},c=0;c<u8.length;c++)b[(a=u8[c]).selector]=a.matches;return b}(),va="("+u8.map(function(a){return a.selector}).join("|")+")",vb=function(a){return a.replace(RegExp("\\\\("+u6.metaChar+")","g"),function(a,b){return b})},vc=function(a,b,c){a[a.length-1]=c},vd=[{name:"group",query:!0,regex:"("+u6.group+")",populate:function(a,b,c){var d=rf(c,1)[0];b.checks.push({type:0,value:"*"===d?d:d+"s"})}},{name:"state",query:!0,regex:va,populate:function(a,b,c){var d=rf(c,1)[0];b.checks.push({type:7,value:d})}},{name:"id",query:!0,regex:"\\#("+u6.id+")",populate:function(a,b,c){var d=rf(c,1)[0];b.checks.push({type:8,value:vb(d)})}},{name:"className",query:!0,regex:"\\.("+u6.className+")",populate:function(a,b,c){var d=rf(c,1)[0];b.checks.push({type:9,value:vb(d)})}},{name:"dataExists",query:!0,regex:"\\[\\s*("+u6.variable+")\\s*\\]",populate:function(a,b,c){var d=rf(c,1)[0];b.checks.push({type:4,field:vb(d)})}},{name:"dataCompare",query:!0,regex:"\\[\\s*("+u6.variable+")\\s*("+u6.comparatorOp+")\\s*("+u6.value+")\\s*\\]",populate:function(a,b,c){var d=rf(c,3),e=d[0],f=d[1],g=d[2];g=null!=RegExp("^"+u6.string+"$").exec(g)?g.substring(1,g.length-1):parseFloat(g),b.checks.push({type:3,field:vb(e),operator:f,value:g})}},{name:"dataBool",query:!0,regex:"\\[\\s*("+u6.boolOp+")\\s*("+u6.variable+")\\s*\\]",populate:function(a,b,c){var d=rf(c,2),e=d[0],f=d[1];b.checks.push({type:5,field:vb(f),operator:e})}},{name:"metaCompare",query:!0,regex:"\\[\\[\\s*("+u6.meta+")\\s*("+u6.comparatorOp+")\\s*("+u6.number+")\\s*\\]\\]",populate:function(a,b,c){var d=rf(c,3),e=d[0],f=d[1],g=d[2];b.checks.push({type:6,field:vb(e),operator:f,value:parseFloat(g)})}},{name:"nextQuery",separator:!0,regex:u6.separator,populate:function(a,b){var c=a.currentSubject,d=a.edgeCount,e=a.compoundCount,f=a[a.length-1];return null!=c&&(f.subject=c,a.currentSubject=null),f.edgeCount=d,f.compoundCount=e,a.edgeCount=0,a.compoundCount=0,a[a.length++]=u7()}},{name:"directedEdge",separator:!0,regex:u6.directedEdge,populate:function(a,b){if(null==a.currentSubject){var c=u7(),d=u7();return c.checks.push({type:11,source:b,target:d}),vc(a,b,c),a.edgeCount++,d}var e=u7(),f=u7();return e.checks.push({type:12,source:b,target:f}),vc(a,b,e),a.edgeCount++,f}},{name:"undirectedEdge",separator:!0,regex:u6.undirectedEdge,populate:function(a,b){if(null==a.currentSubject){var c=u7(),d=u7();return c.checks.push({type:10,nodes:[b,d]}),vc(a,b,c),a.edgeCount++,d}var e=u7(),f=u7();return e.checks.push({type:14,node:b,neighbor:f}),vc(a,b,e),f}},{name:"child",separator:!0,regex:u6.child,populate:function(a,b){if(null==a.currentSubject){var c=u7(),d=u7(),e=a[a.length-1];return c.checks.push({type:15,parent:e,child:d}),vc(a,b,c),a.compoundCount++,d}if(a.currentSubject===b){var f=u7(),g=a[a.length-1],h=u7(),i=u7(),j=u7(),k=u7();return f.checks.push({type:19,left:g,right:h,subject:i}),i.checks=b.checks,b.checks=[{type:20}],k.checks.push({type:20}),h.checks.push({type:17,parent:k,child:j}),vc(a,g,f),a.currentSubject=i,a.compoundCount++,j}var l=u7(),n=u7(),o=[{type:17,parent:l,child:n}];return l.checks=b.checks,b.checks=o,a.compoundCount++,n}},{name:"descendant",separator:!0,regex:u6.descendant,populate:function(a,b){if(null==a.currentSubject){var c=u7(),d=u7(),e=a[a.length-1];return c.checks.push({type:16,ancestor:e,descendant:d}),vc(a,b,c),a.compoundCount++,d}if(a.currentSubject===b){var f=u7(),g=a[a.length-1],h=u7(),i=u7(),j=u7(),k=u7();return f.checks.push({type:19,left:g,right:h,subject:i}),i.checks=b.checks,b.checks=[{type:20}],k.checks.push({type:20}),h.checks.push({type:18,ancestor:k,descendant:j}),vc(a,g,f),a.currentSubject=i,a.compoundCount++,j}var l=u7(),n=u7(),o=[{type:18,ancestor:l,descendant:n}];return l.checks=b.checks,b.checks=o,a.compoundCount++,n}},{name:"subject",modifier:!0,regex:u6.subject,populate:function(a,b){if(null!=a.currentSubject&&a.currentSubject!==b)return so("Redefinition of subject in selector `"+a.toString()+"`"),!1;a.currentSubject=b;var c=a[a.length-1].checks[0],d=null==c?null:c.type;11===d?c.type=13:10===d&&(c.type=14,c.node=c.nodes[1],c.neighbor=c.nodes[0],c.nodes=null)}}];vd.forEach(function(a){return a.regexObj=RegExp("^"+a.regex)});var ve=function(a){for(var b,c,d,e=0;e<vd.length;e++){var f=vd[e],g=f.name,h=a.match(f.regexObj);if(null!=h){c=h,b=f,d=g;var i=h[0];a=a.substring(i.length);break}}return{expr:b,match:c,name:d,remaining:a}},vf=function(a){var b=a.match(/^\s+/);if(b){var c=b[0];a=a.substring(c.length)}return a},vg=function(a,b,c){var d,e,f,g=rp(a),h=rt(a),i=rp(c),j=!1,k=!1,l=!1;switch(b.indexOf("!")>=0&&(b=b.replace("!",""),k=!0),b.indexOf("@")>=0&&(b=b.replace("@",""),j=!0),(g||i||j)&&(e=g||h?""+a:"",f=""+c),j&&(a=e=e.toLowerCase(),c=f=f.toLowerCase()),b){case"*=":d=e.indexOf(f)>=0;break;case"$=":d=e.indexOf(f,e.length-f.length)>=0;break;case"^=":d=0===e.indexOf(f);break;case"=":d=a===c;break;case">":l=!0,d=a>c;break;case">=":l=!0,d=a>=c;break;case"<":l=!0,d=a<c;break;case"<=":l=!0,d=a<=c;break;default:d=!1}return k&&(null!=a||!l)&&(d=!d),d},vh=function(a,b){switch(b){case"?":return!!a;case"!":return!a;case"^":return void 0===a}},vi=function(a,b){return a.data(b)},vj=[],vk=function(a,b){return a.checks.every(function(a){return vj[a.type](a,b)})};vj[0]=function(a,b){var c=a.value;return"*"===c||c===b.group()},vj[7]=function(a,b){var c;return c=a.value,u9[c](b)},vj[8]=function(a,b){var c=a.value;return b.id()===c},vj[9]=function(a,b){var c=a.value;return b.hasClass(c)},vj[6]=function(a,b){var c=a.field,d=a.operator,e=a.value;return vg(b[c](),d,e)},vj[3]=function(a,b){var c=a.field,d=a.operator,e=a.value;return vg(vi(b,c),d,e)},vj[5]=function(a,b){var c=a.field,d=a.operator;return vh(vi(b,c),d)},vj[4]=function(a,b){var c=a.field;return a.operator,void 0!==vi(b,c)},vj[10]=function(a,b){var c=a.nodes[0],d=a.nodes[1],e=b.source(),f=b.target();return vk(c,e)&&vk(d,f)||vk(d,e)&&vk(c,f)},vj[14]=function(a,b){return vk(a.node,b)&&b.neighborhood().some(function(b){return b.isNode()&&vk(a.neighbor,b)})},vj[11]=function(a,b){return vk(a.source,b.source())&&vk(a.target,b.target())},vj[12]=function(a,b){return vk(a.source,b)&&b.outgoers().some(function(b){return b.isNode()&&vk(a.target,b)})},vj[13]=function(a,b){return vk(a.target,b)&&b.incomers().some(function(b){return b.isNode()&&vk(a.source,b)})},vj[15]=function(a,b){return vk(a.child,b)&&vk(a.parent,b.parent())},vj[17]=function(a,b){return vk(a.parent,b)&&b.children().some(function(b){return vk(a.child,b)})},vj[16]=function(a,b){return vk(a.descendant,b)&&b.ancestors().some(function(b){return vk(a.ancestor,b)})},vj[18]=function(a,b){return vk(a.ancestor,b)&&b.descendants().some(function(b){return vk(a.descendant,b)})},vj[19]=function(a,b){return vk(a.subject,b)&&vk(a.left,b)&&vk(a.right,b)},vj[20]=function(){return!0},vj[1]=function(a,b){return a.value.has(b)},vj[2]=function(a,b){return(0,a.value)(b)};var vl=function(a){this.inputText=a,this.currentSubject=null,this.compoundCount=0,this.edgeCount=0,this.length=0,null==a||rp(a)&&a.match(/^\s*$/)||(rv(a)?this.addQuery({checks:[{type:1,value:a.collection()}]}):rq(a)?this.addQuery({checks:[{type:2,value:a}]}):rp(a)?this.parse(a)||(this.invalid=!0):sm("A selector must be created from a string; found "))},vm=vl.prototype;[{parse:function(a){var b=this.inputText=a,c=this[0]=u7();for(this.length=1,b=vf(b);;){var d=ve(b);if(null==d.expr)return so("The selector `"+a+"`is invalid"),!1;var e=d.match.slice(1),f=d.expr.populate(this,c,e);if(!1===f)return!1;if(null!=f&&(c=f),(b=d.remaining).match(/^\s*$/))break}var g=this[this.length-1];null!=this.currentSubject&&(g.subject=this.currentSubject),g.edgeCount=this.edgeCount,g.compoundCount=this.compoundCount;for(var h=0;h<this.length;h++){var i=this[h];if(i.compoundCount>0&&i.edgeCount>0)return so("The selector `"+a+"` is invalid because it uses both a compound selector and an edge selector"),!1;if(i.edgeCount>1)return so("The selector `"+a+"` is invalid because it uses multiple edge selectors"),!1;1===i.edgeCount&&so("The selector `"+a+"` is deprecated.  Edge selectors do not take effect on changes to source and target nodes after an edge is added, for performance reasons.  Use a class or data selector on edges instead, updating the class or data of an edge when your app detects a change in source or target nodes.")}return!0},toString:function(){if(null!=this.toStringCache)return this.toStringCache;for(var a=function(a){return null==a?"":a},b=function(b){return rp(b)?'"'+b+'"':a(b)},c=function(a){return" "+a+" "},d=function(d,f){var g=d.type,h=d.value;switch(g){case 0:var i=a(h);return i.substring(0,i.length-1);case 3:return"["+d.field+c(a(d.operator))+b(h)+"]";case 5:var j=d.operator,k=d.field;return"["+a(j)+k+"]";case 4:return"["+d.field+"]";case 6:var l=d.operator;return"[["+d.field+c(a(l))+b(h)+"]]";case 7:return h;case 8:return"#"+h;case 9:return"."+h;case 17:case 15:return e(d.parent,f)+c(">")+e(d.child,f);case 18:case 16:return e(d.ancestor,f)+" "+e(d.descendant,f);case 19:var n=e(d.left,f),o=e(d.subject,f),p=e(d.right,f);return n+(n.length>0?" ":"")+o+p;case 20:return""}},e=function(a,b){return a.checks.reduce(function(c,e,f){return c+(b===a&&0===f?"$":"")+d(e,b)},"")},f="",g=0;g<this.length;g++){var h=this[g];f+=e(h,h.subject),this.length>1&&g<this.length-1&&(f+=", ")}return this.toStringCache=f,f}},{matches:function(a){for(var b=0;b<this.length;b++)if(vk(this[b],a))return!0;return!1},filter:function(a){var b=this;if(1===b.length&&1===b[0].checks.length&&8===b[0].checks[0].type)return a.getElementById(b[0].checks[0].value).collection();var c=function(a){for(var c=0;c<b.length;c++)if(vk(b[c],a))return!0;return!1};return null==b.text()&&(c=function(){return!0}),a.filter(c)}}].forEach(function(a){return rO(vm,a)}),vm.text=function(){return this.inputText},vm.size=function(){return this.length},vm.eq=function(a){return this[a]},vm.sameText=function(a){return!this.invalid&&!a.invalid&&this.text()===a.text()},vm.addQuery=function(a){this[this.length++]=a},vm.selector=vm.toString;var vn={allAre:function(a){var b=new vl(a);return this.every(function(a){return b.matches(a)})},is:function(a){var b=new vl(a);return this.some(function(a){return b.matches(a)})},some:function(a,b){for(var c=0;c<this.length;c++)if(b?a.apply(b,[this[c],c,this]):a(this[c],c,this))return!0;return!1},every:function(a,b){for(var c=0;c<this.length;c++)if(!(b?a.apply(b,[this[c],c,this]):a(this[c],c,this)))return!1;return!0},same:function(a){if(this===a)return!0;a=this.cy().collection(a);var b=this.length;return b===a.length&&(1===b?this[0]===a[0]:this.every(function(b){return a.hasElementWithId(b.id())}))},anySame:function(a){return a=this.cy().collection(a),this.some(function(b){return a.hasElementWithId(b.id())})},allAreNeighbors:function(a){a=this.cy().collection(a);var b=this.neighborhood();return a.every(function(a){return b.hasElementWithId(a.id())})},contains:function(a){a=this.cy().collection(a);var b=this;return a.every(function(a){return b.hasElementWithId(a.id())})}};vn.allAreNeighbours=vn.allAreNeighbors,vn.has=vn.contains,vn.equal=vn.equals=vn.same;var vo=function(a,b){return function(c,d,e,f){if(null==c?g="":rv(c)&&1===c.length&&(g=c.id()),1!==this.length||!g)return a.call(this,c,d,e,f);var g,h=this[0]._private,i=h.traversalCache=h.traversalCache||{},j=i[b]=i[b]||[],k=sb(g),l=j[k];return l||(j[k]=a.call(this,c,d,e,f))}},vp={parent:function(a){var b=[];if(1===this.length){var c=this[0]._private.parent;if(c)return c}for(var d=0;d<this.length;d++){var e=this[d]._private.parent;e&&b.push(e)}return this.spawn(b,!0).filter(a)},parents:function(a){for(var b=[],c=this.parent();c.nonempty();){for(var d=0;d<c.length;d++){var e=c[d];b.push(e)}c=c.parent()}return this.spawn(b,!0).filter(a)},commonAncestors:function(a){for(var b,c=0;c<this.length;c++){var d=this[c].parents();b=(b=b||d).intersect(d)}return b.filter(a)},orphans:function(a){return this.stdFilter(function(a){return a.isOrphan()}).filter(a)},nonorphans:function(a){return this.stdFilter(function(a){return a.isChild()}).filter(a)},children:vo(function(a){for(var b=[],c=0;c<this.length;c++)for(var d=this[c]._private.children,e=0;e<d.length;e++)b.push(d[e]);return this.spawn(b,!0).filter(a)},"children"),siblings:function(a){return this.parent().children().not(this).filter(a)},isParent:function(){var a=this[0];if(a)return a.isNode()&&0!==a._private.children.length},isChildless:function(){var a=this[0];if(a)return a.isNode()&&0===a._private.children.length},isChild:function(){var a=this[0];if(a)return a.isNode()&&null!=a._private.parent},isOrphan:function(){var a=this[0];if(a)return a.isNode()&&null==a._private.parent},descendants:function(a){var b=[];return!function a(c){for(var d=0;d<c.length;d++){var e=c[d];b.push(e),e.children().nonempty()&&a(e.children())}}(this.children()),this.spawn(b,!0).filter(a)}};function vq(a,b,c,d){for(var e=[],f=new sC,g=a.cy().hasCompoundNodes(),h=0;h<a.length;h++){var i=a[h];c?e.push(i):g&&d(e,f,i)}for(;e.length>0;){var j=e.shift();b(j),f.add(j.id()),g&&d(e,f,j)}return a}function vr(a,b,c){if(c.isParent())for(var d=c._private.children,e=0;e<d.length;e++){var f=d[e];b.has(f.id())||a.push(f)}}function vs(a,b,c){if(c.isChild()){var d=c._private.parent;b.has(d.id())||a.push(d)}}function vt(a,b,c){vs(a,b,c),vr(a,b,c)}vp.forEachDown=function(a){var b=!(arguments.length>1)||void 0===arguments[1]||arguments[1];return vq(this,a,b,vr)},vp.forEachUp=function(a){var b=!(arguments.length>1)||void 0===arguments[1]||arguments[1];return vq(this,a,b,vs)},vp.forEachUpAndDown=function(a){var b=!(arguments.length>1)||void 0===arguments[1]||arguments[1];return vq(this,a,b,vt)},vp.ancestors=vp.parents,(z8=z9={data:u3.data({field:"data",bindingEvent:"data",allowBinding:!0,allowSetting:!0,settingEvent:"data",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0,immutableKeys:{id:!0,source:!0,target:!0,parent:!0},updateStyle:!0}),removeData:u3.removeData({field:"data",event:"data",triggerFnName:"trigger",triggerEvent:!0,immutableKeys:{id:!0,source:!0,target:!0,parent:!0},updateStyle:!0}),scratch:u3.data({field:"scratch",bindingEvent:"scratch",allowBinding:!0,allowSetting:!0,settingEvent:"scratch",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0,updateStyle:!0}),removeScratch:u3.removeData({field:"scratch",event:"scratch",triggerFnName:"trigger",triggerEvent:!0,updateStyle:!0}),rscratch:u3.data({field:"rscratch",allowBinding:!1,allowSetting:!0,settingTriggersEvent:!1,allowGetting:!0}),removeRscratch:u3.removeData({field:"rscratch",triggerEvent:!1}),id:function(){var a=this[0];if(a)return a._private.data.id}}).attr=z8.data,z8.removeAttr=z8.removeData;var vu={};function vv(a){return function(b){if(void 0===b&&(b=!0),0!==this.length)if(!this.isNode()||this.removed())return;else{for(var c=0,d=this[0],e=d._private.edges,f=0;f<e.length;f++){var g=e[f];!b&&g.isLoop()||(c+=a(d,g))}return c}}}function vw(a,b){return function(c){for(var d,e=this.nodes(),f=0;f<e.length;f++){var g=e[f][a](c);void 0!==g&&(void 0===d||b(g,d))&&(d=g)}return d}}rO(vu,{degree:vv(function(a,b){return b.source().same(b.target())?2:1}),indegree:vv(function(a,b){return+!!b.target().same(a)}),outdegree:vv(function(a,b){return+!!b.source().same(a)})}),rO(vu,{minDegree:vw("degree",function(a,b){return a<b}),maxDegree:vw("degree",function(a,b){return a>b}),minIndegree:vw("indegree",function(a,b){return a<b}),maxIndegree:vw("indegree",function(a,b){return a>b}),minOutdegree:vw("outdegree",function(a,b){return a<b}),maxOutdegree:vw("outdegree",function(a,b){return a>b})}),rO(vu,{totalDegree:function(a){for(var b=0,c=this.nodes(),d=0;d<c.length;d++)b+=c[d].degree(a);return b}});var vx=function(a,b,c){for(var d=0;d<a.length;d++){var e=a[d];if(!e.locked()){var f=e._private.position,g={x:null!=b.x?b.x-f.x:0,y:null!=b.y?b.y-f.y:0};e.isParent()&&(0!==g.x||0!==g.y)&&e.children().shift(g,c),e.dirtyBoundingBoxCache()}}},vy={field:"position",bindingEvent:"position",allowBinding:!0,allowSetting:!0,settingEvent:"position",settingTriggersEvent:!0,triggerFnName:"emitAndNotify",allowGetting:!0,validKeys:["x","y"],beforeGet:function(a){a.updateCompoundBounds()},beforeSet:function(a,b){vx(a,b,!1)},onSet:function(a){a.dirtyCompoundBoundsCache()},canSet:function(a){return!a.locked()}};(Aa=Ab={position:u3.data(vy),silentPosition:u3.data(rO({},vy,{allowBinding:!1,allowSetting:!0,settingTriggersEvent:!1,allowGetting:!1,beforeSet:function(a,b){vx(a,b,!0)},onSet:function(a){a.dirtyCompoundBoundsCache()}})),positions:function(a,b){if(rs(a))b?this.silentPosition(a):this.position(a);else if(rq(a)){var c=this.cy();c.startBatch();for(var d=0;d<this.length;d++){var e=this[d],f=void 0;(f=a(e,d))&&(b?e.silentPosition(f):e.position(f))}c.endBatch()}return this},silentPositions:function(a){return this.positions(a,!0)},shift:function(a,b,c){var d;if(rs(a)?(d={x:rt(a.x)?a.x:0,y:rt(a.y)?a.y:0},c=b):rp(a)&&rt(b)&&((d={x:0,y:0})[a]=b),null!=d){var e=this.cy();e.startBatch();for(var f=0;f<this.length;f++){var g=this[f];if(!(e.hasCompoundNodes()&&g.isChild()&&g.ancestors().anySame(this))){var h=g.position(),i={x:h.x+d.x,y:h.y+d.y};c?g.silentPosition(i):g.position(i)}}e.endBatch()}return this},silentShift:function(a,b){return rs(a)?this.shift(a,!0):rp(a)&&rt(b)&&this.shift(a,b,!0),this},renderedPosition:function(a,b){var c=this[0],d=this.cy(),e=d.zoom(),f=d.pan(),g=rs(a)?a:void 0,h=void 0!==g||void 0!==b&&rp(a);if(c&&c.isNode())if(!h)return(g=sQ(c.position(),e,f),void 0===a)?g:g[a];else for(var i=0;i<this.length;i++){var j=this[i];void 0!==b?j.position(a,(b-f[a])/e):void 0!==g&&j.position(sR(g,e,f))}else if(!h)return;return this},relativePosition:function(a,b){var c=this[0],d=this.cy(),e=rs(a)?a:void 0,f=void 0!==e||void 0!==b&&rp(a),g=d.hasCompoundNodes();if(c&&c.isNode())if(f)for(var h=0;h<this.length;h++){var i=this[h],j=g?i.parent():null,k=j&&j.length>0;k&&(j=j[0]);var l=k?j.position():{x:0,y:0};void 0!==b?i.position(a,b+l[a]):void 0!==e&&i.position({x:e.x+l.x,y:e.y+l.y})}else{var n=c.position(),o=g?c.parent():null,p=o&&o.length>0;p&&(o=o[0]);var q=p?o.position():{x:0,y:0};return(e={x:n.x-q.x,y:n.y-q.y},void 0===a)?e:e[a]}else if(!f)return;return this}}).modelPosition=Aa.point=Aa.position,Aa.modelPositions=Aa.points=Aa.positions,Aa.renderedPoint=Aa.renderedPosition,Aa.relativePoint=Aa.relativePosition,Ac=Ad={},Ad.renderedBoundingBox=function(a){var b=this.boundingBox(a),c=this.cy(),d=c.zoom(),e=c.pan(),f=b.x1*d+e.x,g=b.x2*d+e.x,h=b.y1*d+e.y,i=b.y2*d+e.y;return{x1:f,x2:g,y1:h,y2:i,w:g-f,h:i-h}},Ad.dirtyCompoundBoundsCache=function(){var a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=this.cy();return b.styleEnabled()&&b.hasCompoundNodes()&&this.forEachUp(function(b){if(b.isParent()){var c=b._private;c.compoundBoundsClean=!1,c.bbCache=null,a||b.emitAndNotify("bounds")}}),this},Ad.updateCompoundBounds=function(){var a=arguments.length>0&&void 0!==arguments[0]&&arguments[0],b=this.cy();if(!b.styleEnabled()||!b.hasCompoundNodes()||!a&&b.batching())return this;for(var c=0;c<this.length;c++){var d=this[c],e=d._private;(!e.compoundBoundsClean||a)&&(!function(a){if(a.isParent()){var b=a._private,c=a.children(),d="include"===a.pstyle("compound-sizing-wrt-labels").value,e={width:{val:a.pstyle("min-width").pfValue,left:a.pstyle("min-width-bias-left"),right:a.pstyle("min-width-bias-right")},height:{val:a.pstyle("min-height").pfValue,top:a.pstyle("min-height-bias-top"),bottom:a.pstyle("min-height-bias-bottom")}},f=c.boundingBox({includeLabels:d,includeOverlays:!1,useCache:!1}),g=b.position;(0===f.w||0===f.h)&&((f={w:a.pstyle("width").pfValue,h:a.pstyle("height").pfValue}).x1=g.x-f.w/2,f.x2=g.x+f.w/2,f.y1=g.y-f.h/2,f.y2=g.y+f.h/2);var h=e.width.left.value;"px"===e.width.left.units&&e.width.val>0&&(h=100*h/e.width.val);var i=e.width.right.value;"px"===e.width.right.units&&e.width.val>0&&(i=100*i/e.width.val);var j=e.height.top.value;"px"===e.height.top.units&&e.height.val>0&&(j=100*j/e.height.val);var k=e.height.bottom.value;"px"===e.height.bottom.units&&e.height.val>0&&(k=100*k/e.height.val);var l=s(e.width.val-f.w,h,i),n=l.biasDiff,o=l.biasComplementDiff,p=s(e.height.val-f.h,j,k),q=p.biasDiff,r=p.biasComplementDiff;b.autoPadding=function(a,b,c,d){if("%"===c.units)switch(d){case"width":return a>0?c.pfValue*a:0;case"height":return b>0?c.pfValue*b:0;case"average":return a>0&&b>0?c.pfValue*(a+b)/2:0;case"min":return a>0&&b>0?a>b?c.pfValue*b:c.pfValue*a:0;case"max":return a>0&&b>0?a>b?c.pfValue*a:c.pfValue*b:0;default:return 0}return"px"===c.units?c.pfValue:0}(f.w,f.h,a.pstyle("padding"),a.pstyle("padding-relative-to").value),b.autoWidth=Math.max(f.w,e.width.val),g.x=(-n+f.x1+f.x2+o)/2,b.autoHeight=Math.max(f.h,e.height.val),g.y=(-q+f.y1+f.y2+r)/2}function s(a,b,c){var d=0,e=0,f=b+c;return a>0&&f>0&&(d=b/f*a,e=c/f*a),{biasDiff:d,biasComplementDiff:e}}}(d),b.batching()||(e.compoundBoundsClean=!0))}return this};var vz=function(a){return a===1/0||a===-1/0?0:a},vA=function(a,b,c,d,e){d-b==0||e-c==0||null!=b&&null!=c&&null!=d&&null!=e&&(a.x1=b<a.x1?b:a.x1,a.x2=d>a.x2?d:a.x2,a.y1=c<a.y1?c:a.y1,a.y2=e>a.y2?e:a.y2,a.w=a.x2-a.x1,a.h=a.y2-a.y1)},vB=function(a,b){return null==b?a:vA(a,b.x1,b.y1,b.x2,b.y2)},vC=function(a,b,c){return sx(a,b,c)},vD=function(a,b,c){if(!b.cy().headless()){var d,e,f=b._private,g=f.rstyle,h=g.arrowWidth/2;if("none"!==b.pstyle(c+"-arrow-shape").value){"source"===c?(d=g.srcX,e=g.srcY):"target"===c?(d=g.tgtX,e=g.tgtY):(d=g.midX,e=g.midY);var i=f.arrowBounds=f.arrowBounds||{},j=i[c]=i[c]||{};j.x1=d-h,j.y1=e-h,j.x2=d+h,j.y2=e+h,j.w=j.x2-j.x1,j.h=j.y2-j.y1,s9(j,1),vA(a,j.x1,j.y1,j.x2,j.y2)}}},vE=function(a,b,c){if(!b.cy().headless()){f=c?c+"-":"";var d=b._private,e=d.rstyle;if(b.pstyle(f+"label").strValue){var f,g,h,i,j,k=b.pstyle("text-halign"),l=b.pstyle("text-valign"),n=vC(e,"labelWidth",c),o=vC(e,"labelHeight",c),p=vC(e,"labelX",c),q=vC(e,"labelY",c),r=b.pstyle(f+"text-margin-x").pfValue,s=b.pstyle(f+"text-margin-y").pfValue,t=b.isEdge(),u=b.pstyle(f+"text-rotation"),v=b.pstyle("text-outline-width").pfValue,w=b.pstyle("text-border-width").pfValue/2,x=b.pstyle("text-background-padding").pfValue,y=n/2,z=o/2;if(t)g=p-y,h=p+y,i=q-z,j=q+z;else{switch(k.value){case"left":g=p-n,h=p;break;case"center":g=p-y,h=p+y;break;case"right":g=p,h=p+n}switch(l.value){case"top":i=q-o,j=q;break;case"center":i=q-z,j=q+z;break;case"bottom":i=q,j=q+o}}var A=r-Math.max(v,w)-x-2,B=r+Math.max(v,w)+x+2,C=s-Math.max(v,w)-x-2,D=s+Math.max(v,w)+x+2;g+=A,h+=B,i+=C,j+=D;var E=c||"main",F=d.labelBounds,G=F[E]=F[E]||{};G.x1=g,G.y1=i,G.x2=h,G.y2=j,G.w=h-g,G.h=j-i,G.leftPad=A,G.rightPad=B,G.topPad=C,G.botPad=D;var H=t&&"autorotate"===u.strValue,I=null!=u.pfValue&&0!==u.pfValue;if(H||I){var J=H?vC(d.rstyle,"labelAngle",c):u.pfValue,K=Math.cos(J),L=Math.sin(J),M=(g+h)/2,N=(i+j)/2;if(!t){switch(k.value){case"left":M=h;break;case"right":M=g}switch(l.value){case"top":N=j;break;case"bottom":N=i}}var O=function(a,b){return{x:(a-=M)*K-(b-=N)*L+M,y:a*L+b*K+N}},P=O(g,i),Q=O(g,j),R=O(h,i),S=O(h,j);g=Math.min(P.x,Q.x,R.x,S.x),h=Math.max(P.x,Q.x,R.x,S.x),i=Math.min(P.y,Q.y,R.y,S.y),j=Math.max(P.y,Q.y,R.y,S.y)}var T=E+"Rot",U=F[T]=F[T]||{};U.x1=g,U.y1=i,U.x2=h,U.y2=j,U.w=h-g,U.h=j-i,vA(a,g,i,h,j),vA(d.labelBounds.all,g,i,h,j)}return a}},vF=function(a,b){if(!b.cy().headless()){var c=b.pstyle("outline-opacity").value,d=b.pstyle("outline-width").value+b.pstyle("outline-offset").value;vG(a,b,c,d,"outside",d/2)}},vG=function(a,b,c,d,e,f){if(0!==c&&!(d<=0)&&"inside"!==e){var g=b.cy(),h=b.pstyle("shape").value,i=g.renderer().nodeShapes[h],j=b.position(),k=j.x,l=j.y,n=b.width(),o=b.height();i.hasMiterBounds?("center"===e&&(d/=2),vB(a,i.miterBounds(k,l,n,o,d))):null!=f&&f>0&&ta(a,[f,f,f,f])}},vH=function(a,b){if(!b.cy().headless()){var c=b.pstyle("border-opacity").value,d=b.pstyle("border-width").pfValue,e=b.pstyle("border-position").value;vG(a,b,c,d,e)}},vI=function(a,b){var c=a._private.cy,d=c.styleEnabled(),e=c.headless(),f=s5(),g=a._private,h=a.isNode(),i=a.isEdge(),j=g.rstyle,k=h&&d?a.pstyle("bounds-expansion").pfValue:[0],l=function(a){return"none"!==a.pstyle("display").value},n=!d||l(a)&&(!i||l(a.source())&&l(a.target()));if(n){var o=0;d&&b.includeOverlays&&0!==a.pstyle("overlay-opacity").value&&(o=a.pstyle("overlay-padding").value);var p=0;d&&b.includeUnderlays&&0!==a.pstyle("underlay-opacity").value&&(p=a.pstyle("underlay-padding").value);var q=Math.max(o,p),r=0;if(d&&(r=a.pstyle("width").pfValue/2),h&&b.includeNodes){var s=a.position();z=s.x,A=s.y;var t=a.outerWidth()/2,u=a.outerHeight()/2;v=z-t,w=z+t,vA(f,v,x=A-u,w,y=A+u),d&&vF(f,a),d&&b.includeOutlines&&!e&&vF(f,a),d&&vH(f,a)}else if(i&&b.includeEdges)if(d&&!e){var v,w,x,y,z,A,B,C=a.pstyle("curve-style").strValue;if(v=Math.min(j.srcX,j.midX,j.tgtX),w=Math.max(j.srcX,j.midX,j.tgtX),x=Math.min(j.srcY,j.midY,j.tgtY),y=Math.max(j.srcY,j.midY,j.tgtY),v-=r,w+=r,vA(f,v,x-=r,w,y+=r),"haystack"===C){var D=j.haystackPts;if(D&&2===D.length){if(v=D[0].x,x=D[0].y,w=D[1].x,y=D[1].y,v>w){var E=v;v=w,w=E}if(x>y){var F=x;x=y,y=F}vA(f,v-r,x-r,w+r,y+r)}}else if("bezier"===C||"unbundled-bezier"===C||rH(C,"segments")||rH(C,"taxi")){switch(C){case"bezier":case"unbundled-bezier":B=j.bezierPts;break;case"segments":case"taxi":case"round-segments":case"round-taxi":B=j.linePts}if(null!=B)for(var G=0;G<B.length;G++){var H=B[G];v=H.x-r,w=H.x+r,vA(f,v,x=H.y-r,w,y=H.y+r)}}}else{var I=a.source().position(),J=a.target().position();if(v=I.x,w=J.x,x=I.y,y=J.y,v>w){var K=v;v=w,w=K}if(x>y){var L=x;x=y,y=L}v-=r,w+=r,vA(f,v,x-=r,w,y+=r)}if(d&&b.includeEdges&&i&&(vD(f,a,"mid-source"),vD(f,a,"mid-target"),vD(f,a,"source"),vD(f,a,"target")),d&&"yes"===a.pstyle("ghost").value){var M=a.pstyle("ghost-offset-x").pfValue,N=a.pstyle("ghost-offset-y").pfValue;vA(f,f.x1+M,f.y1+N,f.x2+M,f.y2+N)}var O=g.bodyBounds=g.bodyBounds||{};tb(O,f),ta(O,k),s9(O,1),d&&(v=f.x1,w=f.x2,x=f.y1,y=f.y2,vA(f,v-q,x-q,w+q,y+q));var P=g.overlayBounds=g.overlayBounds||{};tb(P,f),ta(P,k),s9(P,1);var Q=g.labelBounds=g.labelBounds||{};null!=Q.all?s6(Q.all):Q.all=s5(),d&&b.includeLabels&&(b.includeMainLabels&&vE(f,a,null),i&&(b.includeSourceLabels&&vE(f,a,"source"),b.includeTargetLabels&&vE(f,a,"target")))}return f.x1=vz(f.x1),f.y1=vz(f.y1),f.x2=vz(f.x2),f.y2=vz(f.y2),f.w=vz(f.x2-f.x1),f.h=vz(f.y2-f.y1),f.w>0&&f.h>0&&n&&(ta(f,k),s9(f,1)),f},vJ=function(a){var b=0,c=function(a){return!!a<<b++};return 0+c(a.incudeNodes)+c(a.includeEdges)+c(a.includeLabels)+c(a.includeMainLabels)+c(a.includeSourceLabels)+c(a.includeTargetLabels)+c(a.includeOverlays)+c(a.includeOutlines)},vK=function(a){var b=function(a){return Math.round(a)};if(a.isEdge()){var c=a.source().position(),d=a.target().position();return sa([b(c.x),b(c.y),b(d.x),b(d.y)])}var e=a.position();return sa([b(e.x),b(e.y)])},vL=function(a,b){var c,d=a._private,e=a.isEdge(),f=null==b?vN:vJ(b);if(null==d.bbCache?(d.bbCache=c=vI(a,vM),d.bbCachePosKey=vK(a)):c=d.bbCache,f!==vN){var g=a.isNode();c=s5(),(b.includeNodes&&g||b.includeEdges&&!g)&&(b.includeOverlays?vB(c,d.overlayBounds):vB(c,d.bodyBounds)),b.includeLabels&&(b.includeMainLabels&&(!e||b.includeSourceLabels&&b.includeTargetLabels)?vB(c,d.labelBounds.all):(b.includeMainLabels&&vB(c,d.labelBounds.mainRot),b.includeSourceLabels&&vB(c,d.labelBounds.sourceRot),b.includeTargetLabels&&vB(c,d.labelBounds.targetRot))),c.w=c.x2-c.x1,c.h=c.y2-c.y1}return c},vM={includeNodes:!0,includeEdges:!0,includeLabels:!0,includeMainLabels:!0,includeSourceLabels:!0,includeTargetLabels:!0,includeOverlays:!0,includeUnderlays:!0,includeOutlines:!0,useCache:!0},vN=vJ(vM),vO=st(vM);Ad.boundingBox=function(a){var b,c=void 0===a||void 0===a.useCache||!0===a.useCache,d=rC(function(a){var b=a._private;return null==b.bbCache||b.styleDirty||b.bbCachePosKey!==vK(a)},function(a){return a.id()});if(c&&1===this.length&&!d(this[0]))a=void 0===a?vM:vO(a),b=vL(this[0],a);else{b=s5();var e=vO(a=a||vM),f=this.cy().styleEnabled();this.edges().forEach(d),this.nodes().forEach(d),f&&this.recalculateRenderedStyle(c),this.updateCompoundBounds(!c);for(var g=0;g<this.length;g++){var h=this[g];d(h)&&h.dirtyBoundingBoxCache(),vB(b,vL(h,e))}}return b.x1=vz(b.x1),b.y1=vz(b.y1),b.x2=vz(b.x2),b.y2=vz(b.y2),b.w=vz(b.x2-b.x1),b.h=vz(b.y2-b.y1),b},Ad.dirtyBoundingBoxCache=function(){for(var a=0;a<this.length;a++){var b=this[a]._private;b.bbCache=null,b.bbCachePosKey=null,b.bodyBounds=null,b.overlayBounds=null,b.labelBounds.all=null,b.labelBounds.source=null,b.labelBounds.target=null,b.labelBounds.main=null,b.labelBounds.sourceRot=null,b.labelBounds.targetRot=null,b.labelBounds.mainRot=null,b.arrowBounds.source=null,b.arrowBounds.target=null,b.arrowBounds["mid-source"]=null,b.arrowBounds["mid-target"]=null}return this.emitAndNotify("bounds"),this},Ad.boundingBoxAt=function(a){var b,c=this.nodes(),d=this.cy(),e=d.hasCompoundNodes(),f=d.collection();if(e&&(f=c.filter(function(a){return a.isParent()}),c=c.not(f)),rs(a)){var g=a;a=function(){return g}}d.startBatch(),c.forEach(function(b,c){return b._private.bbAtOldPos=a(b,c)}).silentPositions(a),e&&(f.dirtyCompoundBoundsCache(),f.dirtyBoundingBoxCache(),f.updateCompoundBounds(!0));var h={x1:(b=this.boundingBox({useCache:!1})).x1,x2:b.x2,w:b.w,y1:b.y1,y2:b.y2,h:b.h};return c.silentPositions(function(a){return a._private.bbAtOldPos}),e&&(f.dirtyCompoundBoundsCache(),f.dirtyBoundingBoxCache(),f.updateCompoundBounds(!0)),d.endBatch(),h},Ac.boundingbox=Ac.bb=Ac.boundingBox,Ac.renderedBoundingbox=Ac.renderedBoundingBox,Ae=Af={};var vP=function(a){a.uppercaseName=rG(a.name),a.autoName="auto"+a.uppercaseName,a.labelName="label"+a.uppercaseName,a.outerName="outer"+a.uppercaseName,a.uppercaseOuterName=rG(a.outerName),Ae[a.name]=function(){var b=this[0],c=b._private,d=c.cy._private.styleEnabled;if(b)if(!d)return 1;else{if(b.isParent())return b.updateCompoundBounds(),c[a.autoName]||0;var e=b.pstyle(a.name);return"label"===e.strValue?(b.recalculateRenderedStyle(),c.rstyle[a.labelName]||0):e.pfValue}},Ae["outer"+a.uppercaseName]=function(){var b=this[0],c=b._private.cy._private.styleEnabled;if(b)if(!c)return 1;else{var d=b[a.name](),e=b.pstyle("border-position").value;return d+("center"===e?b.pstyle("border-width").pfValue:"outside"===e?2*b.pstyle("border-width").pfValue:0)+2*b.padding()}},Ae["rendered"+a.uppercaseName]=function(){var b=this[0];if(b)return b[a.name]()*this.cy().zoom()},Ae["rendered"+a.uppercaseOuterName]=function(){var b=this[0];if(b)return b[a.outerName]()*this.cy().zoom()}};vP({name:"width"}),vP({name:"height"}),Af.padding=function(){var a=this[0],b=a._private;return a.isParent()&&(a.updateCompoundBounds(),void 0!==b.autoPadding)?b.autoPadding:a.pstyle("padding").pfValue},Af.paddedHeight=function(){var a=this[0];return a.height()+2*a.padding()},Af.paddedWidth=function(){var a=this[0];return a.width()+2*a.padding()};var vQ=function(a,b){if(a.isEdge()&&a.takesUpSpace())return b(a)},vR=function(a,b){if(a.isEdge()&&a.takesUpSpace()){var c=a.cy();return sQ(b(a),c.zoom(),c.pan())}},vS=function(a,b){if(a.isEdge()&&a.takesUpSpace()){var c=a.cy(),d=c.pan(),e=c.zoom();return b(a).map(function(a){return sQ(a,e,d)})}},vT={controlPoints:{get:function(a){return a.renderer().getControlPoints(a)},mult:!0},segmentPoints:{get:function(a){return a.renderer().getSegmentPoints(a)},mult:!0},sourceEndpoint:{get:function(a){return a.renderer().getSourceEndpoint(a)}},targetEndpoint:{get:function(a){return a.renderer().getTargetEndpoint(a)}},midpoint:{get:function(a){return a.renderer().getEdgeMidpoint(a)}}},vU=rO({},Ab,Ad,Af,Object.keys(vT).reduce(function(a,b){var c=vT[b],d="rendered"+b[0].toUpperCase()+b.substr(1);return a[b]=function(){return vQ(this,c.get)},c.mult?a[d]=function(){return vS(this,c.get)}:a[d]=function(){return vR(this,c.get)},a},{})),vV=function(a,b){this.recycle(a,b)};function vW(){return!1}function vX(){return!0}vV.prototype={instanceString:function(){return"event"},recycle:function(a,b){if(this.isImmediatePropagationStopped=this.isPropagationStopped=this.isDefaultPrevented=vW,null!=a&&a.preventDefault?(this.type=a.type,this.isDefaultPrevented=a.defaultPrevented?vX:vW):null!=a&&a.type?b=a:this.type=a,null!=b&&(this.originalEvent=b.originalEvent,this.type=null!=b.type?b.type:this.type,this.cy=b.cy,this.target=b.target,this.position=b.position,this.renderedPosition=b.renderedPosition,this.namespace=b.namespace,this.layout=b.layout),null!=this.cy&&null!=this.position&&null==this.renderedPosition){var c=this.position,d=this.cy.zoom(),e=this.cy.pan();this.renderedPosition={x:c.x*d+e.x,y:c.y*d+e.y}}this.timeStamp=a&&a.timeStamp||Date.now()},preventDefault:function(){this.isDefaultPrevented=vX;var a=this.originalEvent;a&&a.preventDefault&&a.preventDefault()},stopPropagation:function(){this.isPropagationStopped=vX;var a=this.originalEvent;a&&a.stopPropagation&&a.stopPropagation()},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=vX,this.stopPropagation()},isDefaultPrevented:vW,isPropagationStopped:vW,isImmediatePropagationStopped:vW};var vY=/^([^.]+)(\.(?:[^.]+))?$/,vZ={qualifierCompare:function(a,b){return a===b},eventMatches:function(){return!0},addEventFields:function(){},callbackContext:function(a){return a},beforeEmit:function(){},afterEmit:function(){},bubble:function(){return!1},parent:function(){return null},context:null},v$=Object.keys(vZ),v_={};function v0(){for(var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:v_,b=arguments.length>1?arguments[1]:void 0,c=0;c<v$.length;c++){var d=v$[c];this[d]=a[d]||vZ[d]}this.context=b||this.context,this.listeners=[],this.emitting=0}var v1=v0.prototype,v2=function(a,b,c,d,e,f,g){rq(d)&&(e=d,d=null),g&&(f=null==f?g:rO({},f,g));for(var h=rr(c)?c:c.split(/\s+/),i=0;i<h.length;i++){var j=h[i];if(!rA(j)){var k=j.match(vY);if(k&&!1===b(a,j,k[1],k[2]?k[2]:null,d,e,f))break}}},v3=function(a,b){return a.addEventFields(a.context,b),new vV(b.type,b)},v4=function(a,b,c){if("event"===ro(c))return void b(a,c);if(rs(c))return void b(a,v3(a,c));for(var d=rr(c)?c:c.split(/\s+/),e=0;e<d.length;e++){var f=d[e];if(!rA(f)){var g=f.match(vY);if(g){var h=v3(a,{type:g[1],namespace:g[2]?g[2]:null,target:a.context});b(a,h)}}}};v1.on=v1.addListener=function(a,b,c,d,e){return v2(this,function(a,b,c,d,e,f,g){rq(f)&&a.listeners.push({event:b,callback:f,type:c,namespace:d,qualifier:e,conf:g})},a,b,c,d,e),this},v1.one=function(a,b,c,d){return this.on(a,b,c,d,{one:!0})},v1.removeListener=v1.off=function(a,b,c,d){var e=this;0!==this.emitting&&(this.listeners=this.listeners.slice());for(var f=this.listeners,g=function(g){var h=f[g];v2(e,function(b,c,d,e,i,j){if((h.type===d||"*"===a)&&(!e&&".*"!==h.namespace||h.namespace===e)&&(!i||b.qualifierCompare(h.qualifier,i))&&(!j||h.callback===j))return f.splice(g,1),!1},a,b,c,d)},h=f.length-1;h>=0;h--)g(h);return this},v1.removeAllListeners=function(){return this.removeListener("*")},v1.emit=v1.trigger=function(a,b,c){var d=this.listeners,e=d.length;return this.emitting++,rr(b)||(b=[b]),v4(this,function(a,f){null!=c&&(e=(d=[{event:f.event,type:f.type,namespace:f.namespace,callback:c}]).length);for(var g=0;g<e;g++)!function(){var c=d[g];if(c.type===f.type&&(!c.namespace||c.namespace===f.namespace||".*"===c.namespace)&&a.eventMatches(a.context,c,f)){var e=[f];null!=b&&sw(e,b),a.beforeEmit(a.context,c,f),c.conf&&c.conf.one&&(a.listeners=a.listeners.filter(function(a){return a!==c}));var h=a.callbackContext(a.context,c,f),i=c.callback.apply(h,e);a.afterEmit(a.context,c,f),!1===i&&(f.stopPropagation(),f.preventDefault())}}();a.bubble(a.context)&&!f.isPropagationStopped()&&a.parent(a.context).emit(f,b)},a),this.emitting--,this};var v5={qualifierCompare:function(a,b){return null==a||null==b?null==a&&null==b:a.sameText(b)},eventMatches:function(a,b,c){var d=b.qualifier;return null==d||a!==c.target&&rw(c.target)&&d.matches(c.target)},addEventFields:function(a,b){b.cy=a.cy(),b.target=a},callbackContext:function(a,b,c){return null!=b.qualifier?c.target:a},beforeEmit:function(a,b){b.conf&&b.conf.once&&b.conf.onceCollection.removeListener(b.event,b.qualifier,b.callback)},bubble:function(){return!0},parent:function(a){return a.isChild()?a.parent():a.cy()}},v6=function(a){return rp(a)?new vl(a):a},v7={createEmitter:function(){for(var a=0;a<this.length;a++){var b=this[a],c=b._private;c.emitter||(c.emitter=new v0(v5,b))}return this},emitter:function(){return this._private.emitter},on:function(a,b,c){for(var d=v6(b),e=0;e<this.length;e++)this[e].emitter().on(a,d,c);return this},removeListener:function(a,b,c){for(var d=v6(b),e=0;e<this.length;e++)this[e].emitter().removeListener(a,d,c);return this},removeAllListeners:function(){for(var a=0;a<this.length;a++)this[a].emitter().removeAllListeners();return this},one:function(a,b,c){for(var d=v6(b),e=0;e<this.length;e++)this[e].emitter().one(a,d,c);return this},once:function(a,b,c){for(var d=v6(b),e=0;e<this.length;e++)this[e].emitter().on(a,d,c,{once:!0,onceCollection:this})},emit:function(a,b){for(var c=0;c<this.length;c++)this[c].emitter().emit(a,b);return this},emitAndNotify:function(a,b){if(0!==this.length)return this.cy().notify(a,this),this.emit(a,b),this}};u3.eventAliasesOn(v7);var v8={nodes:function(a){return this.filter(function(a){return a.isNode()}).filter(a)},edges:function(a){return this.filter(function(a){return a.isEdge()}).filter(a)},byGroup:function(){for(var a=this.spawn(),b=this.spawn(),c=0;c<this.length;c++){var d=this[c];d.isNode()?a.push(d):b.push(d)}return{nodes:a,edges:b}},filter:function(a,b){if(void 0===a)return this;if(rp(a)||rv(a))return new vl(a).filter(this);if(rq(a)){for(var c=this.spawn(),d=0;d<this.length;d++){var e=this[d];(b?a.apply(b,[e,d,this]):a(e,d,this))&&c.push(e)}return c}return this.spawn()},not:function(a){if(!a)return this;rp(a)&&(a=this.filter(a));for(var b=this.spawn(),c=0;c<this.length;c++){var d=this[c];a.has(d)||b.push(d)}return b},absoluteComplement:function(){return this.cy().mutableElements().not(this)},intersect:function(a){if(rp(a))return this.filter(a);for(var b=this.spawn(),c=this.length<a.length,d=c?this:a,e=c?a:this,f=0;f<d.length;f++){var g=d[f];e.has(g)&&b.push(g)}return b},xor:function(a){var b=this._private.cy;rp(a)&&(a=b.$(a));var c=this.spawn(),d=a,e=function(a,b){for(var d=0;d<a.length;d++){var e=a[d],f=e._private.data.id;b.hasElementWithId(f)||c.push(e)}};return e(this,d),e(d,this),c},diff:function(a){var b=this._private.cy;rp(a)&&(a=b.$(a));var c=this.spawn(),d=this.spawn(),e=this.spawn(),f=a,g=function(a,b,c){for(var d=0;d<a.length;d++){var f=a[d],g=f._private.data.id;b.hasElementWithId(g)?e.merge(f):c.push(f)}};return g(this,f,c),g(f,this,d),{left:c,right:d,both:e}},add:function(a){var b=this._private.cy;if(!a)return this;if(rp(a)){var c=a;a=b.mutableElements().filter(c)}for(var d=this.spawnSelf(),e=0;e<a.length;e++){var f=a[e];this.has(f)||d.push(f)}return d},merge:function(a){var b=this._private,c=b.cy;if(!a)return this;if(a&&rp(a)){var d=a;a=c.mutableElements().filter(d)}for(var e=b.map,f=0;f<a.length;f++){var g=a[f],h=g._private.data.id;if(!e.has(h)){var i=this.length++;this[i]=g,e.set(h,{ele:g,index:i})}}return this},unmergeAt:function(a){var b=this[a].id(),c=this._private.map;this[a]=void 0,c.delete(b);var d=a===this.length-1;if(this.length>1&&!d){var e=this.length-1,f=this[e],g=f._private.data.id;this[e]=void 0,this[a]=f,c.set(g,{ele:f,index:a})}return this.length--,this},unmergeOne:function(a){a=a[0];var b=this._private,c=a._private.data.id,d=b.map.get(c);if(!d)return this;var e=d.index;return this.unmergeAt(e),this},unmerge:function(a){var b=this._private.cy;if(!a)return this;if(a&&rp(a)){var c=a;a=b.mutableElements().filter(c)}for(var d=0;d<a.length;d++)this.unmergeOne(a[d]);return this},unmergeBy:function(a){for(var b=this.length-1;b>=0;b--)a(this[b])&&this.unmergeAt(b);return this},map:function(a,b){for(var c=[],d=0;d<this.length;d++){var e=this[d],f=b?a.apply(b,[e,d,this]):a(e,d,this);c.push(f)}return c},reduce:function(a,b){for(var c=b,d=0;d<this.length;d++)c=a(c,this[d],d,this);return c},max:function(a,b){for(var c,d=-1/0,e=0;e<this.length;e++){var f=this[e],g=b?a.apply(b,[f,e,this]):a(f,e,this);g>d&&(d=g,c=f)}return{value:d,ele:c}},min:function(a,b){for(var c,d=1/0,e=0;e<this.length;e++){var f=this[e],g=b?a.apply(b,[f,e,this]):a(f,e,this);g<d&&(d=g,c=f)}return{value:d,ele:c}}};v8.u=v8["|"]=v8["+"]=v8.union=v8.or=v8.add,v8["\\"]=v8["!"]=v8["-"]=v8.difference=v8.relativeComplement=v8.subtract=v8.not,v8.n=v8["&"]=v8["."]=v8.and=v8.intersection=v8.intersect,v8["^"]=v8["(+)"]=v8["(-)"]=v8.symmetricDifference=v8.symdiff=v8.xor,v8.fnFilter=v8.filterFn=v8.stdFilter=v8.filter,v8.complement=v8.abscomp=v8.absoluteComplement;var v9=function(a,b){var c=a.cy().hasCompoundNodes();function d(a){var b=a.pstyle("z-compound-depth");return"auto"===b.value?c?a.zDepth():0:"bottom"===b.value?-1:"top"===b.value?sh:0}var e=d(a)-d(b);if(0!==e)return e;function f(a){return"auto"===a.pstyle("z-index-compare").value?+!!a.isNode():0}var g=f(a)-f(b);if(0!==g)return g;var h=a.pstyle("z-index").value-b.pstyle("z-index").value;return 0!==h?h:a.poolIndex()-b.poolIndex()},wa={forEach:function(a,b){if(rq(a))for(var c=this.length,d=0;d<c;d++){var e=this[d];if(!1===(b?a.apply(b,[e,d,this]):a(e,d,this)))break}return this},toArray:function(){for(var a=[],b=0;b<this.length;b++)a.push(this[b]);return a},slice:function(a,b){var c=[],d=this.length;null==b&&(b=d),null==a&&(a=0),a<0&&(a=d+a),b<0&&(b=d+b);for(var e=a;e>=0&&e<b&&e<d;e++)c.push(this[e]);return this.spawn(c)},size:function(){return this.length},eq:function(a){return this[a]||this.spawn()},first:function(){return this[0]||this.spawn()},last:function(){return this[this.length-1]||this.spawn()},empty:function(){return 0===this.length},nonempty:function(){return!this.empty()},sort:function(a){if(!rq(a))return this;var b=this.toArray().sort(a);return this.spawn(b)},sortByZIndex:function(){return this.sort(v9)},zDepth:function(){var a=this[0];if(a){var b=a._private;if("nodes"===b.group){var c=b.data.parent?a.parents().size():0;return a.isParent()?c:sh-1}var d=b.source,e=b.target;return Math.max(d.zDepth(),e.zDepth(),0)}}};wa.each=wa.forEach,("undefined"==typeof Symbol?"undefined":ri(Symbol))!="undefined"&&"undefined"!=ri(Symbol.iterator)&&(wa[Symbol.iterator]=function(){var a=this,b={value:void 0,done:!1},c=0,d=this.length;return re({next:function(){return c<d?b.value=a[c++]:(b.value=void 0,b.done=!0),b}},Symbol.iterator,function(){return this})});var wb=st({nodeDimensionsIncludeLabels:!1}),wc={layoutDimensions:function(a){if(a=wb(a),this.takesUpSpace())if(a.nodeDimensionsIncludeLabels){var b,c=this.boundingBox();b={w:c.w,h:c.h}}else b={w:this.outerWidth(),h:this.outerHeight()};else b={w:0,h:0};return(0===b.w||0===b.h)&&(b.w=b.h=1),b},layoutPositions:function(a,b,c){var d=this.nodes().filter(function(a){return!a.isParent()}),e=this.cy(),f=b.eles,g=function(a){return a.id()},h=rC(c,g);a.emit({type:"layoutstart",layout:a}),a.animations=[];var i=function(a,b,c){var d={x:b.x1+b.w/2,y:b.y1+b.h/2},e={x:(c.x-d.x)*a,y:(c.y-d.y)*a};return{x:d.x+e.x,y:d.y+e.y}},j=b.spacingFactor&&1!==b.spacingFactor,k=function(){if(!j)return null;for(var a=s5(),b=0;b<d.length;b++){var c=h(d[b],b);s8(a,c.x,c.y)}return a}(),l=rC(function(a,c){var d=h(a,c);return j&&(d=i(Math.abs(b.spacingFactor),k,d)),null!=b.transform&&(d=b.transform(a,d)),d},g);if(b.animate){for(var n=0;n<d.length;n++){var o=d[n],p=l(o,n);if(null==b.animateFilter||b.animateFilter(o,n)){var q=o.animation({position:p,duration:b.animationDuration,easing:b.animationEasing});a.animations.push(q)}else o.position(p)}if(b.fit){var r=e.animation({fit:{boundingBox:f.boundingBoxAt(l),padding:b.padding},duration:b.animationDuration,easing:b.animationEasing});a.animations.push(r)}else if(void 0!==b.zoom&&void 0!==b.pan){var s=e.animation({zoom:b.zoom,pan:b.pan,duration:b.animationDuration,easing:b.animationEasing});a.animations.push(s)}a.animations.forEach(function(a){return a.play()}),a.one("layoutready",b.ready),a.emit({type:"layoutready",layout:a}),uO.all(a.animations.map(function(a){return a.promise()})).then(function(){a.one("layoutstop",b.stop),a.emit({type:"layoutstop",layout:a})})}else d.positions(l),b.fit&&e.fit(b.eles,b.padding),null!=b.zoom&&e.zoom(b.zoom),b.pan&&e.pan(b.pan),a.one("layoutready",b.ready),a.emit({type:"layoutready",layout:a}),a.one("layoutstop",b.stop),a.emit({type:"layoutstop",layout:a});return this},layout:function(a){return this.cy().makeLayout(rO({},a,{eles:this}))}};function wd(a,b,c){var d,e=c._private,f=e.styleCache=e.styleCache||[];return null!=(d=f[a])?d:d=f[a]=b(c)}function we(a,b){return a=sb(a),function(c){return wd(a,b,c)}}function wf(a,b){a=sb(a);var c=function(a){return b.call(a)};return function(){var b=this[0];if(b)return wd(a,c,b)}}wc.createLayout=wc.makeLayout=wc.layout;var wg={recalculateRenderedStyle:function(a){var b=this.cy(),c=b.renderer(),d=b.styleEnabled();return c&&d&&c.recalculateRenderedStyle(this,a),this},dirtyStyleCache:function(){var a,b=this.cy(),c=function(a){return a._private.styleCache=null};return b.hasCompoundNodes()?((a=this.spawnSelf().merge(this.descendants()).merge(this.parents())).merge(a.connectedEdges()),a.forEach(c)):this.forEach(function(a){c(a),a.connectedEdges().forEach(c)}),this},updateStyle:function(a){var b=this._private.cy;if(!b.styleEnabled())return this;if(b.batching())return b._private.batchStyleEles.merge(this),this;var c=b.hasCompoundNodes(),d=this;a=!!a||void 0===a,c&&(d=this.spawnSelf().merge(this.descendants()).merge(this.parents()));var e=d;return a?e.emitAndNotify("style"):e.emit("style"),d.forEach(function(a){return a._private.styleDirty=!0}),this},cleanStyle:function(){var a=this.cy();if(a.styleEnabled())for(var b=0;b<this.length;b++){var c=this[b];c._private.styleDirty&&(c._private.styleDirty=!1,a.style().apply(c))}},parsedStyle:function(a){var b=!(arguments.length>1)||void 0===arguments[1]||arguments[1],c=this[0],d=c.cy();if(d.styleEnabled()&&c){c._private.styleDirty&&(c._private.styleDirty=!1,d.style().apply(c));var e=c._private.style[a];return null!=e?e:b?d.style().getDefaultProperty(a):null}},numericStyle:function(a){var b=this[0];if(b.cy().styleEnabled()&&b){var c=b.pstyle(a);return void 0!==c.pfValue?c.pfValue:c.value}},numericStyleUnits:function(a){var b=this[0];if(b.cy().styleEnabled()&&b)return b.pstyle(a).units},renderedStyle:function(a){var b=this.cy();if(!b.styleEnabled())return this;var c=this[0];if(c)return b.style().getRenderedStyle(c,a)},style:function(a,b){var c=this.cy();if(!c.styleEnabled())return this;var d=c.style();if(rs(a))d.applyBypass(this,a,!1),this.emitAndNotify("style");else if(rp(a))if(void 0===b){var e=this[0];return e?d.getStylePropertyValue(e,a):void 0}else d.applyBypass(this,a,b,!1),this.emitAndNotify("style");else if(void 0===a){var f=this[0];return f?d.getRawStyle(f):void 0}return this},removeStyle:function(a){var b=this.cy();if(!b.styleEnabled())return this;var c=b.style();if(void 0===a)for(var d=0;d<this.length;d++){var e=this[d];c.removeAllBypasses(e,!1)}else{a=a.split(/\s+/);for(var f=0;f<this.length;f++){var g=this[f];c.removeBypasses(g,a,!1)}}return this.emitAndNotify("style"),this},show:function(){return this.css("display","element"),this},hide:function(){return this.css("display","none"),this},effectiveOpacity:function(){var a=this.cy();if(!a.styleEnabled())return 1;var b=a.hasCompoundNodes(),c=this[0];if(c){var d=c._private,e=c.pstyle("opacity").value;if(!b)return e;var f=d.data.parent?c.parents():null;if(f)for(var g=0;g<f.length;g++)e*=f[g].pstyle("opacity").value;return e}},transparent:function(){if(!this.cy().styleEnabled())return!1;var a=this[0],b=a.cy().hasCompoundNodes();if(a)if(!b)return 0===a.pstyle("opacity").value;else return 0===a.effectiveOpacity()},backgrounding:function(){return!!this.cy().styleEnabled()&&!!this[0]._private.backgrounding}};function wh(a,b){var c=a._private.data.parent?a.parents():null;if(c){for(var d=0;d<c.length;d++)if(!b(c[d]))return!1}return!0}function wi(a){var b=a.ok,c=a.edgeOkViaNode||a.ok,d=a.parentOk||a.ok;return function(){var a=this.cy();if(!a.styleEnabled())return!0;var e=this[0],f=a.hasCompoundNodes();if(e){var g=e._private;if(!b(e))return!1;if(e.isNode())return!f||wh(e,d);var h=g.source,i=g.target;return c(h)&&(!f||wh(h,c))&&(h===i||c(i)&&(!f||wh(i,c)))}}}var wj=we("eleTakesUpSpace",function(a){return"element"===a.pstyle("display").value&&0!==a.width()&&(!a.isNode()||0!==a.height())});wg.takesUpSpace=wf("takesUpSpace",wi({ok:wj})),wg.interactive=wf("interactive",wi({ok:we("eleInteractive",function(a){return"yes"===a.pstyle("events").value&&"visible"===a.pstyle("visibility").value&&wj(a)}),parentOk:we("parentInteractive",function(a){return"visible"===a.pstyle("visibility").value&&wj(a)}),edgeOkViaNode:wj})),wg.noninteractive=function(){var a=this[0];if(a)return!a.interactive()},wg.visible=wf("visible",wi({ok:we("eleVisible",function(a){return"visible"===a.pstyle("visibility").value&&0!==a.pstyle("opacity").pfValue&&wj(a)}),edgeOkViaNode:wj})),wg.hidden=function(){var a=this[0];if(a)return!a.visible()},wg.isBundledBezier=wf("isBundledBezier",function(){return!!this.cy().styleEnabled()&&!this.removed()&&"bezier"===this.pstyle("curve-style").value&&this.takesUpSpace()}),wg.bypass=wg.css=wg.style,wg.renderedCss=wg.renderedStyle,wg.removeBypass=wg.removeCss=wg.removeStyle,wg.pstyle=wg.parsedStyle;var wk={};function wl(a){return function(){var b=arguments,c=[];if(2===b.length){var d=b[0],e=b[1];this.on(a.event,d,e)}else if(1===b.length&&rq(b[0])){var f=b[0];this.on(a.event,f)}else if(0===b.length||1===b.length&&rr(b[0])){for(var g=1===b.length?b[0]:null,h=0;h<this.length;h++){var i=this[h],j=!a.ableField||i._private[a.ableField],k=i._private[a.field]!=a.value;if(a.overrideAble){var l=a.overrideAble(i);if(void 0!==l&&(j=l,!l))return this}j&&(i._private[a.field]=a.value,k&&c.push(i))}var n=this.spawn(c);n.updateStyle(),n.emit(a.event),g&&n.emit(g)}return this}}function wm(a){wk[a.field]=function(){var b=this[0];if(b){if(a.overrideField){var c=a.overrideField(b);if(void 0!==c)return c}return b._private[a.field]}},wk[a.on]=wl({event:a.on,field:a.field,ableField:a.ableField,overrideAble:a.overrideAble,value:!0}),wk[a.off]=wl({event:a.off,field:a.field,ableField:a.ableField,overrideAble:a.overrideAble,value:!1})}wm({field:"locked",overrideField:function(a){return!!a.cy().autolock()||void 0},on:"lock",off:"unlock"}),wm({field:"grabbable",overrideField:function(a){return!(a.cy().autoungrabify()||a.pannable())&&void 0},on:"grabify",off:"ungrabify"}),wm({field:"selected",ableField:"selectable",overrideAble:function(a){return!a.cy().autounselectify()&&void 0},on:"select",off:"unselect"}),wm({field:"selectable",overrideField:function(a){return!a.cy().autounselectify()&&void 0},on:"selectify",off:"unselectify"}),wk.deselect=wk.unselect,wk.grabbed=function(){var a=this[0];if(a)return a._private.grabbed},wm({field:"active",on:"activate",off:"unactivate"}),wm({field:"pannable",on:"panify",off:"unpanify"}),wk.inactive=function(){var a=this[0];if(a)return!a._private.active};var wn={},wo=function(a){return function(b){for(var c=[],d=0;d<this.length;d++){var e=this[d];if(e.isNode()){for(var f=!1,g=e.connectedEdges(),h=0;h<g.length;h++){var i=g[h],j=i.source(),k=i.target();if(a.noIncomingEdges&&k===e&&j!==e||a.noOutgoingEdges&&j===e&&k!==e){f=!0;break}}f||c.push(e)}}return this.spawn(c,!0).filter(b)}},wp=function(a){return function(b){for(var c=[],d=0;d<this.length;d++){var e=this[d];if(e.isNode())for(var f=e.connectedEdges(),g=0;g<f.length;g++){var h=f[g],i=h.source(),j=h.target();a.outgoing&&i===e?(c.push(h),c.push(j)):a.incoming&&j===e&&(c.push(h),c.push(i))}}return this.spawn(c,!0).filter(b)}},wq=function(a){return function(b){for(var c=this,d=[],e={};;){var f=a.outgoing?c.outgoers():c.incomers();if(0===f.length)break;for(var g=!1,h=0;h<f.length;h++){var i=f[h],j=i.id();e[j]||(e[j]=!0,d.push(i),g=!0)}if(!g)break;c=f}return this.spawn(d,!0).filter(b)}};function wr(a){return function(b){for(var c=[],d=0;d<this.length;d++){var e=this[d]._private[a.attr];e&&c.push(e)}return this.spawn(c,!0).filter(b)}}function ws(a){return function(b){var c=[],d=this._private.cy,e=a||{};rp(b)&&(b=d.$(b));for(var f=0;f<b.length;f++)for(var g=b[f]._private.edges,h=0;h<g.length;h++){var i=g[h],j=i._private.data,k=this.hasElementWithId(j.source)&&b.hasElementWithId(j.target),l=b.hasElementWithId(j.source)&&this.hasElementWithId(j.target);if(k||l){if((e.thisIsSrc||e.thisIsTgt)&&(e.thisIsSrc&&!k||e.thisIsTgt&&!l))continue;c.push(i)}}return this.spawn(c,!0)}}function wt(a){return a=rO({},{codirected:!1},a),function(b){for(var c=[],d=this.edges(),e=a,f=0;f<d.length;f++)for(var g=d[f]._private,h=g.source,i=h._private.data.id,j=g.data.target,k=h._private.edges,l=0;l<k.length;l++){var n=k[l],o=n._private.data,p=o.target,q=o.source,r=p===j&&q===i,s=i===p&&j===q;(e.codirected&&r||!e.codirected&&(r||s))&&c.push(n)}return this.spawn(c,!0).filter(b)}}wn.clearTraversalCache=function(){for(var a=0;a<this.length;a++)this[a]._private.traversalCache=null},rO(wn,{roots:wo({noIncomingEdges:!0}),leaves:wo({noOutgoingEdges:!0}),outgoers:vo(wp({outgoing:!0}),"outgoers"),successors:wq({outgoing:!0}),incomers:vo(wp({incoming:!0}),"incomers"),predecessors:wq({})}),rO(wn,{neighborhood:vo(function(a){for(var b=[],c=this.nodes(),d=0;d<c.length;d++)for(var e=c[d],f=e.connectedEdges(),g=0;g<f.length;g++){var h=f[g],i=h.source(),j=h.target(),k=e===i?j:i;k.length>0&&b.push(k[0]),b.push(h[0])}return this.spawn(b,!0).filter(a)},"neighborhood"),closedNeighborhood:function(a){return this.neighborhood().add(this).filter(a)},openNeighborhood:function(a){return this.neighborhood(a)}}),wn.neighbourhood=wn.neighborhood,wn.closedNeighbourhood=wn.closedNeighborhood,wn.openNeighbourhood=wn.openNeighborhood,rO(wn,{source:vo(function(a){var b,c=this[0];return c&&(b=c._private.source||c.cy().collection()),b&&a?b.filter(a):b},"source"),target:vo(function(a){var b,c=this[0];return c&&(b=c._private.target||c.cy().collection()),b&&a?b.filter(a):b},"target"),sources:wr({attr:"source"}),targets:wr({attr:"target"})}),rO(wn,{edgesWith:vo(ws(),"edgesWith"),edgesTo:vo(ws({thisIsSrc:!0}),"edgesTo")}),rO(wn,{connectedEdges:vo(function(a){for(var b=[],c=0;c<this.length;c++){var d=this[c];if(d.isNode())for(var e=d._private.edges,f=0;f<e.length;f++){var g=e[f];b.push(g)}}return this.spawn(b,!0).filter(a)},"connectedEdges"),connectedNodes:vo(function(a){for(var b=[],c=0;c<this.length;c++){var d=this[c];d.isEdge()&&(b.push(d.source()[0]),b.push(d.target()[0]))}return this.spawn(b,!0).filter(a)},"connectedNodes"),parallelEdges:vo(wt(),"parallelEdges"),codirectedEdges:vo(wt({codirected:!0}),"codirectedEdges")}),rO(wn,{components:function(a){var b=this,c=b.cy(),d=c.collection(),e=null==a?b.nodes():a.nodes(),f=[];null!=a&&e.empty()&&(e=a.sources());var g=function(a,b){d.merge(a),e.unmerge(a),b.merge(a)};if(e.empty())return b.spawn();do!function(){var a=c.collection();f.push(a);var d=e[0];g(d,a),b.bfs({directed:!1,roots:d,visit:function(b){return g(b,a)}}),a.forEach(function(c){c.connectedEdges().forEach(function(c){b.has(c)&&a.has(c.source())&&a.has(c.target())&&a.merge(c)})})}();while(e.length>0)return f},component:function(){var a=this[0];return a.cy().mutableElements().components(a)[0]}}),wn.componentsOf=wn.components;var wu=function(a,b){var c=arguments.length>2&&void 0!==arguments[2]&&arguments[2],d=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(void 0===a)return void sm("A collection must have a reference to the core");var e=new sA,f=!1;if(b){if(b.length>0&&rs(b[0])&&!rw(b[0])){f=!0;for(var g=[],h=new sC,i=0,j=b.length;i<j;i++){var k=b[i];null==k.data&&(k.data={});var l=k.data;if(null==l.id)l.id=sq();else if(a.hasElementWithId(l.id)||h.has(l.id))continue;var n=new sD(a,k,!1);g.push(n),h.add(l.id)}b=g}}else b=[];this.length=0;for(var o=0,p=b.length;o<p;o++){var q=b[o][0];if(null!=q){var r=q._private.data.id;(!c||!e.has(r))&&(c&&e.set(r,{index:this.length,ele:q}),this[this.length]=q,this.length++)}}this._private={eles:this,cy:a,get map(){return null==this.lazyMap&&this.rebuildMap(),this.lazyMap},set map(m){this.lazyMap=m},rebuildMap:function(){for(var a=this.lazyMap=new sA,b=this.eles,c=0;c<b.length;c++){var d=b[c];a.set(d.id(),{index:c,ele:d})}}},c&&(this._private.map=e),f&&!d&&this.restore()},wv=sD.prototype=wu.prototype=Object.create(Array.prototype);wv.instanceString=function(){return"collection"},wv.spawn=function(a,b){return new wu(this.cy(),a,b)},wv.spawnSelf=function(){return this.spawn(this)},wv.cy=function(){return this._private.cy},wv.renderer=function(){return this._private.cy.renderer()},wv.element=function(){return this[0]},wv.collection=function(){return rx(this)?this:new wu(this._private.cy,[this])},wv.unique=function(){return new wu(this._private.cy,this,!0)},wv.hasElementWithId=function(a){return a=""+a,this._private.map.has(a)},wv.getElementById=function(a){a=""+a;var b=this._private.cy,c=this._private.map.get(a);return c?c.ele:new wu(b)},wv.$id=wv.getElementById,wv.poolIndex=function(){var a=this._private.cy._private.elements,b=this[0]._private.data.id;return a._private.map.get(b).index},wv.indexOf=function(a){var b=a[0]._private.data.id;return this._private.map.get(b).index},wv.indexOfId=function(a){return a=""+a,this._private.map.get(a).index},wv.json=function(a){var b=this.element(),c=this.cy();if(null==b&&a)return this;if(null!=b){var d=b._private;if(rs(a)){if(c.startBatch(),a.data){b.data(a.data);var e=d.data;if(b.isEdge()){var f=!1,g={},h=a.data.source,i=a.data.target;null!=h&&h!=e.source&&(g.source=""+h,f=!0),null!=i&&i!=e.target&&(g.target=""+i,f=!0),f&&(b=b.move(g))}else{var j="parent"in a.data,k=a.data.parent;j&&(null!=k||null!=e.parent)&&k!=e.parent&&(void 0===k&&(k=null),null!=k&&(k=""+k),b=b.move({parent:k}))}}a.position&&b.position(a.position);var l=function(c,e,f){var g=a[c];null!=g&&g!==d[c]&&(g?b[e]():b[f]())};return l("removed","remove","restore"),l("selected","select","unselect"),l("selectable","selectify","unselectify"),l("locked","lock","unlock"),l("grabbable","grabify","ungrabify"),l("pannable","panify","unpanify"),null!=a.classes&&b.classes(a.classes),c.endBatch(),this}if(void 0===a){var n={data:sp(d.data),position:sp(d.position),group:d.group,removed:d.removed,selected:d.selected,selectable:d.selectable,locked:d.locked,grabbable:d.grabbable,pannable:d.pannable,classes:null};n.classes="";var o=0;return d.classes.forEach(function(a){return n.classes+=0==o++?a:" "+a}),n}}},wv.jsons=function(){for(var a=[],b=0;b<this.length;b++){var c=this[b].json();a.push(c)}return a},wv.clone=function(){for(var a=this.cy(),b=[],c=0;c<this.length;c++){var d=new sD(a,this[c].json(),!1);b.push(d)}return new wu(a,b)},wv.copy=wv.clone,wv.restore=function(){for(var a=!(arguments.length>0)||void 0===arguments[0]||arguments[0],b=!(arguments.length>1)||void 0===arguments[1]||arguments[1],c=this.cy(),d=c._private,e=[],f=[],g=0,h=this.length;g<h;g++){var i=this[g];(!b||i.removed())&&(i.isNode()?e.push(i):f.push(i))}F=e.concat(f);var j=function(){F.splice(G,1),G--};for(G=0;G<F.length;G++){var k=F[G],l=k._private,n=l.data;if(k.clearTraversalCache(),b||l.removed){if(void 0===n.id)n.id=sq();else if(rt(n.id))n.id=""+n.id;else if(rA(n.id)||!rp(n.id)){sm("Can not create element with invalid string ID `"+n.id+"`"),j();continue}else if(c.hasElementWithId(n.id)){sm("Can not create second element with ID `"+n.id+"`"),j();continue}}var o=n.id;if(k.isNode()){var p=l.position;null==p.x&&(p.x=0),null==p.y&&(p.y=0)}if(k.isEdge()){for(var q=["source","target"],r=q.length,s=!1,t=0;t<r;t++){var u=q[t],v=n[u];rt(v)&&(v=n[u]=""+n[u]),null==v||""===v?(sm("Can not create edge `"+o+"` with unspecified "+u),s=!0):c.hasElementWithId(v)||(sm("Can not create edge `"+o+"` with nonexistant "+u+" `"+v+"`"),s=!0)}if(s){j();continue}var w=c.getElementById(n.source),x=c.getElementById(n.target);w.same(x)?w._private.edges.push(k):(w._private.edges.push(k),x._private.edges.push(k)),k._private.source=w,k._private.target=x}l.map=new sA,l.map.set(o,{ele:k,index:0}),l.removed=!1,b&&c.addToPool(k)}for(var y=0;y<e.length;y++){var z=e[y],A=z._private.data;rt(A.parent)&&(A.parent=""+A.parent);var B=A.parent;if(null!=B||z._private.parent){var C=z._private.parent?c.collection().merge(z._private.parent):c.getElementById(B);if(C.empty())A.parent=void 0;else if(C[0].removed())so("Node added with missing parent, reference to parent removed"),A.parent=void 0,z._private.parent=null;else{for(var D=!1,E=C;!E.empty();){if(z.same(E)){D=!0,A.parent=void 0;break}E=E.parent()}D||(C[0]._private.children.push(z),z._private.parent=C[0],d.hasCompoundNodes=!0)}}}if(F.length>0){for(var F,G,H,I=F.length===this.length?this:new wu(c,F),J=0;J<I.length;J++){var K=I[J];K.isNode()||(K.parallelEdges().clearTraversalCache(),K.source().clearTraversalCache(),K.target().clearTraversalCache())}(d.hasCompoundNodes?c.collection().merge(I).merge(I.connectedNodes()).merge(I.parent()):I).dirtyCompoundBoundsCache().dirtyBoundingBoxCache().updateStyle(a),a?I.emitAndNotify("add"):b&&I.emit("add")}return this},wv.removed=function(){var a=this[0];return a&&a._private.removed},wv.inside=function(){var a=this[0];return a&&!a._private.removed},wv.remove=function(){for(var a=!(arguments.length>0)||void 0===arguments[0]||arguments[0],b=!(arguments.length>1)||void 0===arguments[1]||arguments[1],c=[],d={},e=this._private.cy,f=0,g=this.length;f<g;f++)!function a(e){var f=d[e.id()];if(!(b&&e.removed())&&!f)if(d[e.id()]=!0,e.isNode()){c.push(e);for(var g=e._private.edges,h=0;h<g.length;h++)a(g[h]);for(var i=e._private.children,j=0;j<i.length;j++)a(i[j])}else c.unshift(e)}(this[f]);function h(a,b){su(a._private.edges,b),a.clearTraversalCache()}var i=[];i.ids={},this.dirtyCompoundBoundsCache(),b&&e.removeFromPool(c);for(var j=0;j<c.length;j++){var k=c[j];if(k.isEdge()){var l=k.source()[0],n=k.target()[0];h(l,k),h(n,k);for(var o=k.parallelEdges(),p=0;p<o.length;p++){var q=o[p];q.clearTraversalCache(),q.isBundledBezier()&&q.dirtyBoundingBoxCache()}}else{var r=k.parent();0!==r.length&&function(a,b){b=b[0];var c=(a=a[0])._private.children,d=a.id();su(c,b),b._private.parent=null,i.ids[d]||(i.ids[d]=!0,i.push(a))}(r,k)}b&&(k._private.removed=!0)}var s=e._private.elements;e._private.hasCompoundNodes=!1;for(var t=0;t<s.length;t++)if(s[t].isParent()){e._private.hasCompoundNodes=!0;break}var u=new wu(this.cy(),c);u.size()>0&&(a?u.emitAndNotify("remove"):b&&u.emit("remove"));for(var v=0;v<i.length;v++){var w=i[v];b&&w.removed()||w.updateStyle()}return u},wv.move=function(a){var b=this._private.cy,c=this,d=function(a){return null==a?a:""+a};if(void 0!==a.source||void 0!==a.target){var e=d(a.source),f=d(a.target),g=null!=e&&b.hasElementWithId(e),h=null!=f&&b.hasElementWithId(f);(g||h)&&(b.batch(function(){c.remove(!1,!1),c.emitAndNotify("moveout");for(var a=0;a<c.length;a++){var b=c[a],d=b._private.data;b.isEdge()&&(g&&(d.source=e),h&&(d.target=f))}c.restore(!1,!1)}),c.emitAndNotify("move"))}else if(void 0!==a.parent){var i=d(a.parent);if(null===i||b.hasElementWithId(i)){var j=null===i?void 0:i;b.batch(function(){var a=c.remove(!1,!1);a.emitAndNotify("moveout");for(var b=0;b<c.length;b++){var d=c[b],e=d._private.data;d.isNode()&&(e.parent=j)}a.restore(!1,!1)}),c.emitAndNotify("move")}}return this},[uH,u4,u5,vn,vp,z9,vu,vU,v7,v8,{isNode:function(){return"nodes"===this.group()},isEdge:function(){return"edges"===this.group()},isLoop:function(){return this.isEdge()&&this.source()[0]===this.target()[0]},isSimple:function(){return this.isEdge()&&this.source()[0]!==this.target()[0]},group:function(){var a=this[0];if(a)return a._private.group}},wa,wc,wg,wk,wn].forEach(function(a){rO(wv,a)});var ww=function(){function a(a){return-a.tension*a.x-a.friction*a.v}function b(b,c,d){var e={x:b.x+d.dx*c,v:b.v+d.dv*c,tension:b.tension,friction:b.friction};return{dx:e.v,dv:a(e)}}return function c(d,e,f){var g,h,i,j,k,l,n,o,p,q,r,s={x:-1,v:0,tension:null,friction:null},t=[0],u=0;for(d=parseFloat(d)||500,e=parseFloat(e)||20,f=f||null,s.tension=d,s.friction=e,q=(p=null!==f)?(u=c(d,e))/f*.016:.016;g=r||s,h=q,i={dx:g.v,dv:a(g)},j=b(g,.5*h,i),k=b(g,.5*h,j),l=b(g,h,k),n=1/6*(i.dx+2*(j.dx+k.dx)+l.dx),o=1/6*(i.dv+2*(j.dv+k.dv)+l.dv),g.x=g.x+n*h,g.v=g.v+o*h,r=g,t.push(1+r.x),u+=16,Math.abs(r.x)>1e-4&&Math.abs(r.v)>1e-4;);return p?function(a){return t[a*(t.length-1)|0]}:u}}(),wx=function(a,b,c,d){var e=function(a,b,c,d){var e="undefined"!=typeof Float32Array;if(4!=arguments.length)return!1;for(var f=0;f<4;++f)if("number"!=typeof arguments[f]||isNaN(arguments[f])||!isFinite(arguments[f]))return!1;a=Math.min(a,1),c=Math.min(c,1),a=Math.max(a,0),c=Math.max(c,0);var g=e?new Float32Array(11):Array(11);function h(a,b,c){return(((1-3*c+3*b)*a+(3*c-6*b))*a+3*b)*a}function i(a,b,c){return 3*(1-3*c+3*b)*a*a+2*(3*c-6*b)*a+3*b}var j=!1,k=function(e){return(j||(j=!0,(a!==b||c!==d)&&function(){for(var b=0;b<11;++b)g[b]=h(.1*b,a,c)}()),a===b&&c===d)?e:0===e?0:1===e?1:h(function(b){for(var d=0,e=1;10!==e&&g[e]<=b;++e)d+=.1;var f=d+(b-g[--e])/(g[e+1]-g[e])*.1,j=i(f,a,c);if(j>=.001){for(var k=f,l=0;l<4;++l){var n=i(k,a,c);if(0===n)break;var o=h(k,a,c)-b;k-=o/n}return k}return 0===j?f:function(b,d,e){var f,g,i=0;do(f=h(g=d+(e-d)/2,a,c)-b)>0?e=g:d=g;while(Math.abs(f)>1e-7&&++i<10)return g}(b,d,d+.1)}(e),b,d)};k.getControlPoints=function(){return[{x:a,y:b},{x:c,y:d}]};var l="generateBezier("+[a,b,c,d]+")";return k.toString=function(){return l},k}(a,b,c,d);return function(a,b,c){return a+(b-a)*e(c)}},wy={linear:function(a,b,c){return a+(b-a)*c},ease:wx(.25,.1,.25,1),"ease-in":wx(.42,0,1,1),"ease-out":wx(0,0,.58,1),"ease-in-out":wx(.42,0,.58,1),"ease-in-sine":wx(.47,0,.745,.715),"ease-out-sine":wx(.39,.575,.565,1),"ease-in-out-sine":wx(.445,.05,.55,.95),"ease-in-quad":wx(.55,.085,.68,.53),"ease-out-quad":wx(.25,.46,.45,.94),"ease-in-out-quad":wx(.455,.03,.515,.955),"ease-in-cubic":wx(.55,.055,.675,.19),"ease-out-cubic":wx(.215,.61,.355,1),"ease-in-out-cubic":wx(.645,.045,.355,1),"ease-in-quart":wx(.895,.03,.685,.22),"ease-out-quart":wx(.165,.84,.44,1),"ease-in-out-quart":wx(.77,0,.175,1),"ease-in-quint":wx(.755,.05,.855,.06),"ease-out-quint":wx(.23,1,.32,1),"ease-in-out-quint":wx(.86,0,.07,1),"ease-in-expo":wx(.95,.05,.795,.035),"ease-out-expo":wx(.19,1,.22,1),"ease-in-out-expo":wx(1,0,0,1),"ease-in-circ":wx(.6,.04,.98,.335),"ease-out-circ":wx(.075,.82,.165,1),"ease-in-out-circ":wx(.785,.135,.15,.86),spring:function(a,b,c){if(0===c)return wy.linear;var d=ww(a,b,c);return function(a,b,c){return a+(b-a)*d(c)}},"cubic-bezier":wx};function wz(a,b,c,d,e){if(1===d||b===c)return c;var f=e(b,c,d);return null==a||((a.roundValue||a.color)&&(f=Math.round(f)),void 0!==a.min&&(f=Math.max(f,a.min)),void 0!==a.max&&(f=Math.min(f,a.max))),f}function wA(a,b){return null==a.pfValue&&null==a.value?a:null!=a.pfValue&&(null==b||"%"!==b.type.units)?a.pfValue:a.value}function wB(a,b,c,d,e){var f=null!=e?e.type:null;c<0?c=0:c>1&&(c=1);var g=wA(a,e),h=wA(b,e);if(rt(g)&&rt(h))return wz(f,g,h,c,d);if(rr(g)&&rr(h)){for(var i=[],j=0;j<h.length;j++){var k=g[j],l=h[j];if(null!=k&&null!=l){var n=wz(f,k,l,c,d);i.push(n)}else i.push(l)}return i}}function wC(a,b){return null!=a&&null!=b&&(!!(rt(a)&&rt(b))||!!a&&!!b)}function wD(a,b){var c=b._private.aniEles,d=[];function e(b,c){var e=b._private,f=e.animation.current,g=e.animation.queue,h=!1;if(0===f.length){var i=g.shift();i&&f.push(i)}for(var j=function(a){for(var b=a.length-1;b>=0;b--)(0,a[b])();a.splice(0,a.length)},k=f.length-1;k>=0;k--){var l=f[k],n=l._private;if(n.stopped){f.splice(k,1),n.hooked=!1,n.playing=!1,n.started=!1,j(n.frames);continue}(n.playing||n.applying)&&(n.playing&&n.applying&&(n.applying=!1),n.started||function(a,b,c,d){var e=b._private;e.started=!0,e.startTime=c-e.progress*e.duration}(0,l,a),function(a,b,c,d){var e,f,g,h,i=!d,j=a._private,k=b._private,l=k.easing,n=k.startTime,o=(d?a:a.cy()).style();k.easingImpl||(null==l?k.easingImpl=wy.linear:(e=rp(l)?o.parse("transition-timing-function",l).value:l,rp(e)?(f=e,g=[]):(f=e[1],g=e.slice(2).map(function(a){return+a})),g.length>0?("spring"===f&&g.push(k.duration),k.easingImpl=wy[f].apply(null,g)):k.easingImpl=wy[f]));var p=k.easingImpl;if(h=0===k.duration?1:(c-n)/k.duration,k.applying&&(h=k.progress),h<0?h=0:h>1&&(h=1),null==k.delay){var q=k.startPosition,r=k.position;if(r&&i&&!a.locked()){var s={};wC(q.x,r.x)&&(s.x=wB(q.x,r.x,h,p)),wC(q.y,r.y)&&(s.y=wB(q.y,r.y,h,p)),a.position(s)}var t=k.startPan,u=k.pan,v=j.pan,w=null!=u&&d;w&&(wC(t.x,u.x)&&(v.x=wB(t.x,u.x,h,p)),wC(t.y,u.y)&&(v.y=wB(t.y,u.y,h,p)),a.emit("pan"));var x=k.startZoom,y=k.zoom,z=null!=y&&d;z&&(wC(x,y)&&(j.zoom=s4(j.minZoom,wB(x,y,h,p),j.maxZoom)),a.emit("zoom")),(w||z)&&a.emit("viewport");var A=k.style;if(A&&A.length>0&&i){for(var B=0;B<A.length;B++){var C=A[B],D=C.name,E=k.startStyle[D],F=o.properties[E.name],G=wB(E,C,h,p,F);o.overrideBypass(a,D,G)}a.emit("style")}}k.progress=h}(b,l,a,c),n.applying&&(n.applying=!1),j(n.frames),null!=n.step&&n.step(a),l.completed()&&(f.splice(k,1),n.hooked=!1,n.playing=!1,n.started=!1,j(n.completes)),h=!0)}return c||0!==f.length||0!==g.length||d.push(b),h}for(var f=!1,g=0;g<c.length;g++){var h=e(c[g]);f=f||h}var i=e(b,!0);(f||i)&&(c.length>0?b.notify("draw",c):b.notify("draw")),c.unmerge(d),b.emit("step")}var wE={animate:u3.animate(),animation:u3.animation(),animated:u3.animated(),clearQueue:u3.clearQueue(),delay:u3.delay(),delayAnimation:u3.delayAnimation(),stop:u3.stop(),addToAnimationPool:function(a){this.styleEnabled()&&this._private.aniEles.merge(a)},stopAnimationLoop:function(){this._private.animationsRunning=!1},startAnimationLoop:function(){var a=this;if(a._private.animationsRunning=!0,a.styleEnabled()){var b=a.renderer();b&&b.beforeRender?b.beforeRender(function(b,c){wD(c,a)},b.beforeRenderPriorities.animations):function b(){a._private.animationsRunning&&r4(function(c){wD(c,a),b()})}()}}},wF={qualifierCompare:function(a,b){return null==a||null==b?null==a&&null==b:a.sameText(b)},eventMatches:function(a,b,c){var d=b.qualifier;return null==d||a!==c.target&&rw(c.target)&&d.matches(c.target)},addEventFields:function(a,b){b.cy=a,b.target=a},callbackContext:function(a,b,c){return null!=b.qualifier?c.target:a}},wG=function(a){return rp(a)?new vl(a):a},wH={createEmitter:function(){var a=this._private;return a.emitter||(a.emitter=new v0(wF,this)),this},emitter:function(){return this._private.emitter},on:function(a,b,c){return this.emitter().on(a,wG(b),c),this},removeListener:function(a,b,c){return this.emitter().removeListener(a,wG(b),c),this},removeAllListeners:function(){return this.emitter().removeAllListeners(),this},one:function(a,b,c){return this.emitter().one(a,wG(b),c),this},once:function(a,b,c){return this.emitter().one(a,wG(b),c),this},emit:function(a,b){return this.emitter().emit(a,b),this},emitAndNotify:function(a,b){return this.emit(a),this.notify(a,b),this}};u3.eventAliasesOn(wH);var wI={png:function(a){return a=a||{},this._private.renderer.png(a)},jpg:function(a){var b=this._private.renderer;return(a=a||{}).bg=a.bg||"#fff",b.jpg(a)}};wI.jpeg=wI.jpg;var wJ={layout:function(a){if(null==a)return void sm("Layout options must be specified to make a layout");if(null==a.name)return void sm("A `name` must be specified to make a layout");var b,c=a.name,d=this.extension("layout",c);return null==d?void sm("No such layout `"+c+"` found.  Did you forget to import it and `cytoscape.use()` it?"):(b=rp(a.eles)?this.$(a.eles):null!=a.eles?a.eles:this.$(),new d(rO({},a,{cy:this,eles:b})))}};wJ.createLayout=wJ.makeLayout=wJ.layout;var wK=st({hideEdgesOnViewport:!1,textureOnViewport:!1,motionBlur:!1,motionBlurOpacity:.05,pixelRatio:void 0,desktopTapThreshold:4,touchTapThreshold:8,wheelSensitivity:1,debug:!1,showFps:!1,webgl:!1,webglDebug:!1,webglDebugShowAtlases:!1,webglTexSize:2048,webglTexRows:36,webglTexRowsNodes:18,webglBatchSize:2048,webglTexPerBatch:14,webglBgColor:[255,255,255]}),wL={renderTo:function(a,b,c,d){return this._private.renderer.renderTo(a,b,c,d),this},renderer:function(){return this._private.renderer},forceRender:function(){return this.notify("draw"),this},resize:function(){return this.invalidateSize(),this.emitAndNotify("resize"),this},initRenderer:function(a){var b=this.extension("renderer",a.name);if(null==b)return void sm("Can not initialise: No such renderer `".concat(a.name,"` found. Did you forget to import it and `cytoscape.use()` it?"));void 0!==a.wheelSensitivity&&so("You have set a custom wheel sensitivity.  This will make your app zoom unnaturally when using mainstream mice.  You should change this value from the default only if you can guarantee that all your users will use the same hardware and OS configuration as your current machine.");var c=wK(a);c.cy=this,this._private.renderer=new b(c),this.notify("init")},destroyRenderer:function(){this.notify("destroy");var a=this.container();if(a)for(a._cyreg=null;a.childNodes.length>0;)a.removeChild(a.childNodes[0]);this._private.renderer=null,this.mutableElements().forEach(function(a){var b=a._private;b.rscratch={},b.rstyle={},b.animation.current=[],b.animation.queue=[]})},onRender:function(a){return this.on("render",a)},offRender:function(a){return this.off("render",a)}};wL.invalidateDimensions=wL.resize;var wM={collection:function(a,b){return rp(a)?this.$(a):rv(a)?a.collection():rr(a)?(b||(b={}),new wu(this,a,b.unique,b.removed)):new wu(this)},nodes:function(a){var b=this.$(function(a){return a.isNode()});return a?b.filter(a):b},edges:function(a){var b=this.$(function(a){return a.isEdge()});return a?b.filter(a):b},$:function(a){var b=this._private.elements;return a?b.filter(a):b.spawnSelf()},mutableElements:function(){return this._private.elements}};wM.elements=wM.filter=wM.$;var wN={};wN.apply=function(a){for(var b=this._private.cy.collection(),c=0;c<a.length;c++){var d=a[c],e=this.getContextMeta(d);if(!e.empty){var f=this.getContextStyle(e),g=this.applyContextStyle(e,f,d);d._private.appliedInitStyle?this.updateTransitions(d,g.diffProps):d._private.appliedInitStyle=!0,this.updateStyleHints(d)&&b.push(d)}}return b},wN.getPropertiesDiff=function(a,b){var c=this._private.propDiffs=this._private.propDiffs||{},d=a+"-"+b,e=c[d];if(e)return e;for(var f=[],g={},h=0;h<this.length;h++){var i=this[h],j="t"===a[h],k="t"===b[h],l=j!==k,n=i.mappedProperties.length>0;if(l||k&&n){var o=void 0;l&&n||l?o=i.properties:n&&(o=i.mappedProperties);for(var p=0;p<o.length;p++){for(var q=o[p],r=q.name,s=!1,t=h+1;t<this.length;t++){var u=this[t];if("t"===b[t]&&(s=null!=u.properties[q.name]))break}g[r]||s||(g[r]=!0,f.push(r))}}}return c[d]=f,f},wN.getContextMeta=function(a){for(var b,c="",d=a._private.styleCxtKey||"",e=0;e<this.length;e++){var f=this[e];f.selector&&f.selector.matches(a)?c+="t":c+="f"}return b=this.getPropertiesDiff(d,c),a._private.styleCxtKey=c,{key:c,diffPropNames:b,empty:0===b.length}},wN.getContextStyle=function(a){var b=a.key,c=this._private.contextStyles=this._private.contextStyles||{};if(c[b])return c[b];for(var d={_private:{key:b}},e=0;e<this.length;e++){var f=this[e];if("t"===b[e])for(var g=0;g<f.properties.length;g++){var h=f.properties[g];d[h.name]=h}}return c[b]=d,d},wN.applyContextStyle=function(a,b,c){for(var d=a.diffPropNames,e={},f=this.types,g=0;g<d.length;g++){var h=d[g],i=b[h],j=c.pstyle(h);if(!i)if(!j)continue;else i=j.bypass?{name:h,deleteBypassed:!0}:{name:h,delete:!0};if(j!==i){if(i.mapped===f.fn&&null!=j&&null!=j.mapping&&j.mapping.value===i.value){var k=j.mapping;if((k.fnValue=i.value(c))===k.prevFnValue)continue}var l=e[h]={prev:j};this.applyParsedProperty(c,i),l.next=c.pstyle(h),l.next&&l.next.bypass&&(l.next=l.next.bypassed)}}return{diffProps:e}},wN.updateStyleHints=function(a){var b=a._private,c=this,d=c.propertyGroupNames,e=c.propertyGroupKeys,f=function(a,b,d){return c.getPropertiesHash(a,b,d)},g=b.styleKey;if(a.removed())return!1;var h="nodes"===b.group,i=a._private.style;d=Object.keys(i);for(var j=0;j<e.length;j++){var k=e[j];b.styleKeys[k]=[9261,5381]}for(var l=function(a,c){return b.styleKeys[c][0]=r6(a,b.styleKeys[c][0])},n=function(a,c){return b.styleKeys[c][1]=r7(a,b.styleKeys[c][1])},o=function(a,b){for(var c=0;c<a.length;c++){var d=a.charCodeAt(c);l(d,b),n(d,b)}},p=0;p<d.length;p++){var q=d[p],r=i[q];if(null!=r){var s,t,u=this.properties[q],v=u.type,w=u.groupKey,x=void 0;null!=u.hashOverride?x=u.hashOverride(a,r):null!=r.pfValue&&(x=r.pfValue);var y=null==u.enums?r.value:null,z=null!=x,A=null!=y,B=z||A,C=r.units;v.number&&B&&!v.multiple?(l(t=-128<(s=z?x:y)&&s<128&&Math.floor(s)!==s?2e9-(1024*s|0):s,w),n(t,w),z||null==C||o(C,w)):o(r.strValue,w)}}for(var D=[9261,5381],E=0;E<e.length;E++){var F=e[E],G=b.styleKeys[F];D[0]=r6(G[0],D[0]),D[1]=r7(G[1],D[1])}b.styleKey=2097152*D[0]+D[1];var H=b.styleKeys;b.labelDimsKey=r8(H.labelDimensions);var I=f(a,["label"],H.labelDimensions);if(b.labelKey=r8(I),b.labelStyleKey=r8(r9(H.commonLabel,I)),!h){var J=f(a,["source-label"],H.labelDimensions);b.sourceLabelKey=r8(J),b.sourceLabelStyleKey=r8(r9(H.commonLabel,J));var K=f(a,["target-label"],H.labelDimensions);b.targetLabelKey=r8(K),b.targetLabelStyleKey=r8(r9(H.commonLabel,K))}if(h){var L=b.styleKeys,M=L.nodeBody,N=L.nodeBorder,O=L.nodeOutline,P=L.backgroundImage,Q=L.compound,R=L.pie,S=L.stripe;b.nodeKey=r8([M,N,O,P,Q,R,S].filter(function(a){return null!=a}).reduce(r9,[9261,5381])),b.hasPie=null!=R&&9261!==R[0]&&5381!==R[1],b.hasStripe=null!=S&&9261!==S[0]&&5381!==S[1]}return g!==b.styleKey},wN.clearStyleHints=function(a){var b=a._private;b.styleCxtKey="",b.styleKeys={},b.styleKey=null,b.labelKey=null,b.labelStyleKey=null,b.sourceLabelKey=null,b.sourceLabelStyleKey=null,b.targetLabelKey=null,b.targetLabelStyleKey=null,b.nodeKey=null,b.hasPie=null,b.hasStripe=null},wN.applyParsedProperty=function(a,b){var c=this,d=b,e=a._private.style,f=c.types,g=c.properties[d.name].type,h=d.bypass,i=e[d.name],j=i&&i.bypass,k=a._private,l="mapping",n=function(a){return null==a?null:null!=a.pfValue?a.pfValue:a.value},o=function(){var b=n(i),e=n(d);c.checkTriggers(a,d.name,b,e)};if("curve-style"===b.name&&a.isEdge()&&("bezier"!==b.value&&a.isLoop()||"haystack"===b.value&&(a.source().isParent()||a.target().isParent()))&&(d=b=this.parse(b.name,"bezier",h)),d.delete)return e[d.name]=void 0,o(),!0;if(d.deleteBypassed)if(!i)return o(),!0;else if(i.bypass)return i.bypassed=void 0,o(),!0;else return!1;if(d.deleteBypass)if(!i)return o(),!0;else if(i.bypass)return e[d.name]=i.bypassed,o(),!0;else return!1;var p=function(){so("Do not assign mappings to elements without corresponding data (i.e. ele `"+a.id()+"` has no mapping for property `"+d.name+"` with data field `"+d.field+"`); try a `["+d.field+"]` selector to limit scope to elements with `"+d.field+"` defined")};switch(d.mapped){case f.mapData:for(var q,r,s=d.field.split("."),t=k.data,u=0;u<s.length&&t;u++)t=t[s[u]];if(null==t)return p(),!1;if(!rt(t))return so("Do not use continuous mappers without specifying numeric data (i.e. `"+d.field+": "+t+"` for `"+a.id()+"` is non-numeric)"),!1;var v=d.fieldMax-d.fieldMin;if((r=0===v?0:(t-d.fieldMin)/v)<0?r=0:r>1&&(r=1),g.color){var w=d.valueMin[0],x=d.valueMax[0],y=d.valueMin[1],z=d.valueMax[1],A=d.valueMin[2],B=d.valueMax[2],C=null==d.valueMin[3]?1:d.valueMin[3],D=[Math.round(w+(x-w)*r),Math.round(y+(z-y)*r),Math.round(A+(B-A)*r),Math.round(C+((null==d.valueMax[3]?1:d.valueMax[3])-C)*r)];q={bypass:d.bypass,name:d.name,value:D,strValue:"rgb("+D[0]+", "+D[1]+", "+D[2]+")"}}else{if(!g.number)return!1;var E=d.valueMin+(d.valueMax-d.valueMin)*r;q=this.parse(d.name,E,d.bypass,l)}if(!q)return p(),!1;q.mapping=d,d=q;break;case f.data:for(var F=d.field.split("."),G=k.data,H=0;H<F.length&&G;H++)G=G[F[H]];if(null!=G&&(q=this.parse(d.name,G,d.bypass,l)),!q)return p(),!1;q.mapping=d,d=q;break;case f.fn:var I=d.value,J=null!=d.fnValue?d.fnValue:I(a);if(d.prevFnValue=J,null==J)return so("Custom function mappers may not return null (i.e. `"+d.name+"` for ele `"+a.id()+"` is null)"),!1;if(!(q=this.parse(d.name,J,d.bypass,l)))return so("Custom function mappers may not return invalid values for the property type (i.e. `"+d.name+"` for ele `"+a.id()+"` is invalid)"),!1;q.mapping=sp(d),d=q;break;case void 0:break;default:return!1}return h?(j?d.bypassed=i.bypassed:d.bypassed=i,e[d.name]=d):j?i.bypassed=d:e[d.name]=d,o(),!0},wN.cleanElements=function(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(this.clearStyleHints(d),d.dirtyCompoundBoundsCache(),d.dirtyBoundingBoxCache(),b)for(var e=d._private.style,f=Object.keys(e),g=0;g<f.length;g++){var h=f[g],i=e[h];null!=i&&(i.bypass?i.bypassed=null:e[h]=null)}else d._private.style={}}},wN.update=function(){this._private.cy.mutableElements().updateStyle()},wN.updateTransitions=function(a,b){var c=this,d=a._private,e=a.pstyle("transition-property").value,f=a.pstyle("transition-duration").pfValue,g=a.pstyle("transition-delay").pfValue;if(e.length>0&&f>0){for(var h={},i=!1,j=0;j<e.length;j++){var k=e[j],l=a.pstyle(k),n=b[k];if(n){var o=n.prev,p=null!=n.next?n.next:l,q=!1,r=void 0;o&&(rt(o.pfValue)&&rt(p.pfValue)?(q=p.pfValue-o.pfValue,r=o.pfValue+1e-6*q):rt(o.value)&&rt(p.value)?(q=p.value-o.value,r=o.value+1e-6*q):rr(o.value)&&rr(p.value)&&(q=o.value[0]!==p.value[0]||o.value[1]!==p.value[1]||o.value[2]!==p.value[2],r=o.strValue),q&&(h[k]=p.strValue,this.applyBypass(a,k,r),i=!0))}}if(!i)return;d.transitioning=!0,new uO(function(b){g>0?a.delayAnimation(g).play().promise().then(b):b()}).then(function(){return a.animation({style:h,duration:f,easing:a.pstyle("transition-timing-function").value,queue:!1}).play().promise()}).then(function(){c.removeBypasses(a,e),a.emitAndNotify("style"),d.transitioning=!1})}else d.transitioning&&(this.removeBypasses(a,e),a.emitAndNotify("style"),d.transitioning=!1)},wN.checkTrigger=function(a,b,c,d,e,f){var g=this.properties[b],h=e(g);!a.removed()&&null!=h&&h(c,d,a)&&f(g)},wN.checkZOrderTrigger=function(a,b,c,d){var e=this;this.checkTrigger(a,b,c,d,function(a){return a.triggersZOrder},function(){e._private.cy.notify("zorder",a)})},wN.checkBoundsTrigger=function(a,b,c,d){this.checkTrigger(a,b,c,d,function(a){return a.triggersBounds},function(b){a.dirtyCompoundBoundsCache(),a.dirtyBoundingBoxCache()})},wN.checkConnectedEdgesBoundsTrigger=function(a,b,c,d){this.checkTrigger(a,b,c,d,function(a){return a.triggersBoundsOfConnectedEdges},function(b){a.connectedEdges().forEach(function(a){a.dirtyBoundingBoxCache()})})},wN.checkParallelEdgesBoundsTrigger=function(a,b,c,d){this.checkTrigger(a,b,c,d,function(a){return a.triggersBoundsOfParallelEdges},function(b){a.parallelEdges().forEach(function(a){a.dirtyBoundingBoxCache()})})},wN.checkTriggers=function(a,b,c,d){a.dirtyStyleCache(),this.checkZOrderTrigger(a,b,c,d),this.checkBoundsTrigger(a,b,c,d),this.checkConnectedEdgesBoundsTrigger(a,b,c,d),this.checkParallelEdgesBoundsTrigger(a,b,c,d)};var wO={};wO.applyBypass=function(a,b,c,d){var e=[];if("*"===b||"**"===b){if(void 0!==c)for(var f=0;f<this.properties.length;f++){var g=this.properties[f].name,h=this.parse(g,c,!0);h&&e.push(h)}}else if(rp(b)){var i=this.parse(b,c,!0);i&&e.push(i)}else{if(!rs(b))return!1;d=c;for(var j=Object.keys(b),k=0;k<j.length;k++){var l=j[k],n=b[l];if(void 0===n&&(n=b[rE(l)]),void 0!==n){var o=this.parse(l,n,!0);o&&e.push(o)}}}if(0===e.length)return!1;for(var p=!1,q=0;q<a.length;q++){for(var r=a[q],s={},t=void 0,u=0;u<e.length;u++){var v=e[u];if(d){var w=r.pstyle(v.name);t=s[v.name]={prev:w}}p=this.applyParsedProperty(r,sp(v))||p,d&&(t.next=r.pstyle(v.name))}p&&this.updateStyleHints(r),d&&this.updateTransitions(r,s,!0)}return p},wO.overrideBypass=function(a,b,c){b=rD(b);for(var d=0;d<a.length;d++){var e=a[d],f=e._private.style[b],g=this.properties[b].type,h=g.color,i=g.mutiple,j=f?null!=f.pfValue?f.pfValue:f.value:null;f&&f.bypass?(f.value=c,null!=f.pfValue&&(f.pfValue=c),h?f.strValue="rgb("+c.join(",")+")":i?f.strValue=c.join(" "):f.strValue=""+c,this.updateStyleHints(e)):this.applyBypass(e,b,c),this.checkTriggers(e,b,j,c)}},wO.removeAllBypasses=function(a,b){return this.removeBypasses(a,this.propertyNames,b)},wO.removeBypasses=function(a,b,c){for(var d=0;d<a.length;d++){for(var e=a[d],f={},g=0;g<b.length;g++){var h=b[g],i=this.properties[h],j=e.pstyle(i.name);if(j&&j.bypass){var k=this.parse(h,"",!0),l=f[i.name]={prev:j};this.applyParsedProperty(e,k),l.next=e.pstyle(i.name)}}this.updateStyleHints(e),c&&this.updateTransitions(e,f,!0)}};var wP={};wP.getEmSizeInPixels=function(){var a=this.containerCss("font-size");return null!=a?parseFloat(a):1},wP.containerCss=function(a){var b=this._private.cy,c=b.container(),d=b.window();if(d&&c&&d.getComputedStyle)return d.getComputedStyle(c).getPropertyValue(a)};var wQ={};wQ.getRenderedStyle=function(a,b){return b?this.getStylePropertyValue(a,b,!0):this.getRawStyle(a,!0)},wQ.getRawStyle=function(a,b){if(a=a[0]){for(var c={},d=0;d<this.properties.length;d++){var e=this.properties[d],f=this.getStylePropertyValue(a,e.name,b);null!=f&&(c[e.name]=f,c[rE(e.name)]=f)}return c}},wQ.getIndexedStyle=function(a,b,c,d){var e=a.pstyle(b)[c][d];return null!=e?e:a.cy().style().getDefaultProperty(b)[c][0]},wQ.getStylePropertyValue=function(a,b,c){if(a=a[0]){var d=this.properties[b];d.alias&&(d=d.pointsTo);var e=d.type,f=a.pstyle(d.name);if(f){var g=f.value,h=f.units,i=f.strValue;if(c&&e.number&&null!=g&&rt(g)){var j=a.cy().zoom(),k=function(a){return a*j},l=function(a,b){return k(a)+b},n=rr(g);if(n?h.every(function(a){return null!=a}):null!=h)if(n)return g.map(function(a,b){return l(a,h[b])}).join(" ");else return l(g,h);return n?g.map(function(a){return rp(a)?a:""+k(a)}).join(" "):""+k(g)}if(null!=i)return i}return null}},wQ.getAnimationStartStyle=function(a,b){for(var c={},d=0;d<b.length;d++){var e=b[d].name,f=a.pstyle(e);void 0!==f&&(f=rs(f)?this.parse(e,f.strValue):this.parse(e,f)),f&&(c[e]=f)}return c},wQ.getPropsList=function(a){var b=[],c=this.properties;if(a)for(var d=Object.keys(a),e=0;e<d.length;e++){var f=d[e],g=a[f],h=c[f]||c[rD(f)],i=this.parse(h.name,g);i&&b.push(i)}return b},wQ.getNonDefaultPropertiesHash=function(a,b,c){var d,e,f,g,h,i,j=c.slice();for(h=0;h<b.length;h++)if(d=b[h],null!=(e=a.pstyle(d,!1)))if(null!=e.pfValue)j[0]=r6(g,j[0]),j[1]=r7(g,j[1]);else for(i=0,f=e.strValue;i<f.length;i++)g=f.charCodeAt(i),j[0]=r6(g,j[0]),j[1]=r7(g,j[1]);return j},wQ.getPropertiesHash=wQ.getNonDefaultPropertiesHash;var wR={};wR.appendFromJson=function(a){for(var b=0;b<a.length;b++){var c=a[b],d=c.selector,e=c.style||c.css,f=Object.keys(e);this.selector(d);for(var g=0;g<f.length;g++){var h=f[g],i=e[h];this.css(h,i)}}return this},wR.fromJson=function(a){return this.resetToDefault(),this.appendFromJson(a),this},wR.json=function(){for(var a=[],b=this.defaultLength;b<this.length;b++){for(var c=this[b],d=c.selector,e=c.properties,f={},g=0;g<e.length;g++){var h=e[g];f[h.name]=h.strValue}a.push({selector:d?d.toString():"core",style:f})}return a};var wS={};wS.appendFromString=function(a){var b,c,d,e=""+a;function f(){e=e.length>b.length?e.substr(b.length):""}function g(){c=c.length>d.length?c.substr(d.length):""}for(e=e.replace(/[/][*](\s|.)+?[*][/]/g,"");!e.match(/^\s*$/);){var h=e.match(/^\s*((?:.|\s)+?)\s*\{((?:.|\s)+?)\}/);if(!h){so("Halting stylesheet parsing: String stylesheet contains more to parse but no selector and block found in: "+e);break}b=h[0];var i=h[1];if("core"!==i&&new vl(i).invalid){so("Skipping parsing of block: Invalid selector found in string stylesheet: "+i),f();continue}var j=h[2],k=!1;c=j;for(var l=[];!c.match(/^\s*$/);){var n=c.match(/^\s*(.+?)\s*:\s*(.+?)(?:\s*;|\s*$)/);if(!n){so("Skipping parsing of block: Invalid formatting of style property and value definitions found in:"+j),k=!0;break}d=n[0];var o=n[1],p=n[2];if(!this.properties[o]){so("Skipping property: Invalid property name in: "+d),g();continue}if(!this.parse(o,p)){so("Skipping property: Invalid property definition in: "+d),g();continue}l.push({name:o,val:p}),g()}if(k){f();break}this.selector(i);for(var q=0;q<l.length;q++){var r=l[q];this.css(r.name,r.val)}f()}return this},wS.fromString=function(a){return this.resetToDefault(),this.appendFromString(a),this};var wT={};!function(){var a=function(a){return"^"+a+"\\s*\\(\\s*([\\w\\.]+)\\s*\\)$"},b=function(a){var b=rI+"|\\w+|"+rK+"|"+rM+"|\\#[0-9a-fA-F]{3}|\\#[0-9a-fA-F]{6}";return"^"+a+"\\s*\\(([\\w\\.]+)\\s*\\,\\s*("+rI+")\\s*\\,\\s*("+rI+")\\s*,\\s*("+b+")\\s*\\,\\s*("+b+")\\)$"},c=["^url\\s*\\(\\s*['\"]?(.+?)['\"]?\\s*\\)$","^(none)$","^(.+)$"];wT.types={time:{number:!0,min:0,units:"s|ms",implicitUnits:"ms"},percent:{number:!0,min:0,max:100,units:"%",implicitUnits:"%"},percentages:{number:!0,min:0,max:100,units:"%",implicitUnits:"%",multiple:!0},zeroOneNumber:{number:!0,min:0,max:1,unitless:!0},zeroOneNumbers:{number:!0,min:0,max:1,unitless:!0,multiple:!0},nOneOneNumber:{number:!0,min:-1,max:1,unitless:!0},nonNegativeInt:{number:!0,min:0,integer:!0,unitless:!0},nonNegativeNumber:{number:!0,min:0,unitless:!0},position:{enums:["parent","origin"]},nodeSize:{number:!0,min:0,enums:["label"]},number:{number:!0,unitless:!0},numbers:{number:!0,unitless:!0,multiple:!0},positiveNumber:{number:!0,unitless:!0,min:0,strictMin:!0},size:{number:!0,min:0},bidirectionalSize:{number:!0},bidirectionalSizeMaybePercent:{number:!0,allowPercent:!0},bidirectionalSizes:{number:!0,multiple:!0},sizeMaybePercent:{number:!0,min:0,allowPercent:!0},axisDirection:{enums:["horizontal","leftward","rightward","vertical","upward","downward","auto"]},axisDirectionExplicit:{enums:["leftward","rightward","upward","downward"]},axisDirectionPrimary:{enums:["horizontal","vertical"]},paddingRelativeTo:{enums:["width","height","average","min","max"]},bgWH:{number:!0,min:0,allowPercent:!0,enums:["auto"],multiple:!0},bgPos:{number:!0,allowPercent:!0,multiple:!0},bgRelativeTo:{enums:["inner","include-padding"],multiple:!0},bgRepeat:{enums:["repeat","repeat-x","repeat-y","no-repeat"],multiple:!0},bgFit:{enums:["none","contain","cover"],multiple:!0},bgCrossOrigin:{enums:["anonymous","use-credentials","null"],multiple:!0},bgClip:{enums:["none","node"],multiple:!0},bgContainment:{enums:["inside","over"],multiple:!0},boxSelection:{enums:["contain","overlap","none"]},color:{color:!0},colors:{color:!0,multiple:!0},fill:{enums:["solid","linear-gradient","radial-gradient"]},bool:{enums:["yes","no"]},bools:{enums:["yes","no"],multiple:!0},lineStyle:{enums:["solid","dotted","dashed"]},lineCap:{enums:["butt","round","square"]},linePosition:{enums:["center","inside","outside"]},lineJoin:{enums:["round","bevel","miter"]},borderStyle:{enums:["solid","dotted","dashed","double"]},curveStyle:{enums:["bezier","unbundled-bezier","haystack","segments","straight","straight-triangle","taxi","round-segments","round-taxi"]},radiusType:{enums:["arc-radius","influence-radius"],multiple:!0},fontFamily:{regex:'^([\\w- \\"]+(?:\\s*,\\s*[\\w- \\"]+)*)$'},fontStyle:{enums:["italic","normal","oblique"]},fontWeight:{enums:["normal","bold","bolder","lighter","100","200","300","400","500","600","800","900",100,200,300,400,500,600,700,800,900]},textDecoration:{enums:["none","underline","overline","line-through"]},textTransform:{enums:["none","uppercase","lowercase"]},textWrap:{enums:["none","wrap","ellipsis"]},textOverflowWrap:{enums:["whitespace","anywhere"]},textBackgroundShape:{enums:["rectangle","roundrectangle","round-rectangle","circle"]},nodeShape:{enums:["rectangle","roundrectangle","round-rectangle","cutrectangle","cut-rectangle","bottomroundrectangle","bottom-round-rectangle","barrel","ellipse","triangle","round-triangle","square","pentagon","round-pentagon","hexagon","round-hexagon","concavehexagon","concave-hexagon","heptagon","round-heptagon","octagon","round-octagon","tag","round-tag","star","diamond","round-diamond","vee","rhomboid","right-rhomboid","polygon"]},overlayShape:{enums:["roundrectangle","round-rectangle","ellipse"]},cornerRadius:{number:!0,min:0,units:"px|em",implicitUnits:"px",enums:["auto"]},compoundIncludeLabels:{enums:["include","exclude"]},arrowShape:{enums:["tee","triangle","triangle-tee","circle-triangle","triangle-cross","triangle-backcurve","vee","square","circle","diamond","chevron","none"]},arrowFill:{enums:["filled","hollow"]},arrowWidth:{number:!0,units:"%|px|em",implicitUnits:"px",enums:["match-line"]},display:{enums:["element","none"]},visibility:{enums:["hidden","visible"]},zCompoundDepth:{enums:["bottom","orphan","auto","top"]},zIndexCompare:{enums:["auto","manual"]},valign:{enums:["top","center","bottom"]},halign:{enums:["left","center","right"]},justification:{enums:["left","center","right","auto"]},text:{string:!0},data:{mapping:!0,regex:a("data")},layoutData:{mapping:!0,regex:a("layoutData")},scratch:{mapping:!0,regex:a("scratch")},mapData:{mapping:!0,regex:b("mapData")},mapLayoutData:{mapping:!0,regex:b("mapLayoutData")},mapScratch:{mapping:!0,regex:b("mapScratch")},fn:{mapping:!0,fn:!0},url:{regexes:c,singleRegexMatchValue:!0},urls:{regexes:c,singleRegexMatchValue:!0,multiple:!0},propList:{propList:!0},angle:{number:!0,units:"deg|rad",implicitUnits:"rad"},textRotation:{number:!0,units:"deg|rad",implicitUnits:"rad",enums:["none","autorotate"]},polygonPointList:{number:!0,multiple:!0,evenMultiple:!0,min:-1,max:1,unitless:!0},edgeDistances:{enums:["intersection","node-position","endpoints"]},edgeEndpoint:{number:!0,multiple:!0,units:"%|px|em|deg|rad",implicitUnits:"px",enums:["inside-to-node","outside-to-node","outside-to-node-or-label","outside-to-line","outside-to-line-or-label"],singleEnum:!0,validate:function(a,b){switch(a.length){case 2:return"deg"!==b[0]&&"rad"!==b[0]&&"deg"!==b[1]&&"rad"!==b[1];case 1:return rp(a[0])||"deg"===b[0]||"rad"===b[0];default:return!1}}},easing:{regexes:["^(spring)\\s*\\(\\s*("+rI+")\\s*,\\s*("+rI+")\\s*\\)$","^(cubic-bezier)\\s*\\(\\s*("+rI+")\\s*,\\s*("+rI+")\\s*,\\s*("+rI+")\\s*,\\s*("+rI+")\\s*\\)$"],enums:["linear","ease","ease-in","ease-out","ease-in-out","ease-in-sine","ease-out-sine","ease-in-out-sine","ease-in-quad","ease-out-quad","ease-in-out-quad","ease-in-cubic","ease-out-cubic","ease-in-out-cubic","ease-in-quart","ease-out-quart","ease-in-out-quart","ease-in-quint","ease-out-quint","ease-in-out-quint","ease-in-expo","ease-out-expo","ease-in-out-expo","ease-in-circ","ease-out-circ","ease-in-out-circ"]},gradientDirection:{enums:["to-bottom","to-top","to-left","to-right","to-bottom-right","to-bottom-left","to-top-right","to-top-left","to-right-bottom","to-left-bottom","to-right-top","to-left-top"]},boundsExpansion:{number:!0,multiple:!0,min:0,validate:function(a){var b=a.length;return 1===b||2===b||4===b}}};var d=function(a,b){return(null==a||null==b)&&a!==b||0==a&&0!=b||0!=a&&0==b},e=function(a,b){return a!=b},f=wT.types,g=[{name:"label",type:f.text,triggersBounds:e,triggersZOrder:function(a,b){var c=rA(a),d=rA(b);return c&&!d||!c&&d}},{name:"text-rotation",type:f.textRotation,triggersBounds:e},{name:"text-margin-x",type:f.bidirectionalSize,triggersBounds:e},{name:"text-margin-y",type:f.bidirectionalSize,triggersBounds:e}],h=[{name:"source-label",type:f.text,triggersBounds:e},{name:"source-text-rotation",type:f.textRotation,triggersBounds:e},{name:"source-text-margin-x",type:f.bidirectionalSize,triggersBounds:e},{name:"source-text-margin-y",type:f.bidirectionalSize,triggersBounds:e},{name:"source-text-offset",type:f.size,triggersBounds:e}],i=[{name:"target-label",type:f.text,triggersBounds:e},{name:"target-text-rotation",type:f.textRotation,triggersBounds:e},{name:"target-text-margin-x",type:f.bidirectionalSize,triggersBounds:e},{name:"target-text-margin-y",type:f.bidirectionalSize,triggersBounds:e},{name:"target-text-offset",type:f.size,triggersBounds:e}],j=[{name:"font-family",type:f.fontFamily,triggersBounds:e},{name:"font-style",type:f.fontStyle,triggersBounds:e},{name:"font-weight",type:f.fontWeight,triggersBounds:e},{name:"font-size",type:f.size,triggersBounds:e},{name:"text-transform",type:f.textTransform,triggersBounds:e},{name:"text-wrap",type:f.textWrap,triggersBounds:e},{name:"text-overflow-wrap",type:f.textOverflowWrap,triggersBounds:e},{name:"text-max-width",type:f.size,triggersBounds:e},{name:"text-outline-width",type:f.size,triggersBounds:e},{name:"line-height",type:f.positiveNumber,triggersBounds:e}],k=[{name:"text-valign",type:f.valign,triggersBounds:e},{name:"text-halign",type:f.halign,triggersBounds:e},{name:"color",type:f.color},{name:"text-outline-color",type:f.color},{name:"text-outline-opacity",type:f.zeroOneNumber},{name:"text-background-color",type:f.color},{name:"text-background-opacity",type:f.zeroOneNumber},{name:"text-background-padding",type:f.size,triggersBounds:e},{name:"text-border-opacity",type:f.zeroOneNumber},{name:"text-border-color",type:f.color},{name:"text-border-width",type:f.size,triggersBounds:e},{name:"text-border-style",type:f.borderStyle,triggersBounds:e},{name:"text-background-shape",type:f.textBackgroundShape,triggersBounds:e},{name:"text-justification",type:f.justification},{name:"box-select-labels",type:f.bool,triggersBounds:e}],l=[{name:"events",type:f.bool,triggersZOrder:e},{name:"text-events",type:f.bool,triggersZOrder:e},{name:"box-selection",type:f.boxSelection,triggersZOrder:e}],n=[{name:"display",type:f.display,triggersZOrder:e,triggersBounds:e,triggersBoundsOfConnectedEdges:e,triggersBoundsOfParallelEdges:function(a,b,c){return a!==b&&"bezier"===c.pstyle("curve-style").value}},{name:"visibility",type:f.visibility,triggersZOrder:e},{name:"opacity",type:f.zeroOneNumber,triggersZOrder:d},{name:"text-opacity",type:f.zeroOneNumber},{name:"min-zoomed-font-size",type:f.size},{name:"z-compound-depth",type:f.zCompoundDepth,triggersZOrder:e},{name:"z-index-compare",type:f.zIndexCompare,triggersZOrder:e},{name:"z-index",type:f.number,triggersZOrder:e}],o=[{name:"overlay-padding",type:f.size,triggersBounds:e},{name:"overlay-color",type:f.color},{name:"overlay-opacity",type:f.zeroOneNumber,triggersBounds:d},{name:"overlay-shape",type:f.overlayShape,triggersBounds:e},{name:"overlay-corner-radius",type:f.cornerRadius}],p=[{name:"underlay-padding",type:f.size,triggersBounds:e},{name:"underlay-color",type:f.color},{name:"underlay-opacity",type:f.zeroOneNumber,triggersBounds:d},{name:"underlay-shape",type:f.overlayShape,triggersBounds:e},{name:"underlay-corner-radius",type:f.cornerRadius}],q=[{name:"transition-property",type:f.propList},{name:"transition-duration",type:f.time},{name:"transition-delay",type:f.time},{name:"transition-timing-function",type:f.easing}],r=function(a,b){return"label"===b.value?-a.poolIndex():b.pfValue},s=[{name:"height",type:f.nodeSize,triggersBounds:e,hashOverride:r},{name:"width",type:f.nodeSize,triggersBounds:e,hashOverride:r},{name:"shape",type:f.nodeShape,triggersBounds:e},{name:"shape-polygon-points",type:f.polygonPointList,triggersBounds:e},{name:"corner-radius",type:f.cornerRadius},{name:"background-color",type:f.color},{name:"background-fill",type:f.fill},{name:"background-opacity",type:f.zeroOneNumber},{name:"background-blacken",type:f.nOneOneNumber},{name:"background-gradient-stop-colors",type:f.colors},{name:"background-gradient-stop-positions",type:f.percentages},{name:"background-gradient-direction",type:f.gradientDirection},{name:"padding",type:f.sizeMaybePercent,triggersBounds:e},{name:"padding-relative-to",type:f.paddingRelativeTo,triggersBounds:e},{name:"bounds-expansion",type:f.boundsExpansion,triggersBounds:e}],t=[{name:"border-color",type:f.color},{name:"border-opacity",type:f.zeroOneNumber},{name:"border-width",type:f.size,triggersBounds:e},{name:"border-style",type:f.borderStyle},{name:"border-cap",type:f.lineCap},{name:"border-join",type:f.lineJoin},{name:"border-dash-pattern",type:f.numbers},{name:"border-dash-offset",type:f.number},{name:"border-position",type:f.linePosition}],u=[{name:"outline-color",type:f.color},{name:"outline-opacity",type:f.zeroOneNumber},{name:"outline-width",type:f.size,triggersBounds:e},{name:"outline-style",type:f.borderStyle},{name:"outline-offset",type:f.size,triggersBounds:e}],v=[{name:"background-image",type:f.urls},{name:"background-image-crossorigin",type:f.bgCrossOrigin},{name:"background-image-opacity",type:f.zeroOneNumbers},{name:"background-image-containment",type:f.bgContainment},{name:"background-image-smoothing",type:f.bools},{name:"background-position-x",type:f.bgPos},{name:"background-position-y",type:f.bgPos},{name:"background-width-relative-to",type:f.bgRelativeTo},{name:"background-height-relative-to",type:f.bgRelativeTo},{name:"background-repeat",type:f.bgRepeat},{name:"background-fit",type:f.bgFit},{name:"background-clip",type:f.bgClip},{name:"background-width",type:f.bgWH},{name:"background-height",type:f.bgWH},{name:"background-offset-x",type:f.bgPos},{name:"background-offset-y",type:f.bgPos}],w=[{name:"position",type:f.position,triggersBounds:e},{name:"compound-sizing-wrt-labels",type:f.compoundIncludeLabels,triggersBounds:e},{name:"min-width",type:f.size,triggersBounds:e},{name:"min-width-bias-left",type:f.sizeMaybePercent,triggersBounds:e},{name:"min-width-bias-right",type:f.sizeMaybePercent,triggersBounds:e},{name:"min-height",type:f.size,triggersBounds:e},{name:"min-height-bias-top",type:f.sizeMaybePercent,triggersBounds:e},{name:"min-height-bias-bottom",type:f.sizeMaybePercent,triggersBounds:e}],x=[{name:"line-style",type:f.lineStyle},{name:"line-color",type:f.color},{name:"line-fill",type:f.fill},{name:"line-cap",type:f.lineCap},{name:"line-opacity",type:f.zeroOneNumber},{name:"line-dash-pattern",type:f.numbers},{name:"line-dash-offset",type:f.number},{name:"line-outline-width",type:f.size},{name:"line-outline-color",type:f.color},{name:"line-gradient-stop-colors",type:f.colors},{name:"line-gradient-stop-positions",type:f.percentages},{name:"curve-style",type:f.curveStyle,triggersBounds:e,triggersBoundsOfParallelEdges:function(a,b){return a!==b&&("bezier"===a||"bezier"===b)}},{name:"haystack-radius",type:f.zeroOneNumber,triggersBounds:e},{name:"source-endpoint",type:f.edgeEndpoint,triggersBounds:e},{name:"target-endpoint",type:f.edgeEndpoint,triggersBounds:e},{name:"control-point-step-size",type:f.size,triggersBounds:e},{name:"control-point-distances",type:f.bidirectionalSizes,triggersBounds:e},{name:"control-point-weights",type:f.numbers,triggersBounds:e},{name:"segment-distances",type:f.bidirectionalSizes,triggersBounds:e},{name:"segment-weights",type:f.numbers,triggersBounds:e},{name:"segment-radii",type:f.numbers,triggersBounds:e},{name:"radius-type",type:f.radiusType,triggersBounds:e},{name:"taxi-turn",type:f.bidirectionalSizeMaybePercent,triggersBounds:e},{name:"taxi-turn-min-distance",type:f.size,triggersBounds:e},{name:"taxi-direction",type:f.axisDirection,triggersBounds:e},{name:"taxi-radius",type:f.number,triggersBounds:e},{name:"edge-distances",type:f.edgeDistances,triggersBounds:e},{name:"arrow-scale",type:f.positiveNumber,triggersBounds:e},{name:"loop-direction",type:f.angle,triggersBounds:e},{name:"loop-sweep",type:f.angle,triggersBounds:e},{name:"source-distance-from-node",type:f.size,triggersBounds:e},{name:"target-distance-from-node",type:f.size,triggersBounds:e}],y=[{name:"ghost",type:f.bool,triggersBounds:e},{name:"ghost-offset-x",type:f.bidirectionalSize,triggersBounds:e},{name:"ghost-offset-y",type:f.bidirectionalSize,triggersBounds:e},{name:"ghost-opacity",type:f.zeroOneNumber}],z=[{name:"selection-box-color",type:f.color},{name:"selection-box-opacity",type:f.zeroOneNumber},{name:"selection-box-border-color",type:f.color},{name:"selection-box-border-width",type:f.size},{name:"active-bg-color",type:f.color},{name:"active-bg-opacity",type:f.zeroOneNumber},{name:"active-bg-size",type:f.size},{name:"outside-texture-bg-color",type:f.color},{name:"outside-texture-bg-opacity",type:f.zeroOneNumber}],A=[];wT.pieBackgroundN=16,A.push({name:"pie-size",type:f.sizeMaybePercent}),A.push({name:"pie-hole",type:f.sizeMaybePercent}),A.push({name:"pie-start-angle",type:f.angle});for(var B=1;B<=wT.pieBackgroundN;B++)A.push({name:"pie-"+B+"-background-color",type:f.color}),A.push({name:"pie-"+B+"-background-size",type:f.percent}),A.push({name:"pie-"+B+"-background-opacity",type:f.zeroOneNumber});var C=[];wT.stripeBackgroundN=16,C.push({name:"stripe-size",type:f.sizeMaybePercent}),C.push({name:"stripe-direction",type:f.axisDirectionPrimary});for(var D=1;D<=wT.stripeBackgroundN;D++)C.push({name:"stripe-"+D+"-background-color",type:f.color}),C.push({name:"stripe-"+D+"-background-size",type:f.percent}),C.push({name:"stripe-"+D+"-background-opacity",type:f.zeroOneNumber});var E=[],F=wT.arrowPrefixes=["source","mid-source","target","mid-target"];[{name:"arrow-shape",type:f.arrowShape,triggersBounds:e},{name:"arrow-color",type:f.color},{name:"arrow-fill",type:f.arrowFill},{name:"arrow-width",type:f.arrowWidth}].forEach(function(a){F.forEach(function(b){var c=b+"-"+a.name,d=a.type,e=a.triggersBounds;E.push({name:c,type:d,triggersBounds:e})})},{});var G=wT.properties=[].concat(l,q,n,o,p,y,k,j,g,h,i,s,t,u,v,A,C,w,x,E,z),H=wT.propertyGroups={behavior:l,transition:q,visibility:n,overlay:o,underlay:p,ghost:y,commonLabel:k,labelDimensions:j,mainLabel:g,sourceLabel:h,targetLabel:i,nodeBody:s,nodeBorder:t,nodeOutline:u,backgroundImage:v,pie:A,stripe:C,compound:w,edgeLine:x,edgeArrow:E,core:z},I=wT.propertyGroupNames={};(wT.propertyGroupKeys=Object.keys(H)).forEach(function(a){I[a]=H[a].map(function(a){return a.name}),H[a].forEach(function(b){return b.groupKey=a})});var J=wT.aliases=[{name:"content",pointsTo:"label"},{name:"control-point-distance",pointsTo:"control-point-distances"},{name:"control-point-weight",pointsTo:"control-point-weights"},{name:"segment-distance",pointsTo:"segment-distances"},{name:"segment-weight",pointsTo:"segment-weights"},{name:"segment-radius",pointsTo:"segment-radii"},{name:"edge-text-rotation",pointsTo:"text-rotation"},{name:"padding-left",pointsTo:"padding"},{name:"padding-right",pointsTo:"padding"},{name:"padding-top",pointsTo:"padding"},{name:"padding-bottom",pointsTo:"padding"}];wT.propertyNames=G.map(function(a){return a.name});for(var K=0;K<G.length;K++){var L=G[K];G[L.name]=L}for(var M=0;M<J.length;M++){var N=J[M],O=G[N.pointsTo],P={name:N.name,alias:!0,pointsTo:O};G.push(P),G[N.name]=P}}(),wT.getDefaultProperty=function(a){return this.getDefaultProperties()[a]},wT.getDefaultProperties=function(){var a=this._private;if(null!=a.defaultProperties)return a.defaultProperties;for(var b=rO({"selection-box-color":"#ddd","selection-box-opacity":.65,"selection-box-border-color":"#aaa","selection-box-border-width":1,"active-bg-color":"black","active-bg-opacity":.15,"active-bg-size":30,"outside-texture-bg-color":"#000","outside-texture-bg-opacity":.125,events:"yes","text-events":"no","text-valign":"top","text-halign":"center","text-justification":"auto","line-height":1,color:"#000","box-selection":"contain","text-outline-color":"#000","text-outline-width":0,"text-outline-opacity":1,"text-opacity":1,"text-decoration":"none","text-transform":"none","text-wrap":"none","text-overflow-wrap":"whitespace","text-max-width":9999,"text-background-color":"#000","text-background-opacity":0,"text-background-shape":"rectangle","text-background-padding":0,"text-border-opacity":0,"text-border-width":0,"text-border-style":"solid","text-border-color":"#000","font-family":"Helvetica Neue, Helvetica, sans-serif","font-style":"normal","font-weight":"normal","font-size":16,"min-zoomed-font-size":0,"text-rotation":"none","source-text-rotation":"none","target-text-rotation":"none",visibility:"visible",display:"element",opacity:1,"z-compound-depth":"auto","z-index-compare":"auto","z-index":0,label:"","text-margin-x":0,"text-margin-y":0,"source-label":"","source-text-offset":0,"source-text-margin-x":0,"source-text-margin-y":0,"target-label":"","target-text-offset":0,"target-text-margin-x":0,"target-text-margin-y":0,"overlay-opacity":0,"overlay-color":"#000","overlay-padding":10,"overlay-shape":"round-rectangle","overlay-corner-radius":"auto","underlay-opacity":0,"underlay-color":"#000","underlay-padding":10,"underlay-shape":"round-rectangle","underlay-corner-radius":"auto","transition-property":"none","transition-duration":0,"transition-delay":0,"transition-timing-function":"linear","box-select-labels":"no","background-blacken":0,"background-color":"#999","background-fill":"solid","background-opacity":1,"background-image":"none","background-image-crossorigin":"anonymous","background-image-opacity":1,"background-image-containment":"inside","background-image-smoothing":"yes","background-position-x":"50%","background-position-y":"50%","background-offset-x":0,"background-offset-y":0,"background-width-relative-to":"include-padding","background-height-relative-to":"include-padding","background-repeat":"no-repeat","background-fit":"none","background-clip":"node","background-width":"auto","background-height":"auto","border-color":"#000","border-opacity":1,"border-width":0,"border-style":"solid","border-dash-pattern":[4,2],"border-dash-offset":0,"border-cap":"butt","border-join":"miter","border-position":"center","outline-color":"#999","outline-opacity":1,"outline-width":0,"outline-offset":0,"outline-style":"solid",height:30,width:30,shape:"ellipse","shape-polygon-points":"-1, -1,   1, -1,   1, 1,   -1, 1","corner-radius":"auto","bounds-expansion":0,"background-gradient-direction":"to-bottom","background-gradient-stop-colors":"#999","background-gradient-stop-positions":"0%",ghost:"no","ghost-offset-y":0,"ghost-offset-x":0,"ghost-opacity":0,padding:0,"padding-relative-to":"width",position:"origin","compound-sizing-wrt-labels":"include","min-width":0,"min-width-bias-left":0,"min-width-bias-right":0,"min-height":0,"min-height-bias-top":0,"min-height-bias-bottom":0},{"pie-size":"100%","pie-hole":0,"pie-start-angle":"0deg"},[{name:"pie-{{i}}-background-color",value:"black"},{name:"pie-{{i}}-background-size",value:"0%"},{name:"pie-{{i}}-background-opacity",value:1}].reduce(function(a,b){for(var c=1;c<=wT.pieBackgroundN;c++){var d=b.name.replace("{{i}}",c),e=b.value;a[d]=e}return a},{}),{"stripe-size":"100%","stripe-direction":"horizontal"},[{name:"stripe-{{i}}-background-color",value:"black"},{name:"stripe-{{i}}-background-size",value:"0%"},{name:"stripe-{{i}}-background-opacity",value:1}].reduce(function(a,b){for(var c=1;c<=wT.stripeBackgroundN;c++){var d=b.name.replace("{{i}}",c),e=b.value;a[d]=e}return a},{}),{"line-style":"solid","line-color":"#999","line-fill":"solid","line-cap":"butt","line-opacity":1,"line-outline-width":0,"line-outline-color":"#000","line-gradient-stop-colors":"#999","line-gradient-stop-positions":"0%","control-point-step-size":40,"control-point-weights":.5,"segment-weights":.5,"segment-distances":20,"segment-radii":15,"radius-type":"arc-radius","taxi-turn":"50%","taxi-radius":15,"taxi-turn-min-distance":10,"taxi-direction":"auto","edge-distances":"intersection","curve-style":"haystack","haystack-radius":0,"arrow-scale":1,"loop-direction":"-45deg","loop-sweep":"-90deg","source-distance-from-node":0,"target-distance-from-node":0,"source-endpoint":"outside-to-node","target-endpoint":"outside-to-node","line-dash-pattern":[6,3],"line-dash-offset":0},[{name:"arrow-shape",value:"none"},{name:"arrow-color",value:"#999"},{name:"arrow-fill",value:"filled"},{name:"arrow-width",value:1}].reduce(function(a,b){return wT.arrowPrefixes.forEach(function(c){var d=c+"-"+b.name,e=b.value;a[d]=e}),a},{})),c={},d=0;d<this.properties.length;d++){var e=this.properties[d];if(!e.pointsTo){var f=e.name,g=b[f],h=this.parse(f,g);c[f]=h}}return a.defaultProperties=c,a.defaultProperties},wT.addDefaultStylesheet=function(){this.selector(":parent").css({shape:"rectangle",padding:10,"background-color":"#eee","border-color":"#ccc","border-width":1}).selector("edge").css({width:3}).selector(":loop").css({"curve-style":"bezier"}).selector("edge:compound").css({"curve-style":"bezier","source-endpoint":"outside-to-line","target-endpoint":"outside-to-line"}).selector(":selected").css({"background-color":"#0169D9","line-color":"#0169D9","source-arrow-color":"#0169D9","target-arrow-color":"#0169D9","mid-source-arrow-color":"#0169D9","mid-target-arrow-color":"#0169D9"}).selector(":parent:selected").css({"background-color":"#CCE1F9","border-color":"#aec8e5"}).selector(":active").css({"overlay-color":"black","overlay-padding":10,"overlay-opacity":.25}),this.defaultLength=this.length};var wU={};wU.parse=function(a,b,c,d){if(rq(b))return this.parseImplWarn(a,b,c,d);var e,f=sc(a,""+b,c?"t":"f","mapping"===d||!0===d||!1===d||null==d?"dontcare":d),g=this.propCache=this.propCache||[];return(e=g[f])||(e=g[f]=this.parseImplWarn(a,b,c,d)),(c||"mapping"===d)&&(e=sp(e))&&(e.value=sp(e.value)),e},wU.parseImplWarn=function(a,b,c,d){var e=this.parseImpl(a,b,c,d);return e||null==b||so("The style property `".concat(a,": ").concat(b,"` is invalid")),e&&("width"===e.name||"height"===e.name)&&"label"===b&&so("The style value of `label` is deprecated for `"+e.name+"`"),e},wU.parseImpl=function(a,b,c,d){a=rD(a);var e=this.properties[a],f=b,g=this.types;if(!e||void 0===b)return null;e.alias&&(a=(e=e.pointsTo).name);var h=rp(b);h&&(b=b.trim());var i=e.type;if(!i)return null;if(c&&(""===b||null===b))return{name:a,value:b,bypass:!0,deleteBypass:!0};if(rq(b))return{name:a,value:b,strValue:"fn",mapped:g.fn,bypass:c};if(!h||d||b.length<7||"a"!==b[1]);else if(b.length>=7&&"d"===b[0]&&(q=new RegExp(g.data.regex).exec(b))){if(c)return!1;var j=g.data;return{name:a,value:q,strValue:""+b,mapped:j,field:q[1],bypass:c}}else if(b.length>=10&&"m"===b[0]&&(r=new RegExp(g.mapData.regex).exec(b))){if(c||i.multiple)return!1;var k=g.mapData;if(!(i.color||i.number))return!1;var l=this.parse(a,r[4]);if(!l||l.mapped)return!1;var n=this.parse(a,r[5]);if(!n||n.mapped)return!1;if(l.pfValue===n.pfValue||l.strValue===n.strValue)return so("`"+a+": "+b+"` is not a valid mapper because the output range is zero; converting to `"+a+": "+l.strValue+"`"),this.parse(a,l.strValue);if(i.color){var o=l.value,p=n.value;if(o[0]===p[0]&&o[1]===p[1]&&o[2]===p[2]&&(o[3]===p[3]||(null==o[3]||1===o[3])&&(null==p[3]||1===p[3])))return!1}return{name:a,value:r,strValue:""+b,mapped:k,field:r[1],fieldMin:parseFloat(r[2]),fieldMax:parseFloat(r[3]),valueMin:l.value,valueMax:n.value,bypass:c}}if(i.multiple&&"multiple"!==d){if(s=h?b.split(/\s+/):rr(b)?b:[b],i.evenMultiple&&s.length%2!=0)return null;for(var q,r,s,t=[],u=[],v=[],w="",x=!1,y=0;y<s.length;y++){var z=this.parse(a,s[y],c,"multiple");x=x||rp(z.value),t.push(z.value),v.push(null!=z.pfValue?z.pfValue:z.value),u.push(z.units),w+=(y>0?" ":"")+z.strValue}if(i.validate&&!i.validate(t,u))return null;if(i.singleEnum&&x)if(1===t.length&&rp(t[0]))return{name:a,value:t[0],strValue:t[0],bypass:c};else return null;return{name:a,value:t,pfValue:v,strValue:w,bypass:c,units:u}}var A=function(){for(var d=0;d<i.enums.length;d++)if(i.enums[d]===b)return{name:a,value:b,strValue:""+b,bypass:c};return null};if(i.number){var B,C,D="px";if(i.units&&(C=i.units),i.implicitUnits&&(D=i.implicitUnits),!i.unitless)if(h){var E="px|em"+(i.allowPercent?"|\\%":"");C&&(E=C);var F=b.match("^("+rI+")("+E+")?$");F&&(b=F[1],C=F[2]||D)}else(!C||i.implicitUnits)&&(C=D);if(isNaN(b=parseFloat(b))&&void 0===i.enums)return null;if(isNaN(b)&&void 0!==i.enums)return b=f,A();if(i.integer&&!(rt(B=b)&&Math.floor(B)===B)||void 0!==i.min&&(b<i.min||i.strictMin&&b===i.min)||void 0!==i.max&&(b>i.max||i.strictMax&&b===i.max))return null;var G={name:a,value:b,strValue:""+b+(C||""),units:C,bypass:c};return i.unitless||"px"!==C&&"em"!==C?G.pfValue=b:G.pfValue="px"!==C&&C?this.getEmSizeInPixels()*b:b,("ms"===C||"s"===C)&&(G.pfValue="ms"===C?b:1e3*b),("deg"===C||"rad"===C)&&(G.pfValue="rad"===C?b:Math.PI*b/180),"%"===C&&(G.pfValue=b/100),G}if(i.propList){var H=[],I=""+b;if("none"===I);else{for(var J=I.split(/\s*,\s*|\s+/),K=0;K<J.length;K++){var L=J[K].trim();this.properties[L]?H.push(L):so("`"+L+"` is not a valid property name")}if(0===H.length)return null}return{name:a,value:H,strValue:0===H.length?"none":H.join(" "),bypass:c}}if(i.color){var M=rS(b);return M?{name:a,value:M,pfValue:M,strValue:"rgb("+M[0]+","+M[1]+","+M[2]+")",bypass:c}:null}if(i.regex||i.regexes){if(i.enums){var N=A();if(N)return N}for(var O=i.regexes?i.regexes:[i.regex],P=0;P<O.length;P++){var Q=new RegExp(O[P]).exec(b);if(Q)return{name:a,value:i.singleRegexMatchValue?Q[1]:Q,strValue:""+b,bypass:c}}return null}if(i.string)return{name:a,value:""+b,strValue:""+b,bypass:c};else if(i.enums)return A();else return null};var wV=function(a){return this instanceof wV?ry(a)?void(this._private={cy:a,coreStyle:{}},this.length=0,this.resetToDefault()):void sm("A style must have a core reference"):new wV(a)},wW=wV.prototype;wW.instanceString=function(){return"style"},wW.clear=function(){for(var a=this._private,b=a.cy.elements(),c=0;c<this.length;c++)this[c]=void 0;return this.length=0,a.contextStyles={},a.propDiffs={},this.cleanElements(b,!0),b.forEach(function(a){var b=a[0]._private;b.styleDirty=!0,b.appliedInitStyle=!1}),this},wW.resetToDefault=function(){return this.clear(),this.addDefaultStylesheet(),this},wW.core=function(a){return this._private.coreStyle[a]||this.getDefaultProperty(a)},wW.selector=function(a){var b="core"===a?null:new vl(a),c=this.length++;return this[c]={selector:b,properties:[],mappedProperties:[],index:c},this},wW.css=function(){var a=arguments;if(1===a.length)for(var b=a[0],c=0;c<this.properties.length;c++){var d=this.properties[c],e=b[d.name];void 0===e&&(e=b[rE(d.name)]),void 0!==e&&this.cssRule(d.name,e)}else 2===a.length&&this.cssRule(a[0],a[1]);return this},wW.style=wW.css,wW.cssRule=function(a,b){var c=this.parse(a,b);if(c){var d=this.length-1;this[d].properties.push(c),this[d].properties[c.name]=c,c.name.match(/pie-(\d+)-background-size/)&&c.value&&(this._private.hasPie=!0),c.name.match(/stripe-(\d+)-background-size/)&&c.value&&(this._private.hasStripe=!0),c.mapped&&this[d].mappedProperties.push(c),this[d].selector||(this._private.coreStyle[c.name]=c)}return this},wW.append=function(a){return rz(a)?a.appendToStyle(this):rr(a)?this.appendFromJson(a):rp(a)&&this.appendFromString(a),this},wV.fromJson=function(a,b){var c=new wV(a);return c.fromJson(b),c},wV.fromString=function(a,b){return new wV(a).fromString(b)},[wN,wO,wP,wQ,wR,wS,wT,wU].forEach(function(a){rO(wW,a)}),wV.types=wW.types,wV.properties=wW.properties,wV.propertyGroups=wW.propertyGroups,wV.propertyGroupNames=wW.propertyGroupNames,wV.propertyGroupKeys=wW.propertyGroupKeys;var wX={autolock:function(a){return void 0===a?this._private.autolock:(this._private.autolock=!!a,this)},autoungrabify:function(a){return void 0===a?this._private.autoungrabify:(this._private.autoungrabify=!!a,this)},autounselectify:function(a){return void 0===a?this._private.autounselectify:(this._private.autounselectify=!!a,this)},selectionType:function(a){var b=this._private;return(null==b.selectionType&&(b.selectionType="single"),void 0===a)?b.selectionType:(("additive"===a||"single"===a)&&(b.selectionType=a),this)},panningEnabled:function(a){return void 0===a?this._private.panningEnabled:(this._private.panningEnabled=!!a,this)},userPanningEnabled:function(a){return void 0===a?this._private.userPanningEnabled:(this._private.userPanningEnabled=!!a,this)},zoomingEnabled:function(a){return void 0===a?this._private.zoomingEnabled:(this._private.zoomingEnabled=!!a,this)},userZoomingEnabled:function(a){return void 0===a?this._private.userZoomingEnabled:(this._private.userZoomingEnabled=!!a,this)},boxSelectionEnabled:function(a){return void 0===a?this._private.boxSelectionEnabled:(this._private.boxSelectionEnabled=!!a,this)},pan:function(){var a,b,c,d,e,f=arguments,g=this._private.pan;switch(f.length){case 0:return g;case 1:if(rp(f[0]))return g[a=f[0]];if(rs(f[0])){if(!this._private.panningEnabled)return this;d=(c=f[0]).x,e=c.y,rt(d)&&(g.x=d),rt(e)&&(g.y=e),this.emit("pan viewport")}break;case 2:if(!this._private.panningEnabled)return this;a=f[0],b=f[1],("x"===a||"y"===a)&&rt(b)&&(g[a]=b),this.emit("pan viewport")}return this.notify("viewport"),this},panBy:function(a,b){var c,d,e,f=arguments,g=this._private.pan;if(!this._private.panningEnabled)return this;switch(f.length){case 1:rs(a)&&(d=(c=f[0]).x,e=c.y,rt(d)&&(g.x+=d),rt(e)&&(g.y+=e),this.emit("pan viewport"));break;case 2:("x"===a||"y"===a)&&rt(b)&&(g[a]+=b),this.emit("pan viewport")}return this.notify("viewport"),this},gc:function(){this.notify("gc")},fit:function(a,b){var c=this.getFitViewport(a,b);if(c){var d=this._private;d.zoom=c.zoom,d.pan=c.pan,this.emit("pan zoom viewport"),this.notify("viewport")}return this},getFitViewport:function(a,b){if(rt(a)&&void 0===b&&(b=a,a=void 0),this._private.panningEnabled&&this._private.zoomingEnabled){if(rp(a)){var c,d,e,f=a;a=this.$(f)}else if(rs(c=a)&&rt(c.x1)&&rt(c.x2)&&rt(c.y1)&&rt(c.y2)){var g=a;(d={x1:g.x1,y1:g.y1,x2:g.x2,y2:g.y2}).w=d.x2-d.x1,d.h=d.y2-d.y1}else rv(a)||(a=this.mutableElements());if(!(rv(a)&&a.empty())){d=d||a.boundingBox();var h=this.width(),i=this.height();if(b=rt(b)?b:0,!isNaN(h)&&!isNaN(i)&&h>0&&i>0&&!isNaN(d.w)&&!isNaN(d.h)&&d.w>0&&d.h>0){e=(e=(e=Math.min((h-2*b)/d.w,(i-2*b)/d.h))>this._private.maxZoom?this._private.maxZoom:e)<this._private.minZoom?this._private.minZoom:e;var j={x:(h-e*(d.x1+d.x2))/2,y:(i-e*(d.y1+d.y2))/2};return{zoom:e,pan:j}}}}},zoomRange:function(a,b){var c=this._private;if(null==b){var d=a;a=d.min,b=d.max}return rt(a)&&rt(b)&&a<=b?(c.minZoom=a,c.maxZoom=b):rt(a)&&void 0===b&&a<=c.maxZoom?c.minZoom=a:rt(b)&&void 0===a&&b>=c.minZoom&&(c.maxZoom=b),this},minZoom:function(a){return void 0===a?this._private.minZoom:this.zoomRange({min:a})},maxZoom:function(a){return void 0===a?this._private.maxZoom:this.zoomRange({max:a})},getZoomedViewport:function(a){var b,c,d=this._private,e=d.pan,f=d.zoom,g=!1;if(d.zoomingEnabled||(g=!0),rt(a)?c=a:rs(a)&&(c=a.level,null!=a.position?b=sQ(a.position,f,e):null!=a.renderedPosition&&(b=a.renderedPosition),null==b||d.panningEnabled||(g=!0)),c=(c=c>d.maxZoom?d.maxZoom:c)<d.minZoom?d.minZoom:c,g||!rt(c)||c===f||null!=b&&(!rt(b.x)||!rt(b.y)))return null;if(null==b)return{zoomed:!0,panned:!1,zoom:c,pan:e};var h=c,i={x:-h/f*(b.x-e.x)+b.x,y:-h/f*(b.y-e.y)+b.y};return{zoomed:!0,panned:!0,zoom:h,pan:i}},zoom:function(a){if(void 0===a)return this._private.zoom;var b=this.getZoomedViewport(a),c=this._private;return null!=b&&b.zoomed&&(c.zoom=b.zoom,b.panned&&(c.pan.x=b.pan.x,c.pan.y=b.pan.y),this.emit("zoom"+(b.panned?" pan":"")+" viewport"),this.notify("viewport")),this},viewport:function(a){var b=this._private,c=!0,d=!0,e=[],f=!1;if(!a||(rt(a.zoom)||(c=!1),rs(a.pan)||(d=!1),!c&&!d))return this;if(c){var g=a.zoom;g<b.minZoom||g>b.maxZoom||!b.zoomingEnabled?f=!0:(b.zoom=g,e.push("zoom"))}if(d&&(!f||!a.cancelOnFailedZoom)&&b.panningEnabled){var h=a.pan;rt(h.x)&&(b.pan.x=h.x),rt(h.y)&&(b.pan.y=h.y),e.push("pan")}return e.length>0&&(e.push("viewport"),this.emit(e.join(" ")),this.notify("viewport")),this},center:function(a){var b=this.getCenterPan(a);return b&&(this._private.pan=b,this.emit("pan viewport"),this.notify("viewport")),this},getCenterPan:function(a,b){if(this._private.panningEnabled){if(rp(a)){var c=a;a=this.mutableElements().filter(c)}else rv(a)||(a=this.mutableElements());if(0!==a.length){var d=a.boundingBox(),e=this.width(),f=this.height();return{x:(e-(b=void 0===b?this._private.zoom:b)*(d.x1+d.x2))/2,y:(f-b*(d.y1+d.y2))/2}}}},reset:function(){return this._private.panningEnabled&&this._private.zoomingEnabled&&this.viewport({pan:{x:0,y:0},zoom:1}),this},invalidateSize:function(){this._private.sizeCache=null},size:function(){var a,b,c=this._private,d=c.container;return c.sizeCache=c.sizeCache||(d?(a=this.window().getComputedStyle(d),b=function(b){return parseFloat(a.getPropertyValue(b))},{width:d.clientWidth-b("padding-left")-b("padding-right"),height:d.clientHeight-b("padding-top")-b("padding-bottom")}):{width:1,height:1})},width:function(){return this.size().width},height:function(){return this.size().height},extent:function(){var a=this._private.pan,b=this._private.zoom,c=this.renderedExtent(),d={x1:(c.x1-a.x)/b,x2:(c.x2-a.x)/b,y1:(c.y1-a.y)/b,y2:(c.y2-a.y)/b};return d.w=d.x2-d.x1,d.h=d.y2-d.y1,d},renderedExtent:function(){var a=this.width(),b=this.height();return{x1:0,y1:0,x2:a,y2:b,w:a,h:b}},multiClickDebounceTime:function(a){return a?(this._private.multiClickDebounceTime=a,this):this._private.multiClickDebounceTime}};wX.centre=wX.center,wX.autolockNodes=wX.autolock,wX.autoungrabifyNodes=wX.autoungrabify;var wY={data:u3.data({field:"data",bindingEvent:"data",allowBinding:!0,allowSetting:!0,settingEvent:"data",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0,updateStyle:!0}),removeData:u3.removeData({field:"data",event:"data",triggerFnName:"trigger",triggerEvent:!0,updateStyle:!0}),scratch:u3.data({field:"scratch",bindingEvent:"scratch",allowBinding:!0,allowSetting:!0,settingEvent:"scratch",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0,updateStyle:!0}),removeScratch:u3.removeData({field:"scratch",event:"scratch",triggerFnName:"trigger",triggerEvent:!0,updateStyle:!0})};wY.attr=wY.data,wY.removeAttr=wY.removeData;var wZ=function(a){var b=this,c=(a=rO({},a)).container;c&&!ru(c)&&ru(c[0])&&(c=c[0]);var d=c?c._cyreg:null;(d=d||{}).cy&&(d.cy.destroy(),d={});var e=d.readies=d.readies||[];c&&(c._cyreg=d),d.cy=b;var f=void 0!==c&&!a.headless,g=a;g.layout=rO({name:f?"grid":"null"},g.layout),g.renderer=rO({name:f?"canvas":"null"},g.renderer);var h=function(a,b,c){return void 0!==b?b:void 0!==c?c:a},i=this._private={container:c,ready:!1,options:g,elements:new wu(this),listeners:[],aniEles:new wu(this),data:g.data||{},scratch:{},layout:null,renderer:null,destroyed:!1,notificationsEnabled:!0,minZoom:1e-50,maxZoom:1e50,zoomingEnabled:h(!0,g.zoomingEnabled),userZoomingEnabled:h(!0,g.userZoomingEnabled),panningEnabled:h(!0,g.panningEnabled),userPanningEnabled:h(!0,g.userPanningEnabled),boxSelectionEnabled:h(!0,g.boxSelectionEnabled),autolock:h(!1,g.autolock,g.autolockNodes),autoungrabify:h(!1,g.autoungrabify,g.autoungrabifyNodes),autounselectify:h(!1,g.autounselectify),styleEnabled:void 0===g.styleEnabled?f:g.styleEnabled,zoom:rt(g.zoom)?g.zoom:1,pan:{x:rs(g.pan)&&rt(g.pan.x)?g.pan.x:0,y:rs(g.pan)&&rt(g.pan.y)?g.pan.y:0},animation:{current:[],queue:[]},hasCompoundNodes:!1,multiClickDebounceTime:h(250,g.multiClickDebounceTime)};this.createEmitter(),this.selectionType(g.selectionType),this.zoomRange({min:g.minZoom,max:g.maxZoom}),i.styleEnabled&&b.setStyle([]);var j=rO({},g,g.renderer);b.initRenderer(j);var k=function(a,c,d){b.notifications(!1);var e=b.mutableElements();e.length>0&&e.remove(),null!=a&&(rs(a)||rr(a))&&b.add(a),b.one("layoutready",function(a){b.notifications(!0),b.emit(a),b.one("load",c),b.emitAndNotify("load")}).one("layoutstop",function(){b.one("done",d),b.emit("done")});var f=rO({},b._private.options.layout);f.eles=b.elements(),b.layout(f).run()};!function(a,b){if(a.some(rB))return uO.all(a).then(b);b(a)}([g.style,g.elements],function(a){var c=a[0],f=a[1];i.styleEnabled&&b.style().append(c),k(f,function(){b.startAnimationLoop(),i.ready=!0,rq(g.ready)&&b.on("ready",g.ready);for(var a=0;a<e.length;a++){var c=e[a];b.on("ready",c)}d&&(d.readies=[]),b.emit("ready")},g.done)})},w$=wZ.prototype;rO(w$,{instanceString:function(){return"core"},isReady:function(){return this._private.ready},destroyed:function(){return this._private.destroyed},ready:function(a){return this.isReady()?this.emitter().emit("ready",[],a):this.on("ready",a),this},destroy:function(){if(!this.destroyed())return this.stopAnimationLoop(),this.destroyRenderer(),this.emit("destroy"),this._private.destroyed=!0,this},hasElementWithId:function(a){return this._private.elements.hasElementWithId(a)},getElementById:function(a){return this._private.elements.getElementById(a)},hasCompoundNodes:function(){return this._private.hasCompoundNodes},headless:function(){return this._private.renderer.isHeadless()},styleEnabled:function(){return this._private.styleEnabled},addToPool:function(a){return this._private.elements.merge(a),this},removeFromPool:function(a){return this._private.elements.unmerge(a),this},container:function(){return this._private.container||null},window:function(){if(null==this._private.container)return null;var a=this._private.container.ownerDocument;return void 0===a||null==a?null:a.defaultView||null},mount:function(a){if(null!=a){var b=this._private,c=b.options;return!ru(a)&&ru(a[0])&&(a=a[0]),this.stopAnimationLoop(),this.destroyRenderer(),b.container=a,b.styleEnabled=!0,this.invalidateSize(),this.initRenderer(rO({},c,c.renderer,{name:"null"===c.renderer.name?"canvas":c.renderer.name})),this.startAnimationLoop(),this.style(c.style),this.emit("mount"),this}},unmount:function(){return this.stopAnimationLoop(),this.destroyRenderer(),this.initRenderer({name:"null"}),this.emit("unmount"),this},options:function(){return sp(this._private.options)},json:function(a){var b=this,c=b._private,d=b.mutableElements();if(rs(a)){if(b.startBatch(),a.elements){var e={},f=function(a,c){for(var d=[],f=[],g=0;g<a.length;g++){var h=a[g];if(!h.data.id){so("cy.json() cannot handle elements without an ID attribute");continue}var i=""+h.data.id,j=b.getElementById(i);e[i]=!0,0!==j.length?f.push({ele:j,json:h}):(c&&(h.group=c),d.push(h))}b.add(d);for(var k=0;k<f.length;k++){var l=f[k],n=l.ele,o=l.json;n.json(o)}};if(rr(a.elements))f(a.elements);else for(var g=["nodes","edges"],h=0;h<g.length;h++){var i=g[h],j=a.elements[i];rr(j)&&f(j,i)}var k=b.collection();d.filter(function(a){return!e[a.id()]}).forEach(function(a){a.isParent()?k.merge(a):a.remove()}),k.forEach(function(a){return a.children().move({parent:null})}),k.forEach(function(a){return b.getElementById(a.id()).remove()})}a.style&&b.style(a.style),null!=a.zoom&&a.zoom!==c.zoom&&b.zoom(a.zoom),a.pan&&(a.pan.x!==c.pan.x||a.pan.y!==c.pan.y)&&b.pan(a.pan),a.data&&b.data(a.data);for(var l=["minZoom","maxZoom","zoomingEnabled","userZoomingEnabled","panningEnabled","userPanningEnabled","boxSelectionEnabled","autolock","autoungrabify","autounselectify","multiClickDebounceTime"],n=0;n<l.length;n++){var o=l[n];null!=a[o]&&b[o](a[o])}return b.endBatch(),this}var p={};a?p.elements=this.elements().map(function(a){return a.json()}):(p.elements={},d.forEach(function(a){var b=a.group();p.elements[b]||(p.elements[b]=[]),p.elements[b].push(a.json())})),this._private.styleEnabled&&(p.style=b.style().json()),p.data=sp(b.data());var q=c.options;return p.zoomingEnabled=c.zoomingEnabled,p.userZoomingEnabled=c.userZoomingEnabled,p.zoom=c.zoom,p.minZoom=c.minZoom,p.maxZoom=c.maxZoom,p.panningEnabled=c.panningEnabled,p.userPanningEnabled=c.userPanningEnabled,p.pan=sp(c.pan),p.boxSelectionEnabled=c.boxSelectionEnabled,p.renderer=sp(q.renderer),p.hideEdgesOnViewport=q.hideEdgesOnViewport,p.textureOnViewport=q.textureOnViewport,p.wheelSensitivity=q.wheelSensitivity,p.motionBlur=q.motionBlur,p.multiClickDebounceTime=q.multiClickDebounceTime,p}}),w$.$id=w$.getElementById,[{add:function(a){var b;if(rv(a))if(a._private.cy===this)b=a.restore();else{for(var c=[],d=0;d<a.length;d++){var e=a[d];c.push(e.json())}b=new wu(this,c)}else if(rr(a))b=new wu(this,a);else if(rs(a)&&(rr(a.nodes)||rr(a.edges))){for(var f=[],g=["nodes","edges"],h=0,i=g.length;h<i;h++){var j=g[h],k=a[j];if(rr(k))for(var l=0,n=k.length;l<n;l++){var o=rO({group:j},k[l]);f.push(o)}}b=new wu(this,f)}else b=new sD(this,a).collection();return b},remove:function(a){if(rv(a));else if(rp(a)){var b=a;a=this.$(b)}return a.remove()}},wE,wH,wI,wJ,{notify:function(a,b){var c=this._private;if(this.batching()){c.batchNotifications=c.batchNotifications||{};var d=c.batchNotifications[a]=c.batchNotifications[a]||this.collection();null!=b&&d.merge(b);return}if(c.notificationsEnabled){var e=this.renderer();!this.destroyed()&&e&&e.notify(a,b)}},notifications:function(a){var b=this._private;return void 0===a?b.notificationsEnabled:(b.notificationsEnabled=!!a,this)},noNotifications:function(a){this.notifications(!1),a(),this.notifications(!0)},batching:function(){return this._private.batchCount>0},startBatch:function(){var a=this._private;return null==a.batchCount&&(a.batchCount=0),0===a.batchCount&&(a.batchStyleEles=this.collection(),a.batchNotifications={}),a.batchCount++,this},endBatch:function(){var a=this._private;if(0===a.batchCount)return this;if(a.batchCount--,0===a.batchCount){a.batchStyleEles.updateStyle();var b=this.renderer();Object.keys(a.batchNotifications).forEach(function(c){var d=a.batchNotifications[c];d.empty()?b.notify(c):b.notify(c,d)})}return this},batch:function(a){return this.startBatch(),a(),this.endBatch(),this},batchData:function(a){var b=this;return this.batch(function(){for(var c=Object.keys(a),d=0;d<c.length;d++){var e=c[d],f=a[e];b.getElementById(e).data(f)}})}},wL,wM,{style:function(a){return a&&this.setStyle(a).update(),this._private.style},setStyle:function(a){var b=this._private;return rz(a)?b.style=a.generateStyle(this):rr(a)?b.style=wV.fromJson(this,a):rp(a)?b.style=wV.fromString(this,a):b.style=wV(this),b.style},updateStyle:function(){this.mutableElements().updateStyle()}},wX,wY].forEach(function(a){rO(w$,a)});var w_={fit:!0,directed:!1,direction:"downward",padding:30,circle:!1,grid:!1,spacingFactor:1.75,boundingBox:void 0,avoidOverlap:!0,nodeDimensionsIncludeLabels:!1,roots:void 0,depthSort:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(a,b){return!0},ready:void 0,stop:void 0,transform:function(a,b){return b}},w0={maximal:!1,acyclic:!1},w1=function(a){return a.scratch("breadthfirst")},w2=function(a,b){return a.scratch("breadthfirst",b)};function w3(a){this.options=rO({},w_,w0,a)}w3.prototype.run=function(){var a,b=this.options,c=b.cy,d=b.eles,e=d.nodes().filter(function(a){return a.isChildless()}),f=b.directed,g=b.acyclic||b.maximal||b.maximalAdjustments>0,h=!!b.boundingBox,i=s5(h?b.boundingBox:structuredClone(c.extent()));if(rv(b.roots))a=b.roots;else if(rr(b.roots)){for(var j=[],k=0;k<b.roots.length;k++){var l=b.roots[k],n=c.getElementById(l);j.push(n)}a=c.collection(j)}else if(rp(b.roots))a=c.$(b.roots);else if(f)a=e.roots();else{var o=d.components();a=c.collection();for(var p=0;p<o.length;p++)!function(){var b=o[p],c=b.maxDegree(!1),d=b.filter(function(a){return a.degree(!1)===c});a=a.add(d)}()}var q=[],r={},s=function(a,b){null==q[b]&&(q[b]=[]);var c=q[b].length;q[b].push(a),w2(a,{index:c,depth:b})},t=function(a,b){var c=w1(a),d=c.depth,e=c.index;q[d][e]=null,a.isChildless()&&s(a,b)};d.bfs({roots:a,directed:b.directed,visit:function(a,b,c,d,e){var f=a[0],g=f.id();f.isChildless()&&s(f,e),r[g]=!0}});for(var u=[],v=0;v<e.length;v++){var w=e[v];r[w.id()]||u.push(w)}var x=function(a){for(var b=q[a],c=0;c<b.length;c++){var d=b[c];if(null==d){b.splice(c,1),c--;continue}w2(d,{depth:a,index:c})}};if(f&&g){var y=[],z={},A=function(a){return y.push(a)};for(e.forEach(function(a){return y.push(a)});y.length>0;){var B=y.shift(),C=function(a,c){for(var e=w1(a),f=a.incomers().filter(function(a){return a.isNode()&&d.has(a)}),g=-1,h=a.id(),i=0;i<f.length;i++)g=Math.max(g,w1(f[i]).depth);if(e.depth<=g){if(!b.acyclic&&c[h])return null;var j=g+1;return t(a,j),c[h]=j,!0}return!1}(B,z);if(C)B.outgoers().filter(function(a){return a.isNode()&&d.has(a)}).forEach(A);else if(null===C){so("Detected double maximal shift for node `"+B.id()+"`.  Bailing maximal adjustment due to cycle.  Use `options.maximal: true` only on DAGs.");break}}}var D=0;if(b.avoidOverlap)for(var E=0;E<e.length;E++){var F=e[E].layoutDimensions(b),G=F.w,H=F.h;D=Math.max(D,G,H)}var I={},J=function(a){if(I[a.id()])return I[a.id()];for(var b=w1(a).depth,c=a.neighborhood(),d=0,f=0,g=0;g<c.length;g++){var h=c[g];if(!(h.isEdge()||h.isParent())&&e.has(h)){var i=w1(h);if(null!=i){var j=i.index,k=i.depth;if(null!=j&&null!=k){var l=q[k].length;k<b&&(d+=j/l,f++)}}}}return d/=f=Math.max(1,f),0===f&&(d=0),I[a.id()]=d,d},K=function(a,b){var c=J(a)-J(b);return 0===c?rN(a.id(),b.id()):c};void 0!==b.depthSort&&(K=b.depthSort);for(var L=q.length,M=0;M<L;M++)q[M].sort(K),x(M);for(var N=[],O=0;O<u.length;O++)N.push(u[O]);if(N.length){q.unshift(N),L=q.length;for(var P=0;P<L;P++)x(P)}for(var Q=0,R=0;R<L;R++)Q=Math.max(q[R].length,Q);var S={x:i.x1+i.w/2,y:i.y1+i.h/2},T=e.reduce(function(a,c){var d;return d=c.boundingBox({includeLabels:b.nodeDimensionsIncludeLabels}),{w:-1===a.w?d.w:(a.w+d.w)/2,h:-1===a.h?d.h:(a.h+d.h)/2}},{w:-1,h:-1}),U=Math.max(1===L?0:h?(i.h-2*b.padding-T.h)/(L-1):(i.h-2*b.padding-T.h)/(L+1),D),V=q.reduce(function(a,b){return Math.max(a,b.length)},0),W=function(a){var c=w1(a),d=c.depth,e=c.index;if(b.circle){var f=Math.min(i.w/2/L,i.h/2/L),g=(f=Math.max(f,D))*d+f-(L>0&&q[0].length<=3?f/2:0),j=2*Math.PI/q[d].length*e;return 0===d&&1===q[0].length&&(g=1),{x:S.x+g*Math.cos(j),y:S.y+g*Math.sin(j)}}var k=q[d].length,l=Math.max(1===k?0:h?(i.w-2*b.padding-T.w)/((b.grid?V:k)-1):(i.w-2*b.padding-T.w)/((b.grid?V:k)+1),D);return{x:S.x+(e+1-(k+1)/2)*l,y:S.y+(d+1-(L+1)/2)*U}},X={downward:0,leftward:90,upward:180,rightward:-90};return -1===Object.keys(X).indexOf(b.direction)&&sm("Invalid direction '".concat(b.direction,"' specified for breadthfirst layout. Valid values are: ").concat(Object.keys(X).join(", "))),d.nodes().layoutPositions(this,b,function(a){return function(a,b,c){if(0===c)return a;var d,e,f,g,h=(b.x1+b.x2)/2,i=(b.y1+b.y2)/2,j=b.w/b.h,k=(d=a.x,e=a.y,{x:Math.cos(f=c*Math.PI/180)*(d-h)-Math.sin(f)*(e-i)+h,y:Math.sin(f)*(d-h)+Math.cos(f)*(e-i)+i}),l=(g=k.x,{x:(g-h)*j+h,y:(k.y-i)*(1/j)+i});return{x:l.x,y:l.y}}(W(a),i,X[b.direction])}),this};var w4={fit:!0,padding:30,boundingBox:void 0,avoidOverlap:!0,nodeDimensionsIncludeLabels:!1,spacingFactor:void 0,radius:void 0,startAngle:1.5*Math.PI,sweep:void 0,clockwise:!0,sort:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(a,b){return!0},ready:void 0,stop:void 0,transform:function(a,b){return b}};function w5(a){this.options=rO({},w4,a)}w5.prototype.run=function(){var a,b=this.options,c=b.cy,d=b.eles,e=void 0!==b.counterclockwise?!b.counterclockwise:b.clockwise,f=d.nodes().not(":parent");b.sort&&(f=f.sort(b.sort));for(var g=s5(b.boundingBox?b.boundingBox:{x1:0,y1:0,w:c.width(),h:c.height()}),h={x:g.x1+g.w/2,y:g.y1+g.h/2},i=(void 0===b.sweep?2*Math.PI-2*Math.PI/f.length:b.sweep)/Math.max(1,f.length-1),j=0,k=0;k<f.length;k++){var l=f[k].layoutDimensions(b);j=Math.max(j,l.w,l.h)}if(a=rt(b.radius)?b.radius:f.length<=1?0:Math.min(g.h,g.w)/2-j,f.length>1&&b.avoidOverlap){var n=Math.cos(i)-1,o=Math.sin(i)-0;a=Math.max(Math.sqrt((j*=1.75)*j/(n*n+o*o)),a)}return d.nodes().layoutPositions(this,b,function(c,d){var f=b.startAngle+d*i*(e?1:-1),g=a*Math.cos(f),j=a*Math.sin(f);return{x:h.x+g,y:h.y+j}}),this};var w6={fit:!0,padding:30,startAngle:1.5*Math.PI,sweep:void 0,clockwise:!0,equidistant:!1,minNodeSpacing:10,boundingBox:void 0,avoidOverlap:!0,nodeDimensionsIncludeLabels:!1,height:void 0,width:void 0,spacingFactor:void 0,concentric:function(a){return a.degree()},levelWidth:function(a){return a.maxDegree()/4},animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(a,b){return!0},ready:void 0,stop:void 0,transform:function(a,b){return b}};function w7(a){this.options=rO({},w6,a)}w7.prototype.run=function(){for(var a=this.options,b=void 0!==a.counterclockwise?!a.counterclockwise:a.clockwise,c=a.cy,d=a.eles,e=d.nodes().not(":parent"),f=s5(a.boundingBox?a.boundingBox:{x1:0,y1:0,w:c.width(),h:c.height()}),g={x:f.x1+f.w/2,y:f.y1+f.h/2},h=[],i=0,j=0;j<e.length;j++){var k=e[j],l=void 0;l=a.concentric(k),h.push({value:l,node:k}),k._private.scratch.concentric=l}e.updateStyle();for(var n=0;n<e.length;n++){var o=e[n].layoutDimensions(a);i=Math.max(i,o.w,o.h)}h.sort(function(a,b){return b.value-a.value});for(var p=a.levelWidth(e),q=[[]],r=q[0],s=0;s<h.length;s++){var t=h[s];r.length>0&&Math.abs(r[0].value-t.value)>=p&&(r=[],q.push(r)),r.push(t)}var u=i+a.minNodeSpacing;if(!a.avoidOverlap){var v=q.length>0&&q[0].length>1,w=(Math.min(f.w,f.h)/2-u)/(q.length+v?1:0);u=Math.min(u,w)}for(var x=0,y=0;y<q.length;y++){var z=q[y],A=void 0===a.sweep?2*Math.PI-2*Math.PI/z.length:a.sweep,B=z.dTheta=A/Math.max(1,z.length-1);if(z.length>1&&a.avoidOverlap){var C=Math.cos(B)-1,D=Math.sin(B)-0;x=Math.max(Math.sqrt(u*u/(C*C+D*D)),x)}z.r=x,x+=u}if(a.equidistant){for(var E=0,F=0,G=0;G<q.length;G++)E=Math.max(E,q[G].r-F);F=0;for(var H=0;H<q.length;H++){var I=q[H];0===H&&(F=I.r),I.r=F,F+=E}}for(var J={},K=0;K<q.length;K++)for(var L=q[K],M=L.dTheta,N=L.r,O=0;O<L.length;O++){var P=L[O],Q=a.startAngle+(b?1:-1)*M*O,R={x:g.x+N*Math.cos(Q),y:g.y+N*Math.sin(Q)};J[P.node.id()]=R}return d.nodes().layoutPositions(this,a,function(a){return J[a.id()]}),this};var w8={ready:function(){},stop:function(){},animate:!0,animationEasing:void 0,animationDuration:void 0,animateFilter:function(a,b){return!0},animationThreshold:250,refresh:20,fit:!0,padding:30,boundingBox:void 0,nodeDimensionsIncludeLabels:!1,randomize:!1,componentSpacing:40,nodeRepulsion:function(a){return 2048},nodeOverlap:4,idealEdgeLength:function(a){return 32},edgeElasticity:function(a){return 32},nestingFactor:1.2,gravity:1,numIter:1e3,initialTemp:1e3,coolingFactor:.99,minTemp:1};function w9(a){this.options=rO({},w8,a),this.options.layout=this;var b=this.options.eles.nodes(),c=this.options.eles.edges().filter(function(a){var c=a.source().data("id"),d=a.target().data("id"),e=b.some(function(a){return a.data("id")===c}),f=b.some(function(a){return a.data("id")===d});return!e||!f});this.options.eles=this.options.eles.not(c)}w9.prototype.run=function(){var a=this.options,b=a.cy,c=this;c.stopped=!1,(!0===a.animate||!1===a.animate)&&c.emit({type:"layoutstart",layout:c}),Ag=!0===a.debug;var d=xa(b,c,a);Ag&&Ah(d),a.randomize&&xd(d);var e=r2(),f=function(){xf(d,b,a),!0===a.fit&&b.fit(a.padding)},g=function(b){return!c.stopped&&!(b>=a.numIter)&&(xg(d,a),d.temperature=d.temperature*a.coolingFactor,!(d.temperature<a.minTemp))},h=function(){if(!0===a.animate||!1===a.animate)f(),c.one("layoutstop",a.stop),c.emit({type:"layoutstop",layout:c});else{var b=a.eles.nodes(),e=xe(d,a,b);b.layoutPositions(c,a,e)}},i=0,j=!0;if(!0===a.animate){var k=function(){for(var b=0;j&&b<a.refresh;)j=g(i),i++,b++;j?(r2()-e>=a.animationThreshold&&f(),r4(k)):(xs(d,a),h())};k()}else{for(;j;)j=g(i),i++;xs(d,a),h()}return this},w9.prototype.stop=function(){return this.stopped=!0,this.thread&&this.thread.stop(),this.emit("layoutstop"),this},w9.prototype.destroy=function(){return this.thread&&this.thread.stop(),this};var xa=function(a,b,c){for(var d=c.eles.edges(),e=c.eles.nodes(),f=s5(c.boundingBox?c.boundingBox:{x1:0,y1:0,w:a.width(),h:a.height()}),g={isCompound:a.hasCompoundNodes(),layoutNodes:[],idToIndex:{},nodeSize:e.size(),graphSet:[],indexToGraph:[],layoutEdges:[],edgeSize:d.size(),temperature:c.initialTemp,clientWidth:f.w,clientHeight:f.h,boundingBox:f},h=c.eles.components(),i={},j=0;j<h.length;j++)for(var k=h[j],l=0;l<k.length;l++){var n=k[l];i[n.id()]=j}for(var j=0;j<g.nodeSize;j++){var o=e[j],p=o.layoutDimensions(c),q={};q.isLocked=o.locked(),q.id=o.data("id"),q.parentId=o.data("parent"),q.cmptId=i[o.id()],q.children=[],q.positionX=o.position("x"),q.positionY=o.position("y"),q.offsetX=0,q.offsetY=0,q.height=p.w,q.width=p.h,q.maxX=q.positionX+q.width/2,q.minX=q.positionX-q.width/2,q.maxY=q.positionY+q.height/2,q.minY=q.positionY-q.height/2,q.padLeft=parseFloat(o.style("padding")),q.padRight=parseFloat(o.style("padding")),q.padTop=parseFloat(o.style("padding")),q.padBottom=parseFloat(o.style("padding")),q.nodeRepulsion=rq(c.nodeRepulsion)?c.nodeRepulsion(o):c.nodeRepulsion,g.layoutNodes.push(q),g.idToIndex[q.id]=j}for(var r=[],s=0,t=-1,u=[],j=0;j<g.nodeSize;j++){var o=g.layoutNodes[j],v=o.parentId;null!=v?g.layoutNodes[g.idToIndex[v]].children.push(o.id):(r[++t]=o.id,u.push(o.id))}for(g.graphSet.push(u);s<=t;){var w=r[s++],x=g.idToIndex[w],n=g.layoutNodes[x],y=n.children;if(y.length>0){g.graphSet.push(y);for(var j=0;j<y.length;j++)r[++t]=y[j]}}for(var j=0;j<g.graphSet.length;j++)for(var z=g.graphSet[j],l=0;l<z.length;l++){var A=g.idToIndex[z[l]];g.indexToGraph[A]=j}for(var j=0;j<g.edgeSize;j++){var B=d[j],C={};C.id=B.data("id"),C.sourceId=B.data("source"),C.targetId=B.data("target");var D=rq(c.idealEdgeLength)?c.idealEdgeLength(B):c.idealEdgeLength,E=rq(c.edgeElasticity)?c.edgeElasticity(B):c.edgeElasticity,F=g.idToIndex[C.sourceId],G=g.idToIndex[C.targetId];if(g.indexToGraph[F]!=g.indexToGraph[G]){for(var H=xb(C.sourceId,C.targetId,g),I=g.graphSet[H],J=0,q=g.layoutNodes[F];-1===I.indexOf(q.id);)q=g.layoutNodes[g.idToIndex[q.parentId]],J++;for(q=g.layoutNodes[G];-1===I.indexOf(q.id);)q=g.layoutNodes[g.idToIndex[q.parentId]],J++;D*=J*c.nestingFactor}C.idealLength=D,C.elasticity=E,g.layoutEdges.push(C)}return g},xb=function(a,b,c){var d=xc(a,b,0,c);return 2>d.count?0:d.graph},xc=function(a,b,c,d){var e=d.graphSet[c];if(-1<e.indexOf(a)&&-1<e.indexOf(b))return{count:2,graph:c};for(var f=0,g=0;g<e.length;g++){var h=e[g],i=d.idToIndex[h],j=d.layoutNodes[i].children;if(0!==j.length){var k=xc(a,b,d.indexToGraph[d.idToIndex[j[0]]],d);if(0===k.count)continue;if(1!==k.count)return k;if(2==++f)break}}return{count:f,graph:c}},xd=function(a,b){for(var c=a.clientWidth,d=a.clientHeight,e=0;e<a.nodeSize;e++){var f=a.layoutNodes[e];0!==f.children.length||f.isLocked||(f.positionX=Math.random()*c,f.positionY=Math.random()*d)}},xe=function(a,b,c){var d=a.boundingBox,e={x1:1/0,x2:-1/0,y1:1/0,y2:-1/0};return b.boundingBox&&(c.forEach(function(b){var c=a.layoutNodes[a.idToIndex[b.data("id")]];e.x1=Math.min(e.x1,c.positionX),e.x2=Math.max(e.x2,c.positionX),e.y1=Math.min(e.y1,c.positionY),e.y2=Math.max(e.y2,c.positionY)}),e.w=e.x2-e.x1,e.h=e.y2-e.y1),function(c,f){var g=a.layoutNodes[a.idToIndex[c.data("id")]];if(!b.boundingBox)return{x:g.positionX,y:g.positionY};var h=0===e.w?.5:(g.positionX-e.x1)/e.w,i=0===e.h?.5:(g.positionY-e.y1)/e.h;return{x:d.x1+h*d.w,y:d.y1+i*d.h}}},xf=function(a,b,c){var d=c.layout,e=c.eles.nodes(),f=xe(a,c,e);e.positions(f),!0!==a.ready&&(a.ready=!0,d.one("layoutready",c.ready),d.emit({type:"layoutready",layout:this}))},xg=function(a,b,c){xh(a,b),xm(a),xn(a,b),xo(a),xp(a)},xh=function(a,b){for(var c=0;c<a.graphSet.length;c++)for(var d=a.graphSet[c],e=d.length,f=0;f<e;f++)for(var g=a.layoutNodes[a.idToIndex[d[f]]],h=f+1;h<e;h++)xj(g,a.layoutNodes[a.idToIndex[d[h]]],a,b)},xi=function(a){return -1+2*a*Math.random()},xj=function(a,b,c,d){if(a.cmptId===b.cmptId||c.isCompound){var e=b.positionX-a.positionX,f=b.positionY-a.positionY;0===e&&0===f&&(e=xi(1),f=xi(1));var g=xk(a,b,e,f);if(g>0)var h=d.nodeOverlap*g,i=Math.sqrt(e*e+f*f),j=h*e/i,k=h*f/i;else var l=xl(a,e,f),n=xl(b,-1*e,-1*f),o=n.x-l.x,p=n.y-l.y,q=o*o+p*p,i=Math.sqrt(q),h=(a.nodeRepulsion+b.nodeRepulsion)/q,j=h*o/i,k=h*p/i;a.isLocked||(a.offsetX-=j,a.offsetY-=k),b.isLocked||(b.offsetX+=j,b.offsetY+=k)}},xk=function(a,b,c,d){if(c>0)var e=a.maxX-b.minX;else var e=b.maxX-a.minX;if(d>0)var f=a.maxY-b.minY;else var f=b.maxY-a.minY;return e>=0&&f>=0?Math.sqrt(e*e+f*f):0},xl=function(a,b,c){var d=a.positionX,e=a.positionY,f=a.height||1,g=a.width||1,h=c/b,i=f/g,j={};return 0===b&&0<c||0===b&&0>c?(j.x=d,j.y=e+f/2):0<b&&-1*i<=h&&h<=i?(j.x=d+g/2,j.y=e+g*c/2/b):0>b&&-1*i<=h&&h<=i?(j.x=d-g/2,j.y=e-g*c/2/b):0<c&&(h<=-1*i||h>=i)?(j.x=d+f*b/2/c,j.y=e+f/2):0>c&&(h<=-1*i||h>=i)&&(j.x=d-f*b/2/c,j.y=e-f/2),j},xm=function(a,b){for(var c=0;c<a.edgeSize;c++){var d=a.layoutEdges[c],e=a.idToIndex[d.sourceId],f=a.layoutNodes[e],g=a.idToIndex[d.targetId],h=a.layoutNodes[g],i=h.positionX-f.positionX,j=h.positionY-f.positionY;if(0!==i||0!==j){var k=xl(f,i,j),l=xl(h,-1*i,-1*j),n=l.x-k.x,o=l.y-k.y,p=Math.sqrt(n*n+o*o),q=Math.pow(d.idealLength-p,2)/d.elasticity;if(0!==p)var r=q*n/p,s=q*o/p;else var r=0,s=0;f.isLocked||(f.offsetX+=r,f.offsetY+=s),h.isLocked||(h.offsetX-=r,h.offsetY-=s)}}},xn=function(a,b){if(0!==b.gravity)for(var c=0;c<a.graphSet.length;c++){var d=a.graphSet[c],e=d.length;if(0===c)var f=a.clientHeight/2,g=a.clientWidth/2;else var h=a.layoutNodes[a.idToIndex[d[0]]],i=a.layoutNodes[a.idToIndex[h.parentId]],f=i.positionX,g=i.positionY;for(var j=0;j<e;j++){var k=a.layoutNodes[a.idToIndex[d[j]]];if(!k.isLocked){var l=f-k.positionX,n=g-k.positionY,o=Math.sqrt(l*l+n*n);if(o>1){var p=b.gravity*l/o,q=b.gravity*n/o;k.offsetX+=p,k.offsetY+=q}}}}},xo=function(a,b){var c=[],d=0,e=-1;for(c.push.apply(c,a.graphSet[0]),e+=a.graphSet[0].length;d<=e;){var f=c[d++],g=a.idToIndex[f],h=a.layoutNodes[g],i=h.children;if(0<i.length&&!h.isLocked){for(var j=h.offsetX,k=h.offsetY,l=0;l<i.length;l++){var n=a.layoutNodes[a.idToIndex[i[l]]];n.offsetX+=j,n.offsetY+=k,c[++e]=i[l]}h.offsetX=0,h.offsetY=0}}},xp=function(a,b){for(var c=0;c<a.nodeSize;c++){var d=a.layoutNodes[c];0<d.children.length&&(d.maxX=void 0,d.minX=void 0,d.maxY=void 0,d.minY=void 0)}for(var c=0;c<a.nodeSize;c++){var d=a.layoutNodes[c];if(!(0<d.children.length)&&!d.isLocked){var e=xq(d.offsetX,d.offsetY,a.temperature);d.positionX+=e.x,d.positionY+=e.y,d.offsetX=0,d.offsetY=0,d.minX=d.positionX-d.width,d.maxX=d.positionX+d.width,d.minY=d.positionY-d.height,d.maxY=d.positionY+d.height,xr(d,a)}}for(var c=0;c<a.nodeSize;c++){var d=a.layoutNodes[c];0<d.children.length&&!d.isLocked&&(d.positionX=(d.maxX+d.minX)/2,d.positionY=(d.maxY+d.minY)/2,d.width=d.maxX-d.minX,d.height=d.maxY-d.minY)}},xq=function(a,b,c){var d=Math.sqrt(a*a+b*b);if(d>c)var e={x:c*a/d,y:c*b/d};else var e={x:a,y:b};return e},xr=function(a,b){var c=a.parentId;if(null!=c){var d=b.layoutNodes[b.idToIndex[c]],e=!1;if((null==d.maxX||a.maxX+d.padRight>d.maxX)&&(d.maxX=a.maxX+d.padRight,e=!0),(null==d.minX||a.minX-d.padLeft<d.minX)&&(d.minX=a.minX-d.padLeft,e=!0),(null==d.maxY||a.maxY+d.padBottom>d.maxY)&&(d.maxY=a.maxY+d.padBottom,e=!0),(null==d.minY||a.minY-d.padTop<d.minY)&&(d.minY=a.minY-d.padTop,e=!0),e)return xr(d,b)}},xs=function(a,b){for(var c=a.layoutNodes,d=[],e=0;e<c.length;e++){var f=c[e],g=f.cmptId;(d[g]=d[g]||[]).push(f)}for(var h=0,e=0;e<d.length;e++){var i=d[e];if(i){i.x1=1/0,i.x2=-1/0,i.y1=1/0,i.y2=-1/0;for(var j=0;j<i.length;j++){var k=i[j];i.x1=Math.min(i.x1,k.positionX-k.width/2),i.x2=Math.max(i.x2,k.positionX+k.width/2),i.y1=Math.min(i.y1,k.positionY-k.height/2),i.y2=Math.max(i.y2,k.positionY+k.height/2)}i.w=i.x2-i.x1,i.h=i.y2-i.y1,h+=i.w*i.h}}d.sort(function(a,b){return b.w*b.h-a.w*a.h});for(var l=0,n=0,o=0,p=0,q=Math.sqrt(h)*a.clientWidth/a.clientHeight,e=0;e<d.length;e++){var i=d[e];if(i){for(var j=0;j<i.length;j++){var k=i[j];k.isLocked||(k.positionX+=l-i.x1,k.positionY+=n-i.y1)}l+=i.w+b.componentSpacing,o+=i.w+b.componentSpacing,p=Math.max(p,i.h),o>q&&(n+=p+b.componentSpacing,l=0,o=0,p=0)}}},xt={fit:!0,padding:30,boundingBox:void 0,avoidOverlap:!0,avoidOverlapPadding:10,nodeDimensionsIncludeLabels:!1,spacingFactor:void 0,condense:!1,rows:void 0,cols:void 0,position:function(a){},sort:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(a,b){return!0},ready:void 0,stop:void 0,transform:function(a,b){return b}};function xu(a){this.options=rO({},xt,a)}xu.prototype.run=function(){var a=this.options,b=a.cy,c=a.eles,d=c.nodes().not(":parent");a.sort&&(d=d.sort(a.sort));var e=s5(a.boundingBox?a.boundingBox:{x1:0,y1:0,w:b.width(),h:b.height()});if(0===e.h||0===e.w)c.nodes().layoutPositions(this,a,function(a){return{x:e.x1,y:e.y1}});else{var f=d.size(),g=Math.sqrt(f*e.h/e.w),h=Math.round(g),i=Math.round(e.w/e.h*g),j=function(a){if(null==a)return Math.min(h,i);Math.min(h,i)==h?h=a:i=a},k=function(a){if(null==a)return Math.max(h,i);Math.max(h,i)==h?h=a:i=a},l=a.rows,n=null!=a.cols?a.cols:a.columns;if(null!=l&&null!=n)h=l,i=n;else if(null!=l&&null==n)i=Math.ceil(f/(h=l));else if(null==l&&null!=n)h=Math.ceil(f/(i=n));else if(i*h>f){var o=j(),p=k();(o-1)*p>=f?j(o-1):(p-1)*o>=f&&k(p-1)}else for(;i*h<f;){var q=j(),r=k();(r+1)*q>=f?k(r+1):j(q+1)}var s=e.w/i,t=e.h/h;if(a.condense&&(s=0,t=0),a.avoidOverlap)for(var u=0;u<d.length;u++){var v=d[u],w=v._private.position;(null==w.x||null==w.y)&&(w.x=0,w.y=0);var x=v.layoutDimensions(a),y=a.avoidOverlapPadding,z=x.w+y,A=x.h+y;s=Math.max(s,z),t=Math.max(t,A)}for(var B={},C=function(a,b){return!!B["c-"+a+"-"+b]},D=function(a,b){B["c-"+a+"-"+b]=!0},E=0,F=0,G=function(){++F>=i&&(F=0,E++)},H={},I=0;I<d.length;I++){var J=d[I],K=a.position(J);if(K&&(void 0!==K.row||void 0!==K.col)){var L={row:K.row,col:K.col};if(void 0===L.col)for(L.col=0;C(L.row,L.col);)L.col++;else if(void 0===L.row)for(L.row=0;C(L.row,L.col);)L.row++;H[J.id()]=L,D(L.row,L.col)}}d.layoutPositions(this,a,function(a,b){if(a.locked()||a.isParent())return!1;var c,d,f=H[a.id()];if(f)c=f.col*s+s/2+e.x1,d=f.row*t+t/2+e.y1;else{for(;C(E,F);)G();c=F*s+s/2+e.x1,d=E*t+t/2+e.y1,D(E,F),G()}return{x:c,y:d}})}return this};var xv={ready:function(){},stop:function(){}};function xw(a){this.options=rO({},xv,a)}xw.prototype.run=function(){var a=this.options,b=a.eles;return a.cy,this.emit("layoutstart"),b.nodes().positions(function(){return{x:0,y:0}}),this.one("layoutready",a.ready),this.emit("layoutready"),this.one("layoutstop",a.stop),this.emit("layoutstop"),this},xw.prototype.stop=function(){return this};var xx={positions:void 0,zoom:void 0,pan:void 0,fit:!0,padding:30,spacingFactor:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(a,b){return!0},ready:void 0,stop:void 0,transform:function(a,b){return b}};function xy(a){this.options=rO({},xx,a)}xy.prototype.run=function(){var a=this.options,b=a.eles.nodes(),c=rq(a.positions);return b.layoutPositions(this,a,function(b,d){var e=function(b){if(null==a.positions){var d;return{x:(d=b.position()).x,y:d.y}}if(c)return a.positions(b);var e=a.positions[b._private.data.id];return null==e?null:e}(b);return!b.locked()&&null!=e&&e}),this};var xz={fit:!0,padding:30,boundingBox:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(a,b){return!0},ready:void 0,stop:void 0,transform:function(a,b){return b}};function xA(a){this.options=rO({},xz,a)}xA.prototype.run=function(){var a=this.options,b=a.cy,c=a.eles,d=s5(a.boundingBox?a.boundingBox:{x1:0,y1:0,w:b.width(),h:b.height()});return c.nodes().layoutPositions(this,a,function(a,b){return{x:d.x1+Math.round(Math.random()*d.w),y:d.y1+Math.round(Math.random()*d.h)}}),this};var xB=[{name:"breadthfirst",impl:w3},{name:"circle",impl:w5},{name:"concentric",impl:w7},{name:"cose",impl:w9},{name:"grid",impl:xu},{name:"null",impl:xw},{name:"preset",impl:xy},{name:"random",impl:xA}];function xC(a){this.options=a,this.notifications=0}var xD=function(){},xE=function(){throw Error("A headless instance can not render images")};xC.prototype={recalculateRenderedStyle:xD,notify:function(){this.notifications++},init:xD,isHeadless:function(){return!0},png:xE,jpg:xE};var xF={};xF.arrowShapeWidth=.3,xF.registerArrowShapes=function(){var a=this.arrowShapes={},b=this,c=function(a,b,c,d,e,f,g){var h=e.x-c/2-g,i=e.x+c/2+g,j=e.y-c/2-g,k=e.y+c/2+g;return h<=a&&a<=i&&j<=b&&b<=k},d=function(a,b,c,d,e){var f=a*Math.cos(d)-b*Math.sin(d),g=a*Math.sin(d)+b*Math.cos(d);return{x:f*c+e.x,y:g*c+e.y}},e=function(a,b,c,e){for(var f=[],g=0;g<a.length;g+=2){var h=a[g],i=a[g+1];f.push(d(h,i,b,c,e))}return f},f=function(a){for(var b=[],c=0;c<a.length;c++){var d=a[c];b.push(d.x,d.y)}return b},g=function(a){return a.pstyle("width").pfValue*a.pstyle("arrow-scale").pfValue*2},h=function(d,h){rp(h)&&(h=a[h]),a[d]=rO({name:d,points:[-.15,-.3,.15,-.3,.15,.3,-.15,.3],collide:function(a,b,c,d,g,h){return to(a,b,f(e(this.points,c+2*h,d,g)))},roughCollide:c,draw:function(a,c,d,f){var g=e(this.points,c,d,f);b.arrowShapeImpl("polygon")(a,g)},spacing:function(a){return 0},gap:g},h)};h("none",{collide:sj,roughCollide:sj,draw:sl,spacing:sk,gap:sk}),h("triangle",{points:[-.15,-.3,0,0,.15,-.3]}),h("arrow","triangle"),h("triangle-backcurve",{points:a.triangle.points,controlPoint:[0,-.15],roughCollide:c,draw:function(a,c,f,g,h){var i=e(this.points,c,f,g),j=this.controlPoint,k=d(j[0],j[1],c,f,g);b.arrowShapeImpl(this.name)(a,i,k)},gap:function(a){return .8*g(a)}}),h("triangle-tee",{points:[0,0,.15,-.3,-.15,-.3,0,0],pointsTee:[-.15,-.4,-.15,-.5,.15,-.5,.15,-.4],collide:function(a,b,c,d,g,h,i){var j=f(e(this.points,c+2*i,d,g)),k=f(e(this.pointsTee,c+2*i,d,g));return to(a,b,j)||to(a,b,k)},draw:function(a,c,d,f,g){var h=e(this.points,c,d,f),i=e(this.pointsTee,c,d,f);b.arrowShapeImpl(this.name)(a,h,i)}}),h("circle-triangle",{radius:.15,pointsTr:[0,-.15,.15,-.45,-.15,-.45,0,-.15],collide:function(a,b,c,d,g,h,i){var j=Math.pow(g.x-a,2)+Math.pow(g.y-b,2)<=Math.pow((c+2*i)*this.radius,2);return to(a,b,f(e(this.points,c+2*i,d,g)))||j},draw:function(a,c,d,f,g){var h=e(this.pointsTr,c,d,f);b.arrowShapeImpl(this.name)(a,h,f.x,f.y,this.radius*c)},spacing:function(a){return b.getArrowWidth(a.pstyle("width").pfValue,a.pstyle("arrow-scale").value)*this.radius}}),h("triangle-cross",{points:[0,0,.15,-.3,-.15,-.3,0,0],baseCrossLinePts:[-.15,-.4,-.15,-.4,.15,-.4,.15,-.4],crossLinePts:function(a,b){var c=this.baseCrossLinePts.slice(),d=b/a;return c[3]=c[3]-d,c[5]=c[5]-d,c},collide:function(a,b,c,d,g,h,i){var j=f(e(this.points,c+2*i,d,g)),k=f(e(this.crossLinePts(c,h),c+2*i,d,g));return to(a,b,j)||to(a,b,k)},draw:function(a,c,d,f,g){var h=e(this.points,c,d,f),i=e(this.crossLinePts(c,g),c,d,f);b.arrowShapeImpl(this.name)(a,h,i)}}),h("vee",{points:[-.15,-.3,0,0,.15,-.3,0,-.15],gap:function(a){return .525*g(a)}}),h("circle",{radius:.15,collide:function(a,b,c,d,e,f,g){return Math.pow(e.x-a,2)+Math.pow(e.y-b,2)<=Math.pow((c+2*g)*this.radius,2)},draw:function(a,c,d,e,f){b.arrowShapeImpl(this.name)(a,e.x,e.y,this.radius*c)},spacing:function(a){return b.getArrowWidth(a.pstyle("width").pfValue,a.pstyle("arrow-scale").value)*this.radius}}),h("tee",{points:[-.15,0,-.15,-.1,.15,-.1,.15,0],spacing:function(a){return 1},gap:function(a){return 1}}),h("square",{points:[-.15,0,.15,0,.15,-.3,-.15,-.3]}),h("diamond",{points:[-.15,-.15,0,-.3,.15,-.15,0,0],gap:function(a){return a.pstyle("width").pfValue*a.pstyle("arrow-scale").value}}),h("chevron",{points:[0,0,-.15,-.15,-.1,-.2,0,-.1,.1,-.2,.15,-.15],gap:function(a){return .95*a.pstyle("width").pfValue*a.pstyle("arrow-scale").value}})};var xG={};xG.projectIntoViewport=function(a,b){var c=this.cy,d=this.findContainerClientCoords(),e=d[0],f=d[1],g=d[4],h=c.pan(),i=c.zoom();return[((a-e)/g-h.x)/i,((b-f)/g-h.y)/i]},xG.findContainerClientCoords=function(){if(this.containerBB)return this.containerBB;var a=this.container,b=a.getBoundingClientRect(),c=this.cy.window().getComputedStyle(a),d=function(a){return parseFloat(c.getPropertyValue(a))},e={left:d("padding-left"),right:d("padding-right"),top:d("padding-top"),bottom:d("padding-bottom")},f={left:d("border-left-width"),right:d("border-right-width"),top:d("border-top-width"),bottom:d("border-bottom-width")},g=a.clientWidth,h=a.clientHeight,i=e.left+e.right,j=e.top+e.bottom,k=f.left+f.right,l=b.width/(g+k),n=b.left+e.left+f.left,o=b.top+e.top+f.top;return this.containerBB=[n,o,g-i,h-j,l]},xG.invalidateContainerClientCoordsCache=function(){this.containerBB=null},xG.findNearestElement=function(a,b,c,d){return this.findNearestElements(a,b,c,d)[0]},xG.findNearestElements=function(a,b,c,d){var e,f,g=this,h=this,i=h.getCachedZSortedEles(),j=[],k=h.cy.zoom(),l=h.cy.hasCompoundNodes(),n=(d?24:8)/k,o=(d?8:2)/k,p=(d?8:2)/k,q=1/0;function r(a,b){if(a.isNode())if(f)return;else f=a,j.push(a);if(a.isEdge()&&(null==b||b<q))if(e){if(e.pstyle("z-compound-depth").value===a.pstyle("z-compound-depth").value&&e.pstyle("z-compound-depth").value===a.pstyle("z-compound-depth").value){for(var c=0;c<j.length;c++)if(j[c].isEdge()){j[c]=a,e=a,q=null!=b?b:q;break}}}else j.push(a),e=a,q=null!=b?b:q}function s(c){var d=c.outerWidth()+2*o,e=c.outerHeight()+2*o,f=d/2,i=e/2,j=c.position(),k="auto"===c.pstyle("corner-radius").value?"auto":c.pstyle("corner-radius").pfValue,l=c._private.rscratch;if(j.x-f<=a&&a<=j.x+f&&j.y-i<=b&&b<=j.y+i&&h.nodeShapes[g.getNodeShape(c)].checkPoint(a,b,0,d,e,j.x,j.y,k,l))return r(c,0),!0}c&&(i=i.interactive);function t(c,d){var e,f=c._private;e=d?d+"-":"",c.boundingBox();var g=f.labelBounds[d||"main"],h=c.pstyle(e+"label").value;if("yes"===c.pstyle("text-events").strValue&&h){var i=sx(f.rscratch,"labelX",d),j=sx(f.rscratch,"labelY",d),k=sx(f.rscratch,"labelAngle",d),l=c.pstyle(e+"text-margin-x").pfValue,n=c.pstyle(e+"text-margin-y").pfValue,o=g.x1-p-l,q=g.x2+p-l,s=g.y1-p-n,t=g.y2+p-n;if(k){var u=Math.cos(k),v=Math.sin(k),w=function(a,b){return{x:(a-=i)*u-(b-=j)*v+i,y:a*v+b*u+j}},x=w(o,s),y=w(o,t),z=w(q,s),A=w(q,t);if(to(a,b,[x.x+l,x.y+n,z.x+l,z.y+n,A.x+l,A.y+n,y.x+l,y.y+n]))return r(c),!0}else if(td(g,a,b))return r(c),!0}}for(var u=i.length-1;u>=0;u--){var v=i[u];v.isNode()?s(v)||t(v):function(c){var d,e=c._private,f=e.rscratch,i=c.pstyle("width").pfValue,k=c.pstyle("arrow-scale").value,o=i/2+n,p=o*o,q=2*o,t=e.source,u=e.target;if("segments"===f.edgeType||"straight"===f.edgeType||"haystack"===f.edgeType){for(var v=f.allpts,w=0;w+3<v.length;w+=2)if(ti(a,b,v[w],v[w+1],v[w+2],v[w+3],q)&&p>(d=tn(a,b,v[w],v[w+1],v[w+2],v[w+3])))return r(c,d),!0}else if("bezier"===f.edgeType||"multibezier"===f.edgeType||"self"===f.edgeType||"compound"===f.edgeType){for(var v=f.allpts,w=0;w+5<f.allpts.length;w+=4)if(tj(a,b,v[w],v[w+1],v[w+2],v[w+3],v[w+4],v[w+5],q)&&p>(d=tm(a,b,v[w],v[w+1],v[w+2],v[w+3],v[w+4],v[w+5])))return r(c,d),!0}for(var t=t||e.source,u=u||e.target,x=g.getArrowWidth(i,k),y=[{name:"source",x:f.arrowStartX,y:f.arrowStartY,angle:f.srcArrowAngle},{name:"target",x:f.arrowEndX,y:f.arrowEndY,angle:f.tgtArrowAngle},{name:"mid-source",x:f.midX,y:f.midY,angle:f.midsrcArrowAngle},{name:"mid-target",x:f.midX,y:f.midY,angle:f.midtgtArrowAngle}],w=0;w<y.length;w++){var z=y[w],A=h.arrowShapes[c.pstyle(z.name+"-arrow-shape").value],B=c.pstyle("width").pfValue;if(A.roughCollide(a,b,x,z.angle,{x:z.x,y:z.y},B,n)&&A.collide(a,b,x,z.angle,{x:z.x,y:z.y},B,n))return r(c),!0}l&&j.length>0&&(s(t),s(u))}(v)||t(v)||t(v,"source")||t(v,"target")}return j},xG.getAllInBox=function(a,b,c,d){var e=this.getCachedZSortedEles().interactive,f=2/this.cy.zoom(),g=[],h=Math.min(a,c),i=Math.max(a,c),j=Math.min(b,d),k=Math.max(b,d);a=h,c=i;var l=s5({x1:a,y1:b=j,x2:c,y2:d=k}),n=[{x:l.x1,y:l.y1},{x:l.x2,y:l.y1},{x:l.x2,y:l.y2},{x:l.x1,y:l.y2}],o=[[n[0],n[1]],[n[1],n[2]],[n[2],n[3]],[n[3],n[0]]];function p(a,b){var c=a._private;a.boundingBox();var d=c.labelBounds.main;if(!d)return null;var e=sx(c.rscratch,"labelX",b),g=sx(c.rscratch,"labelY",b),h=sx(c.rscratch,"labelAngle",b),i=a.pstyle("text-margin-x").pfValue,j=a.pstyle("text-margin-y").pfValue,k=d.x1-f-i,l=d.x2+f-i,n=d.y1-f-j,o=d.y2+f-j;if(!h)return[{x:k,y:n},{x:l,y:n},{x:l,y:o},{x:k,y:o}];var p=Math.cos(h),q=Math.sin(h),r=function(a,b){return{x:(a-=e)*p-(b-=g)*q+e,y:a*q+b*p+g}};return[r(k,n),r(l,n),r(l,o),r(k,o)]}for(var q=0;q<e.length;q++){var r=e[q];if(r.isNode()){var s="yes"===r.pstyle("text-events").strValue,t=r.pstyle("box-selection").strValue,u="yes"===r.pstyle("box-select-labels").strValue;if("none"===t)continue;var v=("overlap"===t||u)&&s,w=r.boundingBox({includeNodes:!0,includeEdges:!1,includeLabels:v});if("contain"===t){var x=!1;if(u&&s){var y=p(r);y&&tJ(y,n)&&(g.push(r),x=!0)}!x&&tf(l,w)&&g.push(r)}else if("overlap"===t&&tc(l,w)){var z=r.boundingBox({includeNodes:!0,includeEdges:!0,includeLabels:!1,includeMainLabels:!1,includeSourceLabels:!1,includeTargetLabels:!1});if(tJ([{x:z.x1,y:z.y1},{x:z.x2,y:z.y1},{x:z.x2,y:z.y2},{x:z.x1,y:z.y2}],n))g.push(r);else{var A=p(r);A&&tJ(A,n)&&g.push(r)}}}else{var B=r._private,C=B.rscratch,D=r.pstyle("box-selection").strValue;if("none"===D)continue;if("contain"===D){if(null!=C.startX&&null!=C.startY&&!td(l,C.startX,C.startY)||null!=C.endX&&null!=C.endY&&!td(l,C.endX,C.endY))continue;if("bezier"===C.edgeType||"multibezier"===C.edgeType||"self"===C.edgeType||"compound"===C.edgeType||"segments"===C.edgeType||"haystack"===C.edgeType){for(var E=B.rstyle.bezierPts||B.rstyle.linePts||B.rstyle.haystackPts,F=!0,G=0;G<E.length;G++)if(!te(l,E[G])){F=!1;break}F&&g.push(r)}else"straight"===C.edgeType&&g.push(r)}else if("overlap"===D){var H=!1;if(null!=C.startX&&null!=C.startY&&null!=C.endX&&null!=C.endY&&(td(l,C.startX,C.startY)||td(l,C.endX,C.endY)))g.push(r),H=!0;else if(!H&&"haystack"===C.edgeType){for(var I=B.rstyle.haystackPts,J=0;J<I.length;J++)if(te(l,I[J])){g.push(r),H=!0;break}}if(!H){var K=B.rstyle.bezierPts||B.rstyle.linePts||B.rstyle.haystackPts;if((!K||K.length<2)&&"straight"===C.edgeType&&null!=C.startX&&null!=C.startY&&null!=C.endX&&null!=C.endY&&(K=[{x:C.startX,y:C.startY},{x:C.endX,y:C.endY}]),!K||K.length<2)continue;for(var L=0;L<K.length-1;L++){for(var M=K[L],N=K[L+1],O=0;O<o.length;O++){var P=rf(o[O],2);if(function(a,b,c,d){function e(a,b,c){return(c.y-a.y)*(b.x-a.x)>(b.y-a.y)*(c.x-a.x)}return e(a,c,d)!==e(b,c,d)&&e(a,b,c)!==e(a,b,d)}(M,N,P[0],P[1])){g.push(r),H=!0;break}}if(H)break}}}}}return g};var xH={};xH.calculateArrowAngles=function(a){var b=a._private.rscratch,c="haystack"===b.edgeType,d="bezier"===b.edgeType,e="multibezier"===b.edgeType,f="segments"===b.edgeType,g="compound"===b.edgeType,h="self"===b.edgeType;if(c?(s=b.haystackPts[0],t=b.haystackPts[1],u=b.haystackPts[2],v=b.haystackPts[3]):(s=b.arrowStartX,t=b.arrowStartY,u=b.arrowEndX,v=b.arrowEndY),l=b.midX,n=b.midY,f)q=s-b.segpts[0],r=t-b.segpts[1];else if(e||g||h||d){var i=b.allpts,j=s1(i[0],i[2],i[4],.1),k=s1(i[1],i[3],i[5],.1);q=s-j,r=t-k}else q=s-l,r=t-n;b.srcArrowAngle=sX(q,r);var l=b.midX,n=b.midY;if(c&&(l=(s+u)/2,n=(t+v)/2),q=u-s,r=v-t,f){var i=b.allpts;if(i.length/2%2==0){var o=i.length/2,p=o-2;q=i[o]-i[p],r=i[o+1]-i[p+1]}else if(b.isRound)q=b.midVector[1],r=-b.midVector[0];else{var o=i.length/2-1,p=o-2;q=i[o]-i[p],r=i[o+1]-i[p+1]}}else if(e||g||h){var q,r,s,t,u,v,l,n,w,x,y,z,i=b.allpts;if(b.ctrlpts.length/2%2==0){var A=i.length/2-1,B=A+2,C=B+2;w=s1(i[A],i[B],i[C],0),x=s1(i[A+1],i[B+1],i[C+1],0),y=s1(i[A],i[B],i[C],1e-4),z=s1(i[A+1],i[B+1],i[C+1],1e-4)}else{var B=i.length/2-1,A=B-2,C=B+2;w=s1(i[A],i[B],i[C],.4999),x=s1(i[A+1],i[B+1],i[C+1],.4999),y=s1(i[A],i[B],i[C],.5),z=s1(i[A+1],i[B+1],i[C+1],.5)}q=y-w,r=z-x}if(b.midtgtArrowAngle=sX(q,r),b.midDispX=q,b.midDispY=r,q*=-1,r*=-1,f){var i=b.allpts;if(i.length/2%2==0);else if(!b.isRound){var o=i.length/2-1,D=o+2;q=-(i[D]-i[o]),r=-(i[D+1]-i[o+1])}}if(b.midsrcArrowAngle=sX(q,r),f)q=u-b.segpts[b.segpts.length-2],r=v-b.segpts[b.segpts.length-1];else if(e||g||h||d){var i=b.allpts,E=i.length,j=s1(i[E-6],i[E-4],i[E-2],.9),k=s1(i[E-5],i[E-3],i[E-1],.9);q=u-j,r=v-k}else q=u-l,r=v-n;b.tgtArrowAngle=sX(q,r)},xH.getArrowWidth=xH.getArrowHeight=function(a,b){var c=this.arrowWidthCache=this.arrowWidthCache||{},d=c[a+", "+b];return d||(d=Math.max(Math.pow(13.37*a,.9),29)*b,c[a+", "+b]=d),d};var xI,xJ,xK,xL,xM,xN,xO,xP,xQ,xR,xS,xT,xU,xV,xW,xX,xY,xZ,x$,x_,x0,x1,x2,x3,x4,x5,x6,x7,x8,x9,ya,yb,yc,yd,ye,yf,yg,yh,yi,yj,yk,yl,ym,yn,yo,yp,yq,yr,ys,yt,yu,yv,yw,yx,yy,yz,yA,yB,yC,yD,yE,yF,yG,yH,yI,yJ,yK,yL,yM,yN,yO,yP,yQ,yR,yS,yT,yU,yV,yW,yX,yY,yZ,y$,y_,y0,y1,y2,y3,y4,y5,y6,y7,y8,y9,za,zb,zc,zd,ze,zf,zg,zh,zi,zj,zk,zl,zm,zn,zo,zp,zq,zr,zs,zt,zu,zv,zw,zx,zy,zz,zA,zB,zC,zD,zE,zF,zG,zH,zI,zJ,zK,zL,zM,zN,zO,zP,zQ,zR,zS,zT,zU,zV,zW,zX,zY,zZ,z$,z_,z0,z1,z2,z3,z4,z5,z6,z7,z8,z9,Aa,Ab,Ac,Ad,Ae,Af,Ag,Ah,Ai,Aj,Ak,Al,Am,An,Ao,Ap,Aq,Ar,As,At,Au={},Av={},Aw=function(a,b,c){c.x=b.x-a.x,c.y=b.y-a.y,c.len=Math.sqrt(c.x*c.x+c.y*c.y),c.nx=c.x/c.len,c.ny=c.y/c.len,c.ang=Math.atan2(c.ny,c.nx)},Ax=function(a,b){b.x=-1*a.x,b.y=-1*a.y,b.nx=-1*a.nx,b.ny=-1*a.ny,b.ang=a.ang>0?-(Math.PI-a.ang):Math.PI+a.ang},Ay=function(a,b,c,d,e){if(a!==q?Aw(b,a,Au):Ax(Av,Au),Aw(b,c,Av),Ak=Au.nx*Av.ny-Au.ny*Av.nx,Al=Au.nx*Av.nx- -(Au.ny*Av.ny),1e-6>Math.abs(Ao=Math.asin(Math.max(-1,Math.min(1,Ak))))){Ai=b.x,Aj=b.y,Aq=As=0;return}Am=1,An=!1,Al<0?Ao<0?Ao=Math.PI+Ao:(Ao=Math.PI-Ao,Am=-1,An=!0):Ao>0&&(Am=-1,An=!0),As=void 0!==b.radius?b.radius:d,Ap=Ao/2,At=Math.min(Au.len/2,Av.len/2),Aq=e?(Ar=Math.abs(Math.cos(Ap)*As/Math.sin(Ap)))>At?Math.abs((Ar=At)*Math.sin(Ap)/Math.cos(Ap)):As:Math.abs((Ar=Math.min(At,As))*Math.sin(Ap)/Math.cos(Ap)),o=b.x+Av.nx*Ar,p=b.y+Av.ny*Ar,Ai=o-Av.ny*Aq*Am,Aj=p+Av.nx*Aq*Am,l=b.x+Au.nx*Ar,n=b.y+Au.ny*Ar,q=b};function Az(a,b){0===b.radius?a.lineTo(b.cx,b.cy):a.arc(b.cx,b.cy,b.radius,b.startAngle,b.endAngle,b.counterClockwise)}function AA(a,b,c,d){var e=!(arguments.length>4)||void 0===arguments[4]||arguments[4];return 0===d||0===b.radius?{cx:b.x,cy:b.y,radius:0,startX:b.x,startY:b.y,stopX:b.x,stopY:b.y,startAngle:void 0,endAngle:void 0,counterClockwise:void 0}:(Ay(a,b,c,d,e),{cx:Ai,cy:Aj,radius:Aq,startX:l,startY:n,stopX:o,stopY:p,startAngle:Au.ang+Math.PI/2*Am,endAngle:Av.ang-Math.PI/2*Am,counterClockwise:An})}var AB=Math.sqrt(.02),AC={};function AD(a){var b=[];if(null!=a){for(var c=0;c<a.length;c+=2){var d=a[c],e=a[c+1];b.push({x:d,y:e})}return b}}AC.findMidptPtsEtc=function(a,b){var c,d=b.posPts,e=b.intersectionPts,f=b.vectorNormInverse,g=a.pstyle("source-endpoint"),h=a.pstyle("target-endpoint"),i=null!=g.units&&null!=h.units;switch(a.pstyle("edge-distances").value){case"node-position":c=d;break;case"intersection":c=e;break;case"endpoints":if(i){var j,k,l,n=rf(this.manualEndptToPx(a.source()[0],g),2),o=n[0],p=n[1],q=rf(this.manualEndptToPx(a.target()[0],h),2),r=q[0],s=q[1];j=s-p,l=Math.sqrt((k=r-o)*k+j*j),f={x:-j/l,y:k/l},c={x1:o,y1:p,x2:r,y2:s}}else so("Edge ".concat(a.id()," has edge-distances:endpoints specified without manual endpoints specified via source-endpoint and target-endpoint.  Falling back on edge-distances:intersection (default).")),c=e}return{midptPts:c,vectorNormInverse:f}},AC.findHaystackPoints=function(a){for(var b=0;b<a.length;b++){var c=a[b],d=c._private,e=d.rscratch;if(!e.haystack){var f=2*Math.random()*Math.PI;e.source={x:Math.cos(f),y:Math.sin(f)},e.target={x:Math.cos(f=2*Math.random()*Math.PI),y:Math.sin(f)}}var g=d.source,h=d.target,i=g.position(),j=h.position(),k=g.width(),l=h.width(),n=g.height(),o=h.height(),p=c.pstyle("haystack-radius").value/2;e.haystackPts=e.allpts=[e.source.x*k*p+i.x,e.source.y*n*p+i.y,e.target.x*l*p+j.x,e.target.y*o*p+j.y],e.midX=(e.allpts[0]+e.allpts[2])/2,e.midY=(e.allpts[1]+e.allpts[3])/2,e.edgeType="haystack",e.haystack=!0,this.storeEdgeProjections(c),this.calculateArrowAngles(c),this.recalculateEdgeLabelProjections(c),this.calculateLabelAngles(c)}},AC.findSegmentsPoints=function(a,b){var c=a._private.rscratch,d=a.pstyle("segment-weights"),e=a.pstyle("segment-distances"),f=a.pstyle("segment-radii"),g=a.pstyle("radius-type"),h=Math.min(d.pfValue.length,e.pfValue.length),i=f.pfValue[f.pfValue.length-1],j=g.pfValue[g.pfValue.length-1];c.edgeType="segments",c.segpts=[],c.radii=[],c.isArcRadius=[];for(var k=0;k<h;k++){var l=d.pfValue[k],n=e.pfValue[k],o=1-l,p=this.findMidptPtsEtc(a,b),q=p.midptPts,r=p.vectorNormInverse,s={x:q.x1*o+q.x2*l,y:q.y1*o+q.y2*l};c.segpts.push(s.x+r.x*n,s.y+r.y*n),c.radii.push(void 0!==f.pfValue[k]?f.pfValue[k]:i),c.isArcRadius.push((void 0!==g.pfValue[k]?g.pfValue[k]:j)==="arc-radius")}},AC.findLoopPoints=function(a,b,c,d){var e=a._private.rscratch,f=b.dirCounts,g=b.srcPos,h=a.pstyle("control-point-distances"),i=h?h.pfValue[0]:void 0,j=a.pstyle("loop-direction").pfValue,k=a.pstyle("loop-sweep").pfValue,l=a.pstyle("control-point-step-size").pfValue;e.edgeType="self";var n=c,o=l;d&&(n=0,o=i);var p=j-Math.PI/2,q=p-k/2,r=p+k/2,s=String(j+"_"+k);n=void 0===f[s]?f[s]=0:++f[s],e.ctrlpts=[g.x+1.4*Math.cos(q)*o*(n/3+1),g.y+1.4*Math.sin(q)*o*(n/3+1),g.x+1.4*Math.cos(r)*o*(n/3+1),g.y+1.4*Math.sin(r)*o*(n/3+1)]},AC.findCompoundLoopPoints=function(a,b,c,d){var e=a._private.rscratch;e.edgeType="compound";var f=b.srcPos,g=b.tgtPos,h=b.srcW,i=b.srcH,j=b.tgtW,k=b.tgtH,l=a.pstyle("control-point-step-size").pfValue,n=a.pstyle("control-point-distances"),o=n?n.pfValue[0]:void 0,p=c,q=l;d&&(p=0,q=o);var r={x:f.x-h/2,y:f.y-i/2},s={x:g.x-j/2,y:g.y-k/2},t={x:Math.min(r.x,s.x),y:Math.min(r.y,s.y)},u=Math.max(.5,Math.log(.01*h)),v=Math.max(.5,Math.log(.01*j));e.ctrlpts=[t.x,t.y-1.7995514309304248*q*(p/3+1)*u,t.x-1.7995514309304248*q*(p/3+1)*v,t.y]},AC.findStraightEdgePoints=function(a){a._private.rscratch.edgeType="straight"},AC.findBezierPoints=function(a,b,c,d,e){var f=a._private.rscratch,g=a.pstyle("control-point-step-size").pfValue,h=a.pstyle("control-point-distances"),i=a.pstyle("control-point-weights"),j=h&&i?Math.min(h.value.length,i.value.length):1,k=h?h.pfValue[0]:void 0,l=i.value[0];f.edgeType=d?"multibezier":"bezier",f.ctrlpts=[];for(var n=0;n<j;n++){var o=(.5-b.eles.length/2+c)*g*(e?-1:1),p=void 0,q=sZ(o);d&&(k=h?h.pfValue[n]:g,l=i.value[n]);var r=void 0!==(p=d?k:void 0!==k?q*k:void 0)?p:o,s=1-l,t=l,u=this.findMidptPtsEtc(a,b),v=u.midptPts,w=u.vectorNormInverse,x={x:v.x1*s+v.x2*t,y:v.y1*s+v.y2*t};f.ctrlpts.push(x.x+w.x*r,x.y+w.y*r)}},AC.findTaxiPoints=function(a,b){var c,d=a._private.rscratch;d.edgeType="segments";var e="vertical",f="horizontal",g="leftward",h="rightward",i="downward",j="upward",k=b.posPts,l=b.srcW,n=b.srcH,o=b.tgtW,p=b.tgtH,q="node-position"!==a.pstyle("edge-distances").value,r=a.pstyle("taxi-direction").value,s=r,t=a.pstyle("taxi-turn"),u="%"===t.units,v=t.pfValue,w=a.pstyle("taxi-turn-min-distance").pfValue,x=k.x2-k.x1,y=k.y2-k.y1,z=function(a,b){return a>0?Math.max(a-b,0):Math.min(a+b,0)},A=z(x,q?(l+o)/2:0),B=z(y,q?(n+p)/2:0),C=!1;"auto"===s?r=Math.abs(A)>Math.abs(B)?f:e:s===j||s===i?(r=e,C=!0):(s===g||s===h)&&(r=f,C=!0);var D=r===e,E=D?B:A,F=D?y:x,G=sZ(F),H=!1;!(C&&(u||v<0))&&(s===i&&F<0||s===j&&F>0||s===g&&F>0||s===h&&F<0)&&(G*=-1,E=G*Math.abs(E),H=!0);var I=function(a){return Math.abs(a)<w||Math.abs(a)>=Math.abs(E)},J=I(c=u?(v<0?1+v:v)*E:(v<0?E:0)+v*G),K=I(Math.abs(E)-Math.abs(c));if((J||K)&&!H)if(D){var L=Math.abs(x)<=o/2;if(Math.abs(F)<=n/2){var M=(k.x1+k.x2)/2;d.segpts=[M,k.y1,M,k.y2]}else if(L){var N=(k.y1+k.y2)/2;d.segpts=[k.x1,N,k.x2,N]}else d.segpts=[k.x1,k.y2]}else{var O=Math.abs(y)<=p/2;if(Math.abs(F)<=l/2){var P=(k.y1+k.y2)/2;d.segpts=[k.x1,P,k.x2,P]}else if(O){var Q=(k.x1+k.x2)/2;d.segpts=[Q,k.y1,Q,k.y2]}else d.segpts=[k.x2,k.y1]}else if(D){var R=k.y1+c+(q?n/2*G:0);d.segpts=[k.x1,R,k.x2,R]}else{var S=k.x1+c+(q?l/2*G:0);d.segpts=[S,k.y1,S,k.y2]}if(d.isRound){var T=a.pstyle("taxi-radius").value,U="arc-radius"===a.pstyle("radius-type").value[0];d.radii=Array(d.segpts.length/2).fill(T),d.isArcRadius=Array(d.segpts.length/2).fill(U)}},AC.tryToCorrectInvalidPoints=function(a,b){var c=a._private.rscratch;if("bezier"===c.edgeType){var d=b.srcPos,e=b.tgtPos,f=b.srcW,g=b.srcH,h=b.tgtW,i=b.tgtH,j=b.srcShape,k=b.tgtShape,l=b.srcCornerRadius,n=b.tgtCornerRadius,o=b.srcRs,p=b.tgtRs,q=!rt(c.startX)||!rt(c.startY),r=!rt(c.arrowStartX)||!rt(c.arrowStartY),s=!rt(c.endX)||!rt(c.endY),t=!rt(c.arrowEndX)||!rt(c.arrowEndY),u=3*(this.getArrowWidth(a.pstyle("width").pfValue,a.pstyle("arrow-scale").value)*this.arrowShapeWidth),v=s$({x:c.ctrlpts[0],y:c.ctrlpts[1]},{x:c.startX,y:c.startY}),w=v<u,x=s$({x:c.ctrlpts[0],y:c.ctrlpts[1]},{x:c.endX,y:c.endY}),y=x<u,z=!1;if(q||r||w){z=!0;var A={x:c.ctrlpts[0]-d.x,y:c.ctrlpts[1]-d.y},B=Math.sqrt(A.x*A.x+A.y*A.y),C={x:A.x/B,y:A.y/B},D=Math.max(f,g),E={x:c.ctrlpts[0]+2*C.x*D,y:c.ctrlpts[1]+2*C.y*D},F=j.intersectLine(d.x,d.y,f,g,E.x,E.y,0,l,o);w?(c.ctrlpts[0]=c.ctrlpts[0]+C.x*(u-v),c.ctrlpts[1]=c.ctrlpts[1]+C.y*(u-v)):(c.ctrlpts[0]=F[0]+C.x*u,c.ctrlpts[1]=F[1]+C.y*u)}if(s||t||y){z=!0;var G={x:c.ctrlpts[0]-e.x,y:c.ctrlpts[1]-e.y},H=Math.sqrt(G.x*G.x+G.y*G.y),I={x:G.x/H,y:G.y/H},J=Math.max(f,g),K={x:c.ctrlpts[0]+2*I.x*J,y:c.ctrlpts[1]+2*I.y*J},L=k.intersectLine(e.x,e.y,h,i,K.x,K.y,0,n,p);y?(c.ctrlpts[0]=c.ctrlpts[0]+I.x*(u-x),c.ctrlpts[1]=c.ctrlpts[1]+I.y*(u-x)):(c.ctrlpts[0]=L[0]+I.x*u,c.ctrlpts[1]=L[1]+I.y*u)}z&&this.findEndpoints(a)}},AC.storeAllpts=function(a){var b=a._private.rscratch;if("multibezier"===b.edgeType||"bezier"===b.edgeType||"self"===b.edgeType||"compound"===b.edgeType){b.allpts=[],b.allpts.push(b.startX,b.startY);for(var c,d=0;d+1<b.ctrlpts.length;d+=2)b.allpts.push(b.ctrlpts[d],b.ctrlpts[d+1]),d+3<b.ctrlpts.length&&b.allpts.push((b.ctrlpts[d]+b.ctrlpts[d+2])/2,(b.ctrlpts[d+1]+b.ctrlpts[d+3])/2);(b.allpts.push(b.endX,b.endY),b.ctrlpts.length/2%2==0)?(c=b.allpts.length/2-1,b.midX=b.allpts[c],b.midY=b.allpts[c+1]):(c=b.allpts.length/2-3,b.midX=s1(b.allpts[c],b.allpts[c+2],b.allpts[c+4],.5),b.midY=s1(b.allpts[c+1],b.allpts[c+3],b.allpts[c+5],.5))}else if("straight"===b.edgeType)b.allpts=[b.startX,b.startY,b.endX,b.endY],b.midX=(b.startX+b.endX+b.arrowStartX+b.arrowEndX)/4,b.midY=(b.startY+b.endY+b.arrowStartY+b.arrowEndY)/4;else if("segments"===b.edgeType){if(b.allpts=[],b.allpts.push(b.startX,b.startY),b.allpts.push.apply(b.allpts,b.segpts),b.allpts.push(b.endX,b.endY),b.isRound){b.roundCorners=[];for(var e=2;e+3<b.allpts.length;e+=2){var f=b.radii[e/2-1],g=b.isArcRadius[e/2-1];b.roundCorners.push(AA({x:b.allpts[e-2],y:b.allpts[e-1]},{x:b.allpts[e],y:b.allpts[e+1],radius:f},{x:b.allpts[e+2],y:b.allpts[e+3]},f,g))}}if(b.segpts.length%4==0){var h=b.segpts.length/2,i=h-2;b.midX=(b.segpts[i]+b.segpts[h])/2,b.midY=(b.segpts[i+1]+b.segpts[h+1])/2}else{var j=b.segpts.length/2-1;if(b.isRound){var k={x:b.segpts[j],y:b.segpts[j+1]},l=b.roundCorners[j/2];if(0===l.radius){var n={x:b.segpts[j+2],y:b.segpts[j+3]};b.midX=k.x,b.midY=k.y,b.midVector=[k.y-n.y,n.x-k.x]}else{var o=[k.x-l.cx,k.y-l.cy],p=l.radius/Math.sqrt(Math.pow(o[0],2)+Math.pow(o[1],2));o=o.map(function(a){return a*p}),b.midX=l.cx+o[0],b.midY=l.cy+o[1],b.midVector=o}}else b.midX=b.segpts[j],b.midY=b.segpts[j+1]}}},AC.checkForInvalidEdgeWarning=function(a){var b=a[0]._private.rscratch;b.nodesOverlap||rt(b.startX)&&rt(b.startY)&&rt(b.endX)&&rt(b.endY)?b.loggedErr=!1:b.loggedErr||(b.loggedErr=!0,so("Edge `"+a.id()+"` has invalid endpoints and so it is impossible to draw.  Adjust your edge style (e.g. control points) accordingly or use an alternative edge type.  This is expected behaviour when the source node and the target node overlap."))},AC.findEdgeControlPoints=function(a){var b=this;if(a&&0!==a.length){for(var c=this,d=c.cy.hasCompoundNodes(),e=new sA,f=function(a,b){return[].concat(rg(a),[+!!b]).join("-")},g=[],h=[],i=0;i<a.length;i++){var j=a[i],k=j._private,l=j.pstyle("curve-style").value;if(!j.removed()&&j.takesUpSpace()){if("haystack"===l){h.push(j);continue}var n="unbundled-bezier"===l||rH(l,"segments")||"straight"===l||"straight-triangle"===l||rH(l,"taxi"),o="unbundled-bezier"===l||"bezier"===l,p=k.source,q=k.target,r=[p.poolIndex(),q.poolIndex()].sort(),s=f(r,n),t=e.get(s);null==t&&(t={eles:[]},g.push({pairId:r,edgeIsUnbundled:n}),e.set(s,t)),t.eles.push(j),n&&(t.hasUnbundled=!0),o&&(t.hasBezier=!0)}}for(var u=0;u<g.length;u++)!function(){var a,h=g[u],i=f(h.pairId,h.edgeIsUnbundled),j=e.get(i);if(!j.hasUnbundled){var k=j.eles[0].parallelEdges().filter(function(a){return a.isBundledBezier()});sv(j.eles),k.forEach(function(a){return j.eles.push(a)}),j.eles.sort(function(a,b){return a.poolIndex()-b.poolIndex()})}var l=j.eles[0],n=l.source(),o=l.target();if(n.poolIndex()>o.poolIndex()){var p=n;n=o,o=p}var q=j.srcPos=n.position(),r=j.tgtPos=o.position(),s=j.srcW=n.outerWidth(),t=j.srcH=n.outerHeight(),v=j.tgtW=o.outerWidth(),w=j.tgtH=o.outerHeight(),x=j.srcShape=c.nodeShapes[b.getNodeShape(n)],y=j.tgtShape=c.nodeShapes[b.getNodeShape(o)],z=j.srcCornerRadius="auto"===n.pstyle("corner-radius").value?"auto":n.pstyle("corner-radius").pfValue,A=j.tgtCornerRadius="auto"===o.pstyle("corner-radius").value?"auto":o.pstyle("corner-radius").pfValue,B=j.tgtRs=o._private.rscratch,C=j.srcRs=n._private.rscratch;j.dirCounts={north:0,west:0,south:0,east:0,northwest:0,southwest:0,northeast:0,southeast:0};for(var D=0;D<j.eles.length;D++){var E=j.eles[D],F=E[0]._private.rscratch,G=E.pstyle("curve-style").value,H="unbundled-bezier"===G||rH(G,"segments")||rH(G,"taxi"),I=!n.same(E.source());if(!j.calculatedIntersection&&n!==o&&(j.hasBezier||j.hasUnbundled)){j.calculatedIntersection=!0;var J=x.intersectLine(q.x,q.y,s,t,r.x,r.y,0,z,C),K=j.srcIntn=J,L=y.intersectLine(r.x,r.y,v,w,q.x,q.y,0,A,B),M=j.tgtIntn=L,N=j.intersectionPts={x1:J[0],x2:L[0],y1:J[1],y2:L[1]},O=j.posPts={x1:q.x,x2:r.x,y1:q.y,y2:r.y},P=L[1]-J[1],Q=L[0]-J[0],R=Math.sqrt(Q*Q+P*P);rt(R)&&R>=AB||(R=Math.sqrt(Math.max(Q*Q,.01)+Math.max(P*P,.01)));var S=j.vector={x:Q,y:P},T=j.vectorNorm={x:S.x/R,y:S.y/R},U={x:-T.y,y:T.x};j.nodesOverlap=!rt(R)||y.checkPoint(J[0],J[1],0,v,w,r.x,r.y,A,B)||x.checkPoint(L[0],L[1],0,s,t,q.x,q.y,z,C),j.vectorNormInverse=U,a={nodesOverlap:j.nodesOverlap,dirCounts:j.dirCounts,calculatedIntersection:!0,hasBezier:j.hasBezier,hasUnbundled:j.hasUnbundled,eles:j.eles,srcPos:r,srcRs:B,tgtPos:q,tgtRs:C,srcW:v,srcH:w,tgtW:s,tgtH:t,srcIntn:M,tgtIntn:K,srcShape:y,tgtShape:x,posPts:{x1:O.x2,y1:O.y2,x2:O.x1,y2:O.y1},intersectionPts:{x1:N.x2,y1:N.y2,x2:N.x1,y2:N.y1},vector:{x:-S.x,y:-S.y},vectorNorm:{x:-T.x,y:-T.y},vectorNormInverse:{x:-U.x,y:-U.y}}}var V=I?a:j;F.nodesOverlap=V.nodesOverlap,F.srcIntn=V.srcIntn,F.tgtIntn=V.tgtIntn,F.isRound=G.startsWith("round"),d&&(n.isParent()||n.isChild()||o.isParent()||o.isChild())&&(n.parents().anySame(o)||o.parents().anySame(n)||n.same(o)&&n.isParent())?b.findCompoundLoopPoints(E,V,D,H):n===o?b.findLoopPoints(E,V,D,H):G.endsWith("segments")?b.findSegmentsPoints(E,V):G.endsWith("taxi")?b.findTaxiPoints(E,V):"straight"!==G&&(H||j.eles.length%2!=1||D!==Math.floor(j.eles.length/2))?b.findBezierPoints(E,V,D,H,I):b.findStraightEdgePoints(E),b.findEndpoints(E),b.tryToCorrectInvalidPoints(E,V),b.checkForInvalidEdgeWarning(E),b.storeAllpts(E),b.storeEdgeProjections(E),b.calculateArrowAngles(E),b.recalculateEdgeLabelProjections(E),b.calculateLabelAngles(E)}}();this.findHaystackPoints(h)}},AC.getSegmentPoints=function(a){var b=a[0]._private.rscratch;if(this.recalculateRenderedStyle(a),"segments"===b.edgeType)return AD(b.segpts)},AC.getControlPoints=function(a){var b=a[0]._private.rscratch;this.recalculateRenderedStyle(a);var c=b.edgeType;if("bezier"===c||"multibezier"===c||"self"===c||"compound"===c)return AD(b.ctrlpts)},AC.getEdgeMidpoint=function(a){var b=a[0]._private.rscratch;return this.recalculateRenderedStyle(a),{x:b.midX,y:b.midY}};var AE={};AE.manualEndptToPx=function(a,b){var c=a.position(),d=a.outerWidth(),e=a.outerHeight(),f=a._private.rscratch;if(2===b.value.length){var g=[b.pfValue[0],b.pfValue[1]];return"%"===b.units[0]&&(g[0]=g[0]*d),"%"===b.units[1]&&(g[1]=g[1]*e),g[0]+=c.x,g[1]+=c.y,g}var h=b.pfValue[0];h=-Math.PI/2+h;var i=2*Math.max(d,e),j=[c.x+Math.cos(h)*i,c.y+Math.sin(h)*i];return this.nodeShapes[this.getNodeShape(a)].intersectLine(c.x,c.y,d,e,j[0],j[1],0,"auto"===a.pstyle("corner-radius").value?"auto":a.pstyle("corner-radius").pfValue,f)},AE.findEndpoints=function(a){var b,c,d,e,f,g,h,i,j,k=a.source()[0],l=a.target()[0],n=k.position(),o=l.position(),p=a.pstyle("target-arrow-shape").value,q=a.pstyle("source-arrow-shape").value,r=a.pstyle("target-distance-from-node").pfValue,s=a.pstyle("source-distance-from-node").pfValue,t=k._private.rscratch,u=l._private.rscratch,v=a.pstyle("curve-style").value,w=a._private.rscratch,x=w.edgeType,y=rH(v,"taxi"),z="self"===x||"compound"===x,A="bezier"===x||"multibezier"===x||z,B="bezier"!==x,C="straight"===x||"segments"===x,D="segments"===x,E=z||y,F=a.pstyle("source-endpoint"),G=E?"outside-to-node":F.value,H="auto"===k.pstyle("corner-radius").value?"auto":k.pstyle("corner-radius").pfValue,I=a.pstyle("target-endpoint"),J=E?"outside-to-node":I.value,K="auto"===l.pstyle("corner-radius").value?"auto":l.pstyle("corner-radius").pfValue;w.srcManEndpt=F,w.tgtManEndpt=I;var L=null!=(b=(null==I||null==(c=I.pfValue)?void 0:c.length)===2?I.pfValue:null)?b:[0,0],M=null!=(d=(null==F||null==(e=F.pfValue)?void 0:e.length)===2?F.pfValue:null)?d:[0,0];if(A){var N=[w.ctrlpts[0],w.ctrlpts[1]];g=B?[w.ctrlpts[w.ctrlpts.length-2],w.ctrlpts[w.ctrlpts.length-1]]:N,h=N}else if(C){var O=D?w.segpts.slice(0,2):[o.x+L[0],o.y+L[1]];g=D?w.segpts.slice(w.segpts.length-2):[n.x+M[0],n.y+M[1]],h=O}if("inside-to-node"===J)f=[o.x,o.y];else if(I.units)f=this.manualEndptToPx(l,I);else if("outside-to-line"===J)f=w.tgtIntn;else if("outside-to-node"===J||"outside-to-node-or-label"===J?i=g:("outside-to-line"===J||"outside-to-line-or-label"===J)&&(i=[n.x,n.y]),f=this.nodeShapes[this.getNodeShape(l)].intersectLine(o.x,o.y,l.outerWidth(),l.outerHeight(),i[0],i[1],0,K,u),"outside-to-node-or-label"===J||"outside-to-line-or-label"===J){var P=l._private.rscratch,Q=P.labelWidth,R=P.labelHeight,S=P.labelX,T=P.labelY,U=Q/2,V=R/2,W=l.pstyle("text-valign").value;"top"===W?T-=V:"bottom"===W&&(T+=V);var X=l.pstyle("text-halign").value;"left"===X?S-=U:"right"===X&&(S+=U);var Y=tz(i[0],i[1],[S-U,T-V,S+U,T-V,S+U,T+V,S-U,T+V],o.x,o.y);if(Y.length>0){var Z=s_(n,sS(f)),$=s_(n,sS(Y)),_=Z;$<Z&&(f=Y,_=$),Y.length>2&&s_(n,{x:Y[2],y:Y[3]})<_&&(f=[Y[2],Y[3]])}}var aa=tB(f,g,this.arrowShapes[p].spacing(a)+r),ab=tB(f,g,this.arrowShapes[p].gap(a)+r);if(w.endX=ab[0],w.endY=ab[1],w.arrowEndX=aa[0],w.arrowEndY=aa[1],"inside-to-node"===G)f=[n.x,n.y];else if(F.units)f=this.manualEndptToPx(k,F);else if("outside-to-line"===G)f=w.srcIntn;else if("outside-to-node"===G||"outside-to-node-or-label"===G?j=h:("outside-to-line"===G||"outside-to-line-or-label"===G)&&(j=[o.x,o.y]),f=this.nodeShapes[this.getNodeShape(k)].intersectLine(n.x,n.y,k.outerWidth(),k.outerHeight(),j[0],j[1],0,H,t),"outside-to-node-or-label"===G||"outside-to-line-or-label"===G){var ac=k._private.rscratch,ad=ac.labelWidth,ae=ac.labelHeight,af=ac.labelX,ag=ac.labelY,ah=ad/2,ai=ae/2,aj=k.pstyle("text-valign").value;"top"===aj?ag-=ai:"bottom"===aj&&(ag+=ai);var ak=k.pstyle("text-halign").value;"left"===ak?af-=ah:"right"===ak&&(af+=ah);var al=tz(j[0],j[1],[af-ah,ag-ai,af+ah,ag-ai,af+ah,ag+ai,af-ah,ag+ai],n.x,n.y);if(al.length>0){var am=s_(o,sS(f)),an=s_(o,sS(al)),ao=am;an<am&&(f=[al[0],al[1]],ao=an),al.length>2&&s_(o,{x:al[2],y:al[3]})<ao&&(f=[al[2],al[3]])}}var ap=tB(f,h,this.arrowShapes[q].spacing(a)+s),aq=tB(f,h,this.arrowShapes[q].gap(a)+s);w.startX=aq[0],w.startY=aq[1],w.arrowStartX=ap[0],w.arrowStartY=ap[1],(A||B||C)&&(rt(w.startX)&&rt(w.startY)&&rt(w.endX)&&rt(w.endY)?w.badLine=!1:w.badLine=!0)},AE.getSourceEndpoint=function(a){var b=a[0]._private.rscratch;return(this.recalculateRenderedStyle(a),"haystack"===b.edgeType)?{x:b.haystackPts[0],y:b.haystackPts[1]}:{x:b.arrowStartX,y:b.arrowStartY}},AE.getTargetEndpoint=function(a){var b=a[0]._private.rscratch;return(this.recalculateRenderedStyle(a),"haystack"===b.edgeType)?{x:b.haystackPts[2],y:b.haystackPts[3]}:{x:b.arrowEndX,y:b.arrowEndY}};var AF={};AF.storeEdgeProjections=function(a){var b=a._private,c=b.rscratch,d=c.edgeType;if(b.rstyle.bezierPts=null,b.rstyle.linePts=null,b.rstyle.haystackPts=null,"multibezier"===d||"bezier"===d||"self"===d||"compound"===d){b.rstyle.bezierPts=[];for(var e=0;e+5<c.allpts.length;e+=4)!function(a,b,c){for(var d=function(a,b,c,d){return s1(a,b,c,d)},e=b._private.rstyle.bezierPts,f=0;f<a.bezierProjPcts.length;f++){var g=a.bezierProjPcts[f];e.push({x:d(c[0],c[2],c[4],g),y:d(c[1],c[3],c[5],g)})}}(this,a,c.allpts.slice(e,e+6))}else if("segments"===d)for(var f=b.rstyle.linePts=[],e=0;e+1<c.allpts.length;e+=2)f.push({x:c.allpts[e],y:c.allpts[e+1]});else if("haystack"===d){var g=c.haystackPts;b.rstyle.haystackPts=[{x:g[0],y:g[1]},{x:g[2],y:g[3]}]}b.rstyle.arrowWidth=this.getArrowWidth(a.pstyle("width").pfValue,a.pstyle("arrow-scale").value)*this.arrowShapeWidth},AF.recalculateEdgeProjections=function(a){this.findEdgeControlPoints(a)};var AG={};AG.recalculateNodeLabelProjection=function(a){var b,c;if(!rA(a.pstyle("label").strValue)){var d=a._private,e=a.width(),f=a.height(),g=a.padding(),h=a.position(),i=a.pstyle("text-halign").strValue,j=a.pstyle("text-valign").strValue,k=d.rscratch,l=d.rstyle;switch(i){case"left":b=h.x-e/2-g;break;case"right":b=h.x+e/2+g;break;default:b=h.x}switch(j){case"top":c=h.y-f/2-g;break;case"bottom":c=h.y+f/2+g;break;default:c=h.y}k.labelX=b,k.labelY=c,l.labelX=b,l.labelY=c,this.calculateLabelAngles(a),this.applyLabelDimensions(a)}};var AH=function(a,b){var c=Math.atan(b/a);return 0===a&&c<0&&(c*=-1),c},AI=function(a,b){return AH(b.x-a.x,b.y-a.y)},AJ=function(a,b,c,d){var e=s4(0,d-.001,1),f=s4(0,d+.001,1);return AI(s2(a,b,c,e),s2(a,b,c,f))};AG.recalculateEdgeLabelProjections=function(a){var b,c=a._private,d=c.rscratch,e=this,f={mid:a.pstyle("label").strValue,source:a.pstyle("source-label").strValue,target:a.pstyle("target-label").strValue};if(f.mid||f.source||f.target){b={x:d.midX,y:d.midY};var g=function(a,b,d){sy(c.rscratch,a,b,d),sy(c.rstyle,a,b,d)};g("labelX",null,b.x),g("labelY",null,b.y),g("labelAutoAngle",null,AH(d.midDispX,d.midDispY));var h=function(){if(h.cache)return h.cache;for(var a=[],b=0;b+5<d.allpts.length;b+=4){var f={x:d.allpts[b],y:d.allpts[b+1]},g={x:d.allpts[b+2],y:d.allpts[b+3]},i={x:d.allpts[b+4],y:d.allpts[b+5]};a.push({p0:f,p1:g,p2:i,startDist:0,length:0,segments:[]})}var j=c.rstyle.bezierPts,k=e.bezierProjPcts.length;function l(a,b,c,d,e){var f=s$(b,c),g=a.segments[a.segments.length-1],h={p0:b,p1:c,t0:d,t1:e,startDist:g?g.startDist+g.length:0,length:f};a.segments.push(h),a.length+=f}for(var n=0;n<a.length;n++){var o=a[n],p=a[n-1];p&&(o.startDist=p.startDist+p.length),l(o,o.p0,j[n*k],0,e.bezierProjPcts[0]);for(var q=0;q<k-1;q++)l(o,j[n*k+q],j[n*k+q+1],e.bezierProjPcts[q],e.bezierProjPcts[q+1]);l(o,j[n*k+k-1],o.p2,e.bezierProjPcts[k-1],1)}return h.cache=a},i=function(c){var e="source"===c;if(f[c]){var i=a.pstyle(c+"-text-offset").pfValue;switch(d.edgeType){case"self":case"compound":case"bezier":case"multibezier":for(var j,k,l=h(),n=0,o=0,p=0;p<l.length;p++){for(var q=l[e?p:l.length-1-p],r=0;r<q.segments.length;r++){var s=q.segments[e?r:q.segments.length-1-r],t=p===l.length-1&&r===q.segments.length-1;if(n=o,(o+=s.length)>=i||t){k={cp:q,segment:s};break}}if(k)break}var u=k.cp,v=k.segment,w=(i-n)/v.length,x=v.t1-v.t0,y=e?v.t0+x*w:v.t1-x*w;y=s4(0,y,1),b=s2(u.p0,u.p1,u.p2,y),j=AJ(u.p0,u.p1,u.p2,y);break;case"straight":case"segments":case"haystack":for(var z,A,B,C,D=0,E=d.allpts.length,F=0;F+3<E&&(e?(z={x:d.allpts[F],y:d.allpts[F+1]},A={x:d.allpts[F+2],y:d.allpts[F+3]}):(z={x:d.allpts[E-2-F],y:d.allpts[E-1-F]},A={x:d.allpts[E-4-F],y:d.allpts[E-3-F]}),B=s$(z,A),C=D,!((D+=B)>=i));F+=2);var G=(i-C)/B;b=s3(z,A,G=s4(0,G,1)),j=AI(z,A)}g("labelX",c,b.x),g("labelY",c,b.y),g("labelAutoAngle",c,j)}};i("source"),i("target"),this.applyLabelDimensions(a)}},AG.applyLabelDimensions=function(a){this.applyPrefixedLabelDimensions(a),a.isEdge()&&(this.applyPrefixedLabelDimensions(a,"source"),this.applyPrefixedLabelDimensions(a,"target"))},AG.applyPrefixedLabelDimensions=function(a,b){var c=a._private,d=this.getLabelText(a,b),e=sb(d,a._private.labelDimsKey);if(sx(c.rscratch,"prefixedLabelDimsKey",b)!==e){sy(c.rscratch,"prefixedLabelDimsKey",b,e);var f=this.calculateLabelDimensions(a,d),g=a.pstyle("line-height").pfValue,h=a.pstyle("text-wrap").strValue,i=sx(c.rscratch,"labelWrapCachedLines",b)||[],j="wrap"!==h?1:Math.max(i.length,1),k=f.height/j,l=f.width,n=f.height+(j-1)*(g-1)*k;sy(c.rstyle,"labelWidth",b,l),sy(c.rscratch,"labelWidth",b,l),sy(c.rstyle,"labelHeight",b,n),sy(c.rscratch,"labelHeight",b,n),sy(c.rscratch,"labelLineHeight",b,k*g)}},AG.getLabelText=function(a,b){var c=a._private,d=b?b+"-":"",e=a.pstyle(d+"label").strValue,f=a.pstyle("text-transform").value,g=function(a,d){return d?(sy(c.rscratch,a,b,d),d):sx(c.rscratch,a,b)};if(!e)return"";"none"==f||("uppercase"==f?e=e.toUpperCase():"lowercase"==f&&(e=e.toLowerCase()));var h=a.pstyle("text-wrap").value;if("wrap"===h){var i=g("labelKey");if(null!=i&&g("labelWrapKey")===i)return g("labelWrapCachedText");for(var j=e.split("\n"),k=a.pstyle("text-max-width").pfValue,l="anywhere"===a.pstyle("text-overflow-wrap").value,n=[],o=/[\s\u200b]+|$/g,p=0;p<j.length;p++){var q=j[p],r=this.calculateLabelDimensions(a,q).width;if(l&&(q=q.split("").join("")),r>k){var s,t=q.matchAll(o),u="",v=0,w=rd(t);try{for(w.s();!(s=w.n()).done;){var x=s.value,y=x[0],z=q.substring(v,x.index);v=x.index+y.length;var A=0===u.length?z:u+z+y;this.calculateLabelDimensions(a,A).width<=k?u+=z+y:(u&&n.push(u),u=z+y)}}catch(a){w.e(a)}finally{w.f()}u.match(/^[\s\u200b]+$/)||n.push(u)}else n.push(q)}g("labelWrapCachedLines",n),e=g("labelWrapCachedText",n.join("\n")),g("labelWrapKey",i)}else if("ellipsis"===h){var B=a.pstyle("text-max-width").pfValue,C="",D=!1;if(this.calculateLabelDimensions(a,e).width<B)return e;for(var E=0;E<e.length&&!(this.calculateLabelDimensions(a,C+e[E]+"").width>B);E++)C+=e[E],E===e.length-1&&(D=!0);return D||(C+=""),C}return e},AG.getLabelJustification=function(a){var b=a.pstyle("text-justification").strValue,c=a.pstyle("text-halign").strValue;if("auto"!==b)return b;if(!a.isNode())return"center";switch(c){case"left":return"right";case"right":return"left";default:return"center"}},AG.calculateLabelDimensions=function(a,b){var c=this.cy.window().document,d=a.pstyle("font-style").strValue,e=a.pstyle("font-size").pfValue,f=a.pstyle("font-family").strValue,g=a.pstyle("font-weight").strValue,h=this.labelCalcCanvas,i=this.labelCalcCanvasContext;if(!h){h=this.labelCalcCanvas=c.createElement("canvas"),i=this.labelCalcCanvasContext=h.getContext("2d");var j=h.style;j.position="absolute",j.left="-9999px",j.top="-9999px",j.zIndex="-1",j.visibility="hidden",j.pointerEvents="none"}i.font="".concat(d," ").concat(g," ").concat(e,"px ").concat(f);for(var k=0,l=0,n=b.split("\n"),o=0;o<n.length;o++){var p=n[o];k=Math.max(Math.ceil(i.measureText(p).width),k),l+=e}return{width:k+=0,height:l+=0}},AG.calculateLabelAngle=function(a,b){var c=a._private.rscratch,d=a.isEdge(),e=a.pstyle((b?b+"-":"")+"text-rotation"),f=e.strValue;return"none"===f?0:d&&"autorotate"===f?c.labelAutoAngle:"autorotate"===f?0:e.pfValue},AG.calculateLabelAngles=function(a){var b=a.isEdge(),c=a._private.rscratch;c.labelAngle=this.calculateLabelAngle(a),b&&(c.sourceLabelAngle=this.calculateLabelAngle(a,"source"),c.targetLabelAngle=this.calculateLabelAngle(a,"target"))};var AK={},AL=!1;AK.getNodeShape=function(a){var b=a.pstyle("shape").value;if("cutrectangle"===b&&(28>a.width()||28>a.height()))return AL||(so("The `cutrectangle` node shape can not be used at small sizes so `rectangle` is used instead"),AL=!0),"rectangle";if(a.isParent())if("rectangle"===b||"roundrectangle"===b||"round-rectangle"===b||"cutrectangle"===b||"cut-rectangle"===b||"barrel"===b)return b;else return"rectangle";if("polygon"===b){var c=a.pstyle("shape-polygon-points").value;return this.nodeShapes.makePolygon(c).name}return b};var AM={};AM.registerCalculationListeners=function(){var a=this.cy,b=a.collection(),c=this,d=function(a){var c=!(arguments.length>1)||void 0===arguments[1]||arguments[1];if(b.merge(a),c)for(var d=0;d<a.length;d++){var e=a[d]._private.rstyle;e.clean=!1,e.cleanConnected=!1}};c.binder(a).on("bounds.* dirty.*",function(a){d(a.target)}).on("style.* background.*",function(a){d(a.target,!1)});var e=function(e){if(e){var f=c.onUpdateEleCalcsFns;b.cleanStyle();for(var g=0;g<b.length;g++){var h=b[g],i=h._private.rstyle;h.isNode()&&!i.cleanConnected&&(d(h.connectedEdges()),i.cleanConnected=!0)}if(f)for(var j=0;j<f.length;j++)(0,f[j])(e,b);c.recalculateRenderedStyle(b),b=a.collection()}};c.flushRenderedStyleQueue=function(){e(!0)},c.beforeRender(e,c.beforeRenderPriorities.eleCalcs)},AM.onUpdateEleCalcs=function(a){(this.onUpdateEleCalcsFns=this.onUpdateEleCalcsFns||[]).push(a)},AM.recalculateRenderedStyle=function(a,b){var c=function(a){return a._private.rstyle.cleanConnected};if(0!==a.length){var d=[],e=[];if(!this.destroyed){void 0===b&&(b=!0);for(var f=0;f<a.length;f++){var g=a[f],h=g._private,i=h.rstyle;!g.isEdge()||c(g.source())&&c(g.target())||(i.clean=!1),g.isEdge()&&g.isBundledBezier()&&g.parallelEdges().some(function(a){return!a._private.rstyle.clean&&a.isBundledBezier()})&&(i.clean=!1),b&&i.clean||g.removed()||"none"!==g.pstyle("display").value&&("nodes"===h.group?e.push(g):d.push(g),i.clean=!0)}for(var j=0;j<e.length;j++){var k=e[j],l=k._private.rstyle,n=k.position();this.recalculateNodeLabelProjection(k),l.nodeX=n.x,l.nodeY=n.y,l.nodeW=k.pstyle("width").pfValue,l.nodeH=k.pstyle("height").pfValue}this.recalculateEdgeProjections(d);for(var o=0;o<d.length;o++){var p=d[o]._private,q=p.rstyle,r=p.rscratch;q.srcX=r.arrowStartX,q.srcY=r.arrowStartY,q.tgtX=r.arrowEndX,q.tgtY=r.arrowEndY,q.midX=r.midX,q.midY=r.midY,q.labelAngle=r.labelAngle,q.sourceLabelAngle=r.sourceLabelAngle,q.targetLabelAngle=r.targetLabelAngle}}}};var AN={};AN.updateCachedGrabbedEles=function(){var a=this.cachedZSortedEles;if(a){a.drag=[],a.nondrag=[];for(var b=[],c=0;c<a.length;c++){var d=a[c],e=d._private.rscratch;d.grabbed()&&!d.isParent()?b.push(d):e.inDragLayer?a.drag.push(d):a.nondrag.push(d)}for(var c=0;c<b.length;c++){var d=b[c];a.drag.push(d)}}},AN.invalidateCachedZSortedEles=function(){this.cachedZSortedEles=null},AN.getCachedZSortedEles=function(a){if(a||!this.cachedZSortedEles){var b=this.cy.mutableElements().toArray();b.sort(v9),b.interactive=b.filter(function(a){return a.interactive()}),this.cachedZSortedEles=b,this.updateCachedGrabbedEles()}else b=this.cachedZSortedEles;return b};var AO={};[xG,xH,AC,AE,AF,AG,AK,AM,AN].forEach(function(a){rO(AO,a)});var AP={};AP.getCachedImage=function(a,b,c){var d=this.imageCache=this.imageCache||{},e=d[a];if(e)return e.image.complete||e.image.addEventListener("load",c),e.image;var f=(e=d[a]=d[a]||{}).image=new Image;f.addEventListener("load",c),f.addEventListener("error",function(){f.error=!0});var g="data:";return a.substring(0,g.length).toLowerCase()!==g&&(f.crossOrigin=b="null"===b?null:b),f.src=a,f};var AQ={};AQ.registerBinding=function(a,b,c,d){var e=Array.prototype.slice.apply(arguments,[1]);if(Array.isArray(a)){for(var f=[],g=0;g<a.length;g++){var h=a[g];if(void 0!==h){var i=this.binder(h);f.push(i.on.apply(i,e))}}return f}var i=this.binder(a);return i.on.apply(i,e)},AQ.binder=function(a){var b=this,c=b.cy.window(),d=a===c||a===c.document||a===c.document.body||"undefined"!=typeof HTMLElement&&a instanceof HTMLElement;if(null==b.supportsPassiveEvents){var e=!1;try{var f=Object.defineProperty({},"passive",{get:function(){return e=!0,!0}});c.addEventListener("test",null,f)}catch(a){}b.supportsPassiveEvents=e}var g=function(c,e,f){var g=Array.prototype.slice.call(arguments);return d&&b.supportsPassiveEvents&&(g[2]={capture:null!=f&&f,passive:!1,once:!1}),b.bindings.push({target:a,args:g}),(a.addEventListener||a.on).apply(a,g),this};return{on:g,addEventListener:g,addListener:g,bind:g}},AQ.nodeIsDraggable=function(a){return a&&a.isNode()&&!a.locked()&&a.grabbable()},AQ.nodeIsGrabbable=function(a){return this.nodeIsDraggable(a)&&a.interactive()},AQ.load=function(){var a,b,c,d,e,f,g,h,i,j,k,l,n,o,p,q,r,s,t,u,v,w,x,y,z,A=this,B=A.cy.window(),C=function(a){return a.selected()},D=function(a,b,c,d){null==a&&(a=A.cy);for(var e=0;e<b.length;e++){var f=b[e];a.emit({originalEvent:c,type:f,position:d})}},E=function(a){return a.shiftKey||a.metaKey||a.ctrlKey},F=function(a,b){var c=!0;if(A.cy.hasCompoundNodes()&&a&&a.pannable())for(var d=0;b&&d<b.length;d++){var a=b[d];if(a.isNode()&&a.isParent()&&!a.pannable()){c=!1;break}}else c=!0;return c},G=function(a){a[0]._private.grabbed=!0},H=function(a){a[0]._private.grabbed=!1},I=function(a){a[0]._private.rscratch.inDragLayer=!0},J=function(a){a[0]._private.rscratch.inDragLayer=!1},K=function(a){a[0]._private.rscratch.isGrabTarget=!0},L=function(a){a[0]._private.rscratch.isGrabTarget=!1},M=function(a,b){var c=b.addToList;!c.has(a)&&a.grabbable()&&!a.locked()&&(c.merge(a),G(a))},N=function(a,b){if(a.cy().hasCompoundNodes()&&(null!=b.inDragLayer||null!=b.addToList)){var c=a.descendants();b.inDragLayer&&(c.forEach(I),c.connectedEdges().forEach(I)),b.addToList&&M(c,b)}},O=function(a,b){b=b||{};var c=a.cy().hasCompoundNodes();b.inDragLayer&&(a.forEach(I),a.neighborhood().stdFilter(function(a){return!c||a.isEdge()}).forEach(I)),b.addToList&&a.forEach(function(a){M(a,b)}),N(a,b),Q(a,{inDragLayer:b.inDragLayer}),A.updateCachedGrabbedEles()},P=function(a){a&&(A.getCachedZSortedEles().forEach(function(a){H(a),J(a),L(a)}),A.updateCachedGrabbedEles())},Q=function(a,b){if((null!=b.inDragLayer||null!=b.addToList)&&a.cy().hasCompoundNodes()){var c=a.ancestors().orphans();if(!c.same(a)){var d=c.descendants().spawnSelf().merge(c).unmerge(a).unmerge(a.descendants()),e=d.connectedEdges();b.inDragLayer&&(e.forEach(I),d.forEach(I)),b.addToList&&d.forEach(function(a){M(a,b)})}}},R=function(){null!=document.activeElement&&null!=document.activeElement.blur&&document.activeElement.blur()},S="undefined"!=typeof MutationObserver,T="undefined"!=typeof ResizeObserver;S?(A.removeObserver=new MutationObserver(function(a){for(var b=0;b<a.length;b++){var c=a[b].removedNodes;if(c){for(var d=0;d<c.length;d++)if(c[d]===A.container){A.destroy();break}}}}),A.container.parentNode&&A.removeObserver.observe(A.container.parentNode,{childList:!0})):A.registerBinding(A.container,"DOMNodeRemoved",function(a){A.destroy()});var U=r1(function(){A.cy.resize()},100);S&&(A.styleObserver=new MutationObserver(U),A.styleObserver.observe(A.container,{attributes:!0})),A.registerBinding(B,"resize",U),T&&(A.resizeObserver=new ResizeObserver(U),A.resizeObserver.observe(A.container));for(var V=function(){A.invalidateContainerClientCoordsCache()},W=A.container;null!=W;){a=W,A.registerBinding(a,"transitionend",V),A.registerBinding(a,"animationend",V),A.registerBinding(a,"scroll",V),W=W.parentNode}A.registerBinding(A.container,"contextmenu",function(a){a.preventDefault()});var X=function(a){for(var b=A.findContainerClientCoords(),c=b[0],d=b[1],e=b[2],f=b[3],g=a.touches?a.touches:[a],h=!1,i=0;i<g.length;i++){var j=g[i];if(c<=j.clientX&&j.clientX<=c+e&&d<=j.clientY&&j.clientY<=d+f){h=!0;break}}if(!h)return!1;for(var k=A.container,l=a.target.parentNode,n=!1;l;){if(l===k){n=!0;break}l=l.parentNode}return!!n};A.registerBinding(A.container,"mousedown",function(a){if(X(a)&&(1!==A.hoverData.which||1===a.which)){a.preventDefault(),R(),A.hoverData.capture=!0,A.hoverData.which=a.which;var b=A.cy,c=[a.clientX,a.clientY],d=A.projectIntoViewport(c[0],c[1]),e=A.selection,f=A.findNearestElements(d[0],d[1],!0,!1),g=f[0],h=A.dragData.possibleDragElements;A.hoverData.mdownPos=d,A.hoverData.mdownGPos=c;var i=function(b){return{originalEvent:a,type:b,position:{x:d[0],y:d[1]}}};if(3==a.which){A.hoverData.cxtStarted=!0;var j={originalEvent:a,type:"cxttapstart",position:{x:d[0],y:d[1]}};g?(g.activate(),g.emit(j),A.hoverData.down=g):b.emit(j),A.hoverData.downTime=new Date().getTime(),A.hoverData.cxtDragged=!1}else if(1==a.which){if(g&&g.activate(),null!=g&&A.nodeIsGrabbable(g)){if(K(g),g.selected()){h=A.dragData.possibleDragElements=b.collection();var k=b.$(function(a){return a.isNode()&&a.selected()&&A.nodeIsGrabbable(a)});O(k,{addToList:h}),g.emit(i("grabon")),k.forEach(function(a){a.emit(i("grab"))})}else O(g,{addToList:h=A.dragData.possibleDragElements=b.collection()}),g.emit(i("grabon")).emit(i("grab"));A.redrawHint("eles",!0),A.redrawHint("drag",!0)}A.hoverData.down=g,A.hoverData.downs=f,A.hoverData.downTime=new Date().getTime(),D(g,["mousedown","tapstart","vmousedown"],a,{x:d[0],y:d[1]}),null==g?(e[4]=1,A.data.bgActivePosistion={x:d[0],y:d[1]},A.redrawHint("select",!0),A.redraw()):g.pannable()&&(e[4]=1),A.hoverData.tapholdCancelled=!1,clearTimeout(A.hoverData.tapholdTimeout),A.hoverData.tapholdTimeout=setTimeout(function(){if(!A.hoverData.tapholdCancelled){var a=A.hoverData.down;a?a.emit(i("taphold")):b.emit(i("taphold"))}},A.tapholdDuration)}e[0]=e[2]=d[0],e[1]=e[3]=d[1]}},!1);var Y=function(a){var b=a.getRootNode();if(b&&11===b.nodeType&&void 0!==b.host)return b}(A.container);A.registerBinding([B,Y],"mousemove",function(a){var b,c;if(A.hoverData.capture||X(a)){var d=!1,e=A.cy,f=e.zoom(),g=[a.clientX,a.clientY],h=A.projectIntoViewport(g[0],g[1]),i=A.hoverData.mdownPos,j=A.hoverData.mdownGPos,k=A.selection,l=null;A.hoverData.draggingEles||A.hoverData.dragging||A.hoverData.selecting||(l=A.findNearestElement(h[0],h[1],!0,!1));var n=A.hoverData.last,o=A.hoverData.down,p=[h[0]-k[2],h[1]-k[3]],q=A.dragData.possibleDragElements;if(j){var r=g[0]-j[0],s=g[1]-j[1];A.hoverData.isOverThresholdDrag=b=r*r+s*s>=A.desktopTapThreshold2}var t=E(a);b&&(A.hoverData.tapholdCancelled=!0),d=!0,D(l,["mousemove","vmousemove","tapdrag"],a,{x:h[0],y:h[1]});var u=function(b){return{originalEvent:a,type:b,position:{x:h[0],y:h[1]}}},v=function(){A.data.bgActivePosistion=void 0,A.hoverData.selecting||e.emit(u("boxstart")),k[4]=1,A.hoverData.selecting=!0,A.redrawHint("select",!0),A.redraw()};if(3===A.hoverData.which){if(b){var w=u("cxtdrag");o?o.emit(w):e.emit(w),A.hoverData.cxtDragged=!0,(!A.hoverData.cxtOver||l!==A.hoverData.cxtOver)&&(A.hoverData.cxtOver&&A.hoverData.cxtOver.emit(u("cxtdragout")),A.hoverData.cxtOver=l,l&&l.emit(u("cxtdragover")))}}else if(A.hoverData.dragging){if(d=!0,e.panningEnabled()&&e.userPanningEnabled()){if(A.hoverData.justStartedPan){var x=A.hoverData.mdownPos;c={x:(h[0]-x[0])*f,y:(h[1]-x[1])*f},A.hoverData.justStartedPan=!1}else c={x:p[0]*f,y:p[1]*f};e.panBy(c),e.emit(u("dragpan")),A.hoverData.dragged=!0}h=A.projectIntoViewport(a.clientX,a.clientY)}else if(1==k[4]&&(null==o||o.pannable()))b&&(!A.hoverData.dragging&&e.boxSelectionEnabled()&&(t||!e.panningEnabled()||!e.userPanningEnabled())?v():!A.hoverData.selecting&&e.panningEnabled()&&e.userPanningEnabled()&&F(o,A.hoverData.downs)&&(A.hoverData.dragging=!0,A.hoverData.justStartedPan=!0,k[4]=0,A.data.bgActivePosistion=sS(i),A.redrawHint("select",!0),A.redraw()),o&&o.pannable()&&o.active()&&o.unactivate());else{if(o&&o.pannable()&&o.active()&&o.unactivate(),o&&o.grabbed()||l==n||(n&&D(n,["mouseout","tapdragout"],a,{x:h[0],y:h[1]}),l&&D(l,["mouseover","tapdragover"],a,{x:h[0],y:h[1]}),A.hoverData.last=l),o)if(b){if(e.boxSelectionEnabled()&&t)o&&o.grabbed()&&(P(q),o.emit(u("freeon")),q.emit(u("free")),A.dragData.didDrag&&(o.emit(u("dragfreeon")),q.emit(u("dragfree")))),v();else if(o&&o.grabbed()&&A.nodeIsDraggable(o)){var y,z=!A.dragData.didDrag;z&&A.redrawHint("eles",!0),A.dragData.didDrag=!0,A.hoverData.draggingEles||O(q,{inDragLayer:!0});var B={x:0,y:0};if(rt(p[0])&&rt(p[1])&&(B.x+=p[0],B.y+=p[1],z)){var C=A.hoverData.dragDelta;C&&rt(C[0])&&rt(C[1])&&(B.x+=C[0],B.y+=C[1])}A.hoverData.draggingEles=!0,q.silentShift(B).emit(u("position")).emit(u("drag")),A.redrawHint("drag",!0),A.redraw()}}else 0===(y=A.hoverData.dragDelta=A.hoverData.dragDelta||[]).length?(y.push(p[0]),y.push(p[1])):(y[0]+=p[0],y[1]+=p[1]);d=!0}if(k[2]=h[0],k[3]=h[1],d)return a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault(),!1}},!1),A.registerBinding(B,"mouseup",function(a){if((1!==A.hoverData.which||1===a.which||!A.hoverData.capture)&&A.hoverData.capture){A.hoverData.capture=!1;var e=A.cy,f=A.projectIntoViewport(a.clientX,a.clientY),g=A.selection,h=A.findNearestElement(f[0],f[1],!0,!1),i=A.dragData.possibleDragElements,j=A.hoverData.down,k=E(a);A.data.bgActivePosistion&&(A.redrawHint("select",!0),A.redraw()),A.hoverData.tapholdCancelled=!0,A.data.bgActivePosistion=void 0,j&&j.unactivate();var l=function(b){return{originalEvent:a,type:b,position:{x:f[0],y:f[1]}}};if(3===A.hoverData.which){var n=l("cxttapend");if(j?j.emit(n):e.emit(n),!A.hoverData.cxtDragged){var o=l("cxttap");j?j.emit(o):e.emit(o)}A.hoverData.cxtDragged=!1,A.hoverData.which=null}else if(1===A.hoverData.which){if(D(h,["mouseup","tapend","vmouseup"],a,{x:f[0],y:f[1]}),A.dragData.didDrag||A.hoverData.dragged||A.hoverData.selecting||A.hoverData.isOverThresholdDrag||(D(j,["click","tap","vclick"],a,{x:f[0],y:f[1]}),c=!1,a.timeStamp-d<=e.multiClickDebounceTime()?(b&&clearTimeout(b),c=!0,d=null,D(j,["dblclick","dbltap","vdblclick"],a,{x:f[0],y:f[1]})):(b=setTimeout(function(){c||D(j,["oneclick","onetap","voneclick"],a,{x:f[0],y:f[1]})},e.multiClickDebounceTime()),d=a.timeStamp)),null!=j||A.dragData.didDrag||A.hoverData.selecting||A.hoverData.dragged||E(a)||(e.$(C).unselect(["tapunselect"]),i.length>0&&A.redrawHint("eles",!0),A.dragData.possibleDragElements=i=e.collection()),h!=j||A.dragData.didDrag||A.hoverData.selecting||null==h||!h._private.selectable||(A.hoverData.dragging||("additive"===e.selectionType()||k?h.selected()?h.unselect(["tapunselect"]):h.select(["tapselect"]):k||(e.$(C).unmerge(h).unselect(["tapunselect"]),h.select(["tapselect"]))),A.redrawHint("eles",!0)),A.hoverData.selecting){var p=e.collection(A.getAllInBox(g[0],g[1],g[2],g[3]));A.redrawHint("select",!0),p.length>0&&A.redrawHint("eles",!0),e.emit(l("boxend"));"additive"===e.selectionType()||k||e.$(C).unmerge(p).unselect(),p.emit(l("box")).stdFilter(function(a){return a.selectable()&&!a.selected()}).select().emit(l("boxselect")),A.redraw()}if(A.hoverData.dragging&&(A.hoverData.dragging=!1,A.redrawHint("select",!0),A.redrawHint("eles",!0),A.redraw()),!g[4]){A.redrawHint("drag",!0),A.redrawHint("eles",!0);var q=j&&j.grabbed();P(i),q&&(j.emit(l("freeon")),i.emit(l("free")),A.dragData.didDrag&&(j.emit(l("dragfreeon")),i.emit(l("dragfree"))))}}g[4]=0,A.hoverData.down=null,A.hoverData.cxtStarted=!1,A.hoverData.draggingEles=!1,A.hoverData.selecting=!1,A.hoverData.isOverThresholdDrag=!1,A.dragData.didDrag=!1,A.hoverData.dragged=!1,A.hoverData.dragDelta=[],A.hoverData.mdownPos=null,A.hoverData.mdownGPos=null,A.hoverData.which=null}},!1);var Z=[],$=1e5,_=function(a,b){for(var c=0;c<a.length;c++)if(a[c]%b!=0)return!1;return!0},aa=function(a){for(var b=Math.abs(a[0]),c=1;c<a.length;c++)if(Math.abs(a[c])!==b)return!1;return!0},ab=function(a){var b=!1,c=a.deltaY;if(null==c&&(null!=a.wheelDeltaY?c=a.wheelDeltaY/4:null!=a.wheelDelta&&(c=a.wheelDelta/4)),0!==c){if(null==e)if(Z.length>=4){if(!(e=_(Z,5))){var d=Math.abs(Z[0]);e=aa(Z)&&d>5}if(e)for(var f=0;f<Z.length;f++)$=Math.min(Math.abs(Z[f]),$)}else Z.push(c),b=!0;else e&&($=Math.min(Math.abs(c),$));if(!A.scrollingPage){var g=A.cy,h=g.zoom(),i=g.pan(),j=A.projectIntoViewport(a.clientX,a.clientY),k=[j[0]*h+i.x,j[1]*h+i.y];if(A.hoverData.draggingEles||A.hoverData.dragging||A.hoverData.cxtStarted||0!==A.selection[4])return void a.preventDefault();if(g.panningEnabled()&&g.userPanningEnabled()&&g.zoomingEnabled()&&g.userZoomingEnabled()){a.preventDefault(),A.data.wheelZooming=!0,clearTimeout(A.data.wheelTimeout),A.data.wheelTimeout=setTimeout(function(){A.data.wheelZooming=!1,A.redrawHint("eles",!0),A.redraw()},150),b&&Math.abs(c)>5&&(c=5*sZ(c)),l=-(c/250),e&&(l/=$,l*=3),l*=A.wheelSensitivity,1===a.deltaMode&&(l*=33);var l,n=g.zoom()*Math.pow(10,l);"gesturechange"===a.type&&(n=A.gestureStartZoom*a.scale),g.zoom({level:n,renderedPosition:{x:k[0],y:k[1]}}),g.emit({type:"gesturechange"===a.type?"pinchzoom":"scrollzoom",originalEvent:a,position:{x:j[0],y:j[1]}})}}}};A.registerBinding(A.container,"wheel",ab,!0),A.registerBinding(B,"scroll",function(a){A.scrollingPage=!0,clearTimeout(A.scrollingPageTimeout),A.scrollingPageTimeout=setTimeout(function(){A.scrollingPage=!1},250)},!0),A.registerBinding(A.container,"gesturestart",function(a){A.gestureStartZoom=A.cy.zoom(),A.hasTouchStarted||a.preventDefault()},!0),A.registerBinding(A.container,"gesturechange",function(a){A.hasTouchStarted||ab(a)},!0),A.registerBinding(A.container,"mouseout",function(a){var b=A.projectIntoViewport(a.clientX,a.clientY);A.cy.emit({originalEvent:a,type:"mouseout",position:{x:b[0],y:b[1]}})},!1),A.registerBinding(A.container,"mouseover",function(a){var b=A.projectIntoViewport(a.clientX,a.clientY);A.cy.emit({originalEvent:a,type:"mouseover",position:{x:b[0],y:b[1]}})},!1);var ac=function(a,b,c,d){return Math.sqrt((c-a)*(c-a)+(d-b)*(d-b))},ad=function(a,b,c,d){return(c-a)*(c-a)+(d-b)*(d-b)};if(A.registerBinding(A.container,"touchstart",t=function(a){if(A.hasTouchStarted=!0,X(a)){R(),A.touchData.capture=!0,A.data.bgActivePosistion=void 0;var b=A.cy,c=A.touchData.now,d=A.touchData.earlier;if(a.touches[0]){var e=A.projectIntoViewport(a.touches[0].clientX,a.touches[0].clientY);c[0]=e[0],c[1]=e[1]}if(a.touches[1]){var e=A.projectIntoViewport(a.touches[1].clientX,a.touches[1].clientY);c[2]=e[0],c[3]=e[1]}if(a.touches[2]){var e=A.projectIntoViewport(a.touches[2].clientX,a.touches[2].clientY);c[4]=e[0],c[5]=e[1]}var t=function(b){return{originalEvent:a,type:b,position:{x:c[0],y:c[1]}}};if(a.touches[1]){A.touchData.singleTouchMoved=!0,P(A.dragData.touchDragEles);var u=A.findContainerClientCoords();o=u[0],p=u[1],q=u[2],r=u[3],f=a.touches[0].clientX-o,g=a.touches[0].clientY-p,h=a.touches[1].clientX-o,i=a.touches[1].clientY-p,s=0<=f&&f<=q&&0<=h&&h<=q&&0<=g&&g<=r&&0<=i&&i<=r;var v=b.pan(),w=b.zoom();if(j=ac(f,g,h,i),k=ad(f,g,h,i),n=[((l=[(f+h)/2,(g+i)/2])[0]-v.x)/w,(l[1]-v.y)/w],k<4e4&&!a.touches[2]){var x=A.findNearestElement(c[0],c[1],!0,!0),y=A.findNearestElement(c[2],c[3],!0,!0);x&&x.isNode()?(x.activate().emit(t("cxttapstart")),A.touchData.start=x):y&&y.isNode()?(y.activate().emit(t("cxttapstart")),A.touchData.start=y):b.emit(t("cxttapstart")),A.touchData.start&&(A.touchData.start._private.grabbed=!1),A.touchData.cxt=!0,A.touchData.cxtDragged=!1,A.data.bgActivePosistion=void 0,A.redraw();return}}if(a.touches[2])b.boxSelectionEnabled()&&a.preventDefault();else if(a.touches[1]);else if(a.touches[0]){var z=A.findNearestElements(c[0],c[1],!0,!0),B=z[0];if(null!=B&&(B.activate(),A.touchData.start=B,A.touchData.starts=z,A.nodeIsGrabbable(B))){var C=A.dragData.touchDragEles=b.collection(),E=null;A.redrawHint("eles",!0),A.redrawHint("drag",!0),B.selected()?O(E=b.$(function(a){return a.selected()&&A.nodeIsGrabbable(a)}),{addToList:C}):O(B,{addToList:C}),K(B),B.emit(t("grabon")),E?E.forEach(function(a){a.emit(t("grab"))}):B.emit(t("grab"))}D(B,["touchstart","tapstart","vmousedown"],a,{x:c[0],y:c[1]}),null==B&&(A.data.bgActivePosistion={x:e[0],y:e[1]},A.redrawHint("select",!0),A.redraw()),A.touchData.singleTouchMoved=!1,A.touchData.singleTouchStartTime=+new Date,clearTimeout(A.touchData.tapholdTimeout),A.touchData.tapholdTimeout=setTimeout(function(){!1!==A.touchData.singleTouchMoved||A.pinching||A.touchData.selecting||D(A.touchData.start,["taphold"],a,{x:c[0],y:c[1]})},A.tapholdDuration)}if(a.touches.length>=1){for(var F=A.touchData.startPosition=[null,null,null,null,null,null],G=0;G<c.length;G++)F[G]=d[G]=c[G];var H=a.touches[0];A.touchData.startGPosition=[H.clientX,H.clientY]}}},!1),A.registerBinding(B,"touchmove",u=function(a){var b=A.touchData.capture;if(b||X(a)){var c=A.selection,d=A.cy,e=A.touchData.now,l=A.touchData.earlier,q=d.zoom();if(a.touches[0]){var r=A.projectIntoViewport(a.touches[0].clientX,a.touches[0].clientY);e[0]=r[0],e[1]=r[1]}if(a.touches[1]){var r=A.projectIntoViewport(a.touches[1].clientX,a.touches[1].clientY);e[2]=r[0],e[3]=r[1]}if(a.touches[2]){var r=A.projectIntoViewport(a.touches[2].clientX,a.touches[2].clientY);e[4]=r[0],e[5]=r[1]}var t=function(b){return{originalEvent:a,type:b,position:{x:e[0],y:e[1]}}},u=A.touchData.startGPosition;if(b&&a.touches[0]&&u){for(var v=[],w=0;w<e.length;w++)v[w]=e[w]-l[w];var x=a.touches[0].clientX-u[0],y=x*x,z=a.touches[0].clientY-u[1];ab=y+z*z>=A.touchTapThreshold2}if(b&&A.touchData.cxt){a.preventDefault();var B=a.touches[0].clientX-o,C=a.touches[0].clientY-p,E=a.touches[1].clientX-o,G=a.touches[1].clientY-p,H=ad(B,C,E,G);if(H/k>=2.25||H>=22500){A.touchData.cxt=!1,A.data.bgActivePosistion=void 0,A.redrawHint("select",!0);var I=t("cxttapend");A.touchData.start?(A.touchData.start.unactivate().emit(I),A.touchData.start=null):d.emit(I)}}if(b&&A.touchData.cxt){var I=t("cxtdrag");A.data.bgActivePosistion=void 0,A.redrawHint("select",!0),A.touchData.start?A.touchData.start.emit(I):d.emit(I),A.touchData.start&&(A.touchData.start._private.grabbed=!1),A.touchData.cxtDragged=!0;var J=A.findNearestElement(e[0],e[1],!0,!0);(!A.touchData.cxtOver||J!==A.touchData.cxtOver)&&(A.touchData.cxtOver&&A.touchData.cxtOver.emit(t("cxtdragout")),A.touchData.cxtOver=J,J&&J.emit(t("cxtdragover")))}else if(b&&a.touches[2]&&d.boxSelectionEnabled())a.preventDefault(),A.data.bgActivePosistion=void 0,this.lastThreeTouch=+new Date,A.touchData.selecting||d.emit(t("boxstart")),A.touchData.selecting=!0,A.touchData.didSelect=!0,c[4]=1,c&&0!==c.length&&void 0!==c[0]?(c[2]=(e[0]+e[2]+e[4])/3,c[3]=(e[1]+e[3]+e[5])/3):(c[0]=(e[0]+e[2]+e[4])/3,c[1]=(e[1]+e[3]+e[5])/3,c[2]=(e[0]+e[2]+e[4])/3+1,c[3]=(e[1]+e[3]+e[5])/3+1),A.redrawHint("select",!0),A.redraw();else if(b&&a.touches[1]&&!A.touchData.didSelect&&d.zoomingEnabled()&&d.panningEnabled()&&d.userZoomingEnabled()&&d.userPanningEnabled()){a.preventDefault(),A.data.bgActivePosistion=void 0,A.redrawHint("select",!0);var K=A.dragData.touchDragEles;if(K){A.redrawHint("drag",!0);for(var L=0;L<K.length;L++){var M=K[L]._private;M.grabbed=!1,M.rscratch.inDragLayer=!1}}var N=A.touchData.start,B=a.touches[0].clientX-o,C=a.touches[0].clientY-p,E=a.touches[1].clientX-o,G=a.touches[1].clientY-p,Q=ac(B,C,E,G),R=Q/j;if(s){var S=B-f,T=C-g,U=E-h,V=G-i,W=d.zoom(),Y=W*R,Z=d.pan(),$=n[0]*W+Z.x,_=n[1]*W+Z.y,aa={x:-Y/W*($-Z.x-(S+U)/2)+$,y:-Y/W*(_-Z.y-(T+V)/2)+_};if(N&&N.active()){var K=A.dragData.touchDragEles;P(K),A.redrawHint("drag",!0),A.redrawHint("eles",!0),N.unactivate().emit(t("freeon")),K.emit(t("free")),A.dragData.didDrag&&(N.emit(t("dragfreeon")),K.emit(t("dragfree")))}d.viewport({zoom:Y,pan:aa,cancelOnFailedZoom:!0}),d.emit(t("pinchzoom")),j=Q,f=B,g=C,h=E,i=G,A.pinching=!0}if(a.touches[0]){var r=A.projectIntoViewport(a.touches[0].clientX,a.touches[0].clientY);e[0]=r[0],e[1]=r[1]}if(a.touches[1]){var r=A.projectIntoViewport(a.touches[1].clientX,a.touches[1].clientY);e[2]=r[0],e[3]=r[1]}if(a.touches[2]){var r=A.projectIntoViewport(a.touches[2].clientX,a.touches[2].clientY);e[4]=r[0],e[5]=r[1]}}else if(a.touches[0]&&!A.touchData.didSelect){var ab,J,ae=A.touchData.start,af=A.touchData.last;if(A.hoverData.draggingEles||A.swipePanning||(J=A.findNearestElement(e[0],e[1],!0,!0)),b&&null!=ae&&a.preventDefault(),b&&null!=ae&&A.nodeIsDraggable(ae))if(ab){var K=A.dragData.touchDragEles,ag=!A.dragData.didDrag;ag&&O(K,{inDragLayer:!0}),A.dragData.didDrag=!0;var ah={x:0,y:0};if(rt(v[0])&&rt(v[1])&&(ah.x+=v[0],ah.y+=v[1],ag)){A.redrawHint("eles",!0);var ai=A.touchData.dragDelta;ai&&rt(ai[0])&&rt(ai[1])&&(ah.x+=ai[0],ah.y+=ai[1])}A.hoverData.draggingEles=!0,K.silentShift(ah).emit(t("position")).emit(t("drag")),A.redrawHint("drag",!0),A.touchData.startPosition[0]==l[0]&&A.touchData.startPosition[1]==l[1]&&A.redrawHint("eles",!0),A.redraw()}else{var ai=A.touchData.dragDelta=A.touchData.dragDelta||[];0===ai.length?(ai.push(v[0]),ai.push(v[1])):(ai[0]+=v[0],ai[1]+=v[1])}if(D(ae||J,["touchmove","tapdrag","vmousemove"],a,{x:e[0],y:e[1]}),ae&&ae.grabbed()||J==af||(af&&af.emit(t("tapdragout")),J&&J.emit(t("tapdragover"))),A.touchData.last=J,b)for(var L=0;L<e.length;L++)e[L]&&A.touchData.startPosition[L]&&ab&&(A.touchData.singleTouchMoved=!0);if(b&&(null==ae||ae.pannable())&&d.panningEnabled()&&d.userPanningEnabled()){F(ae,A.touchData.starts)&&(a.preventDefault(),A.data.bgActivePosistion||(A.data.bgActivePosistion=sS(A.touchData.startPosition)),A.swipePanning?(d.panBy({x:v[0]*q,y:v[1]*q}),d.emit(t("dragpan"))):ab&&(A.swipePanning=!0,d.panBy({x:x*q,y:z*q}),d.emit(t("dragpan")),ae&&(ae.unactivate(),A.redrawHint("select",!0),A.touchData.start=null)));var r=A.projectIntoViewport(a.touches[0].clientX,a.touches[0].clientY);e[0]=r[0],e[1]=r[1]}}for(var w=0;w<e.length;w++)l[w]=e[w];b&&a.touches.length>0&&!A.hoverData.draggingEles&&!A.swipePanning&&null!=A.data.bgActivePosistion&&(A.data.bgActivePosistion=void 0,A.redrawHint("select",!0),A.redraw())}},!1),A.registerBinding(B,"touchcancel",v=function(a){var b=A.touchData.start;A.touchData.capture=!1,b&&b.unactivate()}),A.registerBinding(B,"touchend",w=function(a){var b,c=A.touchData.start;if(A.touchData.capture){0===a.touches.length&&(A.touchData.capture=!1),a.preventDefault();var d=A.selection;A.swipePanning=!1,A.hoverData.draggingEles=!1;var e=A.cy,f=e.zoom(),g=A.touchData.now,h=A.touchData.earlier;if(a.touches[0]){var i=A.projectIntoViewport(a.touches[0].clientX,a.touches[0].clientY);g[0]=i[0],g[1]=i[1]}if(a.touches[1]){var i=A.projectIntoViewport(a.touches[1].clientX,a.touches[1].clientY);g[2]=i[0],g[3]=i[1]}if(a.touches[2]){var i=A.projectIntoViewport(a.touches[2].clientX,a.touches[2].clientY);g[4]=i[0],g[5]=i[1]}var j=function(b){return{originalEvent:a,type:b,position:{x:g[0],y:g[1]}}};if(c&&c.unactivate(),A.touchData.cxt){if(b=j("cxttapend"),c?c.emit(b):e.emit(b),!A.touchData.cxtDragged){var k=j("cxttap");c?c.emit(k):e.emit(k)}A.touchData.start&&(A.touchData.start._private.grabbed=!1),A.touchData.cxt=!1,A.touchData.start=null,A.redraw();return}if(!a.touches[2]&&e.boxSelectionEnabled()&&A.touchData.selecting){A.touchData.selecting=!1;var l=e.collection(A.getAllInBox(d[0],d[1],d[2],d[3]));d[0]=void 0,d[1]=void 0,d[2]=void 0,d[3]=void 0,d[4]=0,A.redrawHint("select",!0),e.emit(j("boxend")),l.emit(j("box")).stdFilter(function(a){return a.selectable()&&!a.selected()}).select().emit(j("boxselect")),l.nonempty()&&A.redrawHint("eles",!0),A.redraw()}if(null!=c&&c.unactivate(),a.touches[2])A.data.bgActivePosistion=void 0,A.redrawHint("select",!0);else if(a.touches[1]);else if(a.touches[0]);else if(!a.touches[0]){A.data.bgActivePosistion=void 0,A.redrawHint("select",!0);var n=A.dragData.touchDragEles;if(null!=c){var o=c._private.grabbed;P(n),A.redrawHint("drag",!0),A.redrawHint("eles",!0),o&&(c.emit(j("freeon")),n.emit(j("free")),A.dragData.didDrag&&(c.emit(j("dragfreeon")),n.emit(j("dragfree")))),D(c,["touchend","tapend","vmouseup","tapdragout"],a,{x:g[0],y:g[1]}),c.unactivate(),A.touchData.start=null}else D(A.findNearestElement(g[0],g[1],!0,!0),["touchend","tapend","vmouseup","tapdragout"],a,{x:g[0],y:g[1]});var p=A.touchData.startPosition[0]-g[0],q=A.touchData.startPosition[1]-g[1];A.touchData.singleTouchMoved||(c||e.$(":selected").unselect(["tapunselect"]),D(c,["tap","vclick"],a,{x:g[0],y:g[1]}),x=!1,a.timeStamp-z<=e.multiClickDebounceTime()?(y&&clearTimeout(y),x=!0,z=null,D(c,["dbltap","vdblclick"],a,{x:g[0],y:g[1]})):(y=setTimeout(function(){x||D(c,["onetap","voneclick"],a,{x:g[0],y:g[1]})},e.multiClickDebounceTime()),z=a.timeStamp)),null!=c&&!A.dragData.didDrag&&c._private.selectable&&(p*p+q*q)*f*f<A.touchTapThreshold2&&!A.pinching&&("single"===e.selectionType()?(e.$(C).unmerge(c).unselect(["tapunselect"]),c.select(["tapselect"])):c.selected()?c.unselect(["tapunselect"]):c.select(["tapselect"]),A.redrawHint("eles",!0)),A.touchData.singleTouchMoved=!0}for(var r=0;r<g.length;r++)h[r]=g[r];A.dragData.didDrag=!1,0===a.touches.length&&(A.touchData.dragDelta=[],A.touchData.startPosition=[null,null,null,null,null,null],A.touchData.startGPosition=null,A.touchData.didSelect=!1),a.touches.length<2&&(1===a.touches.length&&(A.touchData.startGPosition=[a.touches[0].clientX,a.touches[0].clientY]),A.pinching=!1,A.redrawHint("eles",!0),A.redraw())}},!1),"undefined"==typeof TouchEvent){var ae=[],af=function(a){return{clientX:a.clientX,clientY:a.clientY,force:1,identifier:a.pointerId,pageX:a.pageX,pageY:a.pageY,radiusX:a.width/2,radiusY:a.height/2,screenX:a.screenX,screenY:a.screenY,target:a.target}},ag=function(a){ae.push({event:a,touch:af(a)})},ah=function(a){for(var b=0;b<ae.length;b++)if(ae[b].event.pointerId===a.pointerId)return void ae.splice(b,1)},ai=function(a){var b=ae.filter(function(b){return b.event.pointerId===a.pointerId})[0];b.event=a,b.touch=af(a)},aj=function(a){a.touches=ae.map(function(a){return a.touch})},ak=function(a){return"mouse"===a.pointerType||4===a.pointerType};A.registerBinding(A.container,"pointerdown",function(a){ak(a)||(a.preventDefault(),ag(a),aj(a),t(a))}),A.registerBinding(A.container,"pointerup",function(a){ak(a)||(ah(a),aj(a),w(a))}),A.registerBinding(A.container,"pointercancel",function(a){ak(a)||(ah(a),aj(a),v(a))}),A.registerBinding(A.container,"pointermove",function(a){ak(a)||(a.preventDefault(),ai(a),aj(a),u(a))})}};var AR={};AR.generatePolygon=function(a,b){return this.nodeShapes[a]={renderer:this,name:a,points:b,draw:function(a,b,c,d,e,f){this.renderer.nodeShapeImpl("polygon",a,b,c,d,e,this.points)},intersectLine:function(a,b,c,d,e,f,g,h){return tz(e,f,this.points,a,b,c/2,d/2,g)},checkPoint:function(a,b,c,d,e,f,g,h){return tp(a,b,this.points,f,g,d,e,[0,-1],c)},hasMiterBounds:"rectangle"!==a,miterBounds:function(a,b,c,d,e,f){var g,h,i;return g=this.points,h=function(a,b){if(a.length<3)throw Error("Need at least 3 vertices");var c=function(a,b){return{x:a.x+b.x,y:a.y+b.y}},d=function(a,b){return{x:a.x-b.x,y:a.y-b.y}},e=function(a,b){return{x:a.x*b,y:a.y*b}},f=function(a,b){return a.x*b.y-a.y*b.x},g=a.map(function(a){return{x:a.x,y:a.y}});0>function(a){for(var b=0,c=0;c<a.length;c++){var d=a[c],e=a[(c+1)%a.length];b+=d.x*e.y-e.x*d.y}return b/2}(g)&&g.reverse();for(var h=g.length,i=[],j=0;j<h;j++){var k=g[j],l=d(g[(j+1)%h],k),n=function(a){var b=tg(a.x,a.y);return 0===b?{x:0,y:0}:{x:a.x/b,y:a.y/b}}({x:l.y,y:-l.x});i.push(n)}for(var o=i.map(function(a,d){return{p1:c(g[d],e(a,b)),p2:c(g[(d+1)%h],e(a,b))}}),p=[],q=0;q<h;q++){var r=o[(q-1+h)%h],s=o[q],t=function(a,b,g,h){var i=d(b,a),j=d(h,g),k=f(i,j);if(1e-9>Math.abs(k))return c(a,e(i,.5));var l=f(d(g,a),j)/k;return c(a,e(i,l))}(r.p1,r.p2,s.p1,s.p2);p.push(t)}return p}(ty(g,a,b,c,d),e),i=s5(),h.forEach(function(a){return s8(i,a.x,a.y)}),i}}},AR.generateEllipse=function(){return this.nodeShapes.ellipse={renderer:this,name:"ellipse",draw:function(a,b,c,d,e,f){this.renderer.nodeShapeImpl(this.name,a,b,c,d,e)},intersectLine:function(a,b,c,d,e,f,g,h){return tt(e,f,a,b,c/2+g,d/2+g)},checkPoint:function(a,b,c,d,e,f,g,h){return tu(a,b,d,e,f,g,c)}}},AR.generateRoundPolygon=function(a,b){return this.nodeShapes[a]={renderer:this,name:a,points:b,getOrCreateCorners:function(a,c,d,e,f,g,h){if(void 0!==g[h]&&g[h+"-cx"]===a&&g[h+"-cy"]===c)return g[h];g[h]=Array(b.length/2),g[h+"-cx"]=a,g[h+"-cy"]=c;var i=d/2,j=e/2;f="auto"===f?tG(d,e):f;for(var k=Array(b.length/2),l=0;l<b.length/2;l++)k[l]={x:a+i*b[2*l],y:c+j*b[2*l+1]};var n,o,p,q,r=k.length;for(n=0,o=k[r-1];n<r;n++)p=k[n%r],q=k[(n+1)%r],g[h][n]=AA(o,p,q,f),o=p,p=q;return g[h]},draw:function(a,b,c,d,e,f,g){this.renderer.nodeShapeImpl("round-polygon",a,b,c,d,e,this.points,this.getOrCreateCorners(b,c,d,e,f,g,"drawCorners"))},intersectLine:function(a,b,c,d,e,f,g,h,i){return tA(e,f,this.points,a,b,c,d,g,this.getOrCreateCorners(a,b,c,d,h,i,"corners"))},checkPoint:function(a,b,c,d,e,f,g,h,i){return tq(a,b,this.points,f,g,d,e,this.getOrCreateCorners(f,g,d,e,h,i,"corners"))}}},AR.generateRoundRectangle=function(){return this.nodeShapes["round-rectangle"]=this.nodeShapes.roundrectangle={renderer:this,name:"round-rectangle",points:tC(4,0),draw:function(a,b,c,d,e,f){this.renderer.nodeShapeImpl(this.name,a,b,c,d,e,this.points,f)},intersectLine:function(a,b,c,d,e,f,g,h){return th(e,f,a,b,c,d,g,h)},checkPoint:function(a,b,c,d,e,f,g,h){var i=d/2,j=e/2,k=2*(h=Math.min(i,j,h="auto"===h?tF(d,e):h));return!!(tp(a,b,this.points,f,g,d,e-k,[0,-1],c)||tp(a,b,this.points,f,g,d-k,e,[0,-1],c)||tu(a,b,k,k,f-i+h,g-j+h,c)||tu(a,b,k,k,f+i-h,g-j+h,c)||tu(a,b,k,k,f+i-h,g+j-h,c)||tu(a,b,k,k,f-i+h,g+j-h,c))}}},AR.generateCutRectangle=function(){return this.nodeShapes["cut-rectangle"]=this.nodeShapes.cutrectangle={renderer:this,name:"cut-rectangle",cornerLength:tH(),points:tC(4,0),draw:function(a,b,c,d,e,f){this.renderer.nodeShapeImpl(this.name,a,b,c,d,e,null,f)},generateCutTrianglePts:function(a,b,c,d,e){var f="auto"===e?this.cornerLength:e,g=b/2,h=a/2,i=c-h,j=c+h,k=d-g,l=d+g;return{topLeft:[i,k+f,i+f,k,i+f,k+f],topRight:[j-f,k,j,k+f,j-f,k+f],bottomRight:[j,l-f,j-f,l,j-f,l-f],bottomLeft:[i+f,l,i,l-f,i+f,l-f]}},intersectLine:function(a,b,c,d,e,f,g,h){var i=this.generateCutTrianglePts(c+2*g,d+2*g,a,b,h);return tz(e,f,[].concat.apply([],[i.topLeft.splice(0,4),i.topRight.splice(0,4),i.bottomRight.splice(0,4),i.bottomLeft.splice(0,4)]),a,b)},checkPoint:function(a,b,c,d,e,f,g,h){var i="auto"===h?this.cornerLength:h;if(tp(a,b,this.points,f,g,d,e-2*i,[0,-1],c)||tp(a,b,this.points,f,g,d-2*i,e,[0,-1],c))return!0;var j=this.generateCutTrianglePts(d,e,f,g);return to(a,b,j.topLeft)||to(a,b,j.topRight)||to(a,b,j.bottomRight)||to(a,b,j.bottomLeft)}}},AR.generateBarrel=function(){return this.nodeShapes.barrel={renderer:this,name:"barrel",points:tC(4,0),draw:function(a,b,c,d,e,f){this.renderer.nodeShapeImpl(this.name,a,b,c,d,e)},intersectLine:function(a,b,c,d,e,f,g,h){var i=this.generateBarrelBezierPts(c+2*g,d+2*g,a,b),j=function(a){var b=s2({x:a[0],y:a[1]},{x:a[2],y:a[3]},{x:a[4],y:a[5]},.15),c=s2({x:a[0],y:a[1]},{x:a[2],y:a[3]},{x:a[4],y:a[5]},.5),d=s2({x:a[0],y:a[1]},{x:a[2],y:a[3]},{x:a[4],y:a[5]},.85);return[a[0],a[1],b.x,b.y,c.x,c.y,d.x,d.y,a[4],a[5]]};return tz(e,f,[].concat(j(i.topLeft),j(i.topRight),j(i.bottomRight),j(i.bottomLeft)),a,b)},generateBarrelBezierPts:function(a,b,c,d){var e=b/2,f=a/2,g=c-f,h=c+f,i=d-e,j=d+e,k=tI(a,b),l=k.heightOffset,n=k.widthOffset,o=k.ctrlPtOffsetPct*a,p={topLeft:[g,i+l,g+o,i,g+n,i],topRight:[h-n,i,h-o,i,h,i+l],bottomRight:[h,j-l,h-o,j,h-n,j],bottomLeft:[g+n,j,g+o,j,g,j-l]};return p.topLeft.isTop=!0,p.topRight.isTop=!0,p.bottomLeft.isBottom=!0,p.bottomRight.isBottom=!0,p},checkPoint:function(a,b,c,d,e,f,g,h){var i=tI(d,e),j=i.heightOffset,k=i.widthOffset;if(tp(a,b,this.points,f,g,d,e-2*j,[0,-1],c)||tp(a,b,this.points,f,g,d-2*k,e,[0,-1],c))return!0;for(var l=this.generateBarrelBezierPts(d,e,f,g),n=Object.keys(l),o=0;o<n.length;o++){var p=l[n[o]],q=function(a,b,c){var d=c[4],e=c[2],f=c[0],g=c[5],h=c[1],i=Math.min(d,f),j=Math.max(d,f),k=Math.min(g,h),l=Math.max(g,h);if(i<=a&&a<=j&&k<=b&&b<=l){var n=[d-2*e+f,2*(e-d),d],o=tk(n[0],n[1],n[2],a).filter(function(a){return 0<=a&&a<=1});if(o.length>0)return o[0]}return null}(a,b,p);if(null!=q){var r=s1(p[5],p[3],p[1],q);if(p.isTop&&r<=b||p.isBottom&&b<=r)return!0}}return!1}}},AR.generateBottomRoundrectangle=function(){return this.nodeShapes["bottom-round-rectangle"]=this.nodeShapes.bottomroundrectangle={renderer:this,name:"bottom-round-rectangle",points:tC(4,0),draw:function(a,b,c,d,e,f){this.renderer.nodeShapeImpl(this.name,a,b,c,d,e,this.points,f)},intersectLine:function(a,b,c,d,e,f,g,h){var i=a-(c/2+g),j=b-(d/2+g),k=a+(c/2+g),l=tx(e,f,a,b,i,j,k,j,!1);return l.length>0?l:th(e,f,a,b,c,d,g,h)},checkPoint:function(a,b,c,d,e,f,g,h){var i=2*(h="auto"===h?tF(d,e):h);if(tp(a,b,this.points,f,g,d,e-i,[0,-1],c)||tp(a,b,this.points,f,g,d-i,e,[0,-1],c))return!0;var j=d/2+2*c,k=e/2+2*c;return!!(to(a,b,[f-j,g-k,f-j,g,f+j,g,f+j,g-k])||tu(a,b,i,i,f+d/2-h,g+e/2-h,c)||tu(a,b,i,i,f-d/2+h,g+e/2-h,c))}}},AR.registerNodeShapes=function(){var a=this.nodeShapes={},b=this;this.generateEllipse(),this.generatePolygon("triangle",tC(3,0)),this.generateRoundPolygon("round-triangle",tC(3,0)),this.generatePolygon("rectangle",tC(4,0)),a.square=a.rectangle,this.generateRoundRectangle(),this.generateCutRectangle(),this.generateBarrel(),this.generateBottomRoundrectangle();var c=[0,1,1,0,0,-1,-1,0];this.generatePolygon("diamond",c),this.generateRoundPolygon("round-diamond",c),this.generatePolygon("pentagon",tC(5,0)),this.generateRoundPolygon("round-pentagon",tC(5,0)),this.generatePolygon("hexagon",tC(6,0)),this.generateRoundPolygon("round-hexagon",tC(6,0)),this.generatePolygon("heptagon",tC(7,0)),this.generateRoundPolygon("round-heptagon",tC(7,0)),this.generatePolygon("octagon",tC(8,0)),this.generateRoundPolygon("round-octagon",tC(8,0));var d=Array(20),e=tE(5,0),f=tE(5,Math.PI/5),g=.5*(3-Math.sqrt(5));g*=1.57;for(var h=0;h<f.length/2;h++)f[2*h]*=g,f[2*h+1]*=g;for(var h=0;h<5;h++)d[4*h]=e[2*h],d[4*h+1]=e[2*h+1],d[4*h+2]=f[2*h],d[4*h+3]=f[2*h+1];d=tD(d),this.generatePolygon("star",d),this.generatePolygon("vee",[-1,-1,0,-.333,1,-1,0,1]),this.generatePolygon("rhomboid",[-1,-1,.333,-1,1,1,-.333,1]),this.generatePolygon("right-rhomboid",[-.333,-1,1,-1,.333,1,-1,1]),this.nodeShapes.concavehexagon=this.generatePolygon("concave-hexagon",[-1,-.95,-.75,0,-1,.95,1,.95,.75,0,1,-.95]);var i=[-1,-1,.25,-1,1,0,.25,1,-1,1];this.generatePolygon("tag",i),this.generateRoundPolygon("round-tag",i),a.makePolygon=function(a){var c,d="polygon-"+a.join("$");return(c=this[d])?c:b.generatePolygon(d,a)}};var AS={};AS.timeToRender=function(){return this.redrawTotalTime/this.redrawCount},AS.redraw=function(a){a=a||ss(),void 0===this.averageRedrawTime&&(this.averageRedrawTime=0),void 0===this.lastRedrawTime&&(this.lastRedrawTime=0),void 0===this.lastDrawTime&&(this.lastDrawTime=0),this.requestedFrame=!0,this.renderOptions=a},AS.beforeRender=function(a,b){if(!this.destroyed){null==b&&sm("Priority is not optional for beforeRender");var c=this.beforeRenderCallbacks;c.push({fn:a,priority:b}),c.sort(function(a,b){return b.priority-a.priority})}};var AT=function(a,b,c){for(var d=a.beforeRenderCallbacks,e=0;e<d.length;e++)d[e].fn(b,c)};AS.startRenderLoop=function(){var a=this,b=a.cy;if(!a.renderLoopStarted){a.renderLoopStarted=!0;var c=function(d){if(!a.destroyed){if(b.batching());else if(a.requestedFrame&&!a.skipFrame){AT(a,!0,d);var e=r2();a.render(a.renderOptions);var f=a.lastDrawTime=r2();void 0===a.averageRedrawTime&&(a.averageRedrawTime=f-e),void 0===a.redrawCount&&(a.redrawCount=0),a.redrawCount++,void 0===a.redrawTotalTime&&(a.redrawTotalTime=0);var g=f-e;a.redrawTotalTime+=g,a.lastRedrawTime=g,a.averageRedrawTime=a.averageRedrawTime/2+g/2,a.requestedFrame=!1}else AT(a,!1,d);a.skipFrame=!1,r4(c)}};r4(c)}};var AU=function(a){this.init(a)},AV=AU.prototype;AV.clientFunctions=["redrawHint","render","renderTo","matchCanvasSize","nodeShapeImpl","arrowShapeImpl"],AV.init=function(a){this.options=a,this.cy=a.cy;var b=this.container=a.cy.container(),c=this.cy.window();if(c){var d=c.document,e=d.head,f="__________cytoscape_stylesheet",g="__________cytoscape_container",h=null!=d.getElementById(f);if(0>b.className.indexOf(g)&&(b.className=(b.className||"")+" "+g),!h){var i=d.createElement("style");i.id=f,i.textContent="."+g+" { position: relative; }",e.insertBefore(i,e.children[0])}"static"===c.getComputedStyle(b).getPropertyValue("position")&&so("A Cytoscape container has style position:static and so can not use UI extensions properly")}this.selection=[void 0,void 0,void 0,void 0,0],this.bezierProjPcts=[.05,.225,.4,.5,.6,.775,.95],this.hoverData={down:null,last:null,downTime:null,triggerMode:null,dragging:!1,initialPan:[null,null],capture:!1},this.dragData={possibleDragElements:[]},this.touchData={start:null,capture:!1,startPosition:[null,null,null,null,null,null],singleTouchStartTime:null,singleTouchMoved:!0,now:[null,null,null,null,null,null],earlier:[null,null,null,null,null,null]},this.redraws=0,this.showFps=a.showFps,this.debug=a.debug,this.webgl=a.webgl,this.hideEdgesOnViewport=a.hideEdgesOnViewport,this.textureOnViewport=a.textureOnViewport,this.wheelSensitivity=a.wheelSensitivity,this.motionBlurEnabled=a.motionBlur,this.forcedPixelRatio=rt(a.pixelRatio)?a.pixelRatio:null,this.motionBlur=a.motionBlur,this.motionBlurOpacity=a.motionBlurOpacity,this.motionBlurTransparency=1-this.motionBlurOpacity,this.motionBlurPxRatio=1,this.mbPxRBlurry=1,this.minMbLowQualFrames=4,this.fullQualityMb=!1,this.clearedForMotionBlur=[],this.desktopTapThreshold=a.desktopTapThreshold,this.desktopTapThreshold2=a.desktopTapThreshold*a.desktopTapThreshold,this.touchTapThreshold=a.touchTapThreshold,this.touchTapThreshold2=a.touchTapThreshold*a.touchTapThreshold,this.tapholdDuration=500,this.bindings=[],this.beforeRenderCallbacks=[],this.beforeRenderPriorities={animations:400,eleCalcs:300,eleTxrDeq:200,lyrTxrDeq:150,lyrTxrSkip:100},this.registerNodeShapes(),this.registerArrowShapes(),this.registerCalculationListeners()},AV.notify=function(a,b){var c=this.cy;if(!this.destroyed){if("init"===a)return void this.load();if("destroy"===a)return void this.destroy();("add"===a||"remove"===a||"move"===a&&c.hasCompoundNodes()||"load"===a||"zorder"===a||"mount"===a)&&this.invalidateCachedZSortedEles(),"viewport"===a&&this.redrawHint("select",!0),"gc"===a&&this.redrawHint("gc",!0),("load"===a||"resize"===a||"mount"===a)&&(this.invalidateContainerClientCoordsCache(),this.matchCanvasSize(this.container)),this.redrawHint("eles",!0),this.redrawHint("drag",!0),this.startRenderLoop(),this.redraw()}},AV.destroy=function(){this.destroyed=!0,this.cy.stopAnimationLoop();for(var a=0;a<this.bindings.length;a++){var b=this.bindings[a],c=b.target;(c.off||c.removeEventListener).apply(c,b.args)}if(this.bindings=[],this.beforeRenderCallbacks=[],this.onUpdateEleCalcsFns=[],this.removeObserver&&this.removeObserver.disconnect(),this.styleObserver&&this.styleObserver.disconnect(),this.resizeObserver&&this.resizeObserver.disconnect(),this.labelCalcDiv)try{document.body.removeChild(this.labelCalcDiv)}catch(a){}},AV.isHeadless=function(){return!1},[xF,AO,AP,AQ,AR,AS].forEach(function(a){rO(AV,a)});var AW=1e3/60,AX=function(a){return function(){var b=this,c=this.renderer;if(!b.dequeueingSetup){b.dequeueingSetup=!0;var d=r1(function(){c.redrawHint("eles",!0),c.redrawHint("drag",!0),c.redraw()},a.deqRedrawThreshold),e=a.priority||sl;c.beforeRender(function(e,f){var g=r2(),h=c.averageRedrawTime,i=c.lastRedrawTime,j=[],k=c.cy.extent(),l=c.getPixelRatio();for(e||c.flushRenderedStyleQueue();;){var n=r2(),o=n-g,p=n-f;if(i<AW){var q=AW-(e?h:0);if(p>=a.deqFastCost*q)break}else if(e){if(o>=a.deqCost*i||o>=a.deqAvgCost*h)break}else if(p>=a.deqNoDrawCost*AW)break;var r=a.deq(b,l,k);if(r.length>0)for(var s=0;s<r.length;s++)j.push(r[s]);else break}j.length>0&&(a.onDeqd(b,j),!e&&a.shouldRedraw(b,j,l,k)&&d())},e(b))}}},AY=rc(function a(b){var c=arguments.length>1&&void 0!==arguments[1]?arguments[1]:sj;rb(this,a),this.idsByKey=new sA,this.keyForId=new sA,this.cachesByLvl=new sA,this.lvls=[],this.getKey=b,this.doesEleInvalidateKey=c},[{key:"getIdsFor",value:function(a){null==a&&sm("Can not get id list for null key");var b=this.idsByKey,c=this.idsByKey.get(a);return c||(c=new sC,b.set(a,c)),c}},{key:"addIdForKey",value:function(a,b){null!=a&&this.getIdsFor(a).add(b)}},{key:"deleteIdForKey",value:function(a,b){null!=a&&this.getIdsFor(a).delete(b)}},{key:"getNumberOfIdsForKey",value:function(a){return null==a?0:this.getIdsFor(a).size}},{key:"updateKeyMappingFor",value:function(a){var b=a.id(),c=this.keyForId.get(b),d=this.getKey(a);this.deleteIdForKey(c,b),this.addIdForKey(d,b),this.keyForId.set(b,d)}},{key:"deleteKeyMappingFor",value:function(a){var b=a.id(),c=this.keyForId.get(b);this.deleteIdForKey(c,b),this.keyForId.delete(b)}},{key:"keyHasChangedFor",value:function(a){var b=a.id();return this.keyForId.get(b)!==this.getKey(a)}},{key:"isInvalid",value:function(a){return this.keyHasChangedFor(a)||this.doesEleInvalidateKey(a)}},{key:"getCachesAt",value:function(a){var b=this.cachesByLvl,c=this.lvls,d=b.get(a);return d||(d=new sA,b.set(a,d),c.push(a)),d}},{key:"getCache",value:function(a,b){return this.getCachesAt(b).get(a)}},{key:"get",value:function(a,b){var c=this.getKey(a),d=this.getCache(c,b);return null!=d&&this.updateKeyMappingFor(a),d}},{key:"getForCachedKey",value:function(a,b){var c=this.keyForId.get(a.id());return this.getCache(c,b)}},{key:"hasCache",value:function(a,b){return this.getCachesAt(b).has(a)}},{key:"has",value:function(a,b){var c=this.getKey(a);return this.hasCache(c,b)}},{key:"setCache",value:function(a,b,c){c.key=a,this.getCachesAt(b).set(a,c)}},{key:"set",value:function(a,b,c){var d=this.getKey(a);this.setCache(d,b,c),this.updateKeyMappingFor(a)}},{key:"deleteCache",value:function(a,b){this.getCachesAt(b).delete(a)}},{key:"delete",value:function(a,b){var c=this.getKey(a);this.deleteCache(c,b)}},{key:"invalidateKey",value:function(a){var b=this;this.lvls.forEach(function(c){return b.deleteCache(a,c)})}},{key:"invalidate",value:function(a){var b=a.id(),c=this.keyForId.get(b);this.deleteKeyMappingFor(a);var d=this.doesEleInvalidateKey(a);return d&&this.invalidateKey(c),d||0===this.getNumberOfIdsForKey(c)}}]),AZ={dequeue:"dequeue",downscale:"downscale",highQuality:"highQuality"},A$=st({getKey:null,doesEleInvalidateKey:sj,drawElement:null,getBoundingBox:null,getRotationPoint:null,getRotationOffset:null,isVisible:si,allowEdgeTxrCaching:!0,allowParentTxrCaching:!0}),A_=function(a,b){this.renderer=a,this.onDequeues=[];var c=A$(b);rO(this,c),this.lookup=new AY(c.getKey,c.doesEleInvalidateKey),this.setupDequeueing()},A0=A_.prototype;A0.reasons=AZ,A0.getTextureQueue=function(a){return this.eleImgCaches=this.eleImgCaches||{},this.eleImgCaches[a]=this.eleImgCaches[a]||[]},A0.getRetiredTextureQueue=function(a){var b=this.eleImgCaches.retired=this.eleImgCaches.retired||{};return b[a]=b[a]||[]},A0.getElementQueue=function(){return this.eleCacheQueue=this.eleCacheQueue||new sI(function(a,b){return b.reqs-a.reqs})},A0.getElementKeyToQueue=function(){return this.eleKeyToCacheQueue=this.eleKeyToCacheQueue||{}},A0.getElement=function(a,b,c,d,e){var f,g,h,i=this,j=this.renderer,k=j.cy.zoom(),l=this.lookup;if(!b||0===b.w||0===b.h||isNaN(b.w)||isNaN(b.h)||!a.visible()||a.removed()||!i.allowEdgeTxrCaching&&a.isEdge()||!i.allowParentTxrCaching&&a.isParent())return null;if(null==d&&(d=Math.ceil(sY(k*c))),d<-4)d=-4;else if(k>=7.99||d>3)return null;var n=Math.pow(2,d),o=b.h*n,p=b.w*n,q=j.eleTextBiggerThanMin(a,n);if(!this.isVisible(a,q))return null;var r=l.get(a,d);if(r&&r.invalidated&&(r.invalidated=!1,r.texture.invalidatedWidth-=r.width),r)return r;if(f=o<=25?25:o<=50?50:50*Math.ceil(o/50),o>1024||p>1024)return null;var s=i.getTextureQueue(f),t=s[s.length-2],u=function(){return i.recycleTexture(f,p)||i.addTexture(f,p)};t||(t=s[s.length-1]),t||(t=u()),t.width-t.usedWidth<p&&(t=u());for(var v=function(a){return a&&a.scaledLabelShown===q},w=e&&e===AZ.dequeue,x=e&&e===AZ.highQuality,y=e&&e===AZ.downscale,z=d+1;z<=3;z++){var A=l.get(a,z);if(A){g=A;break}}var B=g&&g.level===d+1?g:null,C=function(){t.context.drawImage(B.texture.canvas,B.x,0,B.width,B.height,t.usedWidth,0,p,o)};if(t.context.setTransform(1,0,0,1,0,0),t.context.clearRect(t.usedWidth,0,p,f),v(B))C();else if(v(g))if(!x)return i.queueElement(a,g.level-1),g;else{for(var D=g.level;D>d;D--)B=i.getElement(a,b,c,D,AZ.downscale);C()}else{if(!w&&!x&&!y)for(var E=d-1;E>=-4;E--){var F=l.get(a,E);if(F){h=F;break}}if(v(h))return i.queueElement(a,d),h;t.context.translate(t.usedWidth,0),t.context.scale(n,n),this.drawElement(t.context,a,b,q,!1),t.context.scale(1/n,1/n),t.context.translate(-t.usedWidth,0)}return r={x:t.usedWidth,texture:t,level:d,scale:n,width:p,height:o,scaledLabelShown:q},t.usedWidth+=Math.ceil(p+8),t.eleCaches.push(r),l.set(a,d,r),i.checkTextureFullness(t),r},A0.invalidateElements=function(a){for(var b=0;b<a.length;b++)this.invalidateElement(a[b])},A0.invalidateElement=function(a){var b=this.lookup,c=[];if(b.isInvalid(a)){for(var d=-4;d<=3;d++){var e=b.getForCachedKey(a,d);e&&c.push(e)}if(b.invalidate(a))for(var f=0;f<c.length;f++){var g=c[f],h=g.texture;h.invalidatedWidth+=g.width,g.invalidated=!0,this.checkTextureUtility(h)}this.removeFromQueue(a)}},A0.checkTextureUtility=function(a){a.invalidatedWidth>=.2*a.width&&this.retireTexture(a)},A0.checkTextureFullness=function(a){var b=this.getTextureQueue(a.height);a.usedWidth/a.width>.8&&a.fullnessChecks>=10?su(b,a):a.fullnessChecks++},A0.retireTexture=function(a){var b=a.height,c=this.getTextureQueue(b),d=this.lookup;su(c,a),a.retired=!0;for(var e=a.eleCaches,f=0;f<e.length;f++){var g=e[f];d.deleteCache(g.key,g.level)}sv(e),this.getRetiredTextureQueue(b).push(a)},A0.addTexture=function(a,b){var c=this.getTextureQueue(a),d={};return c.push(d),d.eleCaches=[],d.height=a,d.width=Math.max(1024,b),d.usedWidth=0,d.invalidatedWidth=0,d.fullnessChecks=0,d.canvas=this.renderer.makeOffscreenCanvas(d.width,d.height),d.context=d.canvas.getContext("2d"),d},A0.recycleTexture=function(a,b){for(var c=this.getTextureQueue(a),d=this.getRetiredTextureQueue(a),e=0;e<d.length;e++){var f=d[e];if(f.width>=b)return f.retired=!1,f.usedWidth=0,f.invalidatedWidth=0,f.fullnessChecks=0,sv(f.eleCaches),f.context.setTransform(1,0,0,1,0,0),f.context.clearRect(0,0,f.width,f.height),su(d,f),c.push(f),f}},A0.queueElement=function(a,b){var c=this.getElementQueue(),d=this.getElementKeyToQueue(),e=this.getKey(a),f=d[e];if(f)f.level=Math.max(f.level,b),f.eles.merge(a),f.reqs++,c.updateItem(f);else{var g={eles:a.spawn().merge(a),level:b,reqs:1,key:e};c.push(g),d[e]=g}},A0.dequeue=function(a){for(var b=this.getElementQueue(),c=this.getElementKeyToQueue(),d=[],e=this.lookup,f=0;f<1;f++)if(b.size()>0){var g=b.pop(),h=g.key,i=g.eles[0],j=e.hasCache(i,g.level);if(c[h]=null,j)continue;d.push(g);var k=this.getBoundingBox(i);this.getElement(i,k,a,g.level,AZ.dequeue)}else break;return d},A0.removeFromQueue=function(a){var b=this.getElementQueue(),c=this.getElementKeyToQueue(),d=this.getKey(a),e=c[d];null!=e&&(1===e.eles.length?(e.reqs=sh,b.updateItem(e),b.pop(),c[d]=null):e.eles.unmerge(a))},A0.onDequeue=function(a){this.onDequeues.push(a)},A0.offDequeue=function(a){su(this.onDequeues,a)},A0.setupDequeueing=AX({deqRedrawThreshold:100,deqCost:.15,deqAvgCost:.1,deqNoDrawCost:.9,deqFastCost:.9,deq:function(a,b,c){return a.dequeue(b,c)},onDeqd:function(a,b){for(var c=0;c<a.onDequeues.length;c++)(0,a.onDequeues[c])(b)},shouldRedraw:function(a,b,c,d){for(var e=0;e<b.length;e++)for(var f=b[e].eles,g=0;g<f.length;g++)if(tc(f[g].boundingBox(),d))return!0;return!1},priority:function(a){return a.renderer.beforeRenderPriorities.eleTxrDeq}});var A1=function(a){var b=this,c=b.renderer=a,d=c.cy;b.layersByLevel={},b.firstGet=!0,b.lastInvalidationTime=r2()-500,b.skipping=!1,b.eleTxrDeqs=d.collection(),b.scheduleElementRefinement=r1(function(){b.refineElementTextures(b.eleTxrDeqs),b.eleTxrDeqs.unmerge(b.eleTxrDeqs)},50),c.beforeRender(function(a,c){c-b.lastInvalidationTime<=250?b.skipping=!0:b.skipping=!1},c.beforeRenderPriorities.lyrTxrSkip),b.layersQueue=new sI(function(a,b){return b.reqs-a.reqs}),b.setupDequeueing()},A2=A1.prototype,A3=0;A2.makeLayer=function(a,b){var c=Math.pow(2,b),d=Math.ceil(a.w*c),e=Math.ceil(a.h*c),f=this.renderer.makeOffscreenCanvas(d,e),g={id:A3=++A3%0x1fffffffffffff,bb:a,level:b,width:d,height:e,canvas:f,context:f.getContext("2d"),eles:[],elesQueue:[],reqs:0},h=g.context,i=-g.bb.x1,j=-g.bb.y1;return h.scale(c,c),h.translate(i,j),g},A2.getLayers=function(a,b,c){var d,e,f=this,g=f.renderer.cy.zoom(),h=f.firstGet;if(f.firstGet=!1,null==c){if((c=Math.ceil(sY(g*b)))<-4)c=-4;else if(g>=3.99||c>2)return null}f.validateLayersElesOrdering(c,a);var i=f.layersByLevel,j=Math.pow(2,c),k=i[c]=i[c]||[];if(f.levelIsComplete(c,a))return k;var l=function(b){if(f.validateLayersElesOrdering(b,a),f.levelIsComplete(b,a))return e=i[b],!0},n=function(a){if(!e)for(var b=c+a;-4<=b&&b<=2&&!l(b);b+=a);};n(1),n(-1);for(var o=k.length-1;o>=0;o--){var p=k[o];p.invalid&&su(k,p)}var q=function(){if(!d){d=s5();for(var b=0;b<a.length;b++)s7(d,a[b].boundingBox())}return d};if(f.skipping&&!h)return null;for(var r=null,s=a.length/1,t=!h,u=0;u<a.length;u++){var v=a[u],w=v._private.rscratch,x=w.imgLayerCaches=w.imgLayerCaches||{},y=x[c];if(y){r=y;continue}if((!r||r.eles.length>=s||!tf(r.bb,v.boundingBox()))&&!(r=function(a){var b=(a=a||{}).after;q();var e=Math.ceil(d.w*j),g=Math.ceil(d.h*j);if(e>32767||g>32767||e*g>16e6)return null;var h=f.makeLayer(d,c);if(null!=b){var i=k.indexOf(b)+1;k.splice(i,0,h)}else(void 0===a.insert||a.insert)&&k.unshift(h);return h}({insert:!0,after:r})))return null;e||t?f.queueLayer(r,v):f.drawEleInLayer(r,v,c,b),r.eles.push(v),x[c]=r}return e||(t?null:k)},A2.getEleLevelForLayerLevel=function(a,b){return a},A2.drawEleInLayer=function(a,b,c,d){var e=this.renderer,f=a.context,g=b.boundingBox();0!==g.w&&0!==g.h&&b.visible()&&(c=this.getEleLevelForLayerLevel(c,d),e.setImgSmoothing(f,!1),e.drawCachedElement(f,b,null,null,c,!0),e.setImgSmoothing(f,!0))},A2.levelIsComplete=function(a,b){var c=this.layersByLevel[a];if(!c||0===c.length)return!1;for(var d=0,e=0;e<c.length;e++){var f=c[e];if(f.reqs>0||f.invalid)return!1;d+=f.eles.length}return d===b.length},A2.validateLayersElesOrdering=function(a,b){var c=this.layersByLevel[a];if(c)for(var d=0;d<c.length;d++){for(var e=c[d],f=-1,g=0;g<b.length;g++)if(e.eles[0]===b[g]){f=g;break}if(f<0){this.invalidateLayer(e);continue}for(var h=f,g=0;g<e.eles.length;g++)if(e.eles[g]!==b[h+g]){this.invalidateLayer(e);break}}},A2.updateElementsInLayers=function(a,b){for(var c=rw(a[0]),d=0;d<a.length;d++)for(var e=c?null:a[d],f=c?a[d]:a[d].ele,g=f._private.rscratch,h=g.imgLayerCaches=g.imgLayerCaches||{},i=-4;i<=2;i++){var j=h[i];j&&(e&&this.getEleLevelForLayerLevel(j.level)!==e.level||b(j,f,e))}},A2.haveLayers=function(){for(var a=!1,b=-4;b<=2;b++){var c=this.layersByLevel[b];if(c&&c.length>0){a=!0;break}}return a},A2.invalidateElements=function(a){var b=this;0===a.length||(b.lastInvalidationTime=r2(),0!==a.length&&b.haveLayers()&&b.updateElementsInLayers(a,function(a,c,d){b.invalidateLayer(a)}))},A2.invalidateLayer=function(a){if(this.lastInvalidationTime=r2(),!a.invalid){var b=a.level,c=a.eles;su(this.layersByLevel[b],a),a.elesQueue=[],a.invalid=!0,a.replacement&&(a.replacement.invalid=!0);for(var d=0;d<c.length;d++){var e=c[d]._private.rscratch.imgLayerCaches;e&&(e[b]=null)}}},A2.refineElementTextures=function(a){var b=this;b.updateElementsInLayers(a,function(a,c,d){var e=a.replacement;if(e||((e=a.replacement=b.makeLayer(a.bb,a.level)).replaces=a,e.eles=a.eles),!e.reqs)for(var f=0;f<e.eles.length;f++)b.queueLayer(e,e.eles[f])})},A2.enqueueElementRefinement=function(a){this.eleTxrDeqs.merge(a),this.scheduleElementRefinement()},A2.queueLayer=function(a,b){var c=this.layersQueue,d=a.elesQueue,e=d.hasId=d.hasId||{};if(!a.replacement){if(b){if(e[b.id()])return;d.push(b),e[b.id()]=!0}a.reqs?(a.reqs++,c.updateItem(a)):(a.reqs=1,c.push(a))}},A2.dequeue=function(a){for(var b=this.layersQueue,c=[],d=0;d<1&&0!==b.size();){var e=b.peek();if(e.replacement||e.replaces&&e!==e.replaces.replacement||e.invalid){b.pop();continue}var f=e.elesQueue.shift();f&&(this.drawEleInLayer(e,f,e.level,a),d++),0===c.length&&c.push(!0),0===e.elesQueue.length&&(b.pop(),e.reqs=0,e.replaces&&this.applyLayerReplacement(e),this.requestRedraw())}return c},A2.applyLayerReplacement=function(a){var b=this.layersByLevel[a.level],c=a.replaces,d=b.indexOf(c);if(!(d<0)&&!c.invalid){b[d]=a;for(var e=0;e<a.eles.length;e++){var f=a.eles[e]._private,g=f.imgLayerCaches=f.imgLayerCaches||{};g&&(g[a.level]=a)}this.requestRedraw()}},A2.requestRedraw=r1(function(){var a=this.renderer;a.redrawHint("eles",!0),a.redrawHint("drag",!0),a.redraw()},100),A2.setupDequeueing=AX({deqRedrawThreshold:50,deqCost:.15,deqAvgCost:.1,deqNoDrawCost:.9,deqFastCost:.9,deq:function(a,b){return a.dequeue(b)},onDeqd:sl,shouldRedraw:si,priority:function(a){return a.renderer.beforeRenderPriorities.lyrTxrDeq}});var A4={};function A5(a,b){for(var c=0;c<b.length;c++){var d=b[c];a.lineTo(d.x,d.y)}}function A6(a,b,c){for(var d,e=0;e<b.length;e++){var f=b[e];0===e&&(d=f),a.lineTo(f.x,f.y)}a.quadraticCurveTo(c.x,c.y,d.x,d.y)}function A7(a,b,c){a.beginPath&&a.beginPath();for(var d=0;d<b.length;d++){var e=b[d];a.lineTo(e.x,e.y)}var f=c[0];a.moveTo(f.x,f.y);for(var d=1;d<c.length;d++){var e=c[d];a.lineTo(e.x,e.y)}a.closePath&&a.closePath()}function A8(a,b,c,d,e){a.beginPath&&a.beginPath(),a.arc(c,d,e,0,2*Math.PI,!1);var f=b[0];a.moveTo(f.x,f.y);for(var g=0;g<b.length;g++){var h=b[g];a.lineTo(h.x,h.y)}a.closePath&&a.closePath()}function A9(a,b,c,d){a.arc(b,c,d,0,2*Math.PI,!1)}A4.arrowShapeImpl=function(a){return(r||(r={polygon:A5,"triangle-backcurve":A6,"triangle-tee":A7,"circle-triangle":A8,"triangle-cross":A7,circle:A9}))[a]};var Ba={};Ba.drawElement=function(a,b,c,d,e,f){b.isNode()?this.drawNode(a,b,c,d,e,f):this.drawEdge(a,b,c,d,e,f)},Ba.drawElementOverlay=function(a,b){b.isNode()?this.drawNodeOverlay(a,b):this.drawEdgeOverlay(a,b)},Ba.drawElementUnderlay=function(a,b){b.isNode()?this.drawNodeUnderlay(a,b):this.drawEdgeUnderlay(a,b)},Ba.drawCachedElementPortion=function(a,b,c,d,e,f,g,h){var i=c.getBoundingBox(b);if(0!==i.w&&0!==i.h){var j=c.getElement(b,i,d,e,f);if(null!=j){var k,l,n,o,p,q,r=h(this,b);if(0===r)return;var s=g(this,b),t=i.x1,u=i.y1,v=i.w,w=i.h;if(0!==s){var x=c.getRotationPoint(b);n=x.x,o=x.y,a.translate(n,o),a.rotate(s),(p=this.getImgSmoothing(a))||this.setImgSmoothing(a,!0);var y=c.getRotationOffset(b);k=y.x,l=y.y}else k=t,l=u;1!==r&&(q=a.globalAlpha,a.globalAlpha=q*r),a.drawImage(j.texture.canvas,j.x,0,j.width,j.height,k,l,v,w),1!==r&&(a.globalAlpha=q),0!==s&&(a.rotate(-s),a.translate(-n,-o),p||this.setImgSmoothing(a,!1))}else c.drawElement(a,b)}};var Bb=function(){return 0},Bc=function(a,b){return a.getTextAngle(b,null)},Bd=function(a,b){return a.getTextAngle(b,"source")},Be=function(a,b){return a.getTextAngle(b,"target")},Bf=function(a,b){return b.effectiveOpacity()},Bg=function(a,b){return b.pstyle("text-opacity").pfValue*b.effectiveOpacity()};Ba.drawCachedElement=function(a,b,c,d,e,f){var g=this.data,h=g.eleTxrCache,i=g.lblTxrCache,j=g.slbTxrCache,k=g.tlbTxrCache,l=b.boundingBox(),n=!0===f?h.reasons.highQuality:null;if(0!==l.w&&0!==l.h&&b.visible()&&(!d||tc(l,d))){var o=b.isEdge(),p=b.element()._private.rscratch.badLine;this.drawElementUnderlay(a,b),this.drawCachedElementPortion(a,b,h,c,e,n,Bb,Bf),o&&p||this.drawCachedElementPortion(a,b,i,c,e,n,Bc,Bg),o&&!p&&(this.drawCachedElementPortion(a,b,j,c,e,n,Bd,Bg),this.drawCachedElementPortion(a,b,k,c,e,n,Be,Bg)),this.drawElementOverlay(a,b)}},Ba.drawElements=function(a,b){for(var c=0;c<b.length;c++){var d=b[c];this.drawElement(a,d)}},Ba.drawCachedElements=function(a,b,c,d){for(var e=0;e<b.length;e++){var f=b[e];this.drawCachedElement(a,f,c,d)}},Ba.drawCachedNodes=function(a,b,c,d){for(var e=0;e<b.length;e++){var f=b[e];f.isNode()&&this.drawCachedElement(a,f,c,d)}},Ba.drawLayeredElements=function(a,b,c,d){var e=this.data.lyrTxrCache.getLayers(b,c);if(e)for(var f=0;f<e.length;f++){var g=e[f],h=g.bb;0!==h.w&&0!==h.h&&a.drawImage(g.canvas,h.x1,h.y1,h.w,h.h)}else this.drawCachedElements(a,b,c,d)};var Bh={};Bh.drawEdge=function(a,b,c){var d,e=!(arguments.length>3)||void 0===arguments[3]||arguments[3],f=!(arguments.length>4)||void 0===arguments[4]||arguments[4],g=!(arguments.length>5)||void 0===arguments[5]||arguments[5],h=this,i=b._private.rscratch;if((!g||b.visible())&&!(i.badLine||null==i.allpts||isNaN(i.allpts[0]))){c&&(d=c,a.translate(-d.x1,-d.y1));var j=g?b.pstyle("opacity").value:1,k=g?b.pstyle("line-opacity").value:1,l=b.pstyle("curve-style").value,n=b.pstyle("line-style").value,o=b.pstyle("width").pfValue,p=b.pstyle("line-cap").value,q=b.pstyle("line-outline-width").value,r=b.pstyle("line-outline-color").value,s=j*k,t=j*k,u=function(){var c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s;"straight-triangle"===l?(h.eleStrokeStyle(a,b,c),h.drawEdgeTrianglePath(b,a,i.allpts)):(a.lineWidth=o,a.lineCap=p,h.eleStrokeStyle(a,b,c),h.drawEdgePath(b,a,i.allpts,n),a.lineCap="butt")},v=function(){var c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t;h.drawArrowheads(a,b,c)};if(a.lineJoin="round","yes"===b.pstyle("ghost").value){var w=b.pstyle("ghost-offset-x").pfValue,x=b.pstyle("ghost-offset-y").pfValue,y=s*b.pstyle("ghost-opacity").value;a.translate(w,x),u(y),v(y),a.translate(-w,-x)}else!function(){var c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:s;if(a.lineWidth=o+q,a.lineCap=p,q>0)h.colorStrokeStyle(a,r[0],r[1],r[2],c);else{a.lineCap="butt";return}"straight-triangle"===l?h.drawEdgeTrianglePath(b,a,i.allpts):(h.drawEdgePath(b,a,i.allpts,n),a.lineCap="butt")}();f&&h.drawEdgeUnderlay(a,b),u(),v(),f&&h.drawEdgeOverlay(a,b),h.drawElementText(a,b,null,e),c&&a.translate(d.x1,d.y1)}};var Bi=function(a){if(!["overlay","underlay"].includes(a))throw Error("Invalid state");return function(b,c){if(c.visible()){var d=c.pstyle("".concat(a,"-opacity")).value;if(0!==d){var e=this.usePaths(),f=c._private.rscratch,g=c.pstyle("".concat(a,"-padding")).pfValue,h=c.pstyle("".concat(a,"-color")).value;b.lineWidth=2*g,"self"!==f.edgeType||e?b.lineCap="round":b.lineCap="butt",this.colorStrokeStyle(b,h[0],h[1],h[2],d),this.drawEdgePath(c,b,f.allpts,"solid")}}}};Bh.drawEdgeOverlay=Bi("overlay"),Bh.drawEdgeUnderlay=Bi("underlay"),Bh.drawEdgePath=function(a,b,c,d){var e=a._private.rscratch,f=b,g=!1,h=this.usePaths(),i=a.pstyle("line-dash-pattern").pfValue,j=a.pstyle("line-dash-offset").pfValue;if(h){var k=c.join("$");e.pathCacheKey&&e.pathCacheKey===k?(o=b=e.pathCache,g=!0):(o=b=new Path2D,e.pathCacheKey=k,e.pathCache=o)}if(f.setLineDash)switch(d){case"dotted":f.setLineDash([1,1]);break;case"dashed":f.setLineDash(i),f.lineDashOffset=j;break;case"solid":f.setLineDash([])}if(!g&&!e.badLine)switch(b.beginPath&&b.beginPath(),b.moveTo(c[0],c[1]),e.edgeType){case"bezier":case"self":case"compound":case"multibezier":for(var l=2;l+3<c.length;l+=4)b.quadraticCurveTo(c[l],c[l+1],c[l+2],c[l+3]);break;case"straight":case"haystack":for(var n=2;n+1<c.length;n+=2)b.lineTo(c[n],c[n+1]);break;case"segments":if(e.isRound){var o,p,q=rd(e.roundCorners);try{for(q.s();!(p=q.n()).done;){var r=p.value;Az(b,r)}}catch(a){q.e(a)}finally{q.f()}b.lineTo(c[c.length-2],c[c.length-1])}else for(var s=2;s+1<c.length;s+=2)b.lineTo(c[s],c[s+1])}b=f,h?b.stroke(o):b.stroke(),b.setLineDash&&b.setLineDash([])},Bh.drawEdgeTrianglePath=function(a,b,c){b.fillStyle=b.strokeStyle;for(var d=a.pstyle("width").pfValue,e=0;e+1<c.length;e+=2){var f=[c[e+2]-c[e],c[e+3]-c[e+1]],g=Math.sqrt(f[0]*f[0]+f[1]*f[1]),h=[f[1]/g,-f[0]/g],i=[h[0]*d/2,h[1]*d/2];b.beginPath(),b.moveTo(c[e]-i[0],c[e+1]-i[1]),b.lineTo(c[e]+i[0],c[e+1]+i[1]),b.lineTo(c[e+2],c[e+3]),b.closePath(),b.fill()}},Bh.drawArrowheads=function(a,b,c){var d=b._private.rscratch,e="haystack"===d.edgeType;e||this.drawArrowhead(a,b,"source",d.arrowStartX,d.arrowStartY,d.srcArrowAngle,c),this.drawArrowhead(a,b,"mid-target",d.midX,d.midY,d.midtgtArrowAngle,c),this.drawArrowhead(a,b,"mid-source",d.midX,d.midY,d.midsrcArrowAngle,c),e||this.drawArrowhead(a,b,"target",d.arrowEndX,d.arrowEndY,d.tgtArrowAngle,c)},Bh.drawArrowhead=function(a,b,c,d,e,f,g){if(!(isNaN(d)||null==d||isNaN(e)||null==e||isNaN(f))&&null!=f){var h=b.pstyle(c+"-arrow-shape").value;if("none"!==h){var i="hollow"===b.pstyle(c+"-arrow-fill").value?"both":"filled",j=b.pstyle(c+"-arrow-fill").value,k=b.pstyle("width").pfValue,l=b.pstyle(c+"-arrow-width"),n="match-line"===l.value?k:l.pfValue;"%"===l.units&&(n*=k);var o=b.pstyle("opacity").value;void 0===g&&(g=o);var p=a.globalCompositeOperation;(1!==g||"hollow"===j)&&(a.globalCompositeOperation="destination-out",this.colorFillStyle(a,255,255,255,1),this.colorStrokeStyle(a,255,255,255,1),this.drawArrowShape(b,a,i,k,h,n,d,e,f),a.globalCompositeOperation=p);var q=b.pstyle(c+"-arrow-color").value;this.colorFillStyle(a,q[0],q[1],q[2],g),this.colorStrokeStyle(a,q[0],q[1],q[2],g),this.drawArrowShape(b,a,j,k,h,n,d,e,f)}}},Bh.drawArrowShape=function(a,b,c,d,e,f,g,h,i){var j,k=this.usePaths()&&"triangle-cross"!==e,l=!1,n=b,o=a.pstyle("arrow-scale").value,p=this.getArrowWidth(d,o),q=this.arrowShapes[e];if(k){var r=this.arrowPathCache=this.arrowPathCache||[],s=sb(e),t=r[s];null!=t?(j=b=t,l=!0):(j=b=new Path2D,r[s]=j)}!l&&(b.beginPath&&b.beginPath(),k?q.draw(b,1,0,{x:0,y:0},1):q.draw(b,p,i,{x:g,y:h},d),b.closePath&&b.closePath()),b=n,k&&(b.translate(g,h),b.rotate(i),b.scale(p,p)),("filled"===c||"both"===c)&&(k?b.fill(j):b.fill()),("hollow"===c||"both"===c)&&(b.lineWidth=f/(k?p:1),b.lineJoin="miter",k?b.stroke(j):b.stroke()),k&&(b.scale(1/p,1/p),b.rotate(-i),b.translate(-g,-h))};var Bj={};Bj.safeDrawImage=function(a,b,c,d,e,f,g,h,i,j){if(!(e<=0)&&!(f<=0)&&!(i<=0)&&!(j<=0))try{a.drawImage(b,c,d,e,f,g,h,i,j)}catch(a){so(a)}},Bj.drawInscribedImage=function(a,b,c,d,e){var f=c.position(),g=f.x,h=f.y,i=c.cy().style(),j=i.getIndexedStyle.bind(i),k=j(c,"background-fit","value",d),l=j(c,"background-repeat","value",d),n=c.width(),o=c.height(),p=2*c.padding(),q=n+("inner"===j(c,"background-width-relative-to","value",d)?0:p),r=o+("inner"===j(c,"background-height-relative-to","value",d)?0:p),s=c._private.rscratch,t="node"===j(c,"background-clip","value",d),u=j(c,"background-image-opacity","value",d)*e,v=j(c,"background-image-smoothing","value",d),w=c.pstyle("corner-radius").value;"auto"!==w&&(w=c.pstyle("corner-radius").pfValue);var x=b.width||b.cachedW,y=b.height||b.cachedH;(null==x||null==y)&&(document.body.appendChild(b),x=b.cachedW=b.width||b.offsetWidth,y=b.cachedH=b.height||b.offsetHeight,document.body.removeChild(b));var z=x,A=y;if("auto"!==j(c,"background-width","value",d)&&(z="%"===j(c,"background-width","units",d)?j(c,"background-width","pfValue",d)*q:j(c,"background-width","pfValue",d)),"auto"!==j(c,"background-height","value",d)&&(A="%"===j(c,"background-height","units",d)?j(c,"background-height","pfValue",d)*r:j(c,"background-height","pfValue",d)),0!==z&&0!==A){if("contain"===k){var B=Math.min(q/z,r/A);z*=B,A*=B}else if("cover"===k){var B=Math.max(q/z,r/A);z*=B,A*=B}var C=g-q/2,D=j(c,"background-position-x","units",d),E=j(c,"background-position-x","pfValue",d);"%"===D?C+=(q-z)*E:C+=E;var F=j(c,"background-offset-x","units",d),G=j(c,"background-offset-x","pfValue",d);"%"===F?C+=(q-z)*G:C+=G;var H=h-r/2,I=j(c,"background-position-y","units",d),J=j(c,"background-position-y","pfValue",d);"%"===I?H+=(r-A)*J:H+=J;var K=j(c,"background-offset-y","units",d),L=j(c,"background-offset-y","pfValue",d);"%"===K?H+=(r-A)*L:H+=L,s.pathCache&&(C-=g,H-=h,g=0,h=0);var M=a.globalAlpha;a.globalAlpha=u;var N=this.getImgSmoothing(a),O=!1;if("no"===v&&N?(this.setImgSmoothing(a,!1),O=!0):"yes"!==v||N||(this.setImgSmoothing(a,!0),O=!0),"no-repeat"===l)t&&(a.save(),s.pathCache?a.clip(s.pathCache):(this.nodeShapes[this.getNodeShape(c)].draw(a,g,h,q,r,w,s),a.clip())),this.safeDrawImage(a,b,0,0,x,y,C,H,z,A),t&&a.restore();else{var P=a.createPattern(b,l);a.fillStyle=P,this.nodeShapes[this.getNodeShape(c)].draw(a,g,h,q,r,w,s),a.translate(C,H),a.fill(),a.translate(-C,-H)}a.globalAlpha=M,O&&this.setImgSmoothing(a,N)}};var Bk={};function Bl(a,b,c,d,e){var f=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,g=Math.min(f,d/2,e/2);a.beginPath(),a.moveTo(b+g,c),a.lineTo(b+d-g,c),a.quadraticCurveTo(b+d,c,b+d,c+g),a.lineTo(b+d,c+e-g),a.quadraticCurveTo(b+d,c+e,b+d-g,c+e),a.lineTo(b+g,c+e),a.quadraticCurveTo(b,c+e,b,c+e-g),a.lineTo(b,c+g),a.quadraticCurveTo(b,c,b+g,c),a.closePath()}Bk.eleTextBiggerThanMin=function(a,b){return b||(b=Math.pow(2,Math.ceil(sY(a.cy().zoom()*this.getPixelRatio())))),!(a.pstyle("font-size").pfValue*b<a.pstyle("min-zoomed-font-size").pfValue)},Bk.drawElementText=function(a,b,c,d,e){var f,g=!(arguments.length>5)||void 0===arguments[5]||arguments[5];if(null==d){if(g&&!this.eleTextBiggerThanMin(b))return}else if(!1===d)return;if(b.isNode()){var h=b.pstyle("label");if(!h||!h.value)return;a.textAlign=this.getLabelJustification(b),a.textBaseline="bottom"}else{var i=b.element()._private.rscratch.badLine,j=b.pstyle("label"),k=b.pstyle("source-label"),l=b.pstyle("target-label");if(i||(!j||!j.value)&&(!k||!k.value)&&(!l||!l.value))return;a.textAlign="center",a.textBaseline="bottom"}var n=!c;c&&(f=c,a.translate(-f.x1,-f.y1)),null==e?(this.drawText(a,b,null,n,g),b.isEdge()&&(this.drawText(a,b,"source",n,g),this.drawText(a,b,"target",n,g))):this.drawText(a,b,e,n,g),c&&a.translate(f.x1,f.y1)},Bk.getFontCache=function(a){var b;this.fontCaches=this.fontCaches||[];for(var c=0;c<this.fontCaches.length;c++)if((b=this.fontCaches[c]).context===a)return b;return b={context:a},this.fontCaches.push(b),b},Bk.setupTextStyle=function(a,b){var c=!(arguments.length>2)||void 0===arguments[2]||arguments[2],d=b.pstyle("font-style").strValue,e=b.pstyle("font-size").pfValue+"px",f=b.pstyle("font-family").strValue,g=b.pstyle("font-weight").strValue,h=c?b.effectiveOpacity()*b.pstyle("text-opacity").value:1,i=b.pstyle("text-outline-opacity").value*h,j=b.pstyle("color").value,k=b.pstyle("text-outline-color").value;a.font=d+" "+g+" "+e+" "+f,a.lineJoin="round",this.colorFillStyle(a,j[0],j[1],j[2],h),this.colorStrokeStyle(a,k[0],k[1],k[2],i)},Bk.getTextAngle=function(a,b){var c,d=a._private.rscratch,e=b?b+"-":"",f=a.pstyle(e+"text-rotation");if("autorotate"===f.strValue){var g=sx(d,"labelAngle",b);c=a.isEdge()?g:0}else c="none"===f.strValue?0:f.pfValue;return c},Bk.drawText=function(a,b,c){var d=!(arguments.length>3)||void 0===arguments[3]||arguments[3],e=!(arguments.length>4)||void 0===arguments[4]||arguments[4],f=b._private.rscratch,g=e?b.effectiveOpacity():1;if(!e||0!==g&&0!==b.pstyle("text-opacity").value){"main"===c&&(c=null);var h=sx(f,"labelX",c),i=sx(f,"labelY",c),j=this.getLabelText(b,c);if(null!=j&&""!==j&&!isNaN(h)&&!isNaN(i)){this.setupTextStyle(a,b,e);var k,l,n,o=c?c+"-":"",p=sx(f,"labelWidth",c),q=sx(f,"labelHeight",c),r=b.pstyle(o+"text-margin-x").pfValue,s=b.pstyle(o+"text-margin-y").pfValue,t=b.isEdge(),u=b.pstyle("text-halign").value,v=b.pstyle("text-valign").value;switch(t&&(u="center",v="center"),h+=r,i+=s,0!==(n=d?this.getTextAngle(b,c):0)&&(k=h,l=i,a.translate(k,l),a.rotate(n),h=0,i=0),v){case"top":break;case"center":i+=q/2;break;case"bottom":i+=q}var w=b.pstyle("text-background-opacity").value,x=b.pstyle("text-border-opacity").value,y=b.pstyle("text-border-width").pfValue,z=b.pstyle("text-background-padding").pfValue,A=b.pstyle("text-background-shape").strValue,B="round-rectangle"===A||"roundrectangle"===A;if(w>0||y>0&&x>0){var C,D,E=a.fillStyle,F=a.strokeStyle,G=a.lineWidth,H=b.pstyle("text-background-color").value,I=b.pstyle("text-border-color").value,J=b.pstyle("text-border-style").value,K=w>0,L=y>0&&x>0,M=h-z;switch(u){case"left":M-=p;break;case"center":M-=p/2}var N=i-q-z,O=p+2*z,P=q+2*z;if(K&&(a.fillStyle="rgba(".concat(H[0],",").concat(H[1],",").concat(H[2],",").concat(w*g,")")),L&&(a.strokeStyle="rgba(".concat(I[0],",").concat(I[1],",").concat(I[2],",").concat(x*g,")"),a.lineWidth=y,a.setLineDash))switch(J){case"dotted":a.setLineDash([1,1]);break;case"dashed":a.setLineDash([4,2]);break;case"double":a.lineWidth=y/4,a.setLineDash([]);break;default:a.setLineDash([])}if(B?(a.beginPath(),Bl(a,M,N,O,P,2)):"circle"===A?(a.beginPath(),C=M,D=Math.min(O,P),a.beginPath(),a.arc(C+O/2,N+P/2,D/2,0,2*Math.PI),a.closePath()):(a.beginPath(),a.rect(M,N,O,P)),K&&a.fill(),L&&a.stroke(),L&&"double"===J){var Q=y/2;a.beginPath(),B?Bl(a,M+Q,N+Q,O-2*Q,P-2*Q,2):a.rect(M+Q,N+Q,O-2*Q,P-2*Q),a.stroke()}a.fillStyle=E,a.strokeStyle=F,a.lineWidth=G,a.setLineDash&&a.setLineDash([])}var R=2*b.pstyle("text-outline-width").pfValue;if(R>0&&(a.lineWidth=R),"wrap"===b.pstyle("text-wrap").value){var S=sx(f,"labelWrapCachedLines",c),T=sx(f,"labelLineHeight",c),U=p/2,V=this.getLabelJustification(b);switch("auto"===V||("left"===u?"left"===V?h+=-p:"center"===V&&(h+=-U):"center"===u?"left"===V?h+=-U:"right"===V&&(h+=U):"right"===u&&("center"===V?h+=U:"right"===V&&(h+=p))),v){case"top":case"center":case"bottom":i-=(S.length-1)*T}for(var W=0;W<S.length;W++)R>0&&a.strokeText(S[W],h,i),a.fillText(S[W],h,i),i+=T}else R>0&&a.strokeText(j,h,i),a.fillText(j,h,i);0!==n&&(a.rotate(-n),a.translate(-k,-l))}}};var Bm={};Bm.drawNode=function(a,b,c){var d,e,f,g,h=!(arguments.length>3)||void 0===arguments[3]||arguments[3],i=!(arguments.length>4)||void 0===arguments[4]||arguments[4],j=!(arguments.length>5)||void 0===arguments[5]||arguments[5],k=this,l=b._private,n=l.rscratch,o=b.position();if(rt(o.x)&&rt(o.y)&&(!j||b.visible())){var p=j?b.effectiveOpacity():1,q=k.usePaths(),r=!1,s=b.padding();d=b.width()+2*s,e=b.height()+2*s,c&&(g=c,a.translate(-g.x1,-g.y1));for(var t=b.pstyle("background-image").value,u=Array(t.length),v=Array(t.length),w=0,x=0;x<t.length;x++){var y=t[x];if(u[x]=null!=y&&"none"!==y){var z=b.cy().style().getIndexedStyle(b,"background-image-crossorigin","value",x);w++,v[x]=k.getCachedImage(y,z,function(){l.backgroundTimestamp=Date.now(),b.emitAndNotify("background")})}}var A=b.pstyle("background-blacken").value,B=b.pstyle("border-width").pfValue,C=b.pstyle("background-opacity").value*p,D=b.pstyle("border-color").value,E=b.pstyle("border-style").value,F=b.pstyle("border-join").value,G=b.pstyle("border-cap").value,H=b.pstyle("border-position").value,I=b.pstyle("border-dash-pattern").pfValue,J=b.pstyle("border-dash-offset").pfValue,K=b.pstyle("border-opacity").value*p,L=b.pstyle("outline-width").pfValue,M=b.pstyle("outline-color").value,N=b.pstyle("outline-style").value,O=b.pstyle("outline-opacity").value*p,P=b.pstyle("outline-offset").value,Q=b.pstyle("corner-radius").value;"auto"!==Q&&(Q=b.pstyle("corner-radius").pfValue);var R=function(){var c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:C;k.eleFillStyle(a,b,c)},S=function(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:K;k.colorStrokeStyle(a,D[0],D[1],D[2],b)},T=function(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:O;k.colorStrokeStyle(a,M[0],M[1],M[2],b)},U=function(a,b,c,d){var e,f=k.nodePathCache=k.nodePathCache||[],g=sc("polygon"===c?c+","+d.join(","):c,""+b,""+a,""+Q),h=f[g],i=!1;return null!=h?(i=!0,n.pathCache=e=h):(e=new Path2D,f[g]=n.pathCache=e),{path:e,cacheHit:i}},V=b.pstyle("shape").strValue,W=b.pstyle("shape-polygon-points").pfValue;if(q){a.translate(o.x,o.y);var X=U(d,e,V,W);f=X.path,r=X.cacheHit}var Y=function(){if(!r){var c=o;q&&(c={x:0,y:0}),k.nodeShapes[k.getNodeShape(b)].draw(f||a,c.x,c.y,d,e,Q,n)}q?a.fill(f):a.fill()},Z=function(){for(var c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:p,d=!(arguments.length>1)||void 0===arguments[1]||arguments[1],e=l.backgrounding,f=0,g=0;g<v.length;g++){var h=b.cy().style().getIndexedStyle(b,"background-image-containment","value",g);if(d&&"over"===h||!d&&"inside"===h){f++;continue}u[g]&&v[g].complete&&!v[g].error&&(f++,k.drawInscribedImage(a,v[g],b,g,c))}l.backgrounding=f!==w,e!==l.backgrounding&&b.updateStyle(!1)},$=function(){var c=arguments.length>0&&void 0!==arguments[0]&&arguments[0],f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:p;k.hasPie(b)&&(k.drawPie(a,b,f),c&&!q&&k.nodeShapes[k.getNodeShape(b)].draw(a,o.x,o.y,d,e,Q,n))},_=function(){var c=arguments.length>0&&void 0!==arguments[0]&&arguments[0],f=arguments.length>1&&void 0!==arguments[1]?arguments[1]:p;k.hasStripe(b)&&(a.save(),q?a.clip(n.pathCache):(k.nodeShapes[k.getNodeShape(b)].draw(a,o.x,o.y,d,e,Q,n),a.clip()),k.drawStripe(a,b,f),a.restore(),c&&!q&&k.nodeShapes[k.getNodeShape(b)].draw(a,o.x,o.y,d,e,Q,n))},aa=function(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:p,c=A>0?0:255;0!==A&&(k.colorFillStyle(a,c,c,c,(A>0?A:-A)*b),q?a.fill(f):a.fill())},ab=function(){if(B>0){if(a.lineWidth=B,a.lineCap=G,a.lineJoin=F,a.setLineDash)switch(E){case"dotted":a.setLineDash([1,1]);break;case"dashed":a.setLineDash(I),a.lineDashOffset=J;break;case"solid":case"double":a.setLineDash([])}if("center"!==H){if(a.save(),a.lineWidth*=2,"inside"===H)q?a.clip(f):a.clip();else{var b=new Path2D;b.rect(-d/2-B,-e/2-B,d+2*B,e+2*B),b.addPath(f),a.clip(b,"evenodd")}q?a.stroke(f):a.stroke(),a.restore()}else q?a.stroke(f):a.stroke();if("double"===E){a.lineWidth=B/3;var c=a.globalCompositeOperation;a.globalCompositeOperation="destination-out",q?a.stroke(f):a.stroke(),a.globalCompositeOperation=c}a.setLineDash&&a.setLineDash([])}},ac=function(){if(L>0){if(a.lineWidth=L,a.lineCap="butt",a.setLineDash)switch(N){case"dotted":a.setLineDash([1,1]);break;case"dashed":a.setLineDash([4,2]);break;case"solid":case"double":a.setLineDash([])}var c=o;q&&(c={x:0,y:0});var f=k.getNodeShape(b),g=B;"inside"===H&&(g=0),"outside"===H&&(g*=2);var h=(d+g+(L+P))/d,i=(e+g+(L+P))/e,j=d*h,l=e*i,n=k.nodeShapes[f].points;if(q&&(z=U(j,l,f,n).path),"ellipse"===f)k.drawEllipsePath(z||a,c.x,c.y,j,l);else if(["round-diamond","round-heptagon","round-hexagon","round-octagon","round-pentagon","round-polygon","round-triangle","round-tag"].includes(f)){var p=0,r=0,s=0;"round-diamond"===f?p=(g+P+L)*1.4:"round-heptagon"===f?(p=(g+P+L)*1.075,s=-(g/2+P+L)/35):"round-hexagon"===f?p=(g+P+L)*1.12:"round-pentagon"===f?(p=(g+P+L)*1.13,s=-(g/2+P+L)/15):"round-tag"===f?(p=(g+P+L)*1.12,r=(g/2+L+P)*.07):"round-triangle"===f&&(p=Math.PI/2*(g+P+L),s=-(g+P/2+L)/Math.PI),0!==p&&(h=(d+p)/d,j=d*h,["round-hexagon","round-tag"].includes(f)||(i=(e+p)/e,l=e*i)),Q="auto"===Q?tG(j,l):Q;for(var t=j/2,u=l/2,v=Q+(g+L+P)/2,w=Array(n.length/2),x=Array(n.length/2),y=0;y<n.length/2;y++)w[y]={x:c.x+r+t*n[2*y],y:c.y+s+u*n[2*y+1]};var z,A,C,D,E,F=w.length;for(A=0,C=w[F-1];A<F;A++)D=w[A%F],E=w[(A+1)%F],x[A]=AA(C,D,E,v),C=D,D=E;k.drawRoundPolygonPath(z||a,c.x+r,c.y+s,d*h,e*i,n,x)}else["roundrectangle","round-rectangle"].includes(f)?(Q="auto"===Q?tF(j,l):Q,k.drawRoundRectanglePath(z||a,c.x,c.y,j,l,Q+(g+L+P)/2)):["cutrectangle","cut-rectangle"].includes(f)?(Q="auto"===Q?tH():Q,k.drawCutRectanglePath(z||a,c.x,c.y,j,l,null,Q+(g+L+P)/4)):["bottomroundrectangle","bottom-round-rectangle"].includes(f)?(Q="auto"===Q?tF(j,l):Q,k.drawBottomRoundRectanglePath(z||a,c.x,c.y,j,l,Q+(g+L+P)/2)):"barrel"===f?k.drawBarrelPath(z||a,c.x,c.y,j,l):(n=f.startsWith("polygon")||["rhomboid","right-rhomboid","round-tag","tag","vee"].includes(f)?tr(ts(n,(g+L+P)/d)):tr(ts(n,-((g+L+P)/d))),k.drawPolygonPath(z||a,c.x,c.y,d,e,n));if(q?a.stroke(z):a.stroke(),"double"===N){a.lineWidth=g/3;var G=a.globalCompositeOperation;a.globalCompositeOperation="destination-out",q?a.stroke(z):a.stroke(),a.globalCompositeOperation=G}a.setLineDash&&a.setLineDash([])}};if("yes"===b.pstyle("ghost").value){var ad=b.pstyle("ghost-offset-x").pfValue,ae=b.pstyle("ghost-offset-y").pfValue,af=b.pstyle("ghost-opacity").value,ag=af*p;a.translate(ad,ae),T(),ac(),R(af*C),Y(),Z(ag,!0),S(af*K),ab(),$(0!==A||0!==B),_(0!==A||0!==B),Z(ag,!1),aa(ag),a.translate(-ad,-ae)}q&&a.translate(-o.x,-o.y),i&&k.drawNodeUnderlay(a,b,o,d,e),q&&a.translate(o.x,o.y),T(),ac(),R(),Y(),Z(p,!0),S(),ab(),$(0!==A||0!==B),_(0!==A||0!==B),Z(p,!1),aa(),q&&a.translate(-o.x,-o.y),k.drawElementText(a,b,null,h),i&&k.drawNodeOverlay(a,b,o,d,e),c&&a.translate(g.x1,g.y1)}};var Bn=function(a){if(!["overlay","underlay"].includes(a))throw Error("Invalid state");return function(b,c,d,e,f){if(c.visible()){var g=c.pstyle("".concat(a,"-padding")).pfValue,h=c.pstyle("".concat(a,"-opacity")).value,i=c.pstyle("".concat(a,"-color")).value,j=c.pstyle("".concat(a,"-shape")).value,k=c.pstyle("".concat(a,"-corner-radius")).value;if(h>0){if(d=d||c.position(),null==e||null==f){var l=c.padding();e=c.width()+2*l,f=c.height()+2*l}this.colorFillStyle(b,i[0],i[1],i[2],h),this.nodeShapes[j].draw(b,d.x,d.y,e+2*g,f+2*g,k),b.fill()}}}};Bm.drawNodeOverlay=Bn("overlay"),Bm.drawNodeUnderlay=Bn("underlay"),Bm.hasPie=function(a){return(a=a[0])._private.hasPie},Bm.hasStripe=function(a){return(a=a[0])._private.hasStripe},Bm.drawPie=function(a,b,c,d){b=b[0],d=d||b.position();var e,f=b.cy().style(),g=b.pstyle("pie-size"),h=b.pstyle("pie-hole"),i=b.pstyle("pie-start-angle").pfValue,j=d.x,k=d.y,l=Math.min(b.width(),b.height())/2,n=0;if(this.usePaths()&&(j=0,k=0),"%"===g.units?l*=g.pfValue:void 0!==g.pfValue&&(l=g.pfValue/2),"%"===h.units?e=l*h.pfValue:void 0!==h.pfValue&&(e=h.pfValue/2),!(e>=l))for(var o=1;o<=f.pieBackgroundN;o++){var p=b.pstyle("pie-"+o+"-background-size").value,q=b.pstyle("pie-"+o+"-background-color").value,r=b.pstyle("pie-"+o+"-background-opacity").value*c,s=p/100;s+n>1&&(s=1-n);var t=1.5*Math.PI+2*Math.PI*n,u=2*Math.PI*s,v=(t+=i)+u;0===p||n>=1||n+s>1||(0===e?(a.beginPath(),a.moveTo(j,k),a.arc(j,k,l,t,v)):(a.beginPath(),a.arc(j,k,l,t,v),a.arc(j,k,e,v,t,!0)),a.closePath(),this.colorFillStyle(a,q[0],q[1],q[2],r),a.fill(),n+=s)}},Bm.drawStripe=function(a,b,c,d){b=b[0],d=d||b.position();var e=b.cy().style(),f=d.x,g=d.y,h=b.width(),i=b.height(),j=0,k=this.usePaths();a.save();var l=b.pstyle("stripe-direction").value,n=b.pstyle("stripe-size");switch(l){case"vertical":break;case"righward":a.rotate(-Math.PI/2)}var o=h,p=i;"%"===n.units?(o*=n.pfValue,p*=n.pfValue):void 0!==n.pfValue&&(o=n.pfValue,p=n.pfValue),k&&(f=0,g=0),g-=o/2,f-=p/2;for(var q=1;q<=e.stripeBackgroundN;q++){var r=b.pstyle("stripe-"+q+"-background-size").value,s=b.pstyle("stripe-"+q+"-background-color").value,t=b.pstyle("stripe-"+q+"-background-opacity").value*c,u=r/100;u+j>1&&(u=1-j),0===r||j>=1||j+u>1||(a.beginPath(),a.rect(f,g+p*j,o,p*u),a.closePath(),this.colorFillStyle(a,s[0],s[1],s[2],t),a.fill(),j+=u)}a.restore()};var Bo={};function Bp(a,b,c){var d=a.createShader(b);if(a.shaderSource(d,c),a.compileShader(d),!a.getShaderParameter(d,a.COMPILE_STATUS))throw Error(a.getShaderInfoLog(d));return d}function Bq(a,b,c){void 0===c&&(c=b);var d=a.makeOffscreenCanvas(b,c),e=d.context=d.getContext("2d");return d.clear=function(){return e.clearRect(0,0,d.width,d.height)},d.clear(),d}function Br(a){var b=a.pixelRatio,c=a.cy.zoom(),d=a.cy.pan();return{zoom:c*b,pan:{x:d.x*b,y:d.y*b}}}function Bs(a){return"solid"===a.pstyle("background-fill").value&&"none"===a.pstyle("background-image").strValue&&(0===a.pstyle("border-width").value||0===a.pstyle("border-opacity").value||"solid"===a.pstyle("border-style").value)}function Bt(a,b,c){var d=a[0]/255,e=a[1]/255,f=a[2]/255,g=c||[,,,,];return g[0]=d*b,g[1]=e*b,g[2]=f*b,g[3]=b,g}function Bu(a,b){var c=b||[,,,,];return c[0]=(255&a)/255,c[1]=(a>>8&255)/255,c[2]=(a>>16&255)/255,c[3]=(a>>24&255)/255,c}function Bv(a,b){switch(b){case"float":return[1,a.FLOAT,4];case"vec2":return[2,a.FLOAT,4];case"vec3":return[3,a.FLOAT,4];case"vec4":return[4,a.FLOAT,4];case"int":return[1,a.INT,4];case"ivec2":return[2,a.INT,4]}}function Bw(a,b,c){switch(b){case a.FLOAT:return new Float32Array(c);case a.INT:return new Int32Array(c)}}function Bx(a,b,c,d){var e=rf(Bv(a,c),3),f=e[0],g=e[1],h=e[2],i=Bw(a,g,b*f),j=f*h,k=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,k),a.bufferData(a.ARRAY_BUFFER,b*j,a.DYNAMIC_DRAW),a.enableVertexAttribArray(d),g===a.FLOAT?a.vertexAttribPointer(d,f,g,!1,j,0):g===a.INT&&a.vertexAttribIPointer(d,f,g,j,0),a.vertexAttribDivisor(d,1),a.bindBuffer(a.ARRAY_BUFFER,null);for(var l=Array(b),n=0;n<b;n++)l[n]=function(a,b,c,d,e,f){switch(b){case a.FLOAT:return new Float32Array(c.buffer,f*d,e);case a.INT:return new Int32Array(c.buffer,f*d,e)}}(a,g,i,j,f,n);return k.dataArray=i,k.stride=j,k.size=f,k.getView=function(a){return l[a]},k.setPoint=function(a,b,c){var d=l[a];d[0]=b,d[1]=c},k.bufferSubData=function(b){a.bindBuffer(a.ARRAY_BUFFER,k),b?a.bufferSubData(a.ARRAY_BUFFER,0,i,0,b*f):a.bufferSubData(a.ARRAY_BUFFER,0,i)},k}Bo.getPixelRatio=function(){var a=this.data.contexts[0];if(null!=this.forcedPixelRatio)return this.forcedPixelRatio;var b=this.cy.window(),c=a.backingStorePixelRatio||a.webkitBackingStorePixelRatio||a.mozBackingStorePixelRatio||a.msBackingStorePixelRatio||a.oBackingStorePixelRatio||a.backingStorePixelRatio||1;return(b.devicePixelRatio||1)/c},Bo.paintCache=function(a){for(var b,c=this.paintCaches=this.paintCaches||[],d=!0,e=0;e<c.length;e++)if((b=c[e]).context===a){d=!1;break}return d&&(b={context:a},c.push(b)),b},Bo.createGradientStyleFor=function(a,b,c,d,e){var f,g=this.usePaths(),h=c.pstyle(b+"-gradient-stop-colors").value,i=c.pstyle(b+"-gradient-stop-positions").pfValue;if("radial-gradient"===d)if(c.isEdge()){var j=c.sourceEndpoint(),k=c.targetEndpoint(),l=c.midpoint(),n=s$(j,l),o=s$(k,l);f=a.createRadialGradient(l.x,l.y,0,l.x,l.y,Math.max(n,o))}else{var p=g?{x:0,y:0}:c.position(),q=c.paddedWidth(),r=c.paddedHeight();f=a.createRadialGradient(p.x,p.y,0,p.x,p.y,Math.max(q,r))}else if(c.isEdge()){var s=c.sourceEndpoint(),t=c.targetEndpoint();f=a.createLinearGradient(s.x,s.y,t.x,t.y)}else{var u=g?{x:0,y:0}:c.position(),v=c.paddedWidth(),w=c.paddedHeight(),x=v/2,y=w/2;switch(c.pstyle("background-gradient-direction").value){case"to-bottom":f=a.createLinearGradient(u.x,u.y-y,u.x,u.y+y);break;case"to-top":f=a.createLinearGradient(u.x,u.y+y,u.x,u.y-y);break;case"to-left":f=a.createLinearGradient(u.x+x,u.y,u.x-x,u.y);break;case"to-right":f=a.createLinearGradient(u.x-x,u.y,u.x+x,u.y);break;case"to-bottom-right":case"to-right-bottom":f=a.createLinearGradient(u.x-x,u.y-y,u.x+x,u.y+y);break;case"to-top-right":case"to-right-top":f=a.createLinearGradient(u.x-x,u.y+y,u.x+x,u.y-y);break;case"to-bottom-left":case"to-left-bottom":f=a.createLinearGradient(u.x+x,u.y-y,u.x-x,u.y+y);break;case"to-top-left":case"to-left-top":f=a.createLinearGradient(u.x+x,u.y+y,u.x-x,u.y-y)}}if(!f)return null;for(var z=i.length===h.length,A=h.length,B=0;B<A;B++)f.addColorStop(z?i[B]:B/(A-1),"rgba("+h[B][0]+","+h[B][1]+","+h[B][2]+","+e+")");return f},Bo.gradientFillStyle=function(a,b,c,d){var e=this.createGradientStyleFor(a,"background",b,c,d);if(!e)return null;a.fillStyle=e},Bo.colorFillStyle=function(a,b,c,d,e){a.fillStyle="rgba("+b+","+c+","+d+","+e+")"},Bo.eleFillStyle=function(a,b,c){var d=b.pstyle("background-fill").value;if("linear-gradient"===d||"radial-gradient"===d)this.gradientFillStyle(a,b,d,c);else{var e=b.pstyle("background-color").value;this.colorFillStyle(a,e[0],e[1],e[2],c)}},Bo.gradientStrokeStyle=function(a,b,c,d){var e=this.createGradientStyleFor(a,"line",b,c,d);if(!e)return null;a.strokeStyle=e},Bo.colorStrokeStyle=function(a,b,c,d,e){a.strokeStyle="rgba("+b+","+c+","+d+","+e+")"},Bo.eleStrokeStyle=function(a,b,c){var d=b.pstyle("line-fill").value;if("linear-gradient"===d||"radial-gradient"===d)this.gradientStrokeStyle(a,b,d,c);else{var e=b.pstyle("line-color").value;this.colorStrokeStyle(a,e[0],e[1],e[2],c)}},Bo.matchCanvasSize=function(a){var b,c=this.data,d=this.findContainerClientCoords(),e=d[2],f=d[3],g=this.getPixelRatio(),h=this.motionBlurPxRatio;(a===this.data.bufferCanvases[this.MOTIONBLUR_BUFFER_NODE]||a===this.data.bufferCanvases[this.MOTIONBLUR_BUFFER_DRAG])&&(g=h);var i=e*g,j=f*g;if(i!==this.canvasWidth||j!==this.canvasHeight){this.fontCaches=null;var k=c.canvasContainer;k.style.width=e+"px",k.style.height=f+"px";for(var l=0;l<this.CANVAS_LAYERS;l++)(b=c.canvases[l]).width=i,b.height=j,b.style.width=e+"px",b.style.height=f+"px";for(var l=0;l<this.BUFFER_COUNT;l++)(b=c.bufferCanvases[l]).width=i,b.height=j,b.style.width=e+"px",b.style.height=f+"px";this.textureMult=1,g<=1&&(b=c.bufferCanvases[this.TEXTURE_BUFFER],this.textureMult=2,b.width=i*this.textureMult,b.height=j*this.textureMult),this.canvasWidth=i,this.canvasHeight=j,this.pixelRatio=g}},Bo.renderTo=function(a,b,c,d){this.render({forcedContext:a,forcedZoom:b,forcedPan:c,drawAllLayers:!0,forcedPxRatio:d})},Bo.clearCanvas=function(){var a=this,b=a.data;function c(b){b.clearRect(0,0,a.canvasWidth,a.canvasHeight)}c(b.contexts[a.NODE]),c(b.contexts[a.DRAG])},Bo.render=function(a){var b=this;a=a||ss();var c=b.cy,d=a.forcedContext,e=a.drawAllLayers,f=a.drawOnlyNodeLayer,g=a.forcedZoom,h=a.forcedPan,i=void 0===a.forcedPxRatio?this.getPixelRatio():a.forcedPxRatio,j=b.data,k=j.canvasNeedsRedraw,l=b.textureOnViewport&&!d&&(b.pinching||b.hoverData.dragging||b.swipePanning||b.data.wheelZooming),n=void 0!==a.motionBlur?a.motionBlur:b.motionBlur,o=b.motionBlurPxRatio,p=c.hasCompoundNodes(),q=b.hoverData.draggingEles,r=!!b.hoverData.selecting||!!b.touchData.selecting,s=n=n&&!d&&b.motionBlurEnabled&&!r;d||(b.prevPxRatio!==i&&(b.invalidateContainerClientCoordsCache(),b.matchCanvasSize(b.container),b.redrawHint("eles",!0),b.redrawHint("drag",!0)),b.prevPxRatio=i),!d&&b.motionBlurTimeout&&clearTimeout(b.motionBlurTimeout),n&&(null==b.mbFrames&&(b.mbFrames=0),b.mbFrames++,b.mbFrames<3&&(s=!1),b.mbFrames>b.minMbLowQualFrames&&(b.motionBlurPxRatio=b.mbPxRBlurry)),b.clearingMotionBlur&&(b.motionBlurPxRatio=1),b.textureDrawLastFrame&&!l&&(k[b.NODE]=!0,k[b.SELECT_BOX]=!0);var t=c.style(),u=c.zoom(),v=void 0!==g?g:u,w=c.pan(),x={x:w.x,y:w.y},y={zoom:u,pan:{x:w.x,y:w.y}},z=b.prevViewport;void 0===z||y.zoom!==z.zoom||y.pan.x!==z.pan.x||y.pan.y!==z.pan.y||q&&!p||(b.motionBlurPxRatio=1),h&&(x=h),v*=i,x.x*=i,x.y*=i;var A=b.getCachedZSortedEles();function B(a,c,d,e,f){var g=a.globalCompositeOperation;a.globalCompositeOperation="destination-out",b.colorFillStyle(a,255,255,255,b.motionBlurTransparency),a.fillRect(c,d,e,f),a.globalCompositeOperation=g}function C(a,c){var f,i,k,l;b.clearingMotionBlur||a!==j.bufferContexts[b.MOTIONBLUR_BUFFER_NODE]&&a!==j.bufferContexts[b.MOTIONBLUR_BUFFER_DRAG]?(f=x,i=v,k=b.canvasWidth,l=b.canvasHeight):(f={x:w.x*o,y:w.y*o},i=u*o,k=b.canvasWidth*o,l=b.canvasHeight*o),a.setTransform(1,0,0,1,0,0),"motionBlur"===c?B(a,0,0,k,l):!d&&(void 0===c||c)&&a.clearRect(0,0,k,l),e||(a.translate(f.x,f.y),a.scale(i,i)),h&&a.translate(h.x,h.y),g&&a.scale(g,g)}if(l||(b.textureDrawLastFrame=!1),l){if(b.textureDrawLastFrame=!0,!b.textureCache){b.textureCache={},b.textureCache.bb=c.mutableElements().boundingBox(),b.textureCache.texture=b.data.bufferCanvases[b.TEXTURE_BUFFER];var D=b.data.bufferContexts[b.TEXTURE_BUFFER];D.setTransform(1,0,0,1,0,0),D.clearRect(0,0,b.canvasWidth*b.textureMult,b.canvasHeight*b.textureMult),b.render({forcedContext:D,drawOnlyNodeLayer:!0,forcedPxRatio:i*b.textureMult});var y=b.textureCache.viewport={zoom:c.zoom(),pan:c.pan(),width:b.canvasWidth,height:b.canvasHeight};y.mpan={x:(0-y.pan.x)/y.zoom,y:(0-y.pan.y)/y.zoom}}k[b.DRAG]=!1,k[b.NODE]=!1;var E=j.contexts[b.NODE],F=b.textureCache.texture,y=b.textureCache.viewport;E.setTransform(1,0,0,1,0,0),n?B(E,0,0,y.width,y.height):E.clearRect(0,0,y.width,y.height);var G=t.core("outside-texture-bg-color").value,H=t.core("outside-texture-bg-opacity").value;b.colorFillStyle(E,G[0],G[1],G[2],H),E.fillRect(0,0,y.width,y.height);var u=c.zoom();C(E,!1),E.clearRect(y.mpan.x,y.mpan.y,y.width/y.zoom/i,y.height/y.zoom/i),E.drawImage(F,y.mpan.x,y.mpan.y,y.width/y.zoom/i,y.height/y.zoom/i)}else b.textureOnViewport&&!d&&(b.textureCache=null);var I=c.extent(),J=b.pinching||b.hoverData.dragging||b.swipePanning||b.data.wheelZooming||b.hoverData.draggingEles||b.cy.animated(),K=b.hideEdgesOnViewport&&J,L=[];if(L[b.NODE]=!k[b.NODE]&&n&&!b.clearedForMotionBlur[b.NODE]||b.clearingMotionBlur,L[b.NODE]&&(b.clearedForMotionBlur[b.NODE]=!0),L[b.DRAG]=!k[b.DRAG]&&n&&!b.clearedForMotionBlur[b.DRAG]||b.clearingMotionBlur,L[b.DRAG]&&(b.clearedForMotionBlur[b.DRAG]=!0),k[b.NODE]||e||f||L[b.NODE]){var M=n&&!L[b.NODE]&&1!==o,E=d||(M?b.data.bufferContexts[b.MOTIONBLUR_BUFFER_NODE]:j.contexts[b.NODE]);C(E,n&&!M?"motionBlur":void 0),K?b.drawCachedNodes(E,A.nondrag,i,I):b.drawLayeredElements(E,A.nondrag,i,I),b.debug&&b.drawDebugPoints(E,A.nondrag),e||n||(k[b.NODE]=!1)}if(!f&&(k[b.DRAG]||e||L[b.DRAG])){var M=n&&!L[b.DRAG]&&1!==o,E=d||(M?b.data.bufferContexts[b.MOTIONBLUR_BUFFER_DRAG]:j.contexts[b.DRAG]);C(E,n&&!M?"motionBlur":void 0),K?b.drawCachedNodes(E,A.drag,i,I):b.drawCachedElements(E,A.drag,i,I),b.debug&&b.drawDebugPoints(E,A.drag),e||n||(k[b.DRAG]=!1)}if(this.drawSelectionRectangle(a,C),n&&1!==o){var N=j.contexts[b.NODE],O=b.data.bufferCanvases[b.MOTIONBLUR_BUFFER_NODE],P=j.contexts[b.DRAG],Q=b.data.bufferCanvases[b.MOTIONBLUR_BUFFER_DRAG],R=function(a,c,d){a.setTransform(1,0,0,1,0,0),d||!s?a.clearRect(0,0,b.canvasWidth,b.canvasHeight):B(a,0,0,b.canvasWidth,b.canvasHeight),a.drawImage(c,0,0,b.canvasWidth*o,b.canvasHeight*o,0,0,b.canvasWidth,b.canvasHeight)};(k[b.NODE]||L[b.NODE])&&(R(N,O,L[b.NODE]),k[b.NODE]=!1),(k[b.DRAG]||L[b.DRAG])&&(R(P,Q,L[b.DRAG]),k[b.DRAG]=!1)}b.prevViewport=y,b.clearingMotionBlur&&(b.clearingMotionBlur=!1,b.motionBlurCleared=!0,b.motionBlur=!0),n&&(b.motionBlurTimeout=setTimeout(function(){b.motionBlurTimeout=null,b.clearedForMotionBlur[b.NODE]=!1,b.clearedForMotionBlur[b.DRAG]=!1,b.motionBlur=!1,b.clearingMotionBlur=!l,b.mbFrames=0,k[b.NODE]=!0,k[b.DRAG]=!0,b.redraw()},100)),d||c.emit("render")},Bo.drawSelectionRectangle=function(a,b){var c=this.cy,d=this.data,e=c.style(),f=a.drawOnlyNodeLayer,g=a.drawAllLayers,h=d.canvasNeedsRedraw,i=a.forcedContext;if(this.showFps||!f&&h[this.SELECT_BOX]&&!g){var j=i||d.contexts[this.SELECT_BOX];if(b(j),1==this.selection[4]&&(this.hoverData.selecting||this.touchData.selecting)){var k=this.cy.zoom(),l=e.core("selection-box-border-width").value/k;j.lineWidth=l,j.fillStyle="rgba("+e.core("selection-box-color").value[0]+","+e.core("selection-box-color").value[1]+","+e.core("selection-box-color").value[2]+","+e.core("selection-box-opacity").value+")",j.fillRect(this.selection[0],this.selection[1],this.selection[2]-this.selection[0],this.selection[3]-this.selection[1]),l>0&&(j.strokeStyle="rgba("+e.core("selection-box-border-color").value[0]+","+e.core("selection-box-border-color").value[1]+","+e.core("selection-box-border-color").value[2]+","+e.core("selection-box-opacity").value+")",j.strokeRect(this.selection[0],this.selection[1],this.selection[2]-this.selection[0],this.selection[3]-this.selection[1]))}if(d.bgActivePosistion&&!this.hoverData.selecting){var k=this.cy.zoom(),n=d.bgActivePosistion;j.fillStyle="rgba("+e.core("active-bg-color").value[0]+","+e.core("active-bg-color").value[1]+","+e.core("active-bg-color").value[2]+","+e.core("active-bg-opacity").value+")",j.beginPath(),j.arc(n.x,n.y,e.core("active-bg-size").pfValue/k,0,2*Math.PI),j.fill()}var o=this.lastRedrawTime;if(this.showFps&&o){var p=Math.round(1e3/(o=Math.round(o))),q="1 frame = "+o+" ms = "+p+" fps";j.setTransform(1,0,0,1,0,0),j.fillStyle="rgba(255, 0, 0, 0.75)",j.strokeStyle="rgba(255, 0, 0, 0.75)",j.font="30px Arial",s||(s=j.measureText(q).actualBoundingBoxAscent),j.fillText(q,0,s),j.strokeRect(0,s+10,250,20),j.fillRect(0,s+10,250*Math.min(p/60,1),20)}g||(h[this.SELECT_BOX]=!1)}};var By="undefined"!=typeof Float32Array?Float32Array:Array;function Bz(){var a=new By(9);return By!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function BA(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=1,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a}function BB(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],n=c[0],o=c[1];return a[0]=d,a[1]=e,a[2]=f,a[3]=g,a[4]=h,a[5]=i,a[6]=n*d+o*g+j,a[7]=n*e+o*h+k,a[8]=n*f+o*i+l,a}function BC(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],n=Math.sin(c),o=Math.cos(c);return a[0]=o*d+n*g,a[1]=o*e+n*h,a[2]=o*f+n*i,a[3]=o*g-n*d,a[4]=o*h-n*e,a[5]=o*i-n*f,a[6]=j,a[7]=k,a[8]=l,a}function BD(a,b,c){var d=c[0],e=c[1];return a[0]=d*b[0],a[1]=d*b[1],a[2]=d*b[2],a[3]=e*b[3],a[4]=e*b[4],a[5]=e*b[5],a[6]=b[6],a[7]=b[7],a[8]=b[8],a}Math.hypot||(Math.hypot=function(){for(var a=0,b=arguments.length;b--;)a+=arguments[b]*arguments[b];return Math.sqrt(a)});var BE=rc(function a(b,c,d,e){rb(this,a),this.debugID=Math.floor(1e4*Math.random()),this.r=b,this.texSize=c,this.texRows=d,this.texHeight=Math.floor(c/d),this.enableWrapping=!0,this.locked=!1,this.texture=null,this.needsBuffer=!0,this.freePointer={x:0,row:0},this.keyToLocation=new Map,this.canvas=e(b,c,c),this.scratch=e(b,c,this.texHeight,"scratch")},[{key:"lock",value:function(){this.locked=!0}},{key:"getKeys",value:function(){return new Set(this.keyToLocation.keys())}},{key:"getScale",value:function(a){var b=a.w,c=a.h,d=this.texHeight,e=this.texSize,f=d/c,g=b*f,h=c*f;return g>e&&(f=e/b,g=b*f,h=c*f),{scale:f,texW:g,texH:h}}},{key:"draw",value:function(a,b,c){var d,e,f,g,h,i,j,k=this;if(this.locked)throw Error("can't draw, atlas is locked");var l=this.texSize,n=this.texRows,o=this.texHeight,p=this.getScale(b),q=p.scale,r=p.texW,s=p.texH,t=function(a,d){if(c&&d){var e=d.context,f=a.x,g=o*a.row;e.save(),e.translate(f,g),e.scale(q,q),c(e,b),e.restore()}},u=[null,null],v=function(){t(k.freePointer,k.canvas),u[0]={x:k.freePointer.x,y:k.freePointer.row*o,w:r,h:s},u[1]={x:k.freePointer.x+r,y:k.freePointer.row*o,w:0,h:s},k.freePointer.x+=r,k.freePointer.x==l&&(k.freePointer.x=0,k.freePointer.row++)},w=function(){k.freePointer.x=0,k.freePointer.row++};if(this.freePointer.x+r<=l)v();else{if(this.freePointer.row>=n-1)return!1;this.freePointer.x===l?(w(),v()):this.enableWrapping?(d=k.scratch,e=k.canvas,d.clear(),t({x:0,row:0},d),g=r-(f=l-k.freePointer.x),h=k.freePointer.x,i=k.freePointer.row*o,e.context.drawImage(d,0,0,f,o,h,i,f,o),u[0]={x:h,y:i,w:f,h:s},j=(k.freePointer.row+1)*o,e&&e.context.drawImage(d,f,0,g,o,0,j,g,o),u[1]={x:0,y:j,w:g,h:s},k.freePointer.x=g,k.freePointer.row++):(w(),v())}return this.keyToLocation.set(a,u),this.needsBuffer=!0,u}},{key:"getOffsets",value:function(a){return this.keyToLocation.get(a)}},{key:"isEmpty",value:function(){return 0===this.freePointer.x&&0===this.freePointer.row}},{key:"canFit",value:function(a){if(this.locked)return!1;var b=this.texSize,c=this.texRows,d=this.getScale(a).texW;return!(this.freePointer.x+d>b)||this.freePointer.row<c-1}},{key:"bufferIfNeeded",value:function(a){var b;this.texture||(this.texture=(this.debugID,(b=a.createTexture()).buffer=function(c){a.bindTexture(a.TEXTURE_2D,b),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR_MIPMAP_NEAREST),a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,c),a.generateMipmap(a.TEXTURE_2D),a.bindTexture(a.TEXTURE_2D,null)},b.deleteTexture=function(){a.deleteTexture(b)},b)),this.needsBuffer&&(this.texture.buffer(this.canvas),this.needsBuffer=!1,this.locked&&(this.canvas=null,this.scratch=null))}},{key:"dispose",value:function(){this.texture&&(this.texture.deleteTexture(),this.texture=null),this.canvas=null,this.scratch=null,this.locked=!0}}]),BF=rc(function a(b,c,d,e){rb(this,a),this.r=b,this.texSize=c,this.texRows=d,this.createTextureCanvas=e,this.atlases=[],this.styleKeyToAtlas=new Map,this.markedKeys=new Set},[{key:"getKeys",value:function(){return new Set(this.styleKeyToAtlas.keys())}},{key:"_createAtlas",value:function(){return new BE(this.r,this.texSize,this.texRows,this.createTextureCanvas)}},{key:"_getScratchCanvas",value:function(){if(!this.scratch){var a=this.r,b=this.texSize,c=this.texRows,d=this.createTextureCanvas,e=Math.floor(b/c);this.scratch=d(a,b,e,"scratch")}return this.scratch}},{key:"draw",value:function(a,b,c){var d=this.styleKeyToAtlas.get(a);return d||((d=this.atlases[this.atlases.length-1])&&d.canFit(b)||(d&&d.lock(),d=this._createAtlas(),this.atlases.push(d)),d.draw(a,b,c),this.styleKeyToAtlas.set(a,d)),d}},{key:"getAtlas",value:function(a){return this.styleKeyToAtlas.get(a)}},{key:"hasAtlas",value:function(a){return this.styleKeyToAtlas.has(a)}},{key:"markKeyForGC",value:function(a){this.markedKeys.add(a)}},{key:"gc",value:function(){var a=this,b=this.markedKeys;if(0===b.size)return void console.log("nothing to garbage collect");var c,d=[],e=new Map,f=null,g=rd(this.atlases);try{for(g.s();!(c=g.n()).done;)if(function(){var g=c.value,h=g.getKeys(),i=function(a,b){return a.intersection?a.intersection(b):new Set(rg(a).filter(function(a){return b.has(a)}))}(b,h);if(0===i.size)return d.push(g),h.forEach(function(a){return e.set(a,g)}),1;f||(f=a._createAtlas(),d.push(f));var j,k=rd(h);try{for(k.s();!(j=k.n()).done;){var l=j.value;if(!i.has(l)){var n=g.getOffsets(l),o=rf(n,2),p=o[0],q=o[1];f.canFit({w:p.w+q.w,h:p.h})||(f.lock(),f=a._createAtlas(),d.push(f)),g.canvas&&(a._copyTextureToNewAtlas(l,g,f),e.set(l,f))}}}catch(a){k.e(a)}finally{k.f()}g.dispose()}())continue}catch(a){g.e(a)}finally{g.f()}this.atlases=d,this.styleKeyToAtlas=e,this.markedKeys=new Set}},{key:"_copyTextureToNewAtlas",value:function(a,b,c){var d=rf(b.getOffsets(a),2),e=d[0],f=d[1];if(0===f.w)c.draw(a,e,function(a){a.drawImage(b.canvas,e.x,e.y,e.w,e.h,0,0,e.w,e.h)});else{var g=this._getScratchCanvas();g.clear(),g.context.drawImage(b.canvas,e.x,e.y,e.w,e.h,0,0,e.w,e.h),g.context.drawImage(b.canvas,f.x,f.y,f.w,f.h,e.w,0,f.w,f.h);var h=e.w+f.w,i=e.h;c.draw(a,{w:h,h:i},function(a){a.drawImage(g,0,0,h,i,0,0,h,i)})}}},{key:"getCounts",value:function(){return{keyCount:this.styleKeyToAtlas.size,atlasCount:new Set(this.styleKeyToAtlas.values()).size}}}]),BG=rc(function a(b,c){rb(this,a),this.r=b,this.globalOptions=c,this.atlasSize=c.webglTexSize,this.maxAtlasesPerBatch=c.webglTexPerBatch,this.renderTypes=new Map,this.collections=new Map,this.typeAndIdToKey=new Map},[{key:"getAtlasSize",value:function(){return this.atlasSize}},{key:"addAtlasCollection",value:function(a,b){var c=this.globalOptions,d=c.webglTexSize,e=c.createTextureCanvas,f=b.texRows,g=this._cacheScratchCanvas(e),h=new BF(this.r,d,f,g);this.collections.set(a,h)}},{key:"addRenderType",value:function(a,b){var c=b.collection;if(!this.collections.has(c))throw Error("invalid atlas collection name '".concat(c,"'"));var d=rO({type:a,atlasCollection:this.collections.get(c)},b);this.renderTypes.set(a,d)}},{key:"getRenderTypeOpts",value:function(a){return this.renderTypes.get(a)}},{key:"getAtlasCollection",value:function(a){return this.collections.get(a)}},{key:"_cacheScratchCanvas",value:function(a){var b=-1,c=-1,d=null;return function(e,f,g,h){return h?(d&&f==b&&g==c||(b=f,c=g,d=a(e,f,g)),d):a(e,f,g)}}},{key:"_key",value:function(a,b){return"".concat(a,"-").concat(b)}},{key:"invalidate",value:function(a){var b,c=this,d=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=d.forceRedraw,f=void 0!==e&&e,g=d.filterEle,h=void 0===g?function(){return!0}:g,i=d.filterType,j=void 0===i?function(){return!0}:i,k=!1,l=!1,n=rd(a);try{for(n.s();!(b=n.n()).done;){var o=b.value;if(h(o)){var p,q=rd(this.renderTypes.values());try{for(q.s();!(p=q.n()).done;)!function(){var a=p.value,b=a.type;if(j(b)){var d=c.collections.get(a.collection),e=a.getKey(o),g=Array.isArray(e)?e:[e];if(f)g.forEach(function(a){return d.markKeyForGC(a)}),l=!0;else{var h=a.getID?a.getID(o):o.id(),i=c._key(b,h),n=c.typeAndIdToKey.get(i);void 0!==n&&!function(a,b){if(a.length!==b.length)return!1;for(var c=0;c<a.length;c++)if(a[c]!==b[c])return!1;return!0}(g,n)&&(k=!0,c.typeAndIdToKey.delete(i),n.forEach(function(a){return d.markKeyForGC(a)}))}}}()}catch(a){q.e(a)}finally{q.f()}}}}catch(a){n.e(a)}finally{n.f()}return l&&(this.gc(),k=!1),k}},{key:"gc",value:function(){var a,b=rd(this.collections.values());try{for(b.s();!(a=b.n()).done;)a.value.gc()}catch(a){b.e(a)}finally{b.f()}}},{key:"getOrCreateAtlas",value:function(a,b,c,d){var e=this.renderTypes.get(b),f=this.collections.get(e.collection),g=!1,h=f.draw(d,c,function(b){e.drawClipped?(b.save(),b.beginPath(),b.rect(0,0,c.w,c.h),b.clip(),e.drawElement(b,a,c,!0,!0),b.restore()):e.drawElement(b,a,c,!0,!0),g=!0});if(g){var i=e.getID?e.getID(a):a.id(),j=this._key(b,i);this.typeAndIdToKey.has(j)?this.typeAndIdToKey.get(j).push(d):this.typeAndIdToKey.set(j,[d])}return h}},{key:"getAtlasInfo",value:function(a,b){var c=this,d=this.renderTypes.get(b),e=d.getKey(a);return(Array.isArray(e)?e:[e]).map(function(e){var f=d.getBoundingBox(a,e),g=c.getOrCreateAtlas(a,b,f,e),h=rf(g.getOffsets(e),2),i=h[0];return{atlas:g,tex:i,tex1:i,tex2:h[1],bb:f}})}},{key:"getDebugInfo",value:function(){var a,b=[],c=rd(this.collections);try{for(c.s();!(a=c.n()).done;){var d=rf(a.value,2),e=d[0],f=d[1].getCounts(),g=f.keyCount,h=f.atlasCount;b.push({type:e,keyCount:g,atlasCount:h})}}catch(a){c.e(a)}finally{c.f()}return b}}]),BH=rc(function a(b){rb(this,a),this.globalOptions=b,this.atlasSize=b.webglTexSize,this.maxAtlasesPerBatch=b.webglTexPerBatch,this.batchAtlases=[]},[{key:"getMaxAtlasesPerBatch",value:function(){return this.maxAtlasesPerBatch}},{key:"getAtlasSize",value:function(){return this.atlasSize}},{key:"getIndexArray",value:function(){return Array.from({length:this.maxAtlasesPerBatch},function(a,b){return b})}},{key:"startBatch",value:function(){this.batchAtlases=[]}},{key:"getAtlasCount",value:function(){return this.batchAtlases.length}},{key:"getAtlases",value:function(){return this.batchAtlases}},{key:"canAddToCurrentBatch",value:function(a){return this.batchAtlases.length!==this.maxAtlasesPerBatch||this.batchAtlases.includes(a)}},{key:"getAtlasIndexForBatch",value:function(a){var b=this.batchAtlases.indexOf(a);if(b<0){if(this.batchAtlases.length===this.maxAtlasesPerBatch)throw Error("cannot add more atlases to batch");this.batchAtlases.push(a),b=this.batchAtlases.length-1}return b}}]),BI={name:"screen",screen:!0},BJ={name:"picking",picking:!0},BK=rc(function a(b,c,d){rb(this,a),this.r=b,this.gl=c,this.maxInstances=d.webglBatchSize,this.atlasSize=d.webglTexSize,this.bgColor=d.bgColor,this.debug=d.webglDebug,this.batchDebugInfo=[],d.enableWrapping=!0,d.createTextureCanvas=Bq,this.atlasManager=new BG(b,d),this.batchManager=new BH(d),this.simpleShapeOptions=new Map,this.program=this._createShaderProgram(BI),this.pickingProgram=this._createShaderProgram(BJ),this.vao=this._createVAO()},[{key:"addAtlasCollection",value:function(a,b){this.atlasManager.addAtlasCollection(a,b)}},{key:"addTextureAtlasRenderType",value:function(a,b){this.atlasManager.addRenderType(a,b)}},{key:"addSimpleShapeRenderType",value:function(a,b){this.simpleShapeOptions.set(a,b)}},{key:"invalidate",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=b.type,d=this.atlasManager;return c?d.invalidate(a,{filterType:function(a){return a===c},forceRedraw:!0}):d.invalidate(a)}},{key:"gc",value:function(){this.atlasManager.gc()}},{key:"_createShaderProgram",value:function(a){var b=this.gl,c="#version 300 es\n      precision highp float;\n\n      uniform mat3 uPanZoomMatrix;\n      uniform int  uAtlasSize;\n      \n      // instanced\n      in vec2 aPosition; // a vertex from the unit square\n      \n      in mat3 aTransform; // used to transform verticies, eg into a bounding box\n      in int aVertType; // the type of thing we are rendering\n\n      // the z-index that is output when using picking mode\n      in vec4 aIndex;\n      \n      // For textures\n      in int aAtlasId; // which shader unit/atlas to use\n      in vec4 aTex; // x/y/w/h of texture in atlas\n\n      // for edges\n      in vec4 aPointAPointB;\n      in vec4 aPointCPointD;\n      in vec2 aLineWidth; // also used for node border width\n\n      // simple shapes\n      in vec4 aCornerRadius; // for round-rectangle [top-right, bottom-right, top-left, bottom-left]\n      in vec4 aColor; // also used for edges\n      in vec4 aBorderColor; // aLineWidth is used for border width\n\n      // output values passed to the fragment shader\n      out vec2 vTexCoord;\n      out vec4 vColor;\n      out vec2 vPosition;\n      // flat values are not interpolated\n      flat out int vAtlasId; \n      flat out int vVertType;\n      flat out vec2 vTopRight;\n      flat out vec2 vBotLeft;\n      flat out vec4 vCornerRadius;\n      flat out vec4 vBorderColor;\n      flat out vec2 vBorderWidth;\n      flat out vec4 vIndex;\n      \n      void main(void) {\n        int vid = gl_VertexID;\n        vec2 position = aPosition; // TODO make this a vec3, simplifies some code below\n\n        if(aVertType == ".concat(0,") {\n          float texX = aTex.x; // texture coordinates\n          float texY = aTex.y;\n          float texW = aTex.z;\n          float texH = aTex.w;\n\n          if(vid == 1 || vid == 2 || vid == 4) {\n            texX += texW;\n          }\n          if(vid == 2 || vid == 4 || vid == 5) {\n            texY += texH;\n          }\n\n          float d = float(uAtlasSize);\n          vTexCoord = vec2(texX / d, texY / d); // tex coords must be between 0 and 1\n\n          gl_Position = vec4(uPanZoomMatrix * aTransform * vec3(position, 1.0), 1.0);\n        }\n        else if(aVertType == ").concat(4," || aVertType == ").concat(7," \n             || aVertType == ").concat(5," || aVertType == ").concat(6,") { // simple shapes\n\n          // the bounding box is needed by the fragment shader\n          vBotLeft  = (aTransform * vec3(0, 0, 1)).xy; // flat\n          vTopRight = (aTransform * vec3(1, 1, 1)).xy; // flat\n          vPosition = (aTransform * vec3(position, 1)).xy; // will be interpolated\n\n          // calculations are done in the fragment shader, just pass these along\n          vColor = aColor;\n          vCornerRadius = aCornerRadius;\n          vBorderColor = aBorderColor;\n          vBorderWidth = aLineWidth;\n\n          gl_Position = vec4(uPanZoomMatrix * aTransform * vec3(position, 1.0), 1.0);\n        }\n        else if(aVertType == ").concat(1,") {\n          vec2 source = aPointAPointB.xy;\n          vec2 target = aPointAPointB.zw;\n\n          // adjust the geometry so that the line is centered on the edge\n          position.y = position.y - 0.5;\n\n          // stretch the unit square into a long skinny rectangle\n          vec2 xBasis = target - source;\n          vec2 yBasis = normalize(vec2(-xBasis.y, xBasis.x));\n          vec2 point = source + xBasis * position.x + yBasis * aLineWidth[0] * position.y;\n\n          gl_Position = vec4(uPanZoomMatrix * vec3(point, 1.0), 1.0);\n          vColor = aColor;\n        } \n        else if(aVertType == ").concat(2,") {\n          vec2 pointA = aPointAPointB.xy;\n          vec2 pointB = aPointAPointB.zw;\n          vec2 pointC = aPointCPointD.xy;\n          vec2 pointD = aPointCPointD.zw;\n\n          // adjust the geometry so that the line is centered on the edge\n          position.y = position.y - 0.5;\n\n          vec2 p0, p1, p2, pos;\n          if(position.x == 0.0) { // The left side of the unit square\n            p0 = pointA;\n            p1 = pointB;\n            p2 = pointC;\n            pos = position;\n          } else { // The right side of the unit square, use same approach but flip the geometry upside down\n            p0 = pointD;\n            p1 = pointC;\n            p2 = pointB;\n            pos = vec2(0.0, -position.y);\n          }\n\n          vec2 p01 = p1 - p0;\n          vec2 p12 = p2 - p1;\n          vec2 p21 = p1 - p2;\n\n          // Find the normal vector.\n          vec2 tangent = normalize(normalize(p12) + normalize(p01));\n          vec2 normal = vec2(-tangent.y, tangent.x);\n\n          // Find the vector perpendicular to p0 -> p1.\n          vec2 p01Norm = normalize(vec2(-p01.y, p01.x));\n\n          // Determine the bend direction.\n          float sigma = sign(dot(p01 + p21, normal));\n          float width = aLineWidth[0];\n\n          if(sign(pos.y) == -sigma) {\n            // This is an intersecting vertex. Adjust the position so that there's no overlap.\n            vec2 point = 0.5 * width * normal * -sigma / dot(normal, p01Norm);\n            gl_Position = vec4(uPanZoomMatrix * vec3(p1 + point, 1.0), 1.0);\n          } else {\n            // This is a non-intersecting vertex. Treat it like a mitre join.\n            vec2 point = 0.5 * width * normal * sigma * dot(normal, p01Norm);\n            gl_Position = vec4(uPanZoomMatrix * vec3(p1 + point, 1.0), 1.0);\n          }\n\n          vColor = aColor;\n        } \n        else if(aVertType == ").concat(3," && vid < 3) {\n          // massage the first triangle into an edge arrow\n          if(vid == 0)\n            position = vec2(-0.15, -0.3);\n          if(vid == 1)\n            position = vec2(  0.0,  0.0);\n          if(vid == 2)\n            position = vec2( 0.15, -0.3);\n\n          gl_Position = vec4(uPanZoomMatrix * aTransform * vec3(position, 1.0), 1.0);\n          vColor = aColor;\n        }\n        else {\n          gl_Position = vec4(2.0, 0.0, 0.0, 1.0); // discard vertex by putting it outside webgl clip space\n        }\n\n        vAtlasId = aAtlasId;\n        vVertType = aVertType;\n        vIndex = aIndex;\n      }\n    "),d=this.batchManager.getIndexArray(),e=function(a,b,c){var d=Bp(a,a.VERTEX_SHADER,b),e=Bp(a,a.FRAGMENT_SHADER,c),f=a.createProgram();if(a.attachShader(f,d),a.attachShader(f,e),a.linkProgram(f),!a.getProgramParameter(f,a.LINK_STATUS))throw Error("Could not initialize shaders");return f}(b,c,"#version 300 es\n      precision highp float;\n\n      // declare texture unit for each texture atlas in the batch\n      ".concat(d.map(function(a){return"uniform sampler2D uTexture".concat(a,";")}).join("\n	"),"\n\n      uniform vec4 uBGColor;\n      uniform float uZoom;\n\n      in vec2 vTexCoord;\n      in vec4 vColor;\n      in vec2 vPosition; // model coordinates\n\n      flat in int vAtlasId;\n      flat in vec4 vIndex;\n      flat in int vVertType;\n      flat in vec2 vTopRight;\n      flat in vec2 vBotLeft;\n      flat in vec4 vCornerRadius;\n      flat in vec4 vBorderColor;\n      flat in vec2 vBorderWidth;\n\n      out vec4 outColor;\n\n      ").concat("\n  float circleSD(vec2 p, float r) {\n    return distance(vec2(0), p) - r; // signed distance\n  }\n","\n      ").concat("\n  float rectangleSD(vec2 p, vec2 b) {\n    vec2 d = abs(p)-b;\n    return distance(vec2(0),max(d,0.0)) + min(max(d.x,d.y),0.0);\n  }\n","\n      ").concat("\n  float roundRectangleSD(vec2 p, vec2 b, vec4 cr) {\n    cr.xy = (p.x > 0.0) ? cr.xy : cr.zw;\n    cr.x  = (p.y > 0.0) ? cr.x  : cr.y;\n    vec2 q = abs(p) - b + cr.x;\n    return min(max(q.x, q.y), 0.0) + distance(vec2(0), max(q, 0.0)) - cr.x;\n  }\n","\n      ").concat("\n  float ellipseSD(vec2 p, vec2 ab) {\n    p = abs( p ); // symmetry\n\n    // find root with Newton solver\n    vec2 q = ab*(p-ab);\n    float w = (q.x<q.y)? 1.570796327 : 0.0;\n    for( int i=0; i<5; i++ ) {\n      vec2 cs = vec2(cos(w),sin(w));\n      vec2 u = ab*vec2( cs.x,cs.y);\n      vec2 v = ab*vec2(-cs.y,cs.x);\n      w = w + dot(p-u,v)/(dot(p-u,u)+dot(v,v));\n    }\n    \n    // compute final point and distance\n    float d = length(p-ab*vec2(cos(w),sin(w)));\n    \n    // return signed distance\n    return (dot(p/ab,p/ab)>1.0) ? d : -d;\n  }\n","\n\n      vec4 blend(vec4 top, vec4 bot) { // blend colors with premultiplied alpha\n        return vec4( \n          top.rgb + (bot.rgb * (1.0 - top.a)),\n          top.a   + (bot.a   * (1.0 - top.a)) \n        );\n      }\n\n      vec4 distInterp(vec4 cA, vec4 cB, float d) { // interpolate color using Signed Distance\n        // scale to the zoom level so that borders don't look blurry when zoomed in\n        // note 1.5 is an aribitrary value chosen because it looks good\n        return mix(cA, cB, 1.0 - smoothstep(0.0, 1.5 / uZoom, abs(d))); \n      }\n\n      void main(void) {\n        if(vVertType == ").concat(0,") {\n          // look up the texel from the texture unit\n          ").concat(d.map(function(a){return"if(vAtlasId == ".concat(a,") outColor = texture(uTexture").concat(a,", vTexCoord);")}).join("\n	else "),"\n        } \n        else if(vVertType == ").concat(3,") {\n          // mimics how canvas renderer uses context.globalCompositeOperation = 'destination-out';\n          outColor = blend(vColor, uBGColor);\n          outColor.a = 1.0; // make opaque, masks out line under arrow\n        }\n        else if(vVertType == ").concat(4," && vBorderWidth == vec2(0.0)) { // simple rectangle with no border\n          outColor = vColor; // unit square is already transformed to the rectangle, nothing else needs to be done\n        }\n        else if(vVertType == ").concat(4," || vVertType == ").concat(7," \n          || vVertType == ").concat(5," || vVertType == ").concat(6,") { // use SDF\n\n          float outerBorder = vBorderWidth[0];\n          float innerBorder = vBorderWidth[1];\n          float borderPadding = outerBorder * 2.0;\n          float w = vTopRight.x - vBotLeft.x - borderPadding;\n          float h = vTopRight.y - vBotLeft.y - borderPadding;\n          vec2 b = vec2(w/2.0, h/2.0); // half width, half height\n          vec2 p = vPosition - vec2(vTopRight.x - b[0] - outerBorder, vTopRight.y - b[1] - outerBorder); // translate to center\n\n          float d; // signed distance\n          if(vVertType == ").concat(4,") {\n            d = rectangleSD(p, b);\n          } else if(vVertType == ").concat(7," && w == h) {\n            d = circleSD(p, b.x); // faster than ellipse\n          } else if(vVertType == ").concat(7,") {\n            d = ellipseSD(p, b);\n          } else {\n            d = roundRectangleSD(p, b, vCornerRadius.wzyx);\n          }\n\n          // use the distance to interpolate a color to smooth the edges of the shape, doesn't need multisampling\n          // we must smooth colors inwards, because we can't change pixels outside the shape's bounding box\n          if(d > 0.0) {\n            if(d > outerBorder) {\n              discard;\n            } else {\n              outColor = distInterp(vBorderColor, vec4(0), d - outerBorder);\n            }\n          } else {\n            if(d > innerBorder) {\n              vec4 outerColor = outerBorder == 0.0 ? vec4(0) : vBorderColor;\n              vec4 innerBorderColor = blend(vBorderColor, vColor);\n              outColor = distInterp(innerBorderColor, outerColor, d);\n            } \n            else {\n              vec4 outerColor;\n              if(innerBorder == 0.0 && outerBorder == 0.0) {\n                outerColor = vec4(0);\n              } else if(innerBorder == 0.0) {\n                outerColor = vBorderColor;\n              } else {\n                outerColor = blend(vBorderColor, vColor);\n              }\n              outColor = distInterp(vColor, outerColor, d - innerBorder);\n            }\n          }\n        }\n        else {\n          outColor = vColor;\n        }\n\n        ").concat(a.picking?"if(outColor.a == 0.0) discard;\n             else outColor = vIndex;":"","\n      }\n    "));e.aPosition=b.getAttribLocation(e,"aPosition"),e.aIndex=b.getAttribLocation(e,"aIndex"),e.aVertType=b.getAttribLocation(e,"aVertType"),e.aTransform=b.getAttribLocation(e,"aTransform"),e.aAtlasId=b.getAttribLocation(e,"aAtlasId"),e.aTex=b.getAttribLocation(e,"aTex"),e.aPointAPointB=b.getAttribLocation(e,"aPointAPointB"),e.aPointCPointD=b.getAttribLocation(e,"aPointCPointD"),e.aLineWidth=b.getAttribLocation(e,"aLineWidth"),e.aColor=b.getAttribLocation(e,"aColor"),e.aCornerRadius=b.getAttribLocation(e,"aCornerRadius"),e.aBorderColor=b.getAttribLocation(e,"aBorderColor"),e.uPanZoomMatrix=b.getUniformLocation(e,"uPanZoomMatrix"),e.uAtlasSize=b.getUniformLocation(e,"uAtlasSize"),e.uBGColor=b.getUniformLocation(e,"uBGColor"),e.uZoom=b.getUniformLocation(e,"uZoom"),e.uTextures=[];for(var f=0;f<this.batchManager.getMaxAtlasesPerBatch();f++)e.uTextures.push(b.getUniformLocation(e,"uTexture".concat(f)));return e}},{key:"_createVAO",value:function(){var a,b,c,d,e,f,g=[0,0,1,0,1,1,0,0,1,1,0,1];this.vertexCount=g.length/2;var h=this.maxInstances,i=this.gl,j=this.program,k=i.createVertexArray();return i.bindVertexArray(k),a=j.aPosition,c=(b=rf(Bv(i,"vec2"),2))[0],e=Bw(i,d=b[1],g),f=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,f),i.bufferData(i.ARRAY_BUFFER,e,i.STATIC_DRAW),d===i.FLOAT?i.vertexAttribPointer(a,c,d,!1,0,0):d===i.INT&&i.vertexAttribIPointer(a,c,d,0,0),i.enableVertexAttribArray(a),i.bindBuffer(i.ARRAY_BUFFER,null),this.transformBuffer=function(a,b,c){for(var d=new Float32Array(9*b),e=Array(b),f=0;f<b;f++){var g=9*f*4;e[f]=new Float32Array(d.buffer,g,9)}var h=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,h),a.bufferData(a.ARRAY_BUFFER,d.byteLength,a.DYNAMIC_DRAW);for(var i=0;i<3;i++){var j=c+i;a.enableVertexAttribArray(j),a.vertexAttribPointer(j,3,a.FLOAT,!1,36,12*i),a.vertexAttribDivisor(j,1)}return a.bindBuffer(a.ARRAY_BUFFER,null),h.getMatrixView=function(a){return e[a]},h.setData=function(a,b){e[b].set(a,0)},h.bufferSubData=function(){a.bindBuffer(a.ARRAY_BUFFER,h),a.bufferSubData(a.ARRAY_BUFFER,0,d)},h}(i,h,j.aTransform),this.indexBuffer=Bx(i,h,"vec4",j.aIndex),this.vertTypeBuffer=Bx(i,h,"int",j.aVertType),this.atlasIdBuffer=Bx(i,h,"int",j.aAtlasId),this.texBuffer=Bx(i,h,"vec4",j.aTex),this.pointAPointBBuffer=Bx(i,h,"vec4",j.aPointAPointB),this.pointCPointDBuffer=Bx(i,h,"vec4",j.aPointCPointD),this.lineWidthBuffer=Bx(i,h,"vec2",j.aLineWidth),this.colorBuffer=Bx(i,h,"vec4",j.aColor),this.cornerRadiusBuffer=Bx(i,h,"vec4",j.aCornerRadius),this.borderColorBuffer=Bx(i,h,"vec4",j.aBorderColor),i.bindVertexArray(null),k}},{key:"buffers",get:function(){var a=this;return this._buffers||(this._buffers=Object.keys(this).filter(function(a){return rH(a,"Buffer")}).map(function(b){return a[b]})),this._buffers}},{key:"startFrame",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:BI;this.panZoomMatrix=a,this.renderTarget=b,this.batchDebugInfo=[],this.wrappedCount=0,this.simpleCount=0,this.startBatch()}},{key:"startBatch",value:function(){this.instanceCount=0,this.batchManager.startBatch()}},{key:"endFrame",value:function(){this.endBatch()}},{key:"_isVisible",value:function(a,b){return!!a.visible()&&(!b||!b.isVisible||b.isVisible(a))}},{key:"drawTexture",value:function(a,b,c){var d=this.atlasManager,e=this.batchManager,f=d.getRenderTypeOpts(c);if(this._isVisible(a,f)&&(!a.isEdge()||this._isValidEdge(a))){if(this.renderTarget.picking&&f.getTexPickingMode){var g=f.getTexPickingMode(a);if(1===g)return;if(2==g)return void this.drawPickingRectangle(a,b,c)}var h,i=rd(d.getAtlasInfo(a,c));try{for(i.s();!(h=i.n()).done;){var j=h.value,k=j.atlas,l=j.tex1,n=j.tex2;e.canAddToCurrentBatch(k)||this.endBatch();for(var o=e.getAtlasIndexForBatch(k),p=0,q=[[l,!0],[n,!1]];p<q.length;p++){var r=rf(q[p],2),s=r[0],t=r[1];if(0!=s.w){var u=this.instanceCount;this.vertTypeBuffer.getView(u)[0]=0;var v=this.indexBuffer.getView(u);Bu(b,v),this.atlasIdBuffer.getView(u)[0]=o;var w=this.texBuffer.getView(u);w[0]=s.x,w[1]=s.y,w[2]=s.w,w[3]=s.h;var x=this.transformBuffer.getMatrixView(u);this.setTransformMatrix(a,x,f,j,t),this.instanceCount++,!t&&this.wrappedCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}}}}catch(a){i.e(a)}finally{i.f()}}}},{key:"setTransformMatrix",value:function(a,b,c,d){var e=!(arguments.length>4)||void 0===arguments[4]||arguments[4],f=0;if(c.shapeProps&&c.shapeProps.padding&&(f=a.pstyle(c.shapeProps.padding).pfValue),d){var g=d.bb,h=d.tex1,i=d.tex2,j=h.w/(h.w+i.w);e||(j=1-j);var k=this._getAdjustedBB(g,f,e,j);this._applyTransformMatrix(b,k,c,a)}else{var l=c.getBoundingBox(a),n=this._getAdjustedBB(l,f,!0,1);this._applyTransformMatrix(b,n,c,a)}}},{key:"_applyTransformMatrix",value:function(a,b,c,d){BA(a);var e,f,g=c.getRotation?c.getRotation(d):0;if(0!==g){var h=c.getRotationPoint(d);BB(a,a,[h.x,h.y]),BC(a,a,g);var i=c.getRotationOffset(d);e=i.x+(b.xOffset||0),f=i.y+(b.yOffset||0)}else e=b.x1,f=b.y1;BB(a,a,[e,f]),BD(a,a,[b.w,b.h])}},{key:"_getAdjustedBB",value:function(a,b,c,d){var e=a.x1,f=a.y1,g=a.w,h=a.h,i=a.yOffset;b&&(e-=b,f-=b,g+=2*b,h+=2*b);var j=0,k=g*d;return c&&d<1?g=k:!c&&d<1&&(e+=j=g-k,g=k),{x1:e,y1:f,w:g,h:h,xOffset:j,yOffset:i}}},{key:"drawPickingRectangle",value:function(a,b,c){var d=this.atlasManager.getRenderTypeOpts(c),e=this.instanceCount;this.vertTypeBuffer.getView(e)[0]=4,Bu(b,this.indexBuffer.getView(e)),Bt([0,0,0],1,this.colorBuffer.getView(e));var f=this.transformBuffer.getMatrixView(e);this.setTransformMatrix(a,f,d),this.simpleCount++,this.instanceCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}},{key:"drawNode",value:function(a,b,c){var d=this.simpleShapeOptions.get(c);if(this._isVisible(a,d)){var e=d.shapeProps,f=this._getVertTypeForShape(a,e.shape);if(void 0===f||d.isSimple&&!d.isSimple(a))return void this.drawTexture(a,b,c);var g=this.instanceCount;if(this.vertTypeBuffer.getView(g)[0]=f,5===f||6===f){var h=d.getBoundingBox(a),i=this._getCornerRadius(a,e.radius,h),j=this.cornerRadiusBuffer.getView(g);j[0]=i,j[1]=i,j[2]=i,j[3]=i,6===f&&(j[0]=0,j[2]=0)}Bu(b,this.indexBuffer.getView(g)),Bt(a.pstyle(e.color).value,a.pstyle(e.opacity).value,this.colorBuffer.getView(g));var k=this.lineWidthBuffer.getView(g);if(k[0]=0,k[1]=0,e.border){var l=a.pstyle("border-width").value;if(l>0){Bt(a.pstyle("border-color").value,a.pstyle("border-opacity").value,this.borderColorBuffer.getView(g));var n=a.pstyle("border-position").value;if("inside"===n)k[0]=0,k[1]=-l;else if("outside"===n)k[0]=l,k[1]=0;else{var o=l/2;k[0]=o,k[1]=-o}}}var p=this.transformBuffer.getMatrixView(g);this.setTransformMatrix(a,p,d),this.simpleCount++,this.instanceCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}}},{key:"_getVertTypeForShape",value:function(a,b){switch(a.pstyle(b).value){case"rectangle":return 4;case"ellipse":return 7;case"roundrectangle":case"round-rectangle":return 5;case"bottom-round-rectangle":return 6;default:return}}},{key:"_getCornerRadius",value:function(a,b,c){var d=c.w,e=c.h;return"auto"===a.pstyle(b).value?tF(d,e):Math.min(a.pstyle(b).pfValue,e/2,d/2)}},{key:"drawEdgeArrow",value:function(a,b,c){if(a.visible()){var d,e,f,g=a._private.rscratch;if(("source"===c?(d=g.arrowStartX,e=g.arrowStartY,f=g.srcArrowAngle):(d=g.arrowEndX,e=g.arrowEndY,f=g.tgtArrowAngle),!(isNaN(d)||null==d||isNaN(e)||null==e||isNaN(f))&&null!=f)&&"none"!==a.pstyle(c+"-arrow-shape").value){var h=a.pstyle(c+"-arrow-color").value,i=a.pstyle("opacity").value,j=a.pstyle("line-opacity").value,k=a.pstyle("width").pfValue,l=a.pstyle("arrow-scale").value,n=this.r.getArrowWidth(k,l),o=this.instanceCount,p=this.transformBuffer.getMatrixView(o);BA(p),BB(p,p,[d,e]),BD(p,p,[n,n]),BC(p,p,f),this.vertTypeBuffer.getView(o)[0]=3,Bu(b,this.indexBuffer.getView(o)),Bt(h,i*j,this.colorBuffer.getView(o)),this.instanceCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}}}},{key:"drawEdgeLine",value:function(a,b){if(a.visible()){var c=this._getEdgePoints(a);if(c){var d=a.pstyle("opacity").value,e=a.pstyle("line-opacity").value,f=a.pstyle("width").pfValue,g=a.pstyle("line-color").value,h=d*e;if(c.length/2+this.instanceCount>this.maxInstances&&this.endBatch(),4==c.length){var i=this.instanceCount;this.vertTypeBuffer.getView(i)[0]=1,Bu(b,this.indexBuffer.getView(i)),Bt(g,h,this.colorBuffer.getView(i)),this.lineWidthBuffer.getView(i)[0]=f;var j=this.pointAPointBBuffer.getView(i);j[0]=c[0],j[1]=c[1],j[2]=c[2],j[3]=c[3],this.instanceCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}else for(var k=0;k<c.length-2;k+=2){var l=this.instanceCount;this.vertTypeBuffer.getView(l)[0]=2,Bu(b,this.indexBuffer.getView(l)),Bt(g,h,this.colorBuffer.getView(l)),this.lineWidthBuffer.getView(l)[0]=f;var n=c[k-2],o=c[k-1],p=c[k],q=c[k+1],r=c[k+2],s=c[k+3],t=c[k+4],u=c[k+5];0==k&&(n=2*p-r+.001,o=2*q-s+.001),k==c.length-4&&(t=2*r-p+.001,u=2*s-q+.001);var v=this.pointAPointBBuffer.getView(l);v[0]=n,v[1]=o,v[2]=p,v[3]=q;var w=this.pointCPointDBuffer.getView(l);w[0]=r,w[1]=s,w[2]=t,w[3]=u,this.instanceCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}}}}},{key:"_isValidEdge",value:function(a){var b=a._private.rscratch;return!(b.badLine||null==b.allpts||isNaN(b.allpts[0]))}},{key:"_getEdgePoints",value:function(a){var b=a._private.rscratch;if(this._isValidEdge(a)){var c=b.allpts;if(4==c.length)return c;var d=this._getNumSegments(a);return this._getCurveSegmentPoints(c,d)}}},{key:"_getNumSegments",value:function(a){return Math.min(15,this.maxInstances)}},{key:"_getCurveSegmentPoints",value:function(a,b){if(4==a.length)return a;for(var c=Array((b+1)*2),d=0;d<=b;d++)if(0==d)c[0]=a[0],c[1]=a[1];else if(d==b)c[2*d]=a[a.length-2],c[2*d+1]=a[a.length-1];else{var e=d/b;this._setCurvePoint(a,e,c,2*d)}return c}},{key:"_setCurvePoint",value:function(a,b,c,d){if(a.length<=2)c[d]=a[0],c[d+1]=a[1];else{for(var e=Array(a.length-2),f=0;f<e.length;f+=2){var g=(1-b)*a[f]+b*a[f+2],h=(1-b)*a[f+1]+b*a[f+3];e[f]=g,e[f+1]=h}return this._setCurvePoint(e,b,c,d)}}},{key:"endBatch",value:function(){var a=this.gl,b=this.vao,c=this.vertexCount,d=this.instanceCount;if(0!==d){var e,f,g=this.renderTarget.picking?this.pickingProgram:this.program;a.useProgram(g),a.bindVertexArray(b);var h,i=rd(this.buffers);try{for(i.s();!(h=i.n()).done;)h.value.bufferSubData(d)}catch(a){i.e(a)}finally{i.f()}for(var j=this.batchManager.getAtlases(),k=0;k<j.length;k++)j[k].bufferIfNeeded(a);for(var l=0;l<j.length;l++)a.activeTexture(a.TEXTURE0+l),a.bindTexture(a.TEXTURE_2D,j[l].texture),a.uniform1i(g.uTextures[l],l);a.uniform1f(g.uZoom,(f=(e=this.r).pixelRatio,e.cy.zoom()*f)),a.uniformMatrix3fv(g.uPanZoomMatrix,!1,this.panZoomMatrix),a.uniform1i(g.uAtlasSize,this.batchManager.getAtlasSize());var n=Bt(this.bgColor,1);a.uniform4fv(g.uBGColor,n),a.drawArraysInstanced(a.TRIANGLES,0,c,d),a.bindVertexArray(null),a.bindTexture(a.TEXTURE_2D,null),this.debug&&this.batchDebugInfo.push({count:d,atlasCount:j.length}),this.startBatch()}}},{key:"getDebugInfo",value:function(){var a=this.atlasManager.getDebugInfo(),b=a.reduce(function(a,b){return a+b.atlasCount},0),c=this.batchDebugInfo,d=c.reduce(function(a,b){return a+b.count},0);return{atlasInfo:a,totalAtlases:b,wrappedCount:this.wrappedCount,simpleCount:this.simpleCount,batchCount:c.length,batchInfo:c,totalInstances:d}}}]),BL={};function BM(a,b){return sx(a._private.rscratch,"labelWrapCachedLines",b)||[]}BL.initWebgl=function(a,b){var c,d,e,f,g,h,i,j,k=this,l=k.data.contexts[k.WEBGL];a.bgColor=rS((c=k.cy.container())&&c.style&&c.style.backgroundColor||"white"),a.webglTexSize=Math.min(a.webglTexSize,l.getParameter(l.MAX_TEXTURE_SIZE)),a.webglTexRows=Math.min(a.webglTexRows,54),a.webglTexRowsNodes=Math.min(a.webglTexRowsNodes,54),a.webglBatchSize=Math.min(a.webglBatchSize,16384),a.webglTexPerBatch=Math.min(a.webglTexPerBatch,l.getParameter(l.MAX_TEXTURE_IMAGE_UNITS)),k.webglDebug=a.webglDebug,k.webglDebugShowAtlases=a.webglDebugShowAtlases,i=l.createFramebuffer(),l.bindFramebuffer(l.FRAMEBUFFER,i),j=l.createTexture(),l.bindTexture(l.TEXTURE_2D,j),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,l.LINEAR),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,l.CLAMP_TO_EDGE),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,l.CLAMP_TO_EDGE),l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,j,0),l.bindFramebuffer(l.FRAMEBUFFER,null),i.setFramebufferAttachmentSizes=function(a,b){l.bindTexture(l.TEXTURE_2D,j),l.texImage2D(l.TEXTURE_2D,0,l.RGBA,a,b,0,l.RGBA,l.UNSIGNED_BYTE,null)},k.pickingFrameBuffer=i,k.pickingFrameBuffer.needsDraw=!0,k.drawing=new BK(k,l,a);var n=function(a){return function(b){return k.getTextAngle(b,a)}},o=function(a){return function(b){var c=b.pstyle(a);return c&&c.value}},p=function(a){return function(b){return b.pstyle("".concat(a,"-opacity")).value>0}},q=function(a){return"yes"===a.pstyle("text-events").strValue?2:1},r=function(a){var b=a.position(),c=b.x,d=b.y,e=a.outerWidth(),f=a.outerHeight();return{w:e,h:f,x1:c-e/2,y1:d-f/2}};k.drawing.addAtlasCollection("node",{texRows:a.webglTexRowsNodes}),k.drawing.addAtlasCollection("label",{texRows:a.webglTexRows}),k.drawing.addTextureAtlasRenderType("node-body",{collection:"node",getKey:b.getStyleKey,getBoundingBox:b.getElementBox,drawElement:b.drawElement}),k.drawing.addSimpleShapeRenderType("node-body",{getBoundingBox:r,isSimple:Bs,shapeProps:{shape:"shape",color:"background-color",opacity:"background-opacity",radius:"corner-radius",border:!0}}),k.drawing.addSimpleShapeRenderType("node-overlay",{getBoundingBox:r,isVisible:p("overlay"),shapeProps:{shape:"overlay-shape",color:"overlay-color",opacity:"overlay-opacity",padding:"overlay-padding",radius:"overlay-corner-radius"}}),k.drawing.addSimpleShapeRenderType("node-underlay",{getBoundingBox:r,isVisible:p("underlay"),shapeProps:{shape:"underlay-shape",color:"underlay-color",opacity:"underlay-opacity",padding:"underlay-padding",radius:"underlay-corner-radius"}}),k.drawing.addTextureAtlasRenderType("label",{collection:"label",getTexPickingMode:q,getKey:BN(b.getLabelKey,null),getBoundingBox:BO(b.getLabelBox,null),drawClipped:!0,drawElement:b.drawLabel,getRotation:n(null),getRotationPoint:b.getLabelRotationPoint,getRotationOffset:b.getLabelRotationOffset,isVisible:o("label")}),k.drawing.addTextureAtlasRenderType("edge-source-label",{collection:"label",getTexPickingMode:q,getKey:BN(b.getSourceLabelKey,"source"),getBoundingBox:BO(b.getSourceLabelBox,"source"),drawClipped:!0,drawElement:b.drawSourceLabel,getRotation:n("source"),getRotationPoint:b.getSourceLabelRotationPoint,getRotationOffset:b.getSourceLabelRotationOffset,isVisible:o("source-label")}),k.drawing.addTextureAtlasRenderType("edge-target-label",{collection:"label",getTexPickingMode:q,getKey:BN(b.getTargetLabelKey,"target"),getBoundingBox:BO(b.getTargetLabelBox,"target"),drawClipped:!0,drawElement:b.drawTargetLabel,getRotation:n("target"),getRotationPoint:b.getTargetLabelRotationPoint,getRotationOffset:b.getTargetLabelRotationOffset,isVisible:o("target-label")});var s=r1(function(){console.log("garbage collect flag set"),k.data.gc=!0},1e4);k.onUpdateEleCalcs(function(a,b){var c=!1;b&&b.length>0&&(c|=k.drawing.invalidate(b)),c&&s()}),e=(d=k).render,d.render=function(a){a=a||{};var b,c,f,g,h=d.cy;d.webgl&&(h.zoom()>7.99?((c=(b=d).data.contexts[b.WEBGL]).clear(c.COLOR_BUFFER_BIT|c.DEPTH_BUFFER_BIT),e.call(d,a)):(f=d,(g=function(a){a.save(),a.setTransform(1,0,0,1,0,0),a.clearRect(0,0,f.canvasWidth,f.canvasHeight),a.restore()})(f.data.contexts[f.NODE]),g(f.data.contexts[f.DRAG]),BR(d,a,BI)))},f=d.matchCanvasSize,d.matchCanvasSize=function(a){f.call(d,a),d.pickingFrameBuffer.setFramebufferAttachmentSizes(d.canvasWidth,d.canvasHeight),d.pickingFrameBuffer.needsDraw=!0},d.findNearestElements=function(a,b,c,e){return function(a,b,c){var d,e,f,g=function(a,b,c,d,e){var f=Br(a),g=f.pan,h=f.zoom,i=rf((q=b*h+g.x,r=c*h+g.y,[q,r=Math.round(a.canvasHeight-r)]),2),j=i[0],k=i[1],l=a.data.contexts[a.WEBGL];l.bindFramebuffer(l.FRAMEBUFFER,a.pickingFrameBuffer),a.pickingFrameBuffer.needsDraw&&(l.viewport(0,0,l.canvas.width,l.canvas.height),BR(a,null,BJ),a.pickingFrameBuffer.needsDraw=!1);var n=new Uint8Array(144);l.readPixels(j-3,k-3,6,6,l.RGBA,l.UNSIGNED_BYTE,n),l.bindFramebuffer(l.FRAMEBUFFER,null);for(var o=new Set,p=0;p<36;p++){var q,r,s,t=(s=n.slice(4*p,4*p+4))[0]+(s[1]<<8)+(s[2]<<16)+(s[3]<<24)-1;t>=0&&o.add(t)}return o}(a,b,c),h=a.getCachedZSortedEles(),i=rd(g);try{for(i.s();!(f=i.n()).done;){var j=h[f.value];if(!d&&j.isNode()&&(d=j),!e&&j.isEdge()&&(e=j),d&&e)break}}catch(a){i.e(a)}finally{i.f()}return[d,e].filter(Boolean)}(d,a,b)},g=d.invalidateCachedZSortedEles,d.invalidateCachedZSortedEles=function(){g.call(d),d.pickingFrameBuffer.needsDraw=!0},h=d.notify,d.notify=function(a,b){h.call(d,a,b),"viewport"===a||"bounds"===a?d.pickingFrameBuffer.needsDraw=!0:"background"===a&&d.drawing.invalidate(b,{type:"node-body"})}};var BN=function(a,b){return function(c){var d=a(c),e=BM(c,b);return e.length>1?e.map(function(a,b){return"".concat(d,"_").concat(b)}):d}},BO=function(a,b){return function(c,d){var e=a(c);if("string"==typeof d){var f=d.indexOf("_");if(f>0){var g=Number(d.substring(f+1)),h=BM(c,b),i=e.h/h.length,j=i*g,k=e.y1+j;return{x1:e.x1,w:e.w,y1:k,h:i,yOffset:j}}}return e}};function BP(a,b){var c=a.canvasWidth,d=a.canvasHeight,e=Br(a),f=e.pan,g=e.zoom;b.setTransform(1,0,0,1,0,0),b.clearRect(0,0,c,d),b.translate(f.x,f.y),b.scale(g,g)}function BQ(a,b,c){var d=a.drawing;b+=1,c.isNode()?(d.drawNode(c,b,"node-underlay"),d.drawNode(c,b,"node-body"),d.drawTexture(c,b,"label"),d.drawNode(c,b,"node-overlay")):(d.drawEdgeLine(c,b),d.drawEdgeArrow(c,b,"source"),d.drawEdgeArrow(c,b,"target"),d.drawTexture(c,b,"label"),d.drawTexture(c,b,"edge-source-label"),d.drawTexture(c,b,"edge-target-label"))}function BR(a,b,c){a.webglDebug&&(U=performance.now());var d=a.drawing,e=0;if(c.screen&&a.data.canvasNeedsRedraw[a.SELECT_BOX]&&a.drawSelectionRectangle(b,function(b){return BP(a,b)}),a.data.canvasNeedsRedraw[a.NODE]||c.picking){var f,g,h,i,j,k,l,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L=a.data.contexts[a.WEBGL];c.screen?(L.clearColor(0,0,0,0),L.enable(L.BLEND),L.blendFunc(L.ONE,L.ONE_MINUS_SRC_ALPHA)):L.disable(L.BLEND),L.clear(L.COLOR_BUFFER_BIT|L.DEPTH_BUFFER_BIT),L.viewport(0,0,L.canvas.width,L.canvas.height);var M=(f=a.canvasWidth,g=a.canvasHeight,i=(h=Br(a)).pan,j=h.zoom,BB(k=Bz(),k,[i.x,i.y]),BD(k,k,[j,j]),n=l=Bz(),n[0]=2/f,n[1]=0,n[2]=0,n[3]=0,n[4]=-2/g,n[5]=0,n[6]=-1,n[7]=1,n[8]=1,p=o=Bz(),q=l[0],r=l[1],s=l[2],t=l[3],u=l[4],v=l[5],w=l[6],x=l[7],y=l[8],z=k[0],A=k[1],B=k[2],C=k[3],D=k[4],E=k[5],F=k[6],G=k[7],H=k[8],p[0]=z*q+A*t+B*w,p[1]=z*r+A*u+B*x,p[2]=z*s+A*v+B*y,p[3]=C*q+D*t+E*w,p[4]=C*r+D*u+E*x,p[5]=C*s+D*v+E*y,p[6]=F*q+G*t+H*w,p[7]=F*r+G*u+H*x,p[8]=F*s+G*v+H*y,o),N=a.getCachedZSortedEles();if(e=N.length,d.startFrame(M,c),c.screen){for(var O=0;O<N.nondrag.length;O++)BQ(a,O,N.nondrag[O]);for(var P=0;P<N.drag.length;P++)BQ(a,P,N.drag[P])}else if(c.picking)for(var Q=0;Q<N.length;Q++)BQ(a,Q,N[Q]);d.endFrame(),c.screen&&a.webglDebugShowAtlases&&((I=a.data.contexts[a.NODE]).save(),BP(a,I),I.strokeStyle="rgba(0, 0, 0, 0.3)",I.beginPath(),I.moveTo(-1e3,0),I.lineTo(1e3,0),I.stroke(),I.beginPath(),I.moveTo(0,-1e3),I.lineTo(0,1e3),I.stroke(),I.restore(),K=0,(J=function(b,c,d){for(var e=b.atlasManager.getAtlasCollection(c),f=a.data.contexts[a.NODE],g=e.atlases,h=0;h<g.length;h++){var i=g[h].canvas;if(i){var j=i.width,k=i.height,l=j*h,n=i.height*d;f.save(),f.scale(.4,.4),f.drawImage(i,l,n),f.strokeStyle="black",f.rect(l,n,j,k),f.stroke(),f.restore()}}})(a.drawing,"node",K++),J(a.drawing,"label",K++)),a.data.canvasNeedsRedraw[a.NODE]=!1,a.data.canvasNeedsRedraw[a.DRAG]=!1}if(a.webglDebug){var R=Math.ceil(performance.now()-U),S=d.getDebugInfo(),T=["".concat(e," elements"),"".concat(S.totalInstances," instances"),"".concat(S.batchCount," batches"),"".concat(S.totalAtlases," atlases"),"".concat(S.wrappedCount," wrapped textures"),"".concat(S.simpleCount," simple shapes")].join(", ");console.log("WebGL (".concat(c.name,") - frame time ").concat(R,"ms")),console.log("Totals:"),console.log("  ".concat(T)),console.log("Texture Atlases Used:");var U,V,W=rd(S.atlasInfo);try{for(W.s();!(V=W.n()).done;){var X=V.value;console.log("  ".concat(X.type,": ").concat(X.keyCount," keys, ").concat(X.atlasCount," atlases"))}}catch(a){W.e(a)}finally{W.f()}console.log("")}a.data.gc&&(console.log("Garbage Collect!"),a.data.gc=!1,d.gc())}var BS={};BS.drawPolygonPath=function(a,b,c,d,e,f){var g=d/2,h=e/2;a.beginPath&&a.beginPath(),a.moveTo(b+g*f[0],c+h*f[1]);for(var i=1;i<f.length/2;i++)a.lineTo(b+g*f[2*i],c+h*f[2*i+1]);a.closePath()},BS.drawRoundPolygonPath=function(a,b,c,d,e,f,g){g.forEach(function(b){return Az(a,b)}),a.closePath()},BS.drawRoundRectanglePath=function(a,b,c,d,e,f){var g=d/2,h=e/2,i="auto"===f?tF(d,e):Math.min(f,h,g);a.beginPath&&a.beginPath(),a.moveTo(b,c-h),a.arcTo(b+g,c-h,b+g,c,i),a.arcTo(b+g,c+h,b,c+h,i),a.arcTo(b-g,c+h,b-g,c,i),a.arcTo(b-g,c-h,b,c-h,i),a.lineTo(b,c-h),a.closePath()},BS.drawBottomRoundRectanglePath=function(a,b,c,d,e,f){var g=d/2,h=e/2,i="auto"===f?tF(d,e):f;a.beginPath&&a.beginPath(),a.moveTo(b,c-h),a.lineTo(b+g,c-h),a.lineTo(b+g,c),a.arcTo(b+g,c+h,b,c+h,i),a.arcTo(b-g,c+h,b-g,c,i),a.lineTo(b-g,c-h),a.lineTo(b,c-h),a.closePath()},BS.drawCutRectanglePath=function(a,b,c,d,e,f,g){var h=d/2,i=e/2,j="auto"===g?tH():g;a.beginPath&&a.beginPath(),a.moveTo(b-h+j,c-i),a.lineTo(b+h-j,c-i),a.lineTo(b+h,c-i+j),a.lineTo(b+h,c+i-j),a.lineTo(b+h-j,c+i),a.lineTo(b-h+j,c+i),a.lineTo(b-h,c+i-j),a.lineTo(b-h,c-i+j),a.closePath()},BS.drawBarrelPath=function(a,b,c,d,e){var f=d/2,g=e/2,h=b-f,i=b+f,j=c-g,k=c+g,l=tI(d,e),n=l.widthOffset,o=l.heightOffset,p=l.ctrlPtOffsetPct*n;a.beginPath&&a.beginPath(),a.moveTo(h,j+o),a.lineTo(h,k-o),a.quadraticCurveTo(h+p,k,h+n,k),a.lineTo(i-n,k),a.quadraticCurveTo(i-p,k,i,k-o),a.lineTo(i,j+o),a.quadraticCurveTo(i-p,j,i-n,j),a.lineTo(h+n,j),a.quadraticCurveTo(h+p,j,h,j+o),a.closePath()};for(var BT={},BU={},BV=Math.PI/40,BW=0*Math.PI;BW<2*Math.PI;BW+=BV)BT[BW]=Math.sin(BW),BU[BW]=Math.cos(BW);BS.drawEllipsePath=function(a,b,c,d,e){if(a.beginPath&&a.beginPath(),a.ellipse)a.ellipse(b,c,d/2,e/2,0,0,2*Math.PI);else for(var f,g,h=d/2,i=e/2,j=0*Math.PI;j<2*Math.PI;j+=BV)f=b-h*BT[j]*0+h*BU[j]*1,g=c+i*BU[j]*0+i*BT[j]*1,0===j?a.moveTo(f,g):a.lineTo(f,g);a.closePath()};var BX={};function BY(a){var b=a.indexOf(",");return a.substr(b+1)}function BZ(a,b,c){var d=function(){return b.toDataURL(c,a.quality)};switch(a.output){case"blob-promise":return new uO(function(d,e){try{b.toBlob(function(a){null!=a?d(a):e(Error("`canvas.toBlob()` sent a null value in its callback"))},c,a.quality)}catch(a){e(a)}});case"blob":return function(a,b){for(var c=atob(a),d=new ArrayBuffer(c.length),e=new Uint8Array(d),f=0;f<c.length;f++)e[f]=c.charCodeAt(f);return new Blob([d],{type:b})}(BY(d()),c);case"base64":return BY(d());default:return d()}}BX.createBuffer=function(a,b){var c=document.createElement("canvas");return c.width=a,c.height=b,[c,c.getContext("2d")]},BX.bufferCanvasImage=function(a){var b=this.cy,c=b.mutableElements().boundingBox(),d=this.findContainerClientCoords(),e=a.full?Math.ceil(c.w):d[2],f=a.full?Math.ceil(c.h):d[3],g=rt(a.maxWidth)||rt(a.maxHeight),h=this.getPixelRatio(),i=1;if(void 0!==a.scale)e*=a.scale,f*=a.scale,i=a.scale;else if(g){var j=1/0,k=1/0;rt(a.maxWidth)&&(j=i*a.maxWidth/e),rt(a.maxHeight)&&(k=i*a.maxHeight/f),e*=i=Math.min(j,k),f*=i}g||(e*=h,f*=h,i*=h);var l=document.createElement("canvas");l.width=e,l.height=f,l.style.width=e+"px",l.style.height=f+"px";var n=l.getContext("2d");if(e>0&&f>0){n.clearRect(0,0,e,f),n.globalCompositeOperation="source-over";var o=this.getCachedZSortedEles();if(a.full)n.translate(-c.x1*i,-c.y1*i),n.scale(i,i),this.drawElements(n,o),n.scale(1/i,1/i),n.translate(c.x1*i,c.y1*i);else{var p=b.pan(),q={x:p.x*i,y:p.y*i};i*=b.zoom(),n.translate(q.x,q.y),n.scale(i,i),this.drawElements(n,o),n.scale(1/i,1/i),n.translate(-q.x,-q.y)}a.bg&&(n.globalCompositeOperation="destination-over",n.fillStyle=a.bg,n.rect(0,0,e,f),n.fill())}return l},BX.png=function(a){return BZ(a,this.bufferCanvasImage(a),"image/png")},BX.jpg=function(a){return BZ(a,this.bufferCanvasImage(a),"image/jpeg")};var B$={};B$.nodeShapeImpl=function(a,b,c,d,e,f,g,h){switch(a){case"ellipse":return this.drawEllipsePath(b,c,d,e,f);case"polygon":return this.drawPolygonPath(b,c,d,e,f,g);case"round-polygon":return this.drawRoundPolygonPath(b,c,d,e,f,g,h);case"roundrectangle":case"round-rectangle":return this.drawRoundRectanglePath(b,c,d,e,f,h);case"cutrectangle":case"cut-rectangle":return this.drawCutRectanglePath(b,c,d,e,f,g,h);case"bottomroundrectangle":case"bottom-round-rectangle":return this.drawBottomRoundRectanglePath(b,c,d,e,f,h);case"barrel":return this.drawBarrelPath(b,c,d,e,f)}};var B_=B0.prototype;function B0(a){var b=this,c=b.cy.window().document;a.webgl&&(B_.CANVAS_LAYERS=b.CANVAS_LAYERS=4,console.log("webgl rendering enabled")),b.data={canvases:Array(B_.CANVAS_LAYERS),contexts:Array(B_.CANVAS_LAYERS),canvasNeedsRedraw:Array(B_.CANVAS_LAYERS),bufferCanvases:Array(B_.BUFFER_COUNT),bufferContexts:Array(B_.CANVAS_LAYERS)};var d="-webkit-tap-highlight-color",e="rgba(0,0,0,0)";b.data.canvasContainer=c.createElement("div");var f=b.data.canvasContainer.style;b.data.canvasContainer.style[d]=e,f.position="relative",f.zIndex="0",f.overflow="hidden";var g=a.cy.container();g.appendChild(b.data.canvasContainer),g.style[d]=e;for(var h={"-webkit-user-select":"none","-moz-user-select":"-moz-none","user-select":"none","-webkit-tap-highlight-color":"rgba(0,0,0,0)","outline-style":"none"},i=0;i<B_.CANVAS_LAYERS;i++){var j=b.data.canvases[i]=c.createElement("canvas"),k=B_.CANVAS_TYPES[i];b.data.contexts[i]=j.getContext(k),b.data.contexts[i]||sm("Could not create canvas of type "+k),Object.keys(h).forEach(function(a){j.style[a]=h[a]}),j.style.position="absolute",j.setAttribute("data-id","layer"+i),j.style.zIndex=String(B_.CANVAS_LAYERS-i),b.data.canvasContainer.appendChild(j),b.data.canvasNeedsRedraw[i]=!1}b.data.topCanvas=b.data.canvases[0],b.data.canvases[B_.NODE].setAttribute("data-id","layer"+B_.NODE+"-node"),b.data.canvases[B_.SELECT_BOX].setAttribute("data-id","layer"+B_.SELECT_BOX+"-selectbox"),b.data.canvases[B_.DRAG].setAttribute("data-id","layer"+B_.DRAG+"-drag"),b.data.canvases[B_.WEBGL]&&b.data.canvases[B_.WEBGL].setAttribute("data-id","layer"+B_.WEBGL+"-webgl");for(var i=0;i<B_.BUFFER_COUNT;i++)b.data.bufferCanvases[i]=c.createElement("canvas"),b.data.bufferContexts[i]=b.data.bufferCanvases[i].getContext("2d"),b.data.bufferCanvases[i].style.position="absolute",b.data.bufferCanvases[i].setAttribute("data-id","buffer"+i),b.data.bufferCanvases[i].style.zIndex=String(-i-1),b.data.bufferCanvases[i].style.visibility="hidden";b.pathsEnabled=!0;var l=s5(),n=function(a){return{x:-a.w/2,y:-a.h/2}},o=function(a){return a[0]._private.nodeKey},p=function(a){return a[0]._private.labelStyleKey},q=function(a){return a[0]._private.sourceLabelStyleKey},r=function(a){return a[0]._private.targetLabelStyleKey},s=function(a,c,d,e,f){return b.drawElement(a,c,d,!1,!1,f)},t=function(a,c,d,e,f){return b.drawElementText(a,c,d,e,"main",f)},u=function(a,c,d,e,f){return b.drawElementText(a,c,d,e,"source",f)},v=function(a,c,d,e,f){return b.drawElementText(a,c,d,e,"target",f)},w=function(a){return a.boundingBox(),a[0]._private.bodyBounds},x=function(a){return a.boundingBox(),a[0]._private.labelBounds.main||l},y=function(a){return a.boundingBox(),a[0]._private.labelBounds.source||l},z=function(a){return a.boundingBox(),a[0]._private.labelBounds.target||l},A=function(a,b){return b},B=function(a){var b;return{x:((b=w(a)).x1+b.x2)/2,y:(b.y1+b.y2)/2}},C=function(a,b,c){var d=a?a+"-":"";return{x:b.x+c.pstyle(d+"text-margin-x").pfValue,y:b.y+c.pstyle(d+"text-margin-y").pfValue}},D=function(a,b,c){var d=a[0]._private.rscratch;return{x:d[b],y:d[c]}},E=function(a){return C("",D(a,"labelX","labelY"),a)},F=function(a){return C("source",D(a,"sourceLabelX","sourceLabelY"),a)},G=function(a){return C("target",D(a,"targetLabelX","targetLabelY"),a)},H=function(a){return n(w(a))},I=function(a){return n(y(a))},J=function(a){return n(z(a))},K=function(a){var b=x(a),c=n(x(a));if(a.isNode()){switch(a.pstyle("text-halign").value){case"left":c.x=-b.w-(b.leftPad||0);break;case"right":c.x=-(b.rightPad||0)}switch(a.pstyle("text-valign").value){case"top":c.y=-b.h-(b.topPad||0);break;case"bottom":c.y=-(b.botPad||0)}}return c},L=b.data.eleTxrCache=new A_(b,{getKey:o,doesEleInvalidateKey:function(a){var b=a[0]._private;return b.oldBackgroundTimestamp!==b.backgroundTimestamp},drawElement:s,getBoundingBox:w,getRotationPoint:B,getRotationOffset:H,allowEdgeTxrCaching:!1,allowParentTxrCaching:!1}),M=b.data.lblTxrCache=new A_(b,{getKey:p,drawElement:t,getBoundingBox:x,getRotationPoint:E,getRotationOffset:K,isVisible:A}),N=b.data.slbTxrCache=new A_(b,{getKey:q,drawElement:u,getBoundingBox:y,getRotationPoint:F,getRotationOffset:I,isVisible:A}),O=b.data.tlbTxrCache=new A_(b,{getKey:r,drawElement:v,getBoundingBox:z,getRotationPoint:G,getRotationOffset:J,isVisible:A}),P=b.data.lyrTxrCache=new A1(b);b.onUpdateEleCalcs(function(a,b){L.invalidateElements(b),M.invalidateElements(b),N.invalidateElements(b),O.invalidateElements(b),P.invalidateElements(b);for(var c=0;c<b.length;c++){var d=b[c]._private;d.oldBackgroundTimestamp=d.backgroundTimestamp}});var Q=function(a){for(var b=0;b<a.length;b++)P.enqueueElementRefinement(a[b].ele)};L.onDequeue(Q),M.onDequeue(Q),N.onDequeue(Q),O.onDequeue(Q),a.webgl&&b.initWebgl(a,{getStyleKey:o,getLabelKey:p,getSourceLabelKey:q,getTargetLabelKey:r,drawElement:s,drawLabel:t,drawSourceLabel:u,drawTargetLabel:v,getElementBox:w,getLabelBox:x,getSourceLabelBox:y,getTargetLabelBox:z,getElementRotationPoint:B,getElementRotationOffset:H,getLabelRotationPoint:E,getSourceLabelRotationPoint:F,getTargetLabelRotationPoint:G,getLabelRotationOffset:K,getSourceLabelRotationOffset:I,getTargetLabelRotationOffset:J})}B_.CANVAS_LAYERS=3,B_.SELECT_BOX=0,B_.DRAG=1,B_.NODE=2,B_.WEBGL=3,B_.CANVAS_TYPES=["2d","2d","2d","webgl2"],B_.BUFFER_COUNT=3,B_.TEXTURE_BUFFER=0,B_.MOTIONBLUR_BUFFER_NODE=1,B_.MOTIONBLUR_BUFFER_DRAG=2,B_.redrawHint=function(a,b){switch(a){case"eles":this.data.canvasNeedsRedraw[B_.NODE]=b;break;case"drag":this.data.canvasNeedsRedraw[B_.DRAG]=b;break;case"select":this.data.canvasNeedsRedraw[B_.SELECT_BOX]=b;break;case"gc":this.data.gc=!0}};var B1="undefined"!=typeof Path2D;B_.path2dEnabled=function(a){if(void 0===a)return this.pathsEnabled;this.pathsEnabled=!!a},B_.usePaths=function(){return B1&&this.pathsEnabled},B_.setImgSmoothing=function(a,b){null!=a.imageSmoothingEnabled?a.imageSmoothingEnabled=b:(a.webkitImageSmoothingEnabled=b,a.mozImageSmoothingEnabled=b,a.msImageSmoothingEnabled=b)},B_.getImgSmoothing=function(a){return null!=a.imageSmoothingEnabled?a.imageSmoothingEnabled:a.webkitImageSmoothingEnabled||a.mozImageSmoothingEnabled||a.msImageSmoothingEnabled},B_.makeOffscreenCanvas=function(a,b){var c;return("undefined"==typeof OffscreenCanvas?"undefined":ri(OffscreenCanvas))!=="undefined"?c=new OffscreenCanvas(a,b):((c=this.cy.window().document.createElement("canvas")).width=a,c.height=b),c},[A4,Ba,Bh,Bj,Bk,Bm,Bo,BL,BS,BX,B$].forEach(function(a){rO(B_,a)});var B2=[{name:"null",impl:xC},{name:"base",impl:AU},{name:"canvas",impl:B0}],B3={},B4={};function B5(a,b,c){var d=c,e=function(c){so("Can not register `"+b+"` for `"+a+"` since `"+c+"` already exists in the prototype and can not be overridden")};if("core"===a)if(wZ.prototype[b])return e(b);else wZ.prototype[b]=c;else if("collection"===a)if(wu.prototype[b])return e(b);else wu.prototype[b]=c;else if("layout"===a){for(var f=function(a){this.options=a,c.call(this,a),rs(this._private)||(this._private={}),this._private.cy=a.cy,this._private.listeners=[],this.createEmitter()},g=f.prototype=Object.create(c.prototype),h=[],i=0;i<h.length;i++){var j=h[i];g[j]=g[j]||function(){return this}}g.start&&!g.run?g.run=function(){return this.start(),this}:!g.start&&g.run&&(g.start=function(){return this.run(),this});var k=c.prototype.stop;g.stop=function(){var a=this.options;if(a&&a.animate){var b=this.animations;if(b)for(var c=0;c<b.length;c++)b[c].stop()}return k?k.call(this):this.emit("layoutstop"),this},g.destroy||(g.destroy=function(){return this}),g.cy=function(){return this._private.cy};var l=function(a){return a._private.cy},n={addEventFields:function(a,b){b.layout=a,b.cy=l(a),b.target=a},bubble:function(){return!0},parent:function(a){return l(a)}};rO(g,{createEmitter:function(){return this._private.emitter=new v0(n,this),this},emitter:function(){return this._private.emitter},on:function(a,b){return this.emitter().on(a,b),this},one:function(a,b){return this.emitter().one(a,b),this},once:function(a,b){return this.emitter().one(a,b),this},removeListener:function(a,b){return this.emitter().removeListener(a,b),this},removeAllListeners:function(){return this.emitter().removeAllListeners(),this},emit:function(a,b){return this.emitter().emit(a,b),this}}),u3.eventAliasesOn(g),d=f}else if("renderer"===a&&"null"!==b&&"base"!==b){var o=B6("renderer","base"),p=o.prototype,q=c.prototype,r=function(){o.apply(this,arguments),c.apply(this,arguments)},s=r.prototype;for(var t in p){var u=p[t];if(null!=q[t])return e(t);s[t]=u}for(var v in q)s[v]=q[v];p.clientFunctions.forEach(function(a){s[a]=s[a]||function(){sm("Renderer does not implement `renderer."+a+"()` on its prototype")}}),d=r}else if("__proto__"===a||"constructor"===a||"prototype"===a)return sm(a+" is an illegal type to be registered, possibly lead to prototype pollutions");return rU({map:B3,keys:[a,b],value:d})}function B6(a,b){return rV({map:B3,keys:[a,b]})}function B7(a,b,c,d,e){return rU({map:B4,keys:[a,b,c,d],value:e})}function B8(a,b,c,d){return rV({map:B4,keys:[a,b,c,d]})}var B9=function(){return 2==arguments.length?B6.apply(null,arguments):3==arguments.length?B5.apply(null,arguments):4==arguments.length?B8.apply(null,arguments):5==arguments.length?B7.apply(null,arguments):void sm("Invalid extension access syntax")};wZ.prototype.extension=B9,[{type:"layout",extensions:xB},{type:"renderer",extensions:B2}].forEach(function(a){a.extensions.forEach(function(b){B5(a.type,b.name,b.impl)})});var Ca=function(){if(!(this instanceof Ca))return new Ca;this.length=0},Cb=Ca.prototype;Cb.instanceString=function(){return"stylesheet"},Cb.selector=function(a){return this[this.length++]={selector:a,properties:[]},this},Cb.css=function(a,b){var c=this.length-1;if(rp(a))this[c].properties.push({name:a,value:b});else if(rs(a))for(var d=Object.keys(a),e=0;e<d.length;e++){var f=d[e],g=a[f];if(null!=g){var h=wV.properties[f]||wV.properties[rE(f)];if(null!=h){var i=h.name;this[c].properties.push({name:i,value:g})}}}return this},Cb.style=Cb.css,Cb.generateStyle=function(a){var b=new wV(a);return this.appendToStyle(b)},Cb.appendToStyle=function(a){for(var b=0;b<this.length;b++){var c=this[b],d=c.selector,e=c.properties;a.selector(d);for(var f=0;f<e.length;f++){var g=e[f];a.css(g.name,g.value)}}return a};var Cc=function(a){return(void 0===a&&(a={}),rs(a))?new wZ(a):rp(a)?B9.apply(B9,arguments):void 0};function Cd({data:a}){let b=(0,u.useRef)(null),c=(0,u.useRef)(null);return(0,u.useEffect)(()=>{if(!b.current)return;let a=Cc({container:b.current,elements:[{data:{id:"1",label:"Validation",type:"operator",entropy:50},classes:"operator high-entropy"},{data:{id:"2",label:"Temporal",type:"operator",entropy:45.8},classes:"operator high-entropy"},{data:{id:"3",label:"Geographic",type:"operator",entropy:40},classes:"operator high-entropy"},{data:{id:"4",label:"Batch",type:"operator",entropy:32.9},classes:"operator medium-entropy"},{data:{id:"5",label:"Threshold",type:"operator",entropy:26.6},classes:"operator medium-entropy"},{data:{id:"6",label:"Cascading",type:"operator",entropy:20.4},classes:"operator low-entropy"},{data:{id:"7",label:"Complex",type:"operator",entropy:14.2},classes:"operator low-entropy"},{data:{id:"8",label:"Deterministic",type:"operator",entropy:8},classes:"operator very-low-entropy"},{data:{id:"jtbd1",label:"Order Fulfillment",type:"jtbd"},classes:"jtbd"},{data:{id:"jtbd2",label:"Recurring Purchase",type:"jtbd"},classes:"jtbd"},{data:{id:"jtbd3",label:"Listing Compliance",type:"jtbd"},classes:"jtbd"},{data:{id:"jtbd5",label:"Address Validation",type:"jtbd"},classes:"jtbd"},{data:{id:"jtbd6",label:"Bulk Updates",type:"jtbd"},classes:"jtbd"},{data:{id:"before-add",label:"before-add",type:"trigger"},classes:"trigger"},{data:{id:"after-add",label:"after-add",type:"trigger"},classes:"trigger"},{data:{id:"on-interval",label:"on-interval",type:"trigger"},classes:"trigger"},{data:{source:"1",target:"2",type:"flow",weight:4.2}},{data:{source:"2",target:"3",type:"flow",weight:5.8}},{data:{source:"3",target:"4",type:"flow",weight:7.1}},{data:{source:"4",target:"5",type:"flow",weight:6.3}},{data:{source:"5",target:"6",type:"flow",weight:5.9}},{data:{source:"6",target:"7",type:"flow",weight:6.2}},{data:{source:"7",target:"8",type:"flow",weight:5.4}},{data:{source:"jtbd1",target:"1",type:"uses"}},{data:{source:"jtbd2",target:"2",type:"uses"}},{data:{source:"jtbd3",target:"1",type:"uses"}},{data:{source:"jtbd5",target:"3",type:"uses"}},{data:{source:"jtbd6",target:"4",type:"uses"}},{data:{source:"before-add",target:"1",type:"triggers"}},{data:{source:"before-add",target:"3",type:"triggers"}},{data:{source:"after-add",target:"7",type:"triggers"}},{data:{source:"on-interval",target:"2",type:"triggers"}}],style:[{selector:"node",style:{"background-color":"#1e293b","border-color":"#cbd5e1","border-width":2,"text-valign":"center","text-halign":"center","font-size":12,color:"#e2e8f0",padding:"8px","min-zoomed-font-size":8}},{selector:"node.operator",style:{shape:"round-rectangle",width:70,height:50,"font-weight":"bold",color:"#06b6d4"}},{selector:"node.operator.high-entropy",style:{"background-color":"#ea580c","border-color":"#f97316",color:"#ffffff"}},{selector:"node.operator.medium-entropy",style:{"background-color":"#d97706","border-color":"#f59e0b",color:"#ffffff"}},{selector:"node.operator.low-entropy",style:{"background-color":"#dc2626","border-color":"#ef4444",color:"#ffffff"}},{selector:"node.operator.very-low-entropy",style:{"background-color":"#7c3aed","border-color":"#a78bfa",color:"#ffffff"}},{selector:"node.jtbd",style:{shape:"square",width:60,height:60,"background-color":"#0369a1","border-color":"#0ea5e9",color:"#e0f2fe","font-size":10}},{selector:"node.trigger",style:{shape:"diamond",width:50,height:50,"background-color":"#059669","border-color":"#10b981",color:"#d1fae5","font-size":9}},{selector:"edge",style:{"line-color":"#64748b","target-arrow-color":"#64748b","target-arrow-shape":"triangle","arrow-scale":1.2,"curve-style":"bezier",width:1.5}},{selector:'edge[type="flow"]',style:{"line-color":"#a855f7","target-arrow-color":"#a855f7",width:2}},{selector:'edge[type="uses"]',style:{"line-color":"#0ea5e9","target-arrow-color":"#0ea5e9",width:1.5,"line-style":"dashed"}},{selector:'edge[type="triggers"]',style:{"line-color":"#10b981","target-arrow-color":"#10b981",width:1.5,"line-style":"dotted"}},{selector:":selected",style:{"background-color":"#06b6d4","border-color":"#00d9ff","border-width":3,"line-color":"#06b6d4","target-arrow-color":"#06b6d4"}},{selector:":hover",style:{"background-color":"#22d3ee","border-color":"#06f","border-width":3}}],layout:{name:"cose",directed:!0,roots:"#1",animate:!0,animationDuration:500,avoidOverlap:!0,nodeSpacing:10,gravity:-30,cooling:.99,coolingFactor:.999,initialTemp:1e3,nestingFactor:1.2,repulsiveStrength:100,attractiveStrength:1,edgeElasticity:100,randomize:!1}});return c.current=a,a.on("tap","node",a=>{console.log("Selected:",a.target.data())}),a.on("mouseover","node",a=>{a.target.style("overlay-opacity",.2)}),a.on("mouseout","node",a=>{a.target.style("overlay-opacity",0)}),a.fit(),()=>{a.destroy()}},[a]),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-cyan-400",children:"Knowledge Hook Graph"}),(0,t.jsx)("p",{className:"text-sm text-slate-400",children:"Interactive visualization of (O) operator chains, JTBD scenarios, and trigger mappings. Purple edges show information flow; blue dashed edges show JTBD usage; green dotted edges show trigger associations."})]}),(0,t.jsx)("div",{className:"card h-96 rounded border border-slate-700 overflow-hidden bg-slate-950",ref:b}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{className:"bg-slate-900/50 border border-slate-700 rounded p-4 space-y-3",children:[(0,t.jsx)("div",{className:"font-semibold text-cyan-400",children:"Operators (Nodes)"}),(0,t.jsxs)("div",{className:"space-y-2 text-xs text-slate-300",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-4 h-4 bg-orange-500 rounded"}),(0,t.jsx)("span",{children:"High Entropy (-): 50  32.9 nats"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-4 h-4 bg-amber-600 rounded"}),(0,t.jsx)("span",{children:"Medium Entropy (): 26.6 nats"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-4 h-4 bg-red-600 rounded"}),(0,t.jsx)("span",{children:"Low Entropy (-): 20.4  14.2 nats"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-4 h-4 bg-purple-600 rounded"}),(0,t.jsx)("span",{children:"Deterministic (): 8.0 nats"})]})]})]}),(0,t.jsxs)("div",{className:"bg-slate-900/50 border border-slate-700 rounded p-4 space-y-3",children:[(0,t.jsx)("div",{className:"font-semibold text-cyan-400",children:"JTBD Scenarios"}),(0,t.jsxs)("div",{className:"space-y-2 text-xs text-slate-300",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-4 h-4 bg-cyan-600 rounded"}),(0,t.jsx)("span",{children:"Job To Be Done scenarios"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-4 h-4 bg-green-600 rounded"}),(0,t.jsx)("span",{children:"Hook Triggers (before-add, after-add, on-interval)"})]})]})]}),(0,t.jsxs)("div",{className:"bg-slate-900/50 border border-slate-700 rounded p-4 space-y-3",children:[(0,t.jsx)("div",{className:"font-semibold text-cyan-400",children:"Edge Types"}),(0,t.jsxs)("div",{className:"space-y-2 text-xs text-slate-300",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-6 h-0.5 bg-purple-500"}),(0,t.jsx)("span",{children:"Information Flow"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-6 h-0.5 bg-cyan-500",style:{borderTop:"1px dashed"}}),(0,t.jsx)("span",{children:"JTBD Usage"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"w-6 h-0.5 bg-green-500",style:{borderTop:"1px dotted"}}),(0,t.jsx)("span",{children:"Trigger Association"})]})]})]})]}),(0,t.jsxs)("div",{className:"bg-slate-800/50 rounded-lg p-4 space-y-3",children:[(0,t.jsx)("div",{className:"font-semibold text-cyan-400",children:"Graph Insights"}),(0,t.jsxs)("ul",{className:"space-y-2 text-sm text-slate-300",children:[(0,t.jsxs)("li",{className:"flex gap-2",children:[(0,t.jsx)("span",{className:"inline-block w-1.5 h-1.5 rounded-full bg-cyan-400 mt-1 flex-shrink-0"}),(0,t.jsx)("span",{children:"Operators form a deterministic chain: user intent (50 nats)  observable outcome (1 nat)"})]}),(0,t.jsxs)("li",{className:"flex gap-2",children:[(0,t.jsx)("span",{className:"inline-block w-1.5 h-1.5 rounded-full bg-purple-400 mt-1 flex-shrink-0"}),(0,t.jsx)("span",{children:"5 JTBD scenarios depend on validators (, ) and batch processor ()"})]}),(0,t.jsxs)("li",{className:"flex gap-2",children:[(0,t.jsx)("span",{className:"inline-block w-1.5 h-1.5 rounded-full bg-green-400 mt-1 flex-shrink-0"}),(0,t.jsx)("span",{children:"Three hook triggers activate different operators: before-add, after-add, on-interval"})]}),(0,t.jsxs)("li",{className:"flex gap-2",children:[(0,t.jsx)("span",{className:"inline-block w-1.5 h-1.5 rounded-full bg-orange-400 mt-1 flex-shrink-0"}),(0,t.jsx)("span",{children:"Click nodes to inspect details; use mouse to pan and zoom"})]})]})]})]})}Cc.use=function(a){var b=Array.prototype.slice.call(arguments,1);return b.unshift(Cc),a.apply(null,b),this},Cc.warnings=function(a){return sn(a)},Cc.version="3.33.1",Cc.stylesheet=Cc.Stylesheet=Ca;let Ce=[{id:"knowledge-hooks-c4-context",title:"Knowledge Hooks - C4 Context",description:"System context diagram showing knowledge hooks architecture",category:"Architecture",content:`@startuml knowledge-hooks-c4-context
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Context.puml

LAYOUT_WITH_LEGEND()

title Knowledge Hooks - C4 Context Diagram

Person(user, "User", "Creates intents and observes outcomes")
System(kh, "Knowledge Hooks Engine", "Transforms intent to outcome through (O) operators")
System_Ext(rdf, "RDF Store", "Persists ontologies and quads")

Rel(user, kh, "Executes hooks")
Rel(kh, rdf, "Reads/writes")

@enduml`},{id:"knowledge-hooks-sequence",title:"Knowledge Hooks - Execution Sequence",description:"Sequence diagram showing hook execution flow",category:"Flow",content:`@startuml knowledge-hooks-sequence
title Knowledge Hooks - Execution Sequence

participant User as user
participant "Hook Manager" as hm
participant "Executor" as ex
participant "(O) Operators" as op
participant "Store" as store

user -> hm: executeByTrigger(trigger, quad)
hm -> hm: findHooksByTrigger()
hm -> ex: compiledChain(hooks)
ex -> op: validate(quad)
op -> op: reduce entropy
ex -> store: updateQuad()
store --> ex: success
ex --> hm: result
hm --> user: outcome

@enduml`},{id:"hook-execution-flow",title:"Hook Execution Flow",description:"Detailed flow of hook execution with error handling",category:"Flow",content:`@startuml hook-execution-flow
title Hook Execution Flow

start
:Receive trigger + quad;
:Validate hook schema;
if (Valid?) then (no)
  :Return error;
  stop
else (yes)
  :Find matching hooks;
  if (Found?) then (no)
    :Return noop;
    stop
  else (yes)
    :Execute hook chain;
    if (Has validation?) then (yes)
      :Run validate();
      if (Valid?) then (no)
        :Log failure;
        :Return invalid;
        stop
      else (yes)
      endif
    endif
    if (Has transform?) then (yes)
      :Run transform();
      if (Successful?) then (no)
        :Log error;
        :Return error;
        stop
      else (yes)
      endif
    endif
    :Persist changes;
    :Return success;
    stop
  endif
endif
end

@enduml`},{id:"operator-chain-entropy",title:"(O) Operator Chain - Entropy Reduction",description:"Shows 8-operator chain with entropy reduction (501 nats)",category:"Operators",content:`@startuml operator-chain-entropy
title (O) Calculus: Operator Chain Entropy Reduction

skinparam backgroundColor #1e293b
skinparam ArrowColor #a855f7
skinparam ClassBackgroundColor #ea580c
skinparam ClassBorderColor #f97316

class 1 {
  **Validation**
  Entropy: 50  45.8
  Reduction: 4.2 nats
  Trigger: before-add
}

class 2 {
  **Temporal**
  Entropy: 45.8  40.0
  Reduction: 5.8 nats
  Trigger: on-interval
}

class 3 {
  **Geographic**
  Entropy: 40.0  32.9
  Reduction: 7.1 nats
  Trigger: before-add
}

class 4 {
  **Batch**
  Entropy: 32.9  26.6
  Reduction: 6.3 nats
  Trigger: before-add
}

class 5 {
  **Threshold**
  Entropy: 26.6  20.4
  Reduction: 5.9 nats
  Trigger: on-interval
}

class 6 {
  **Cascading**
  Entropy: 20.4  14.2
  Reduction: 6.2 nats
  Trigger: after-add
}

class 7 {
  **Complex**
  Entropy: 14.2  8.0
  Reduction: 5.4 nats
  Trigger: before-add
}

class 8 {
  **Deterministic**
  Entropy: 8.0  1.0
  Reduction: 0.1 nats
  Trigger: after-add
}

1 --> 2
2 --> 3
3 --> 4
4 --> 5
5 --> 6
6 --> 7
7 --> 8

@enduml`},{id:"federation-protocol",title:"Federation Protocol",description:"Multi-agent federation and consensus protocol",category:"Protocol",content:`@startuml federation-protocol
title Knowledge Hooks - Federation Protocol

participant "Agent A" as a
participant "Federation Manager" as fm
participant "Agent B" as b
participant "Agent C" as c

a -> fm: propose(change)
fm -> b: broadcast(change)
fm -> c: broadcast(change)
b -> b: validate()
c -> c: validate()
b -> fm: vote(yes)
c -> fm: vote(yes)
fm -> fm: consensus check
fm -> a: commit(change)
fm -> b: commit(change)
fm -> c: commit(change)

@enduml`},{id:"raft-consensus",title:"Raft Consensus Protocol",description:"Leader election and log replication in Raft",category:"Protocol",content:`@startuml raft-consensus
title Raft Consensus - Leader Election

state Follower
state Candidate
state Leader

[*] --> Follower

Follower --> Candidate: election timeout\\nincrement term\\nvote for self
Candidate --> Follower: receive higher term
Candidate --> Leader: receive majority votes\\nbecome leader
Leader --> Follower: receive higher term\\nstep down
Follower --> [*]

note right of Leader
  - Send heartbeats
  - Replicate log entries
  - Commit entries
end note

@enduml`},{id:"swarm-coordination",title:"Swarm Coordination",description:"Multi-agent swarm topology and task distribution",category:"Architecture",content:`@startuml swarm-coordination
title Knowledge Hooks - Swarm Coordination

skinparam BackgroundColor #1e293b

package "Coordinator" {
  [Task Orchestrator]
  [Load Balancer]
}

package "Agent Pool" {
  [Agent 1]
  [Agent 2]
  [Agent 3]
  [Agent 4]
}

package "Shared State" {
  database "Memory" as mem
  database "Store" as store
}

[Task Orchestrator] --> [Load Balancer]
[Load Balancer] --> [Agent 1]
[Load Balancer] --> [Agent 2]
[Load Balancer] --> [Agent 3]
[Load Balancer] --> [Agent 4]

[Agent 1] --> mem
[Agent 2] --> mem
[Agent 3] --> mem
[Agent 4] --> mem

[Agent 1] --> store
[Agent 2] --> store
[Agent 3] --> store
[Agent 4] --> store

@enduml`}];function Cf({data:a}){let[b,c]=(0,u.useState)(Ce[0]),[d,e]=(0,u.useState)("All"),f=(0,u.useRef)(null),g=["All",...new Set(Ce.map(a=>a.category))],h="All"===d?Ce:Ce.filter(a=>a.category===d);return(0,u.useEffect)(()=>{if(f.current&&b){f.current.innerHTML="";let a=document.createElement("pre");a.className="bg-slate-900 text-slate-300 p-4 rounded text-xs overflow-auto max-h-96",a.textContent=b.content,f.current.appendChild(a)}},[b]),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-cyan-400",children:"Architecture & Design Diagrams"}),(0,t.jsx)("p",{className:"text-sm text-slate-400",children:"PlantUML diagrams showing knowledge hooks architecture, execution flows, federation protocols, and consensus mechanisms."})]}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2",children:g.map(a=>(0,t.jsx)("button",{onClick:()=>e(a),className:`px-4 py-2 rounded text-sm font-medium transition-colors ${d===a?"bg-cyan-500 text-slate-900":"bg-slate-800 text-slate-400 hover:text-slate-200 border border-slate-700"}`,children:a},a))}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("h4",{className:"text-sm font-semibold text-slate-300",children:["Diagrams (",h.length,")"]}),(0,t.jsx)("div",{className:"space-y-2 max-h-96 overflow-y-auto border border-slate-700 rounded p-3 bg-slate-900/50",children:h.map(a=>(0,t.jsxs)("button",{onClick:()=>c(a),className:`w-full text-left px-3 py-2 rounded text-sm transition-colors ${b.id===a.id?"bg-cyan-900/50 border border-cyan-500 text-cyan-300":"border border-slate-700 text-slate-300 hover:bg-slate-800"}`,children:[(0,t.jsx)("div",{className:"font-semibold",children:a.title}),(0,t.jsx)("div",{className:"text-xs text-slate-500",children:a.category})]},a.id))})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"bg-slate-900/50 border border-slate-700 rounded p-4",children:[(0,t.jsx)("h4",{className:"text-sm font-semibold text-cyan-400 mb-2",children:b.title}),(0,t.jsx)("p",{className:"text-xs text-slate-400 mb-3",children:b.description}),(0,t.jsx)("div",{ref:f,className:"bg-slate-950 rounded border border-slate-700 p-3 min-h-64 overflow-auto"})]}),(0,t.jsxs)("div",{className:"bg-slate-900/50 border border-slate-700 rounded p-3 text-xs text-slate-400",children:[(0,t.jsx)("div",{className:"font-semibold text-cyan-400 mb-1",children:"PlantUML Format"}),(0,t.jsx)("div",{children:"Diagrams show architecture, flows, protocols, and operator chains"})]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,t.jsxs)("div",{className:"bg-slate-900/50 border border-slate-700 rounded p-4",children:[(0,t.jsx)("div",{className:"text-xs text-slate-400 uppercase",children:"Total Diagrams"}),(0,t.jsx)("div",{className:"text-2xl font-bold text-cyan-400 mt-1",children:Ce.length})]}),(0,t.jsxs)("div",{className:"bg-slate-900/50 border border-slate-700 rounded p-4",children:[(0,t.jsx)("div",{className:"text-xs text-slate-400 uppercase",children:"Categories"}),(0,t.jsx)("div",{className:"text-2xl font-bold text-cyan-400 mt-1",children:g.length-1})]}),(0,t.jsxs)("div",{className:"bg-slate-900/50 border border-slate-700 rounded p-4",children:[(0,t.jsx)("div",{className:"text-xs text-slate-400 uppercase",children:"Operators"}),(0,t.jsx)("div",{className:"text-2xl font-bold text-cyan-400 mt-1",children:"8 (-)"})]}),(0,t.jsxs)("div",{className:"bg-slate-900/50 border border-slate-700 rounded p-4",children:[(0,t.jsx)("div",{className:"text-xs text-slate-400 uppercase",children:"Entropy Reduction"}),(0,t.jsx)("div",{className:"text-2xl font-bold text-cyan-400 mt-1",children:"50  1"})]})]}),(0,t.jsxs)("div",{className:"card space-y-3",children:[(0,t.jsx)("h4",{className:"font-semibold text-cyan-400",children:"Knowledge Hooks System Overview"}),(0,t.jsxs)("ul",{className:"space-y-2 text-sm text-slate-300",children:[(0,t.jsxs)("li",{className:"flex gap-2",children:[(0,t.jsx)("span",{className:"inline-block w-1.5 h-1.5 rounded-full bg-orange-400 mt-1.5 flex-shrink-0"}),(0,t.jsxs)("span",{children:[(0,t.jsx)("strong",{children:"Architecture:"})," C4 context diagrams showing system boundaries and interactions"]})]}),(0,t.jsxs)("li",{className:"flex gap-2",children:[(0,t.jsx)("span",{className:"inline-block w-1.5 h-1.5 rounded-full bg-purple-400 mt-1.5 flex-shrink-0"}),(0,t.jsxs)("span",{children:[(0,t.jsx)("strong",{children:"Flows:"})," Execution sequences showing hook validation, transformation, and persistence"]})]}),(0,t.jsxs)("li",{className:"flex gap-2",children:[(0,t.jsx)("span",{className:"inline-block w-1.5 h-1.5 rounded-full bg-cyan-400 mt-1.5 flex-shrink-0"}),(0,t.jsxs)("span",{children:[(0,t.jsx)("strong",{children:"Operators:"})," 8-stage operator chain (-) with entropy reduction from 50 to 1 nats"]})]}),(0,t.jsxs)("li",{className:"flex gap-2",children:[(0,t.jsx)("span",{className:"inline-block w-1.5 h-1.5 rounded-full bg-green-400 mt-1.5 flex-shrink-0"}),(0,t.jsxs)("span",{children:[(0,t.jsx)("strong",{children:"Protocols:"})," Federation, Raft consensus, and swarm coordination for distributed execution"]})]})]})]}),(0,t.jsxs)("div",{className:"bg-slate-800/50 rounded-lg p-4 space-y-2 text-xs text-slate-400",children:[(0,t.jsx)("div",{className:"font-semibold text-slate-300",children:"PlantUML Diagram Sources"}),(0,t.jsxs)("div",{children:["Diagrams sourced from: ",(0,t.jsx)("code",{children:"/docs/diagrams/*.puml"})," including knowledge hooks architecture, execution flows, federation protocols, RAFT consensus, and distributed system coordination patterns."]}),(0,t.jsxs)("div",{className:"mt-2",children:[(0,t.jsx)("strong",{children:"Note:"})," For full PlantUML rendering in production, integrate with plantuml.com API or @mermaid-js/mermaid-cli for server-side SVG generation."]})]})]})}let Cg=(0,v.default)(async()=>{},{loadableGenerated:{modules:[35392]},ssr:!1,loading:()=>(0,t.jsx)("div",{className:"card h-96 flex items-center justify-center",children:(0,t.jsx)("div",{className:"text-slate-400",children:"Loading 3D visualization..."})})});function Ch(){let[a,b]=(0,u.useState)("overview"),c=(0,u.useMemo)(()=>({singleOperator:{latency:.853,range:[.742,.964],unit:"s"},eightOperatorChain:{latency:6.824,range:[5.891,7.756],unit:"s"},throughput:{opsPerSec:117e4,description:"Sustained throughput across all operators"},informationProcessing:{rate:8.4,perOperator:"1.05M",totalPerChain:"8.4M",unit:"nats/sec"},entropyReduction:{initial:50,final:1,reductionRate:.0588,stages:[{operator:"",reduction:4.2,entropy:"50  45.8"},{operator:"",reduction:5.8,entropy:"45.8  40.0"},{operator:"",reduction:7.1,entropy:"40.0  32.9"},{operator:"",reduction:6.3,entropy:"32.9  26.6"},{operator:"",reduction:5.9,entropy:"26.6  20.4"},{operator:"",reduction:6.2,entropy:"20.4  14.2"},{operator:"",reduction:5.4,entropy:"14.2  8.0"},{operator:"",reduction:.1,entropy:"8.0  1.0"}]},fmea:{totalFailureModes:51,riskReduction:86,categories:6,topRisks:[{id:"FM-001",name:"Silent Error Swallowing",before:504,after:50},{id:"FM-002",name:"Audit Log Unbounded Growth",before:448,after:45},{id:"FM-003",name:"Scheduler Error Swallowing",before:432,after:43},{id:"FM-004",name:"Hook Validation Timeout",before:384,after:38},{id:"FM-005",name:"Async Hook Silent Failure",before:336,after:34}]},jtbd:[{id:"JTBD-1",name:"Order Fulfillment",latency:2.53,reduction:48.2},{id:"JTBD-2",name:"Recurring Purchase",latency:3.12,reduction:47.1},{id:"JTBD-3",name:"Listing Compliance",latency:2.89,reduction:49.4},{id:"JTBD-5",name:"Address Validation",latency:1.87,reduction:46.8},{id:"JTBD-6",name:"Bulk Updates",latency:18.4,reduction:49.1},{id:"JTBD-7",name:"Change Notifications",latency:2.91,reduction:48.3},{id:"JTBD-8",name:"Account Consistency",latency:3.45,reduction:49}]}),[]);return(0,t.jsxs)("div",{className:"space-y-8",children:[(0,t.jsxs)("div",{className:"bg-gradient-to-r from-slate-800 to-slate-900 border border-slate-700 rounded-lg p-8 space-y-4",children:[(0,t.jsx)("h2",{className:"text-3xl font-bold text-cyan-400",children:"Knowledge Hook Performance Analysis"}),(0,t.jsx)("p",{className:"text-slate-300 max-w-2xl",children:"Interactive visualization of (O) calculus research findings demonstrating deterministic intent-to-outcome transformation with 8 information-theoretic operators achieving 1.17M operations per second with entropy reduction from 50 to 1 nat."}),(0,t.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-6",children:[(0,t.jsxs)("div",{className:"bg-slate-900/50 border border-slate-700 rounded p-3",children:[(0,t.jsx)("div",{className:"text-xs text-slate-400 uppercase",children:"Single Op"}),(0,t.jsx)("div",{className:"text-xl font-bold text-cyan-400",children:"0.853 s"})]}),(0,t.jsxs)("div",{className:"bg-slate-900/50 border border-slate-700 rounded p-3",children:[(0,t.jsx)("div",{className:"text-xs text-slate-400 uppercase",children:"8-Op Chain"}),(0,t.jsx)("div",{className:"text-xl font-bold text-cyan-400",children:"6.82 s"})]}),(0,t.jsxs)("div",{className:"bg-slate-900/50 border border-slate-700 rounded p-3",children:[(0,t.jsx)("div",{className:"text-xs text-slate-400 uppercase",children:"Throughput"}),(0,t.jsx)("div",{className:"text-xl font-bold text-cyan-400",children:"1.17M ops/s"})]}),(0,t.jsxs)("div",{className:"bg-slate-900/50 border border-slate-700 rounded p-3",children:[(0,t.jsx)("div",{className:"text-xs text-slate-400 uppercase",children:"Entropy "}),(0,t.jsx)("div",{className:"text-xl font-bold text-cyan-400",children:"50  1 nat"})]})]})]}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("div",{className:"flex flex-wrap gap-2 bg-slate-900 border border-slate-800 rounded-lg p-1",children:[{id:"overview",label:"Overview"},{id:"performance",label:"Performance"},{id:"entropy",label:"Entropy"},{id:"entropy3d",label:"3D View"},{id:"knowledge-graph",label:"Knowledge Graph"},{id:"diagrams",label:"Diagrams"},{id:"geospatial",label:"Geospatial"},{id:"fmea",label:"FMEA"},{id:"jtbd",label:"JTBD"},{id:"operators",label:"Operators"}].map(c=>(0,t.jsx)("button",{onClick:()=>b(c.id),className:`px-4 py-2 rounded text-sm font-medium transition-colors ${a===c.id?"bg-cyan-500 text-slate-900":"text-slate-400 hover:text-slate-200"}`,children:c.label},c.id))}),(0,t.jsxs)("div",{className:"space-y-6",children:["overview"===a&&(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,t.jsx)(eH,{data:c}),(0,t.jsx)(eJ,{data:c})]}),"performance"===a&&(0,t.jsx)(eH,{data:c,detailed:!0}),"entropy"===a&&(0,t.jsx)(eI,{data:c}),"entropy3d"===a&&(0,t.jsx)(Cg,{data:c}),"knowledge-graph"===a&&(0,t.jsx)(Cd,{data:c}),"diagrams"===a&&(0,t.jsx)(Cf,{data:c}),"geospatial"===a&&(0,t.jsx)(q9,{data:c}),"fmea"===a&&(0,t.jsx)(eK,{data:c}),"jtbd"===a&&(0,t.jsx)(eL,{data:c}),"operators"===a&&(0,t.jsx)(eM,{data:c})]})]})]})}a.s(["default",()=>Ch],98409)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__3fa5be0f._.js.map