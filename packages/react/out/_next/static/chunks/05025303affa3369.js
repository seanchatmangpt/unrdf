(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,93494,(e,t,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),Object.defineProperty(i,"BailoutToCSR",{enumerable:!0,get:function(){return n}});let r=e.r(54586);function n({reason:e,children:t}){if("undefined"==typeof window)throw Object.defineProperty(new r.BailoutToCSRError(e),"__NEXT_ERROR_CODE",{value:"E394",enumerable:!1,configurable:!0});return t}},11683,(e,t,i)=>{"use strict";function r(e){return e.split("/").map(e=>encodeURIComponent(e)).join("/")}Object.defineProperty(i,"__esModule",{value:!0}),Object.defineProperty(i,"encodeURIPath",{enumerable:!0,get:function(){return r}})},55755,(e,t,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),Object.defineProperty(i,"PreloadChunks",{enumerable:!0,get:function(){return o}});let r=e.r(18197),n=e.r(23789),a=e.r(21038),s=e.r(11683);function o({moduleIds:e}){if("undefined"!=typeof window)return null;let t=a.workAsyncStorage.getStore();if(void 0===t)return null;let i=[];if(t.reactLoadableManifest&&e){let r=t.reactLoadableManifest;for(let t of e){if(!r[t])continue;let e=r[t].files;i.push(...e)}}return 0===i.length?null:(0,r.jsx)(r.Fragment,{children:i.map(e=>{let i=`${t.assetPrefix}/_next/${(0,s.encodeURIPath)(e)}`;return e.endsWith(".css")?(0,r.jsx)("link",{precedence:"dynamic",href:i,rel:"stylesheet",as:"style",nonce:t.nonce},e):((0,n.preload)(i,{as:"script",fetchPriority:"low",nonce:t.nonce}),null)})})}},119,(e,t,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),Object.defineProperty(i,"default",{enumerable:!0,get:function(){return c}});let r=e.r(18197),n=e.r(89343),a=e.r(93494),s=e.r(55755);function o(e){return{default:e&&"default"in e?e.default:e}}let l={loader:()=>Promise.resolve(o(()=>null)),loading:null,ssr:!0},c=function(e){let t={...l,...e},i=(0,n.lazy)(()=>t.loader().then(o)),c=t.loading;function u(e){let o=c?(0,r.jsx)(c,{isLoading:!0,pastDelay:!0,error:null}):null,l=!t.ssr||!!t.loading,u=l?n.Suspense:n.Fragment,h=t.ssr?(0,r.jsxs)(r.Fragment,{children:["undefined"==typeof window?(0,r.jsx)(s.PreloadChunks,{moduleIds:t.modules}):null,(0,r.jsx)(i,{...e})]}):(0,r.jsx)(a.BailoutToCSR,{reason:"next/dynamic",children:(0,r.jsx)(i,{...e})});return(0,r.jsx)(u,{...l?{fallback:o}:{},children:h})}return u.displayName="LoadableComponent",u}},97082,(e,t,i)=>{"use strict";Object.defineProperty(i,"__esModule",{value:!0}),Object.defineProperty(i,"default",{enumerable:!0,get:function(){return n}});let r=e.r(92940)._(e.r(119));function n(e,t){let i={};"function"==typeof e&&(i.loader=e);let n={...i,...t};return(0,r.default)({...n,modules:n.loadableGenerated?.modules})}("function"==typeof i.default||"object"==typeof i.default&&null!==i.default)&&void 0===i.default.__esModule&&(Object.defineProperty(i.default,"__esModule",{value:!0}),Object.assign(i.default,i),t.exports=i.default)},66074,e=>{"use strict";let t,i,r,n,a,s,o,l,c,u;var h,d,f,p,g,v,y,b=e.i(18197),x=e.i(89343),_=e.i(97082);function w(e){return e+.5|0}let k=(e,t,i)=>Math.max(Math.min(e,i),t);function E(e){return k(w(2.55*e),0,255)}function T(e){return k(w(255*e),0,255)}function P(e){return k(w(e/2.55)/100,0,1)}function S(e){return k(w(100*e),0,100)}let M={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},C=[..."0123456789ABCDEF"],A=e=>C[15&e],I=e=>C[(240&e)>>4]+C[15&e],L=e=>(240&e)>>4==(15&e),D=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function O(e,t,i){let r=t*Math.min(i,1-i),n=(t,n=(t+e/30)%12)=>i-r*Math.max(Math.min(n-3,9-n,1),-1);return[n(0),n(8),n(4)]}function R(e,t,i){let r=(r,n=(r+e/60)%6)=>i-i*t*Math.max(Math.min(n,4-n,1),0);return[r(5),r(3),r(1)]}function N(e,t,i){let r,n=O(e,1,.5);for(t+i>1&&(r=1/(t+i),t*=r,i*=r),r=0;r<3;r++)n[r]*=1-t-i,n[r]+=t;return n}function j(e){let t,i,r,n=e.r/255,a=e.g/255,s=e.b/255,o=Math.max(n,a,s),l=Math.min(n,a,s),c=(o+l)/2;o!==l&&(r=o-l,i=c>.5?r/(2-o-l):r/(o+l),t=60*(t=n===o?(a-s)/r+6*(a<s):a===o?(s-n)/r+2:(n-a)/r+4)+.5);return[0|t,i||0,c]}function B(e,t,i,r){return(Array.isArray(t)?e(t[0],t[1],t[2]):e(t,i,r)).map(T)}function F(e){return(e%360+360)%360}let z={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},V={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"},U=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/,$=e=>e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055,W=e=>e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4);function H(e,t,i){if(e){let r=j(e);r[t]=Math.max(0,Math.min(r[t]+r[t]*i,0===t?360:1)),e.r=(r=B(O,r,void 0,void 0))[0],e.g=r[1],e.b=r[2]}}function q(e,t){return e?Object.assign(t||{},e):e}function G(e){var t={r:0,g:0,b:0,a:255};return Array.isArray(e)?e.length>=3&&(t={r:e[0],g:e[1],b:e[2],a:255},e.length>3&&(t.a=T(e[3]))):(t=q(e,{r:0,g:0,b:0,a:1})).a=T(t.a),t}class Y{constructor(e){let i;if(e instanceof Y)return e;const r=typeof e;"object"===r?i=G(e):"string"===r&&(i=function(e){var t,i=e.length;return"#"===e[0]&&(4===i||5===i?t={r:255&17*M[e[1]],g:255&17*M[e[2]],b:255&17*M[e[3]],a:5===i?17*M[e[4]]:255}:(7===i||9===i)&&(t={r:M[e[1]]<<4|M[e[2]],g:M[e[3]]<<4|M[e[4]],b:M[e[5]]<<4|M[e[6]],a:9===i?M[e[7]]<<4|M[e[8]]:255})),t}(e)||function(e){t||((t=function(){let e,t,i,r,n,a={},s=Object.keys(V),o=Object.keys(z);for(e=0;e<s.length;e++){for(t=0,r=n=s[e];t<o.length;t++)i=o[t],n=n.replace(i,z[i]);i=parseInt(V[r],16),a[n]=[i>>16&255,i>>8&255,255&i]}return a}()).transparent=[0,0,0,0]);let i=t[e.toLowerCase()];return i&&{r:i[0],g:i[1],b:i[2],a:4===i.length?i[3]:255}}(e)||function(e){return"r"===e.charAt(0)?function(e){let t,i,r,n=U.exec(e),a=255;if(n){if(n[7]!==t){let e=+n[7];a=n[8]?E(e):k(255*e,0,255)}return t=+n[1],i=+n[3],r=+n[5],t=255&(n[2]?E(t):k(t,0,255)),{r:t,g:i=255&(n[4]?E(i):k(i,0,255)),b:r=255&(n[6]?E(r):k(r,0,255)),a:a}}}(e):function(e){let t,i=D.exec(e),r=255;if(!i)return;i[5]!==t&&(r=i[6]?E(+i[5]):T(+i[5]));let n=F(+i[2]),a=i[3]/100,s=i[4]/100;return{r:(t="hwb"===i[1]?B(N,n,a,s):"hsv"===i[1]?B(R,n,a,s):B(O,n,a,s))[0],g:t[1],b:t[2],a:r}}(e)}(e)),this._rgb=i,this._valid=!!i}get valid(){return this._valid}get rgb(){var e=q(this._rgb);return e&&(e.a=P(e.a)),e}set rgb(e){this._rgb=G(e)}rgbString(){var e;return this._valid?(e=this._rgb)&&(e.a<255?`rgba(${e.r}, ${e.g}, ${e.b}, ${P(e.a)})`:`rgb(${e.r}, ${e.g}, ${e.b})`):void 0}hexString(){var e,t;let i,r;return this._valid?(t=L((i=e=this._rgb).r)&&L(i.g)&&L(i.b)&&L(i.a)?A:I,e?"#"+t(e.r)+t(e.g)+t(e.b)+(r=e.a,r<255?t(r):""):void 0):void 0}hslString(){return this._valid?function(e){if(!e)return;let t=j(e),i=t[0],r=S(t[1]),n=S(t[2]);return e.a<255?`hsla(${i}, ${r}%, ${n}%, ${P(e.a)})`:`hsl(${i}, ${r}%, ${n}%)`}(this._rgb):void 0}mix(e,t){if(e){let i,r=this.rgb,n=e.rgb,a=t===i?.5:t,s=2*a-1,o=r.a-n.a,l=((s*o==-1?s:(s+o)/(1+s*o))+1)/2;i=1-l,r.r=255&l*r.r+i*n.r+.5,r.g=255&l*r.g+i*n.g+.5,r.b=255&l*r.b+i*n.b+.5,r.a=a*r.a+(1-a)*n.a,this.rgb=r}return this}interpolate(e,t){var i,r;let n,a,s;return e&&(this._rgb=(i=this._rgb,r=e._rgb,n=W(P(i.r)),a=W(P(i.g)),s=W(P(i.b)),{r:T($(n+t*(W(P(r.r))-n))),g:T($(a+t*(W(P(r.g))-a))),b:T($(s+t*(W(P(r.b))-s))),a:i.a+t*(r.a-i.a)})),this}clone(){return new Y(this.rgb)}alpha(e){return this._rgb.a=T(e),this}clearer(e){let t=this._rgb;return t.a*=1-e,this}greyscale(){let e=this._rgb,t=w(.3*e.r+.59*e.g+.11*e.b);return e.r=e.g=e.b=t,this}opaquer(e){let t=this._rgb;return t.a*=1+e,this}negate(){let e=this._rgb;return e.r=255-e.r,e.g=255-e.g,e.b=255-e.b,this}lighten(e){return H(this._rgb,2,e),this}darken(e){return H(this._rgb,2,-e),this}saturate(e){return H(this._rgb,1,e),this}desaturate(e){return H(this._rgb,1,-e),this}rotate(e){var t,i;return t=this._rgb,(i=j(t))[0]=F(i[0]+e),t.r=(i=B(O,i,void 0,void 0))[0],t.g=i[1],t.b=i[2],this}}function X(){}let K=(s=0,()=>s++);function Z(e){return null==e}function J(e){if(Array.isArray&&Array.isArray(e))return!0;let t=Object.prototype.toString.call(e);return"[object"===t.slice(0,7)&&"Array]"===t.slice(-6)}function Q(e){return null!==e&&"[object Object]"===Object.prototype.toString.call(e)}function ee(e){return("number"==typeof e||e instanceof Number)&&isFinite(+e)}function et(e,t){return ee(e)?e:t}function ei(e,t){return void 0===e?t:e}let er=(e,t)=>"string"==typeof e&&e.endsWith("%")?parseFloat(e)/100*t:+e;function en(e,t,i){if(e&&"function"==typeof e.call)return e.apply(i,t)}function ea(e,t,i,r){let n,a,s;if(J(e))if(a=e.length,r)for(n=a-1;n>=0;n--)t.call(i,e[n],n);else for(n=0;n<a;n++)t.call(i,e[n],n);else if(Q(e))for(n=0,a=(s=Object.keys(e)).length;n<a;n++)t.call(i,e[s[n]],s[n])}function es(e,t){let i,r,n,a;if(!e||!t||e.length!==t.length)return!1;for(i=0,r=e.length;i<r;++i)if(n=e[i],a=t[i],n.datasetIndex!==a.datasetIndex||n.index!==a.index)return!1;return!0}function eo(e){if(J(e))return e.map(eo);if(Q(e)){let t=Object.create(null),i=Object.keys(e),r=i.length,n=0;for(;n<r;++n)t[i[n]]=eo(e[i[n]]);return t}return e}function el(e){return -1===["__proto__","prototype","constructor"].indexOf(e)}function ec(e,t,i,r){if(!el(e))return;let n=t[e],a=i[e];Q(n)&&Q(a)?eu(n,a,r):t[e]=eo(a)}function eu(e,t,i){let r,n=J(t)?t:[t],a=n.length;if(!Q(e))return e;let s=(i=i||{}).merger||ec;for(let t=0;t<a;++t){if(!Q(r=n[t]))continue;let a=Object.keys(r);for(let t=0,n=a.length;t<n;++t)s(a[t],e,r,i)}return e}function eh(e,t){return eu(e,t,{merger:ed})}function ed(e,t,i){if(!el(e))return;let r=t[e],n=i[e];Q(r)&&Q(n)?eh(r,n):Object.prototype.hasOwnProperty.call(t,e)||(t[e]=eo(n))}let ef={"":e=>e,x:e=>e.x,y:e=>e.y};function ep(e,t){let i;return(ef[t]||(ef[t]=(i=function(e){let t=e.split("."),i=[],r="";for(let e of t)(r+=e).endsWith("\\")?r=r.slice(0,-1)+".":(i.push(r),r="");return i}(t),e=>{for(let t of i){if(""===t)break;e=e&&e[t]}return e})))(e)}function eg(e){return e.charAt(0).toUpperCase()+e.slice(1)}let em=e=>void 0!==e,ev=e=>"function"==typeof e,ey=(e,t)=>{if(e.size!==t.size)return!1;for(let i of e)if(!t.has(i))return!1;return!0},eb=Math.PI,ex=2*eb,e_=ex+eb,ew=1/0,ek=eb/180,eE=eb/2,eT=eb/4,eP=2*eb/3,eS=Math.log10,eM=Math.sign;function eC(e,t,i){return Math.abs(e-t)<i}function eA(e){let t=Math.round(e),i=Math.pow(10,Math.floor(eS(e=eC(e,t,e/1e3)?t:e))),r=e/i;return(r<=1?1:r<=2?2:r<=5?5:10)*i}function eI(e){return"symbol"!=typeof e&&("object"!=typeof e||null===e||!!(Symbol.toPrimitive in e||"toString"in e||"valueOf"in e))&&!isNaN(parseFloat(e))&&isFinite(e)}function eL(e,t,i){let r,n,a;for(r=0,n=e.length;r<n;r++)isNaN(a=e[r][i])||(t.min=Math.min(t.min,a),t.max=Math.max(t.max,a))}function eD(e){return eb/180*e}function eO(e){if(!ee(e))return;let t=1,i=0;for(;Math.round(e*t)/t!==e;)t*=10,i++;return i}function eR(e,t){let i=t.x-e.x,r=t.y-e.y,n=Math.sqrt(i*i+r*r),a=Math.atan2(r,i);return a<-.5*eb&&(a+=ex),{angle:a,distance:n}}function eN(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function ej(e,t){return(e-t+e_)%ex-eb}function eB(e){return(e%ex+ex)%ex}function eF(e,t,i,r){let n=eB(e),a=eB(t),s=eB(i),o=eB(a-n),l=eB(s-n),c=eB(n-a),u=eB(n-s);return n===a||n===s||r&&a===s||o>l&&c<u}function ez(e,t,i){return Math.max(t,Math.min(i,e))}function eV(e,t,i,r=1e-6){return e>=Math.min(t,i)-r&&e<=Math.max(t,i)+r}function eU(e,t,i){let r;i=i||(i=>e[i]<t);let n=e.length-1,a=0;for(;n-a>1;)i(r=a+n>>1)?a=r:n=r;return{lo:a,hi:n}}let e$=(e,t,i,r)=>eU(e,i,r?r=>{let n=e[r][t];return n<i||n===i&&e[r+1][t]===i}:r=>e[r][t]<i),eW=(e,t,i)=>eU(e,i,r=>e[r][t]>=i),eH=["push","pop","shift","splice","unshift"];function eq(e,t){let i=e._chartjs;if(!i)return;let r=i.listeners,n=r.indexOf(t);-1!==n&&r.splice(n,1),r.length>0||(eH.forEach(t=>{delete e[t]}),delete e._chartjs)}function eG(e){let t=new Set(e);return t.size===e.length?e:Array.from(t)}let eY="undefined"==typeof window?function(e){return e()}:window.requestAnimationFrame;function eX(e,t){let i=[],r=!1;return function(...n){i=n,r||(r=!0,eY.call(window,()=>{r=!1,e.apply(t,i)}))}}let eK=e=>"start"===e?"left":"end"===e?"right":"center",eZ=(e,t,i)=>"start"===e?t:"end"===e?i:(t+i)/2;function eJ(e,t,i){let r=t.length,n=0,a=r;if(e._sorted){let{iScale:s,vScale:o,_parsed:l}=e,c=e.dataset&&e.dataset.options?e.dataset.options.spanGaps:null,u=s.axis,{min:h,max:d,minDefined:f,maxDefined:p}=s.getUserBounds();if(f){if(n=Math.min(e$(l,u,h).lo,i?r:e$(t,u,s.getPixelForValue(h)).lo),c){let e=l.slice(0,n+1).reverse().findIndex(e=>!Z(e[o.axis]));n-=Math.max(0,e)}n=ez(n,0,r-1)}if(p){let e=Math.max(e$(l,s.axis,d,!0).hi+1,i?0:e$(t,u,s.getPixelForValue(d),!0).hi+1);if(c){let t=l.slice(e-1).findIndex(e=>!Z(e[o.axis]));e+=Math.max(0,t)}a=ez(e,n,r)-n}else a=r-n}return{start:n,count:a}}function eQ(e){let{xScale:t,yScale:i,_scaleRanges:r}=e,n={xmin:t.min,xmax:t.max,ymin:i.min,ymax:i.max};if(!r)return e._scaleRanges=n,!0;let a=r.xmin!==t.min||r.xmax!==t.max||r.ymin!==i.min||r.ymax!==i.max;return Object.assign(r,n),a}let e0=e=>0===e||1===e,e1=(e,t,i)=>-(Math.pow(2,10*(e-=1))*Math.sin((e-t)*ex/i)),e2=(e,t,i)=>Math.pow(2,-10*e)*Math.sin((e-t)*ex/i)+1,e3={linear:e=>e,easeInQuad:e=>e*e,easeOutQuad:e=>-e*(e-2),easeInOutQuad:e=>(e/=.5)<1?.5*e*e:-.5*(--e*(e-2)-1),easeInCubic:e=>e*e*e,easeOutCubic:e=>(e-=1)*e*e+1,easeInOutCubic:e=>(e/=.5)<1?.5*e*e*e:.5*((e-=2)*e*e+2),easeInQuart:e=>e*e*e*e,easeOutQuart:e=>-((e-=1)*e*e*e-1),easeInOutQuart:e=>(e/=.5)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2),easeInQuint:e=>e*e*e*e*e,easeOutQuint:e=>(e-=1)*e*e*e*e+1,easeInOutQuint:e=>(e/=.5)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2),easeInSine:e=>-Math.cos(e*eE)+1,easeOutSine:e=>Math.sin(e*eE),easeInOutSine:e=>-.5*(Math.cos(eb*e)-1),easeInExpo:e=>0===e?0:Math.pow(2,10*(e-1)),easeOutExpo:e=>1===e?1:-Math.pow(2,-10*e)+1,easeInOutExpo:e=>e0(e)?e:e<.5?.5*Math.pow(2,10*(2*e-1)):.5*(-Math.pow(2,-10*(2*e-1))+2),easeInCirc:e=>e>=1?e:-(Math.sqrt(1-e*e)-1),easeOutCirc:e=>Math.sqrt(1-(e-=1)*e),easeInOutCirc:e=>(e/=.5)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1),easeInElastic:e=>e0(e)?e:e1(e,.075,.3),easeOutElastic:e=>e0(e)?e:e2(e,.075,.3),easeInOutElastic:e=>e0(e)?e:e<.5?.5*e1(2*e,.1125,.45):.5+.5*e2(2*e-1,.1125,.45),easeInBack:e=>e*e*(2.70158*e-1.70158),easeOutBack:e=>(e-=1)*e*(2.70158*e+1.70158)+1,easeInOutBack(e){let t=1.70158;return(e/=.5)<1?.5*(e*e*(((t*=1.525)+1)*e-t)):.5*((e-=2)*e*(((t*=1.525)+1)*e+t)+2)},easeInBounce:e=>1-e3.easeOutBounce(1-e),easeOutBounce:e=>e<.36363636363636365?7.5625*e*e:e<.7272727272727273?7.5625*(e-=.5454545454545454)*e+.75:e<.9090909090909091?7.5625*(e-=.8181818181818182)*e+.9375:7.5625*(e-=.9545454545454546)*e+.984375,easeInOutBounce:e=>e<.5?.5*e3.easeInBounce(2*e):.5*e3.easeOutBounce(2*e-1)+.5};function e4(e){if(e&&"object"==typeof e){let t=e.toString();return"[object CanvasPattern]"===t||"[object CanvasGradient]"===t}return!1}function e5(e){return e4(e)?e:new Y(e)}function e6(e){return e4(e)?e:new Y(e).saturate(.5).darken(.1).hexString()}let e8=["x","y","borderWidth","radius","tension"],e9=["color","borderColor","backgroundColor"],e7=new Map;function te(e,t,i){var r;let n,a;return(n=t+JSON.stringify(r=(r=i)||{}),!(a=e7.get(n))&&(a=new Intl.NumberFormat(t,r),e7.set(n,a)),a).format(e)}let tt={values:e=>J(e)?e:""+e,numeric(e,t,i){let r;if(0===e)return"0";let n=this.chart.options.locale,a=e;if(i.length>1){var s,o;let t,n=Math.max(Math.abs(i[0].value),Math.abs(i[i.length-1].value));(n<1e-4||n>1e15)&&(r="scientific"),s=e,Math.abs(t=(o=i).length>3?o[2].value-o[1].value:o[1].value-o[0].value)>=1&&s!==Math.floor(s)&&(t=s-Math.floor(s)),a=t}let l=eS(Math.abs(a)),c=isNaN(l)?1:Math.max(Math.min(-1*Math.floor(l),20),0),u={notation:r,minimumFractionDigits:c,maximumFractionDigits:c};return Object.assign(u,this.options.ticks.format),te(e,n,u)},logarithmic(e,t,i){return 0===e?"0":[1,2,3,5,10,15].includes(i[t].significand||e/Math.pow(10,Math.floor(eS(e))))||t>.8*i.length?tt.numeric.call(this,e,t,i):""}},ti=Object.create(null),tr=Object.create(null);function tn(e,t){if(!t)return e;let i=t.split(".");for(let t=0,r=i.length;t<r;++t){let r=i[t];e=e[r]||(e[r]=Object.create(null))}return e}function ta(e,t,i){return"string"==typeof t?eu(tn(e,t),i):eu(tn(e,""),t)}var ts=new class{constructor(e,t){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=e=>e.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(e,t)=>e6(t.backgroundColor),this.hoverBorderColor=(e,t)=>e6(t.borderColor),this.hoverColor=(e,t)=>e6(t.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(e),this.apply(t)}set(e,t){return ta(this,e,t)}get(e){return tn(this,e)}describe(e,t){return ta(tr,e,t)}override(e,t){return ta(ti,e,t)}route(e,t,i,r){let n=tn(this,e),a=tn(this,i),s="_"+t;Object.defineProperties(n,{[s]:{value:n[t],writable:!0},[t]:{enumerable:!0,get(){let e=this[s],t=a[r];return Q(e)?Object.assign({},t,e):ei(e,t)},set(e){this[s]=e}}})}apply(e){e.forEach(e=>e(this))}}({_scriptable:e=>!e.startsWith("on"),_indexable:e=>"events"!==e,hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[function(e){e.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),e.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:e=>"onProgress"!==e&&"onComplete"!==e&&"fn"!==e}),e.set("animations",{colors:{type:"color",properties:e9},numbers:{type:"number",properties:e8}}),e.describe("animations",{_fallback:"animation"}),e.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:e=>0|e}}}})},function(e){e.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})},function(e){e.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(e,t)=>t.lineWidth,tickColor:(e,t)=>t.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:tt.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),e.route("scale.ticks","color","","color"),e.route("scale.grid","color","","borderColor"),e.route("scale.border","color","","borderColor"),e.route("scale.title","color","","color"),e.describe("scale",{_fallback:!1,_scriptable:e=>!e.startsWith("before")&&!e.startsWith("after")&&"callback"!==e&&"parser"!==e,_indexable:e=>"borderDash"!==e&&"tickBorderDash"!==e&&"dash"!==e}),e.describe("scales",{_fallback:"scale"}),e.describe("scale.ticks",{_scriptable:e=>"backdropPadding"!==e&&"callback"!==e,_indexable:e=>"backdropPadding"!==e})}]);function to(e,t,i,r,n){let a=t[n];return a||(a=t[n]=e.measureText(n).width,i.push(n)),a>r&&(r=a),r}function tl(e,t,i){let r=e.currentDevicePixelRatio,n=0!==i?Math.max(i/2,.5):0;return Math.round((t-n)*r)/r+n}function tc(e,t){(t||e)&&((t=t||e.getContext("2d")).save(),t.resetTransform(),t.clearRect(0,0,e.width,e.height),t.restore())}function tu(e,t,i,r){th(e,t,i,r,null)}function th(e,t,i,r,n){let a,s,o,l,c,u,h,d,f=t.pointStyle,p=t.rotation,g=t.radius,v=(p||0)*ek;if(f&&"object"==typeof f&&("[object HTMLImageElement]"===(a=f.toString())||"[object HTMLCanvasElement]"===a)){e.save(),e.translate(i,r),e.rotate(v),e.drawImage(f,-f.width/2,-f.height/2,f.width,f.height),e.restore();return}if(!isNaN(g)&&!(g<=0)){switch(e.beginPath(),f){default:n?e.ellipse(i,r,n/2,g,0,0,ex):e.arc(i,r,g,0,ex),e.closePath();break;case"triangle":u=n?n/2:g,e.moveTo(i+Math.sin(v)*u,r-Math.cos(v)*g),v+=eP,e.lineTo(i+Math.sin(v)*u,r-Math.cos(v)*g),v+=eP,e.lineTo(i+Math.sin(v)*u,r-Math.cos(v)*g),e.closePath();break;case"rectRounded":c=.516*g,s=Math.cos(v+eT)*(l=g-c),h=Math.cos(v+eT)*(n?n/2-c:l),o=Math.sin(v+eT)*l,d=Math.sin(v+eT)*(n?n/2-c:l),e.arc(i-h,r-o,c,v-eb,v-eE),e.arc(i+d,r-s,c,v-eE,v),e.arc(i+h,r+o,c,v,v+eE),e.arc(i-d,r+s,c,v+eE,v+eb),e.closePath();break;case"rect":if(!p){l=Math.SQRT1_2*g,u=n?n/2:l,e.rect(i-u,r-l,2*u,2*l);break}v+=eT;case"rectRot":h=Math.cos(v)*(n?n/2:g),s=Math.cos(v)*g,o=Math.sin(v)*g,d=Math.sin(v)*(n?n/2:g),e.moveTo(i-h,r-o),e.lineTo(i+d,r-s),e.lineTo(i+h,r+o),e.lineTo(i-d,r+s),e.closePath();break;case"crossRot":v+=eT;case"cross":h=Math.cos(v)*(n?n/2:g),s=Math.cos(v)*g,o=Math.sin(v)*g,d=Math.sin(v)*(n?n/2:g),e.moveTo(i-h,r-o),e.lineTo(i+h,r+o),e.moveTo(i+d,r-s),e.lineTo(i-d,r+s);break;case"star":h=Math.cos(v)*(n?n/2:g),s=Math.cos(v)*g,o=Math.sin(v)*g,d=Math.sin(v)*(n?n/2:g),e.moveTo(i-h,r-o),e.lineTo(i+h,r+o),e.moveTo(i+d,r-s),e.lineTo(i-d,r+s),v+=eT,h=Math.cos(v)*(n?n/2:g),s=Math.cos(v)*g,o=Math.sin(v)*g,d=Math.sin(v)*(n?n/2:g),e.moveTo(i-h,r-o),e.lineTo(i+h,r+o),e.moveTo(i+d,r-s),e.lineTo(i-d,r+s);break;case"line":s=n?n/2:Math.cos(v)*g,o=Math.sin(v)*g,e.moveTo(i-s,r-o),e.lineTo(i+s,r+o);break;case"dash":e.moveTo(i,r),e.lineTo(i+Math.cos(v)*(n?n/2:g),r+Math.sin(v)*g);break;case!1:e.closePath()}e.fill(),t.borderWidth>0&&e.stroke()}}function td(e,t,i){return i=i||.5,!t||e&&e.x>t.left-i&&e.x<t.right+i&&e.y>t.top-i&&e.y<t.bottom+i}function tf(e,t){e.save(),e.beginPath(),e.rect(t.left,t.top,t.right-t.left,t.bottom-t.top),e.clip()}function tp(e){e.restore()}function tg(e,t,i,r,n){if(!t)return e.lineTo(i.x,i.y);if("middle"===n){let r=(t.x+i.x)/2;e.lineTo(r,t.y),e.lineTo(r,i.y)}else"after"===n!=!!r?e.lineTo(t.x,i.y):e.lineTo(i.x,t.y);e.lineTo(i.x,i.y)}function tm(e,t,i,r){if(!t)return e.lineTo(i.x,i.y);e.bezierCurveTo(r?t.cp1x:t.cp2x,r?t.cp1y:t.cp2y,r?i.cp2x:i.cp1x,r?i.cp2y:i.cp1y,i.x,i.y)}function tv(e,t,i,r,n,a={}){let s,o,l=J(t)?t:[t],c=a.strokeWidth>0&&""!==a.strokeColor;for(e.save(),e.font=n.string,a.translation&&e.translate(a.translation[0],a.translation[1]),Z(a.rotation)||e.rotate(a.rotation),a.color&&(e.fillStyle=a.color),a.textAlign&&(e.textAlign=a.textAlign),a.textBaseline&&(e.textBaseline=a.textBaseline),s=0;s<l.length;++s)o=l[s],a.backdrop&&function(e,t){let i=e.fillStyle;e.fillStyle=t.color,e.fillRect(t.left,t.top,t.width,t.height),e.fillStyle=i}(e,a.backdrop),c&&(a.strokeColor&&(e.strokeStyle=a.strokeColor),Z(a.strokeWidth)||(e.lineWidth=a.strokeWidth),e.strokeText(o,i,r,a.maxWidth)),e.fillText(o,i,r,a.maxWidth),function(e,t,i,r,n){if(n.strikethrough||n.underline){let a=e.measureText(r),s=t-a.actualBoundingBoxLeft,o=t+a.actualBoundingBoxRight,l=i-a.actualBoundingBoxAscent,c=i+a.actualBoundingBoxDescent,u=n.strikethrough?(l+c)/2:c;e.strokeStyle=e.fillStyle,e.beginPath(),e.lineWidth=n.decorationWidth||2,e.moveTo(s,u),e.lineTo(o,u),e.stroke()}}(e,i,r,o,a),r+=Number(n.lineHeight);e.restore()}function ty(e,t){let{x:i,y:r,w:n,h:a,radius:s}=t;e.arc(i+s.topLeft,r+s.topLeft,s.topLeft,1.5*eb,eb,!0),e.lineTo(i,r+a-s.bottomLeft),e.arc(i+s.bottomLeft,r+a-s.bottomLeft,s.bottomLeft,eb,eE,!0),e.lineTo(i+n-s.bottomRight,r+a),e.arc(i+n-s.bottomRight,r+a-s.bottomRight,s.bottomRight,eE,0,!0),e.lineTo(i+n,r+s.topRight),e.arc(i+n-s.topRight,r+s.topRight,s.topRight,0,-eE,!0),e.lineTo(i+s.topLeft,r)}let tb=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,tx=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/,t_=e=>+e||0;function tw(e,t){let i={},r=Q(t),n=r?Object.keys(t):t,a=Q(e)?r?i=>ei(e[i],e[t[i]]):t=>e[t]:()=>e;for(let e of n)i[e]=t_(a(e));return i}function tk(e){return tw(e,{top:"y",right:"x",bottom:"y",left:"x"})}function tE(e){return tw(e,["topLeft","topRight","bottomLeft","bottomRight"])}function tT(e){let t=tk(e);return t.width=t.left+t.right,t.height=t.top+t.bottom,t}function tP(e,t){e=e||{},t=t||ts.font;let i=ei(e.size,t.size);"string"==typeof i&&(i=parseInt(i,10));let r=ei(e.style,t.style);r&&!(""+r).match(tx)&&(console.warn('Invalid font style specified: "'+r+'"'),r=void 0);let n={family:ei(e.family,t.family),lineHeight:function(e,t){let i=(""+e).match(tb);if(!i||"normal"===i[1])return 1.2*t;switch(e=+i[2],i[3]){case"px":return e;case"%":e/=100}return t*e}(ei(e.lineHeight,t.lineHeight),i),size:i,style:r,weight:ei(e.weight,t.weight),string:""};return n.string=!n||Z(n.size)||Z(n.family)?null:(n.style?n.style+" ":"")+(n.weight?n.weight+" ":"")+n.size+"px "+n.family,n}function tS(e,t,i,r){let n,a,s,o=!0;for(n=0,a=e.length;n<a;++n)if(void 0!==(s=e[n])&&(void 0!==t&&"function"==typeof s&&(s=s(t),o=!1),void 0!==i&&J(s)&&(s=s[i%s.length],o=!1),void 0!==s))return r&&!o&&(r.cacheable=!1),s}function tM(e,t){return Object.assign(Object.create(e),t)}function tC(e,t=[""],i,r,n=()=>e[0]){let a=i||e;return void 0===r&&(r=tB("_fallback",e)),new Proxy({[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:e,_rootScopes:a,_fallback:r,_getTarget:n,override:i=>tC([i,...e],t,a,r)},{deleteProperty:(t,i)=>(delete t[i],delete t._keys,delete e[0][i],!0),get:(i,r)=>tO(i,r,()=>(function(e,t,i,r){let n;for(let a of t)if(void 0!==(n=tB(tL(a,e),i)))return tD(e,n)?tN(i,r,e,n):n})(r,t,e,i)),getOwnPropertyDescriptor:(e,t)=>Reflect.getOwnPropertyDescriptor(e._scopes[0],t),getPrototypeOf:()=>Reflect.getPrototypeOf(e[0]),has:(e,t)=>tF(e).includes(t),ownKeys:e=>tF(e),set(e,t,i){let r=e._storage||(e._storage=n());return e[t]=r[t]=i,delete e._keys,!0}})}function tA(e,t,i,r){return new Proxy({_cacheable:!1,_proxy:e,_context:t,_subProxy:i,_stack:new Set,_descriptors:tI(e,r),setContext:t=>tA(e,t,i,r),override:n=>tA(e.override(n),t,i,r)},{deleteProperty:(t,i)=>(delete t[i],delete e[i],!0),get:(e,t,i)=>tO(e,t,()=>(function(e,t,i){let{_proxy:r,_context:n,_subProxy:a,_descriptors:s}=e,o=r[t];return ev(o)&&s.isScriptable(t)&&(o=function(e,t,i,r){let{_proxy:n,_context:a,_subProxy:s,_stack:o}=i;if(o.has(e))throw Error("Recursion detected: "+Array.from(o).join("->")+"->"+e);o.add(e);let l=t(a,s||r);return o.delete(e),tD(e,l)&&(l=tN(n._scopes,n,e,l)),l}(t,o,e,i)),J(o)&&o.length&&(o=function(e,t,i,r){let{_proxy:n,_context:a,_subProxy:s,_descriptors:o}=i;if(void 0!==a.index&&r(e))return t[a.index%t.length];if(Q(t[0])){let i=t,r=n._scopes.filter(e=>e!==i);for(let l of(t=[],i)){let i=tN(r,n,e,l);t.push(tA(i,a,s&&s[e],o))}}return t}(t,o,e,s.isIndexable)),tD(t,o)&&(o=tA(o,n,a&&a[t],s)),o})(e,t,i)),getOwnPropertyDescriptor:(t,i)=>t._descriptors.allKeys?Reflect.has(e,i)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(e,i),getPrototypeOf:()=>Reflect.getPrototypeOf(e),has:(t,i)=>Reflect.has(e,i),ownKeys:()=>Reflect.ownKeys(e),set:(t,i,r)=>(e[i]=r,delete t[i],!0)})}function tI(e,t={scriptable:!0,indexable:!0}){let{_scriptable:i=t.scriptable,_indexable:r=t.indexable,_allKeys:n=t.allKeys}=e;return{allKeys:n,scriptable:i,indexable:r,isScriptable:ev(i)?i:()=>i,isIndexable:ev(r)?r:()=>r}}let tL=(e,t)=>e?e+eg(t):t,tD=(e,t)=>Q(t)&&"adapters"!==e&&(null===Object.getPrototypeOf(t)||t.constructor===Object);function tO(e,t,i){if(Object.prototype.hasOwnProperty.call(e,t)||"constructor"===t)return e[t];let r=i();return e[t]=r,r}let tR=(e,t)=>!0===e?t:"string"==typeof e?ep(t,e):void 0;function tN(e,t,i,r){var n;let a=t._rootScopes,s=(n=t._fallback,ev(n)?n(i,r):n),o=[...e,...a],l=new Set;l.add(r);let c=tj(l,o,i,s||i,r);return null!==c&&(void 0===s||s===i||null!==(c=tj(l,o,s,c,r)))&&tC(Array.from(l),[""],a,s,()=>{var e,n,a;let s,o;return e=t,n=i,a=r,n in(s=e._getTarget())||(s[n]={}),J(o=s[n])&&Q(a)?a:o||{}})}function tj(e,t,i,r,n){for(;i;)i=function(e,t,i,r,n){for(let s of t){let t=tR(i,s);if(t){var a;e.add(t);let s=(a=t._fallback,ev(a)?a(i,n):a);if(void 0!==s&&s!==i&&s!==r)return s}else if(!1===t&&void 0!==r&&i!==r)return null}return!1}(e,t,i,r,n);return i}function tB(e,t){for(let i of t){if(!i)continue;let t=i[e];if(void 0!==t)return t}}function tF(e){let t=e._keys;return t||(t=e._keys=function(e){let t=new Set;for(let i of e)for(let e of Object.keys(i).filter(e=>!e.startsWith("_")))t.add(e);return Array.from(t)}(e._scopes)),t}function tz(e,t,i,r){let n,a,s,{iScale:o}=e,{key:l="r"}=this._parsing,c=Array(r);for(n=0;n<r;++n)s=t[a=n+i],c[n]={r:o.parse(ep(s,l),a)};return c}let tV=Number.EPSILON||1e-14,tU=(e,t)=>t<e.length&&!e[t].skip&&e[t],t$=e=>"x"===e?"y":"x";function tW(e,t,i){return Math.max(Math.min(e,i),t)}function tH(){return"undefined"!=typeof window&&"undefined"!=typeof document}function tq(e){let t=e.parentNode;return t&&"[object ShadowRoot]"===t.toString()&&(t=t.host),t}function tG(e,t,i){let r;return"string"==typeof e?(r=parseInt(e,10),-1!==e.indexOf("%")&&(r=r/100*t.parentNode[i])):r=e,r}let tY=e=>e.ownerDocument.defaultView.getComputedStyle(e,null),tX=["top","right","bottom","left"];function tK(e,t,i){let r={};i=i?"-"+i:"";for(let n=0;n<4;n++){let a=tX[n];r[a]=parseFloat(e[t+"-"+a+i])||0}return r.width=r.left+r.right,r.height=r.top+r.bottom,r}function tZ(e,t){if("native"in e)return e;let{canvas:i,currentDevicePixelRatio:r}=t,n=tY(i),a="border-box"===n.boxSizing,s=tK(n,"padding"),o=tK(n,"border","width"),{x:l,y:c,box:u}=function(e,t){let i,r,n,a=e.touches,s=a&&a.length?a[0]:e,{offsetX:o,offsetY:l}=s,c=!1;if(n=e.target,(o>0||l>0)&&(!n||!n.shadowRoot))i=o,r=l;else{let e=t.getBoundingClientRect();i=s.clientX-e.left,r=s.clientY-e.top,c=!0}return{x:i,y:r,box:c}}(e,i),h=s.left+(u&&o.left),d=s.top+(u&&o.top),{width:f,height:p}=t;return a&&(f-=s.width+o.width,p-=s.height+o.height),{x:Math.round((l-h)/f*i.width/r),y:Math.round((c-d)/p*i.height/r)}}let tJ=e=>Math.round(10*e)/10;function tQ(e,t,i){let r=t||1,n=tJ(e.height*r),a=tJ(e.width*r);e.height=tJ(e.height),e.width=tJ(e.width);let s=e.canvas;return s.style&&(i||!s.style.height&&!s.style.width)&&(s.style.height=`${e.height}px`,s.style.width=`${e.width}px`),(e.currentDevicePixelRatio!==r||s.height!==n||s.width!==a)&&(e.currentDevicePixelRatio=r,s.height=n,s.width=a,e.ctx.setTransform(r,0,0,r,0,0),!0)}let t0=function(){let e=!1;try{let t={get passive(){return e=!0,!1}};tH()&&(window.addEventListener("test",null,t),window.removeEventListener("test",null,t))}catch(e){}return e}();function t1(e,t){let i=tY(e).getPropertyValue(t),r=i&&i.match(/^(\d+)(\.\d+)?px$/);return r?+r[1]:void 0}function t2(e,t,i,r){return{x:e.x+i*(t.x-e.x),y:e.y+i*(t.y-e.y)}}function t3(e,t,i,r){return{x:e.x+i*(t.x-e.x),y:"middle"===r?i<.5?e.y:t.y:"after"===r?i<1?e.y:t.y:i>0?t.y:e.y}}function t4(e,t,i,r){let n={x:e.cp2x,y:e.cp2y},a={x:t.cp1x,y:t.cp1y},s=t2(e,n,i),o=t2(n,a,i),l=t2(a,t,i),c=t2(s,o,i),u=t2(o,l,i);return t2(c,u,i)}function t5(e,t,i){var r;return e?(r=i,{x:e=>t+t+r-e,setWidth(e){r=e},textAlign:e=>"center"===e?e:"right"===e?"left":"right",xPlus:(e,t)=>e-t,leftForLtr:(e,t)=>e-t}):{x:e=>e,setWidth(e){},textAlign:e=>e,xPlus:(e,t)=>e+t,leftForLtr:(e,t)=>e}}function t6(e,t){let i,r;("ltr"===t||"rtl"===t)&&(r=[(i=e.canvas.style).getPropertyValue("direction"),i.getPropertyPriority("direction")],i.setProperty("direction",t,"important"),e.prevTextDirection=r)}function t8(e,t){void 0!==t&&(delete e.prevTextDirection,e.canvas.style.setProperty("direction",t[0],t[1]))}function t9(e){return"angle"===e?{between:eF,compare:ej,normalize:eB}:{between:eV,compare:(e,t)=>e-t,normalize:e=>e}}function t7({start:e,end:t,count:i,loop:r,style:n}){return{start:e%i,end:t%i,loop:r&&(t-e+1)%i==0,style:n}}function ie(e,t,i){let r,n,a;if(!i)return[e];let{property:s,start:o,end:l}=i,c=t.length,{compare:u,between:h,normalize:d}=t9(s),{start:f,end:p,loop:g,style:v}=function(e,t,i){let r,{property:n,start:a,end:s}=i,{between:o,normalize:l}=t9(n),c=t.length,{start:u,end:h,loop:d}=e;if(d){for(u+=c,h+=c,r=0;r<c&&o(l(t[u%c][n]),a,s);++r)u--,h--;u%=c,h%=c}return h<u&&(h+=c),{start:u,end:h,loop:d,style:e.style}}(e,t,i),y=[],b=!1,x=null,_=()=>b||h(o,a,r)&&0!==u(o,a),w=()=>!b||0===u(l,r)||h(l,a,r);for(let e=f,i=f;e<=p;++e)(n=t[e%c]).skip||(r=d(n[s]))!==a&&(b=h(r,o,l),null===x&&_()&&(x=0===u(r,o)?e:i),null!==x&&w()&&(y.push(t7({start:x,end:e,loop:g,count:c,style:v})),x=null),i=e,a=r);return null!==x&&y.push(t7({start:x,end:p,loop:g,count:c,style:v})),y}function it(e,t){let i=[],r=e.segments;for(let n=0;n<r.length;n++){let a=ie(r[n],e.points,t);a.length&&i.push(...a)}return i}function ii(e,t,i,r){return r&&r.setContext&&i?function(e,t,i,r){let n=e._chart.getContext(),a=ir(e.options),{_datasetIndex:s,options:{spanGaps:o}}=e,l=i.length,c=[],u=a,h=t[0].start,d=h;function f(e,t,r,n){let a=o?-1:1;if(e!==t){for(e+=l;i[e%l].skip;)e-=a;for(;i[t%l].skip;)t+=a;e%l!=t%l&&(c.push({start:e%l,end:t%l,loop:r,style:n}),u=n,h=t%l)}}for(let e of t){let t,a=i[(h=o?h:e.start)%l];for(d=h+1;d<=e.end;d++){let o=i[d%l];(function(e,t){if(!t)return!1;let i=[],r=function(e,t){return e4(t)?(i.includes(t)||i.push(t),i.indexOf(t)):t};return JSON.stringify(e,r)!==JSON.stringify(t,r)})(t=ir(r.setContext(tM(n,{type:"segment",p0:a,p1:o,p0DataIndex:(d-1)%l,p1DataIndex:d%l,datasetIndex:s}))),u)&&f(h,d-1,e.loop,u),a=o,u=t}h<d-1&&f(h,d-1,e.loop,u)}return c}(e,t,i,r):t}function ir(e){return{backgroundColor:e.backgroundColor,borderCapStyle:e.borderCapStyle,borderDash:e.borderDash,borderDashOffset:e.borderDashOffset,borderJoinStyle:e.borderJoinStyle,borderWidth:e.borderWidth,borderColor:e.borderColor}}function ia(e,t,i){return e.options.clip?e[i]:t[i]}function is(e,t){let i=t._clip;if(i.disabled)return!1;let r=function(e,t){let{xScale:i,yScale:r}=e;return i&&r?{left:ia(i,t,"left"),right:ia(i,t,"right"),top:ia(r,t,"top"),bottom:ia(r,t,"bottom")}:t}(t,e.chartArea);return{left:!1===i.left?0:r.left-(!0===i.left?0:i.left),right:!1===i.right?e.width:r.right+(!0===i.right?0:i.right),top:!1===i.top?0:r.top-(!0===i.top?0:i.top),bottom:!1===i.bottom?e.height:r.bottom+(!0===i.bottom?0:i.bottom)}}var io=new class{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(e,t,i,r){let n=t.listeners[r],a=t.duration;n.forEach(r=>r({chart:e,initial:t.initial,numSteps:a,currentStep:Math.min(i-t.start,a)}))}_refresh(){this._request||(this._running=!0,this._request=eY.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(e=Date.now()){let t=0;this._charts.forEach((i,r)=>{let n;if(!i.running||!i.items.length)return;let a=i.items,s=a.length-1,o=!1;for(;s>=0;--s)(n=a[s])._active?(n._total>i.duration&&(i.duration=n._total),n.tick(e),o=!0):(a[s]=a[a.length-1],a.pop());o&&(r.draw(),this._notify(r,i,e,"progress")),a.length||(i.running=!1,this._notify(r,i,e,"complete"),i.initial=!1),t+=a.length}),this._lastDate=e,0===t&&(this._running=!1)}_getAnims(e){let t=this._charts,i=t.get(e);return i||(i={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},t.set(e,i)),i}listen(e,t,i){this._getAnims(e).listeners[t].push(i)}add(e,t){t&&t.length&&this._getAnims(e).items.push(...t)}has(e){return this._getAnims(e).items.length>0}start(e){let t=this._charts.get(e);t&&(t.running=!0,t.start=Date.now(),t.duration=t.items.reduce((e,t)=>Math.max(e,t._duration),0),this._refresh())}running(e){if(!this._running)return!1;let t=this._charts.get(e);return!!t&&!!t.running&&!!t.items.length}stop(e){let t=this._charts.get(e);if(!t||!t.items.length)return;let i=t.items,r=i.length-1;for(;r>=0;--r)i[r].cancel();t.items=[],this._notify(e,t,Date.now(),"complete")}remove(e){return this._charts.delete(e)}};let il="transparent",ic={boolean:(e,t,i)=>i>.5?t:e,color(e,t,i){let r=e5(e||il),n=r.valid&&e5(t||il);return n&&n.valid?n.mix(r,i).hexString():t},number:(e,t,i)=>e+(t-e)*i};class iu{constructor(e,t,i,r){const n=t[i];r=tS([e.to,r,n,e.from]);const a=tS([e.from,n,r]);this._active=!0,this._fn=e.fn||ic[e.type||typeof a],this._easing=e3[e.easing]||e3.linear,this._start=Math.floor(Date.now()+(e.delay||0)),this._duration=this._total=Math.floor(e.duration),this._loop=!!e.loop,this._target=t,this._prop=i,this._from=a,this._to=r,this._promises=void 0}active(){return this._active}update(e,t,i){if(this._active){this._notify(!1);let r=this._target[this._prop],n=i-this._start,a=this._duration-n;this._start=i,this._duration=Math.floor(Math.max(a,e.duration)),this._total+=n,this._loop=!!e.loop,this._to=tS([e.to,t,r,e.from]),this._from=tS([e.from,r,t])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(e){let t,i=e-this._start,r=this._duration,n=this._prop,a=this._from,s=this._loop,o=this._to;if(this._active=a!==o&&(s||i<r),!this._active){this._target[n]=o,this._notify(!0);return}if(i<0){this._target[n]=a;return}t=i/r%2,t=s&&t>1?2-t:t,t=this._easing(Math.min(1,Math.max(0,t))),this._target[n]=this._fn(a,o,t)}wait(){let e=this._promises||(this._promises=[]);return new Promise((t,i)=>{e.push({res:t,rej:i})})}_notify(e){let t=e?"res":"rej",i=this._promises||[];for(let e=0;e<i.length;e++)i[e][t]()}}class ih{constructor(e,t){this._chart=e,this._properties=new Map,this.configure(t)}configure(e){if(!Q(e))return;let t=Object.keys(ts.animation),i=this._properties;Object.getOwnPropertyNames(e).forEach(r=>{let n=e[r];if(!Q(n))return;let a={};for(let e of t)a[e]=n[e];(J(n.properties)&&n.properties||[r]).forEach(e=>{e!==r&&i.has(e)||i.set(e,a)})})}_animateOptions(e,t){let i=t.options,r=function(e,t){if(!t)return;let i=e.options;if(!i){e.options=t;return}return i.$shared&&(e.options=i=Object.assign({},i,{$shared:!1,$animations:{}})),i}(e,i);if(!r)return[];let n=this._createAnimations(r,i);return i.$shared&&(function(e,t){let i=[],r=Object.keys(t);for(let t=0;t<r.length;t++){let n=e[r[t]];n&&n.active()&&i.push(n.wait())}return Promise.all(i)})(e.options.$animations,i).then(()=>{e.options=i},()=>{}),n}_createAnimations(e,t){let i,r=this._properties,n=[],a=e.$animations||(e.$animations={}),s=Object.keys(t),o=Date.now();for(i=s.length-1;i>=0;--i){let l=s[i];if("$"===l.charAt(0))continue;if("options"===l){n.push(...this._animateOptions(e,t));continue}let c=t[l],u=a[l],h=r.get(l);if(u)if(h&&u.active()){u.update(h,c,o);continue}else u.cancel();if(!h||!h.duration){e[l]=c;continue}a[l]=u=new iu(h,e,l,c),n.push(u)}return n}update(e,t){if(0===this._properties.size)return void Object.assign(e,t);let i=this._createAnimations(e,t);if(i.length)return io.add(this._chart,i),!0}}function id(e,t){let i=e&&e.options||{},r=i.reverse,n=void 0===i.min?t:0,a=void 0===i.max?t:0;return{start:r?a:n,end:r?n:a}}function ip(e,t){let i,r,n=[],a=e._getSortedDatasetMetas(t);for(i=0,r=a.length;i<r;++i)n.push(a[i].index);return n}function ig(e,t,i,r={}){let n,a,s,o,l=e.keys,c="single"===r.mode;if(null===t)return;let u=!1;for(n=0,a=l.length;n<a;++n){if((s=+l[n])===i){if(u=!0,r.all)continue;break}ee(o=e.values[s])&&(c||0===t||eM(t)===eM(o))&&(t+=o)}return u||r.all?t:0}function im(e,t){let i=e&&e.options.stacked;return i||void 0===i&&void 0!==t.stack}function iv(e,t,i,r){for(let n of t.getMatchingVisibleMetas(r).reverse()){let t=e[n.index];if(i&&t>0||!i&&t<0)return n.index}return null}function iy(e,t){let i,{chart:r,_cachedMeta:n}=e,a=r._stacks||(r._stacks={}),{iScale:s,vScale:o,index:l}=n,c=s.axis,u=o.axis,h=`${s.id}.${o.id}.${n.stack||n.type}`,d=t.length;for(let e=0;e<d;++e){let r=t[e],{[c]:s,[u]:d}=r;(i=(r._stacks||(r._stacks={}))[u]=function(e,t,i){let r=e[t]||(e[t]={});return r[i]||(r[i]={})}(a,h,s))[l]=d,i._top=iv(i,o,!0,n.type),i._bottom=iv(i,o,!1,n.type),(i._visualValues||(i._visualValues={}))[l]=d}}function ib(e,t){let i=e.scales;return Object.keys(i).filter(e=>i[e].axis===t).shift()}function ix(e,t){let i=e.controller.index,r=e.vScale&&e.vScale.axis;if(r)for(let n of t=t||e._parsed){let e=n._stacks;if(!e||void 0===e[r]||void 0===e[r][i])return;delete e[r][i],void 0!==e[r]._visualValues&&void 0!==e[r]._visualValues[i]&&delete e[r]._visualValues[i]}}let i_=e=>"reset"===e||"none"===e,iw=(e,t)=>t?e:Object.assign({},e);class ik{static defaults={};static datasetElementType=null;static dataElementType=null;constructor(e,t){this.chart=e,this._ctx=e.ctx,this.index=t,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){let e=this._cachedMeta;this.configure(),this.linkScales(),e._stacked=im(e.vScale,e),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(e){this.index!==e&&ix(this._cachedMeta),this.index=e}linkScales(){let e=this.chart,t=this._cachedMeta,i=this.getDataset(),r=(e,t,i,r)=>"x"===e?t:"r"===e?r:i,n=t.xAxisID=ei(i.xAxisID,ib(e,"x")),a=t.yAxisID=ei(i.yAxisID,ib(e,"y")),s=t.rAxisID=ei(i.rAxisID,ib(e,"r")),o=t.indexAxis,l=t.iAxisID=r(o,n,a,s),c=t.vAxisID=r(o,a,n,s);t.xScale=this.getScaleForId(n),t.yScale=this.getScaleForId(a),t.rScale=this.getScaleForId(s),t.iScale=this.getScaleForId(l),t.vScale=this.getScaleForId(c)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(e){return this.chart.scales[e]}_getOtherScale(e){let t=this._cachedMeta;return e===t.iScale?t.vScale:t.iScale}reset(){this._update("reset")}_destroy(){let e=this._cachedMeta;this._data&&eq(this._data,this),e._stacked&&ix(e)}_dataCheck(){let e=this.getDataset(),t=e.data||(e.data=[]),i=this._data;if(Q(t)){let e=this._cachedMeta;this._data=function(e,t){let i,r,n,{iScale:a,vScale:s}=t,o="x"===a.axis?"x":"y",l="x"===s.axis?"x":"y",c=Object.keys(e),u=Array(c.length);for(i=0,r=c.length;i<r;++i)n=c[i],u[i]={[o]:n,[l]:e[n]};return u}(t,e)}else if(i!==t){if(i){eq(i,this);let e=this._cachedMeta;ix(e),e._parsed=[]}t&&Object.isExtensible(t)&&(t._chartjs?t._chartjs.listeners.push(this):(Object.defineProperty(t,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[this]}}),eH.forEach(e=>{let i="_onData"+eg(e),r=t[e];Object.defineProperty(t,e,{configurable:!0,enumerable:!1,value(...e){let n=r.apply(this,e);return t._chartjs.listeners.forEach(t=>{"function"==typeof t[i]&&t[i](...e)}),n}})}))),this._syncList=[],this._data=t}}addElements(){let e=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(e.dataset=new this.datasetElementType)}buildOrUpdateElements(e){let t=this._cachedMeta,i=this.getDataset(),r=!1;this._dataCheck();let n=t._stacked;t._stacked=im(t.vScale,t),t.stack!==i.stack&&(r=!0,ix(t),t.stack=i.stack),this._resyncElements(e),(r||n!==t._stacked)&&(iy(this,t._parsed),t._stacked=im(t.vScale,t))}configure(){let e=this.chart.config,t=e.datasetScopeKeys(this._type),i=e.getOptionScopes(this.getDataset(),t,!0);this.options=e.createResolver(i,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(e,t){let i,r,n,{_cachedMeta:a,_data:s}=this,{iScale:o,_stacked:l}=a,c=o.axis,u=0===e&&t===s.length||a._sorted,h=e>0&&a._parsed[e-1];if(!1===this._parsing)a._parsed=s,a._sorted=!0,n=s;else{n=J(s[e])?this.parseArrayData(a,s,e,t):Q(s[e])?this.parseObjectData(a,s,e,t):this.parsePrimitiveData(a,s,e,t);let o=()=>null===r[c]||h&&r[c]<h[c];for(i=0;i<t;++i)a._parsed[i+e]=r=n[i],u&&(o()&&(u=!1),h=r);a._sorted=u}l&&iy(this,n)}parsePrimitiveData(e,t,i,r){let n,a,{iScale:s,vScale:o}=e,l=s.axis,c=o.axis,u=s.getLabels(),h=s===o,d=Array(r);for(n=0;n<r;++n)a=n+i,d[n]={[l]:h||s.parse(u[a],a),[c]:o.parse(t[a],a)};return d}parseArrayData(e,t,i,r){let n,a,s,{xScale:o,yScale:l}=e,c=Array(r);for(n=0;n<r;++n)s=t[a=n+i],c[n]={x:o.parse(s[0],a),y:l.parse(s[1],a)};return c}parseObjectData(e,t,i,r){let n,a,s,{xScale:o,yScale:l}=e,{xAxisKey:c="x",yAxisKey:u="y"}=this._parsing,h=Array(r);for(n=0;n<r;++n)s=t[a=n+i],h[n]={x:o.parse(ep(s,c),a),y:l.parse(ep(s,u),a)};return h}getParsed(e){return this._cachedMeta._parsed[e]}getDataElement(e){return this._cachedMeta.data[e]}applyStack(e,t,i){let r=this.chart,n=this._cachedMeta,a=t[e.axis];return ig({keys:ip(r,!0),values:t._stacks[e.axis]._visualValues},a,n.index,{mode:i})}updateRangeFromParsed(e,t,i,r){let n=i[t.axis],a=null===n?NaN:n,s=r&&i._stacks[t.axis];r&&s&&(r.values=s,a=ig(r,n,this._cachedMeta.index)),e.min=Math.min(e.min,a),e.max=Math.max(e.max,a)}getMinMax(e,t){let i,r,n,a=this._cachedMeta,s=a._parsed,o=a._sorted&&e===a.iScale,l=s.length,c=this._getOtherScale(e),u=(n=this.chart,t&&!a.hidden&&a._stacked&&{keys:ip(n,!0),values:null}),h={min:1/0,max:-1/0},{min:d,max:f}=function(e){let{min:t,max:i,minDefined:r,maxDefined:n}=e.getUserBounds();return{min:r?t:-1/0,max:n?i:1/0}}(c);function p(){let t=(r=s[i])[c.axis];return!ee(r[e.axis])||d>t||f<t}for(i=0;i<l&&(p()||(this.updateRangeFromParsed(h,e,r,u),!o));++i);if(o){for(i=l-1;i>=0;--i)if(!p()){this.updateRangeFromParsed(h,e,r,u);break}}return h}getAllParsedValues(e){let t,i,r,n=this._cachedMeta._parsed,a=[];for(t=0,i=n.length;t<i;++t)ee(r=n[t][e.axis])&&a.push(r);return a}getMaxOverflow(){return!1}getLabelAndValue(e){let t=this._cachedMeta,i=t.iScale,r=t.vScale,n=this.getParsed(e);return{label:i?""+i.getLabelForValue(n[i.axis]):"",value:r?""+r.getLabelForValue(n[r.axis]):""}}_update(e){var t;let i,r,n,a,s=this._cachedMeta;this.update(e||"default"),Q(t=ei(this.options.clip,function(e,t,i){if(!1===i)return!1;let r=id(e,i),n=id(t,i);return{top:n.end,right:r.end,bottom:n.start,left:r.start}}(s.xScale,s.yScale,this.getMaxOverflow())))?(i=t.top,r=t.right,n=t.bottom,a=t.left):i=r=n=a=t,s._clip={top:i,right:r,bottom:n,left:a,disabled:!1===t}}update(e){}draw(){let e,t=this._ctx,i=this.chart,r=this._cachedMeta,n=r.data||[],a=i.chartArea,s=[],o=this._drawStart||0,l=this._drawCount||n.length-o,c=this.options.drawActiveElementsOnTop;for(r.dataset&&r.dataset.draw(t,a,o,l),e=o;e<o+l;++e){let i=n[e];i.hidden||(i.active&&c?s.push(i):i.draw(t,a))}for(e=0;e<s.length;++e)s[e].draw(t,a)}getStyle(e,t){let i=t?"active":"default";return void 0===e&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(i):this.resolveDataElementOptions(e||0,i)}getContext(e,t,i){var r,n;let a,s=this.getDataset();if(e>=0&&e<this._cachedMeta.data.length){let t=this._cachedMeta.data[e];(a=t.$context||(r=this.getContext(),t.$context=tM(r,{active:!1,dataIndex:e,parsed:void 0,raw:void 0,element:t,index:e,mode:"default",type:"data"}))).parsed=this.getParsed(e),a.raw=s.data[e],a.index=a.dataIndex=e}else(a=this.$context||(this.$context=tM(this.chart.getContext(),{active:!1,dataset:void 0,datasetIndex:n=this.index,index:n,mode:"default",type:"dataset"}))).dataset=s,a.index=a.datasetIndex=this.index;return a.active=!!t,a.mode=i,a}resolveDatasetElementOptions(e){return this._resolveElementOptions(this.datasetElementType.id,e)}resolveDataElementOptions(e,t){return this._resolveElementOptions(this.dataElementType.id,t,e)}_resolveElementOptions(e,t="default",i){let r="active"===t,n=this._cachedDataOpts,a=e+"-"+t,s=n[a],o=this.enableOptionSharing&&em(i);if(s)return iw(s,o);let l=this.chart.config,c=l.datasetElementScopeKeys(this._type,e),u=r?[`${e}Hover`,"hover",e,""]:[e,""],h=l.getOptionScopes(this.getDataset(),c),d=Object.keys(ts.elements[e]),f=()=>this.getContext(i,r,t),p=l.resolveNamedOptions(h,d,f,u);return p.$shared&&(p.$shared=o,n[a]=Object.freeze(iw(p,o))),p}_resolveAnimations(e,t,i){let r,n=this.chart,a=this._cachedDataOpts,s=`animation-${t}`,o=a[s];if(o)return o;if(!1!==n.options.animation){let n=this.chart.config,a=n.datasetAnimationScopeKeys(this._type,t),s=n.getOptionScopes(this.getDataset(),a);r=n.createResolver(s,this.getContext(e,i,t))}let l=new ih(n,r&&r.animations);return r&&r._cacheable&&(a[s]=Object.freeze(l)),l}getSharedOptions(e){if(e.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},e))}includeOptions(e,t){return!t||i_(e)||this.chart._animationsDisabled}_getSharedOptions(e,t){let i=this.resolveDataElementOptions(e,t),r=this._sharedOptions,n=this.getSharedOptions(i),a=this.includeOptions(t,n)||n!==r;return this.updateSharedOptions(n,t,i),{sharedOptions:n,includeOptions:a}}updateElement(e,t,i,r){i_(r)?Object.assign(e,i):this._resolveAnimations(t,r).update(e,i)}updateSharedOptions(e,t,i){e&&!i_(t)&&this._resolveAnimations(void 0,t).update(e,i)}_setStyle(e,t,i,r){e.active=r;let n=this.getStyle(t,r);this._resolveAnimations(t,i,r).update(e,{options:!r&&this.getSharedOptions(n)||n})}removeHoverStyle(e,t,i){this._setStyle(e,i,"active",!1)}setHoverStyle(e,t,i){this._setStyle(e,i,"active",!0)}_removeDatasetHoverStyle(){let e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!1)}_setDatasetHoverStyle(){let e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!0)}_resyncElements(e){let t=this._data,i=this._cachedMeta.data;for(let[e,t,i]of this._syncList)this[e](t,i);this._syncList=[];let r=i.length,n=t.length,a=Math.min(n,r);a&&this.parse(0,a),n>r?this._insertElements(r,n-r,e):n<r&&this._removeElements(n,r-n)}_insertElements(e,t,i=!0){let r,n=this._cachedMeta,a=n.data,s=e+t,o=e=>{for(e.length+=t,r=e.length-1;r>=s;r--)e[r]=e[r-t]};for(o(a),r=e;r<s;++r)a[r]=new this.dataElementType;this._parsing&&o(n._parsed),this.parse(e,t),i&&this.updateElements(a,e,t,"reset")}updateElements(e,t,i,r){}_removeElements(e,t){let i=this._cachedMeta;if(this._parsing){let r=i._parsed.splice(e,t);i._stacked&&ix(i,r)}i.data.splice(e,t)}_sync(e){if(this._parsing)this._syncList.push(e);else{let[t,i,r]=e;this[t](i,r)}this.chart._dataChanges.push([this.index,...e])}_onDataPush(){let e=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-e,e])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(e,t){t&&this._sync(["_removeElements",e,t]);let i=arguments.length-2;i&&this._sync(["_insertElements",e,i])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}function iE(e,t,i,r){if(J(e)){let n,a,s,o,l,c;n=i.parse(e[0],r),s=Math.min(n,a=i.parse(e[1],r)),o=Math.max(n,a),l=s,c=o,Math.abs(s)>Math.abs(o)&&(l=o,c=s),t[i.axis]=c,t._custom={barStart:l,barEnd:c,start:n,end:a,min:s,max:o}}else t[i.axis]=i.parse(e,r);return t}function iT(e,t,i,r){let n,a,s,o,l=e.iScale,c=e.vScale,u=l.getLabels(),h=l===c,d=[];for(n=i,a=i+r;n<a;++n)o=t[n],(s={})[l.axis]=h||l.parse(u[n],n),d.push(iE(o,s,c,n));return d}function iP(e){return e&&void 0!==e.barStart&&void 0!==e.barEnd}function iS(e,t,i,r){var n,a,s;return r?iM((n=e,a=t,s=i,e=n===a?s:n===s?a:n),i,t):iM(e,t,i)}function iM(e,t,i){return"start"===e?t:"end"===e?i:e}class iC extends ik{static id="bubble";static defaults={datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}};static overrides={scales:{x:{type:"linear"},y:{type:"linear"}}};initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(e,t,i,r){let n=super.parsePrimitiveData(e,t,i,r);for(let e=0;e<n.length;e++)n[e]._custom=this.resolveDataElementOptions(e+i).radius;return n}parseArrayData(e,t,i,r){let n=super.parseArrayData(e,t,i,r);for(let e=0;e<n.length;e++){let r=t[i+e];n[e]._custom=ei(r[2],this.resolveDataElementOptions(e+i).radius)}return n}parseObjectData(e,t,i,r){let n=super.parseObjectData(e,t,i,r);for(let e=0;e<n.length;e++){let r=t[i+e];n[e]._custom=ei(r&&r.r&&+r.r,this.resolveDataElementOptions(e+i).radius)}return n}getMaxOverflow(){let e=this._cachedMeta.data,t=0;for(let i=e.length-1;i>=0;--i)t=Math.max(t,e[i].size(this.resolveDataElementOptions(i))/2);return t>0&&t}getLabelAndValue(e){let t=this._cachedMeta,i=this.chart.data.labels||[],{xScale:r,yScale:n}=t,a=this.getParsed(e),s=r.getLabelForValue(a.x),o=n.getLabelForValue(a.y),l=a._custom;return{label:i[e]||"",value:"("+s+", "+o+(l?", "+l:"")+")"}}update(e){let t=this._cachedMeta.data;this.updateElements(t,0,t.length,e)}updateElements(e,t,i,r){let n="reset"===r,{iScale:a,vScale:s}=this._cachedMeta,{sharedOptions:o,includeOptions:l}=this._getSharedOptions(t,r),c=a.axis,u=s.axis;for(let h=t;h<t+i;h++){let t=e[h],i=!n&&this.getParsed(h),d={},f=d[c]=n?a.getPixelForDecimal(.5):a.getPixelForValue(i[c]),p=d[u]=n?s.getBasePixel():s.getPixelForValue(i[u]);d.skip=isNaN(f)||isNaN(p),l&&(d.options=o||this.resolveDataElementOptions(h,t.active?"active":r),n&&(d.options.radius=0)),this.updateElement(t,h,d,r)}}resolveDataElementOptions(e,t){let i=this.getParsed(e),r=super.resolveDataElementOptions(e,t);r.$shared&&(r=Object.assign({},r,{$shared:!1}));let n=r.radius;return"active"!==t&&(r.radius=0),r.radius+=ei(i&&i._custom,n),r}}class iA extends ik{static id="doughnut";static defaults={datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"};static descriptors={_scriptable:e=>"spacing"!==e,_indexable:e=>"spacing"!==e&&!e.startsWith("borderDash")&&!e.startsWith("hoverBorderDash")};static overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(e){let t=e.data,{labels:{pointStyle:i,textAlign:r,color:n,useBorderRadius:a,borderRadius:s}}=e.legend.options;return t.labels.length&&t.datasets.length?t.labels.map((t,o)=>{let l=e.getDatasetMeta(0).controller.getStyle(o);return{text:t,fillStyle:l.backgroundColor,fontColor:n,hidden:!e.getDataVisibility(o),lineDash:l.borderDash,lineDashOffset:l.borderDashOffset,lineJoin:l.borderJoinStyle,lineWidth:l.borderWidth,strokeStyle:l.borderColor,textAlign:r,pointStyle:i,borderRadius:a&&(s||l.borderRadius),index:o}}):[]}},onClick(e,t,i){i.chart.toggleDataVisibility(t.index),i.chart.update()}}}};constructor(e,t){super(e,t),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(e,t){let i=this.getDataset().data,r=this._cachedMeta;if(!1===this._parsing)r._parsed=i;else{let n,a,s=e=>+i[e];if(Q(i[e])){let{key:e="value"}=this._parsing;s=t=>+ep(i[t],e)}for(n=e,a=e+t;n<a;++n)r._parsed[n]=s(n)}}_getRotation(){return eD(this.options.rotation-90)}_getCircumference(){return eD(this.options.circumference)}_getRotationExtents(){let e=ex,t=-ex;for(let i=0;i<this.chart.data.datasets.length;++i)if(this.chart.isDatasetVisible(i)&&this.chart.getDatasetMeta(i).type===this._type){let r=this.chart.getDatasetMeta(i).controller,n=r._getRotation(),a=r._getCircumference();e=Math.min(e,n),t=Math.max(t,n+a)}return{rotation:e,circumference:t-e}}update(e){let t,{chartArea:i}=this.chart,r=this._cachedMeta,n=r.data,a=this.getMaxBorderWidth()+this.getMaxOffset(n)+this.options.spacing,s=Math.max((Math.min(i.width,i.height)-a)/2,0),o=Math.min((t=this.options.cutout,"string"==typeof t&&t.endsWith("%")?parseFloat(t)/100:t/s),1),l=this._getRingWeight(this.index),{circumference:c,rotation:u}=this._getRotationExtents(),{ratioX:h,ratioY:d,offsetX:f,offsetY:p}=function(e,t,i){let r=1,n=1,a=0,s=0;if(t<ex){let o=e+t,l=Math.cos(e),c=Math.sin(e),u=Math.cos(o),h=Math.sin(o),d=(t,r,n)=>eF(t,e,o,!0)?1:Math.max(r,r*i,n,n*i),f=(t,r,n)=>eF(t,e,o,!0)?-1:Math.min(r,r*i,n,n*i),p=d(0,l,u),g=d(eE,c,h),v=f(eb,l,u),y=f(eb+eE,c,h);r=(p-v)/2,n=(g-y)/2,a=-(p+v)/2,s=-(g+y)/2}return{ratioX:r,ratioY:n,offsetX:a,offsetY:s}}(u,c,o),g=Math.max(Math.min((i.width-a)/h,(i.height-a)/d)/2,0),v=er(this.options.radius,g),y=Math.max(v*o,0),b=(v-y)/this._getVisibleDatasetWeightTotal();this.offsetX=f*v,this.offsetY=p*v,r.total=this.calculateTotal(),this.outerRadius=v-b*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-b*l,0),this.updateElements(n,0,n.length,e)}_circumference(e,t){let i=this.options,r=this._cachedMeta,n=this._getCircumference();return t&&i.animation.animateRotate||!this.chart.getDataVisibility(e)||null===r._parsed[e]||r.data[e].hidden?0:this.calculateCircumference(r._parsed[e]*n/ex)}updateElements(e,t,i,r){let n,a="reset"===r,s=this.chart,o=s.chartArea,l=s.options.animation,c=(o.left+o.right)/2,u=(o.top+o.bottom)/2,h=a&&l.animateScale,d=h?0:this.innerRadius,f=h?0:this.outerRadius,{sharedOptions:p,includeOptions:g}=this._getSharedOptions(t,r),v=this._getRotation();for(n=0;n<t;++n)v+=this._circumference(n,a);for(n=t;n<t+i;++n){let t=this._circumference(n,a),i=e[n],s={x:c+this.offsetX,y:u+this.offsetY,startAngle:v,endAngle:v+t,circumference:t,outerRadius:f,innerRadius:d};g&&(s.options=p||this.resolveDataElementOptions(n,i.active?"active":r)),v+=t,this.updateElement(i,n,s,r)}}calculateTotal(){let e,t=this._cachedMeta,i=t.data,r=0;for(e=0;e<i.length;e++){let n=t._parsed[e];null!==n&&!isNaN(n)&&this.chart.getDataVisibility(e)&&!i[e].hidden&&(r+=Math.abs(n))}return r}calculateCircumference(e){let t=this._cachedMeta.total;return t>0&&!isNaN(e)?Math.abs(e)/t*ex:0}getLabelAndValue(e){let t=this._cachedMeta,i=this.chart,r=i.data.labels||[],n=te(t._parsed[e],i.options.locale);return{label:r[e]||"",value:n}}getMaxBorderWidth(e){let t,i,r,n,a,s=0,o=this.chart;if(!e){for(t=0,i=o.data.datasets.length;t<i;++t)if(o.isDatasetVisible(t)){e=(r=o.getDatasetMeta(t)).data,n=r.controller;break}}if(!e)return 0;for(t=0,i=e.length;t<i;++t)"inner"!==(a=n.resolveDataElementOptions(t)).borderAlign&&(s=Math.max(s,a.borderWidth||0,a.hoverBorderWidth||0));return s}getMaxOffset(e){let t=0;for(let i=0,r=e.length;i<r;++i){let e=this.resolveDataElementOptions(i);t=Math.max(t,e.offset||0,e.hoverOffset||0)}return t}_getRingWeightOffset(e){let t=0;for(let i=0;i<e;++i)this.chart.isDatasetVisible(i)&&(t+=this._getRingWeight(i));return t}_getRingWeight(e){return Math.max(ei(this.chart.data.datasets[e].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}class iI extends ik{static id="polarArea";static defaults={dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0};static overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(e){let t=e.data;if(t.labels.length&&t.datasets.length){let{labels:{pointStyle:i,color:r}}=e.legend.options;return t.labels.map((t,n)=>{let a=e.getDatasetMeta(0).controller.getStyle(n);return{text:t,fillStyle:a.backgroundColor,strokeStyle:a.borderColor,fontColor:r,lineWidth:a.borderWidth,pointStyle:i,hidden:!e.getDataVisibility(n),index:n}})}return[]}},onClick(e,t,i){i.chart.toggleDataVisibility(t.index),i.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}};constructor(e,t){super(e,t),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(e){let t=this._cachedMeta,i=this.chart,r=i.data.labels||[],n=te(t._parsed[e].r,i.options.locale);return{label:r[e]||"",value:n}}parseObjectData(e,t,i,r){return tz.bind(this)(e,t,i,r)}update(e){let t=this._cachedMeta.data;this._updateRadius(),this.updateElements(t,0,t.length,e)}getMinMax(){let e=this._cachedMeta,t={min:1/0,max:-1/0};return e.data.forEach((e,i)=>{let r=this.getParsed(i).r;!isNaN(r)&&this.chart.getDataVisibility(i)&&(r<t.min&&(t.min=r),r>t.max&&(t.max=r))}),t}_updateRadius(){let e=this.chart,t=e.chartArea,i=e.options,r=Math.max(Math.min(t.right-t.left,t.bottom-t.top)/2,0),n=Math.max(i.cutoutPercentage?r/100*i.cutoutPercentage:1,0),a=(r-n)/e.getVisibleDatasetCount();this.outerRadius=r-a*this.index,this.innerRadius=this.outerRadius-a}updateElements(e,t,i,r){let n,a="reset"===r,s=this.chart,o=s.options.animation,l=this._cachedMeta.rScale,c=l.xCenter,u=l.yCenter,h=l.getIndexAngle(0)-.5*eb,d=h,f=360/this.countVisibleElements();for(n=0;n<t;++n)d+=this._computeAngle(n,r,f);for(n=t;n<t+i;n++){let t=e[n],i=d,p=d+this._computeAngle(n,r,f),g=s.getDataVisibility(n)?l.getDistanceFromCenterForValue(this.getParsed(n).r):0;d=p,a&&(o.animateScale&&(g=0),o.animateRotate&&(i=p=h));let v={x:c,y:u,innerRadius:0,outerRadius:g,startAngle:i,endAngle:p,options:this.resolveDataElementOptions(n,t.active?"active":r)};this.updateElement(t,n,v,r)}}countVisibleElements(){let e=this._cachedMeta,t=0;return e.data.forEach((e,i)=>{!isNaN(this.getParsed(i).r)&&this.chart.getDataVisibility(i)&&t++}),t}_computeAngle(e,t,i){return this.chart.getDataVisibility(e)?eD(this.resolveDataElementOptions(e,t).angle||i):0}}class iL extends ik{static id="radar";static defaults={datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}};static overrides={aspectRatio:1,scales:{r:{type:"radialLinear"}}};getLabelAndValue(e){let t=this._cachedMeta.vScale,i=this.getParsed(e);return{label:t.getLabels()[e],value:""+t.getLabelForValue(i[t.axis])}}parseObjectData(e,t,i,r){return tz.bind(this)(e,t,i,r)}update(e){let t=this._cachedMeta,i=t.dataset,r=t.data||[],n=t.iScale.getLabels();if(i.points=r,"resize"!==e){let t=this.resolveDatasetElementOptions(e);this.options.showLine||(t.borderWidth=0);let a={_loop:!0,_fullLoop:n.length===r.length,options:t};this.updateElement(i,void 0,a,e)}this.updateElements(r,0,r.length,e)}updateElements(e,t,i,r){let n=this._cachedMeta.rScale,a="reset"===r;for(let s=t;s<t+i;s++){let t=e[s],i=this.resolveDataElementOptions(s,t.active?"active":r),o=n.getPointPositionForValue(s,this.getParsed(s).r),l=a?n.xCenter:o.x,c=a?n.yCenter:o.y,u={x:l,y:c,angle:o.angle,skip:isNaN(l)||isNaN(c),options:i};this.updateElement(t,s,u,r)}}}function iD(){throw Error("This method is not implemented: Check that a complete date adapter is provided.")}class iO{static override(e){Object.assign(iO.prototype,e)}options;constructor(e){this.options=e||{}}init(){}formats(){return iD()}parse(){return iD()}format(){return iD()}add(){return iD()}diff(){return iD()}startOf(){return iD()}endOf(){return iD()}}function iR(e,t,i,r,n){let a=e.getSortedVisibleDatasetMetas(),s=i[t];for(let e=0,i=a.length;e<i;++e){let{index:i,data:o}=a[e],{lo:l,hi:c}=function(e,t,i,r){let{controller:n,data:a,_sorted:s}=e,o=n._cachedMeta.iScale,l=e.dataset&&e.dataset.options?e.dataset.options.spanGaps:null;if(o&&t===o.axis&&"r"!==t&&s&&a.length){let s=o._reversePixels?eW:e$;if(r){if(n._sharedOptions){let e=a[0],r="function"==typeof e.getRange&&e.getRange(t);if(r){let e=s(a,t,i-r),n=s(a,t,i+r);return{lo:e.lo,hi:n.hi}}}}else{let r=s(a,t,i);if(l){let{vScale:t}=n._cachedMeta,{_parsed:i}=e,a=i.slice(0,r.lo+1).reverse().findIndex(e=>!Z(e[t.axis]));r.lo-=Math.max(0,a);let s=i.slice(r.hi).findIndex(e=>!Z(e[t.axis]));r.hi+=Math.max(0,s)}return r}}return{lo:0,hi:a.length-1}}(a[e],t,s,n);for(let e=l;e<=c;++e){let t=o[e];t.skip||r(t,i,e)}}}function iN(e,t,i,r,n){let a=[];return(n||e.isPointInArea(t))&&iR(e,i,t,function(i,s,o){(n||td(i,e.chartArea,0))&&i.inRange(t.x,t.y,r)&&a.push({element:i,datasetIndex:s,index:o})},!0),a}function ij(e,t,i,r,n,a){let s,o,l,c,u,h;return a||e.isPointInArea(t)?"r"!==i||r?(s=[],o=-1!==i.indexOf("x"),l=-1!==i.indexOf("y"),c=function(e,t){return Math.sqrt(Math.pow(o?Math.abs(e.x-t.x):0,2)+Math.pow(l?Math.abs(e.y-t.y):0,2))},u=1/0,iR(e,i,t,function(i,o,l){let h=i.inRange(t.x,t.y,n);if(r&&!h)return;let d=i.getCenterPoint(n);if(!(a||e.isPointInArea(d))&&!h)return;let f=c(t,d);f<u?(s=[{element:i,datasetIndex:o,index:l}],u=f):f===u&&s.push({element:i,datasetIndex:o,index:l})}),s):(h=[],iR(e,i,t,function(e,i,r){let{startAngle:a,endAngle:s}=e.getProps(["startAngle","endAngle"],n),{angle:o}=eR(e,{x:t.x,y:t.y});eF(o,a,s)&&h.push({element:e,datasetIndex:i,index:r})}),h):[]}function iB(e,t,i,r,n){let a=[],s="x"===i?"inXRange":"inYRange",o=!1;return(iR(e,i,t,(e,r,l)=>{e[s]&&e[s](t[i],n)&&(a.push({element:e,datasetIndex:r,index:l}),o=o||e.inRange(t.x,t.y,n))}),r&&!o)?[]:a}var iF={modes:{index(e,t,i,r){let n=tZ(t,e),a=i.axis||"x",s=i.includeInvisible||!1,o=i.intersect?iN(e,n,a,r,s):ij(e,n,a,!1,r,s),l=[];return o.length?(e.getSortedVisibleDatasetMetas().forEach(e=>{let t=o[0].index,i=e.data[t];i&&!i.skip&&l.push({element:i,datasetIndex:e.index,index:t})}),l):[]},dataset(e,t,i,r){let n=tZ(t,e),a=i.axis||"xy",s=i.includeInvisible||!1,o=i.intersect?iN(e,n,a,r,s):ij(e,n,a,!1,r,s);if(o.length>0){let t=o[0].datasetIndex,i=e.getDatasetMeta(t).data;o=[];for(let e=0;e<i.length;++e)o.push({element:i[e],datasetIndex:t,index:e})}return o},point(e,t,i,r){let n=tZ(t,e);return iN(e,n,i.axis||"xy",r,i.includeInvisible||!1)},nearest(e,t,i,r){let n=tZ(t,e),a=i.axis||"xy",s=i.includeInvisible||!1;return ij(e,n,a,i.intersect,r,s)},x(e,t,i,r){let n=tZ(t,e);return iB(e,n,"x",i.intersect,r)},y(e,t,i,r){let n=tZ(t,e);return iB(e,n,"y",i.intersect,r)}}};let iz=["left","top","right","bottom"];function iV(e,t){return e.filter(e=>e.pos===t)}function iU(e,t){return e.filter(e=>-1===iz.indexOf(e.pos)&&e.box.axis===t)}function i$(e,t){return e.sort((e,i)=>{let r=t?i:e,n=t?e:i;return r.weight===n.weight?r.index-n.index:r.weight-n.weight})}function iW(e,t,i,r){return Math.max(e[i],t[i])+Math.max(e[r],t[r])}function iH(e,t){e.top=Math.max(e.top,t.top),e.left=Math.max(e.left,t.left),e.bottom=Math.max(e.bottom,t.bottom),e.right=Math.max(e.right,t.right)}function iq(e,t,i,r){let n,a,s,o,l,c,u=[];for(n=0,a=e.length,l=0;n<a;++n){(o=(s=e[n]).box).update(s.width||t.w,s.height||t.h,function(e,t){let i=t.maxPadding;return function(e){let r={left:0,top:0,right:0,bottom:0};return e.forEach(e=>{r[e]=Math.max(t[e],i[e])}),r}(e?["left","right"]:["top","bottom"])}(s.horizontal,t));let{same:a,other:h}=function(e,t,i,r){let{pos:n,box:a}=i,s=e.maxPadding;if(!Q(n)){i.size&&(e[n]-=i.size);let t=r[i.stack]||{size:0,count:1};t.size=Math.max(t.size,i.horizontal?a.height:a.width),i.size=t.size/t.count,e[n]+=i.size}a.getPadding&&iH(s,a.getPadding());let o=Math.max(0,t.outerWidth-iW(s,e,"left","right")),l=Math.max(0,t.outerHeight-iW(s,e,"top","bottom")),c=o!==e.w,u=l!==e.h;return e.w=o,e.h=l,i.horizontal?{same:c,other:u}:{same:u,other:c}}(t,i,s,r);l|=a&&u.length,c=c||h,o.fullSize||u.push(s)}return l&&iq(u,t,i,r)||c}function iG(e,t,i,r,n){e.top=i,e.left=t,e.right=t+r,e.bottom=i+n,e.width=r,e.height=n}function iY(e,t,i,r){let n=i.padding,{x:a,y:s}=t;for(let o of e){let e=o.box,l=r[o.stack]||{count:1,placed:0,weight:1},c=o.stackWeight/l.weight||1;if(o.horizontal){let r=t.w*c,a=l.size||e.height;em(l.start)&&(s=l.start),e.fullSize?iG(e,n.left,s,i.outerWidth-n.right-n.left,a):iG(e,t.left+l.placed,s,r,a),l.start=s,l.placed+=r,s=e.bottom}else{let r=t.h*c,s=l.size||e.width;em(l.start)&&(a=l.start),e.fullSize?iG(e,a,n.top,s,i.outerHeight-n.bottom-n.top):iG(e,a,t.top+l.placed,s,r),l.start=a,l.placed+=r,a=e.right}}t.x=a,t.y=s}var iX={addBox(e,t){e.boxes||(e.boxes=[]),t.fullSize=t.fullSize||!1,t.position=t.position||"top",t.weight=t.weight||0,t._layers=t._layers||function(){return[{z:0,draw(e){t.draw(e)}}]},e.boxes.push(t)},removeBox(e,t){let i=e.boxes?e.boxes.indexOf(t):-1;-1!==i&&e.boxes.splice(i,1)},configure(e,t,i){t.fullSize=i.fullSize,t.position=i.position,t.weight=i.weight},update(e,t,i,r){let n,a,s,o,l,c,u,h;if(!e)return;let d=tT(e.options.layout.padding),f=Math.max(t-d.width,0),p=Math.max(i-d.height,0),g=(a=i$((n=function(e){let t,i,r,n,a,s,o=[];for(t=0,i=(e||[]).length;t<i;++t)r=e[t],({position:n,options:{stack:a,stackWeight:s=1}}=r),o.push({index:t,box:r,pos:n,horizontal:r.isHorizontal(),weight:r.weight,stack:a&&n+a,stackWeight:s});return o}(e.boxes)).filter(e=>e.box.fullSize),!0),s=i$(iV(n,"left"),!0),o=i$(iV(n,"right")),l=i$(iV(n,"top"),!0),c=i$(iV(n,"bottom")),u=iU(n,"x"),h=iU(n,"y"),{fullSize:a,leftAndTop:s.concat(l),rightAndBottom:o.concat(h).concat(c).concat(u),chartArea:iV(n,"chartArea"),vertical:s.concat(o).concat(h),horizontal:l.concat(c).concat(u)}),v=g.vertical,y=g.horizontal;ea(e.boxes,e=>{"function"==typeof e.beforeLayout&&e.beforeLayout()});let b=Object.freeze({outerWidth:t,outerHeight:i,padding:d,availableWidth:f,availableHeight:p,vBoxMaxWidth:f/2/(v.reduce((e,t)=>t.box.options&&!1===t.box.options.display?e:e+1,0)||1),hBoxMaxHeight:p/2}),x=Object.assign({},d);iH(x,tT(r));let _=Object.assign({maxPadding:x,w:f,h:p,x:d.left,y:d.top},d),w=function(e,t){let i,r,n,a=function(e){let t={};for(let i of e){let{stack:e,pos:r,stackWeight:n}=i;if(!e||!iz.includes(r))continue;let a=t[e]||(t[e]={count:0,placed:0,weight:0,size:0});a.count++,a.weight+=n}return t}(e),{vBoxMaxWidth:s,hBoxMaxHeight:o}=t;for(i=0,r=e.length;i<r;++i){let{fullSize:r}=(n=e[i]).box,l=a[n.stack],c=l&&n.stackWeight/l.weight;n.horizontal?(n.width=c?c*s:r&&t.availableWidth,n.height=o):(n.width=s,n.height=c?c*o:r&&t.availableHeight)}return a}(v.concat(y),b);iq(g.fullSize,_,b,w),iq(v,_,b,w),iq(y,_,b,w)&&iq(v,_,b,w);let k=_.maxPadding;function E(e){let t=Math.max(k[e]-_[e],0);return _[e]+=t,t}_.y+=E("top"),_.x+=E("left"),E("right"),E("bottom"),iY(g.leftAndTop,_,b,w),_.x+=_.w,_.y+=_.h,iY(g.rightAndBottom,_,b,w),e.chartArea={left:_.left,top:_.top,right:_.left+_.w,bottom:_.top+_.h,height:_.h,width:_.w},ea(g.chartArea,t=>{let i=t.box;Object.assign(i,e.chartArea),i.update(_.w,_.h,{left:0,top:0,right:0,bottom:0})})}};class iK{acquireContext(e,t){}releaseContext(e){return!1}addEventListener(e,t,i){}removeEventListener(e,t,i){}getDevicePixelRatio(){return 1}getMaximumSize(e,t,i,r){return t=Math.max(0,t||e.width),i=i||e.height,{width:t,height:Math.max(0,r?Math.floor(t/r):i)}}isAttached(e){return!0}updateConfig(e){}}class iZ extends iK{acquireContext(e){return e&&e.getContext&&e.getContext("2d")||null}updateConfig(e){e.options.animation=!1}}let iJ="$chartjs",iQ={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},i0=e=>null===e||""===e,i1=!!t0&&{passive:!0};function i2(e,t){for(let i of e)if(i===t||i.contains(t))return!0}function i3(e,t,i){let r=e.canvas,n=new MutationObserver(e=>{let t=!1;for(let i of e)t=(t=t||i2(i.addedNodes,r))&&!i2(i.removedNodes,r);t&&i()});return n.observe(document,{childList:!0,subtree:!0}),n}function i4(e,t,i){let r=e.canvas,n=new MutationObserver(e=>{let t=!1;for(let i of e)t=(t=t||i2(i.removedNodes,r))&&!i2(i.addedNodes,r);t&&i()});return n.observe(document,{childList:!0,subtree:!0}),n}let i5=new Map,i6=0;function i8(){let e=window.devicePixelRatio;e!==i6&&(i6=e,i5.forEach((t,i)=>{i.currentDevicePixelRatio!==e&&t()}))}function i9(e,t,i){let r=e.canvas,n=r&&tq(r);if(!n)return;let a=eX((e,t)=>{let r=n.clientWidth;i(e,t),r<n.clientWidth&&i()},window),s=new ResizeObserver(e=>{let t=e[0],i=t.contentRect.width,r=t.contentRect.height;(0!==i||0!==r)&&a(i,r)});return s.observe(n),i5.size||window.addEventListener("resize",i8),i5.set(e,a),s}function i7(e,t,i){i&&i.disconnect(),"resize"===t&&(i5.delete(e),i5.size||window.removeEventListener("resize",i8))}function re(e,t,i){let r=e.canvas,n=eX(t=>{null!==e.ctx&&i(function(e,t){let i=iQ[e.type]||e.type,{x:r,y:n}=tZ(e,t);return{type:i,chart:t,native:e,x:void 0!==r?r:null,y:void 0!==n?n:null}}(t,e))},e);return r&&r.addEventListener(t,n,i1),n}class rt extends iK{acquireContext(e,t){let i=e&&e.getContext&&e.getContext("2d");return i&&i.canvas===e?(!function(e,t){let i=e.style,r=e.getAttribute("height"),n=e.getAttribute("width");if(e[iJ]={initial:{height:r,width:n,style:{display:i.display,height:i.height,width:i.width}}},i.display=i.display||"block",i.boxSizing=i.boxSizing||"border-box",i0(n)){let t=t1(e,"width");void 0!==t&&(e.width=t)}if(i0(r))if(""===e.style.height)e.height=e.width/(t||2);else{let t=t1(e,"height");void 0!==t&&(e.height=t)}}(e,t),i):null}releaseContext(e){let t=e.canvas;if(!t[iJ])return!1;let i=t[iJ].initial;["height","width"].forEach(e=>{let r=i[e];Z(r)?t.removeAttribute(e):t.setAttribute(e,r)});let r=i.style||{};return Object.keys(r).forEach(e=>{t.style[e]=r[e]}),t.width=t.width,delete t[iJ],!0}addEventListener(e,t,i){this.removeEventListener(e,t);let r=e.$proxies||(e.$proxies={}),n={attach:i3,detach:i4,resize:i9}[t]||re;r[t]=n(e,t,i)}removeEventListener(e,t){let i=e.$proxies||(e.$proxies={}),r=i[t];r&&((({attach:i7,detach:i7,resize:i7})[t]||function(e,t,i){e&&e.canvas&&e.canvas.removeEventListener(t,i,i1)})(e,t,r),i[t]=void 0)}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(e,t,i,r){return function(e,t,i,r){let n=tY(e),a=tK(n,"margin"),s=tG(n.maxWidth,e,"clientWidth")||ew,o=tG(n.maxHeight,e,"clientHeight")||ew,l=function(e,t,i){let r,n;if(void 0===t||void 0===i){let a=e&&tq(e);if(a){let e=a.getBoundingClientRect(),s=tY(a),o=tK(s,"border","width"),l=tK(s,"padding");t=e.width-l.width-o.width,i=e.height-l.height-o.height,r=tG(s.maxWidth,a,"clientWidth"),n=tG(s.maxHeight,a,"clientHeight")}else t=e.clientWidth,i=e.clientHeight}return{width:t,height:i,maxWidth:r||ew,maxHeight:n||ew}}(e,t,i),{width:c,height:u}=l;if("content-box"===n.boxSizing){let e=tK(n,"border","width"),t=tK(n,"padding");c-=t.width+e.width,u-=t.height+e.height}return c=Math.max(0,c-a.width),u=Math.max(0,r?c/r:u-a.height),c=tJ(Math.min(c,s,l.maxWidth)),u=tJ(Math.min(u,o,l.maxHeight)),c&&!u&&(u=tJ(c/2)),(void 0!==t||void 0!==i)&&r&&l.height&&u>l.height&&(c=tJ(Math.floor((u=l.height)*r))),{width:c,height:u}}(e,t,i,r)}isAttached(e){let t=e&&tq(e);return!!(t&&t.isConnected)}}class ri{static defaults={};static defaultRoutes=void 0;x;y;active=!1;options;$animations;tooltipPosition(e){let{x:t,y:i}=this.getProps(["x","y"],e);return{x:t,y:i}}hasValue(){return eI(this.x)&&eI(this.y)}getProps(e,t){let i=this.$animations;if(!t||!i)return this;let r={};return e.forEach(e=>{r[e]=i[e]&&i[e].active()?i[e]._to:this[e]}),r}}function rr(e,t,i,r,n){let a,s,o,l=ei(r,0),c=Math.min(ei(n,e.length),e.length),u=0;for(i=Math.ceil(i),n&&(i=(a=n-r)/Math.floor(a/i)),o=l;o<0;)o=Math.round(l+ ++u*i);for(s=Math.max(l,0);s<c;s++)s===o&&(t.push(e[s]),o=Math.round(l+ ++u*i))}let rn=(e,t,i)=>"top"===t||"left"===t?e[t]+i:e[t]-i,ra=(e,t)=>Math.min(t||e,e);function rs(e,t){let i=[],r=e.length/t,n=e.length,a=0;for(;a<n;a+=r)i.push(e[Math.floor(a)]);return i}function ro(e){return e.drawTicks?e.tickLength:0}function rl(e,t){if(!e.display)return 0;let i=tP(e.font,t),r=tT(e.padding);return(J(e.text)?e.text.length:1)*i.lineHeight+r.height}class rc extends ri{constructor(e){super(),this.id=e.id,this.type=e.type,this.options=void 0,this.ctx=e.ctx,this.chart=e.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(e){this.options=e.setContext(this.getContext()),this.axis=e.axis,this._userMin=this.parse(e.min),this._userMax=this.parse(e.max),this._suggestedMin=this.parse(e.suggestedMin),this._suggestedMax=this.parse(e.suggestedMax)}parse(e,t){return e}getUserBounds(){let{_userMin:e,_userMax:t,_suggestedMin:i,_suggestedMax:r}=this;return e=et(e,1/0),t=et(t,-1/0),i=et(i,1/0),r=et(r,-1/0),{min:et(e,i),max:et(t,r),minDefined:ee(e),maxDefined:ee(t)}}getMinMax(e){let t,{min:i,max:r,minDefined:n,maxDefined:a}=this.getUserBounds();if(n&&a)return{min:i,max:r};let s=this.getMatchingVisibleMetas();for(let o=0,l=s.length;o<l;++o)t=s[o].controller.getMinMax(this,e),n||(i=Math.min(i,t.min)),a||(r=Math.max(r,t.max));return i=a&&i>r?r:i,r=n&&i>r?i:r,{min:et(i,et(r,i)),max:et(r,et(i,r))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){let e=this.chart.data;return this.options.labels||(this.isHorizontal()?e.xLabels:e.yLabels)||e.labels||[]}getLabelItems(e=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(e))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){en(this.options.beforeUpdate,[this])}update(e,t,i){let{beginAtZero:r,grace:n,ticks:a}=this.options,s=a.sampleSize;this.beforeUpdate(),this.maxWidth=e,this.maxHeight=t,this._margins=i=Object.assign({left:0,right:0,top:0,bottom:0},i),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+i.left+i.right:this.height+i.top+i.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=function(e,t,i){let{min:r,max:n}=e,a=er(t,(n-r)/2),s=(e,t)=>i&&0===e?0:e+t;return{min:s(r,-Math.abs(a)),max:s(n,a)}}(this,n,r),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();let o=s<this.ticks.length;this._convertTicksToLabels(o?rs(this.ticks,s):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),a.display&&(a.autoSkip||"auto"===a.source)&&(this.ticks=function(e,t){var i;let r,n,a=e.options.ticks,s=(r=(i=e).options.offset,n=i._tickSize(),Math.floor(Math.min(i._length/n+ +!r,i._maxLength/n))),o=Math.min(a.maxTicksLimit||s,s),l=a.major.enabled?function(e){let t,i,r=[];for(t=0,i=e.length;t<i;t++)e[t].major&&r.push(t);return r}(t):[],c=l.length,u=l[0],h=l[c-1],d=[];if(c>o)return function(e,t,i,r){let n,a=0,s=i[0];for(n=0,r=Math.ceil(r);n<e.length;n++)n===s&&(t.push(e[n]),s=i[++a*r])}(t,d,l,c/o),d;let f=function(e,t,i){let r=function(e){let t,i,r=e.length;if(r<2)return!1;for(i=e[0],t=1;t<r;++t)if(e[t]-e[t-1]!==i)return!1;return i}(e),n=t.length/i;if(!r)return Math.max(n,1);let a=function(e){let t,i=[],r=Math.sqrt(e);for(t=1;t<r;t++)e%t==0&&(i.push(t),i.push(e/t));return r===(0|r)&&i.push(r),i.sort((e,t)=>e-t).pop(),i}(r);for(let e=0,t=a.length-1;e<t;e++){let t=a[e];if(t>n)return t}return Math.max(n,1)}(l,t,o);if(c>0){let e,i,r=c>1?Math.round((h-u)/(c-1)):null;for(rr(t,d,f,Z(r)?0:u-r,u),e=0,i=c-1;e<i;e++)rr(t,d,f,l[e],l[e+1]);return rr(t,d,f,h,Z(r)?t.length:h+r),d}return rr(t,d,f),d}(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),o&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let e,t,i=this.options.reverse;this.isHorizontal()?(e=this.left,t=this.right):(e=this.top,t=this.bottom,i=!i),this._startPixel=e,this._endPixel=t,this._reversePixels=i,this._length=t-e,this._alignToPixels=this.options.alignToPixels}afterUpdate(){en(this.options.afterUpdate,[this])}beforeSetDimensions(){en(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){en(this.options.afterSetDimensions,[this])}_callHooks(e){this.chart.notifyPlugins(e,this.getContext()),en(this.options[e],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){en(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(e){let t,i,r,n=this.options.ticks;for(t=0,i=e.length;t<i;t++)(r=e[t]).label=en(n.callback,[r.value,t,e],this)}afterTickToLabelConversion(){en(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){en(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){let e,t,i,r=this.options,n=r.ticks,a=ra(this.ticks.length,r.ticks.maxTicksLimit),s=n.minRotation||0,o=n.maxRotation,l=s;if(!this._isVisible()||!n.display||s>=o||a<=1||!this.isHorizontal()){this.labelRotation=s;return}let c=this._getLabelSizes(),u=c.widest.width,h=c.highest.height,d=ez(this.chart.width-u,0,this.maxWidth);u+6>(e=r.offset?this.maxWidth/a:d/(a-1))&&(e=d/(a-(r.offset?.5:1)),t=this.maxHeight-ro(r.grid)-n.padding-rl(r.title,this.chart.options.font),i=Math.sqrt(u*u+h*h),l=Math.max(s,Math.min(o,l=180/eb*Math.min(Math.asin(ez((c.highest.height+6)/e,-1,1)),Math.asin(ez(t/i,-1,1))-Math.asin(ez(h/i,-1,1)))))),this.labelRotation=l}afterCalculateLabelRotation(){en(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){en(this.options.beforeFit,[this])}fit(){let e={width:0,height:0},{chart:t,options:{ticks:i,title:r,grid:n}}=this,a=this._isVisible(),s=this.isHorizontal();if(a){let a=rl(r,t.options.font);if(s?(e.width=this.maxWidth,e.height=ro(n)+a):(e.height=this.maxHeight,e.width=ro(n)+a),i.display&&this.ticks.length){let{first:t,last:r,widest:n,highest:a}=this._getLabelSizes(),o=2*i.padding,l=eD(this.labelRotation),c=Math.cos(l),u=Math.sin(l);if(s){let t=i.mirror?0:u*n.width+c*a.height;e.height=Math.min(this.maxHeight,e.height+t+o)}else{let t=i.mirror?0:c*n.width+u*a.height;e.width=Math.min(this.maxWidth,e.width+t+o)}this._calculatePadding(t,r,u,c)}}this._handleMargins(),s?(this.width=this._length=t.width-this._margins.left-this._margins.right,this.height=e.height):(this.width=e.width,this.height=this._length=t.height-this._margins.top-this._margins.bottom)}_calculatePadding(e,t,i,r){let{ticks:{align:n,padding:a},position:s}=this.options,o=0!==this.labelRotation,l="top"!==s&&"x"===this.axis;if(this.isHorizontal()){let s=this.getPixelForTick(0)-this.left,c=this.right-this.getPixelForTick(this.ticks.length-1),u=0,h=0;o?l?(u=r*e.width,h=i*t.height):(u=i*e.height,h=r*t.width):"start"===n?h=t.width:"end"===n?u=e.width:"inner"!==n&&(u=e.width/2,h=t.width/2),this.paddingLeft=Math.max((u-s+a)*this.width/(this.width-s),0),this.paddingRight=Math.max((h-c+a)*this.width/(this.width-c),0)}else{let i=t.height/2,r=e.height/2;"start"===n?(i=0,r=e.height):"end"===n&&(i=t.height,r=0),this.paddingTop=i+a,this.paddingBottom=r+a}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){en(this.options.afterFit,[this])}isHorizontal(){let{axis:e,position:t}=this.options;return"top"===t||"bottom"===t||"x"===e}isFullSize(){return this.options.fullSize}_convertTicksToLabels(e){let t,i;for(this.beforeTickToLabelConversion(),this.generateTickLabels(e),t=0,i=e.length;t<i;t++)Z(e[t].label)&&(e.splice(t,1),i--,t--);this.afterTickToLabelConversion()}_getLabelSizes(){let e=this._labelSizes;if(!e){let t=this.options.ticks.sampleSize,i=this.ticks;t<i.length&&(i=rs(i,t)),this._labelSizes=e=this._computeLabelSizes(i,i.length,this.options.ticks.maxTicksLimit)}return e}_computeLabelSizes(e,t,i){let r,n,a,s,o,l,c,u,h,d,f,{ctx:p,_longestTextCache:g}=this,v=[],y=[],b=Math.floor(t/ra(t,i)),x=0,_=0;for(r=0;r<t;r+=b){if(s=e[r].label,p.font=l=(o=this._resolveTickFontOptions(r)).string,c=g[l]=g[l]||{data:{},gc:[]},u=o.lineHeight,h=d=0,Z(s)||J(s)){if(J(s))for(n=0,a=s.length;n<a;++n)Z(f=s[n])||J(f)||(h=to(p,c.data,c.gc,h,f),d+=u)}else h=to(p,c.data,c.gc,h,s),d=u;v.push(h),y.push(d),x=Math.max(h,x),_=Math.max(d,_)}ea(g,e=>{let i,r=e.gc,n=r.length/2;if(n>t){for(i=0;i<n;++i)delete e.data[r[i]];r.splice(0,n)}});let w=v.indexOf(x),k=y.indexOf(_),E=e=>({width:v[e]||0,height:y[e]||0});return{first:E(0),last:E(t-1),widest:E(w),highest:E(k),widths:v,heights:y}}getLabelForValue(e){return e}getPixelForValue(e,t){return NaN}getValueForPixel(e){}getPixelForTick(e){let t=this.ticks;return e<0||e>t.length-1?null:this.getPixelForValue(t[e].value)}getPixelForDecimal(e){this._reversePixels&&(e=1-e);let t=this._startPixel+e*this._length;return ez(this._alignToPixels?tl(this.chart,t,0):t,-32768,32767)}getDecimalForPixel(e){let t=(e-this._startPixel)/this._length;return this._reversePixels?1-t:t}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){let{min:e,max:t}=this;return e<0&&t<0?t:e>0&&t>0?e:0}getContext(e){var t,i;let r=this.ticks||[];if(e>=0&&e<r.length){let i=r[e];return i.$context||(t=this.getContext(),i.$context=tM(t,{tick:i,index:e,type:"tick"}))}return this.$context||(this.$context=(i=this.chart.getContext(),tM(i,{scale:this,type:"scale"})))}_tickSize(){let e=this.options.ticks,t=eD(this.labelRotation),i=Math.abs(Math.cos(t)),r=Math.abs(Math.sin(t)),n=this._getLabelSizes(),a=e.autoSkipPadding||0,s=n?n.widest.width+a:0,o=n?n.highest.height+a:0;return this.isHorizontal()?o*i>s*r?s/i:o/r:o*r<s*i?o/i:s/r}_isVisible(){let e=this.options.display;return"auto"!==e?!!e:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(e){let t,i,r,n,a,s,o,l,c,u,h,d,f=this.axis,p=this.chart,g=this.options,{grid:v,position:y,border:b}=g,x=v.offset,_=this.isHorizontal(),w=this.ticks.length+ +!!x,k=ro(v),E=[],T=b.setContext(this.getContext()),P=T.display?T.width:0,S=P/2,M=function(e){return tl(p,e,P)};if("top"===y)t=M(this.bottom),s=this.bottom-k,l=t-S,u=M(e.top)+S,d=e.bottom;else if("bottom"===y)t=M(this.top),u=e.top,d=M(e.bottom)-S,s=t+S,l=this.top+k;else if("left"===y)t=M(this.right),a=this.right-k,o=t-S,c=M(e.left)+S,h=e.right;else if("right"===y)t=M(this.left),c=e.left,h=M(e.right)-S,a=t+S,o=this.left+k;else if("x"===f){if("center"===y)t=M((e.top+e.bottom)/2+.5);else if(Q(y)){let e=Object.keys(y)[0],i=y[e];t=M(this.chart.scales[e].getPixelForValue(i))}u=e.top,d=e.bottom,l=(s=t+S)+k}else if("y"===f){if("center"===y)t=M((e.left+e.right)/2);else if(Q(y)){let e=Object.keys(y)[0],i=y[e];t=M(this.chart.scales[e].getPixelForValue(i))}o=(a=t-S)-k,c=e.left,h=e.right}let C=ei(g.ticks.maxTicksLimit,w),A=Math.max(1,Math.ceil(w/C));for(i=0;i<w;i+=A){let e=this.getContext(i),t=v.setContext(e),f=b.setContext(e),g=t.lineWidth,y=t.color,w=f.dash||[],k=f.dashOffset,T=t.tickWidth,P=t.tickColor,S=t.tickBorderDash||[],M=t.tickBorderDashOffset;void 0!==(r=function(e,t,i){let r,n=e.ticks.length,a=Math.min(t,n-1),s=e._startPixel,o=e._endPixel,l=e.getPixelForTick(a);if(!i||(r=1===n?Math.max(l-s,o-l):0===t?(e.getPixelForTick(1)-l)/2:(l-e.getPixelForTick(a-1))/2,!((l+=a<t?r:-r)<s-1e-6)&&!(l>o+1e-6)))return l}(this,i,x))&&(n=tl(p,r,g),_?a=o=c=h=n:s=l=u=d=n,E.push({tx1:a,ty1:s,tx2:o,ty2:l,x1:c,y1:u,x2:h,y2:d,width:g,color:y,borderDash:w,borderDashOffset:k,tickWidth:T,tickColor:P,tickBorderDash:S,tickBorderDashOffset:M}))}return this._ticksLength=w,this._borderValue=t,E}_computeLabelItems(e){let t,i,r,n,a,s,o,l,c,u,h,d=this.axis,f=this.options,{position:p,ticks:g}=f,v=this.isHorizontal(),y=this.ticks,{align:b,crossAlign:x,padding:_,mirror:w}=g,k=ro(f.grid),E=k+_,T=w?-_:E,P=-eD(this.labelRotation),S=[],M="middle";if("top"===p)a=this.bottom-T,s=this._getXAxisLabelAlignment();else if("bottom"===p)a=this.top+T,s=this._getXAxisLabelAlignment();else if("left"===p){let e=this._getYAxisLabelAlignment(k);s=e.textAlign,n=e.x}else if("right"===p){let e=this._getYAxisLabelAlignment(k);s=e.textAlign,n=e.x}else if("x"===d){if("center"===p)a=(e.top+e.bottom)/2+E;else if(Q(p)){let e=Object.keys(p)[0],t=p[e];a=this.chart.scales[e].getPixelForValue(t)+E}s=this._getXAxisLabelAlignment()}else if("y"===d){if("center"===p)n=(e.left+e.right)/2-E;else if(Q(p)){let e=Object.keys(p)[0],t=p[e];n=this.chart.scales[e].getPixelForValue(t)}s=this._getYAxisLabelAlignment(k).textAlign}"y"===d&&("start"===b?M="top":"end"===b&&(M="bottom"));let C=this._getLabelSizes();for(t=0,i=y.length;t<i;++t){let e;r=y[t].label;let d=g.setContext(this.getContext(t));o=this.getPixelForTick(t)+g.labelOffset,c=(l=this._resolveTickFontOptions(t)).lineHeight;let f=(u=J(r)?r.length:1)/2,b=d.color,_=d.textStrokeColor,k=d.textStrokeWidth,E=s;if(v?(n=o,"inner"===s&&(E=t===i-1?this.options.reverse?"left":"right":0===t?this.options.reverse?"right":"left":"center"),h="top"===p?"near"===x||0!==P?-u*c+c/2:"center"===x?-C.highest.height/2-f*c+c:-C.highest.height+c/2:"near"===x||0!==P?c/2:"center"===x?C.highest.height/2-f*c:C.highest.height-u*c,w&&(h*=-1),0===P||d.showLabelBackdrop||(n+=c/2*Math.sin(P))):(a=o,h=(1-u)*c/2),d.showLabelBackdrop){let r=tT(d.backdropPadding),n=C.heights[t],a=C.widths[t],o=h-r.top,l=0-r.left;switch(M){case"middle":o-=n/2;break;case"bottom":o-=n}switch(s){case"center":l-=a/2;break;case"right":l-=a;break;case"inner":t===i-1?l-=a:t>0&&(l-=a/2)}e={left:l,top:o,width:a+r.width,height:n+r.height,color:d.backdropColor}}S.push({label:r,font:l,textOffset:h,options:{rotation:P,color:b,strokeColor:_,strokeWidth:k,textAlign:E,textBaseline:M,translation:[n,a],backdrop:e}})}return S}_getXAxisLabelAlignment(){let{position:e,ticks:t}=this.options;if(-eD(this.labelRotation))return"top"===e?"left":"right";let i="center";return"start"===t.align?i="left":"end"===t.align?i="right":"inner"===t.align&&(i="inner"),i}_getYAxisLabelAlignment(e){let t,i,{position:r,ticks:{crossAlign:n,mirror:a,padding:s}}=this.options,o=this._getLabelSizes(),l=e+s,c=o.widest.width;return"left"===r?a?(i=this.right+s,"near"===n?t="left":"center"===n?(t="center",i+=c/2):(t="right",i+=c)):(i=this.right-l,"near"===n?t="right":"center"===n?(t="center",i-=c/2):(t="left",i=this.left)):"right"===r?a?(i=this.left+s,"near"===n?t="right":"center"===n?(t="center",i-=c/2):(t="left",i-=c)):(i=this.left+l,"near"===n?t="left":"center"===n?(t="center",i+=c/2):(t="right",i=this.right)):t="right",{textAlign:t,x:i}}_computeLabelArea(){if(this.options.ticks.mirror)return;let e=this.chart,t=this.options.position;return"left"===t||"right"===t?{top:0,left:this.left,bottom:e.height,right:this.right}:"top"===t||"bottom"===t?{top:this.top,left:0,bottom:this.bottom,right:e.width}:void 0}drawBackground(){let{ctx:e,options:{backgroundColor:t},left:i,top:r,width:n,height:a}=this;t&&(e.save(),e.fillStyle=t,e.fillRect(i,r,n,a),e.restore())}getLineWidthForValue(e){let t=this.options.grid;if(!this._isVisible()||!t.display)return 0;let i=this.ticks.findIndex(t=>t.value===e);return i>=0?t.setContext(this.getContext(i)).lineWidth:0}drawGrid(e){let t,i,r=this.options.grid,n=this.ctx,a=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(e)),s=(e,t,i)=>{i.width&&i.color&&(n.save(),n.lineWidth=i.width,n.strokeStyle=i.color,n.setLineDash(i.borderDash||[]),n.lineDashOffset=i.borderDashOffset,n.beginPath(),n.moveTo(e.x,e.y),n.lineTo(t.x,t.y),n.stroke(),n.restore())};if(r.display)for(t=0,i=a.length;t<i;++t){let e=a[t];r.drawOnChartArea&&s({x:e.x1,y:e.y1},{x:e.x2,y:e.y2},e),r.drawTicks&&s({x:e.tx1,y:e.ty1},{x:e.tx2,y:e.ty2},{color:e.tickColor,width:e.tickWidth,borderDash:e.tickBorderDash,borderDashOffset:e.tickBorderDashOffset})}}drawBorder(){let e,t,i,r,{chart:n,ctx:a,options:{border:s,grid:o}}=this,l=s.setContext(this.getContext()),c=s.display?l.width:0;if(!c)return;let u=o.setContext(this.getContext(0)).lineWidth,h=this._borderValue;this.isHorizontal()?(e=tl(n,this.left,c)-c/2,t=tl(n,this.right,u)+u/2,i=r=h):(i=tl(n,this.top,c)-c/2,r=tl(n,this.bottom,u)+u/2,e=t=h),a.save(),a.lineWidth=l.width,a.strokeStyle=l.color,a.beginPath(),a.moveTo(e,i),a.lineTo(t,r),a.stroke(),a.restore()}drawLabels(e){if(!this.options.ticks.display)return;let t=this.ctx,i=this._computeLabelArea();for(let r of(i&&tf(t,i),this.getLabelItems(e))){let e=r.options,i=r.font;tv(t,r.label,0,r.textOffset,i,e)}i&&tp(t)}drawTitle(){let e,t,{ctx:i,options:{position:r,title:n,reverse:a}}=this;if(!n.display)return;let s=tP(n.font),o=tT(n.padding),l=n.align,c=s.lineHeight/2;"bottom"===r||"center"===r||Q(r)?(c+=o.bottom,J(n.text)&&(c+=s.lineHeight*(n.text.length-1))):c+=o.top;let{titleX:u,titleY:h,maxWidth:d,rotation:f}=function(e,t,i,r){let n,a,s,{top:o,left:l,bottom:c,right:u,chart:h}=e,{chartArea:d,scales:f}=h,p=0,g=c-o,v=u-l;if(e.isHorizontal()){if(a=eZ(r,l,u),Q(i)){let e=Object.keys(i)[0],r=i[e];s=f[e].getPixelForValue(r)+g-t}else s="center"===i?(d.bottom+d.top)/2+g-t:rn(e,i,t);n=u-l}else{if(Q(i)){let e=Object.keys(i)[0],r=i[e];a=f[e].getPixelForValue(r)-v+t}else a="center"===i?(d.left+d.right)/2-v+t:rn(e,i,t);s=eZ(r,c,o),p="left"===i?-eE:eE}return{titleX:a,titleY:s,maxWidth:n,rotation:p}}(this,c,r,l);tv(i,n.text,0,0,s,{color:n.color,maxWidth:d,rotation:f,textAlign:(e=eK(l),(a&&"right"!==r||!a&&"right"===r)&&(e="left"===(t=e)?"right":"right"===t?"left":t),e),textBaseline:"middle",translation:[u,h]})}draw(e){this._isVisible()&&(this.drawBackground(),this.drawGrid(e),this.drawBorder(),this.drawTitle(),this.drawLabels(e))}_layers(){let e=this.options,t=e.ticks&&e.ticks.z||0,i=ei(e.grid&&e.grid.z,-1),r=ei(e.border&&e.border.z,0);return this._isVisible()&&this.draw===rc.prototype.draw?[{z:i,draw:e=>{this.drawBackground(),this.drawGrid(e),this.drawTitle()}},{z:r,draw:()=>{this.drawBorder()}},{z:t,draw:e=>{this.drawLabels(e)}}]:[{z:t,draw:e=>{this.draw(e)}}]}getMatchingVisibleMetas(e){let t,i,r=this.chart.getSortedVisibleDatasetMetas(),n=this.axis+"AxisID",a=[];for(t=0,i=r.length;t<i;++t){let i=r[t];i[n]!==this.id||e&&i.type!==e||a.push(i)}return a}_resolveTickFontOptions(e){return tP(this.options.ticks.setContext(this.getContext(e)).font)}_maxDigits(){let e=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/e}}class ru{constructor(e,t,i){this.type=e,this.scope=t,this.override=i,this.items=Object.create(null)}isForType(e){return Object.prototype.isPrototypeOf.call(this.type.prototype,e.prototype)}register(e){var t,i,r,n,a,s;let o,l,c=Object.getPrototypeOf(e);"id"in(t=c)&&"defaults"in t&&(l=this.register(c));let u=this.items,h=e.id,d=this.scope+"."+h;if(!h)throw Error("class does not have id: "+e);return h in u||(u[h]=e,i=e,r=d,n=l,o=eu(Object.create(null),[n?ts.get(n):{},ts.get(r),i.defaults]),ts.set(r,o),i.defaultRoutes&&(a=r,Object.keys(s=i.defaultRoutes).forEach(e=>{let t=e.split("."),i=t.pop(),r=[a].concat(t).join("."),n=s[e].split("."),o=n.pop(),l=n.join(".");ts.route(r,i,l,o)})),i.descriptors&&ts.describe(r,i.descriptors),this.override&&ts.override(e.id,e.overrides)),d}get(e){return this.items[e]}unregister(e){let t=this.items,i=e.id,r=this.scope;i in t&&delete t[i],r&&i in ts[r]&&(delete ts[r][i],this.override&&delete ti[i])}}var rh=new class{constructor(){this.controllers=new ru(ik,"datasets",!0),this.elements=new ru(ri,"elements"),this.plugins=new ru(Object,"plugins"),this.scales=new ru(rc,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...e){this._each("register",e)}remove(...e){this._each("unregister",e)}addControllers(...e){this._each("register",e,this.controllers)}addElements(...e){this._each("register",e,this.elements)}addPlugins(...e){this._each("register",e,this.plugins)}addScales(...e){this._each("register",e,this.scales)}getController(e){return this._get(e,this.controllers,"controller")}getElement(e){return this._get(e,this.elements,"element")}getPlugin(e){return this._get(e,this.plugins,"plugin")}getScale(e){return this._get(e,this.scales,"scale")}removeControllers(...e){this._each("unregister",e,this.controllers)}removeElements(...e){this._each("unregister",e,this.elements)}removePlugins(...e){this._each("unregister",e,this.plugins)}removeScales(...e){this._each("unregister",e,this.scales)}_each(e,t,i){[...t].forEach(t=>{let r=i||this._getRegistryForType(t);i||r.isForType(t)||r===this.plugins&&t.id?this._exec(e,r,t):ea(t,t=>{let r=i||this._getRegistryForType(t);this._exec(e,r,t)})})}_exec(e,t,i){let r=eg(e);en(i["before"+r],[],i),t[e](i),en(i["after"+r],[],i)}_getRegistryForType(e){for(let t=0;t<this._typedRegistries.length;t++){let i=this._typedRegistries[t];if(i.isForType(e))return i}return this.plugins}_get(e,t,i){let r=t.get(e);if(void 0===r)throw Error('"'+e+'" is not a registered '+i+".");return r}};class rd{constructor(){this._init=void 0}notify(e,t,i,r){if("beforeInit"===t&&(this._init=this._createDescriptors(e,!0),this._notify(this._init,e,"install")),void 0===this._init)return;let n=r?this._descriptors(e).filter(r):this._descriptors(e),a=this._notify(n,e,t,i);return"afterDestroy"===t&&(this._notify(n,e,"stop"),this._notify(this._init,e,"uninstall"),this._init=void 0),a}_notify(e,t,i,r){for(let n of(r=r||{},e)){let e=n.plugin;if(!1===en(e[i],[t,r,n.options],e)&&r.cancelable)return!1}return!0}invalidate(){Z(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(e){if(this._cache)return this._cache;let t=this._cache=this._createDescriptors(e);return this._notifyStateChanges(e),t}_createDescriptors(e,t){let i=e&&e.config,r=ei(i.options&&i.options.plugins,{}),n=function(e){let t={},i=[],r=Object.keys(rh.plugins.items);for(let e=0;e<r.length;e++)i.push(rh.getPlugin(r[e]));let n=e.plugins||[];for(let e=0;e<n.length;e++){let r=n[e];-1===i.indexOf(r)&&(i.push(r),t[r.id]=!0)}return{plugins:i,localIds:t}}(i);return!1!==r||t?function(e,{plugins:t,localIds:i},r,n){let a=[],s=e.getContext();for(let l of t){var o;let t=l.id,c=(o=r[t],n||!1!==o?!0===o?{}:o:null);null!==c&&a.push({plugin:l,options:function(e,{plugin:t,local:i},r,n){let a=e.pluginScopeKeys(t),s=e.getOptionScopes(r,a);return i&&t.defaults&&s.push(t.defaults),e.createResolver(s,n,[""],{scriptable:!1,indexable:!1,allKeys:!0})}(e.config,{plugin:l,local:i[t]},c,s)})}return a}(e,n,r,t):[]}_notifyStateChanges(e){let t=this._oldCache||[],i=this._cache,r=(e,t)=>e.filter(e=>!t.some(t=>e.plugin.id===t.plugin.id));this._notify(r(t,i),e,"stop"),this._notify(r(i,t),e,"start")}}function rf(e,t){let i=ts.datasets[e]||{};return((t.datasets||{})[e]||{}).indexAxis||t.indexAxis||i.indexAxis||"x"}function rp(e){if("x"===e||"y"===e||"r"===e)return e}function rg(e,...t){if(rp(e))return e;for(let r of t){var i;let t=r.axis||("top"===(i=r.position)||"bottom"===i?"x":"left"===i||"right"===i?"y":void 0)||e.length>1&&rp(e[0].toLowerCase());if(t)return t}throw Error(`Cannot determine type of '${e}' axis. Please provide 'axis' or 'position' option.`)}function rm(e,t,i){if(i[t+"AxisID"]===e)return{axis:t}}function rv(e){let t,i,r,n,a=e.options||(e.options={});a.plugins=ei(a.plugins,{}),t=ti[e.type]||{scales:{}},i=a.scales||{},r=rf(e.type,a),n=Object.create(null),Object.keys(i).forEach(a=>{let s=i[a];if(!Q(s))return console.error(`Invalid scale configuration for scale: ${a}`);if(s._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${a}`);let o=rg(a,s,function(e,t){if(t.data&&t.data.datasets){let i=t.data.datasets.filter(t=>t.xAxisID===e||t.yAxisID===e);if(i.length)return rm(e,"x",i[0])||rm(e,"y",i[0])}return{}}(a,e),ts.scales[s.type]),l=o===r?"_index_":"_value_",c=t.scales||{};n[a]=eh(Object.create(null),[{axis:o},s,c[o],c[l]])}),e.data.datasets.forEach(t=>{let r=t.type||e.type,s=t.indexAxis||rf(r,a),o=(ti[r]||{}).scales||{};Object.keys(o).forEach(e=>{let r,a=(r=e,"_index_"===e?r=s:"_value_"===e&&(r="x"===s?"y":"x"),r),l=t[a+"AxisID"]||a;n[l]=n[l]||Object.create(null),eh(n[l],[{axis:a},i[l],o[e]])})}),Object.keys(n).forEach(e=>{let t=n[e];eh(t,[ts.scales[t.type],ts.scale])}),a.scales=n}function ry(e){return(e=e||{}).datasets=e.datasets||[],e.labels=e.labels||[],e}let rb=new Map,rx=new Set;function r_(e,t){let i=rb.get(e);return i||(i=t(),rb.set(e,i),rx.add(i)),i}let rw=(e,t,i)=>{let r=ep(t,i);void 0!==r&&e.add(r)};class rk{constructor(e){this._config=function(e){return(e=e||{}).data=ry(e.data),rv(e),e}(e),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(e){this._config.type=e}get data(){return this._config.data}set data(e){this._config.data=ry(e)}get options(){return this._config.options}set options(e){this._config.options=e}get plugins(){return this._config.plugins}update(){let e=this._config;this.clearCache(),rv(e)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(e){return r_(e,()=>[[`datasets.${e}`,""]])}datasetAnimationScopeKeys(e,t){return r_(`${e}.transition.${t}`,()=>[[`datasets.${e}.transitions.${t}`,`transitions.${t}`],[`datasets.${e}`,""]])}datasetElementScopeKeys(e,t){return r_(`${e}-${t}`,()=>[[`datasets.${e}.elements.${t}`,`datasets.${e}`,`elements.${t}`,""]])}pluginScopeKeys(e){let t=e.id,i=this.type;return r_(`${i}-plugin-${t}`,()=>[[`plugins.${t}`,...e.additionalOptionScopes||[]]])}_cachedScopes(e,t){let i=this._scopeCache,r=i.get(e);return(!r||t)&&(r=new Map,i.set(e,r)),r}getOptionScopes(e,t,i){let{options:r,type:n}=this,a=this._cachedScopes(e,i),s=a.get(t);if(s)return s;let o=new Set;t.forEach(t=>{e&&(o.add(e),t.forEach(t=>rw(o,e,t))),t.forEach(e=>rw(o,r,e)),t.forEach(e=>rw(o,ti[n]||{},e)),t.forEach(e=>rw(o,ts,e)),t.forEach(e=>rw(o,tr,e))});let l=Array.from(o);return 0===l.length&&l.push(Object.create(null)),rx.has(t)&&a.set(t,l),l}chartOptionScopes(){let{options:e,type:t}=this;return[e,ti[t]||{},ts.datasets[t]||{},{type:t},ts,tr]}resolveNamedOptions(e,t,i,r=[""]){let n={$shared:!0},{resolver:a,subPrefixes:s}=rE(this._resolverCache,e,r),o=a;if(function(e,t){let{isScriptable:i,isIndexable:r}=tI(e);for(let n of t){let t=i(n),a=r(n),s=(a||t)&&e[n];if(t&&(ev(s)||rT(s))||a&&J(s))return!0}return!1}(a,t)){n.$shared=!1,i=ev(i)?i():i;let t=this.createResolver(e,i,s);o=tA(a,i,t)}for(let e of t)n[e]=o[e];return n}createResolver(e,t,i=[""],r){let{resolver:n}=rE(this._resolverCache,e,i);return Q(t)?tA(n,t,void 0,r):n}}function rE(e,t,i){let r=e.get(t);r||(r=new Map,e.set(t,r));let n=i.join(),a=r.get(n);return a||(a={resolver:tC(t,i),subPrefixes:i.filter(e=>!e.toLowerCase().includes("hover"))},r.set(n,a)),a}let rT=e=>Q(e)&&Object.getOwnPropertyNames(e).some(t=>ev(e[t])),rP=["top","bottom","left","right","chartArea"];function rS(e,t){return"top"===e||"bottom"===e||-1===rP.indexOf(e)&&"x"===t}function rM(e,t){return function(i,r){return i[e]===r[e]?i[t]-r[t]:i[e]-r[e]}}function rC(e){let t=e.chart,i=t.options.animation;t.notifyPlugins("afterRender"),en(i&&i.onComplete,[e],t)}function rA(e){let t=e.chart,i=t.options.animation;en(i&&i.onProgress,[e],t)}function rI(e){return tH()&&"string"==typeof e?e=document.getElementById(e):e&&e.length&&(e=e[0]),e&&e.canvas&&(e=e.canvas),e}let rL={},rD=e=>{let t=rI(e);return Object.values(rL).filter(e=>e.canvas===t).pop()};class rO{static defaults=ts;static instances=rL;static overrides=ti;static registry=rh;static version="4.5.1";static getChart=rD;static register(...e){rh.add(...e),rR()}static unregister(...e){rh.remove(...e),rR()}constructor(e,t){const i=this.config=new rk(t),r=rI(e),n=rD(r);if(n)throw Error("Canvas is already in use. Chart with ID '"+n.id+"' must be destroyed before the canvas with ID '"+n.canvas.id+"' can be reused.");const a=i.createResolver(i.chartOptionScopes(),this.getContext());this.platform=new(i.platform||(!tH()||"undefined"!=typeof OffscreenCanvas&&r instanceof OffscreenCanvas?iZ:rt)),this.platform.updateConfig(i);const s=this.platform.acquireContext(r,a.aspectRatio),o=s&&s.canvas,l=o&&o.height,c=o&&o.width;if(this.id=K(),this.ctx=s,this.canvas=o,this.width=c,this.height=l,this._options=a,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new rd,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=function(e,t){let i;return function(...r){return t?(clearTimeout(i),i=setTimeout(e,t,r)):e.apply(this,r),t}}(e=>this.update(e),a.resizeDelay||0),this._dataChanges=[],rL[this.id]=this,!s||!o)return void console.error("Failed to create chart: can't acquire context from the given item");io.listen(this,"complete",rC),io.listen(this,"progress",rA),this._initialize(),this.attached&&this.update()}get aspectRatio(){let{options:{aspectRatio:e,maintainAspectRatio:t},width:i,height:r,_aspectRatio:n}=this;return Z(e)?t&&n?n:r?i/r:null:e}get data(){return this.config.data}set data(e){this.config.data=e}get options(){return this._options}set options(e){this.config.options=e}get registry(){return rh}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():tQ(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return tc(this.canvas,this.ctx),this}stop(){return io.stop(this),this}resize(e,t){io.running(this)?this._resizeBeforeDraw={width:e,height:t}:this._resize(e,t)}_resize(e,t){let i=this.options,r=this.canvas,n=i.maintainAspectRatio&&this.aspectRatio,a=this.platform.getMaximumSize(r,e,t,n),s=i.devicePixelRatio||this.platform.getDevicePixelRatio(),o=this.width?"resize":"attach";this.width=a.width,this.height=a.height,this._aspectRatio=this.aspectRatio,tQ(this,s,!0)&&(this.notifyPlugins("resize",{size:a}),en(i.onResize,[this,a],this),this.attached&&this._doResize(o)&&this.render())}ensureScalesHaveIDs(){ea(this.options.scales||{},(e,t)=>{e.id=t})}buildOrUpdateScales(){let e=this.options,t=e.scales,i=this.scales,r=Object.keys(i).reduce((e,t)=>(e[t]=!1,e),{}),n=[];t&&(n=n.concat(Object.keys(t).map(e=>{let i=t[e],r=rg(e,i),n="r"===r,a="x"===r;return{options:i,dposition:n?"chartArea":a?"bottom":"left",dtype:n?"radialLinear":a?"category":"linear"}}))),ea(n,t=>{let n=t.options,a=n.id,s=rg(a,n),o=ei(n.type,t.dtype);(void 0===n.position||rS(n.position,s)!==rS(t.dposition))&&(n.position=t.dposition),r[a]=!0;let l=null;a in i&&i[a].type===o?l=i[a]:i[(l=new(rh.getScale(o))({id:a,type:o,ctx:this.ctx,chart:this})).id]=l,l.init(n,e)}),ea(r,(e,t)=>{e||delete i[t]}),ea(i,e=>{iX.configure(this,e,e.options),iX.addBox(this,e)})}_updateMetasets(){let e=this._metasets,t=this.data.datasets.length,i=e.length;if(e.sort((e,t)=>e.index-t.index),i>t){for(let e=t;e<i;++e)this._destroyDatasetMeta(e);e.splice(t,i-t)}this._sortedMetasets=e.slice(0).sort(rM("order","index"))}_removeUnreferencedMetasets(){let{_metasets:e,data:{datasets:t}}=this;e.length>t.length&&delete this._stacks,e.forEach((e,i)=>{0===t.filter(t=>t===e._dataset).length&&this._destroyDatasetMeta(i)})}buildOrUpdateControllers(){let e,t,i=[],r=this.data.datasets;for(this._removeUnreferencedMetasets(),e=0,t=r.length;e<t;e++){let t=r[e],n=this.getDatasetMeta(e),a=t.type||this.config.type;if(n.type&&n.type!==a&&(this._destroyDatasetMeta(e),n=this.getDatasetMeta(e)),n.type=a,n.indexAxis=t.indexAxis||rf(a,this.options),n.order=t.order||0,n.index=e,n.label=""+t.label,n.visible=this.isDatasetVisible(e),n.controller)n.controller.updateIndex(e),n.controller.linkScales();else{let t=rh.getController(a),{datasetElementType:r,dataElementType:s}=ts.datasets[a];Object.assign(t,{dataElementType:rh.getElement(s),datasetElementType:r&&rh.getElement(r)}),n.controller=new t(this,e),i.push(n.controller)}}return this._updateMetasets(),i}_resetElements(){ea(this.data.datasets,(e,t)=>{this.getDatasetMeta(t).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(e){let t=this.config;t.update();let i=this._options=t.createResolver(t.chartOptionScopes(),this.getContext()),r=this._animationsDisabled=!i.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),!1===this.notifyPlugins("beforeUpdate",{mode:e,cancelable:!0}))return;let n=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let a=0;for(let e=0,t=this.data.datasets.length;e<t;e++){let{controller:t}=this.getDatasetMeta(e),i=!r&&-1===n.indexOf(t);t.buildOrUpdateElements(i),a=Math.max(+t.getMaxOverflow(),a)}a=this._minPadding=i.layout.autoPadding?a:0,this._updateLayout(a),r||ea(n,e=>{e.reset()}),this._updateDatasets(e),this.notifyPlugins("afterUpdate",{mode:e}),this._layers.sort(rM("z","_idx"));let{_active:s,_lastEvent:o}=this;o?this._eventHandler(o,!0):s.length&&this._updateHoverStyles(s,s,!0),this.render()}_updateScales(){ea(this.scales,e=>{iX.removeBox(this,e)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){let e=this.options;ey(new Set(Object.keys(this._listeners)),new Set(e.events))&&!!this._responsiveListeners===e.responsive||(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){let{_hiddenIndices:e}=this;for(let{method:i,start:r,count:n}of this._getUniformDataChanges()||[]){var t="_removeElements"===i?-n:n;for(let i of Object.keys(e)){let n=+i;if(n>=r){let a=e[i];delete e[i],(t>0||n>r)&&(e[n+t]=a)}}}}_getUniformDataChanges(){let e=this._dataChanges;if(!e||!e.length)return;this._dataChanges=[];let t=this.data.datasets.length,i=t=>new Set(e.filter(e=>e[0]===t).map((e,t)=>t+","+e.splice(1).join(","))),r=i(0);for(let e=1;e<t;e++)if(!ey(r,i(e)))return;return Array.from(r).map(e=>e.split(",")).map(e=>({method:e[1],start:+e[2],count:+e[3]}))}_updateLayout(e){if(!1===this.notifyPlugins("beforeLayout",{cancelable:!0}))return;iX.update(this,this.width,this.height,e);let t=this.chartArea,i=t.width<=0||t.height<=0;this._layers=[],ea(this.boxes,e=>{i&&"chartArea"===e.position||(e.configure&&e.configure(),this._layers.push(...e._layers()))},this),this._layers.forEach((e,t)=>{e._idx=t}),this.notifyPlugins("afterLayout")}_updateDatasets(e){if(!1!==this.notifyPlugins("beforeDatasetsUpdate",{mode:e,cancelable:!0})){for(let e=0,t=this.data.datasets.length;e<t;++e)this.getDatasetMeta(e).controller.configure();for(let t=0,i=this.data.datasets.length;t<i;++t)this._updateDataset(t,ev(e)?e({datasetIndex:t}):e);this.notifyPlugins("afterDatasetsUpdate",{mode:e})}}_updateDataset(e,t){let i=this.getDatasetMeta(e),r={meta:i,index:e,mode:t,cancelable:!0};!1!==this.notifyPlugins("beforeDatasetUpdate",r)&&(i.controller._update(t),r.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",r))}render(){!1!==this.notifyPlugins("beforeRender",{cancelable:!0})&&(io.has(this)?this.attached&&!io.running(this)&&io.start(this):(this.draw(),rC({chart:this})))}draw(){let e;if(this._resizeBeforeDraw){let{width:e,height:t}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(e,t)}if(this.clear(),this.width<=0||this.height<=0||!1===this.notifyPlugins("beforeDraw",{cancelable:!0}))return;let t=this._layers;for(e=0;e<t.length&&t[e].z<=0;++e)t[e].draw(this.chartArea);for(this._drawDatasets();e<t.length;++e)t[e].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(e){let t,i,r=this._sortedMetasets,n=[];for(t=0,i=r.length;t<i;++t){let i=r[t];(!e||i.visible)&&n.push(i)}return n}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(!1===this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0}))return;let e=this.getSortedVisibleDatasetMetas();for(let t=e.length-1;t>=0;--t)this._drawDataset(e[t]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(e){let t=this.ctx,i={meta:e,index:e.index,cancelable:!0},r=is(this,e);!1!==this.notifyPlugins("beforeDatasetDraw",i)&&(r&&tf(t,r),e.controller.draw(),r&&tp(t),i.cancelable=!1,this.notifyPlugins("afterDatasetDraw",i))}isPointInArea(e){return td(e,this.chartArea,this._minPadding)}getElementsAtEventForMode(e,t,i,r){let n=iF.modes[t];return"function"==typeof n?n(this,e,i,r):[]}getDatasetMeta(e){let t=this.data.datasets[e],i=this._metasets,r=i.filter(e=>e&&e._dataset===t).pop();return r||(r={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:t&&t.order||0,index:e,_dataset:t,_parsed:[],_sorted:!1},i.push(r)),r}getContext(){return this.$context||(this.$context=tM(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(e){let t=this.data.datasets[e];if(!t)return!1;let i=this.getDatasetMeta(e);return"boolean"==typeof i.hidden?!i.hidden:!t.hidden}setDatasetVisibility(e,t){this.getDatasetMeta(e).hidden=!t}toggleDataVisibility(e){this._hiddenIndices[e]=!this._hiddenIndices[e]}getDataVisibility(e){return!this._hiddenIndices[e]}_updateVisibility(e,t,i){let r=i?"show":"hide",n=this.getDatasetMeta(e),a=n.controller._resolveAnimations(void 0,r);em(t)?(n.data[t].hidden=!i,this.update()):(this.setDatasetVisibility(e,i),a.update(n,{visible:i}),this.update(t=>t.datasetIndex===e?r:void 0))}hide(e,t){this._updateVisibility(e,t,!1)}show(e,t){this._updateVisibility(e,t,!0)}_destroyDatasetMeta(e){let t=this._metasets[e];t&&t.controller&&t.controller._destroy(),delete this._metasets[e]}_stop(){let e,t;for(this.stop(),io.remove(this),e=0,t=this.data.datasets.length;e<t;++e)this._destroyDatasetMeta(e)}destroy(){this.notifyPlugins("beforeDestroy");let{canvas:e,ctx:t}=this;this._stop(),this.config.clearCache(),e&&(this.unbindEvents(),tc(e,t),this.platform.releaseContext(t),this.canvas=null,this.ctx=null),delete rL[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...e){return this.canvas.toDataURL(...e)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){let e=this._listeners,t=this.platform,i=(i,r)=>{t.addEventListener(this,i,r),e[i]=r},r=(e,t,i)=>{e.offsetX=t,e.offsetY=i,this._eventHandler(e)};ea(this.options.events,e=>i(e,r))}bindResponsiveEvents(){let e;this._responsiveListeners||(this._responsiveListeners={});let t=this._responsiveListeners,i=this.platform,r=(e,r)=>{i.addEventListener(this,e,r),t[e]=r},n=(e,r)=>{t[e]&&(i.removeEventListener(this,e,r),delete t[e])},a=(e,t)=>{this.canvas&&this.resize(e,t)},s=()=>{n("attach",s),this.attached=!0,this.resize(),r("resize",a),r("detach",e)};e=()=>{this.attached=!1,n("resize",a),this._stop(),this._resize(0,0),r("attach",s)},i.isAttached(this.canvas)?s():e()}unbindEvents(){ea(this._listeners,(e,t)=>{this.platform.removeEventListener(this,t,e)}),this._listeners={},ea(this._responsiveListeners,(e,t)=>{this.platform.removeEventListener(this,t,e)}),this._responsiveListeners=void 0}updateHoverStyle(e,t,i){let r,n,a,s=i?"set":"remove";for("dataset"===t&&this.getDatasetMeta(e[0].datasetIndex).controller["_"+s+"DatasetHoverStyle"](),n=0,a=e.length;n<a;++n){let t=(r=e[n])&&this.getDatasetMeta(r.datasetIndex).controller;t&&t[s+"HoverStyle"](r.element,r.datasetIndex,r.index)}}getActiveElements(){return this._active||[]}setActiveElements(e){let t=this._active||[],i=e.map(({datasetIndex:e,index:t})=>{let i=this.getDatasetMeta(e);if(!i)throw Error("No dataset found at index "+e);return{datasetIndex:e,element:i.data[t],index:t}});es(i,t)||(this._active=i,this._lastEvent=null,this._updateHoverStyles(i,t))}notifyPlugins(e,t,i){return this._plugins.notify(this,e,t,i)}isPluginEnabled(e){return 1===this._plugins._cache.filter(t=>t.plugin.id===e).length}_updateHoverStyles(e,t,i){let r=this.options.hover,n=(e,t)=>e.filter(e=>!t.some(t=>e.datasetIndex===t.datasetIndex&&e.index===t.index)),a=n(t,e),s=i?e:n(e,t);a.length&&this.updateHoverStyle(a,r.mode,!1),s.length&&r.mode&&this.updateHoverStyle(s,r.mode,!0)}_eventHandler(e,t){let i={event:e,replay:t,cancelable:!0,inChartArea:this.isPointInArea(e)},r=t=>(t.options.events||this.options.events).includes(e.native.type);if(!1===this.notifyPlugins("beforeEvent",i,r))return;let n=this._handleEvent(e,t,i.inChartArea);return i.cancelable=!1,this.notifyPlugins("afterEvent",i,r),(n||i.changed)&&this.render(),this}_handleEvent(e,t,i){var r;let{_active:n=[],options:a}=this,s=this._getActiveElements(e,n,i,t),o="mouseup"===e.type||"click"===e.type||"contextmenu"===e.type,l=(r=this._lastEvent,i&&"mouseout"!==e.type?o?r:e:null);i&&(this._lastEvent=null,en(a.onHover,[e,s,this],this),o&&en(a.onClick,[e,s,this],this));let c=!es(s,n);return(c||t)&&(this._active=s,this._updateHoverStyles(s,n,t)),this._lastEvent=l,c}_getActiveElements(e,t,i,r){if("mouseout"===e.type)return[];if(!i)return t;let n=this.options.hover;return this.getElementsAtEventForMode(e,n.mode,n,r)}}function rR(){return ea(rO.instances,e=>e._plugins.invalidate())}function rN(e,t,i,r){return{x:i+e*Math.cos(t),y:r+e*Math.sin(t)}}function rj(e,t,i,r,n,a){var s,o,l,c;let u,h,d,f,{x:p,y:g,startAngle:v,pixelMargin:y,innerRadius:b}=t,x=Math.max(t.outerRadius+r+i-y,0),_=b>0?b+r+i+y:0,w=0,k=n-v;if(r){let e=x>0?x-r:0,t=((b>0?b-r:0)+e)/2;w=(k-(0!==t?k*t/(t+r):k))/2}let E=Math.max(.001,k*x-i/eb)/x,T=(k-E)/2,P=v+T+w,S=n-T-w,{outerStart:M,outerEnd:C,innerStart:A,innerEnd:I}=(s=t,o=_,l=x,c=S-P,u=tw(s.options.borderRadius,["outerStart","outerEnd","innerStart","innerEnd"]),d=Math.min(h=(l-o)/2,c*o/2),{outerStart:(f=e=>{let t=(l-Math.min(h,e))*c/2;return ez(e,0,Math.min(h,t))})(u.outerStart),outerEnd:f(u.outerEnd),innerStart:ez(u.innerStart,0,d),innerEnd:ez(u.innerEnd,0,d)}),L=x-M,D=x-C,O=P+M/L,R=S-C/D,N=_+A,j=_+I,B=P+A/N,F=S-I/j;if(e.beginPath(),a){let t=(O+R)/2;if(e.arc(p,g,x,O,t),e.arc(p,g,x,t,R),C>0){let t=rN(D,R,p,g);e.arc(t.x,t.y,C,R,S+eE)}let i=rN(j,S,p,g);if(e.lineTo(i.x,i.y),I>0){let t=rN(j,F,p,g);e.arc(t.x,t.y,I,S+eE,F+Math.PI)}let r=(S-I/_+(P+A/_))/2;if(e.arc(p,g,_,S-I/_,r,!0),e.arc(p,g,_,r,P+A/_,!0),A>0){let t=rN(N,B,p,g);e.arc(t.x,t.y,A,B+Math.PI,P-eE)}let n=rN(L,P,p,g);if(e.lineTo(n.x,n.y),M>0){let t=rN(L,O,p,g);e.arc(t.x,t.y,M,P-eE,O)}}else{e.moveTo(p,g);let t=Math.cos(O)*x+p,i=Math.sin(O)*x+g;e.lineTo(t,i);let r=Math.cos(R)*x+p,n=Math.sin(R)*x+g;e.lineTo(r,n)}e.closePath()}class rB extends ri{static id="arc";static defaults={borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0,selfJoin:!1};static defaultRoutes={backgroundColor:"backgroundColor"};static descriptors={_scriptable:!0,_indexable:e=>"borderDash"!==e};circumference;endAngle;fullCircles;innerRadius;outerRadius;pixelMargin;startAngle;constructor(e){super(),this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,e&&Object.assign(this,e)}inRange(e,t,i){let{angle:r,distance:n}=eR(this.getProps(["x","y"],i),{x:e,y:t}),{startAngle:a,endAngle:s,innerRadius:o,outerRadius:l,circumference:c}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],i),u=(this.options.spacing+this.options.borderWidth)/2,h=ei(c,s-a),d=eF(r,a,s)&&a!==s,f=h>=ex||d,p=eV(n,o+u,l+u);return f&&p}getCenterPoint(e){let{x:t,y:i,startAngle:r,endAngle:n,innerRadius:a,outerRadius:s}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],e),{offset:o,spacing:l}=this.options,c=(r+n)/2,u=(a+s+l+o)/2;return{x:t+Math.cos(c)*u,y:i+Math.sin(c)*u}}tooltipPosition(e){return this.getCenterPoint(e)}draw(e){let{options:t,circumference:i}=this,r=(t.offset||0)/4,n=(t.spacing||0)/2,a=t.circular;if(this.pixelMargin=.33*("inner"===t.borderAlign),this.fullCircles=i>ex?Math.floor(i/ex):0,0===i||this.innerRadius<0||this.outerRadius<0)return;e.save();let s=(this.startAngle+this.endAngle)/2;e.translate(Math.cos(s)*r,Math.sin(s)*r);let o=r*(1-Math.sin(Math.min(eb,i||0)));e.fillStyle=t.backgroundColor,e.strokeStyle=t.borderColor,function(e,t,i,r,n){let{fullCircles:a,startAngle:s,circumference:o}=t,l=t.endAngle;if(a){rj(e,t,i,r,l,n);for(let t=0;t<a;++t)e.fill();isNaN(o)||(l=s+(o%ex||ex))}rj(e,t,i,r,l,n),e.fill()}(e,this,o,n,a),function(e,t,i,r,n){let{fullCircles:a,startAngle:s,circumference:o,options:l}=t,{borderWidth:c,borderJoinStyle:u,borderDash:h,borderDashOffset:d,borderRadius:f}=l,p="inner"===l.borderAlign;if(!c)return;e.setLineDash(h||[]),e.lineDashOffset=d,p?(e.lineWidth=2*c,e.lineJoin=u||"round"):(e.lineWidth=c,e.lineJoin=u||"bevel");let g=t.endAngle;if(a){rj(e,t,i,r,g,n);for(let t=0;t<a;++t)e.stroke();isNaN(o)||(g=s+(o%ex||ex))}p&&function(e,t,i){let{startAngle:r,pixelMargin:n,x:a,y:s,outerRadius:o,innerRadius:l}=t,c=n/o;e.beginPath(),e.arc(a,s,o,r-c,i+c),l>n?(c=n/l,e.arc(a,s,l,i+c,r-c,!0)):e.arc(a,s,n,i+eE,r-eE),e.closePath(),e.clip()}(e,t,g),l.selfJoin&&g-s>=eb&&0===f&&"miter"!==u&&function(e,t,i){let{startAngle:r,x:n,y:a,outerRadius:s,innerRadius:o,options:l}=t,{borderWidth:c,borderJoinStyle:u}=l,h=Math.min(c/s,eB(r-i));if(e.beginPath(),e.arc(n,a,s-c/2,r+h/2,i-h/2),o>0){let t=Math.min(c/o,eB(r-i));e.arc(n,a,o+c/2,i-t/2,r+t/2,!0)}else{let t=Math.min(c/2,s*eB(r-i));if("round"===u)e.arc(n,a,t,i-eb/2,r+eb/2,!0);else if("bevel"===u){let s=2*t*t,o=-s*Math.cos(i+eb/2)+n,l=-s*Math.sin(i+eb/2)+a,c=s*Math.cos(r+eb/2)+n,u=s*Math.sin(r+eb/2)+a;e.lineTo(o,l),e.lineTo(c,u)}}e.closePath(),e.moveTo(0,0),e.rect(0,0,e.canvas.width,e.canvas.height),e.clip("evenodd")}(e,t,g),a||(rj(e,t,i,r,g,n),e.stroke())}(e,this,o,n,a),e.restore()}}function rF(e,t,i=t){e.lineCap=ei(i.borderCapStyle,t.borderCapStyle),e.setLineDash(ei(i.borderDash,t.borderDash)),e.lineDashOffset=ei(i.borderDashOffset,t.borderDashOffset),e.lineJoin=ei(i.borderJoinStyle,t.borderJoinStyle),e.lineWidth=ei(i.borderWidth,t.borderWidth),e.strokeStyle=ei(i.borderColor,t.borderColor)}function rz(e,t,i){e.lineTo(i.x,i.y)}function rV(e,t,i={}){let r=e.length,{start:n=0,end:a=r-1}=i,{start:s,end:o}=t,l=Math.max(n,s),c=Math.min(a,o);return{count:r,start:l,loop:t.loop,ilen:c<l&&!(n<s&&a<s||n>o&&a>o)?r+c-l:c-l}}function rU(e,t,i,r){let n,a,s,{points:o,options:l}=t,{count:c,start:u,loop:h,ilen:d}=rV(o,i,r),f=l.stepped?tg:l.tension||"monotone"===l.cubicInterpolationMode?tm:rz,{move:p=!0,reverse:g}=r||{};for(n=0;n<=d;++n)(a=o[(u+(g?d-n:n))%c]).skip||(p?(e.moveTo(a.x,a.y),p=!1):f(e,s,a,g,l.stepped),s=a);return h&&f(e,s,a=o[(u+(g?d:0))%c],g,l.stepped),!!h}function r$(e,t,i,r){let n,a,s,o,l,c,u=t.points,{count:h,start:d,ilen:f}=rV(u,i,r),{move:p=!0,reverse:g}=r||{},v=0,y=0,b=e=>(d+(g?f-e:e))%h,x=()=>{o!==l&&(e.lineTo(v,l),e.lineTo(v,o),e.lineTo(v,c))};for(p&&(a=u[b(0)],e.moveTo(a.x,a.y)),n=0;n<=f;++n){if((a=u[b(n)]).skip)continue;let t=a.x,i=a.y,r=0|t;r===s?(i<o?o=i:i>l&&(l=i),v=(y*v+t)/++y):(x(),e.lineTo(t,i),s=r,y=0,o=l=i),c=i}x()}function rW(e){let t=e.options,i=t.borderDash&&t.borderDash.length;return e._decimated||e._loop||t.tension||"monotone"===t.cubicInterpolationMode||t.stepped||i?rU:r$}let rH="function"==typeof Path2D;class rq extends ri{static id="line";static defaults={borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};static descriptors={_scriptable:!0,_indexable:e=>"borderDash"!==e&&"fill"!==e};constructor(e){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,e&&Object.assign(this,e)}updateControlPoints(e,t){let i=this.options;if((i.tension||"monotone"===i.cubicInterpolationMode)&&!i.stepped&&!this._pointsUpdated){let r=i.spanGaps?this._loop:this._fullLoop;!function(e,t,i,r,n){let a,s,o,l;if(t.spanGaps&&(e=e.filter(e=>!e.skip)),"monotone"===t.cubicInterpolationMode)!function(e,t="x"){let i,r,n,a=t$(t),s=e.length,o=Array(s).fill(0),l=Array(s),c=tU(e,0);for(i=0;i<s;++i)if(r=n,n=c,c=tU(e,i+1),n){if(c){let e=c[t]-n[t];o[i]=0!==e?(c[a]-n[a])/e:0}l[i]=r?c?eM(o[i-1])!==eM(o[i])?0:(o[i-1]+o[i])/2:o[i-1]:o[i]}!function(e,t,i){let r,n,a,s,o,l=e.length,c=tU(e,0);for(let u=0;u<l-1;++u)if(o=c,c=tU(e,u+1),o&&c){if(eC(t[u],0,tV)){i[u]=i[u+1]=0;continue}(s=Math.pow(r=i[u]/t[u],2)+Math.pow(n=i[u+1]/t[u],2))<=9||(a=3/Math.sqrt(s),i[u]=r*a*t[u],i[u+1]=n*a*t[u])}}(e,o,l),function(e,t,i="x"){let r,n,a,s=t$(i),o=e.length,l=tU(e,0);for(let c=0;c<o;++c){if(n=a,a=l,l=tU(e,c+1),!a)continue;let o=a[i],u=a[s];n&&(r=(o-n[i])/3,a[`cp1${i}`]=o-r,a[`cp1${s}`]=u-r*t[c]),l&&(r=(l[i]-o)/3,a[`cp2${i}`]=o+r,a[`cp2${s}`]=u+r*t[c])}}(e,l,t)}(e,n);else{let i=r?e[e.length-1]:e[0];for(a=0,s=e.length;a<s;++a)l=function(e,t,i,r){let n=e.skip?t:e,a=i.skip?t:i,s=eN(t,n),o=eN(a,t),l=s/(s+o),c=o/(s+o);l=isNaN(l)?0:l,c=isNaN(c)?0:c;let u=r*l,h=r*c;return{previous:{x:t.x-u*(a.x-n.x),y:t.y-u*(a.y-n.y)},next:{x:t.x+h*(a.x-n.x),y:t.y+h*(a.y-n.y)}}}(i,o=e[a],e[Math.min(a+1,s-!r)%s],t.tension),o.cp1x=l.previous.x,o.cp1y=l.previous.y,o.cp2x=l.next.x,o.cp2y=l.next.y,i=o}t.capBezierPoints&&function(e,t){let i,r,n,a,s,o=td(e[0],t);for(i=0,r=e.length;i<r;++i)s=a,a=o,o=i<r-1&&td(e[i+1],t),a&&(n=e[i],s&&(n.cp1x=tW(n.cp1x,t.left,t.right),n.cp1y=tW(n.cp1y,t.top,t.bottom)),o&&(n.cp2x=tW(n.cp2x,t.left,t.right),n.cp2y=tW(n.cp2y,t.top,t.bottom)))}(e,i)}(this._points,i,e,r,t),this._pointsUpdated=!0}}set points(e){this._points=e,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=function(e,t){let i=e.points,r=e.options.spanGaps,n=i.length;if(!n)return[];let a=!!e._loop,{start:s,end:o}=function(e,t,i,r){let n=0,a=t-1;if(i&&!r)for(;n<t&&!e[n].skip;)n++;for(;n<t&&e[n].skip;)n++;for(n%=t,i&&(a+=n);a>n&&e[a%t].skip;)a--;return{start:n,end:a%=t}}(i,n,a,r);if(!0===r)return ii(e,[{start:s,end:o,loop:a}],i,t);let l=o<s?o+n:o,c=!!e._fullLoop&&0===s&&o===n-1;return ii(e,function(e,t,i,r){let n,a=e.length,s=[],o=t,l=e[t];for(n=t+1;n<=i;++n){let i=e[n%a];i.skip||i.stop?l.skip||(r=!1,s.push({start:t%a,end:(n-1)%a,loop:r}),t=o=i.stop?n:null):(o=n,l.skip&&(t=n)),l=i}return null!==o&&s.push({start:t%a,end:o%a,loop:r}),s}(i,s,l,c),i,t)}(this,this.options.segment))}first(){let e=this.segments,t=this.points;return e.length&&t[e[0].start]}last(){let e=this.segments,t=this.points,i=e.length;return i&&t[e[i-1].end]}interpolate(e,t){let i,r,n=this.options,a=e[t],s=this.points,o=it(this,{property:t,start:a,end:a});if(!o.length)return;let l=[],c=n.stepped?t3:n.tension||"monotone"===n.cubicInterpolationMode?t4:t2;for(i=0,r=o.length;i<r;++i){let{start:r,end:u}=o[i],h=s[r],d=s[u];if(h===d){l.push(h);continue}let f=Math.abs((a-h[t])/(d[t]-h[t])),p=c(h,d,f,n.stepped);p[t]=e[t],l.push(p)}return 1===l.length?l[0]:l}pathSegment(e,t,i){return rW(this)(e,this,t,i)}path(e,t,i){let r=this.segments,n=rW(this),a=this._loop;for(let s of(t=t||0,i=i||this.points.length-t,r))a&=n(e,this,s,{start:t,end:t+i-1});return!!a}draw(e,t,i,r){let n=this.options||{};(this.points||[]).length&&n.borderWidth&&(e.save(),function(e,t,i,r){if(rH&&!t.options.segment){let n;(n=t._path)||(n=t._path=new Path2D,t.path(n,i,r)&&n.closePath()),rF(e,t.options),e.stroke(n)}else!function(e,t,i,r){let{segments:n,options:a}=t,s=rW(t);for(let o of n)rF(e,a,o.style),e.beginPath(),s(e,t,o,{start:i,end:i+r-1})&&e.closePath(),e.stroke()}(e,t,i,r)}(e,this,i,r),e.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}function rG(e,t,i,r){let n=e.options,{[i]:a}=e.getProps([i],r);return Math.abs(t-a)<n.radius+n.hitRadius}class rY extends ri{static id="point";parsed;skip;stop;static defaults={borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(e){super(),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,e&&Object.assign(this,e)}inRange(e,t,i){let r=this.options,{x:n,y:a}=this.getProps(["x","y"],i);return Math.pow(e-n,2)+Math.pow(t-a,2)<Math.pow(r.hitRadius+r.radius,2)}inXRange(e,t){return rG(this,e,"x",t)}inYRange(e,t){return rG(this,e,"y",t)}getCenterPoint(e){let{x:t,y:i}=this.getProps(["x","y"],e);return{x:t,y:i}}size(e){let t=(e=e||this.options||{}).radius||0,i=(t=Math.max(t,t&&e.hoverRadius||0))&&e.borderWidth||0;return(t+i)*2}draw(e,t){let i=this.options;!this.skip&&!(i.radius<.1)&&td(this,t,this.size(i)/2)&&(e.strokeStyle=i.borderColor,e.lineWidth=i.borderWidth,e.fillStyle=i.backgroundColor,tu(e,i,this.x,this.y))}getRange(){let e=this.options||{};return e.radius+e.hitRadius}}function rX(e,t){let i,r,n,a,s,{x:o,y:l,base:c,width:u,height:h}=e.getProps(["x","y","base","width","height"],t);return e.horizontal?(s=h/2,i=Math.min(o,c),r=Math.max(o,c),n=l-s,a=l+s):(i=o-(s=u/2),r=o+s,n=Math.min(l,c),a=Math.max(l,c)),{left:i,top:n,right:r,bottom:a}}function rK(e,t,i,r){return e?0:ez(t,i,r)}function rZ(e,t,i,r){let n=null===t,a=null===i,s=e&&!(n&&a)&&rX(e,r);return s&&(n||eV(t,s.left,s.right))&&(a||eV(i,s.top,s.bottom))}function rJ(e,t){e.rect(t.x,t.y,t.w,t.h)}function rQ(e,t,i={}){let r=e.x!==i.x?-t:0,n=e.y!==i.y?-t:0,a=(e.x+e.w!==i.x+i.w?t:0)-r,s=(e.y+e.h!==i.y+i.h?t:0)-n;return{x:e.x+r,y:e.y+n,w:e.w+a,h:e.h+s,radius:e.radius}}class r0 extends ri{static id="bar";static defaults={borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(e){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,e&&Object.assign(this,e)}draw(e){var t,i,r;let n,a,s,o,l,c,u,h,{inflateAmount:d,options:{borderColor:f,backgroundColor:p}}=this,{inner:g,outer:v}=(a=(n=rX(this)).right-n.left,s=n.bottom-n.top,t=a/2,i=s/2,o=this.options.borderWidth,l=this.borderSkipped,c=tk(o),u={t:rK(l.top,c.top,0,i),r:rK(l.right,c.right,0,t),b:rK(l.bottom,c.bottom,0,i),l:rK(l.left,c.left,0,t)},h=function(e,t,i){let{enableBorderRadius:r}=e.getProps(["enableBorderRadius"]),n=e.options.borderRadius,a=tE(n),s=Math.min(t,i),o=e.borderSkipped,l=r||Q(n);return{topLeft:rK(!l||o.top||o.left,a.topLeft,0,s),topRight:rK(!l||o.top||o.right,a.topRight,0,s),bottomLeft:rK(!l||o.bottom||o.left,a.bottomLeft,0,s),bottomRight:rK(!l||o.bottom||o.right,a.bottomRight,0,s)}}(this,a/2,s/2),{outer:{x:n.left,y:n.top,w:a,h:s,radius:h},inner:{x:n.left+u.l,y:n.top+u.t,w:a-u.l-u.r,h:s-u.t-u.b,radius:{topLeft:Math.max(0,h.topLeft-Math.max(u.t,u.l)),topRight:Math.max(0,h.topRight-Math.max(u.t,u.r)),bottomLeft:Math.max(0,h.bottomLeft-Math.max(u.b,u.l)),bottomRight:Math.max(0,h.bottomRight-Math.max(u.b,u.r))}}}),y=(r=v.radius).topLeft||r.topRight||r.bottomLeft||r.bottomRight?ty:rJ;e.save(),(v.w!==g.w||v.h!==g.h)&&(e.beginPath(),y(e,rQ(v,d,g)),e.clip(),y(e,rQ(g,-d,v)),e.fillStyle=f,e.fill("evenodd")),e.beginPath(),y(e,rQ(g,d)),e.fillStyle=p,e.fill(),e.restore()}inRange(e,t,i){return rZ(this,e,t,i)}inXRange(e,t){return rZ(this,e,null,t)}inYRange(e,t){return rZ(this,null,e,t)}getCenterPoint(e){let{x:t,y:i,base:r,horizontal:n}=this.getProps(["x","y","base","horizontal"],e);return{x:n?(t+r)/2:t,y:n?i:(i+r)/2}}getRange(e){return"x"===e?this.width/2:this.height/2}}let r1=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],r2=r1.map(e=>e.replace("rgb(","rgba(").replace(")",", 0.5)"));function r3(e,t,i,r){if(r)return;let n=t[e],a=i[e];return"angle"===e&&(n=eB(n),a=eB(a)),{property:e,start:n,end:a}}function r4(e,t,i){for(;t>e;t--){let e=i[t];if(!isNaN(e.x)&&!isNaN(e.y))break}return t}function r5(e,t,i,r){return e&&t?r(e[i],t[i]):e?e[i]:t?t[i]:0}function r6(e,t){let i=[],r=!1;return J(e)?(r=!0,i=e):i=function(e,t){let{x:i=null,y:r=null}=e||{},n=t.points,a=[];return t.segments.forEach(({start:e,end:t})=>{t=r4(e,t,n);let s=n[e],o=n[t];null!==r?(a.push({x:s.x,y:r}),a.push({x:o.x,y:r})):null!==i&&(a.push({x:i,y:s.y}),a.push({x:i,y:o.y}))}),a}(e,t),i.length?new rq({points:i,options:{tension:0},_loop:r,_fullLoop:r}):null}function r8(e){return e&&!1!==e.fill}class r9{constructor(e){this.x=e.x,this.y=e.y,this.radius=e.radius}pathSegment(e,t,i){let{x:r,y:n,radius:a}=this;return t=t||{start:0,end:ex},e.arc(r,n,a,t.end,t.start,!0),!i.bounds}interpolate(e){let{x:t,y:i,radius:r}=this,n=e.angle;return{x:t+Math.cos(n)*r,y:i+Math.sin(n)*r,angle:n}}}function r7(e,t,i){let r=function(e){var t,i,r;let{chart:n,fill:a,line:s}=e;if(ee(a)){let e;return t=n,i=a,(e=t.getDatasetMeta(i))&&t.isDatasetVisible(i)?e.dataset:null}if("stack"===a)return function(e){let{scale:t,index:i,line:r}=e,n=[],a=r.segments,s=r.points,o=function(e,t){let i=[],r=e.getMatchingVisibleMetas("line");for(let e=0;e<r.length;e++){let n=r[e];if(n.index===t)break;n.hidden||i.unshift(n.dataset)}return i}(t,i);o.push(r6({x:null,y:t.bottom},r));for(let e=0;e<a.length;e++){let t=a[e];for(let e=t.start;e<=t.end;e++)!function(e,t,i){let r=[];for(let n=0;n<i.length;n++){let{first:a,last:s,point:o}=function(e,t,i){let r=e.interpolate(t,"x");if(!r)return{};let n=r.x,a=e.segments,s=e.points,o=!1,l=!1;for(let e=0;e<a.length;e++){let t=a[e],i=s[t.start].x,r=s[t.end].x;if(eV(n,i,r)){o=n===i,l=n===r;break}}return{first:o,last:l,point:r}}(i[n],t,"x");if(o&&(!a||!s)){if(a)r.unshift(o);else if(e.push(o),!s)break}}e.push(...r)}(n,s[e],o)}return new rq({points:n,options:{}})}(e);if("shape"===a)return!0;let o=((r=e).scale||{}).getPointPositionForValue?function(e){let{scale:t,fill:i}=e,r=t.options,n=t.getLabels().length,a=r.reverse?t.max:t.min,s="start"===i?a:"end"===i?t.options.reverse?t.min:t.max:Q(i)?i.value:t.getBaseValue(),o=[];if(r.grid.circular){let e=t.getPointPositionForValue(0,a);return new r9({x:e.x,y:e.y,radius:t.getDistanceFromCenterForValue(s)})}for(let e=0;e<n;++e)o.push(t.getPointPositionForValue(e,s));return o}(r):function(e){let t,{scale:i={},fill:r}=e,n=(t=null,"start"===r?t=i.bottom:"end"===r?t=i.top:Q(r)?t=i.getPixelForValue(r.value):i.getBasePixel&&(t=i.getBasePixel()),t);if(ee(n)){let e=i.isHorizontal();return{x:e?n:null,y:e?null:n}}return null}(r);return o instanceof r9?o:r6(o,s)}(t),{chart:n,index:a,line:s,scale:o,axis:l}=t,c=s.options,u=c.fill,h=c.backgroundColor,{above:d=h,below:f=h}=u||{},p=n.getDatasetMeta(a),g=is(n,p);r&&s.points.length&&(tf(e,i),function(e,t){let{line:i,target:r,above:n,below:a,area:s,scale:o,clip:l}=t,c=i._loop?"angle":t.axis;e.save();let u=a;a!==n&&("x"===c?(ne(e,r,s.top),ni(e,{line:i,target:r,color:n,scale:o,property:c,clip:l}),e.restore(),e.save(),ne(e,r,s.bottom)):"y"===c&&(nt(e,r,s.left),ni(e,{line:i,target:r,color:a,scale:o,property:c,clip:l}),e.restore(),e.save(),nt(e,r,s.right),u=n)),ni(e,{line:i,target:r,color:u,scale:o,property:c,clip:l}),e.restore()}(e,{line:s,target:r,above:d,below:f,area:i,scale:o,axis:l,clip:g}),tp(e))}function ne(e,t,i){let{segments:r,points:n}=t,a=!0,s=!1;for(let o of(e.beginPath(),r)){let{start:r,end:l}=o,c=n[r],u=n[r4(r,l,n)];a?(e.moveTo(c.x,c.y),a=!1):(e.lineTo(c.x,i),e.lineTo(c.x,c.y)),(s=!!t.pathSegment(e,o,{move:s}))?e.closePath():e.lineTo(u.x,i)}e.lineTo(t.first().x,i),e.closePath(),e.clip()}function nt(e,t,i){let{segments:r,points:n}=t,a=!0,s=!1;for(let o of(e.beginPath(),r)){let{start:r,end:l}=o,c=n[r],u=n[r4(r,l,n)];a?(e.moveTo(c.x,c.y),a=!1):(e.lineTo(i,c.y),e.lineTo(c.x,c.y)),(s=!!t.pathSegment(e,o,{move:s}))?e.closePath():e.lineTo(i,u.y)}e.lineTo(i,t.first().y),e.closePath(),e.clip()}function ni(e,t){let{line:i,target:r,property:n,color:a,scale:s,clip:o}=t;for(let{source:t,target:l,start:c,end:u}of function(e,t,i){let r=e.segments,n=e.points,a=t.points,s=[];for(let e of r){let{start:r,end:o}=e;o=r4(r,o,n);let l=r3(i,n[r],n[o],e.loop);if(!t.segments){s.push({source:e,target:l,start:n[r],end:n[o]});continue}for(let r of it(t,l)){let t=r3(i,a[r.start],a[r.end],r.loop);for(let a of ie(e,n,t))s.push({source:a,target:r,start:{[i]:r5(l,t,"start",Math.max)},end:{[i]:r5(l,t,"end",Math.min)}})}}return s}(i,r,n)){let h,{style:{backgroundColor:d=a}={}}=t,f=!0!==r;e.save(),e.fillStyle=d,function(e,t,i,r){let n=t.chart.chartArea,{property:a,start:s,end:o}=r||{};if("x"===a||"y"===a){let t,r,l,c;"x"===a?(t=s,r=n.top,l=o,c=n.bottom):(t=n.left,r=s,l=n.right,c=o),e.beginPath(),i&&(t=Math.max(t,i.left),l=Math.min(l,i.right),r=Math.max(r,i.top),c=Math.min(c,i.bottom)),e.rect(t,r,l-t,c-r),e.clip()}}(e,s,o,f&&r3(n,c,u)),e.beginPath();let p=!!i.pathSegment(e,t);if(f){p?e.closePath():nr(e,r,u,n);let t=!!r.pathSegment(e,l,{move:p,reverse:!0});(h=p&&t)||nr(e,r,c,n)}e.closePath(),e.fill(h?"evenodd":"nonzero"),e.restore()}}function nr(e,t,i,r){let n=t.interpolate(i,r);n&&e.lineTo(n.x,n.y)}var nn={id:"filler",afterDatasetsUpdate(e,t,i){let r,n,a,s,o=(e.data.datasets||[]).length,l=[];for(n=0;n<o;++n)a=(r=e.getDatasetMeta(n)).dataset,s=null,a&&a.options&&a instanceof rq&&(s={visible:e.isDatasetVisible(n),index:n,fill:function(e,t,i){var r,n,a,s;let o=function(e){let t=e.options,i=t.fill,r=ei(i&&i.target,i);return void 0===r&&(r=!!t.backgroundColor),!1!==r&&null!==r&&(!0===r?"origin":r)}(e);if(Q(o))return!isNaN(o.value)&&o;let l=parseFloat(o);return ee(l)&&Math.floor(l)===l?(r=o[0],n=t,a=l,s=i,("-"===r||"+"===r)&&(a=n+a),a!==n&&!(a<0)&&!(a>=s)&&a):["origin","start","end","stack","shape"].indexOf(o)>=0&&o}(a,n,o),chart:e,axis:r.controller.options.indexAxis,scale:r.vScale,line:a}),r.$filler=s,l.push(s);for(n=0;n<o;++n)(s=l[n])&&!1!==s.fill&&(s.fill=function(e,t,i){let r,n=e[t].fill,a=[t];if(!i)return n;for(;!1!==n&&-1===a.indexOf(n);){if(!ee(n))return n;if(!(r=e[n]))break;if(r.visible)return n;a.push(n),n=r.fill}return!1}(l,n,i.propagate))},beforeDraw(e,t,i){let r="beforeDraw"===i.drawTime,n=e.getSortedVisibleDatasetMetas(),a=e.chartArea;for(let t=n.length-1;t>=0;--t){let i=n[t].$filler;i&&(i.line.updateControlPoints(a,i.axis),r&&i.fill&&r7(e.ctx,i,a))}},beforeDatasetsDraw(e,t,i){if("beforeDatasetsDraw"!==i.drawTime)return;let r=e.getSortedVisibleDatasetMetas();for(let t=r.length-1;t>=0;--t){let i=r[t].$filler;r8(i)&&r7(e.ctx,i,e.chartArea)}},beforeDatasetDraw(e,t,i){let r=t.meta.$filler;r8(r)&&"beforeDatasetDraw"===i.drawTime&&r7(e.ctx,r,e.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};let na=(e,t)=>{let{boxHeight:i=t,boxWidth:r=t}=e;return e.usePointStyle&&(i=Math.min(i,t),r=e.pointStyleWidth||Math.min(r,t)),{boxWidth:r,boxHeight:i,itemHeight:Math.max(t,i)}};class ns extends ri{constructor(e){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,t,i){this.maxWidth=e,this.maxHeight=t,this._margins=i,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){let e=this.options.labels||{},t=en(e.generateLabels,[this.chart],this)||[];e.filter&&(t=t.filter(t=>e.filter(t,this.chart.data))),e.sort&&(t=t.sort((t,i)=>e.sort(t,i,this.chart.data))),this.options.reverse&&t.reverse(),this.legendItems=t}fit(){let e,t,{options:i,ctx:r}=this;if(!i.display){this.width=this.height=0;return}let n=i.labels,a=tP(n.font),s=a.size,o=this._computeTitleHeight(),{boxWidth:l,itemHeight:c}=na(n,s);r.font=a.string,this.isHorizontal()?(e=this.maxWidth,t=this._fitRows(o,s,l,c)+10):(t=this.maxHeight,e=this._fitCols(o,a,l,c)+10),this.width=Math.min(e,i.maxWidth||this.maxWidth),this.height=Math.min(t,i.maxHeight||this.maxHeight)}_fitRows(e,t,i,r){let{ctx:n,maxWidth:a,options:{labels:{padding:s}}}=this,o=this.legendHitBoxes=[],l=this.lineWidths=[0],c=r+s,u=e;n.textAlign="left",n.textBaseline="middle";let h=-1,d=-c;return this.legendItems.forEach((e,f)=>{let p=i+t/2+n.measureText(e.text).width;(0===f||l[l.length-1]+p+2*s>a)&&(u+=c,l[l.length-(f>0?0:1)]=0,d+=c,h++),o[f]={left:0,top:d,row:h,width:p,height:r},l[l.length-1]+=p+s}),u}_fitCols(e,t,i,r){let{ctx:n,maxHeight:a,options:{labels:{padding:s}}}=this,o=this.legendHitBoxes=[],l=this.columnSizes=[],c=a-e,u=s,h=0,d=0,f=0,p=0;return this.legendItems.forEach((e,a)=>{var g,v,y,b,x,_,w,k,E,T,P,S;let M,C,{itemWidth:A,itemHeight:I}=(g=i,v=t,y=n,b=e,x=r,{itemWidth:(_=b,w=g,k=v,E=y,(M=_.text)&&"string"!=typeof M&&(M=M.reduce((e,t)=>e.length>t.length?e:t)),w+k.size/2+E.measureText(M).width),itemHeight:(T=x,P=b,S=v.lineHeight,C=T,"string"!=typeof P.text&&(C=no(P,S)),C)});a>0&&d+I+2*s>c&&(u+=h+s,l.push({width:h,height:d}),f+=h+s,p++,h=d=0),o[a]={left:f,top:d,col:p,width:A,height:I},h=Math.max(h,A),d+=I+s}),u+=h,l.push({width:h,height:d}),u}adjustHitBoxes(){if(!this.options.display)return;let e=this._computeTitleHeight(),{legendHitBoxes:t,options:{align:i,labels:{padding:r},rtl:n}}=this,a=t5(n,this.left,this.width);if(this.isHorizontal()){let n=0,s=eZ(i,this.left+r,this.right-this.lineWidths[n]);for(let o of t)n!==o.row&&(n=o.row,s=eZ(i,this.left+r,this.right-this.lineWidths[n])),o.top+=this.top+e+r,o.left=a.leftForLtr(a.x(s),o.width),s+=o.width+r}else{let n=0,s=eZ(i,this.top+e+r,this.bottom-this.columnSizes[n].height);for(let o of t)o.col!==n&&(n=o.col,s=eZ(i,this.top+e+r,this.bottom-this.columnSizes[n].height)),o.top=s,o.left+=this.left+r,o.left=a.leftForLtr(a.x(o.left),o.width),s+=o.height+r}}isHorizontal(){return"top"===this.options.position||"bottom"===this.options.position}draw(){if(this.options.display){let e=this.ctx;tf(e,this),this._draw(),tp(e)}}_draw(){let e,{options:t,columnSizes:i,lineWidths:r,ctx:n}=this,{align:a,labels:s}=t,o=ts.color,l=t5(t.rtl,this.left,this.width),c=tP(s.font),{padding:u}=s,h=c.size,d=h/2;this.drawTitle(),n.textAlign=l.textAlign("left"),n.textBaseline="middle",n.lineWidth=.5,n.font=c.string;let{boxWidth:f,boxHeight:p,itemHeight:g}=na(s,h),v=function(e,t,i){if(isNaN(f)||f<=0||isNaN(p)||p<0)return;n.save();let r=ei(i.lineWidth,1);if(n.fillStyle=ei(i.fillStyle,o),n.lineCap=ei(i.lineCap,"butt"),n.lineDashOffset=ei(i.lineDashOffset,0),n.lineJoin=ei(i.lineJoin,"miter"),n.lineWidth=r,n.strokeStyle=ei(i.strokeStyle,o),n.setLineDash(ei(i.lineDash,[])),s.usePointStyle)th(n,{radius:p*Math.SQRT2/2,pointStyle:i.pointStyle,rotation:i.rotation,borderWidth:r},l.xPlus(e,f/2),t+d,s.pointStyleWidth&&f);else{let a=t+Math.max((h-p)/2,0),s=l.leftForLtr(e,f),o=tE(i.borderRadius);n.beginPath(),Object.values(o).some(e=>0!==e)?ty(n,{x:s,y:a,w:f,h:p,radius:o}):n.rect(s,a,f,p),n.fill(),0!==r&&n.stroke()}n.restore()},y=function(e,t,i){tv(n,i.text,e,t+g/2,c,{strikethrough:i.hidden,textAlign:l.textAlign(i.textAlign)})},b=this.isHorizontal(),x=this._computeTitleHeight();e=b?{x:eZ(a,this.left+u,this.right-r[0]),y:this.top+u+x,line:0}:{x:this.left+u,y:eZ(a,this.top+x+u,this.bottom-i[0].height),line:0},t6(this.ctx,t.textDirection);let _=g+u;this.legendItems.forEach((o,h)=>{var p,g;n.strokeStyle=o.fontColor,n.fillStyle=o.fontColor;let w=n.measureText(o.text).width,k=l.textAlign(o.textAlign||(o.textAlign=s.textAlign)),E=f+d+w,T=e.x,P=e.y;if(l.setWidth(this.width),b?h>0&&T+E+u>this.right&&(P=e.y+=_,e.line++,T=e.x=eZ(a,this.left+u,this.right-r[e.line])):h>0&&P+_>this.bottom&&(T=e.x=T+i[e.line].width+u,e.line++,P=e.y=eZ(a,this.top+x+u,this.bottom-i[e.line].height)),v(l.x(T),P,o),p=T+f+d,g=b?T+E:this.right,T=k===(t.rtl?"left":"right")?g:"center"===k?(p+g)/2:p,y(l.x(T),P,o),b)e.x+=E+u;else if("string"!=typeof o.text){let t=c.lineHeight;e.y+=no(o,t)+u}else e.y+=_}),t8(this.ctx,t.textDirection)}drawTitle(){let e,t=this.options,i=t.title,r=tP(i.font),n=tT(i.padding);if(!i.display)return;let a=t5(t.rtl,this.left,this.width),s=this.ctx,o=i.position,l=r.size/2,c=n.top+l,u=this.left,h=this.width;if(this.isHorizontal())h=Math.max(...this.lineWidths),e=this.top+c,u=eZ(t.align,u,this.right-h);else{let i=this.columnSizes.reduce((e,t)=>Math.max(e,t.height),0);e=c+eZ(t.align,this.top,this.bottom-i-t.labels.padding-this._computeTitleHeight())}let d=eZ(o,u,u+h);s.textAlign=a.textAlign(eK(o)),s.textBaseline="middle",s.strokeStyle=i.color,s.fillStyle=i.color,s.font=r.string,tv(s,i.text,d,e,r)}_computeTitleHeight(){let e=this.options.title,t=tP(e.font),i=tT(e.padding);return e.display?t.lineHeight+i.height:0}_getLegendItemAt(e,t){let i,r,n;if(eV(e,this.left,this.right)&&eV(t,this.top,this.bottom)){for(i=0,n=this.legendHitBoxes;i<n.length;++i)if(eV(e,(r=n[i]).left,r.left+r.width)&&eV(t,r.top,r.top+r.height))return this.legendItems[i]}return null}handleEvent(e){var t,i;let r=this.options;if(t=e.type,i=r,("mousemove"!==t&&"mouseout"!==t||!i.onHover&&!i.onLeave)&&(!i.onClick||"click"!==t&&"mouseup"!==t))return;let n=this._getLegendItemAt(e.x,e.y);if("mousemove"===e.type||"mouseout"===e.type){let t=this._hoveredItem,i=null!==t&&null!==n&&t.datasetIndex===n.datasetIndex&&t.index===n.index;t&&!i&&en(r.onLeave,[e,t,this],this),this._hoveredItem=n,n&&!i&&en(r.onHover,[e,n,this],this)}else n&&en(r.onClick,[e,n,this],this)}}function no(e,t){return t*(e.text?e.text.length:0)}var nl={id:"legend",_element:ns,start(e,t,i){let r=e.legend=new ns({ctx:e.ctx,options:i,chart:e});iX.configure(e,r,i),iX.addBox(e,r)},stop(e){iX.removeBox(e,e.legend),delete e.legend},beforeUpdate(e,t,i){let r=e.legend;iX.configure(e,r,i),r.options=i},afterUpdate(e){let t=e.legend;t.buildLabels(),t.adjustHitBoxes()},afterEvent(e,t){t.replay||e.legend.handleEvent(t.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(e,t,i){let r=t.datasetIndex,n=i.chart;n.isDatasetVisible(r)?(n.hide(r),t.hidden=!0):(n.show(r),t.hidden=!1)},onHover:null,onLeave:null,labels:{color:e=>e.chart.options.color,boxWidth:40,padding:10,generateLabels(e){let t=e.data.datasets,{labels:{usePointStyle:i,pointStyle:r,textAlign:n,color:a,useBorderRadius:s,borderRadius:o}}=e.legend.options;return e._getSortedDatasetMetas().map(e=>{let l=e.controller.getStyle(i?0:void 0),c=tT(l.borderWidth);return{text:t[e.index].label,fillStyle:l.backgroundColor,fontColor:a,hidden:!e.visible,lineCap:l.borderCapStyle,lineDash:l.borderDash,lineDashOffset:l.borderDashOffset,lineJoin:l.borderJoinStyle,lineWidth:(c.width+c.height)/4,strokeStyle:l.borderColor,pointStyle:r||l.pointStyle,rotation:l.rotation,textAlign:n||l.textAlign,borderRadius:s&&(o||l.borderRadius),datasetIndex:e.index}},this)}},title:{color:e=>e.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:e=>!e.startsWith("on"),labels:{_scriptable:e=>!["generateLabels","filter","sort"].includes(e)}}};class nc extends ri{constructor(e){super(),this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,t){let i=this.options;if(this.left=0,this.top=0,!i.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=e,this.height=this.bottom=t;let r=J(i.text)?i.text.length:1;this._padding=tT(i.padding);let n=r*tP(i.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=n:this.width=n}isHorizontal(){let e=this.options.position;return"top"===e||"bottom"===e}_drawArgs(e){let t,i,r,{top:n,left:a,bottom:s,right:o,options:l}=this,c=l.align,u=0;return this.isHorizontal()?(i=eZ(c,a,o),r=n+e,t=o-a):("left"===l.position?(i=a+e,r=eZ(c,s,n),u=-.5*eb):(i=o-e,r=eZ(c,n,s),u=.5*eb),t=s-n),{titleX:i,titleY:r,maxWidth:t,rotation:u}}draw(){let e=this.ctx,t=this.options;if(!t.display)return;let i=tP(t.font),r=i.lineHeight/2+this._padding.top,{titleX:n,titleY:a,maxWidth:s,rotation:o}=this._drawArgs(r);tv(e,t.text,0,0,i,{color:t.color,maxWidth:s,rotation:o,textAlign:eK(t.align),textBaseline:"middle",translation:[n,a]})}}var nu={id:"title",_element:nc,start(e,t,i){let r;r=new nc({ctx:e.ctx,options:i,chart:e}),iX.configure(e,r,i),iX.addBox(e,r),e.titleBlock=r},stop(e){let t=e.titleBlock;iX.removeBox(e,t),delete e.titleBlock},beforeUpdate(e,t,i){let r=e.titleBlock;iX.configure(e,r,i),r.options=i},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};new WeakMap;let nh={average(e){let t,i;if(!e.length)return!1;let r=new Set,n=0,a=0;for(t=0,i=e.length;t<i;++t){let i=e[t].element;if(i&&i.hasValue()){let e=i.tooltipPosition();r.add(e.x),n+=e.y,++a}}return 0!==a&&0!==r.size&&{x:[...r].reduce((e,t)=>e+t)/r.size,y:n/a}},nearest(e,t){let i,r,n;if(!e.length)return!1;let a=t.x,s=t.y,o=1/0;for(i=0,r=e.length;i<r;++i){let r=e[i].element;if(r&&r.hasValue()){let e=eN(t,r.getCenterPoint());e<o&&(o=e,n=r)}}if(n){let e=n.tooltipPosition();a=e.x,s=e.y}return{x:a,y:s}}};function nd(e,t){return t&&(J(t)?Array.prototype.push.apply(e,t):e.push(t)),e}function nf(e){return("string"==typeof e||e instanceof String)&&e.indexOf("\n")>-1?e.split("\n"):e}function np(e,t){let i=e.chart.ctx,{body:r,footer:n,title:a}=e,{boxWidth:s,boxHeight:o}=t,l=tP(t.bodyFont),c=tP(t.titleFont),u=tP(t.footerFont),h=a.length,d=n.length,f=r.length,p=tT(t.padding),g=p.height,v=0,y=r.reduce((e,t)=>e+t.before.length+t.lines.length+t.after.length,0);y+=e.beforeBody.length+e.afterBody.length,h&&(g+=h*c.lineHeight+(h-1)*t.titleSpacing+t.titleMarginBottom),y&&(g+=f*(t.displayColors?Math.max(o,l.lineHeight):l.lineHeight)+(y-f)*l.lineHeight+(y-1)*t.bodySpacing),d&&(g+=t.footerMarginTop+d*u.lineHeight+(d-1)*t.footerSpacing);let b=0,x=function(e){v=Math.max(v,i.measureText(e).width+b)};return i.save(),i.font=c.string,ea(e.title,x),i.font=l.string,ea(e.beforeBody.concat(e.afterBody),x),b=t.displayColors?s+2+t.boxPadding:0,ea(r,e=>{ea(e.before,x),ea(e.lines,x),ea(e.after,x)}),b=0,i.font=u.string,ea(e.footer,x),i.restore(),{width:v+=p.width,height:g}}function ng(e,t,i){let r=i.yAlign||t.yAlign||function(e,t){let{y:i,height:r}=t;return i<r/2?"top":i>e.height-r/2?"bottom":"center"}(e,i);return{xAlign:i.xAlign||t.xAlign||function(e,t,i,r){let{x:n,width:a}=i,{width:s,chartArea:{left:o,right:l}}=e,c="center";return"center"===r?c=n<=(o+l)/2?"left":"right":n<=a/2?c="left":n>=s-a/2&&(c="right"),function(e,t,i,r){let{x:n,width:a}=r,s=i.caretSize+i.caretPadding;if("left"===e&&n+a+s>t.width||"right"===e&&n-a-s<0)return!0}(c,e,t,i)&&(c="center"),c}(e,t,i,r),yAlign:r}}function nm(e,t,i,r){let{caretSize:n,caretPadding:a,cornerRadius:s}=e,{xAlign:o,yAlign:l}=i,c=n+a,{topLeft:u,topRight:h,bottomLeft:d,bottomRight:f}=tE(s),p=function(e,t){let{x:i,width:r}=e;return"right"===t?i-=r:"center"===t&&(i-=r/2),i}(t,o),g=function(e,t,i){let{y:r,height:n}=e;return"top"===t?r+=i:"bottom"===t?r-=n+i:r-=n/2,r}(t,l,c);return"center"===l?"left"===o?p+=c:"right"===o&&(p-=c):"left"===o?p-=Math.max(u,d)+n:"right"===o&&(p+=Math.max(h,f)+n),{x:ez(p,0,r.width-t.width),y:ez(g,0,r.height-t.height)}}function nv(e,t,i){let r=tT(i.padding);return"center"===t?e.x+e.width/2:"right"===t?e.x+e.width-r.right:e.x+r.left}function ny(e,t){let i=t&&t.dataset&&t.dataset.tooltip&&t.dataset.tooltip.callbacks;return i?e.override(i):e}let nb={beforeTitle:X,title(e){if(e.length>0){let t=e[0],i=t.chart.data.labels,r=i?i.length:0;if(this&&this.options&&"dataset"===this.options.mode)return t.dataset.label||"";if(t.label)return t.label;if(r>0&&t.dataIndex<r)return i[t.dataIndex]}return""},afterTitle:X,beforeBody:X,beforeLabel:X,label(e){if(this&&this.options&&"dataset"===this.options.mode)return e.label+": "+e.formattedValue||e.formattedValue;let t=e.dataset.label||"";t&&(t+=": ");let i=e.formattedValue;return Z(i)||(t+=i),t},labelColor(e){let t=e.chart.getDatasetMeta(e.datasetIndex).controller.getStyle(e.dataIndex);return{borderColor:t.borderColor,backgroundColor:t.backgroundColor,borderWidth:t.borderWidth,borderDash:t.borderDash,borderDashOffset:t.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(e){let t=e.chart.getDatasetMeta(e.datasetIndex).controller.getStyle(e.dataIndex);return{pointStyle:t.pointStyle,rotation:t.rotation}},afterLabel:X,afterBody:X,beforeFooter:X,footer:X,afterFooter:X};function nx(e,t,i,r){let n=e[t].call(i,r);return void 0===n?nb[t].call(i,r):n}class n_ extends ri{static positioners=nh;constructor(e){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=e.chart,this.options=e.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(e){this.options=e,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){let e=this._cachedAnimations;if(e)return e;let t=this.chart,i=this.options.setContext(this.getContext()),r=i.enabled&&t.options.animation&&i.animations,n=new ih(this.chart,r);return r._cacheable&&(this._cachedAnimations=Object.freeze(n)),n}getContext(){var e;return this.$context||(this.$context=(e=this.chart.getContext(),tM(e,{tooltip:this,tooltipItems:this._tooltipItems,type:"tooltip"})))}getTitle(e,t){let{callbacks:i}=t,r=nx(i,"beforeTitle",this,e),n=nx(i,"title",this,e),a=nx(i,"afterTitle",this,e),s=[];return s=nd(s,nf(r)),s=nd(s,nf(n)),s=nd(s,nf(a))}getBeforeBody(e,t){return nd([],nf(nx(t.callbacks,"beforeBody",this,e)))}getBody(e,t){let{callbacks:i}=t,r=[];return ea(e,e=>{let t={before:[],lines:[],after:[]},n=ny(i,e);nd(t.before,nf(nx(n,"beforeLabel",this,e))),nd(t.lines,nx(n,"label",this,e)),nd(t.after,nf(nx(n,"afterLabel",this,e))),r.push(t)}),r}getAfterBody(e,t){return nd([],nf(nx(t.callbacks,"afterBody",this,e)))}getFooter(e,t){let{callbacks:i}=t,r=nx(i,"beforeFooter",this,e),n=nx(i,"footer",this,e),a=nx(i,"afterFooter",this,e),s=[];return s=nd(s,nf(r)),s=nd(s,nf(n)),s=nd(s,nf(a))}_createItems(e){let t,i,r=this._active,n=this.chart.data,a=[],s=[],o=[],l=[];for(t=0,i=r.length;t<i;++t)l.push(function(e,t){let{element:i,datasetIndex:r,index:n}=t,a=e.getDatasetMeta(r).controller,{label:s,value:o}=a.getLabelAndValue(n);return{chart:e,label:s,parsed:a.getParsed(n),raw:e.data.datasets[r].data[n],formattedValue:o,dataset:a.getDataset(),dataIndex:n,datasetIndex:r,element:i}}(this.chart,r[t]));return e.filter&&(l=l.filter((t,i,r)=>e.filter(t,i,r,n))),e.itemSort&&(l=l.sort((t,i)=>e.itemSort(t,i,n))),ea(l,t=>{let i=ny(e.callbacks,t);a.push(nx(i,"labelColor",this,t)),s.push(nx(i,"labelPointStyle",this,t)),o.push(nx(i,"labelTextColor",this,t))}),this.labelColors=a,this.labelPointStyles=s,this.labelTextColors=o,this.dataPoints=l,l}update(e,t){let i,r=this.options.setContext(this.getContext()),n=this._active,a=[];if(n.length){let e=nh[r.position].call(this,n,this._eventPosition);a=this._createItems(r),this.title=this.getTitle(a,r),this.beforeBody=this.getBeforeBody(a,r),this.body=this.getBody(a,r),this.afterBody=this.getAfterBody(a,r),this.footer=this.getFooter(a,r);let t=this._size=np(this,r),s=Object.assign({},e,t),o=ng(this.chart,r,s),l=nm(r,s,o,this.chart);this.xAlign=o.xAlign,this.yAlign=o.yAlign,i={opacity:1,x:l.x,y:l.y,width:t.width,height:t.height,caretX:e.x,caretY:e.y}}else 0!==this.opacity&&(i={opacity:0});this._tooltipItems=a,this.$context=void 0,i&&this._resolveAnimations().update(this,i),e&&r.external&&r.external.call(this,{chart:this.chart,tooltip:this,replay:t})}drawCaret(e,t,i,r){let n=this.getCaretPosition(e,i,r);t.lineTo(n.x1,n.y1),t.lineTo(n.x2,n.y2),t.lineTo(n.x3,n.y3)}getCaretPosition(e,t,i){let r,n,a,s,o,l,{xAlign:c,yAlign:u}=this,{caretSize:h,cornerRadius:d}=i,{topLeft:f,topRight:p,bottomLeft:g,bottomRight:v}=tE(d),{x:y,y:b}=e,{width:x,height:_}=t;return"center"===u?(o=b+_/2,"left"===c?(n=(r=y)-h,s=o+h,l=o-h):(n=(r=y+x)+h,s=o-h,l=o+h),a=r):(n="left"===c?y+Math.max(f,g)+h:"right"===c?y+x-Math.max(p,v)-h:this.caretX,"top"===u?(o=(s=b)-h,r=n-h,a=n+h):(o=(s=b+_)+h,r=n+h,a=n-h),l=s),{x1:r,x2:n,x3:a,y1:s,y2:o,y3:l}}drawTitle(e,t,i){let r,n,a,s=this.title,o=s.length;if(o){let l=t5(i.rtl,this.x,this.width);for(a=0,e.x=nv(this,i.titleAlign,i),t.textAlign=l.textAlign(i.titleAlign),t.textBaseline="middle",r=tP(i.titleFont),n=i.titleSpacing,t.fillStyle=i.titleColor,t.font=r.string;a<o;++a)t.fillText(s[a],l.x(e.x),e.y+r.lineHeight/2),e.y+=r.lineHeight+n,a+1===o&&(e.y+=i.titleMarginBottom-n)}}_drawColorBox(e,t,i,r,n){let a=this.labelColors[i],s=this.labelPointStyles[i],{boxHeight:o,boxWidth:l}=n,c=tP(n.bodyFont),u=nv(this,"left",n),h=r.x(u),d=o<c.lineHeight?(c.lineHeight-o)/2:0,f=t.y+d;if(n.usePointStyle){let t={radius:Math.min(l,o)/2,pointStyle:s.pointStyle,rotation:s.rotation,borderWidth:1},i=r.leftForLtr(h,l)+l/2,c=f+o/2;e.strokeStyle=n.multiKeyBackground,e.fillStyle=n.multiKeyBackground,tu(e,t,i,c),e.strokeStyle=a.borderColor,e.fillStyle=a.backgroundColor,tu(e,t,i,c)}else{e.lineWidth=Q(a.borderWidth)?Math.max(...Object.values(a.borderWidth)):a.borderWidth||1,e.strokeStyle=a.borderColor,e.setLineDash(a.borderDash||[]),e.lineDashOffset=a.borderDashOffset||0;let t=r.leftForLtr(h,l),i=r.leftForLtr(r.xPlus(h,1),l-2),s=tE(a.borderRadius);Object.values(s).some(e=>0!==e)?(e.beginPath(),e.fillStyle=n.multiKeyBackground,ty(e,{x:t,y:f,w:l,h:o,radius:s}),e.fill(),e.stroke(),e.fillStyle=a.backgroundColor,e.beginPath(),ty(e,{x:i,y:f+1,w:l-2,h:o-2,radius:s}),e.fill()):(e.fillStyle=n.multiKeyBackground,e.fillRect(t,f,l,o),e.strokeRect(t,f,l,o),e.fillStyle=a.backgroundColor,e.fillRect(i,f+1,l-2,o-2))}e.fillStyle=this.labelTextColors[i]}drawBody(e,t,i){let r,n,a,s,o,l,{body:c}=this,{bodySpacing:u,bodyAlign:h,displayColors:d,boxHeight:f,boxWidth:p,boxPadding:g}=i,v=tP(i.bodyFont),y=v.lineHeight,b=0,x=t5(i.rtl,this.x,this.width),_=function(i){t.fillText(i,x.x(e.x+b),e.y+y/2),e.y+=y+u},w=x.textAlign(h);for(t.textAlign=h,t.textBaseline="middle",t.font=v.string,e.x=nv(this,w,i),t.fillStyle=i.bodyColor,ea(this.beforeBody,_),b=d&&"right"!==w?"center"===h?p/2+g:p+2+g:0,a=0,o=c.length;a<o;++a){for(r=c[a],t.fillStyle=this.labelTextColors[a],ea(r.before,_),n=r.lines,d&&n.length&&(this._drawColorBox(t,e,a,x,i),y=Math.max(v.lineHeight,f)),s=0,l=n.length;s<l;++s)_(n[s]),y=v.lineHeight;ea(r.after,_)}b=0,y=v.lineHeight,ea(this.afterBody,_),e.y-=u}drawFooter(e,t,i){let r,n,a=this.footer,s=a.length;if(s){let o=t5(i.rtl,this.x,this.width);for(e.x=nv(this,i.footerAlign,i),e.y+=i.footerMarginTop,t.textAlign=o.textAlign(i.footerAlign),t.textBaseline="middle",r=tP(i.footerFont),t.fillStyle=i.footerColor,t.font=r.string,n=0;n<s;++n)t.fillText(a[n],o.x(e.x),e.y+r.lineHeight/2),e.y+=r.lineHeight+i.footerSpacing}}drawBackground(e,t,i,r){let{xAlign:n,yAlign:a}=this,{x:s,y:o}=e,{width:l,height:c}=i,{topLeft:u,topRight:h,bottomLeft:d,bottomRight:f}=tE(r.cornerRadius);t.fillStyle=r.backgroundColor,t.strokeStyle=r.borderColor,t.lineWidth=r.borderWidth,t.beginPath(),t.moveTo(s+u,o),"top"===a&&this.drawCaret(e,t,i,r),t.lineTo(s+l-h,o),t.quadraticCurveTo(s+l,o,s+l,o+h),"center"===a&&"right"===n&&this.drawCaret(e,t,i,r),t.lineTo(s+l,o+c-f),t.quadraticCurveTo(s+l,o+c,s+l-f,o+c),"bottom"===a&&this.drawCaret(e,t,i,r),t.lineTo(s+d,o+c),t.quadraticCurveTo(s,o+c,s,o+c-d),"center"===a&&"left"===n&&this.drawCaret(e,t,i,r),t.lineTo(s,o+u),t.quadraticCurveTo(s,o,s+u,o),t.closePath(),t.fill(),r.borderWidth>0&&t.stroke()}_updateAnimationTarget(e){let t=this.chart,i=this.$animations,r=i&&i.x,n=i&&i.y;if(r||n){let i=nh[e.position].call(this,this._active,this._eventPosition);if(!i)return;let a=this._size=np(this,e),s=Object.assign({},i,this._size),o=ng(t,e,s),l=nm(e,s,o,t);(r._to!==l.x||n._to!==l.y)&&(this.xAlign=o.xAlign,this.yAlign=o.yAlign,this.width=a.width,this.height=a.height,this.caretX=i.x,this.caretY=i.y,this._resolveAnimations().update(this,l))}}_willRender(){return!!this.opacity}draw(e){let t=this.options.setContext(this.getContext()),i=this.opacity;if(!i)return;this._updateAnimationTarget(t);let r={width:this.width,height:this.height},n={x:this.x,y:this.y};i=.001>Math.abs(i)?0:i;let a=tT(t.padding),s=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;t.enabled&&s&&(e.save(),e.globalAlpha=i,this.drawBackground(n,e,r,t),t6(e,t.textDirection),n.y+=a.top,this.drawTitle(n,e,t),this.drawBody(n,e,t),this.drawFooter(n,e,t),t8(e,t.textDirection),e.restore())}getActiveElements(){return this._active||[]}setActiveElements(e,t){let i=this._active,r=e.map(({datasetIndex:e,index:t})=>{let i=this.chart.getDatasetMeta(e);if(!i)throw Error("Cannot find a dataset at index "+e);return{datasetIndex:e,element:i.data[t],index:t}}),n=!es(i,r),a=this._positionChanged(r,t);(n||a)&&(this._active=r,this._eventPosition=t,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(e,t,i=!0){if(t&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;let r=this.options,n=this._active||[],a=this._getActiveElements(e,n,t,i),s=this._positionChanged(a,e),o=t||!es(a,n)||s;return o&&(this._active=a,(r.enabled||r.external)&&(this._eventPosition={x:e.x,y:e.y},this.update(!0,t))),o}_getActiveElements(e,t,i,r){let n=this.options;if("mouseout"===e.type)return[];if(!r)return t.filter(e=>this.chart.data.datasets[e.datasetIndex]&&void 0!==this.chart.getDatasetMeta(e.datasetIndex).controller.getParsed(e.index));let a=this.chart.getElementsAtEventForMode(e,n.mode,n,i);return n.reverse&&a.reverse(),a}_positionChanged(e,t){let{caretX:i,caretY:r,options:n}=this,a=nh[n.position].call(this,e,t);return!1!==a&&(i!==a.x||r!==a.y)}}var nw={id:"tooltip",_element:n_,positioners:nh,afterInit(e,t,i){i&&(e.tooltip=new n_({chart:e,options:i}))},beforeUpdate(e,t,i){e.tooltip&&e.tooltip.initialize(i)},reset(e,t,i){e.tooltip&&e.tooltip.initialize(i)},afterDraw(e){let t=e.tooltip;if(t&&t._willRender()){let i={tooltip:t};if(!1===e.notifyPlugins("beforeTooltipDraw",{...i,cancelable:!0}))return;t.draw(e.ctx),e.notifyPlugins("afterTooltipDraw",i)}},afterEvent(e,t){if(e.tooltip){let i=t.replay;e.tooltip.handleEvent(t.event,i,t.inChartArea)&&(t.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(e,t)=>t.bodyFont.size,boxWidth:(e,t)=>t.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:nb},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:e=>"filter"!==e&&"itemSort"!==e&&"external"!==e,_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]};function nk(e){let t=this.getLabels();return e>=0&&e<t.length?t[e]:e}class nE extends rc{static id="category";static defaults={ticks:{callback:nk}};constructor(e){super(e),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(e){let t=this._addedLabels;if(t.length){let e=this.getLabels();for(let{index:i,label:r}of t)e[i]===r&&e.splice(i,1);this._addedLabels=[]}super.init(e)}parse(e,t){let i,r;if(Z(e))return null;let n=this.getLabels();return i=t=isFinite(t)&&n[t]===e?t:function(e,t,i,r){let n=e.indexOf(t);if(-1===n){var a;return a=i,"string"==typeof t?(a=e.push(t)-1,r.unshift({index:a,label:t})):isNaN(t)&&(a=null),a}return n!==e.lastIndexOf(t)?i:n}(n,e,ei(t,e),this._addedLabels),r=n.length-1,null===i?null:ez(Math.round(i),0,r)}determineDataLimits(){let{minDefined:e,maxDefined:t}=this.getUserBounds(),{min:i,max:r}=this.getMinMax(!0);"ticks"===this.options.bounds&&(e||(i=0),t||(r=this.getLabels().length-1)),this.min=i,this.max=r}buildTicks(){let e=this.min,t=this.max,i=this.options.offset,r=[],n=this.getLabels();n=0===e&&t===n.length-1?n:n.slice(e,t+1),this._valueRange=Math.max(n.length-!i,1),this._startValue=this.min-.5*!!i;for(let i=e;i<=t;i++)r.push({value:i});return r}getLabelForValue(e){return nk.call(this,e)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(e){return"number"!=typeof e&&(e=this.parse(e)),null===e?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getPixelForTick(e){let t=this.ticks;return e<0||e>t.length-1?null:this.getPixelForValue(t[e].value)}getValueForPixel(e){return Math.round(this._startValue+this.getDecimalForPixel(e)*this._valueRange)}getBasePixel(){return this.bottom}}function nT(e,t,{horizontal:i,minRotation:r}){let n=eD(r),a=(i?Math.sin(n):Math.cos(n))||.001,s=.75*t*(""+e).length;return Math.min(t/a,s)}class nP extends rc{constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(e,t){return Z(e)||("number"==typeof e||e instanceof Number)&&!isFinite(+e)?null:+e}handleTickRangeOptions(){let{beginAtZero:e}=this.options,{minDefined:t,maxDefined:i}=this.getUserBounds(),{min:r,max:n}=this,a=e=>r=t?r:e,s=e=>n=i?n:e;if(e){let e=eM(r),t=eM(n);e<0&&t<0?s(0):e>0&&t>0&&a(0)}if(r===n){let t=0===n?1:Math.abs(.05*n);s(n+t),e||a(r-t)}this.min=r,this.max=n}getTickLimit(){let e,{maxTicksLimit:t,stepSize:i}=this.options.ticks;return i?(e=Math.ceil(this.max/i)-Math.floor(this.min/i)+1)>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${i} would result generating up to ${e} ticks. Limiting to 1000.`),e=1e3):(e=this.computeTickLimit(),t=t||11),t&&(e=Math.min(t,e)),e}computeTickLimit(){return 1/0}buildTicks(){let e=this.options,t=e.ticks,i=this.getTickLimit(),r=function(e,t){var i,r;let n,a,s,o,l,c=[],{bounds:u,step:h,min:d,max:f,precision:p,count:g,maxTicks:v,maxDigits:y,includeBounds:b}=e,x=h||1,_=v-1,{min:w,max:k}=t,E=!Z(d),T=!Z(f),P=!Z(g),S=(k-w)/(y+1),M=eA((k-w)/_/x)*x;if(M<1e-14&&!E&&!T)return[{value:w},{value:k}];(o=Math.ceil(k/M)-Math.floor(w/M))>_&&(M=eA(o*M/_/x)*x),Z(p)||(M=Math.ceil(M*(n=Math.pow(10,p)))/n),"ticks"===u?(a=Math.floor(w/M)*M,s=Math.ceil(k/M)*M):(a=w,s=k),E&&T&&h&&(i=(f-d)/h,r=M/1e3,(l=Math.round(i))-r<=i&&l+r>=i)?(o=Math.round(Math.min((f-d)/M,v)),M=(f-d)/o,a=d,s=f):P?(a=E?d:a,M=((s=T?f:s)-a)/(o=g-1)):o=eC(o=(s-a)/M,Math.round(o),M/1e3)?Math.round(o):Math.ceil(o);let C=Math.max(eO(M),eO(a));a=Math.round(a*(n=Math.pow(10,Z(p)?C:p)))/n,s=Math.round(s*n)/n;let A=0;for(E&&(b&&a!==d?(c.push({value:d}),a<d&&A++,eC(Math.round((a+A*M)*n)/n,d,nT(d,S,e))&&A++):a<d&&A++);A<o;++A){let e=Math.round((a+A*M)*n)/n;if(T&&e>f)break;c.push({value:e})}return T&&b&&s!==f?c.length&&eC(c[c.length-1].value,f,nT(f,S,e))?c[c.length-1].value=f:c.push({value:f}):T&&s!==f||c.push({value:s}),c}({maxTicks:i=Math.max(2,i),bounds:e.bounds,min:e.min,max:e.max,precision:t.precision,step:t.stepSize,count:t.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:t.minRotation||0,includeBounds:!1!==t.includeBounds},this._range||this);return"ticks"===e.bounds&&eL(r,this,"value"),e.reverse?(r.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),r}configure(){let e=this.ticks,t=this.min,i=this.max;if(super.configure(),this.options.offset&&e.length){let r=(i-t)/Math.max(e.length-1,1)/2;t-=r,i+=r}this._startValue=t,this._endValue=i,this._valueRange=i-t}getLabelForValue(e){return te(e,this.chart.options.locale,this.options.ticks.format)}}class nS extends nP{static id="linear";static defaults={ticks:{callback:tt.numeric}};determineDataLimits(){let{min:e,max:t}=this.getMinMax(!0);this.min=ee(e)?e:0,this.max=ee(t)?t:1,this.handleTickRangeOptions()}computeTickLimit(){let e=this.isHorizontal(),t=e?this.width:this.height,i=eD(this.options.ticks.minRotation),r=(e?Math.sin(i):Math.cos(i))||.001;return Math.ceil(t/Math.min(40,this._resolveTickFontOptions(0).lineHeight/r))}getPixelForValue(e){return null===e?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getValueForPixel(e){return this._startValue+this.getDecimalForPixel(e)*this._valueRange}}let nM=e=>Math.floor(eS(e)),nC=(e,t)=>Math.pow(10,nM(e)+t);function nA(e){return 1==e/Math.pow(10,nM(e))}function nI(e,t,i){let r=Math.pow(10,i),n=Math.floor(e/r);return Math.ceil(t/r)-n}class nL extends rc{static id="logarithmic";static defaults={ticks:{callback:tt.logarithmic,major:{enabled:!0}}};constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(e,t){let i=nP.prototype.parse.apply(this,[e,t]);if(0===i){this._zero=!0;return}return ee(i)&&i>0?i:null}determineDataLimits(){let{min:e,max:t}=this.getMinMax(!0);this.min=ee(e)?Math.max(0,e):null,this.max=ee(t)?Math.max(0,t):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!ee(this._userMin)&&(this.min=e===nC(this.min,0)?nC(this.min,-1):nC(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){let{minDefined:e,maxDefined:t}=this.getUserBounds(),i=this.min,r=this.max,n=t=>i=e?i:t,a=e=>r=t?r:e;i===r&&(i<=0?(n(1),a(10)):(n(nC(i,-1)),a(nC(r,1)))),i<=0&&n(nC(r,-1)),r<=0&&a(nC(i,1)),this.min=i,this.max=r}buildTicks(){let e=this.options,t=function(e,{min:t,max:i}){t=et(e.min,t);let r=[],n=nM(t),a=function(e,t){let i=nM(t-e);for(;nI(e,t,i)>10;)i++;for(;10>nI(e,t,i);)i--;return Math.min(i,nM(e))}(t,i),s=a<0?Math.pow(10,Math.abs(a)):1,o=Math.pow(10,a),l=n>a?Math.pow(10,n):0,c=Math.round((t-l)*s)/s,u=Math.floor((t-l)/o/10)*o*10,h=Math.floor((c-u)/Math.pow(10,a)),d=et(e.min,Math.round((l+u+h*Math.pow(10,a))*s)/s);for(;d<i;)r.push({value:d,major:nA(d),significand:h}),h>=10?h=h<15?15:20:h++,h>=20&&(h=2,s=++a>=0?1:s),d=Math.round((l+u+h*Math.pow(10,a))*s)/s;let f=et(e.max,d);return r.push({value:f,major:nA(f),significand:h}),r}({min:this._userMin,max:this._userMax},this);return"ticks"===e.bounds&&eL(t,this,"value"),e.reverse?(t.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),t}getLabelForValue(e){return void 0===e?"0":te(e,this.chart.options.locale,this.options.ticks.format)}configure(){let e=this.min;super.configure(),this._startValue=eS(e),this._valueRange=eS(this.max)-eS(e)}getPixelForValue(e){return((void 0===e||0===e)&&(e=this.min),null===e||isNaN(e))?NaN:this.getPixelForDecimal(e===this.min?0:(eS(e)-this._startValue)/this._valueRange)}getValueForPixel(e){let t=this.getDecimalForPixel(e);return Math.pow(10,this._startValue+t*this._valueRange)}}function nD(e){let t=e.ticks;if(t.display&&e.display){let e=tT(t.backdropPadding);return ei(t.font&&t.font.size,ts.font.size)+e.height}return 0}function nO(e,t,i,r,n){return e===r||e===n?{start:t-i/2,end:t+i/2}:e<r||e>n?{start:t-i,end:t}:{start:t,end:t+i}}function nR(e,t,i,r){let{ctx:n}=e;if(i)n.arc(e.xCenter,e.yCenter,t,0,ex);else{let i=e.getPointPosition(0,t);n.moveTo(i.x,i.y);for(let a=1;a<r;a++)i=e.getPointPosition(a,t),n.lineTo(i.x,i.y)}}class nN extends nP{static id="radialLinear";static defaults={display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:tt.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback:e=>e,padding:5,centerPointLabels:!1}};static defaultRoutes={"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"};static descriptors={angleLines:{_fallback:"grid"}};constructor(e){super(e),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){let e=this._padding=tT(nD(this.options)/2),t=this.width=this.maxWidth-e.width,i=this.height=this.maxHeight-e.height;this.xCenter=Math.floor(this.left+t/2+e.left),this.yCenter=Math.floor(this.top+i/2+e.top),this.drawingArea=Math.floor(Math.min(t,i)/2)}determineDataLimits(){let{min:e,max:t}=this.getMinMax(!1);this.min=ee(e)&&!isNaN(e)?e:0,this.max=ee(t)&&!isNaN(t)?t:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/nD(this.options))}generateTickLabels(e){nP.prototype.generateTickLabels.call(this,e),this._pointLabels=this.getLabels().map((e,t)=>{let i=en(this.options.pointLabels.callback,[e,t],this);return i||0===i?i:""}).filter((e,t)=>this.chart.getDataVisibility(t))}fit(){let e=this.options;e.display&&e.pointLabels.display?function(e){let t={l:e.left+e._padding.left,r:e.right-e._padding.right,t:e.top+e._padding.top,b:e.bottom-e._padding.bottom},i=Object.assign({},t),r=[],n=[],a=e._pointLabels.length,s=e.options.pointLabels,o=s.centerPointLabels?eb/a:0;for(let u=0;u<a;u++){var l,c;let a=s.setContext(e.getPointLabelContext(u));n[u]=a.padding;let h=e.getPointPosition(u,e.drawingArea+n[u],o),d=tP(a.font),f=(l=e.ctx,c=J(c=e._pointLabels[u])?c:[c],{w:function(e,t,i,r){let n,a,s,o,l,c=(r=r||{}).data=r.data||{},u=r.garbageCollect=r.garbageCollect||[];r.font!==t&&(c=r.data={},u=r.garbageCollect=[],r.font=t),e.save(),e.font=t;let h=0,d=i.length;for(n=0;n<d;n++)if(null==(o=i[n])||J(o)){if(J(o))for(a=0,s=o.length;a<s;a++)null==(l=o[a])||J(l)||(h=to(e,c,u,h,l))}else h=to(e,c,u,h,o);e.restore();let f=u.length/2;if(f>i.length){for(n=0;n<f;n++)delete c[u[n]];u.splice(0,f)}return h}(l,d.string,c),h:c.length*d.lineHeight});r[u]=f;let p=eB(e.getIndexAngle(u)+o),g=Math.round(180/eb*p);!function(e,t,i,r,n){let a=Math.abs(Math.sin(i)),s=Math.abs(Math.cos(i)),o=0,l=0;r.start<t.l?(o=(t.l-r.start)/a,e.l=Math.min(e.l,t.l-o)):r.end>t.r&&(o=(r.end-t.r)/a,e.r=Math.max(e.r,t.r+o)),n.start<t.t?(l=(t.t-n.start)/s,e.t=Math.min(e.t,t.t-l)):n.end>t.b&&(l=(n.end-t.b)/s,e.b=Math.max(e.b,t.b+l))}(i,t,p,nO(g,h.x,f.w,0,180),nO(g,h.y,f.h,90,270))}e.setCenterPoint(t.l-i.l,i.r-t.r,t.t-i.t,i.b-t.b),e._pointLabelItems=function(e,t,i){let r,n=[],a=e._pointLabels.length,s=e.options,{centerPointLabels:o,display:l}=s.pointLabels,c={extra:nD(s)/2,additionalAngle:o?eb/a:0};for(let s=0;s<a;s++){c.padding=i[s],c.size=t[s];let a=function(e,t,i){var r,n,a,s,o,l,c;let u=e.drawingArea,{extra:h,additionalAngle:d,padding:f,size:p}=i,g=e.getPointPosition(t,u+h+f,d),v=Math.round(180/eb*eB(g.angle+eE)),y=(r=g.y,n=p.h,90===(a=v)||270===a?r-=n/2:(a>270||a<90)&&(r-=n),r),b=0===(s=v)||180===s?"center":s<180?"left":"right",x=(o=g.x,l=p.w,"right"===(c=b)?o-=l:"center"===c&&(o-=l/2),o);return{visible:!0,x:g.x,y:y,textAlign:b,left:x,top:y,right:x+p.w,bottom:y+p.h}}(e,s,c);n.push(a),"auto"===l&&(a.visible=function(e,t){if(!t)return!0;let{left:i,top:r,right:n,bottom:a}=e;return!(td({x:i,y:r},t)||td({x:i,y:a},t)||td({x:n,y:r},t)||td({x:n,y:a},t))}(a,r),a.visible&&(r=a))}return n}(e,r,n)}(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(e,t,i,r){this.xCenter+=Math.floor((e-t)/2),this.yCenter+=Math.floor((i-r)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(e,t,i,r))}getIndexAngle(e){return eB(e*(ex/(this._pointLabels.length||1))+eD(this.options.startAngle||0))}getDistanceFromCenterForValue(e){if(Z(e))return NaN;let t=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-e)*t:(e-this.min)*t}getValueForDistanceFromCenter(e){if(Z(e))return NaN;let t=e/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-t:this.min+t}getPointLabelContext(e){let t=this._pointLabels||[];if(e>=0&&e<t.length){var i;let r=t[e];return i=this.getContext(),tM(i,{label:r,index:e,type:"pointLabel"})}}getPointPosition(e,t,i=0){let r=this.getIndexAngle(e)-eE+i;return{x:Math.cos(r)*t+this.xCenter,y:Math.sin(r)*t+this.yCenter,angle:r}}getPointPositionForValue(e,t){return this.getPointPosition(e,this.getDistanceFromCenterForValue(t))}getBasePosition(e){return this.getPointPositionForValue(e||0,this.getBaseValue())}getPointLabelPosition(e){let{left:t,top:i,right:r,bottom:n}=this._pointLabelItems[e];return{left:t,top:i,right:r,bottom:n}}drawBackground(){let{backgroundColor:e,grid:{circular:t}}=this.options;if(e){let i=this.ctx;i.save(),i.beginPath(),nR(this,this.getDistanceFromCenterForValue(this._endValue),t,this._pointLabels.length),i.closePath(),i.fillStyle=e,i.fill(),i.restore()}}drawGrid(){let e,t,i,r=this.ctx,n=this.options,{angleLines:a,grid:s,border:o}=n,l=this._pointLabels.length;if(n.pointLabels.display&&function(e,t){let{ctx:i,options:{pointLabels:r}}=e;for(let n=t-1;n>=0;n--){let t=e._pointLabelItems[n];if(!t.visible)continue;let a=r.setContext(e.getPointLabelContext(n));!function(e,t,i){let{left:r,top:n,right:a,bottom:s}=i,{backdropColor:o}=t;if(!Z(o)){let i=tE(t.borderRadius),l=tT(t.backdropPadding);e.fillStyle=o;let c=r-l.left,u=n-l.top,h=a-r+l.width,d=s-n+l.height;Object.values(i).some(e=>0!==e)?(e.beginPath(),ty(e,{x:c,y:u,w:h,h:d,radius:i}),e.fill()):e.fillRect(c,u,h,d)}}(i,a,t);let s=tP(a.font),{x:o,y:l,textAlign:c}=t;tv(i,e._pointLabels[n],o,l+s.lineHeight/2,s,{color:a.color,textAlign:c,textBaseline:"middle"})}}(this,l),s.display&&this.ticks.forEach((e,i)=>{if(0!==i||0===i&&this.min<0){t=this.getDistanceFromCenterForValue(e.value);let r=this.getContext(i),n=s.setContext(r),a=o.setContext(r);!function(e,t,i,r,n){let a=e.ctx,s=t.circular,{color:o,lineWidth:l}=t;(s||r)&&o&&l&&!(i<0)&&(a.save(),a.strokeStyle=o,a.lineWidth=l,a.setLineDash(n.dash||[]),a.lineDashOffset=n.dashOffset,a.beginPath(),nR(e,i,s,r),a.closePath(),a.stroke(),a.restore())}(this,n,t,l,a)}}),a.display){for(r.save(),e=l-1;e>=0;e--){let s=a.setContext(this.getPointLabelContext(e)),{color:o,lineWidth:l}=s;l&&o&&(r.lineWidth=l,r.strokeStyle=o,r.setLineDash(s.borderDash),r.lineDashOffset=s.borderDashOffset,t=this.getDistanceFromCenterForValue(n.reverse?this.min:this.max),i=this.getPointPosition(e,t),r.beginPath(),r.moveTo(this.xCenter,this.yCenter),r.lineTo(i.x,i.y),r.stroke())}r.restore()}}drawBorder(){}drawLabels(){let e,t,i=this.ctx,r=this.options,n=r.ticks;if(!n.display)return;let a=this.getIndexAngle(0);i.save(),i.translate(this.xCenter,this.yCenter),i.rotate(a),i.textAlign="center",i.textBaseline="middle",this.ticks.forEach((a,s)=>{if(0===s&&this.min>=0&&!r.reverse)return;let o=n.setContext(this.getContext(s)),l=tP(o.font);if(e=this.getDistanceFromCenterForValue(this.ticks[s].value),o.showLabelBackdrop){i.font=l.string,t=i.measureText(a.label).width,i.fillStyle=o.backdropColor;let r=tT(o.backdropPadding);i.fillRect(-t/2-r.left,-e-l.size/2-r.top,t+r.width,l.size+r.height)}tv(i,a.label,0,-e,l,{color:o.color,strokeColor:o.textStrokeColor,strokeWidth:o.textStrokeWidth})}),i.restore()}drawTitle(){}}let nj={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},nB=Object.keys(nj);function nF(e,t){return e-t}function nz(e,t){if(Z(t))return null;let i=e._adapter,{parser:r,round:n,isoWeekday:a}=e._parseOpts,s=t;return("function"==typeof r&&(s=r(s)),ee(s)||(s="string"==typeof r?i.parse(s,r):i.parse(s)),null===s)?null:(n&&(s="week"===n&&(eI(a)||!0===a)?i.startOf(s,"isoWeek",a):i.startOf(s,n)),+s)}function nV(e,t,i,r){let n=nB.length;for(let a=nB.indexOf(e);a<n-1;++a){let e=nj[nB[a]],n=e.steps?e.steps:Number.MAX_SAFE_INTEGER;if(e.common&&Math.ceil((i-t)/(n*e.size))<=r)return nB[a]}return nB[n-1]}function nU(e,t,i){if(i){if(i.length){let{lo:r,hi:n}=eU(i,t);e[i[r]>=t?i[r]:i[n]]=!0}}else e[t]=!0}function n$(e,t,i){let r,n,a=[],s={},o=t.length;for(r=0;r<o;++r)s[n=t[r]]=r,a.push({value:n,major:!1});return 0!==o&&i?function(e,t,i,r){let n,a,s=e._adapter,o=+s.startOf(t[0].value,r),l=t[t.length-1].value;for(n=o;n<=l;n=+s.add(n,1,r))(a=i[n])>=0&&(t[a].major=!0);return t}(e,a,s,i):a}class nW extends rc{static id="time";static defaults={bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}};constructor(e){super(e),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(e,t={}){let i=e.time||(e.time={}),r=this._adapter=new iO(e.adapters.date);r.init(t),eh(i.displayFormats,r.formats()),this._parseOpts={parser:i.parser,round:i.round,isoWeekday:i.isoWeekday},super.init(e),this._normalized=t.normalized}parse(e,t){return void 0===e?null:nz(this,e)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){let e=this.options,t=this._adapter,i=e.time.unit||"day",{min:r,max:n,minDefined:a,maxDefined:s}=this.getUserBounds();function o(e){a||isNaN(e.min)||(r=Math.min(r,e.min)),s||isNaN(e.max)||(n=Math.max(n,e.max))}a&&s||(o(this._getLabelBounds()),("ticks"!==e.bounds||"labels"!==e.ticks.source)&&o(this.getMinMax(!1))),r=ee(r)&&!isNaN(r)?r:+t.startOf(Date.now(),i),n=ee(n)&&!isNaN(n)?n:+t.endOf(Date.now(),i)+1,this.min=Math.min(r,n-1),this.max=Math.max(r+1,n)}_getLabelBounds(){let e=this.getLabelTimestamps(),t=1/0,i=-1/0;return e.length&&(t=e[0],i=e[e.length-1]),{min:t,max:i}}buildTicks(){let e=this.options,t=e.time,i=e.ticks,r="labels"===i.source?this.getLabelTimestamps():this._generate();"ticks"===e.bounds&&r.length&&(this.min=this._userMin||r[0],this.max=this._userMax||r[r.length-1]);let n=this.min,a=function(e,t,i){let r=0,n=e.length;for(;r<n&&e[r]<t;)r++;for(;n>r&&e[n-1]>i;)n--;return r>0||n<e.length?e.slice(r,n):e}(r,n,this.max);return this._unit=t.unit||(i.autoSkip?nV(t.minUnit,this.min,this.max,this._getLabelCapacity(n)):function(e,t,i,r,n){for(let a=nB.length-1;a>=nB.indexOf(i);a--){let i=nB[a];if(nj[i].common&&e._adapter.diff(n,r,i)>=t-1)return i}return nB[i?nB.indexOf(i):0]}(this,a.length,t.minUnit,this.min,this.max)),this._majorUnit=i.major.enabled&&"year"!==this._unit?function(e){for(let t=nB.indexOf(e)+1,i=nB.length;t<i;++t)if(nj[nB[t]].common)return nB[t]}(this._unit):void 0,this.initOffsets(r),e.reverse&&a.reverse(),n$(this,a,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(e=>+e.value))}initOffsets(e=[]){let t,i,r=0,n=0;this.options.offset&&e.length&&(t=this.getDecimalForValue(e[0]),r=1===e.length?1-t:(this.getDecimalForValue(e[1])-t)/2,i=this.getDecimalForValue(e[e.length-1]),n=1===e.length?i:(i-this.getDecimalForValue(e[e.length-2]))/2);let a=e.length<3?.5:.25;r=ez(r,0,a),n=ez(n,0,a),this._offsets={start:r,end:n,factor:1/(r+1+n)}}_generate(){let e,t,i=this._adapter,r=this.min,n=this.max,a=this.options,s=a.time,o=s.unit||nV(s.minUnit,r,n,this._getLabelCapacity(r)),l=ei(a.ticks.stepSize,1),c="week"===o&&s.isoWeekday,u=eI(c)||!0===c,h={},d=r;if(u&&(d=+i.startOf(d,"isoWeek",c)),d=+i.startOf(d,u?"day":o),i.diff(n,r,o)>1e5*l)throw Error(r+" and "+n+" are too far apart with stepSize of "+l+" "+o);let f="data"===a.ticks.source&&this.getDataTimestamps();for(e=d,t=0;e<n;e=+i.add(e,l,o),t++)nU(h,e,f);return(e===n||"ticks"===a.bounds||1===t)&&nU(h,e,f),Object.keys(h).sort(nF).map(e=>+e)}getLabelForValue(e){let t=this._adapter,i=this.options.time;return i.tooltipFormat?t.format(e,i.tooltipFormat):t.format(e,i.displayFormats.datetime)}format(e,t){let i=this.options.time.displayFormats,r=this._unit,n=t||i[r];return this._adapter.format(e,n)}_tickFormatFunction(e,t,i,r){let n=this.options,a=n.ticks.callback;if(a)return en(a,[e,t,i],this);let s=n.time.displayFormats,o=this._unit,l=this._majorUnit,c=o&&s[o],u=l&&s[l],h=i[t],d=l&&u&&h&&h.major;return this._adapter.format(e,r||(d?u:c))}generateTickLabels(e){let t,i,r;for(t=0,i=e.length;t<i;++t)(r=e[t]).label=this._tickFormatFunction(r.value,t,e)}getDecimalForValue(e){return null===e?NaN:(e-this.min)/(this.max-this.min)}getPixelForValue(e){let t=this._offsets,i=this.getDecimalForValue(e);return this.getPixelForDecimal((t.start+i)*t.factor)}getValueForPixel(e){let t=this._offsets,i=this.getDecimalForPixel(e)/t.factor-t.end;return this.min+i*(this.max-this.min)}_getLabelSize(e){let t=this.options.ticks,i=this.ctx.measureText(e).width,r=eD(this.isHorizontal()?t.maxRotation:t.minRotation),n=Math.cos(r),a=Math.sin(r),s=this._resolveTickFontOptions(0).size;return{w:i*n+s*a,h:i*a+s*n}}_getLabelCapacity(e){let t=this.options.time,i=t.displayFormats,r=i[t.unit]||i.millisecond,n=this._tickFormatFunction(e,0,n$(this,[e],this._majorUnit),r),a=this._getLabelSize(n),s=Math.floor(this.isHorizontal()?this.width/a.w:this.height/a.h)-1;return s>0?s:1}getDataTimestamps(){let e,t,i=this._cache.data||[];if(i.length)return i;let r=this.getMatchingVisibleMetas();if(this._normalized&&r.length)return this._cache.data=r[0].controller.getAllParsedValues(this);for(e=0,t=r.length;e<t;++e)i=i.concat(r[e].controller.getAllParsedValues(this));return this._cache.data=this.normalize(i)}getLabelTimestamps(){let e,t,i=this._cache.labels||[];if(i.length)return i;let r=this.getLabels();for(e=0,t=r.length;e<t;++e)i.push(nz(this,r[e]));return this._cache.labels=this._normalized?i:this.normalize(i)}normalize(e){return eG(e.sort(nF))}}function nH(e,t,i){let r,n,a,s,o=0,l=e.length-1;i?(t>=e[o].pos&&t<=e[l].pos&&({lo:o,hi:l}=e$(e,"pos",t)),{pos:r,time:a}=e[o],{pos:n,time:s}=e[l]):(t>=e[o].time&&t<=e[l].time&&({lo:o,hi:l}=e$(e,"time",t)),{time:r,pos:a}=e[o],{time:n,pos:s}=e[l]);let c=n-r;return c?a+(s-a)*(t-r)/c:a}class nq extends nW{static id="timeseries";static defaults=nW.defaults;constructor(e){super(e),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){let e=this._getTimestampsForTable(),t=this._table=this.buildLookupTable(e);this._minPos=nH(t,this.min),this._tableRange=nH(t,this.max)-this._minPos,super.initOffsets(e)}buildLookupTable(e){let t,i,r,{min:n,max:a}=this,s=[],o=[];for(t=0,i=e.length;t<i;++t)(r=e[t])>=n&&r<=a&&s.push(r);if(s.length<2)return[{time:n,pos:0},{time:a,pos:1}];for(t=0,i=s.length;t<i;++t)Math.round((s[t+1]+s[t-1])/2)!==(r=s[t])&&o.push({time:r,pos:t/(i-1)});return o}_generate(){let e=this.min,t=this.max,i=super.getDataTimestamps();return i.includes(e)&&i.length||i.splice(0,0,e),i.includes(t)&&1!==i.length||i.push(t),i.sort((e,t)=>e-t)}_getTimestampsForTable(){let e=this._cache.all||[];if(e.length)return e;let t=this.getDataTimestamps(),i=this.getLabelTimestamps();return e=t.length&&i.length?this.normalize(t.concat(i)):t.length?t:i,e=this._cache.all=e}getDecimalForValue(e){return(nH(this._table,e)-this._minPos)/this._tableRange}getValueForPixel(e){let t=this._offsets,i=this.getDecimalForPixel(e)/t.factor-t.end;return nH(this._table,i*this._tableRange+this._minPos,!0)}}let nG="label";function nY(e,t){"function"==typeof e?e(t):e&&(e.current=t)}function nX(e,t,i=nG){let r=[];e.datasets=t.map(t=>{let n=e.datasets.find(e=>e[i]===t[i]);return!n||!t.data||r.includes(n)?{...t}:(r.push(n),Object.assign(n,t),n)})}let nK=(0,x.forwardRef)(function(e,t){let{height:i=150,width:r=300,redraw:n=!1,datasetIdKey:a,type:s,data:o,options:l,plugins:c=[],fallbackContent:u,updateMode:h,...d}=e,f=(0,x.useRef)(null),p=(0,x.useRef)(null),g=()=>{f.current&&(p.current=new rO(f.current,{type:s,data:function(e,t=nG){let i={labels:[],datasets:[]};return i.labels=e.labels,nX(i,e.datasets,t),i}(o,a),options:l&&{...l},plugins:c}),nY(t,p.current))},v=()=>{nY(t,null),p.current&&(p.current.destroy(),p.current=null)};return(0,x.useEffect)(()=>{var e;let t;!n&&p.current&&l&&(e=p.current,(t=e.options)&&l&&Object.assign(t,l))},[n,l]),(0,x.useEffect)(()=>{!n&&p.current&&(p.current.config.data.labels=o.labels)},[n,o.labels]),(0,x.useEffect)(()=>{!n&&p.current&&o.datasets&&nX(p.current.config.data,o.datasets,a)},[n,o.datasets]),(0,x.useEffect)(()=>{p.current&&(n?(v(),setTimeout(g)):p.current.update(h))},[n,l,o.labels,o.datasets,h]),(0,x.useEffect)(()=>{p.current&&(v(),setTimeout(g))},[s]),(0,x.useEffect)(()=>(g(),()=>v()),[]),(0,b.jsx)("canvas",{ref:f,role:"img",height:i,width:r,...d,children:u})});function nZ(e,t){return rO.register(t),(0,x.forwardRef)((t,i)=>(0,b.jsx)(nK,{...t,ref:i,type:e}))}let nJ=nZ("line",class extends ik{static id="line";static defaults={datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1};static overrides={scales:{_index_:{type:"category"},_value_:{type:"linear"}}};initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(e){let t=this._cachedMeta,{dataset:i,data:r=[],_dataset:n}=t,a=this.chart._animationsDisabled,{start:s,count:o}=eJ(t,r,a);this._drawStart=s,this._drawCount=o,eQ(t)&&(s=0,o=r.length),i._chart=this.chart,i._datasetIndex=this.index,i._decimated=!!n._decimated,i.points=r;let l=this.resolveDatasetElementOptions(e);this.options.showLine||(l.borderWidth=0),l.segment=this.options.segment,this.updateElement(i,void 0,{animated:!a,options:l},e),this.updateElements(r,s,o,e)}updateElements(e,t,i,r){let n="reset"===r,{iScale:a,vScale:s,_stacked:o,_dataset:l}=this._cachedMeta,{sharedOptions:c,includeOptions:u}=this._getSharedOptions(t,r),h=a.axis,d=s.axis,{spanGaps:f,segment:p}=this.options,g=eI(f)?f:1/0,v=this.chart._animationsDisabled||n||"none"===r,y=t+i,b=e.length,x=t>0&&this.getParsed(t-1);for(let i=0;i<b;++i){let f=e[i],b=v?f:{};if(i<t||i>=y){b.skip=!0;continue}let _=this.getParsed(i),w=Z(_[d]),k=b[h]=a.getPixelForValue(_[h],i),E=b[d]=n||w?s.getBasePixel():s.getPixelForValue(o?this.applyStack(s,_,o):_[d],i);b.skip=isNaN(k)||isNaN(E)||w,b.stop=i>0&&Math.abs(_[h]-x[h])>g,p&&(b.parsed=_,b.raw=l.data[i]),u&&(b.options=c||this.resolveDataElementOptions(i,f.active?"active":r)),v||this.updateElement(f,i,b,r),x=_}}getMaxOverflow(){let e=this._cachedMeta,t=e.dataset,i=t.options&&t.options.borderWidth||0,r=e.data||[];return r.length?Math.max(i,r[0].size(this.resolveDataElementOptions(0)),r[r.length-1].size(this.resolveDataElementOptions(r.length-1)))/2:i}draw(){let e=this._cachedMeta;e.dataset.updateControlPoints(this.chart.chartArea,e.iScale.axis),super.draw()}}),nQ=nZ("bar",class extends ik{static id="bar";static defaults={datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}};static overrides={scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}};parsePrimitiveData(e,t,i,r){return iT(e,t,i,r)}parseArrayData(e,t,i,r){return iT(e,t,i,r)}parseObjectData(e,t,i,r){let n,a,s,o,{iScale:l,vScale:c}=e,{xAxisKey:u="x",yAxisKey:h="y"}=this._parsing,d="x"===l.axis?u:h,f="x"===c.axis?u:h,p=[];for(n=i,a=i+r;n<a;++n)o=t[n],(s={})[l.axis]=l.parse(ep(o,d),n),p.push(iE(ep(o,f),s,c,n));return p}updateRangeFromParsed(e,t,i,r){super.updateRangeFromParsed(e,t,i,r);let n=i._custom;n&&t===this._cachedMeta.vScale&&(e.min=Math.min(e.min,n.min),e.max=Math.max(e.max,n.max))}getMaxOverflow(){return 0}getLabelAndValue(e){let{iScale:t,vScale:i}=this._cachedMeta,r=this.getParsed(e),n=r._custom,a=iP(n)?"["+n.start+", "+n.end+"]":""+i.getLabelForValue(r[i.axis]);return{label:""+t.getLabelForValue(r[t.axis]),value:a}}initialize(){this.enableOptionSharing=!0,super.initialize(),this._cachedMeta.stack=this.getDataset().stack}update(e){let t=this._cachedMeta;this.updateElements(t.data,0,t.data.length,e)}updateElements(e,t,i,r){let n="reset"===r,{index:a,_cachedMeta:{vScale:s}}=this,o=s.getBasePixel(),l=s.isHorizontal(),c=this._getRuler(),{sharedOptions:u,includeOptions:h}=this._getSharedOptions(t,r);for(let d=t;d<t+i;d++){let t=this.getParsed(d),i=n||Z(t[s.axis])?{base:o,head:o}:this._calculateBarValuePixels(d),f=this._calculateBarIndexPixels(d,c),p=(t._stacks||{})[s.axis],g={horizontal:l,base:i.base,enableBorderRadius:!p||iP(t._custom)||a===p._top||a===p._bottom,x:l?i.head:f.center,y:l?f.center:i.head,height:l?f.size:Math.abs(i.size),width:l?Math.abs(i.size):f.size};h&&(g.options=u||this.resolveDataElementOptions(d,e[d].active?"active":r));let v=g.options||e[d].options;!function(e,t,i,r){let n,a,s,o,l,c=t.borderSkipped,u={};if(!c){e.borderSkipped=u;return}if(!0===c){e.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}let{start:h,end:d,reverse:f,top:p,bottom:g}=(e.horizontal?(n=e.base>e.x,a="left",s="right"):(n=e.base<e.y,a="bottom",s="top"),n?(o="end",l="start"):(o="start",l="end"),{start:a,end:s,reverse:n,top:o,bottom:l});"middle"===c&&i&&(e.enableBorderRadius=!0,(i._top||0)===r?c=p:(i._bottom||0)===r?c=g:(u[iS(g,h,d,f)]=!0,c=p)),u[iS(c,h,d,f)]=!0,e.borderSkipped=u}(g,v,p,a),function(e,{inflateAmount:t},i){e.inflateAmount="auto"===t?.33*(1===i):t}(g,v,c.ratio),this.updateElement(e[d],d,g,r)}}_getStacks(e,t){let{iScale:i}=this._cachedMeta,r=i.getMatchingVisibleMetas(this._type).filter(e=>e.controller.options.grouped),n=i.options.stacked,a=[],s=this._cachedMeta.controller.getParsed(t),o=s&&s[i.axis],l=e=>{let t=e._parsed.find(e=>e[i.axis]===o),r=t&&t[e.vScale.axis];if(Z(r)||isNaN(r))return!0};for(let i of r)if(!(void 0!==t&&l(i))&&((!1===n||-1===a.indexOf(i.stack)||void 0===n&&void 0===i.stack)&&a.push(i.stack),i.index===e))break;return a.length||a.push(void 0),a}_getStackCount(e){return this._getStacks(void 0,e).length}_getAxisCount(){return this._getAxis().length}getFirstScaleIdForIndexAxis(){let e=this.chart.scales,t=this.chart.options.indexAxis;return Object.keys(e).filter(i=>e[i].axis===t).shift()}_getAxis(){let e={},t=this.getFirstScaleIdForIndexAxis();for(let i of this.chart.data.datasets)e[ei("x"===this.chart.options.indexAxis?i.xAxisID:i.yAxisID,t)]=!0;return Object.keys(e)}_getStackIndex(e,t,i){let r=this._getStacks(e,i),n=void 0!==t?r.indexOf(t):-1;return -1===n?r.length-1:n}_getRuler(){let e,t,i=this.options,r=this._cachedMeta,n=r.iScale,a=[];for(e=0,t=r.data.length;e<t;++e)a.push(n.getPixelForValue(this.getParsed(e)[n.axis],e));let s=i.barThickness;return{min:s||function(e){let t,i,r,n,a=e.iScale,s=function(e,t){if(!e._cache.$bar){let i=e.getMatchingVisibleMetas(t),r=[];for(let t=0,n=i.length;t<n;t++)r=r.concat(i[t].controller.getAllParsedValues(e));e._cache.$bar=eG(r.sort((e,t)=>e-t))}return e._cache.$bar}(a,e.type),o=a._length,l=()=>{32767!==r&&-32768!==r&&(em(n)&&(o=Math.min(o,Math.abs(r-n)||o)),n=r)};for(t=0,i=s.length;t<i;++t)r=a.getPixelForValue(s[t]),l();for(t=0,n=void 0,i=a.ticks.length;t<i;++t)r=a.getPixelForTick(t),l();return o}(r),pixels:a,start:n._startPixel,end:n._endPixel,stackCount:this._getStackCount(),scale:n,grouped:i.grouped,ratio:s?1:i.categoryPercentage*i.barPercentage}}_calculateBarValuePixels(e){let t,i,{_cachedMeta:{vScale:r,_stacked:n,index:a},options:{base:s,minBarLength:o}}=this,l=s||0,c=this.getParsed(e),u=c._custom,h=iP(u),d=c[r.axis],f=0,p=n?this.applyStack(r,c,n):d;p!==d&&(f=p-d,p=d),h&&(d=u.barStart,p=u.barEnd-u.barStart,0!==d&&eM(d)!==eM(u.barEnd)&&(f=0),f+=d);let g=Z(s)||h?f:s,v=r.getPixelForValue(g);if(Math.abs(i=(t=this.chart.getDataVisibility(e)?r.getPixelForValue(f+p):v)-v)<o){var y;i=(0!==(y=i)?eM(y):(r.isHorizontal()?1:-1)*(r.min>=l?1:-1))*o,d===l&&(v-=i/2);let e=r.getPixelForDecimal(0),s=r.getPixelForDecimal(1),u=Math.min(e,s);t=(v=Math.max(Math.min(v,Math.max(e,s)),u))+i,n&&!h&&(c._stacks[r.axis]._visualValues[a]=r.getValueForPixel(t)-r.getValueForPixel(v))}if(v===r.getPixelForValue(l)){let e=eM(i)*r.getLineWidthForValue(l)/2;v+=e,i-=e}return{size:i,base:v,head:t,center:t+i/2}}_calculateBarIndexPixels(e,t){let i,r,n=t.scale,a=this.options,s=a.skipNull,o=ei(a.maxBarThickness,1/0),l=this._getAxisCount();if(t.grouped){var c,u;let n,h,d,f,p,g,v,y,b,x=s?this._getStackCount(e):t.stackCount,_="flex"===a.barThickness?(c=x*l,h=(n=t.pixels)[e],d=e>0?n[e-1]:null,f=e<n.length-1?n[e+1]:null,p=a.categoryPercentage,null===d&&(d=h-(null===f?t.end-t.start:f-h)),null===f&&(f=h+h-d),g=h-(h-Math.min(d,f))/2*p,{chunk:Math.abs(f-d)/2*p/c,ratio:a.barPercentage,start:g}):(u=x*l,Z(b=a.barThickness)?(v=t.min*a.categoryPercentage,y=a.barPercentage):(v=b*u,y=1),{chunk:v/u,ratio:y,start:t.pixels[e]-v/2}),w="x"===this.chart.options.indexAxis?this.getDataset().xAxisID:this.getDataset().yAxisID,k=this._getAxis().indexOf(ei(w,this.getFirstScaleIdForIndexAxis())),E=this._getStackIndex(this.index,this._cachedMeta.stack,s?e:void 0)+k;i=_.start+_.chunk*E+_.chunk/2,r=Math.min(o,_.chunk*_.ratio)}else i=n.getPixelForValue(this.getParsed(e)[n.axis],e),r=Math.min(o,t.min*t.ratio);return{base:i-r/2,head:i+r/2,center:i,size:r}}draw(){let e=this._cachedMeta,t=e.vScale,i=e.data,r=i.length,n=0;for(;n<r;++n)null===this.getParsed(n)[t.axis]||i[n].hidden||i[n].draw(this._ctx)}}),n0=nZ("scatter",class extends ik{static id="scatter";static defaults={datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1};static overrides={interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}};getLabelAndValue(e){let t=this._cachedMeta,i=this.chart.data.labels||[],{xScale:r,yScale:n}=t,a=this.getParsed(e),s=r.getLabelForValue(a.x),o=n.getLabelForValue(a.y);return{label:i[e]||"",value:"("+s+", "+o+")"}}update(e){let t=this._cachedMeta,{data:i=[]}=t,r=this.chart._animationsDisabled,{start:n,count:a}=eJ(t,i,r);if(this._drawStart=n,this._drawCount=a,eQ(t)&&(n=0,a=i.length),this.options.showLine){this.datasetElementType||this.addElements();let{dataset:n,_dataset:a}=t;n._chart=this.chart,n._datasetIndex=this.index,n._decimated=!!a._decimated,n.points=i;let s=this.resolveDatasetElementOptions(e);s.segment=this.options.segment,this.updateElement(n,void 0,{animated:!r,options:s},e)}else this.datasetElementType&&(delete t.dataset,this.datasetElementType=!1);this.updateElements(i,n,a,e)}addElements(){let{showLine:e}=this.options;!this.datasetElementType&&e&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(e,t,i,r){let n="reset"===r,{iScale:a,vScale:s,_stacked:o,_dataset:l}=this._cachedMeta,c=this.resolveDataElementOptions(t,r),u=this.getSharedOptions(c),h=this.includeOptions(r,u),d=a.axis,f=s.axis,{spanGaps:p,segment:g}=this.options,v=eI(p)?p:1/0,y=this.chart._animationsDisabled||n||"none"===r,b=t>0&&this.getParsed(t-1);for(let c=t;c<t+i;++c){let t=e[c],i=this.getParsed(c),p=y?t:{},x=Z(i[f]),_=p[d]=a.getPixelForValue(i[d],c),w=p[f]=n||x?s.getBasePixel():s.getPixelForValue(o?this.applyStack(s,i,o):i[f],c);p.skip=isNaN(_)||isNaN(w)||x,p.stop=c>0&&Math.abs(i[d]-b[d])>v,g&&(p.parsed=i,p.raw=l.data[c]),h&&(p.options=u||this.resolveDataElementOptions(c,t.active?"active":r)),y||this.updateElement(t,c,p,r),b=i}this.updateSharedOptions(u,r,c)}getMaxOverflow(){let e=this._cachedMeta,t=e.data||[];if(!this.options.showLine){let e=0;for(let i=t.length-1;i>=0;--i)e=Math.max(e,t[i].size(this.resolveDataElementOptions(i))/2);return e>0&&e}let i=e.dataset,r=i.options&&i.options.borderWidth||0;return t.length?Math.max(r,t[0].size(this.resolveDataElementOptions(0)),t[t.length-1].size(this.resolveDataElementOptions(t.length-1)))/2:r}});function n1({data:e,detailed:t=!1}){let i=(0,x.useMemo)(()=>({labels:["Min (p5)","Median (p50)","Max (p95)"],datasets:[{label:"Single Operator",data:[e.singleOperator.range[0],e.singleOperator.latency,e.singleOperator.range[1]],backgroundColor:["rgba(34, 197, 94, 0.5)","rgba(6, 182, 212, 0.8)","rgba(168, 85, 247, 0.5)"],borderColor:["rgb(34, 197, 94)","rgb(6, 182, 212)","rgb(168, 85, 247)"],borderWidth:2},{label:"8-Operator Chain",data:[e.eightOperatorChain.range[0],e.eightOperatorChain.latency,e.eightOperatorChain.range[1]],backgroundColor:["rgba(59, 130, 246, 0.5)","rgba(6, 182, 212, 0.8)","rgba(236, 72, 153, 0.5)"],borderColor:["rgb(59, 130, 246)","rgb(6, 182, 212)","rgb(236, 72, 153)"],borderWidth:2}]}),[e]),r=(0,x.useMemo)(()=>({labels:["Throughput"],datasets:[{label:"Operations/Second",data:[e.throughput.opsPerSec/1e6],backgroundColor:"rgba(6, 182, 212, 0.8)",borderColor:"rgb(6, 182, 212)",borderWidth:2}]}),[e]);return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)("div",{className:"section-header",children:"Performance Benchmarks"}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,b.jsxs)("div",{className:"card",children:[(0,b.jsx)("h3",{className:"card-header",children:"Operator Latency Distribution"}),(0,b.jsx)("div",{className:"relative h-64",children:(0,b.jsx)(nQ,{data:i,options:{responsive:!0,maintainAspectRatio:!0,plugins:{legend:{labels:{color:"#cbd5e1",font:{size:12}}},tooltip:{callbacks:{label:e=>`${e.parsed.y.toFixed(3)} s`}}},scales:{y:{ticks:{color:"#94a3b8"},grid:{color:"rgba(148, 163, 184, 0.1)"},title:{display:!0,text:"Latency (s)",color:"#cbd5e1"}},x:{ticks:{color:"#94a3b8"},grid:{color:"rgba(148, 163, 184, 0.1)"}}}}})})]}),(0,b.jsxs)("div",{className:"card",children:[(0,b.jsx)("h3",{className:"card-header",children:"Sustained Throughput"}),(0,b.jsx)("div",{className:"relative h-64",children:(0,b.jsx)(nQ,{data:r,options:{responsive:!0,maintainAspectRatio:!0,indexAxis:"y",plugins:{legend:{labels:{color:"#cbd5e1",font:{size:12}}},tooltip:{callbacks:{label:e=>`${e.parsed.x.toFixed(2)}M ops/sec`}}},scales:{x:{ticks:{color:"#94a3b8"},grid:{color:"rgba(148, 163, 184, 0.1)"}},y:{ticks:{color:"#94a3b8"},grid:{display:!1}}}}})})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,b.jsxs)("div",{className:"card",children:[(0,b.jsx)("div",{className:"text-xs text-slate-400 uppercase",children:"Single Operator"}),(0,b.jsx)("div",{className:"text-3xl font-bold text-cyan-400 mt-2",children:e.singleOperator.latency}),(0,b.jsx)("div",{className:"text-xs text-slate-400 mt-1",children:"s (median)"}),(0,b.jsxs)("div",{className:"text-xs text-slate-500 mt-2",children:["Range: ",e.singleOperator.range[0]," - ",e.singleOperator.range[1]," s"]})]}),(0,b.jsxs)("div",{className:"card",children:[(0,b.jsx)("div",{className:"text-xs text-slate-400 uppercase",children:"8-Operator Chain"}),(0,b.jsx)("div",{className:"text-3xl font-bold text-cyan-400 mt-2",children:e.eightOperatorChain.latency}),(0,b.jsx)("div",{className:"text-xs text-slate-400 mt-1",children:"s (median)"}),(0,b.jsxs)("div",{className:"text-xs text-slate-500 mt-2",children:["Range: ",e.eightOperatorChain.range[0]," - ",e.eightOperatorChain.range[1]," s"]})]}),(0,b.jsxs)("div",{className:"card",children:[(0,b.jsx)("div",{className:"text-xs text-slate-400 uppercase",children:"Throughput"}),(0,b.jsxs)("div",{className:"text-3xl font-bold text-cyan-400 mt-2",children:[(e.throughput.opsPerSec/1e6).toFixed(2),"M"]}),(0,b.jsx)("div",{className:"text-xs text-slate-400 mt-1",children:"ops/sec"}),(0,b.jsx)("div",{className:"text-xs text-slate-500 mt-2",children:"Sustained performance"})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,b.jsxs)("div",{className:"card",children:[(0,b.jsx)("h3",{className:"card-header",children:"Information Processing Rate"}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-xs text-slate-400",children:"Total Rate"}),(0,b.jsxs)("div",{className:"text-2xl font-bold text-cyan-400",children:[e.informationProcessing.rate,"M"]}),(0,b.jsx)("div",{className:"text-xs text-slate-400",children:"nats/second"})]}),(0,b.jsx)("hr",{className:"border-slate-800"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-xs text-slate-400",children:"Per Operator"}),(0,b.jsxs)("div",{className:"text-lg font-semibold text-blue-400",children:[e.informationProcessing.perOperator," nats/s"]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-xs text-slate-400",children:"Per Chain"}),(0,b.jsxs)("div",{className:"text-lg font-semibold text-purple-400",children:[e.informationProcessing.totalPerChain," nats/s"]})]})]})]}),(0,b.jsxs)("div",{className:"card",children:[(0,b.jsx)("h3",{className:"card-header",children:"Performance Characteristics"}),(0,b.jsxs)("ul",{className:"space-y-2",children:[(0,b.jsxs)("li",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)("span",{className:"inline-block w-2 h-2 rounded-full bg-green-500"}),(0,b.jsx)("span",{className:"text-slate-300",children:"Consistent latency across all operators"})]}),(0,b.jsxs)("li",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)("span",{className:"inline-block w-2 h-2 rounded-full bg-green-500"}),(0,b.jsx)("span",{className:"text-slate-300",children:"Zero memory allocations in hot path"})]}),(0,b.jsxs)("li",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)("span",{className:"inline-block w-2 h-2 rounded-full bg-green-500"}),(0,b.jsx)("span",{className:"text-slate-300",children:"Deterministic execution time"})]}),(0,b.jsxs)("li",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)("span",{className:"inline-block w-2 h-2 rounded-full bg-green-500"}),(0,b.jsx)("span",{className:"text-slate-300",children:"Linear scaling with operator count"})]}),(0,b.jsxs)("li",{className:"flex items-center gap-2 text-sm",children:[(0,b.jsx)("span",{className:"inline-block w-2 h-2 rounded-full bg-green-500"}),(0,b.jsx)("span",{className:"text-slate-300",children:"Production-grade reliability"})]})]})]})]}),t&&(0,b.jsxs)("div",{className:"card",children:[(0,b.jsx)("h3",{className:"card-header",children:"Detailed Performance Metrics"}),(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{children:"Metric"}),(0,b.jsx)("th",{children:"Value"}),(0,b.jsx)("th",{children:"Unit"}),(0,b.jsx)("th",{children:"Status"})]})}),(0,b.jsxs)("tbody",{children:[(0,b.jsxs)("tr",{children:[(0,b.jsx)("td",{className:"font-semibold",children:"Single Operator (p50)"}),(0,b.jsx)("td",{className:"text-cyan-400 font-semibold",children:e.singleOperator.latency}),(0,b.jsx)("td",{children:"s"}),(0,b.jsx)("td",{children:(0,b.jsx)("span",{className:"metric-badge success",children:" Target Met"})})]}),(0,b.jsxs)("tr",{children:[(0,b.jsx)("td",{className:"font-semibold",children:"8-Operator Chain (p50)"}),(0,b.jsx)("td",{className:"text-cyan-400 font-semibold",children:e.eightOperatorChain.latency}),(0,b.jsx)("td",{children:"s"}),(0,b.jsx)("td",{children:(0,b.jsx)("span",{className:"metric-badge success",children:" Target Met"})})]}),(0,b.jsxs)("tr",{children:[(0,b.jsx)("td",{className:"font-semibold",children:"Throughput (sustained)"}),(0,b.jsxs)("td",{className:"text-cyan-400 font-semibold",children:[(e.throughput.opsPerSec/1e6).toFixed(2),"M"]}),(0,b.jsx)("td",{children:"ops/sec"}),(0,b.jsx)("td",{children:(0,b.jsx)("span",{className:"metric-badge success",children:" Target Met"})})]}),(0,b.jsxs)("tr",{children:[(0,b.jsx)("td",{className:"font-semibold",children:"Information Processing Rate"}),(0,b.jsxs)("td",{className:"text-cyan-400 font-semibold",children:[e.informationProcessing.rate,"M"]}),(0,b.jsx)("td",{children:"nats/sec"}),(0,b.jsx)("td",{children:(0,b.jsx)("span",{className:"metric-badge success",children:" Achieved"})})]})]})]})})]})]})}function n2({data:e}){let t=(0,x.useMemo)(()=>{let t=e.entropyReduction.stages;return{labels:t.map(e=>e.operator),datasets:[{label:"Entropy (nats)",data:[50,50-t[0].reduction,50-t[0].reduction-t[1].reduction,50-t.slice(0,2).reduce((e,t)=>e+t.reduction,0)-t[2].reduction,50-t.slice(0,3).reduce((e,t)=>e+t.reduction,0)-t[3].reduction,50-t.slice(0,4).reduce((e,t)=>e+t.reduction,0)-t[4].reduction,50-t.slice(0,5).reduce((e,t)=>e+t.reduction,0)-t[5].reduction,50-t.slice(0,6).reduce((e,t)=>e+t.reduction,0)-t[6].reduction,1],borderColor:"rgb(6, 182, 212)",backgroundColor:"rgba(6, 182, 212, 0.1)",borderWidth:3,fill:!0,tension:.4,pointRadius:6,pointBackgroundColor:"rgb(6, 182, 212)",pointBorderColor:"rgba(6, 182, 212, 0.8)",pointBorderWidth:2},{label:"Reduction per operator (nats)",data:t.map(e=>e.reduction),borderColor:"rgb(168, 85, 247)",backgroundColor:"rgba(168, 85, 247, 0.1)",borderWidth:2,yAxisID:"y1",tension:.4,pointRadius:4,pointBackgroundColor:"rgb(168, 85, 247)"}]}},[e]);return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)("div",{className:"section-header",children:"Entropy Reduction Cascade"}),(0,b.jsx)("div",{className:"card",children:(0,b.jsx)("div",{className:"relative h-96",children:(0,b.jsx)(nJ,{data:t,options:{responsive:!0,maintainAspectRatio:!0,interaction:{mode:"index",intersect:!1},plugins:{legend:{labels:{color:"#cbd5e1",font:{size:12}}},tooltip:{callbacks:{label:e=>"y1"===e.dataset.yAxisID?`Reduction: ${e.parsed.y.toFixed(1)} nats`:`Entropy: ${e.parsed.y.toFixed(1)} nats`}}},scales:{y:{position:"left",ticks:{color:"#94a3b8"},grid:{color:"rgba(148, 163, 184, 0.1)"},title:{display:!0,text:"Entropy (nats)",color:"#cbd5e1"}},y1:{position:"right",ticks:{color:"#94a3b8"},grid:{drawOnChartArea:!1},title:{display:!0,text:"Reduction (nats)",color:"#cbd5e1"}},x:{ticks:{color:"#94a3b8"},grid:{color:"rgba(148, 163, 184, 0.1)"}}}}})})}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,b.jsxs)("div",{className:"card",children:[(0,b.jsx)("h3",{className:"card-header",children:"Stage-by-Stage Analysis"}),(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{children:"Operator"}),(0,b.jsx)("th",{children:"Entropy In"}),(0,b.jsx)("th",{children:"Entropy Out"}),(0,b.jsx)("th",{children:"Reduction"})]})}),(0,b.jsxs)("tbody",{children:[(0,b.jsx)("tr",{children:(0,b.jsx)("td",{colSpan:"4",className:"font-semibold text-xs text-slate-400 bg-slate-800",children:"Initial State"})}),e.entropyReduction.stages.map((e,t)=>(0,b.jsxs)("tr",{children:[(0,b.jsx)("td",{className:"font-mono font-bold text-cyan-400",children:e.operator}),(0,b.jsx)("td",{className:"font-semibold",children:e.entropy.split("  ")[0]}),(0,b.jsx)("td",{className:"font-semibold",children:e.entropy.split("  ")[1]}),(0,b.jsxs)("td",{className:"font-semibold text-green-400",children:[e.reduction," nats"]})]},e.operator))]})]})})]}),(0,b.jsxs)("div",{className:"card space-y-4",children:[(0,b.jsx)("h3",{className:"card-header",children:"Key Insights"}),(0,b.jsxs)("div",{className:"bg-slate-800/50 rounded p-3 space-y-2",children:[(0,b.jsx)("div",{className:"text-xs text-slate-400 uppercase font-semibold",children:"Total Compression"}),(0,b.jsx)("div",{className:"text-3xl font-bold text-cyan-400",children:"49 nats"}),(0,b.jsx)("div",{className:"text-xs text-slate-400",children:"From 50 initial  1 observable"})]}),(0,b.jsxs)("div",{className:"bg-slate-800/50 rounded p-3 space-y-2",children:[(0,b.jsx)("div",{className:"text-xs text-slate-400 uppercase font-semibold",children:"Average Reduction"}),(0,b.jsx)("div",{className:"text-3xl font-bold text-purple-400",children:"6.1 nats"}),(0,b.jsx)("div",{className:"text-xs text-slate-400",children:"Per operator (49  8)"})]}),(0,b.jsxs)("div",{className:"bg-slate-800/50 rounded p-3 space-y-2",children:[(0,b.jsx)("div",{className:"text-xs text-slate-400 uppercase font-semibold",children:"Information Loss"}),(0,b.jsx)("div",{className:"text-2xl font-bold text-orange-400",children:"98%"}),(0,b.jsx)("div",{className:"text-xs text-slate-400",children:"Irreversibly lost to causally-unreachable space"})]}),(0,b.jsx)("p",{className:"text-sm text-slate-400 border-l-2 border-cyan-500 pl-3",children:"The entropy cascade demonstrates that transforming intent to observable outcome requires progressive information reduction. Some information is irreversibly lost, making opacity a mathematical inevitability."})]})]})]})}function n3({data:e}){return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)("div",{className:"section-header",children:"Information Theory Analysis"}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"card",children:[(0,b.jsx)("h3",{className:"card-header",children:"Shannon Entropy Compression"}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex justify-between items-baseline mb-2",children:[(0,b.jsx)("span",{className:"text-sm text-slate-400",children:"User Intent ()"}),(0,b.jsx)("span",{className:"text-2xl font-bold text-orange-400",children:"50 nats"})]}),(0,b.jsx)("div",{className:"relative h-2 bg-slate-800 rounded-full overflow-hidden",children:(0,b.jsx)("div",{className:"h-full bg-gradient-to-r from-orange-500 to-red-500 rounded-full w-full"})})]}),(0,b.jsx)("div",{className:"text-center text-slate-400 text-sm",children:" Transform "}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex justify-between items-baseline mb-2",children:[(0,b.jsx)("span",{className:"text-sm text-slate-400",children:"Observable Outcome (A)"}),(0,b.jsx)("span",{className:"text-2xl font-bold text-green-400",children:"1 nat"})]}),(0,b.jsx)("div",{className:"relative h-2 bg-slate-800 rounded-full overflow-hidden",children:(0,b.jsx)("div",{className:"h-full bg-gradient-to-r from-green-500 to-cyan-500 rounded-full w-1"})})]})]})]}),(0,b.jsxs)("div",{className:"card",children:[(0,b.jsx)("h3",{className:"card-header",children:"Mutual Information"}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"bg-slate-800/50 rounded p-4",children:[(0,b.jsx)("div",{className:"text-xs text-slate-400 uppercase mb-1",children:"I(; A)"}),(0,b.jsx)("div",{className:"text-4xl font-bold text-cyan-400",children:" 49 nats"}),(0,b.jsx)("div",{className:"text-xs text-slate-300 mt-2",children:"Information shared between intent and observable outcomes"})]}),(0,b.jsxs)("div",{className:"text-sm text-slate-400 space-y-1",children:[(0,b.jsx)("p",{children:" 98% of user intent influences observable outcomes"}),(0,b.jsx)("p",{children:" 2% irreversibly lost to causally-unreachable space"}),(0,b.jsx)("p",{children:" High determinism: most intent maps to measurable behavior"})]})]})]}),(0,b.jsxs)("div",{className:"card",children:[(0,b.jsx)("h3",{className:"card-header",children:"Channel Capacity Constraint"}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"bg-slate-800/50 rounded p-4",children:[(0,b.jsx)("div",{className:"text-xs text-slate-400 uppercase mb-1",children:"C (per operator)"}),(0,b.jsx)("div",{className:"text-4xl font-bold text-purple-400",children:"6.1 nats"}),(0,b.jsx)("div",{className:"text-xs text-slate-300 mt-2",children:"Maximum information transfer per operator"})]}),(0,b.jsxs)("div",{className:"bg-slate-800/50 rounded p-4",children:[(0,b.jsx)("div",{className:"text-xs text-slate-400 uppercase mb-1",children:"Minimum Operators Required"}),(0,b.jsx)("div",{className:"text-2xl font-bold text-blue-400",children:"n_min  8.11  8"}),(0,b.jsx)("div",{className:"text-xs text-slate-300 mt-2",children:"Formula: n_min  (H() - H(A)) / C_max"}),(0,b.jsx)("div",{className:"text-xs text-slate-400 mt-2",children:"= (50 - 1) / 6.1  8.11"})]})]})]}),(0,b.jsxs)("div",{className:"card",children:[(0,b.jsx)("h3",{className:"card-header",children:"Theoretical Implications"}),(0,b.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,b.jsxs)("div",{className:"border-l-2 border-cyan-500 pl-3 py-2",children:[(0,b.jsx)("div",{className:"font-semibold text-slate-200",children:"Opacity is Mathematical Inevitable"}),(0,b.jsx)("p",{className:"text-slate-400",children:"Some information must be irreversibly lost due to channel capacity limits."})]}),(0,b.jsxs)("div",{className:"border-l-2 border-blue-500 pl-3 py-2",children:[(0,b.jsx)("div",{className:"font-semibold text-slate-200",children:"Operator Necessity"}),(0,b.jsx)("p",{className:"text-slate-400",children:"Cannot compress 501 nats with fewer than 8 operators given 6.1 nat capacity."})]}),(0,b.jsxs)("div",{className:"border-l-2 border-purple-500 pl-3 py-2",children:[(0,b.jsx)("div",{className:"font-semibold text-slate-200",children:"Operator Sufficiency"}),(0,b.jsx)("p",{className:"text-slate-400",children:"8 operators empirically sufficient across all use cases with no additional benefit."})]})]})]})]})]})}function n4({data:e}){let t=(0,x.useMemo)(()=>{let t=e.fmea.topRisks;return{labels:t.map(e=>e.name),datasets:[{label:"RPN Before Mitigation",data:t.map(e=>e.before),backgroundColor:"rgba(239, 68, 68, 0.7)",borderColor:"rgb(239, 68, 68)",borderWidth:2},{label:"RPN After Mitigation",data:t.map(e=>e.after),backgroundColor:"rgba(34, 197, 94, 0.7)",borderColor:"rgb(34, 197, 94)",borderWidth:2}]}},[e]);return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)("div",{className:"section-header",children:"FMEA Risk Analysis"}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,b.jsxs)("div",{className:"card",children:[(0,b.jsx)("div",{className:"text-xs text-slate-400 uppercase",children:"Total Failure Modes"}),(0,b.jsx)("div",{className:"text-3xl font-bold text-cyan-400 mt-2",children:e.fmea.totalFailureModes}),(0,b.jsx)("div",{className:"text-xs text-slate-500 mt-1",children:"Identified and analyzed"})]}),(0,b.jsxs)("div",{className:"card",children:[(0,b.jsx)("div",{className:"text-xs text-slate-400 uppercase",children:"RPN Reduction"}),(0,b.jsxs)("div",{className:"text-3xl font-bold text-green-400 mt-2",children:[e.fmea.riskReduction,"%"]}),(0,b.jsx)("div",{className:"text-xs text-slate-500 mt-1",children:"Average risk decrease"})]}),(0,b.jsxs)("div",{className:"card",children:[(0,b.jsx)("div",{className:"text-xs text-slate-400 uppercase",children:"Risk Categories"}),(0,b.jsx)("div",{className:"text-3xl font-bold text-purple-400 mt-2",children:e.fmea.categories}),(0,b.jsx)("div",{className:"text-xs text-slate-500 mt-1",children:"Mitigation strategies applied"})]})]}),(0,b.jsxs)("div",{className:"card",children:[(0,b.jsx)("h3",{className:"card-header",children:"Top 5 Risk Priority Numbers (RPN)"}),(0,b.jsx)("div",{className:"relative h-80",children:(0,b.jsx)(nQ,{data:t,options:{responsive:!0,maintainAspectRatio:!0,indexAxis:"y",plugins:{legend:{labels:{color:"#cbd5e1",font:{size:12}}},tooltip:{callbacks:{label:e=>`RPN: ${e.parsed.x}`}}},scales:{x:{ticks:{color:"#94a3b8"},grid:{color:"rgba(148, 163, 184, 0.1)"}},y:{ticks:{color:"#94a3b8"},grid:{display:!1}}}}})})]}),(0,b.jsxs)("div",{className:"card",children:[(0,b.jsx)("h3",{className:"card-header",children:"Failure Mode Risk Assessment"}),(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{children:"ID"}),(0,b.jsx)("th",{children:"Failure Mode"}),(0,b.jsx)("th",{children:"RPN Before"}),(0,b.jsx)("th",{children:"RPN After"}),(0,b.jsx)("th",{children:"Reduction"}),(0,b.jsx)("th",{children:"Mitigation Status"})]})}),(0,b.jsx)("tbody",{children:e.fmea.topRisks.map(e=>{let t=((e.before-e.after)/e.before*100).toFixed(0);return(0,b.jsxs)("tr",{children:[(0,b.jsx)("td",{className:"font-mono font-bold text-cyan-400",children:e.id}),(0,b.jsx)("td",{className:"font-semibold",children:e.name}),(0,b.jsx)("td",{className:"text-red-400 font-bold",children:e.before}),(0,b.jsx)("td",{className:"text-green-400 font-bold",children:e.after}),(0,b.jsxs)("td",{className:"text-green-400 font-semibold",children:[t,"%"]}),(0,b.jsx)("td",{children:(0,b.jsx)("span",{className:"metric-badge success",children:" Implemented"})})]},e.id)})})]})})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,b.jsxs)("div",{className:"card",children:[(0,b.jsx)("h3",{className:"card-header",children:"Parse-Time Mitigations"}),(0,b.jsxs)("ul",{className:"space-y-2 text-sm",children:[(0,b.jsxs)("li",{className:"flex gap-2",children:[(0,b.jsx)("span",{className:"inline-block w-1.5 h-1.5 rounded-full bg-cyan-400 mt-1.5"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-semibold text-slate-200",children:"Operator-Threshold Validation"}),(0,b.jsx)("div",{className:"text-xs text-slate-400",children:"Prevent invalid operator/threshold combinations"})]})]}),(0,b.jsxs)("li",{className:"flex gap-2",children:[(0,b.jsx)("span",{className:"inline-block w-1.5 h-1.5 rounded-full bg-cyan-400 mt-1.5"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-semibold text-slate-200",children:"Cron Expression Validation"}),(0,b.jsx)("div",{className:"text-xs text-slate-400",children:"Strict validation of scheduling expressions"})]})]}),(0,b.jsxs)("li",{className:"flex gap-2",children:[(0,b.jsx)("span",{className:"inline-block w-1.5 h-1.5 rounded-full bg-cyan-400 mt-1.5"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-semibold text-slate-200",children:"Interval Bounds Validation"}),(0,b.jsx)("div",{className:"text-xs text-slate-400",children:"Enforce safe timing constraints (10ms - 24hrs)"})]})]})]})]}),(0,b.jsxs)("div",{className:"card",children:[(0,b.jsx)("h3",{className:"card-header",children:"Runtime Guards"}),(0,b.jsxs)("ul",{className:"space-y-2 text-sm",children:[(0,b.jsxs)("li",{className:"flex gap-2",children:[(0,b.jsx)("span",{className:"inline-block w-1.5 h-1.5 rounded-full bg-green-400 mt-1.5"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-semibold text-slate-200",children:"Non-Boolean Validation Guard"}),(0,b.jsx)("div",{className:"text-xs text-slate-400",children:"Coerce and warn on non-boolean validation returns"})]})]}),(0,b.jsxs)("li",{className:"flex gap-2",children:[(0,b.jsx)("span",{className:"inline-block w-1.5 h-1.5 rounded-full bg-green-400 mt-1.5"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-semibold text-slate-200",children:"Recursive Execution Guard"}),(0,b.jsx)("div",{className:"text-xs text-slate-400",children:"Prevent nested hook executions"})]})]}),(0,b.jsxs)("li",{className:"flex gap-2",children:[(0,b.jsx)("span",{className:"inline-block w-1.5 h-1.5 rounded-full bg-green-400 mt-1.5"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"font-semibold text-slate-200",children:"Stack Trace Preservation"}),(0,b.jsx)("div",{className:"text-xs text-slate-400",children:"Maintain error context through hook chains"})]})]})]})]})]})]})}function n5({data:e}){let t=(0,x.useMemo)(()=>({datasets:[{label:"JTBD Scenarios",data:e.jtbd.map(e=>({x:e.latency,y:e.reduction,label:e.name})),backgroundColor:"rgba(6, 182, 212, 0.7)",borderColor:"rgb(6, 182, 212)",borderWidth:2,pointRadius:8,pointHoverRadius:10}]}),[e]),i=(e.jtbd.reduce((e,t)=>e+t.latency,0)/e.jtbd.length).toFixed(2),r=(e.jtbd.reduce((e,t)=>e+t.reduction,0)/e.jtbd.length).toFixed(1);return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)("div",{className:"section-header",children:"Jobs-To-Be-Done (JTBD) Validation"}),(0,b.jsx)("p",{className:"text-slate-400 text-sm max-w-2xl",children:"Customer-centric scenarios validating that the (O) calculus framework meets real-world e-commerce use cases. Each scenario demonstrates intent-to-outcome transformation with measurable latency and entropy reduction."}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,b.jsxs)("div",{className:"card",children:[(0,b.jsx)("div",{className:"text-xs text-slate-400 uppercase",children:"Total Scenarios"}),(0,b.jsx)("div",{className:"text-3xl font-bold text-cyan-400 mt-2",children:e.jtbd.length}),(0,b.jsx)("div",{className:"text-xs text-slate-500 mt-1",children:"Validated use cases"})]}),(0,b.jsxs)("div",{className:"card",children:[(0,b.jsx)("div",{className:"text-xs text-slate-400 uppercase",children:"Avg Latency"}),(0,b.jsx)("div",{className:"text-3xl font-bold text-cyan-400 mt-2",children:i}),(0,b.jsx)("div",{className:"text-xs text-slate-500 mt-1",children:"s per scenario"})]}),(0,b.jsxs)("div",{className:"card",children:[(0,b.jsx)("div",{className:"text-xs text-slate-400 uppercase",children:"Avg Entropy "}),(0,b.jsx)("div",{className:"text-3xl font-bold text-cyan-400 mt-2",children:r}),(0,b.jsx)("div",{className:"text-xs text-slate-500 mt-1",children:"nats reduction"})]}),(0,b.jsxs)("div",{className:"card",children:[(0,b.jsx)("div",{className:"text-xs text-slate-400 uppercase",children:"Success Rate"}),(0,b.jsx)("div",{className:"text-3xl font-bold text-green-400 mt-2",children:"100%"}),(0,b.jsx)("div",{className:"text-xs text-slate-500 mt-1",children:"All scenarios passing"})]})]}),(0,b.jsxs)("div",{className:"card",children:[(0,b.jsx)("h3",{className:"card-header",children:"Latency vs. Entropy Reduction"}),(0,b.jsx)("div",{className:"relative h-80",children:(0,b.jsx)(n0,{data:t,options:{responsive:!0,maintainAspectRatio:!0,plugins:{legend:{labels:{color:"#cbd5e1",font:{size:12}}},tooltip:{callbacks:{label:e=>{let t=e.raw;return`${t.label}: ${t.x.toFixed(2)} s, ${t.y.toFixed(1)} nats`}}}},scales:{x:{type:"linear",position:"bottom",ticks:{color:"#94a3b8"},grid:{color:"rgba(148, 163, 184, 0.1)"},title:{display:!0,text:"Latency (s)",color:"#cbd5e1"}},y:{ticks:{color:"#94a3b8"},grid:{color:"rgba(148, 163, 184, 0.1)"},title:{display:!0,text:"Entropy Reduction (nats)",color:"#cbd5e1"}}}}})})]}),(0,b.jsxs)("div",{className:"card",children:[(0,b.jsx)("h3",{className:"card-header",children:"Scenario Details"}),(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{children:"JTBD ID"}),(0,b.jsx)("th",{children:"Scenario"}),(0,b.jsx)("th",{children:"Latency (s)"}),(0,b.jsx)("th",{children:"Entropy Reduction (nats)"}),(0,b.jsx)("th",{children:"Status"})]})}),(0,b.jsx)("tbody",{children:e.jtbd.map(e=>(0,b.jsxs)("tr",{children:[(0,b.jsx)("td",{className:"font-mono font-bold text-cyan-400",children:e.id}),(0,b.jsx)("td",{className:"font-semibold",children:e.name}),(0,b.jsx)("td",{className:"text-cyan-400 font-semibold",children:e.latency}),(0,b.jsx)("td",{className:"text-green-400 font-semibold",children:e.reduction.toFixed(1)}),(0,b.jsx)("td",{children:(0,b.jsx)("span",{className:"metric-badge success",children:" Passing"})})]},e.id))})]})})]}),(0,b.jsxs)("div",{className:"card",children:[(0,b.jsx)("h3",{className:"card-header",children:"JTBD Methodology"}),(0,b.jsx)("p",{className:"text-sm text-slate-400 mb-4",children:"Jobs-To-Be-Done is a customer-centric methodology that focuses on understanding what customers are trying to accomplish. Each scenario represents a distinct job that our framework must successfully support."}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"bg-slate-800/50 rounded p-4 space-y-2",children:[(0,b.jsx)("div",{className:"font-semibold text-slate-200",children:"Transactional Jobs"}),(0,b.jsxs)("ul",{className:"text-xs text-slate-400 space-y-1",children:[(0,b.jsx)("li",{children:" Order fulfillment validation"}),(0,b.jsx)("li",{children:" Shipping address verification"}),(0,b.jsx)("li",{children:" Account consistency maintenance"})]})]}),(0,b.jsxs)("div",{className:"bg-slate-800/50 rounded p-4 space-y-2",children:[(0,b.jsx)("div",{className:"font-semibold text-slate-200",children:"Operational Jobs"}),(0,b.jsxs)("ul",{className:"text-xs text-slate-400 space-y-1",children:[(0,b.jsx)("li",{children:" Recurring purchase automation"}),(0,b.jsx)("li",{children:" Listing compliance checking"}),(0,b.jsx)("li",{children:" Bulk update processing"})]})]})]})]})]})}function n6({data:e}){let t=[{id:"",name:"Subject IRI Validation",purpose:"Validate subject term is valid RDF Named Node",complexity:"O(1)",successRate:"99.2%"},{id:"",name:"Predicate IRI Validation",purpose:"Enforce predicate term is RDF property URI",complexity:"O(1)",successRate:"98.8%"},{id:"",name:"Object Type Checking",purpose:"Validate object matches expected RDF term type",complexity:"O(1)",successRate:"97.1%"},{id:"",name:"Graph Resolution",purpose:"Bind quad to named graph or default graph",complexity:"O(1)",successRate:"99.5%"},{id:"",name:"Semantic Validation",purpose:"Enforce ontology constraints and domain rules",complexity:"O(log n)",successRate:"96.3%"},{id:"",name:"Transform Rules Application",purpose:"Apply quad transformations (term rewriting)",complexity:"O(n)",successRate:"94.7%"},{id:"",name:"Notification Emission",purpose:"Emit change signals for subscribers",complexity:"O(m)",successRate:"99.9%"},{id:"",name:"Outcome Observation",purpose:"Crystallize final observable state",complexity:"O(1)",successRate:"100%"}];return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)("div",{className:"section-header",children:"Operator Cardinality & Information Flow"}),(0,b.jsx)("p",{className:"text-slate-400 text-sm max-w-2xl",children:"The (O) calculus defines 8 information-theoretic operators necessary and sufficient to transform user intent into deterministic outcomes. Each operator reduces entropy and serves a distinct semantic function."}),(0,b.jsxs)("div",{className:"card overflow-x-auto",children:[(0,b.jsx)("h3",{className:"card-header",children:"Operator Details"}),(0,b.jsxs)("table",{children:[(0,b.jsx)("thead",{children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{children:"Operator"}),(0,b.jsx)("th",{children:"Name"}),(0,b.jsx)("th",{children:"Purpose"}),(0,b.jsx)("th",{children:"Complexity"}),(0,b.jsx)("th",{children:"Success Rate"})]})}),(0,b.jsx)("tbody",{children:t.map(e=>(0,b.jsxs)("tr",{children:[(0,b.jsx)("td",{className:"font-mono font-bold text-cyan-400",children:e.id}),(0,b.jsx)("td",{className:"font-semibold",children:e.name}),(0,b.jsx)("td",{className:"text-sm text-slate-400",children:e.purpose}),(0,b.jsx)("td",{className:"font-mono text-sm",children:e.complexity}),(0,b.jsx)("td",{className:"text-green-400 font-semibold",children:e.successRate})]},e.id))})]})]}),(0,b.jsxs)("div",{className:"card space-y-4",children:[(0,b.jsx)("h3",{className:"card-header",children:"Operator Cardinality Theorem"}),(0,b.jsxs)("div",{className:"space-y-4 text-sm",children:[(0,b.jsx)("p",{className:"text-slate-400",children:"The number of operators required to transform user intent into observable outcomes is both information-theoretically necessary and empirically sufficient at exactly 8."}),(0,b.jsxs)("div",{className:"bg-slate-800/50 border border-slate-700 rounded-lg p-4 space-y-3 font-mono text-cyan-400 text-sm",children:[(0,b.jsx)("p",{className:"text-cyan-300",children:"n_min  (H() - H(A)) / C_max"}),(0,b.jsx)("p",{className:"text-cyan-300",children:"n_min  (50 - 1) / 6.1"}),(0,b.jsx)("p",{className:"text-green-400",children:"n_min  8.11  8 operators (necessary)"})]}),(0,b.jsxs)("p",{className:"text-slate-300 border-t border-slate-700 pt-3",children:[(0,b.jsx)("span",{className:"font-semibold",children:"Given:"})," H() = 50 nats (user intent entropy), H(A) = 1 nat (observable outcome entropy), C_max = 6.1 nats/operator (maximum channel capacity per operator)"]})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,b.jsxs)("div",{className:"card",children:[(0,b.jsx)("div",{className:"text-sm text-slate-400 uppercase tracking-wider mb-2",children:"Total Information Loss"}),(0,b.jsx)("div",{className:"text-2xl font-bold text-cyan-400",children:"49 nats"}),(0,b.jsx)("div",{className:"text-xs text-slate-400 mt-2",children:"50 initial  1 observable"})]}),(0,b.jsxs)("div",{className:"card",children:[(0,b.jsx)("div",{className:"text-sm text-slate-400 uppercase tracking-wider mb-2",children:"Avg Reduction/Operator"}),(0,b.jsx)("div",{className:"text-2xl font-bold text-cyan-400",children:"6.1 nats"}),(0,b.jsx)("div",{className:"text-xs text-slate-400 mt-2",children:"49  8 operators"})]}),(0,b.jsxs)("div",{className:"card",children:[(0,b.jsx)("div",{className:"text-sm text-slate-400 uppercase tracking-wider mb-2",children:"Determinism Guarantee"}),(0,b.jsx)("div",{className:"text-2xl font-bold text-green-400",children:"100%"}),(0,b.jsx)("div",{className:"text-xs text-slate-400 mt-2",children:"Per-operator reproducibility"})]})]}),(0,b.jsxs)("div",{className:"card",children:[(0,b.jsx)("h3",{className:"card-header",children:"Information Flow Through Operator Chain"}),(0,b.jsx)("div",{className:"space-y-2",children:e.entropyReduction.stages.map((i,r)=>(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"flex items-center gap-4 mb-1",children:[(0,b.jsx)("span",{className:"font-mono font-bold text-cyan-400 w-8",children:i.operator}),(0,b.jsx)("span",{className:"font-semibold flex-1",children:t[r]?.name||`Operator ${r+1}`}),(0,b.jsx)("span",{className:"text-sm text-slate-400 w-24 text-right",children:i.entropy})]}),(0,b.jsxs)("div",{className:"ml-12 h-6 bg-gradient-to-r from-cyan-500/20 to-blue-500/20 rounded border border-slate-700 flex items-center px-2 text-xs font-mono text-cyan-300",children:[" ",i.reduction," nats"]}),r<e.entropyReduction.stages.length-1&&(0,b.jsx)("div",{className:"ml-12 h-8 flex items-center justify-center text-slate-500",children:""})]},i.operator))})]}),(0,b.jsxs)("div",{className:"card space-y-4",children:[(0,b.jsx)("h3",{className:"card-header",children:"Theoretical Implications"}),(0,b.jsxs)("div",{className:"border-l-2 border-cyan-500 pl-4",children:[(0,b.jsx)("p",{className:"font-semibold text-slate-200 mb-1",children:"Information Channel Capacity"}),(0,b.jsx)("p",{className:"text-slate-400 text-sm",children:"Each operator has theoretical channel capacity C_i  6.1 nats. Some information is irreversibly lost (diverges to causally-unreachable space), proving opacity is mathematically inevitable."})]}),(0,b.jsxs)("div",{className:"border-l-2 border-blue-500 pl-4",children:[(0,b.jsx)("p",{className:"font-semibold text-slate-200 mb-1",children:"Operator Necessity"}),(0,b.jsx)("p",{className:"text-slate-400 text-sm",children:"Cannot achieve 501 nat compression with fewer than 8 operators given 6.1 nat/operator limit. Fewer operators means some information must be arbitrarily discarded (non-determinism)."})]}),(0,b.jsxs)("div",{className:"border-l-2 border-purple-500 pl-4",children:[(0,b.jsx)("p",{className:"font-semibold text-slate-200 mb-1",children:"Operator Sufficiency"}),(0,b.jsx)("p",{className:"text-slate-400 text-sm",children:"8 operators empirically sufficient across all JTBD scenarios. No additional operators needed; additional operators would merely re-compress already-compressed information with diminishing returns."})]})]})]})}rO.register(nE,nS,rY,rq,r0,nu,nw,nl,nn),rO.register(nE,nS,rY,rq,nu,nw,nl,nn),rO.register(nE,nS,r0,nu,nw,nl),rO.register(nS,rY,nu,nw,nl);let n8=1,n9=1;class n7{time=0;channels=new Map;animations=new Map;playing=!1;lastEngineTime=-1;constructor(){}addChannel(e){let{delay:t=0,duration:i=1/0,rate:r=1,repeat:n=1}=e,a=n8++,s={time:0,delay:t,duration:i,rate:r,repeat:n};return this._setChannelTime(s,this.time),this.channels.set(a,s),a}removeChannel(e){for(let[t,i]of(this.channels.delete(e),this.animations))i.channel===e&&this.detachAnimation(t)}isFinished(e){let t=this.channels.get(e);return void 0!==t&&this.time>=t.delay+t.duration*t.repeat}getTime(e){if(void 0===e)return this.time;let t=this.channels.get(e);return void 0===t?-1:t.time}setTime(e){for(let t of(this.time=Math.max(0,e),this.channels.values()))this._setChannelTime(t,this.time);for(let e of this.animations.values()){let{animation:t,channel:i}=e;t.setTime(this.getTime(i))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){let i=n9++;return this.animations.set(i,{animation:e,channel:t}),e.setTime(this.getTime(t)),i}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(-1===this.lastEngineTime&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){let i=t-e.delay;i>=e.duration*e.repeat?e.time=e.duration*e.rate:(e.time=Math.max(0,i)%e.duration,e.time*=e.rate)}}function ae(e,t){if(!e)throw Error(t||"shadertools: assertion failed.")}let at={number:{type:"number",validate:(e,t)=>Number.isFinite(e)&&"object"==typeof t&&(void 0===t.max||e<=t.max)&&(void 0===t.min||e>=t.min)},array:{type:"array",validate:(e,t)=>Array.isArray(e)||ArrayBuffer.isView(e)}};function ai(e){return Array.isArray(e)||ArrayBuffer.isView(e)?"array":typeof e}let ar={vertex:`\
#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,fragment:`\
#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`},an=/void\s+main\s*\([^)]*\)\s*\{\n?/,aa=/}\n?[^{}]*$/,as=[],ao="__LUMA_INJECT_DECLARATIONS__";function al(e,t,i,r=!1){let n="vertex"===t;for(let t in i){let r=i[t];r.sort((e,t)=>e.order-t.order),as.length=r.length;for(let e=0,t=r.length;e<t;++e)as[e]=r[e].injection;let a=`${as.join("\n")}
`;switch(t){case"vs:#decl":n&&(e=e.replace(ao,a));break;case"vs:#main-start":n&&(e=e.replace(an,e=>e+a));break;case"vs:#main-end":n&&(e=e.replace(aa,e=>a+e));break;case"fs:#decl":n||(e=e.replace(ao,a));break;case"fs:#main-start":n||(e=e.replace(an,e=>e+a));break;case"fs:#main-end":n||(e=e.replace(aa,e=>a+e));break;default:e=e.replace(t,e=>e+a)}}return e=e.replace(ao,""),r&&(e=e.replace(/\}\s*$/,e=>e+ar[t])),e}function ac(e){e.map(e=>(function(e){var t;if(e.instance)return;ac(e.dependencies||[]);let{propTypes:i={},deprecations:r=[],inject:n={}}=e,a={normalizedInjections:function(e){let t={vertex:{},fragment:{}};for(let i in e){let r=e[i];"string"==typeof r&&(r={order:0,injection:r}),t[function(e){let t=e.slice(0,2);switch(t){case"vs":return"vertex";case"fs":return"fragment";default:throw Error(t)}}(i)][i]=r}return t}(n),parsedDeprecations:((t=r).forEach(e=>{"function"===e.type?e.regex=RegExp(`\\b${e.old}\\(`):e.regex=RegExp(`${e.type} ${e.old};`)}),t)};i&&(a.propValidators=function(e){let t={};for(let[i,r]of Object.entries(e))t[i]=function(e){let t=ai(e);if("object"!==t)return{value:e,...at[t],type:t};if("object"==typeof e)return e?void 0!==e.type?{...e,...at[e.type],type:e.type}:void 0===e.value?{type:"object",value:e}:(t=ai(e.value),{...e,...at[t],type:t}):{type:"object",value:null};throw Error("props")}(r);return t}(i)),e.instance=a;let s={};i&&(s=Object.entries(i).reduce((e,[t,i])=>{let r=i?.value;return r&&(e[t]=r),e},{})),e.defaultUniforms={...e.defaultUniforms,...s}})(e))}function au(e,t,i){e.deprecations?.forEach(e=>{e.regex?.test(t)&&(e.deprecated?i.deprecated(e.old,e.new)():i.removed(e.old,e.new)())})}function ah(e){ac(e);let t={},i={};!function e(t){let{modules:i,level:r,moduleMap:n,moduleDepth:a}=t;if(r>=5)throw Error("Possible loop in shader dependency graph");for(let e of i)n[e.name]=e,(void 0===a[e.name]||a[e.name]<r)&&(a[e.name]=r);for(let t of i)t.dependencies&&e({modules:t.dependencies,level:r+1,moduleMap:n,moduleDepth:a})}({modules:e,level:0,moduleMap:t,moduleDepth:i});let r=Object.keys(i).sort((e,t)=>i[t]-i[e]).map(e=>t[e]);return ac(r),r}let ad=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,"#version 300 es\n"],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],af=[...ad,[am("attribute"),"in $1"],[am("varying"),"out $1"]],ap=[...ad,[am("varying"),"in $1"]];function ag(e,t){for(let[i,r]of t)e=e.replace(i,r);return e}function am(e){return RegExp(`\\b${e}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function av(e,t){let i="";for(let r in e){let n=e[r];if(i+=`void ${n.signature} {
`,n.header&&(i+=`  ${n.header}`),t[r]){let e=t[r];for(let t of(e.sort((e,t)=>e.order-t.order),e))i+=`  ${t.injection}
`}n.footer&&(i+=`  ${n.footer}`),i+="}\n"}return i}function ay(e){let t={vertex:{},fragment:{}};for(let i of e){let e,r;"string"!=typeof i?r=(e=i).hook:(e={},r=i);let[n,a]=(r=r.trim()).split(":"),s=r.replace(/\(.+/,""),o=Object.assign(e,{signature:a});switch(n){case"vs":t.vertex[s]=o;break;case"fs":t.fragment[s]=o;break;default:throw Error(n)}}return t}let ab=`

${ao}
`,ax=`\
precision highp float;
`;function a_(e,t){let{source:i,stage:r,language:n="glsl",modules:a,defines:s={},hookFunctions:o=[],inject:l={},prologue:c=!0,log:u}=t;ae("string"==typeof i,"shader source must be a string");let h="glsl"===n?({name:function(e,t="unnamed"){let i=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(e);return i?i[1]:t}(i,void 0),language:"glsl",version:function(e){let t=100,i=e.match(/[^\s]+/g);if(i&&i.length>=2&&"#version"===i[0]){let e=parseInt(i[1],10);Number.isFinite(e)&&(t=e)}if(100!==t&&300!==t)throw Error(`Invalid GLSL version ${t}`);return t}(i)}).version:-1,d=e.shaderLanguageVersion,f=100===h?"#version 100":"#version 300 es",p=i.split("\n").slice(1).join("\n"),g={};a.forEach(e=>{Object.assign(g,e.defines)}),Object.assign(g,s);let v="";switch(n){case"wgsl":break;case"glsl":v=c?`\
${f}

// ----- PROLOGUE -------------------------
#define SHADER_TYPE_${r.toUpperCase()}

${function(e){switch(e?.gpu.toLowerCase()){case"apple":return`\
#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`\
#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`\
#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`\
#define AMD_GPU
`;default:return`\
#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}(e)}
${"fragment"===r?ax:""}

// ----- APPLICATION DEFINES -------------------------

${function(e={}){let t="";for(let i in e){let r=e[i];(r||Number.isFinite(r))&&(t+=`#define ${i.toUpperCase()} ${e[i]}
`)}return t}(g)}

`:`${f}
`}let y=ay(o),b={},x={},_={};for(let e in l){let t="string"==typeof l[e]?{injection:l[e],order:0}:l[e],i=/^(v|f)s:(#)?([\w-]+)$/.exec(e);if(i){let r=i[2],n=i[3];r?"decl"===n?x[e]=[t]:_[e]=[t]:b[e]=[t]}else _[e]=[t]}for(let e of a){u&&au(e,p,u),v+=ak(e,r);let t=e.instance?.normalizedInjections[r]||{};for(let e in t){let i=/^(v|f)s:#([\w-]+)$/.exec(e);if(i){let r="decl"===i[2]?x:_;r[e]=r[e]||[],r[e].push(t[e])}else b[e]=b[e]||[],b[e].push(t[e])}}return v+="// ----- MAIN SHADER SOURCE -------------------------",v+=ab,v=al(v,r,x)+av(y[r],b)+p,v=al(v,r,_),"glsl"===n&&h!==d&&(v=function(e,t){if(300!==Number(e.match(/^#version[ \t]+(\d+)/m)?.[1]||100))throw Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(t){case"vertex":return ag(e,af);case"fragment":return ag(e,ap);default:throw Error(t)}}(v,r)),v.trim()}function aw(e){return function(t){let i={};for(let r of e){let e=r.getUniforms?.(t,i);Object.assign(i,e)}return i}}function ak(e,t){let i;switch(t){case"vertex":i=e.vs||"";break;case"fragment":i=e.fs||"";break;case"wgsl":i=e.source||"";break;default:ae(!1)}if(!e.name)throw Error("Shader module must have a name");let r=e.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),n=`\
// ----- MODULE ${e.name} ---------------

`;return"wgsl"!==t&&(n+=`#define MODULE_${r}
`),n+=`${i}
`}let aE=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,aT=/^\s*\#\s*endif\s*$/;class aP{static defaultShaderAssembler;_hookFunctions=[];_defaultModules=[];static getDefaultShaderAssembler(){return aP.defaultShaderAssembler=aP.defaultShaderAssembler||new aP,aP.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(t=>t.name===("string"==typeof e?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){let t="string"==typeof e?e:e.name;this._defaultModules=this._defaultModules.filter(e=>e.name!==t)}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){var t;let i,r=this._getModuleList(e.modules),n=this._hookFunctions,{source:a,getUniforms:s}=(i=ah((t={...e,source:e.source,modules:r,hookFunctions:n}).modules||[]),{source:function(e,t){let{source:i,stage:r,modules:n,hookFunctions:a=[],inject:s={},log:o}=t;ae("string"==typeof i,"shader source must be a string");let l="",c=ay(a),u={},h={},d={};for(let e in s){let t="string"==typeof s[e]?{injection:s[e],order:0}:s[e],i=/^(v|f)s:(#)?([\w-]+)$/.exec(e);if(i){let r=i[2],n=i[3];r?"decl"===n?h[e]=[t]:d[e]=[t]:u[e]=[t]}else d[e]=[t]}for(let e of n){o&&au(e,i,o),l+=ak(e,"wgsl");let t=e.injections?.[r]||{};for(let e in t){let i=/^(v|f)s:#([\w-]+)$/.exec(e);if(i){let r="decl"===i[2]?h:d;r[e]=r[e]||[],r[e].push(t[e])}else u[e]=u[e]||[],u[e].push(t[e])}}return l+=ab,l=al(l,r,h)+av(c[r],u)+i,l=al(l,r,d)}(t.platformInfo,{...t,source:t.source,stage:"vertex",modules:i}),getUniforms:aw(i)});return{source:"wgsl"===e.platformInfo.shaderLanguage?function(e,t){let i=e.split("\n"),r=[],n=!0;for(let e of i){let t=e.match(aE),i=e.match(aT);t?(t[1],n=!1):i?n=!0:n&&r.push(e)}return r.join("\n")}(a):a,getUniforms:s,modules:r}}assembleGLSLShaderPair(e){let t=this._getModuleList(e.modules),i=this._hookFunctions;return{...function(e){let{vs:t,fs:i}=e,r=ah(e.modules||[]);return{vs:a_(e.platformInfo,{...e,source:t,stage:"vertex",modules:r}),fs:a_(e.platformInfo,{...e,source:i,stage:"fragment",modules:r}),getUniforms:aw(r)}}({...e,vs:e.vs,fs:e.fs,modules:t,hookFunctions:i}),modules:t}}_getModuleList(e=[]){let t=Array(this._defaultModules.length+e.length),i={},r=0;for(let e=0,n=this._defaultModules.length;e<n;++e){let n=this._defaultModules[e],a=n.name;t[r++]=n,i[a]=!0}for(let n=0,a=e.length;n<a;++n){let a=e[n],s=a.name;i[s]||(t[r++]=a,i[s]=!0)}return t.length=r,ac(t),t}}var aS=e.i(61849);let aM=`\
precision highp int;

// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  vec3 color;
};

struct PointLight {
  vec3 color;
  vec3 position;
  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform lightingUniforms {
  int enabled;
  int lightType;

  int directionalLightCount;
  int pointLightCount;

  vec3 ambientColor;

  vec3 lightColor0;
  vec3 lightPosition0;
  vec3 lightDirection0;
  vec3 lightAttenuation0;

  vec3 lightColor1;
  vec3 lightPosition1;
  vec3 lightDirection1;
  vec3 lightAttenuation1;

  vec3 lightColor2;
  vec3 lightPosition2;
  vec3 lightDirection2;
  vec3 lightAttenuation2;
} lighting;

PointLight lighting_getPointLight(int index) {
  switch (index) {
    case 0:
      return PointLight(lighting.lightColor0, lighting.lightPosition0, lighting.lightAttenuation0);
    case 1:
      return PointLight(lighting.lightColor1, lighting.lightPosition1, lighting.lightAttenuation1);
    case 2:
    default:  
      return PointLight(lighting.lightColor2, lighting.lightPosition2, lighting.lightAttenuation2);
  }
}

DirectionalLight lighting_getDirectionalLight(int index) {
  switch (index) {
    case 0:
      return DirectionalLight(lighting.lightColor0, lighting.lightDirection0);
    case 1:
      return DirectionalLight(lighting.lightColor1, lighting.lightDirection1);
    case 2:
    default:   
      return DirectionalLight(lighting.lightColor2, lighting.lightDirection2);
  }
} 

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

// #endif
`,aC=`\
// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  color: vec3<f32>,
};

struct PointLight {
  color: vec3<f32>,
  position: vec3<f32>,
  attenuation: vec3<f32>, // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  color: vec3<f32>,
  direction: vec3<f32>,
};

struct lightingUniforms {
  enabled: i32,
  pointLightCount: i32,
  directionalLightCount: i32,

  ambientColor: vec3<f32>,

  // TODO - support multiple lights by uncommenting arrays below
  lightType: i32,
  lightColor: vec3<f32>,
  lightDirection: vec3<f32>,
  lightPosition: vec3<f32>,
  lightAttenuation: vec3<f32>,

  // AmbientLight ambientLight;
  // PointLight pointLight[MAX_LIGHTS];
  // DirectionalLight directionalLight[MAX_LIGHTS];
};

// Binding 0:1 is reserved for lighting (Note: could go into separate bind group as it is stable across draw calls)
@binding(1) @group(0) var<uniform> lighting : lightingUniforms;

fn lighting_getPointLight(index: i32) -> PointLight {
  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);
}

fn lighting_getDirectionalLight(index: i32) -> DirectionalLight {
  return DirectionalLight(lighting.lightColor, lighting.lightDirection);
} 

fn getPointLightAttenuation(pointLight: PointLight, distance: f32) -> f32 {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}
`;(k5=El||(El={}))[k5.POINT=0]="POINT",k5[k5.DIRECTIONAL=1]="DIRECTIONAL";let aA={props:{},uniforms:{},name:"lighting",defines:{},uniformTypes:{enabled:"i32",lightType:"i32",directionalLightCount:"i32",pointLightCount:"i32",ambientColor:"vec3<f32>",lightColor0:"vec3<f32>",lightPosition0:"vec3<f32>",lightDirection0:"vec3<f32>",lightAttenuation0:"vec3<f32>",lightColor1:"vec3<f32>",lightPosition1:"vec3<f32>",lightDirection1:"vec3<f32>",lightAttenuation1:"vec3<f32>",lightColor2:"vec3<f32>",lightPosition2:"vec3<f32>",lightDirection2:"vec3<f32>",lightAttenuation2:"vec3<f32>"},defaultUniforms:{enabled:1,lightType:El.POINT,directionalLightCount:0,pointLightCount:0,ambientColor:[.1,.1,.1],lightColor0:[1,1,1],lightPosition0:[1,1,2],lightDirection0:[1,1,1],lightAttenuation0:[1,0,0],lightColor1:[1,1,1],lightPosition1:[1,1,2],lightDirection1:[1,1,1],lightAttenuation1:[1,0,0],lightColor2:[1,1,1],lightPosition2:[1,1,2],lightDirection2:[1,1,1],lightAttenuation2:[1,0,0]},source:aC,vs:aM,fs:aM,getUniforms:function(e,t={}){if(!(e=e?{...e}:e))return{...aA.defaultUniforms};e.lights&&(e={...e,...function(e){let t={pointLights:[],directionalLights:[]};for(let i of e||[])switch(i.type){case"ambient":t.ambientLight=i;break;case"directional":t.directionalLights?.push(i);break;case"point":t.pointLights?.push(i)}return t}(e.lights),lights:void 0});let{ambientLight:i,pointLights:r,directionalLights:n}=e||{};if(!(i||r&&r.length>0||n&&n.length>0))return{...aA.defaultUniforms,enabled:0};let a={...aA.defaultUniforms,...t,...function({ambientLight:e,pointLights:t=[],directionalLights:i=[]}){let r={};r.ambientColor=aI(e);let n=0;for(let e of t){r.lightType=El.POINT;let t=n;r[`lightColor${t}`]=aI(e),r[`lightPosition${t}`]=e.position,r[`lightAttenuation${t}`]=e.attenuation||[1,0,0],n++}for(let e of i){r.lightType=El.DIRECTIONAL;let t=n;r[`lightColor${t}`]=aI(e),r[`lightDirection${t}`]=e.direction,n++}return n>5&&aS.log.warn("MAX_LIGHTS exceeded")(),r.directionalLightCount=i.length,r.pointLightCount=t.length,r}({ambientLight:i,pointLights:r,directionalLights:n})};return void 0!==e.enabled&&(a.enabled=+!!e.enabled),a}};function aI(e={}){let{color:t=[0,0,0],intensity:i=1}=e;return t.map(e=>e*i/255)}let aL=`\
uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;
`,aD=`\
#define MAX_LIGHTS 3

uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
  vec3 halfway_direction = normalize(light_direction + view_direction);
  float lambertian = dot(light_direction, normal_worldspace);
  float specular = 0.0;
  if (lambertian > 0.0) {
    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  vec3 view_direction = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  for (int i = 0; i < lighting.pointLightCount; i++) {
    PointLight pointLight = lighting_getPointLight(i);
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    float light_attenuation = getPointLightAttenuation(pointLight, distance(light_position_worldspace, position_worldspace));
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color / light_attenuation);
  }

  int totalLights = min(MAX_LIGHTS, lighting.pointLightCount + lighting.directionalLightCount);
  for (int i = lighting.pointLightCount; i < totalLights; i++) {
    DirectionalLight directionalLight = lighting_getDirectionalLight(i);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
}
`,aO=`\
struct phongMaterialUniforms {
  ambient: f32,
  diffuse: f32,
  shininess: f32,
  specularColor: vec3<f32>,
};

@binding(2) @group(0) var<uniform> phongMaterial : phongMaterialUniforms;

fn lighting_getLightColor(surfaceColor: vec3<f32>, light_direction: vec3<f32>, view_direction: vec3<f32>, normal_worldspace: vec3<f32>, color: vec3<f32>) -> vec3<f32> {
  let halfway_direction: vec3<f32> = normalize(light_direction + view_direction);
  var lambertian: f32 = dot(light_direction, normal_worldspace);
  var specular: f32 = 0.0;
  if (lambertian > 0.0) {
    let specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, phongMaterial.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * phongMaterial.diffuse * surfaceColor + specular * phongMaterial.specularColor) * color;
}

fn lighting_getLightColor2(surfaceColor: vec3<f32>, cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32> {
  var lightColor: vec3<f32> = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  let view_direction: vec3<f32> = normalize(cameraPosition - position_worldspace);
  lightColor = phongMaterial.ambient * surfaceColor * lighting.ambientColor;

  if (lighting.lightType == 0) {
    let pointLight: PointLight  = lighting_getPointLight(0);
    let light_position_worldspace: vec3<f32> = pointLight.position;
    let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  } else if (lighting.lightType == 1) {
    var directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
  /*
  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.pointLightCount) {
      break;
    }
    PointLight pointLight = lighting.pointLight[i];
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  }

  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.directionalLightCount) {
      break;
    }
    DirectionalLight directionalLight = lighting.directionalLight[i];
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  */
}

fn lighting_getSpecularLightColor(cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32>{
  var lightColor = vec3<f32>(0, 0, 0);
  let surfaceColor = vec3<f32>(0, 0, 0);

  if (lighting.enabled == 0) {
    let view_direction = normalize(cameraPosition - position_worldspace);

    switch (lighting.lightType) {
      case 0, default: {
        let pointLight: PointLight = lighting_getPointLight(0);
        let light_position_worldspace: vec3<f32> = pointLight.position;
        let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
      }
      case 1: {
        let directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
      }
    }
  }
  return lightColor;
}
`,aR={props:{},name:"gouraudMaterial",vs:aD.replace("phongMaterial","gouraudMaterial"),fs:aL.replace("phongMaterial","gouraudMaterial"),source:aO.replaceAll("phongMaterial","gouraudMaterial"),defines:{LIGHTING_VERTEX:!0},dependencies:[aA],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(e){let t={...e};return t.specularColor&&(t.specularColor=t.specularColor.map(e=>e/255)),{...aR.defaultUniforms,...t}}},aN={name:"phongMaterial",dependencies:[aA],source:aO,vs:aL,fs:aD,defines:{LIGHTING_FRAGMENT:!0},uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(e){let t={...e};return t.specularColor&&(t.specularColor=t.specularColor.map(e=>e/255)),{...aN.defaultUniforms,...t}}},aj=`\
uniform layerUniforms {
  uniform float opacity;
} layer;
`,aB={name:"layer",vs:aj,fs:aj,getUniforms:e=>({opacity:Math.pow(e.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}},aF={name:"color",dependencies:[],source:`

struct ColorUniforms {
  opacity: f32,
};

var<private> color: ColorUniforms = ColorUniforms(1.0);
// TODO (kaapp) avoiding binding index collisions to handle layer opacity 
// requires some thought.
// @group(0) @binding(0) var<uniform> color: ColorUniforms;

@must_use
fn deckgl_premultiplied_alpha(fragColor: vec4<f32>) -> vec4<f32> {
    return vec4(fragColor.rgb * fragColor.a, fragColor.a); 
};
`,getUniforms:e=>({}),uniformTypes:{opacity:"f32"}},az="#define SMOOTH_EDGE_RADIUS 0.5",aV={name:"geometry",source:`\
const SMOOTH_EDGE_RADIUS: f32 = 0.5;

struct VertexGeometry {
  position: vec4<f32>,
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

var<private> geometry_: VertexGeometry = VertexGeometry(
  vec4<f32>(0.0, 0.0, 1.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0),
  vec2<f32>(0.0, 0.0),
  vec3<f32>(0.0, 0.0, 0.0)
);

struct FragmentGeometry {
  uv: vec2<f32>,
};

var<private> fragmentGeometry: FragmentGeometry;

fn smoothedge(edge: f32, x: f32) -> f32 {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`,vs:`\
${az}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,fs:`\
${az}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`},aU=`\
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`,a$="undefined"!=typeof Float32Array?Float32Array:Array,aW=Math.random;function aH(e){return e>=0?Math.round(e):e%.5==0?Math.floor(e):Math.round(e)}function aq(){let e=new a$(16);return a$!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function aG(e){let t=new a$(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function aY(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function aX(e,t,i,r,n,a,s,o,l,c,u,h,d,f,p,g){let v=new a$(16);return v[0]=e,v[1]=t,v[2]=i,v[3]=r,v[4]=n,v[5]=a,v[6]=s,v[7]=o,v[8]=l,v[9]=c,v[10]=u,v[11]=h,v[12]=d,v[13]=f,v[14]=p,v[15]=g,v}function aK(e,t,i,r,n,a,s,o,l,c,u,h,d,f,p,g,v){return e[0]=t,e[1]=i,e[2]=r,e[3]=n,e[4]=a,e[5]=s,e[6]=o,e[7]=l,e[8]=c,e[9]=u,e[10]=h,e[11]=d,e[12]=f,e[13]=p,e[14]=g,e[15]=v,e}function aZ(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function aJ(e,t){if(e===t){let i=t[1],r=t[2],n=t[3],a=t[6],s=t[7],o=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=i,e[6]=t[9],e[7]=t[13],e[8]=r,e[9]=a,e[11]=t[14],e[12]=n,e[13]=s,e[14]=o}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function aQ(e,t){let i=t[0],r=t[1],n=t[2],a=t[3],s=t[4],o=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],f=t[11],p=t[12],g=t[13],v=t[14],y=t[15],b=i*o-r*s,x=i*l-n*s,_=i*c-a*s,w=r*l-n*o,k=r*c-a*o,E=n*c-a*l,T=u*g-h*p,P=u*v-d*p,S=u*y-f*p,M=h*v-d*g,C=h*y-f*g,A=d*y-f*v,I=b*A-x*C+_*M+w*S-k*P+E*T;return I?(I=1/I,e[0]=(o*A-l*C+c*M)*I,e[1]=(n*C-r*A-a*M)*I,e[2]=(g*E-v*k+y*w)*I,e[3]=(d*k-h*E-f*w)*I,e[4]=(l*S-s*A-c*P)*I,e[5]=(i*A-n*S+a*P)*I,e[6]=(v*_-p*E-y*x)*I,e[7]=(u*E-d*_+f*x)*I,e[8]=(s*C-o*S+c*T)*I,e[9]=(r*S-i*C-a*T)*I,e[10]=(p*k-g*_+y*b)*I,e[11]=(h*_-u*k-f*b)*I,e[12]=(o*P-s*M-l*T)*I,e[13]=(i*M-r*P+n*T)*I,e[14]=(g*x-p*w-v*b)*I,e[15]=(u*w-h*x+d*b)*I,e):null}function a0(e,t){let i=t[0],r=t[1],n=t[2],a=t[3],s=t[4],o=t[5],l=t[6],c=t[7],u=t[8],h=t[9],d=t[10],f=t[11],p=t[12],g=t[13],v=t[14],y=t[15],b=i*o-r*s,x=i*l-n*s,_=i*c-a*s,w=r*l-n*o,k=r*c-a*o,E=n*c-a*l,T=u*g-h*p,P=u*v-d*p,S=u*y-f*p,M=h*v-d*g,C=h*y-f*g,A=d*y-f*v;return e[0]=o*A-l*C+c*M,e[1]=n*C-r*A-a*M,e[2]=g*E-v*k+y*w,e[3]=d*k-h*E-f*w,e[4]=l*S-s*A-c*P,e[5]=i*A-n*S+a*P,e[6]=v*_-p*E-y*x,e[7]=u*E-d*_+f*x,e[8]=s*C-o*S+c*T,e[9]=r*S-i*C-a*T,e[10]=p*k-g*_+y*b,e[11]=h*_-u*k-f*b,e[12]=o*P-s*M-l*T,e[13]=i*M-r*P+n*T,e[14]=g*x-p*w-v*b,e[15]=u*w-h*x+d*b,e}function a1(e){let t=e[0],i=e[1],r=e[2],n=e[3],a=e[4],s=e[5],o=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11],f=e[12],p=e[13],g=e[14],v=e[15],y=t*s-i*a,b=t*o-r*a,x=i*o-r*s,_=c*p-u*f,w=c*g-h*f,k=u*g-h*p;return l*(t*k-i*w+r*_)-n*(a*k-s*w+o*_)+v*(c*x-u*b+h*y)-d*(f*x-p*b+g*y)}function a2(e,t,i){let r=t[0],n=t[1],a=t[2],s=t[3],o=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],f=t[10],p=t[11],g=t[12],v=t[13],y=t[14],b=t[15],x=i[0],_=i[1],w=i[2],k=i[3];return e[0]=x*r+_*o+w*h+k*g,e[1]=x*n+_*l+w*d+k*v,e[2]=x*a+_*c+w*f+k*y,e[3]=x*s+_*u+w*p+k*b,x=i[4],_=i[5],w=i[6],k=i[7],e[4]=x*r+_*o+w*h+k*g,e[5]=x*n+_*l+w*d+k*v,e[6]=x*a+_*c+w*f+k*y,e[7]=x*s+_*u+w*p+k*b,x=i[8],_=i[9],w=i[10],k=i[11],e[8]=x*r+_*o+w*h+k*g,e[9]=x*n+_*l+w*d+k*v,e[10]=x*a+_*c+w*f+k*y,e[11]=x*s+_*u+w*p+k*b,x=i[12],_=i[13],w=i[14],k=i[15],e[12]=x*r+_*o+w*h+k*g,e[13]=x*n+_*l+w*d+k*v,e[14]=x*a+_*c+w*f+k*y,e[15]=x*s+_*u+w*p+k*b,e}function a3(e,t,i){let r,n,a,s,o,l,c,u,h,d,f,p,g=i[0],v=i[1],y=i[2];return t===e?(e[12]=t[0]*g+t[4]*v+t[8]*y+t[12],e[13]=t[1]*g+t[5]*v+t[9]*y+t[13],e[14]=t[2]*g+t[6]*v+t[10]*y+t[14],e[15]=t[3]*g+t[7]*v+t[11]*y+t[15]):(r=t[0],n=t[1],a=t[2],s=t[3],o=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=t[9],f=t[10],p=t[11],e[0]=r,e[1]=n,e[2]=a,e[3]=s,e[4]=o,e[5]=l,e[6]=c,e[7]=u,e[8]=h,e[9]=d,e[10]=f,e[11]=p,e[12]=r*g+o*v+h*y+t[12],e[13]=n*g+l*v+d*y+t[13],e[14]=a*g+c*v+f*y+t[14],e[15]=s*g+u*v+p*y+t[15]),e}function a4(e,t,i){let r=i[0],n=i[1],a=i[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*n,e[5]=t[5]*n,e[6]=t[6]*n,e[7]=t[7]*n,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function a5(e,t,i,r){let n,a,s,o,l,c,u,h,d,f,p,g,v,y,b,x,_,w,k,E,T,P,S,M,C=r[0],A=r[1],I=r[2],L=Math.sqrt(C*C+A*A+I*I);return L<1e-6?null:(C*=L=1/L,A*=L,I*=L,a=Math.sin(i),s=1-(n=Math.cos(i)),o=t[0],l=t[1],c=t[2],u=t[3],h=t[4],d=t[5],f=t[6],p=t[7],g=t[8],v=t[9],y=t[10],b=t[11],x=C*C*s+n,_=A*C*s+I*a,w=I*C*s-A*a,k=C*A*s-I*a,E=A*A*s+n,T=I*A*s+C*a,P=C*I*s+A*a,S=A*I*s-C*a,M=I*I*s+n,e[0]=o*x+h*_+g*w,e[1]=l*x+d*_+v*w,e[2]=c*x+f*_+y*w,e[3]=u*x+p*_+b*w,e[4]=o*k+h*E+g*T,e[5]=l*k+d*E+v*T,e[6]=c*k+f*E+y*T,e[7]=u*k+p*E+b*T,e[8]=o*P+h*S+g*M,e[9]=l*P+d*S+v*M,e[10]=c*P+f*S+y*M,e[11]=u*P+p*S+b*M,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function a6(e,t,i){let r=Math.sin(i),n=Math.cos(i),a=t[4],s=t[5],o=t[6],l=t[7],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*n+c*r,e[5]=s*n+u*r,e[6]=o*n+h*r,e[7]=l*n+d*r,e[8]=c*n-a*r,e[9]=u*n-s*r,e[10]=h*n-o*r,e[11]=d*n-l*r,e}function a8(e,t,i){let r=Math.sin(i),n=Math.cos(i),a=t[0],s=t[1],o=t[2],l=t[3],c=t[8],u=t[9],h=t[10],d=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*n-c*r,e[1]=s*n-u*r,e[2]=o*n-h*r,e[3]=l*n-d*r,e[8]=a*r+c*n,e[9]=s*r+u*n,e[10]=o*r+h*n,e[11]=l*r+d*n,e}function a9(e,t,i){let r=Math.sin(i),n=Math.cos(i),a=t[0],s=t[1],o=t[2],l=t[3],c=t[4],u=t[5],h=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*n+c*r,e[1]=s*n+u*r,e[2]=o*n+h*r,e[3]=l*n+d*r,e[4]=c*n-a*r,e[5]=u*n-s*r,e[6]=h*n-o*r,e[7]=d*n-l*r,e}function a7(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function se(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function st(e,t,i){let r,n,a,s=i[0],o=i[1],l=i[2],c=Math.sqrt(s*s+o*o+l*l);return c<1e-6?null:(s*=c=1/c,o*=c,l*=c,n=Math.sin(t),a=1-(r=Math.cos(t)),e[0]=s*s*a+r,e[1]=o*s*a+l*n,e[2]=l*s*a-o*n,e[3]=0,e[4]=s*o*a-l*n,e[5]=o*o*a+r,e[6]=l*o*a+s*n,e[7]=0,e[8]=s*l*a+o*n,e[9]=o*l*a-s*n,e[10]=l*l*a+r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function si(e,t){let i=Math.sin(t),r=Math.cos(t);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r,e[6]=i,e[7]=0,e[8]=0,e[9]=-i,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function sr(e,t){let i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=0,e[2]=-i,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=i,e[9]=0,e[10]=r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function sn(e,t){let i=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=i,e[2]=0,e[3]=0,e[4]=-i,e[5]=r,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function sa(e,t,i){let r=t[0],n=t[1],a=t[2],s=t[3],o=r+r,l=n+n,c=a+a,u=r*o,h=r*l,d=r*c,f=n*l,p=n*c,g=a*c,v=s*o,y=s*l,b=s*c;return e[0]=1-(f+g),e[1]=h+b,e[2]=d-y,e[3]=0,e[4]=h-b,e[5]=1-(u+g),e[6]=p+v,e[7]=0,e[8]=d+y,e[9]=p-v,e[10]=1-(u+f),e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function ss(e,t){let i=new a$(3),r=-t[0],n=-t[1],a=-t[2],s=t[3],o=t[4],l=t[5],c=t[6],u=t[7],h=r*r+n*n+a*a+s*s;return h>0?(i[0]=(o*s+u*r+l*a-c*n)*2/h,i[1]=(l*s+u*n+c*r-o*a)*2/h,i[2]=(c*s+u*a+o*n-l*r)*2/h):(i[0]=(o*s+u*r+l*a-c*n)*2,i[1]=(l*s+u*n+c*r-o*a)*2,i[2]=(c*s+u*a+o*n-l*r)*2),sa(e,t,i),e}function so(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}function sl(e,t){let i=t[0],r=t[1],n=t[2],a=t[4],s=t[5],o=t[6],l=t[8],c=t[9],u=t[10];return e[0]=Math.sqrt(i*i+r*r+n*n),e[1]=Math.sqrt(a*a+s*s+o*o),e[2]=Math.sqrt(l*l+c*c+u*u),e}function sc(e,t){let i=new a$(3);sl(i,t);let r=1/i[0],n=1/i[1],a=1/i[2],s=t[0]*r,o=t[1]*n,l=t[2]*a,c=t[4]*r,u=t[5]*n,h=t[6]*a,d=t[8]*r,f=t[9]*n,p=t[10]*a,g=s+u+p,v=0;return g>0?(v=2*Math.sqrt(g+1),e[3]=.25*v,e[0]=(h-f)/v,e[1]=(d-l)/v,e[2]=(o-c)/v):s>u&&s>p?(v=2*Math.sqrt(1+s-u-p),e[3]=(h-f)/v,e[0]=.25*v,e[1]=(o+c)/v,e[2]=(d+l)/v):u>p?(v=2*Math.sqrt(1+u-s-p),e[3]=(d-l)/v,e[0]=(o+c)/v,e[1]=.25*v,e[2]=(h+f)/v):(v=2*Math.sqrt(1+p-s-u),e[3]=(o-c)/v,e[0]=(d+l)/v,e[1]=(h+f)/v,e[2]=.25*v),e}function su(e,t,i,r){t[0]=r[12],t[1]=r[13],t[2]=r[14];let n=r[0],a=r[1],s=r[2],o=r[4],l=r[5],c=r[6],u=r[8],h=r[9],d=r[10];i[0]=Math.sqrt(n*n+a*a+s*s),i[1]=Math.sqrt(o*o+l*l+c*c),i[2]=Math.sqrt(u*u+h*h+d*d);let f=1/i[0],p=1/i[1],g=1/i[2],v=n*f,y=a*p,b=s*g,x=o*f,_=l*p,w=c*g,k=u*f,E=h*p,T=d*g,P=v+_+T,S=0;return P>0?(S=2*Math.sqrt(P+1),e[3]=.25*S,e[0]=(w-E)/S,e[1]=(k-b)/S,e[2]=(y-x)/S):v>_&&v>T?(S=2*Math.sqrt(1+v-_-T),e[3]=(w-E)/S,e[0]=.25*S,e[1]=(y+x)/S,e[2]=(k+b)/S):_>T?(S=2*Math.sqrt(1+_-v-T),e[3]=(k-b)/S,e[0]=(y+x)/S,e[1]=.25*S,e[2]=(w+E)/S):(S=2*Math.sqrt(1+T-v-_),e[3]=(y-x)/S,e[0]=(k+b)/S,e[1]=(w+E)/S,e[2]=.25*S),e}function sh(e,t,i,r){let n=t[0],a=t[1],s=t[2],o=t[3],l=n+n,c=a+a,u=s+s,h=n*l,d=n*c,f=n*u,p=a*c,g=a*u,v=s*u,y=o*l,b=o*c,x=o*u,_=r[0],w=r[1],k=r[2];return e[0]=(1-(p+v))*_,e[1]=(d+x)*_,e[2]=(f-b)*_,e[3]=0,e[4]=(d-x)*w,e[5]=(1-(h+v))*w,e[6]=(g+y)*w,e[7]=0,e[8]=(f+b)*k,e[9]=(g-y)*k,e[10]=(1-(h+p))*k,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function sd(e,t,i,r,n){let a=t[0],s=t[1],o=t[2],l=t[3],c=a+a,u=s+s,h=o+o,d=a*c,f=a*u,p=a*h,g=s*u,v=s*h,y=o*h,b=l*c,x=l*u,_=l*h,w=r[0],k=r[1],E=r[2],T=n[0],P=n[1],S=n[2],M=(1-(g+y))*w,C=(f+_)*w,A=(p-x)*w,I=(f-_)*k,L=(1-(d+y))*k,D=(v+b)*k,O=(p+x)*E,R=(v-b)*E,N=(1-(d+g))*E;return e[0]=M,e[1]=C,e[2]=A,e[3]=0,e[4]=I,e[5]=L,e[6]=D,e[7]=0,e[8]=O,e[9]=R,e[10]=N,e[11]=0,e[12]=i[0]+T-(M*T+I*P+O*S),e[13]=i[1]+P-(C*T+L*P+R*S),e[14]=i[2]+S-(A*T+D*P+N*S),e[15]=1,e}function sf(e,t){let i=t[0],r=t[1],n=t[2],a=t[3],s=i+i,o=r+r,l=n+n,c=i*s,u=r*s,h=r*o,d=n*s,f=n*o,p=n*l,g=a*s,v=a*o,y=a*l;return e[0]=1-h-p,e[1]=u+y,e[2]=d-v,e[3]=0,e[4]=u-y,e[5]=1-c-p,e[6]=f+g,e[7]=0,e[8]=d+v,e[9]=f-g,e[10]=1-c-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function sp(e,t,i,r,n,a,s){let o=1/(i-t),l=1/(n-r),c=1/(a-s);return e[0]=2*a*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*a*l,e[6]=0,e[7]=0,e[8]=(i+t)*o,e[9]=(n+r)*l,e[10]=(s+a)*c,e[11]=-1,e[12]=0,e[13]=0,e[14]=s*a*2*c,e[15]=0,e}function sg(e,t,i,r,n){let a=1/Math.tan(t/2);if(e[0]=a/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=n&&n!==1/0){let t=1/(r-n);e[10]=(n+r)*t,e[14]=2*n*r*t}else e[10]=-1,e[14]=-2*r;return e}function sm(e,t,i,r,n){let a=1/Math.tan(t/2);if(e[0]=a/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=n&&n!==1/0){let t=1/(r-n);e[10]=n*t,e[14]=n*r*t}else e[10]=-1,e[14]=-r;return e}function sv(e,t,i,r){let n=Math.tan(t.upDegrees*Math.PI/180),a=Math.tan(t.downDegrees*Math.PI/180),s=Math.tan(t.leftDegrees*Math.PI/180),o=Math.tan(t.rightDegrees*Math.PI/180),l=2/(s+o),c=2/(n+a);return e[0]=l,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=-((s-o)*l*.5),e[9]=(n-a)*c*.5,e[10]=r/(i-r),e[11]=-1,e[12]=0,e[13]=0,e[14]=r*i/(i-r),e[15]=0,e}function sy(e,t,i,r,n,a,s){let o=1/(t-i),l=1/(r-n),c=1/(a-s);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+i)*o,e[13]=(n+r)*l,e[14]=(s+a)*c,e[15]=1,e}function sb(e,t,i,r,n,a,s){let o=1/(t-i),l=1/(r-n),c=1/(a-s);return e[0]=-2*o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=c,e[11]=0,e[12]=(t+i)*o,e[13]=(n+r)*l,e[14]=a*c,e[15]=1,e}function sx(e,t,i,r){let n,a,s,o,l,c,u,h,d,f,p=t[0],g=t[1],v=t[2],y=r[0],b=r[1],x=r[2],_=i[0],w=i[1],k=i[2];return 1e-6>Math.abs(p-_)&&1e-6>Math.abs(g-w)&&1e-6>Math.abs(v-k)?aZ(e):(n=1/Math.sqrt((h=p-_)*h+(d=g-w)*d+(f=v-k)*f),h*=n,d*=n,f*=n,(n=Math.sqrt((a=b*f-x*d)*a+(s=x*h-y*f)*s+(o=y*d-b*h)*o))?(a*=n=1/n,s*=n,o*=n):(a=0,s=0,o=0),(n=Math.sqrt((l=d*o-f*s)*l+(c=f*a-h*o)*c+(u=h*s-d*a)*u))?(l*=n=1/n,c*=n,u*=n):(l=0,c=0,u=0),e[0]=a,e[1]=l,e[2]=h,e[3]=0,e[4]=s,e[5]=c,e[6]=d,e[7]=0,e[8]=o,e[9]=u,e[10]=f,e[11]=0,e[12]=-(a*p+s*g+o*v),e[13]=-(l*p+c*g+u*v),e[14]=-(h*p+d*g+f*v),e[15]=1,e)}function s_(e,t,i,r){let n=t[0],a=t[1],s=t[2],o=r[0],l=r[1],c=r[2],u=n-i[0],h=a-i[1],d=s-i[2],f=u*u+h*h+d*d;f>0&&(u*=f=1/Math.sqrt(f),h*=f,d*=f);let p=l*d-c*h,g=c*u-o*d,v=o*h-l*u;return(f=p*p+g*g+v*v)>0&&(p*=f=1/Math.sqrt(f),g*=f,v*=f),e[0]=p,e[1]=g,e[2]=v,e[3]=0,e[4]=h*v-d*g,e[5]=d*p-u*v,e[6]=u*g-h*p,e[7]=0,e[8]=u,e[9]=h,e[10]=d,e[11]=0,e[12]=n,e[13]=a,e[14]=s,e[15]=1,e}function sw(e){return`mat4(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]}, ${e[4]}, ${e[5]}, ${e[6]}, ${e[7]}, ${e[8]}, ${e[9]}, ${e[10]}, ${e[11]}, ${e[12]}, ${e[13]}, ${e[14]}, ${e[15]})`}function sk(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]+e[3]*e[3]+e[4]*e[4]+e[5]*e[5]+e[6]*e[6]+e[7]*e[7]+e[8]*e[8]+e[9]*e[9]+e[10]*e[10]+e[11]*e[11]+e[12]*e[12]+e[13]*e[13]+e[14]*e[14]+e[15]*e[15])}function sE(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e[4]=t[4]+i[4],e[5]=t[5]+i[5],e[6]=t[6]+i[6],e[7]=t[7]+i[7],e[8]=t[8]+i[8],e[9]=t[9]+i[9],e[10]=t[10]+i[10],e[11]=t[11]+i[11],e[12]=t[12]+i[12],e[13]=t[13]+i[13],e[14]=t[14]+i[14],e[15]=t[15]+i[15],e}function sT(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e[4]=t[4]-i[4],e[5]=t[5]-i[5],e[6]=t[6]-i[6],e[7]=t[7]-i[7],e[8]=t[8]-i[8],e[9]=t[9]-i[9],e[10]=t[10]-i[10],e[11]=t[11]-i[11],e[12]=t[12]-i[12],e[13]=t[13]-i[13],e[14]=t[14]-i[14],e[15]=t[15]-i[15],e}function sP(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*i,e[9]=t[9]*i,e[10]=t[10]*i,e[11]=t[11]*i,e[12]=t[12]*i,e[13]=t[13]*i,e[14]=t[14]*i,e[15]=t[15]*i,e}function sS(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e[4]=t[4]+i[4]*r,e[5]=t[5]+i[5]*r,e[6]=t[6]+i[6]*r,e[7]=t[7]+i[7]*r,e[8]=t[8]+i[8]*r,e[9]=t[9]+i[9]*r,e[10]=t[10]+i[10]*r,e[11]=t[11]+i[11]*r,e[12]=t[12]+i[12]*r,e[13]=t[13]+i[13]*r,e[14]=t[14]+i[14]*r,e[15]=t[15]+i[15]*r,e}function sM(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]&&e[4]===t[4]&&e[5]===t[5]&&e[6]===t[6]&&e[7]===t[7]&&e[8]===t[8]&&e[9]===t[9]&&e[10]===t[10]&&e[11]===t[11]&&e[12]===t[12]&&e[13]===t[13]&&e[14]===t[14]&&e[15]===t[15]}function sC(e,t){let i=e[0],r=e[1],n=e[2],a=e[3],s=e[4],o=e[5],l=e[6],c=e[7],u=e[8],h=e[9],d=e[10],f=e[11],p=e[12],g=e[13],v=e[14],y=e[15],b=t[0],x=t[1],_=t[2],w=t[3],k=t[4],E=t[5],T=t[6],P=t[7],S=t[8],M=t[9],C=t[10],A=t[11],I=t[12],L=t[13],D=t[14],O=t[15];return Math.abs(i-b)<=1e-6*Math.max(1,Math.abs(i),Math.abs(b))&&Math.abs(r-x)<=1e-6*Math.max(1,Math.abs(r),Math.abs(x))&&Math.abs(n-_)<=1e-6*Math.max(1,Math.abs(n),Math.abs(_))&&Math.abs(a-w)<=1e-6*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(s-k)<=1e-6*Math.max(1,Math.abs(s),Math.abs(k))&&Math.abs(o-E)<=1e-6*Math.max(1,Math.abs(o),Math.abs(E))&&Math.abs(l-T)<=1e-6*Math.max(1,Math.abs(l),Math.abs(T))&&Math.abs(c-P)<=1e-6*Math.max(1,Math.abs(c),Math.abs(P))&&Math.abs(u-S)<=1e-6*Math.max(1,Math.abs(u),Math.abs(S))&&Math.abs(h-M)<=1e-6*Math.max(1,Math.abs(h),Math.abs(M))&&Math.abs(d-C)<=1e-6*Math.max(1,Math.abs(d),Math.abs(C))&&Math.abs(f-A)<=1e-6*Math.max(1,Math.abs(f),Math.abs(A))&&Math.abs(p-I)<=1e-6*Math.max(1,Math.abs(p),Math.abs(I))&&Math.abs(g-L)<=1e-6*Math.max(1,Math.abs(g),Math.abs(L))&&Math.abs(v-D)<=1e-6*Math.max(1,Math.abs(v),Math.abs(D))&&Math.abs(y-O)<=1e-6*Math.max(1,Math.abs(y),Math.abs(O))}e.s(["add",()=>sE,"adjoint",()=>a0,"clone",()=>aG,"copy",()=>aY,"create",()=>aq,"decompose",()=>su,"determinant",()=>a1,"equals",()=>sC,"exactEquals",()=>sM,"frob",()=>sk,"fromQuat",()=>sf,"fromQuat2",()=>ss,"fromRotation",()=>st,"fromRotationTranslation",()=>sa,"fromRotationTranslationScale",()=>sh,"fromRotationTranslationScaleOrigin",()=>sd,"fromScaling",()=>se,"fromTranslation",()=>a7,"fromValues",()=>aX,"fromXRotation",()=>si,"fromYRotation",()=>sr,"fromZRotation",()=>sn,"frustum",()=>sp,"getRotation",()=>sc,"getScaling",()=>sl,"getTranslation",()=>so,"identity",()=>aZ,"invert",()=>aQ,"lookAt",()=>sx,"mul",0,a2,"multiply",()=>a2,"multiplyScalar",()=>sP,"multiplyScalarAndAdd",()=>sS,"ortho",0,sy,"orthoNO",()=>sy,"orthoZO",()=>sb,"perspective",0,sg,"perspectiveFromFieldOfView",()=>sv,"perspectiveNO",()=>sg,"perspectiveZO",()=>sm,"rotate",()=>a5,"rotateX",()=>a6,"rotateY",()=>a8,"rotateZ",()=>a9,"scale",()=>a4,"set",()=>aK,"str",()=>sw,"sub",0,sT,"subtract",()=>sT,"targetTo",()=>s_,"translate",()=>a3,"transpose",()=>aJ],97062);var sA=e.i(97062),sA=sA;function sI(){let e=new a$(4);return a$!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function sL(e){let t=new a$(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function sD(e,t,i,r){let n=new a$(4);return n[0]=e,n[1]=t,n[2]=i,n[3]=r,n}function sO(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function sR(e,t,i,r,n){return e[0]=t,e[1]=i,e[2]=r,e[3]=n,e}function sN(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e[3]=t[3]+i[3],e}function sj(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e[3]=t[3]-i[3],e}function sB(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e[3]=t[3]*i[3],e}function sF(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e[3]=t[3]/i[3],e}function sz(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e[3]=Math.ceil(t[3]),e}function sV(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e[3]=Math.floor(t[3]),e}function sU(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e[3]=Math.min(t[3],i[3]),e}function s$(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e[3]=Math.max(t[3],i[3]),e}function sW(e,t){return e[0]=aH(t[0]),e[1]=aH(t[1]),e[2]=aH(t[2]),e[3]=aH(t[3]),e}function sH(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e}function sq(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e[3]=t[3]+i[3]*r,e}function sG(e,t){let i=t[0]-e[0],r=t[1]-e[1],n=t[2]-e[2],a=t[3]-e[3];return Math.sqrt(i*i+r*r+n*n+a*a)}function sY(e,t){let i=t[0]-e[0],r=t[1]-e[1],n=t[2]-e[2],a=t[3]-e[3];return i*i+r*r+n*n+a*a}function sX(e){let t=e[0],i=e[1],r=e[2],n=e[3];return Math.sqrt(t*t+i*i+r*r+n*n)}function sK(e){let t=e[0],i=e[1],r=e[2],n=e[3];return t*t+i*i+r*r+n*n}function sZ(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=-t[3],e}function sJ(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e[3]=1/t[3],e}function sQ(e,t){let i=t[0],r=t[1],n=t[2],a=t[3],s=i*i+r*r+n*n+a*a;return s>0&&(s=1/Math.sqrt(s)),e[0]=i*s,e[1]=r*s,e[2]=n*s,e[3]=a*s,e}function s0(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function s1(e,t,i,r){let n=i[0]*r[1]-i[1]*r[0],a=i[0]*r[2]-i[2]*r[0],s=i[0]*r[3]-i[3]*r[0],o=i[1]*r[2]-i[2]*r[1],l=i[1]*r[3]-i[3]*r[1],c=i[2]*r[3]-i[3]*r[2],u=t[0],h=t[1],d=t[2],f=t[3];return e[0]=h*c-d*l+f*o,e[1]=-(u*c)+d*s-f*a,e[2]=u*l-h*s+f*n,e[3]=-(u*o)+h*a-d*n,e}function s2(e,t,i,r){let n=t[0],a=t[1],s=t[2],o=t[3];return e[0]=n+r*(i[0]-n),e[1]=a+r*(i[1]-a),e[2]=s+r*(i[2]-s),e[3]=o+r*(i[3]-o),e}function s3(e,t){let i,r,n,a,s,o;t=void 0===t?1:t;do s=(i=2*aW()-1)*i+(r=2*aW()-1)*r;while(s>=1)do o=(n=2*aW()-1)*n+(a=2*aW()-1)*a;while(o>=1)let l=Math.sqrt((1-s)/o);return e[0]=t*i,e[1]=t*r,e[2]=t*n*l,e[3]=t*a*l,e}function s4(e,t,i){let r=t[0],n=t[1],a=t[2],s=t[3];return e[0]=i[0]*r+i[4]*n+i[8]*a+i[12]*s,e[1]=i[1]*r+i[5]*n+i[9]*a+i[13]*s,e[2]=i[2]*r+i[6]*n+i[10]*a+i[14]*s,e[3]=i[3]*r+i[7]*n+i[11]*a+i[15]*s,e}function s5(e,t,i){let r=t[0],n=t[1],a=t[2],s=i[0],o=i[1],l=i[2],c=i[3],u=c*r+o*a-l*n,h=c*n+l*r-s*a,d=c*a+s*n-o*r,f=-s*r-o*n-l*a;return e[0]=u*c+-(f*s)+-(h*l)- -(d*o),e[1]=h*c+-(f*o)+-(d*s)- -(u*l),e[2]=d*c+-(f*l)+-(u*o)- -(h*s),e[3]=t[3],e}function s6(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function s8(e){return`vec4(${e[0]}, ${e[1]}, ${e[2]}, ${e[3]})`}function s9(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}function s7(e,t){let i=e[0],r=e[1],n=e[2],a=e[3],s=t[0],o=t[1],l=t[2],c=t[3];return Math.abs(i-s)<=1e-6*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(r-o)<=1e-6*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(n-l)<=1e-6*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(a-c)<=1e-6*Math.max(1,Math.abs(a),Math.abs(c))}let oe=(o=sI(),function(e,t,i,r,n,a){let s,l;for(t||(t=4),i||(i=0),l=r?Math.min(r*t+i,e.length):e.length,s=i;s<l;s+=t)o[0]=e[s],o[1]=e[s+1],o[2]=e[s+2],o[3]=e[s+3],n(o,o,a),e[s]=o[0],e[s+1]=o[1],e[s+2]=o[2],e[s+3]=o[3];return e});e.s(["add",()=>sN,"ceil",()=>sz,"clone",()=>sL,"copy",()=>sO,"create",()=>sI,"cross",()=>s1,"dist",0,sG,"distance",()=>sG,"div",0,sF,"divide",()=>sF,"dot",()=>s0,"equals",()=>s7,"exactEquals",()=>s9,"floor",()=>sV,"forEach",0,oe,"fromValues",()=>sD,"inverse",()=>sJ,"len",0,sX,"length",()=>sX,"lerp",()=>s2,"max",()=>s$,"min",()=>sU,"mul",0,sB,"multiply",()=>sB,"negate",()=>sZ,"normalize",()=>sQ,"random",()=>s3,"round",()=>sW,"scale",()=>sH,"scaleAndAdd",()=>sq,"set",()=>sR,"sqrDist",0,sY,"sqrLen",0,sK,"squaredDistance",()=>sY,"squaredLength",()=>sK,"str",()=>s8,"sub",0,sj,"subtract",()=>sj,"transformMat4",()=>s4,"transformQuat",()=>s5,"zero",()=>s6],14750);var ot=e.i(14750),ot=ot,oi=e.i(13086);let or=new oi.Log({id:"deck"});(k6=Ec||(Ec={}))[k6.Start=1]="Start",k6[k6.Move=2]="Move",k6[k6.End=4]="End",k6[k6.Cancel=8]="Cancel",(k8=Eu||(Eu={}))[k8.None=0]="None",k8[k8.Left=1]="Left",k8[k8.Right=2]="Right",k8[k8.Up=4]="Up",k8[k8.Down=8]="Down",k8[k8.Horizontal=3]="Horizontal",k8[k8.Vertical=12]="Vertical",k8[k8.All=15]="All",(k9=Eh||(Eh={}))[k9.Possible=1]="Possible",k9[k9.Began=2]="Began",k9[k9.Changed=4]="Changed",k9[k9.Ended=8]="Ended",k9[k9.Recognized=8]="Recognized",k9[k9.Cancelled=16]="Cancelled",k9[k9.Failed=32]="Failed";let on="manipulation",oa="none",os="pan-x",oo="pan-y";class ol{constructor(e,t){this.actions="",this.manager=e,this.set(t)}set(e){"compute"===e&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(let t of this.manager.recognizers)t.options.enable&&(e=e.concat(t.getTouchAction()));var t=e.join(" ");if(t.includes(oa))return oa;let i=t.includes(os),r=t.includes(oo);return i&&r?oa:i||r?i?os:oo:t.includes(on)?on:"auto"}}function oc(e){return e.trim().split(/\s+/g)}function ou(e,t,i){if(e)for(let r of oc(t))e.addEventListener(r,i,!1)}function oh(e,t,i){if(e)for(let r of oc(t))e.removeEventListener(r,i,!1)}function od(e){return(e.ownerDocument||e).defaultView}function of(e){let t=e.length;if(1===t)return{x:Math.round(e[0].clientX),y:Math.round(e[0].clientY)};let i=0,r=0,n=0;for(;n<t;)i+=e[n].clientX,r+=e[n].clientY,n++;return{x:Math.round(i/t),y:Math.round(r/t)}}function op(e){let t=[],i=0;for(;i<e.pointers.length;)t[i]={clientX:Math.round(e.pointers[i].clientX),clientY:Math.round(e.pointers[i].clientY)},i++;return{timeStamp:Date.now(),pointers:t,center:of(t),deltaX:e.deltaX,deltaY:e.deltaY}}function og(e,t){let i=t.x-e.x,r=t.y-e.y;return Math.sqrt(i*i+r*r)}function om(e,t){let i=t.clientX-e.clientX,r=t.clientY-e.clientY;return Math.sqrt(i*i+r*r)}function ov(e,t){let i=t.clientX-e.clientX;return 180*Math.atan2(t.clientY-e.clientY,i)/Math.PI}function oy(e,t){return e===t?Eu.None:Math.abs(e)>=Math.abs(t)?e<0?Eu.Left:Eu.Right:t<0?Eu.Up:Eu.Down}function ob(e,t,i){return{x:t/e||0,y:i/e||0}}class ox{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=e=>{this.manager.options.enable&&this.handler(e)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,t){var i;let r,n,a,s,o;i=this.manager,r=t.pointers.length,n=t.changedPointers.length,a=e&Ec.Start&&r-n==0,s=e&(Ec.End|Ec.Cancel)&&r-n==0,t.isFirst=!!a,t.isFinal=!!s,a&&(i.session={}),t.eventType=e,o=function(e,t){var i,r;let n,a,s,o,l,{session:c}=e,{pointers:u}=t,{length:h}=u;c.firstInput||(c.firstInput=op(t)),h>1&&!c.firstMultiple?c.firstMultiple=op(t):1===h&&(c.firstMultiple=!1);let{firstInput:d,firstMultiple:f}=c,p=f?f.center:d.center,g=t.center=of(u);t.timeStamp=Date.now(),t.deltaTime=t.timeStamp-d.timeStamp,n=g.x-p.x,t.angle=180*Math.atan2(g.y-p.y,n)/Math.PI,t.distance=og(p,g);let{deltaX:v,deltaY:y}=(a=t.center,s=c.offsetDelta,o=c.prevDelta,l=c.prevInput,(t.eventType===Ec.Start||l?.eventType===Ec.End)&&(o=c.prevDelta={x:l?.deltaX||0,y:l?.deltaY||0},s=c.offsetDelta={x:a.x,y:a.y}),{deltaX:o.x+(a.x-s.x),deltaY:o.y+(a.y-s.y)});t.deltaX=v,t.deltaY=y,t.offsetDirection=oy(t.deltaX,t.deltaY);let b=ob(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=b.x,t.overallVelocityY=b.y,t.overallVelocity=Math.abs(b.x)>Math.abs(b.y)?b.x:b.y,t.scale=f?(i=f.pointers,om(u[0],u[1])/om(i[0],i[1])):1,t.rotation=f?(r=f.pointers,ov(u[1],u[0])-ov(r[1],r[0])):0,t.maxPointers=c.prevInput?t.pointers.length>c.prevInput.maxPointers?t.pointers.length:c.prevInput.maxPointers:t.pointers.length;let x=e.element;return function(e,t){let i=e;for(;i;){if(i===t)return!0;i=i.parentNode}return!1}(t.srcEvent.target,x)&&(x=t.srcEvent.target),t.target=x,!function(e,t){let i,r,n,a,s=e.lastInterval||t,o=t.timeStamp-s.timeStamp;if(t.eventType!==Ec.Cancel&&(o>25||void 0===s.velocity)){let l=t.deltaX-s.deltaX,c=t.deltaY-s.deltaY,u=ob(o,l,c);r=u.x,n=u.y,i=Math.abs(u.x)>Math.abs(u.y)?u.x:u.y,a=oy(l,c),e.lastInterval=t}else i=s.velocity,r=s.velocityX,n=s.velocityY,a=s.direction;t.velocity=i,t.velocityX=r,t.velocityY=n,t.direction=a}(c,t),t}(i,t),i.emit("hammer.input",o),i.recognize(o),i.session.prevInput=o}init(){ou(this.element,this.evEl,this.domHandler),ou(this.target,this.evTarget,this.domHandler),ou(od(this.element),this.evWin,this.domHandler)}destroy(){oh(this.element,this.evEl,this.domHandler),oh(this.target,this.evTarget,this.domHandler),oh(od(this.element),this.evWin,this.domHandler)}}let o_={pointerdown:Ec.Start,pointermove:Ec.Move,pointerup:Ec.End,pointercancel:Ec.Cancel,pointerout:Ec.Cancel};class ow extends ox{constructor(e){super(e),this.evEl="pointerdown",this.evWin="pointermove pointerup pointercancel",this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){let{store:t}=this,i=!1,r=o_[e.type],n=e.pointerType,a="touch"===n,s=t.findIndex(t=>t.pointerId===e.pointerId);r&Ec.Start&&(e.buttons||a)?s<0&&(t.push(e),s=t.length-1):r&(Ec.End|Ec.Cancel)&&(i=!0),!(s<0)&&(t[s]=e,this.callback(r,{pointers:t,changedPointers:[e],eventType:r,pointerType:n,srcEvent:e}),i&&t.splice(s,1))}}let ok=["","webkit","Moz","MS","ms","o"],oE={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class oT{constructor(e,t){this.options={...oE,...t,cssProps:{...oE.cssProps,...t.cssProps},inputTarget:t.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new ow(this),this.touchAction=new ol(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?2:1}recognize(e){let t,{session:i}=this;if(i.stopped)return;this.session.prevented&&e.srcEvent.preventDefault();let{recognizers:r}=this,{curRecognizer:n}=i;(!n||n&&n.state&Eh.Recognized)&&(n=i.curRecognizer=null);let a=0;for(;a<r.length;)t=r[a],2!==i.stopped&&(!n||t===n||t.canRecognizeWith(n))?t.recognize(e):t.reset(),!n&&t.state&(Eh.Began|Eh.Changed|Eh.Ended)&&(n=i.curRecognizer=t),a++}get(e){let{recognizers:t}=this;for(let i=0;i<t.length;i++)if(t[i].options.event===e)return t[i];return null}add(e){if(Array.isArray(e)){for(let t of e)this.add(t);return this}let t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(let t of e)this.remove(t);return this}let t="string"==typeof e?this.get(e):e;if(t){let{recognizers:e}=this,i=e.indexOf(t);-1!==i&&(e.splice(i,1),this.touchAction.update())}return this}on(e,t){if(!e||!t)return;let{handlers:i}=this;for(let r of oc(e))i[r]=i[r]||[],i[r].push(t)}off(e,t){if(!e)return;let{handlers:i}=this;for(let r of oc(e))t?i[r]&&i[r].splice(i[r].indexOf(t),1):delete i[r]}emit(e,t){let i=this.handlers[e]&&this.handlers[e].slice();if(!i||!i.length)return;t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()};let r=0;for(;r<i.length;)i[r](t),r++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){let{element:t}=this;if(t){for(let[i,r]of Object.entries(this.options.cssProps)){let n=function(e,t){let i=t[0].toUpperCase()+t.slice(1);for(let r of ok){let n=r?r+i:t;if(n in e)return n}}(t.style,i);e?(this.oldCssProps[n]=t.style[n],t.style[n]=r):t.style[n]=this.oldCssProps[n]||""}e||(this.oldCssProps={})}}}let oP=1;function oS(e){return e&Eh.Cancelled?"cancel":e&Eh.Ended?"end":e&Eh.Changed?"move":e&Eh.Began?"start":""}class oM{constructor(e){this.options=e,this.id=oP++,this.state=Eh.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){let t;if(Array.isArray(e)){for(let t of e)this.recognizeWith(t);return this}if("string"==typeof e){if(!(t=this.manager.get(e)))throw Error(`Cannot find recognizer ${e}`)}else t=e;let{simultaneous:i}=this;return i[t.id]||(i[t.id]=t,t.recognizeWith(this)),this}dropRecognizeWith(e){let t;if(Array.isArray(e)){for(let t of e)this.dropRecognizeWith(t);return this}return(t="string"==typeof e?this.manager.get(e):e)&&delete this.simultaneous[t.id],this}requireFailure(e){let t;if(Array.isArray(e)){for(let t of e)this.requireFailure(t);return this}if("string"==typeof e){if(!(t=this.manager.get(e)))throw Error(`Cannot find recognizer ${e}`)}else t=e;let{requireFail:i}=this;return -1===i.indexOf(t)&&(i.push(t),t.requireFailure(this)),this}dropRequireFailure(e){let t;if(Array.isArray(e)){for(let t of e)this.dropRequireFailure(t);return this}if(t="string"==typeof e?this.manager.get(e):e){let e=this.requireFail.indexOf(t);e>-1&&this.requireFail.splice(e,1)}return this}hasRequireFailures(){return!!this.requireFail.find(e=>e.options.enable)}canRecognizeWith(e){return!!this.simultaneous[e.id]}emit(e){if(!e)return;let{state:t}=this;t<Eh.Ended&&this.manager.emit(this.options.event+oS(t),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),t>=Eh.Ended&&this.manager.emit(this.options.event+oS(t),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=Eh.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(Eh.Failed|Eh.Possible)))return!1;e++}return!0}recognize(e){let t={...e};if(!this.options.enable){this.reset(),this.state=Eh.Failed;return}this.state&(Eh.Recognized|Eh.Cancelled|Eh.Failed)&&(this.state=Eh.Possible),this.state=this.process(t),this.state&(Eh.Began|Eh.Changed|Eh.Ended|Eh.Cancelled)&&this.tryEmit(t)}getEventNames(){return[this.options.event]}reset(){}}class oC extends oM{attrTest(e){let t=this.options.pointers;return 0===t||e.pointers.length===t}process(e){let{state:t}=this,{eventType:i}=e,r=t&(Eh.Began|Eh.Changed),n=this.attrTest(e);return r&&(i&Ec.Cancel||!n)?t|Eh.Cancelled:r||n?i&Ec.End?t|Eh.Ended:t&Eh.Began?t|Eh.Changed:Eh.Began:Eh.Failed}}class oA extends oM{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[on]}process(e){let{options:t}=this,i=e.pointers.length===t.pointers,r=e.distance<t.threshold,n=e.deltaTime<t.time;if(this.reset(),e.eventType&Ec.Start&&0===this.count)return this.failTimeout();if(r&&n&&i){if(e.eventType!==Ec.End)return this.failTimeout();let i=!this.pTime||e.timeStamp-this.pTime<t.interval,r=!this.pCenter||og(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,r&&i?this.count+=1:this.count=1,this._input=e,0==this.count%t.taps)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=Eh.Recognized,this.tryEmit(this._input)},t.interval),Eh.Began):Eh.Recognized}return Eh.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=Eh.Failed},this.options.interval),Eh.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===Eh.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}let oI=["","start","move","end","cancel","up","down","left","right"];class oL extends oC{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:Eu.All,...e}),this.pX=null,this.pY=null}getTouchAction(){let{options:{direction:e}}=this,t=[];return e&Eu.Horizontal&&t.push(oo),e&Eu.Vertical&&t.push(os),t}getEventNames(){return oI.map(e=>this.options.event+e)}directionTest(e){let{options:t}=this,i=!0,{distance:r}=e,{direction:n}=e,a=e.deltaX,s=e.deltaY;return n&t.direction||(t.direction&Eu.Horizontal?(n=0===a?Eu.None:a<0?Eu.Left:Eu.Right,i=a!==this.pX,r=Math.abs(e.deltaX)):(n=0===s?Eu.None:s<0?Eu.Up:Eu.Down,i=s!==this.pY,r=Math.abs(e.deltaY))),e.direction=n,i&&r>t.threshold&&!!(n&t.direction)}attrTest(e){return super.attrTest(e)&&(!!(this.state&Eh.Began)||!(this.state&Eh.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;let t=Eu[e.direction].toLowerCase();t&&(e.additionalEvent=this.options.event+t),super.emit(e)}}let oD=["","start","move","end","cancel","in","out"];class oO{constructor(e,t,i){this.element=e,this.callback=t,this.options=i}}let oR="undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"";"undefined"!=typeof window?window:e.g,e.g;let oN=-1!==oR.indexOf("firefox");class oj extends oO{constructor(e,t,i){super(e,t,{enable:!0,...i}),this.handleEvent=e=>{if(!this.options.enable)return;let t=e.deltaY;globalThis.WheelEvent&&(oN&&e.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(t/=globalThis.devicePixelRatio),e.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(t*=40)),0!==t&&t%4.000244140625==0&&(t=Math.floor(t/4.000244140625)),e.shiftKey&&t&&(t*=.25),this.callback({type:"wheel",center:{x:e.clientX,y:e.clientY},delta:-t,srcEvent:e,pointerType:"mouse",target:e.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,t){"wheel"===e&&(this.options.enable=t)}}let oB=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class oF extends oO{constructor(e,t,i){super(e,t,{enable:!0,...i}),this.handleEvent=e=>{this.handleOverEvent(e),this.handleOutEvent(e),this.handleEnterEvent(e),this.handleLeaveEvent(e),this.handleMoveEvent(e)},this.pressed=!1;const{enable:r}=this.options;this.enableMoveEvent=r,this.enableLeaveEvent=r,this.enableEnterEvent=r,this.enableOutEvent=r,this.enableOverEvent=r,oB.forEach(t=>e.addEventListener(t,this.handleEvent))}destroy(){oB.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){switch(e){case"pointermove":this.enableMoveEvent=t;break;case"pointerover":this.enableOverEvent=t;break;case"pointerout":this.enableOutEvent=t;break;case"pointerenter":this.enableEnterEvent=t;break;case"pointerleave":this.enableLeaveEvent=t}}handleOverEvent(e){this.enableOverEvent&&"mouseover"===e.type&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&"mouseout"===e.type&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&"mouseenter"===e.type&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&"mouseleave"===e.type&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":0===e.buttons&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}let oz=["keydown","keyup"];class oV extends oO{constructor(e,t,i){super(e,t,{enable:!0,tabIndex:0,...i}),this.handleEvent=e=>{let t=e.target||e.srcElement;("INPUT"!==t.tagName||"text"!==t.type)&&"TEXTAREA"!==t.tagName&&(this.enableDownEvent&&"keydown"===e.type&&this.callback({type:"keydown",srcEvent:e,key:e.key,target:e.target}),this.enableUpEvent&&"keyup"===e.type&&this.callback({type:"keyup",srcEvent:e,key:e.key,target:e.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",oz.forEach(t=>e.addEventListener(t,this.handleEvent))}destroy(){oz.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){"keydown"===e&&(this.enableDownEvent=t),"keyup"===e&&(this.enableUpEvent=t)}}class oU extends oO{constructor(e,t,i){super(e,t,i),this.handleEvent=e=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:e.clientX,y:e.clientY},srcEvent:e,pointerType:"mouse",target:e.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){"contextmenu"===e&&(this.options.enable=t)}}let o$={pointerdown:1,pointermove:2,pointerup:4,mousedown:1,mousemove:2,mouseup:4},oW={srcElement:"root",priority:0};class oH{constructor(e,t){this.handleEvent=e=>{if(this.isEmpty())return;let t=this._normalizeEvent(e),i=e.srcEvent.target;for(;i&&i!==t.rootElement;){if(this._emit(t,i),t.handled)return;i=i.parentNode}this._emit(t,"root")},this.eventManager=e,this.recognizerName=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,i,r=!1,n=!1){let{handlers:a,handlersByElement:s}=this,o={...oW,...i},l=s.get(o.srcElement);l||(l=[],s.set(o.srcElement,l));let c={type:e,handler:t,srcElement:o.srcElement,priority:o.priority};r&&(c.once=!0),n&&(c.passive=!0),a.push(c),this._active=this._active||!c.passive;let u=l.length-1;for(;u>=0&&!(l[u].priority>=c.priority);)u--;l.splice(u+1,0,c)}remove(e,t){let{handlers:i,handlersByElement:r}=this;for(let n=i.length-1;n>=0;n--){let a=i[n];if(a.type===e&&a.handler===t){i.splice(n,1);let e=r.get(a.srcElement);e.splice(e.indexOf(a),1),0===e.length&&r.delete(a.srcElement)}}this._active=i.some(e=>!e.passive)}_emit(e,t){let i=this.handlersByElement.get(t);if(i){let t=!1,r=()=>{e.handled=!0},n=()=>{e.handled=!0,t=!0},a=[];for(let s=0;s<i.length;s++){let{type:o,handler:l,once:c}=i[s];if(l({...e,type:o,stopPropagation:r,stopImmediatePropagation:n}),c&&a.push(i[s]),t)break}for(let e=0;e<a.length;e++){let{type:t,handler:i}=a[e];this.remove(t,i)}}}_normalizeEvent(e){let t=this.eventManager.getElement();return{...e,...function(e){let t=o$[e.srcEvent.type];if(!t)return null;let{buttons:i,button:r}=e.srcEvent,n=!1,a=!1,s=!1;return 2===t?(n=!!(1&i),a=!!(4&i),s=!!(2&i)):(n=0===r,a=1===r,s=2===r),{leftButton:n,middleButton:a,rightButton:s}}(e),...function(e,t){let i=e.center;if(!i)return null;let r=t.getBoundingClientRect(),n=r.width/t.offsetWidth||1,a=r.height/t.offsetHeight||1,s={x:(i.x-r.left-t.clientLeft)/n,y:(i.y-r.top-t.clientTop)/a};return{center:i,offsetCenter:s}}(e,t),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}}class oq{constructor(e=null,t={}){if(this._onBasicInput=e=>{this.manager.emit(e.srcEvent.type,e)},this._onOtherEvent=e=>{this.manager.emit(e.type,e)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...t},this.events=new Map,this.element=e,!e)return;for(const t of(this.manager=new oT(e,this.options),this.options.recognizers)){const{recognizer:e,recognizeWith:i,requireFailure:r}=function(e){let t;if("recognizer"in e)return e;let i=Array.isArray(e)?[...e]:[e];return{recognizer:t="function"==typeof i[0]?new(i.shift())(i.shift()||{}):i.shift(),recognizeWith:"string"==typeof i[0]?[i[0]]:i[0],requireFailure:"string"==typeof i[1]?[i[1]]:i[1]}}(t);this.manager.add(e),i&&e.recognizeWith(i),r&&e.requireFailure(r)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new oj(e,this._onOtherEvent,{enable:!1}),this.moveInput=new oF(e,this._onOtherEvent,{enable:!1}),this.keyInput=new oV(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new oU(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,t,i){this._addEventHandler(e,t,i,!1)}once(e,t,i){this._addEventHandler(e,t,i,!0)}watch(e,t,i){this._addEventHandler(e,t,i,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){let{manager:i}=this;if(!i)return;let r=i.get(e);r&&(r.set({enable:t}),i.touchAction.update()),this.wheelInput?.enableEventType(e,t),this.moveInput?.enableEventType(e,t),this.keyInput?.enableEventType(e,t),this.contextmenuInput?.enableEventType(e,t)}_addEventHandler(e,t,i,r,n){if("string"!=typeof e){for(let[a,s]of(i=t,Object.entries(e)))this._addEventHandler(a,s,i,r,n);return}let{manager:a,events:s}=this;if(!a)return;let o=s.get(e);!o&&(o=new oH(this,this._getRecognizerName(e)||e),s.set(e,o),a&&a.on(e,o.handleEvent)),o.add(e,t,i,r,n),o.isEmpty()||this._toggleRecognizer(o.recognizerName,!0)}_removeEventHandler(e,t){if("string"!=typeof e){for(let[t,i]of Object.entries(e))this._removeEventHandler(t,i);return}let{events:i}=this,r=i.get(e);if(r&&(r.remove(e,t),r.isEmpty())){let{recognizerName:e}=r,t=!1;for(let r of i.values())if(r.recognizerName===e&&!r.isEmpty()){t=!0;break}t||this._toggleRecognizer(e,!1)}}_getRecognizerName(e){return this.manager.recognizers.find(t=>t.getEventNames().includes(e))?.options.event}}let oG={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(oG,"IDENTITY",{get:()=>(or.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});let oY={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},oX={common:0,meters:1,pixels:2},oK={click:"onClick",dblclick:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},oZ={multipan:[oL,{threshold:10,direction:Eu.Vertical,pointers:2}],pinch:[class extends oC{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[oa]}getEventNames(){return oD.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||!!(this.state&Eh.Began))}emit(e){if(1!==e.scale){let t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}super.emit(e)}},{},null,["multipan"]],pan:[oL,{threshold:1},["pinch"],["multipan"]],dblclick:[oA,{event:"dblclick",taps:2}],click:[oA,{event:"click"},null,["dblclick"]]};function oJ(e){let t,i={};return r=>{for(let n in r)if(!function(e,t){if(e===t)return!0;if(Array.isArray(e)){let i=e.length;if(!t||t.length!==i)return!1;for(let r=0;r<i;r++)if(e[r]!==t[r])return!1;return!0}return!1}(r[n],i[n])){t=e(r),i=r;break}return t}}let oQ=[0,0,0,0],o0=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],o1=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],o2=[0,0,0],o3=[0,0,0],o4=oJ(function({viewport:e,devicePixelRatio:t,coordinateSystem:i,coordinateOrigin:r}){let{projectionCenter:n,viewProjectionMatrix:a,originCommon:s,cameraPosCommon:o,shaderCoordinateOrigin:l,geospatialOrigin:c}=function(e,t,i){let{viewMatrixUncentered:r,projectionMatrix:n}=e,{viewMatrix:a,viewProjectionMatrix:s}=e,o=oQ,l=oQ,c=e.cameraPosition,{geospatialOrigin:u,shaderCoordinateOrigin:h,offsetMode:d}=o5(e,t,i);return d&&(l=e.projectPosition(u||h),c=[c[0]-l[0],c[1]-l[1],c[2]-l[2]],l[3]=1,o=ot.transformMat4([],l,s),a=r||a,s=sA.multiply([],n,a),s=sA.multiply([],s,o0)),{viewMatrix:a,viewProjectionMatrix:s,projectionCenter:o,originCommon:l,cameraPosCommon:c,shaderCoordinateOrigin:h,geospatialOrigin:u}}(e,i,r),u=e.getDistanceScales(),h=[e.width*t,e.height*t],d=ot.transformMat4([],[0,0,-e.focalDistance,1],e.projectionMatrix)[3]||1,f={coordinateSystem:i,projectionMode:e.projectionMode,coordinateOrigin:l,commonOrigin:s.slice(0,3),center:n,pseudoMeters:!!e._pseudoMeters,viewportSize:h,devicePixelRatio:t,focalDistance:d,commonUnitsPerMeter:u.unitsPerMeter,commonUnitsPerWorldUnit:u.unitsPerMeter,commonUnitsPerWorldUnit2:o2,scale:e.scale,wrapLongitude:!1,viewProjectionMatrix:a,modelMatrix:o1,cameraPosition:o};if(c){let t=e.getDistanceScales(c);switch(i){case oG.METER_OFFSETS:f.commonUnitsPerWorldUnit=t.unitsPerMeter,f.commonUnitsPerWorldUnit2=t.unitsPerMeter2;break;case oG.LNGLAT:case oG.LNGLAT_OFFSETS:e._pseudoMeters||(f.commonUnitsPerMeter=t.unitsPerMeter),f.commonUnitsPerWorldUnit=t.unitsPerDegree,f.commonUnitsPerWorldUnit2=t.unitsPerDegree2;break;case oG.CARTESIAN:f.commonUnitsPerWorldUnit=[1,1,t.unitsPerMeter[2]],f.commonUnitsPerWorldUnit2=[0,0,t.unitsPerMeter2[2]]}}return f});function o5(e,t,i=o3){let r;i.length<3&&(i=[i[0],i[1],0]);let n=i,a=!0;switch(r=t===oG.LNGLAT_OFFSETS||t===oG.METER_OFFSETS?i:e.isGeospatial?[Math.fround(e.longitude),Math.fround(e.latitude),0]:null,e.projectionMode){case oY.WEB_MERCATOR:(t===oG.LNGLAT||t===oG.CARTESIAN)&&(r=[0,0,0],a=!1);break;case oY.WEB_MERCATOR_AUTO_OFFSET:t===oG.LNGLAT?n=r:t===oG.CARTESIAN&&(n=[Math.fround(e.center[0]),Math.fround(e.center[1]),0],r=e.unprojectPosition(n),n[0]-=i[0],n[1]-=i[1],n[2]-=i[2]);break;case oY.IDENTITY:(n=e.position.map(Math.fround))[2]=n[2]||0;break;case oY.GLOBE:a=!1,r=null;break;default:a=!1}return{geospatialOrigin:r,shaderCoordinateOrigin:n,offsetMode:a}}let o6=Object.keys(oG).map(e=>`const COORDINATE_SYSTEM_${e}: i32 = ${oG[e]};`).join(""),o8=Object.keys(oY).map(e=>`const PROJECTION_MODE_${e}: i32 = ${oY[e]};`).join(""),o9=Object.keys(oX).map(e=>`const UNIT_${e.toUpperCase()}: i32 = ${oX[e]};`).join(""),o7=`\
${o6}
${o8}
${o9}

const TILE_SIZE: f32 = 512.0;
const PI: f32 = 3.1415926536;
const WORLD_SCALE: f32 = TILE_SIZE / (PI * 2.0);
const ZERO_64_LOW: vec3<f32> = vec3<f32>(0.0, 0.0, 0.0);
const EARTH_RADIUS: f32 = 6370972.0; // meters
const GLOBE_RADIUS: f32 = 256.0;

// -----------------------------------------------------------------------------
// Uniform block (converted from GLSL uniform block)
// -----------------------------------------------------------------------------
struct ProjectUniforms {
  wrapLongitude: i32,
  coordinateSystem: i32,
  commonUnitsPerMeter: vec3<f32>,
  projectionMode: i32,
  scale: f32,
  commonUnitsPerWorldUnit: vec3<f32>,
  commonUnitsPerWorldUnit2: vec3<f32>,
  center: vec4<f32>,
  modelMatrix: mat4x4<f32>,
  viewProjectionMatrix: mat4x4<f32>,
  viewportSize: vec2<f32>,
  devicePixelRatio: f32,
  focalDistance: f32,
  cameraPosition: vec3<f32>,
  coordinateOrigin: vec3<f32>,
  commonOrigin: vec3<f32>,
  pseudoMeters: i32,
};

@group(0) @binding(0)
var<uniform> project: ProjectUniforms;

// -----------------------------------------------------------------------------
// Geometry data
// (In your GLSL code, "geometry" was assumed to be available globally. In WGSL,
// you might supply this via vertex attributes or a uniform. Here we define a
// uniform struct for demonstration.)
// -----------------------------------------------------------------------------

// Structure to carry additional geometry data used by deck.gl filters.
struct Geometry {
  worldPosition: vec3<f32>,
  worldPositionAlt: vec3<f32>,
  position: vec4<f32>,
  normal: vec3<f32>,
  uv: vec2<f32>,
  pickingColor: vec3<f32>,
};

// @group(0) @binding(1)
var<private> geometry: Geometry;
`,le=`\
${o7}

// -----------------------------------------------------------------------------
// Functions
// -----------------------------------------------------------------------------

// Returns an adjustment factor for commonUnitsPerMeter
fn _project_size_at_latitude(lat: f32) -> f32 {
  let y = clamp(lat, -89.9, 89.9);
  return 1.0 / cos(radians(y));
}

// Overloaded version: scales a value in meters at a given latitude.
fn _project_size_at_latitude_m(meters: f32, lat: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * _project_size_at_latitude(lat);
}

// Computes a non-linear scale factor based on geometry.
// (Note: This function relies on "geometry" being provided.)
fn project_size() -> f32 {
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
      project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
      project.pseudoMeters == 0) {
    if (geometry.position.w == 0.0) {
      return _project_size_at_latitude(geometry.worldPosition.y);
    }
    let y: f32 = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
    let y2 = y * y;
    let y4 = y2 * y2;
    let y6 = y4 * y2;
    return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
  }
  return 1.0;
}

// Overloads to scale offsets (meters to world units)
fn project_size_float(meters: f32) -> f32 {
  return meters * project.commonUnitsPerMeter.z * project_size();
}

fn project_size_vec2(meters: vec2<f32>) -> vec2<f32> {
  return meters * project.commonUnitsPerMeter.xy * project_size();
}

fn project_size_vec3(meters: vec3<f32>) -> vec3<f32> {
  return meters * project.commonUnitsPerMeter * project_size();
}

fn project_size_vec4(meters: vec4<f32>) -> vec4<f32> {
  return vec4<f32>(meters.xyz * project.commonUnitsPerMeter, meters.w);
}

// Returns a rotation matrix aligning the zaxis with the given up vector.
fn project_get_orientation_matrix(up: vec3<f32>) -> mat3x3<f32> {
  let uz = normalize(up);
  let ux = select(
    vec3<f32>(1.0, 0.0, 0.0),
    normalize(vec3<f32>(uz.y, -uz.x, 0.0)),
    abs(uz.z) == 1.0
  );
  let uy = cross(uz, ux);
  return mat3x3<f32>(ux, uy, uz);
}

// Since WGSL does not support "out" parameters, we return a struct.
struct RotationResult {
  needsRotation: bool,
  transform: mat3x3<f32>,
};

fn project_needs_rotation(commonPosition: vec3<f32>) -> RotationResult {
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    return RotationResult(true, project_get_orientation_matrix(commonPosition));
  } else {
    return RotationResult(false, mat3x3<f32>());  // identity alternative if needed
  };
}

// Projects a normal vector from the current coordinate system to world space.
fn project_normal(vector: vec3<f32>) -> vec3<f32> {
  let normal_modelspace = project.modelMatrix * vec4<f32>(vector, 0.0);
  var n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
  let rotResult = project_needs_rotation(geometry.position.xyz);
  if (rotResult.needsRotation) {
    n = rotResult.transform * n;
  }
  return n;
}

// Applies a scale offset based on y-offset (dy)
fn project_offset_(offset: vec4<f32>) -> vec4<f32> {
  let dy: f32 = offset.y;
  let commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
  return vec4<f32>(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}

// Projects lng/lat coordinates to a unit tile [0,1]
fn project_mercator_(lnglat: vec2<f32>) -> vec2<f32> {
  var x = lnglat.x;
  if (project.wrapLongitude != 0) {
    x = ((x + 180.0) % 360.0) - 180.0;
  }
  let y = clamp(lnglat.y, -89.9, 89.9);
  return vec2<f32>(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// Projects lng/lat/z coordinates for a globe projection.
fn project_globe_(lnglatz: vec3<f32>) -> vec3<f32> {
  let lambda = radians(lnglatz.x);
  let phi = radians(lnglatz.y);
  let cosPhi = cos(phi);
  let D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
  return vec3<f32>(
    sin(lambda) * cosPhi,
    -cos(lambda) * cosPhi,
    sin(phi)
  ) * D;
}

// Projects positions (with an optional 64-bit low part) from the input
// coordinate system to the common space.
fn project_position_vec4_f64(position: vec4<f32>, position64Low: vec3<f32>) -> vec4<f32> {
  var position_world = project.modelMatrix * position;

  // Work around for a Mac+NVIDIA bug:
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_mercator_(position_world.xy),
        _project_size_at_latitude_m(position_world.z, position_world.y),
        position_world.w
      );
    }
    if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
      position_world = vec4f(position_world.xyz + project.coordinateOrigin, position_world.w);
    }
  }
  if (project.projectionMode == PROJECTION_MODE_GLOBE) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      return vec4<f32>(
        project_globe_(position_world.xyz),
        position_world.w
      );
    }
  }
  if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
    if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
      if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
        return vec4<f32>(
          project_mercator_(position_world.xy) - project.commonOrigin.xy,
          project_size_float(position_world.z),
          position_world.w
        );
      }
    }
  }
  if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
      (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
       (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
        project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
    position_world = vec4f(position_world.xyz - project.coordinateOrigin, position_world.w);
  }

  return project_offset_(position_world) +
         project_offset_(project.modelMatrix * vec4<f32>(position64Low, 0.0));
}

// Overloaded versions for different input types.
fn project_position_vec4_f32(position: vec4<f32>) -> vec4<f32> {
  return project_position_vec4_f64(position, ZERO_64_LOW);
}

fn project_position_vec3_f64(position: vec3<f32>, position64Low: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), position64Low);
  return projected_position.xyz;
}

fn project_position_vec3_f32(position: vec3<f32>) -> vec3<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 1.0), ZERO_64_LOW);
  return projected_position.xyz;
}

fn project_position_vec2_f32(position: vec2<f32>) -> vec2<f32> {
  let projected_position = project_position_vec4_f64(vec4<f32>(position, 0.0, 1.0), ZERO_64_LOW);
  return projected_position.xy;
}

// Transforms a common space position to clip space.
fn project_common_position_to_clipspace_with_projection(position: vec4<f32>, viewProjectionMatrix: mat4x4<f32>, center: vec4<f32>) -> vec4<f32> {
  return viewProjectionMatrix * position + center;
}

// Uses the project viewProjectionMatrix and center.
fn project_common_position_to_clipspace(position: vec4<f32>) -> vec4<f32> {
  return project_common_position_to_clipspace_with_projection(position, project.viewProjectionMatrix, project.center);
}

// Returns a clip space offset corresponding to a given number of screen pixels.
fn project_pixel_size_to_clipspace(pixels: vec2<f32>) -> vec2<f32> {
  let offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
  return offset * project.focalDistance;
}

fn project_meter_size_to_pixel(meters: f32) -> f32 {
  return project_size_float(meters) * project.scale;
}

fn project_unit_size_to_pixel(size: f32, unit: i32) -> f32 {
  if (unit == UNIT_METERS) {
    return project_meter_size_to_pixel(size);
  } else if (unit == UNIT_COMMON) {
    return size * project.scale;
  }
  // UNIT_PIXELS: no scaling applied.
  return size;
}

fn project_pixel_size_float(pixels: f32) -> f32 {
  return pixels / project.scale;
}

fn project_pixel_size_vec2(pixels: vec2<f32>) -> vec2<f32> {
  return pixels / project.scale;
}
`,lt=Object.keys(oG).map(e=>`const int COORDINATE_SYSTEM_${e} = ${oG[e]};`).join(""),li=Object.keys(oY).map(e=>`const int PROJECTION_MODE_${e} = ${oY[e]};`).join(""),lr=Object.keys(oX).map(e=>`const int UNIT_${e.toUpperCase()} = ${oX[e]};`).join(""),ln={},la={name:"project",dependencies:[{name:"fp32",vs:aU},aV],source:le,vs:`\
${lt}
${li}
${lr}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`,getUniforms:function(e=ln){return"viewport"in e?function({viewport:e,devicePixelRatio:t=1,modelMatrix:i=null,coordinateSystem:r=oG.DEFAULT,coordinateOrigin:n=o3,autoWrapLongitude:a=!1}){r===oG.DEFAULT&&(r=e.isGeospatial?oG.LNGLAT:oG.CARTESIAN);let s=o4({viewport:e,devicePixelRatio:t,coordinateSystem:r,coordinateOrigin:n});return s.wrapLongitude=a,s.modelMatrix=i||o1,s}(e):{}},uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}},ls={name:"project32",dependencies:[la],source:`\
// Define a structure to hold both the clip-space position and the common position.
struct ProjectResult {
  clipPosition: vec4<f32>,
  commonPosition: vec4<f32>,
};

// This function mimics the GLSL version with the 'out' parameter by returning both values.
fn project_position_to_clipspace_and_commonspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> ProjectResult {
  // Compute the projected position.
  let projectedPosition: vec3<f32> = project_position_vec3_f64(position, position64Low);

  // Start with the provided offset.
  var finalOffset: vec3<f32> = offset;

  // Get whether a rotation is needed and the rotation matrix.
  let rotationResult = project_needs_rotation(projectedPosition);

  // If rotation is needed, update the offset.
  if (rotationResult.needsRotation) {
    finalOffset = rotationResult.transform * offset;
  }

  // Compute the common position.
  let commonPosition: vec4<f32> = vec4<f32>(projectedPosition + finalOffset, 1.0);

  // Convert to clip-space.
  let clipPosition: vec4<f32> = project_common_position_to_clipspace(commonPosition);

  return ProjectResult(clipPosition, commonPosition);
}

// A convenience overload that returns only the clip-space position.
fn project_position_to_clipspace(
    position: vec3<f32>,
    position64Low: vec3<f32>,
    offset: vec3<f32>
) -> vec4<f32> {
  return project_position_to_clipspace_and_commonspace(position, position64Low, offset).clipPosition;
}
`,vs:`\
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`};globalThis.mathgl=globalThis.mathgl||{config:{EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1}};let lo=globalThis.mathgl.config;function ll(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}function lc(e,t,i){return function(e,t,i){if(ll(e)){i=i||(e.clone?e.clone():Array(e.length));for(let r=0;r<i.length&&r<e.length;++r){let n="number"==typeof e?e:e[r];i[r]=t(n,r,i)}return i}return t(e)}(e,e=>Math.max(t,Math.min(i,e)))}function lu(e,t,i){return ll(e)?e.map((e,r)=>lu(e,t[r],i)):i*t+(1-i)*e}function lh(e,t,i){let r=lo.EPSILON;i&&(lo.EPSILON=i);try{if(e===t)return!0;if(ll(e)&&ll(t)){if(e.length!==t.length)return!1;for(let i=0;i<e.length;++i)if(!lh(e[i],t[i]))return!1;return!0}if(e&&e.equals)return e.equals(t);if(t&&t.equals)return t.equals(e);if("number"==typeof e&&"number"==typeof t)return Math.abs(e-t)<=lo.EPSILON*Math.max(1,Math.abs(e),Math.abs(t));return!1}finally{lo.EPSILON=r}}class ld extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,t=0){for(let i=0;i<this.ELEMENTS;++i)this[i]=e[i+t];return this.check()}toArray(e=[],t=0){for(let i=0;i<this.ELEMENTS;++i)e[t+i]=this[i];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:ll(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(lo)}formatString(e){let t="";for(let i=0;i<this.ELEMENTS;++i)t+=(i>0?", ":"")+function(e,{precision:t=lo.precision}={}){return e=Math.round(e/lo.EPSILON)*lo.EPSILON,`${parseFloat(e.toPrecision(t))}`}(this[i],e);return`${e.printTypes?this.constructor.name:""}[${t}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!lh(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,i){if(void 0===i)return this.lerp(this,e,t);for(let r=0;r<this.ELEMENTS;++r){let n=e[r],a="number"==typeof t?t:t[r];this[r]=n+i*(a-n)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e[i]),t[i]);return this.check()}add(...e){for(let t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]+=t[e];return this.check()}subtract(...e){for(let t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]-=t[e];return this.check()}scale(e){if("number"==typeof e)for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(lo.debug&&!this.validate())throw Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let i=0;i<this.ELEMENTS;++i)this[i]=Math.min(Math.max(this[i],e),t);return this.check()}get elements(){return this}}function lf(e){if(!Number.isFinite(e))throw Error(`Invalid number ${JSON.stringify(e)}`);return e}function lp(e,t,i=""){if(lo.debug&&!function(e,t){if(e.length!==t)return!1;for(let t=0;t<e.length;++t)if(!Number.isFinite(e[t]))return!1;return!0}(e,t))throw Error(`math.gl: ${i} some fields set to invalid numbers'`);return e}function lg(e,t){if(!e)throw Error(`math.gl assertion ${t}`)}class lm extends ld{get x(){return this[0]}set x(e){this[0]=lf(e)}get y(){return this[1]}set y(e){this[1]=lf(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let i=0;i<this.ELEMENTS;++i){let r=this[i]-e[i];t+=r*r}return lf(t)}dot(e){let t=0;for(let i=0;i<this.ELEMENTS;++i)t+=this[i]*e[i];return lf(t)}normalize(){let e=this.magnitude();if(0!==e)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(...e){for(let t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]*=t[e];return this.check()}divide(...e){for(let t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]/=t[e];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return lg(e>=0&&e<this.ELEMENTS,"index is out of range"),lf(this[e])}setComponent(e,t){return lg(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}}function lv(){let e=new a$(3);return a$!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function ly(e){let t=new a$(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function lb(e){let t=e[0],i=e[1],r=e[2];return Math.sqrt(t*t+i*i+r*r)}function lx(e,t,i){let r=new a$(3);return r[0]=e,r[1]=t,r[2]=i,r}function l_(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function lw(e,t,i,r){return e[0]=t,e[1]=i,e[2]=r,e}function lk(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e[2]=t[2]+i[2],e}function lE(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e[2]=t[2]-i[2],e}function lT(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e[2]=t[2]*i[2],e}function lP(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e[2]=t[2]/i[2],e}function lS(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e[2]=Math.ceil(t[2]),e}function lM(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e[2]=Math.floor(t[2]),e}function lC(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e[2]=Math.min(t[2],i[2]),e}function lA(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e[2]=Math.max(t[2],i[2]),e}function lI(e,t){return e[0]=aH(t[0]),e[1]=aH(t[1]),e[2]=aH(t[2]),e}function lL(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e}function lD(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e[2]=t[2]+i[2]*r,e}function lO(e,t){let i=t[0]-e[0],r=t[1]-e[1],n=t[2]-e[2];return Math.sqrt(i*i+r*r+n*n)}function lR(e,t){let i=t[0]-e[0],r=t[1]-e[1],n=t[2]-e[2];return i*i+r*r+n*n}function lN(e){let t=e[0],i=e[1],r=e[2];return t*t+i*i+r*r}function lj(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function lB(e,t){return e[0]=1/t[0],e[1]=1/t[1],e[2]=1/t[2],e}function lF(e,t){let i=t[0],r=t[1],n=t[2],a=i*i+r*r+n*n;return a>0&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a,e}function lz(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function lV(e,t,i){let r=t[0],n=t[1],a=t[2],s=i[0],o=i[1],l=i[2];return e[0]=n*l-a*o,e[1]=a*s-r*l,e[2]=r*o-n*s,e}function lU(e,t,i,r){let n=t[0],a=t[1],s=t[2];return e[0]=n+r*(i[0]-n),e[1]=a+r*(i[1]-a),e[2]=s+r*(i[2]-s),e}function l$(e,t,i,r){let n=Math.acos(Math.min(Math.max(lz(t,i),-1),1)),a=Math.sin(n),s=Math.sin((1-r)*n)/a,o=Math.sin(r*n)/a;return e[0]=s*t[0]+o*i[0],e[1]=s*t[1]+o*i[1],e[2]=s*t[2]+o*i[2],e}function lW(e,t,i,r,n,a){let s=a*a,o=s*(2*a-3)+1,l=s*(a-2)+a,c=s*(a-1),u=s*(3-2*a);return e[0]=t[0]*o+i[0]*l+r[0]*c+n[0]*u,e[1]=t[1]*o+i[1]*l+r[1]*c+n[1]*u,e[2]=t[2]*o+i[2]*l+r[2]*c+n[2]*u,e}function lH(e,t,i,r,n,a){let s=1-a,o=s*s,l=a*a,c=o*s,u=3*a*o,h=3*l*s,d=l*a;return e[0]=t[0]*c+i[0]*u+r[0]*h+n[0]*d,e[1]=t[1]*c+i[1]*u+r[1]*h+n[1]*d,e[2]=t[2]*c+i[2]*u+r[2]*h+n[2]*d,e}function lq(e,t){t=void 0===t?1:t;let i=2*aW()*Math.PI,r=2*aW()-1,n=Math.sqrt(1-r*r)*t;return e[0]=Math.cos(i)*n,e[1]=Math.sin(i)*n,e[2]=r*t,e}function lG(e,t,i){let r=t[0],n=t[1],a=t[2],s=i[3]*r+i[7]*n+i[11]*a+i[15];return s=s||1,e[0]=(i[0]*r+i[4]*n+i[8]*a+i[12])/s,e[1]=(i[1]*r+i[5]*n+i[9]*a+i[13])/s,e[2]=(i[2]*r+i[6]*n+i[10]*a+i[14])/s,e}function lY(e,t,i){let r=t[0],n=t[1],a=t[2];return e[0]=r*i[0]+n*i[3]+a*i[6],e[1]=r*i[1]+n*i[4]+a*i[7],e[2]=r*i[2]+n*i[5]+a*i[8],e}function lX(e,t,i){let r=i[0],n=i[1],a=i[2],s=i[3],o=t[0],l=t[1],c=t[2],u=n*c-a*l,h=a*o-r*c,d=r*l-n*o,f=n*d-a*h,p=a*u-r*d,g=r*h-n*u,v=2*s;return u*=v,h*=v,d*=v,f*=2,p*=2,g*=2,e[0]=o+u+f,e[1]=l+h+p,e[2]=c+d+g,e}function lK(e,t,i,r){let n=[],a=[];return n[0]=t[0]-i[0],n[1]=t[1]-i[1],n[2]=t[2]-i[2],a[0]=n[0],a[1]=n[1]*Math.cos(r)-n[2]*Math.sin(r),a[2]=n[1]*Math.sin(r)+n[2]*Math.cos(r),e[0]=a[0]+i[0],e[1]=a[1]+i[1],e[2]=a[2]+i[2],e}function lZ(e,t,i,r){let n=[],a=[];return n[0]=t[0]-i[0],n[1]=t[1]-i[1],n[2]=t[2]-i[2],a[0]=n[2]*Math.sin(r)+n[0]*Math.cos(r),a[1]=n[1],a[2]=n[2]*Math.cos(r)-n[0]*Math.sin(r),e[0]=a[0]+i[0],e[1]=a[1]+i[1],e[2]=a[2]+i[2],e}function lJ(e,t,i,r){let n=[],a=[];return n[0]=t[0]-i[0],n[1]=t[1]-i[1],n[2]=t[2]-i[2],a[0]=n[0]*Math.cos(r)-n[1]*Math.sin(r),a[1]=n[0]*Math.sin(r)+n[1]*Math.cos(r),a[2]=n[2],e[0]=a[0]+i[0],e[1]=a[1]+i[1],e[2]=a[2]+i[2],e}function lQ(e,t){let i=e[0],r=e[1],n=e[2],a=t[0],s=t[1],o=t[2],l=Math.sqrt((i*i+r*r+n*n)*(a*a+s*s+o*o));return Math.acos(Math.min(Math.max(l&&lz(e,t)/l,-1),1))}function l0(e){return e[0]=0,e[1]=0,e[2]=0,e}function l1(e){return`vec3(${e[0]}, ${e[1]}, ${e[2]})`}function l2(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}function l3(e,t){let i=e[0],r=e[1],n=e[2],a=t[0],s=t[1],o=t[2];return Math.abs(i-a)<=1e-6*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(r-s)<=1e-6*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(n-o)<=1e-6*Math.max(1,Math.abs(n),Math.abs(o))}let l4=(l=lv(),function(e,t,i,r,n,a){let s,o;for(t||(t=3),i||(i=0),o=r?Math.min(r*t+i,e.length):e.length,s=i;s<o;s+=t)l[0]=e[s],l[1]=e[s+1],l[2]=e[s+2],n(l,l,a),e[s]=l[0],e[s+1]=l[1],e[s+2]=l[2];return e});function l5(e,t,i){let r=t[0],n=t[1],a=t[2],s=i[3]*r+i[7]*n+i[11]*a||1;return e[0]=(i[0]*r+i[4]*n+i[8]*a)/s,e[1]=(i[1]*r+i[5]*n+i[9]*a)/s,e[2]=(i[2]*r+i[6]*n+i[10]*a)/s,e}e.s(["add",()=>lk,"angle",()=>lQ,"bezier",()=>lH,"ceil",()=>lS,"clone",()=>ly,"copy",()=>l_,"create",()=>lv,"cross",()=>lV,"dist",0,lO,"distance",()=>lO,"div",0,lP,"divide",()=>lP,"dot",()=>lz,"equals",()=>l3,"exactEquals",()=>l2,"floor",()=>lM,"forEach",0,l4,"fromValues",()=>lx,"hermite",()=>lW,"inverse",()=>lB,"len",0,lb,"length",()=>lb,"lerp",()=>lU,"max",()=>lA,"min",()=>lC,"mul",0,lT,"multiply",()=>lT,"negate",()=>lj,"normalize",()=>lF,"random",()=>lq,"rotateX",()=>lK,"rotateY",()=>lZ,"rotateZ",()=>lJ,"round",()=>lI,"scale",()=>lL,"scaleAndAdd",()=>lD,"set",()=>lw,"slerp",()=>l$,"sqrDist",0,lR,"sqrLen",0,lN,"squaredDistance",()=>lR,"squaredLength",()=>lN,"str",()=>l1,"sub",0,lE,"subtract",()=>lE,"transformMat3",()=>lY,"transformMat4",()=>lG,"transformQuat",()=>lX,"zero",()=>l0],89522);let l6=[0,0,0];class l8 extends lm{static get ZERO(){return i||Object.freeze(i=new l8(0,0,0)),i}constructor(e=0,t=0,i=0){super(-0,-0,-0),1==arguments.length&&ll(e)?this.copy(e):(lo.debug&&(lf(e),lf(t),lf(i)),this[0]=e,this[1]=t,this[2]=i)}set(e,t,i){return this[0]=e,this[1]=t,this[2]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return lo.debug&&(lf(e.x),lf(e.y),lf(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=lf(e)}angle(e){return lQ(this,e)}cross(e){return lV(this,this,e),this.check()}rotateX({radians:e,origin:t=l6}){return lK(this,this,t,e),this.check()}rotateY({radians:e,origin:t=l6}){return lZ(this,this,t,e),this.check()}rotateZ({radians:e,origin:t=l6}){return lJ(this,this,t,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return lG(this,this,e),this.check()}transformAsVector(e){return l5(this,this,e),this.check()}transformByMatrix3(e){return lY(this,this,e),this.check()}transformByMatrix2(e){let t,i;return t=this[0],i=this[1],this[0]=e[0]*t+e[2]*i,this[1]=e[1]*t+e[3]*i,this[2]=this[2],this.check()}transformByQuaternion(e){return lX(this,this,e),this.check()}}class l9 extends ld{toString(){let e="[";if(lo.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let i=0;i<this.RANK;++i)e+=` ${this[i*this.RANK+t]}`}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=` ${this[t]}`}return e+"]"}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,i){return this[t*this.RANK+e]=lf(i),this}getColumn(e,t=Array(this.RANK).fill(-0)){let i=e*this.RANK;for(let e=0;e<this.RANK;++e)t[e]=this[i+e];return t}setColumn(e,t){let i=e*this.RANK;for(let e=0;e<this.RANK;++e)this[i+e]=t[e];return this}}function l7(){let e=new a$(2);return a$!=Float32Array&&(e[0]=0,e[1]=0),e}function ce(e){let t=new a$(2);return t[0]=e[0],t[1]=e[1],t}function ct(e,t){let i=new a$(2);return i[0]=e,i[1]=t,i}function ci(e,t){return e[0]=t[0],e[1]=t[1],e}function cr(e,t,i){return e[0]=t,e[1]=i,e}function cn(e,t,i){return e[0]=t[0]+i[0],e[1]=t[1]+i[1],e}function ca(e,t,i){return e[0]=t[0]-i[0],e[1]=t[1]-i[1],e}function cs(e,t,i){return e[0]=t[0]*i[0],e[1]=t[1]*i[1],e}function co(e,t,i){return e[0]=t[0]/i[0],e[1]=t[1]/i[1],e}function cl(e,t){return e[0]=Math.ceil(t[0]),e[1]=Math.ceil(t[1]),e}function cc(e,t){return e[0]=Math.floor(t[0]),e[1]=Math.floor(t[1]),e}function cu(e,t,i){return e[0]=Math.min(t[0],i[0]),e[1]=Math.min(t[1],i[1]),e}function ch(e,t,i){return e[0]=Math.max(t[0],i[0]),e[1]=Math.max(t[1],i[1]),e}function cd(e,t){return e[0]=aH(t[0]),e[1]=aH(t[1]),e}function cf(e,t,i){return e[0]=t[0]*i,e[1]=t[1]*i,e}function cp(e,t,i,r){return e[0]=t[0]+i[0]*r,e[1]=t[1]+i[1]*r,e}function cg(e,t){let i=t[0]-e[0],r=t[1]-e[1];return Math.sqrt(i*i+r*r)}function cm(e,t){let i=t[0]-e[0],r=t[1]-e[1];return i*i+r*r}function cv(e){let t=e[0],i=e[1];return Math.sqrt(t*t+i*i)}function cy(e){let t=e[0],i=e[1];return t*t+i*i}function cb(e,t){return e[0]=-t[0],e[1]=-t[1],e}function cx(e,t){return e[0]=1/t[0],e[1]=1/t[1],e}function c_(e,t){let i=t[0],r=t[1],n=i*i+r*r;return n>0&&(n=1/Math.sqrt(n)),e[0]=t[0]*n,e[1]=t[1]*n,e}function cw(e,t){return e[0]*t[0]+e[1]*t[1]}function ck(e,t,i){let r=t[0]*i[1]-t[1]*i[0];return e[0]=e[1]=0,e[2]=r,e}function cE(e,t,i,r){let n=t[0],a=t[1];return e[0]=n+r*(i[0]-n),e[1]=a+r*(i[1]-a),e}function cT(e,t){t=void 0===t?1:t;let i=2*aW()*Math.PI;return e[0]=Math.cos(i)*t,e[1]=Math.sin(i)*t,e}function cP(e,t,i){let r=t[0],n=t[1];return e[0]=i[0]*r+i[2]*n,e[1]=i[1]*r+i[3]*n,e}function cS(e,t,i){let r=t[0],n=t[1];return e[0]=i[0]*r+i[2]*n+i[4],e[1]=i[1]*r+i[3]*n+i[5],e}function cM(e,t,i){let r=t[0],n=t[1];return e[0]=i[0]*r+i[3]*n+i[6],e[1]=i[1]*r+i[4]*n+i[7],e}function cC(e,t,i){let r=t[0],n=t[1];return e[0]=i[0]*r+i[4]*n+i[12],e[1]=i[1]*r+i[5]*n+i[13],e}function cA(e,t,i,r){let n=t[0]-i[0],a=t[1]-i[1],s=Math.sin(r),o=Math.cos(r);return e[0]=n*o-a*s+i[0],e[1]=n*s+a*o+i[1],e}function cI(e,t){let i=e[0],r=e[1],n=t[0],a=t[1],s=Math.sqrt((i*i+r*r)*(n*n+a*a));return Math.acos(Math.min(Math.max(s&&(i*n+r*a)/s,-1),1))}function cL(e){return e[0]=0,e[1]=0,e}function cD(e){return`vec2(${e[0]}, ${e[1]})`}function cO(e,t){return e[0]===t[0]&&e[1]===t[1]}function cR(e,t){let i=e[0],r=e[1],n=t[0],a=t[1];return Math.abs(i-n)<=1e-6*Math.max(1,Math.abs(i),Math.abs(n))&&Math.abs(r-a)<=1e-6*Math.max(1,Math.abs(r),Math.abs(a))}let cN=(c=l7(),function(e,t,i,r,n,a){let s,o;for(t||(t=2),i||(i=0),o=r?Math.min(r*t+i,e.length):e.length,s=i;s<o;s+=t)c[0]=e[s],c[1]=e[s+1],n(c,c,a),e[s]=c[0],e[s+1]=c[1];return e});e.s(["add",()=>cn,"angle",()=>cI,"ceil",()=>cl,"clone",()=>ce,"copy",()=>ci,"create",()=>l7,"cross",()=>ck,"dist",0,cg,"distance",()=>cg,"div",0,co,"divide",()=>co,"dot",()=>cw,"equals",()=>cR,"exactEquals",()=>cO,"floor",()=>cc,"forEach",0,cN,"fromValues",()=>ct,"inverse",()=>cx,"len",0,cv,"length",()=>cv,"lerp",()=>cE,"max",()=>ch,"min",()=>cu,"mul",0,cs,"multiply",()=>cs,"negate",()=>cb,"normalize",()=>c_,"random",()=>cT,"rotate",()=>cA,"round",()=>cd,"scale",()=>cf,"scaleAndAdd",()=>cp,"set",()=>cr,"sqrDist",0,cm,"sqrLen",0,cy,"squaredDistance",()=>cm,"squaredLength",()=>cy,"str",()=>cD,"sub",0,ca,"subtract",()=>ca,"transformMat2",()=>cP,"transformMat2d",()=>cS,"transformMat3",()=>cM,"transformMat4",()=>cC,"zero",()=>cL],70105),(k7=Ed||(Ed={}))[k7.COL0ROW0=0]="COL0ROW0",k7[k7.COL0ROW1=1]="COL0ROW1",k7[k7.COL0ROW2=2]="COL0ROW2",k7[k7.COL0ROW3=3]="COL0ROW3",k7[k7.COL1ROW0=4]="COL1ROW0",k7[k7.COL1ROW1=5]="COL1ROW1",k7[k7.COL1ROW2=6]="COL1ROW2",k7[k7.COL1ROW3=7]="COL1ROW3",k7[k7.COL2ROW0=8]="COL2ROW0",k7[k7.COL2ROW1=9]="COL2ROW1",k7[k7.COL2ROW2=10]="COL2ROW2",k7[k7.COL2ROW3=11]="COL2ROW3",k7[k7.COL3ROW0=12]="COL3ROW0",k7[k7.COL3ROW1=13]="COL3ROW1",k7[k7.COL3ROW2=14]="COL3ROW2",k7[k7.COL3ROW3=15]="COL3ROW3";let cj=45*Math.PI/180,cB=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class cF extends l9{static get IDENTITY(){return n||Object.freeze(n=new cF),n}static get ZERO(){return r||Object.freeze(r=new cF([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0])),r}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return Ed}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),1==arguments.length&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,i,r,n,a,s,o,l,c,u,h,d,f,p,g){return this[0]=e,this[1]=t,this[2]=i,this[3]=r,this[4]=n,this[5]=a,this[6]=s,this[7]=o,this[8]=l,this[9]=c,this[10]=u,this[11]=h,this[12]=d,this[13]=f,this[14]=p,this[15]=g,this.check()}setRowMajor(e,t,i,r,n,a,s,o,l,c,u,h,d,f,p,g){return this[0]=e,this[1]=n,this[2]=l,this[3]=d,this[4]=t,this[5]=a,this[6]=c,this[7]=f,this[8]=i,this[9]=s,this[10]=u,this[11]=p,this[12]=r,this[13]=o,this[14]=h,this[15]=g,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(cB)}fromObject(e){return this.check()}fromQuaternion(e){return sf(this,e),this.check()}frustum(e){var t,i,r,n,a,s;let{left:o,right:l,bottom:c,top:u,near:h=.1,far:d=500}=e;return d===1/0?(t=this,i=o,r=l,n=c,a=u,s=h,t[0]=2*s/(r-i),t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*s/(a-n),t[6]=0,t[7]=0,t[8]=(r+i)/(r-i),t[9]=(a+n)/(a-n),t[10]=-1,t[11]=-1,t[12]=0,t[13]=0,t[14]=-2*s,t[15]=0):sp(this,o,l,c,u,h,d),this.check()}lookAt(e){let{eye:t,center:i=[0,0,0],up:r=[0,1,0]}=e;return sx(this,t,i,r),this.check()}ortho(e){let{left:t,right:i,bottom:r,top:n,near:a=.1,far:s=500}=e;return sy(this,t,i,r,n,a,s),this.check()}orthographic(e){let{fovy:t=cj,aspect:i=1,focalDistance:r=1,near:n=.1,far:a=500}=e;cz(t);let s=r*Math.tan(t/2),o=s*i;return this.ortho({left:-o,right:o,bottom:-s,top:s,near:n,far:a})}perspective(e){let{fovy:t=45*Math.PI/180,aspect:i=1,near:r=.1,far:n=500}=e;return cz(t),sg(this,t,i,r,n),this.check()}determinant(){return a1(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];let i=this.getScale(t),r=1/i[0],n=1/i[1],a=1/i[2];return e[0]=this[0]*r,e[1]=this[1]*n,e[2]=this[2]*a,e[3]=0,e[4]=this[4]*r,e[5]=this[5]*n,e[6]=this[6]*a,e[7]=0,e[8]=this[8]*r,e[9]=this[9]*n,e[10]=this[10]*a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];let i=this.getScale(t),r=1/i[0],n=1/i[1],a=1/i[2];return e[0]=this[0]*r,e[1]=this[1]*n,e[2]=this[2]*a,e[3]=this[4]*r,e[4]=this[5]*n,e[5]=this[6]*a,e[6]=this[8]*r,e[7]=this[9]*n,e[8]=this[10]*a,e}transpose(){return aJ(this,this),this.check()}invert(){return aQ(this,this),this.check()}multiplyLeft(e){return a2(this,e,this),this.check()}multiplyRight(e){return a2(this,this,e),this.check()}rotateX(e){return a6(this,this,e),this.check()}rotateY(e){return a8(this,this,e),this.check()}rotateZ(e){return a9(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return a5(this,this,e,t),this.check()}scale(e){return a4(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return a3(this,this,e),this.check()}transform(e,t){return 4===e.length?(lp(t=s4(t||[-0,-0,-0,-0],e,this),4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){let i,{length:r}=e;switch(r){case 2:i=cC(t||[-0,-0],e,this);break;case 3:i=lG(t||[-0,-0,-0],e,this);break;default:throw Error("Illegal vector")}return lp(i,e.length),i}transformAsVector(e,t){let i;switch(e.length){case 2:var r;let n,a,s;r=t||[-0,-0],n=e[0],a=e[1],s=this[3]*n+this[7]*a||1,r[0]=(this[0]*n+this[4]*a)/s,r[1]=(this[1]*n+this[5]*a)/s,i=r;break;case 3:i=l5(t||[-0,-0,-0],e,this);break;default:throw Error("Illegal vector")}return lp(i,e.length),i}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,i){return this.identity().translate([e,t,i])}}function cz(e){if(e>2*Math.PI)throw Error("expected radians")}var ot=ot;function cV(e,t){let i=ot.transformMat4([],t,e);return ot.scale(i,i,1/i[3]),i}function cU(e,t){let i=e%t;return i<0?t+i:i}function c$(e,t,i){return e<t?t:e>i?i:e}let cW=Math.log2||function(e){return Math.log(e)*Math.LOG2E};var sA=sA,cH=e.i(70105),cH=cH,cq=e.i(89522),cq=cq;function cG(e,t){if(!e)throw Error(t||"@math.gl/web-mercator: assertion failed.")}let cY=Math.PI,cX=cY/4,cK=cY/180,cZ=180/cY;function cJ(e){let[t,i]=e;cG(Number.isFinite(t)),cG(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude");let r=512*(cY+Math.log(Math.tan(cX+i*cK*.5)))/(2*cY);return[512*(t*cK+cY)/(2*cY),r]}function cQ(e){let[t,i]=e,r=2*(Math.atan(Math.exp(i/512*(2*cY)-cY))-cX);return[(t/512*(2*cY)-cY)*cZ,r*cZ]}function c0(e){return 512/4003e4/Math.cos(e*cK)}function c1(e){let{latitude:t,longitude:i,highPrecision:r=!1}=e;cG(Number.isFinite(t)&&Number.isFinite(i));let n=Math.cos(t*cK),a=512/360/n,s=512/4003e4/n,o={unitsPerMeter:[s,s,s],metersPerUnit:[1/s,1/s,1/s],unitsPerDegree:[512/360,a,s],degreesPerUnit:[1/(512/360),1/a,1/s]};if(r){let e=cK*Math.tan(t*cK)/n,i=512/4003e4*e,r=i/a*s;o.unitsPerDegree2=[0,512/360*e/2,i],o.unitsPerMeter2=[r,0,r]}return o}function c2(e,t){let[i,r,n]=e,[a,s,o]=t,{unitsPerMeter:l,unitsPerMeter2:c}=c1({longitude:i,latitude:r,highPrecision:!0}),u=cJ(e);u[0]+=a*(l[0]+c[0]*s),u[1]+=s*(l[1]+c[1]*s);let h=cQ(u);return Number.isFinite(n)||Number.isFinite(o)?[h[0],h[1],(n||0)+(o||0)]:h}function c3(e){return 2*Math.atan(.5/e)*cZ}function c4(e){return .5/Math.tan(.5*e*cK)}function c5(e,t){let[i,r,n=0]=e;return cG(Number.isFinite(i)&&Number.isFinite(r)&&Number.isFinite(n)),cV(t,[i,r,n,1])}function c6(e,t,i=0){let[r,n,a]=e;if(cG(Number.isFinite(r)&&Number.isFinite(n),"invalid pixel coordinate"),Number.isFinite(a))return cV(t,[r,n,a,1]);let s=cV(t,[r,n,0,1]),o=cV(t,[r,n,1,1]),l=s[2],c=o[2];return cH.lerp([],s,o,l===c?0:((i||0)-l)/(c-l))}var cH=cH;let c8=Math.PI/180;function c9(e,t,i){let{pixelUnprojectionMatrix:r}=e,n=cV(r,[t,0,1,1]),a=cV(r,[t,e.height,1,1]),s=(i*e.distanceScales.unitsPerMeter[2]-n[2])/(a[2]-n[2]),o=cQ(cH.lerp([],n,a,s));return o.push(i),o}var sA=sA,cH=cH,cq=cq,cH=cH;let c7=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,ue=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,ut=`
${c7}
${ue}
`,ui=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,ur=`
${c7}
${ui}
`,un=oJ(function({viewport:e,center:t}){return new cF(e.viewProjectionMatrix).invert().transform(t)}),ua=oJ(function({viewport:e,shadowMatrices:t}){let i=[],r=e.pixelUnprojectionMatrix,n=e.isGeospatial?void 0:1,a=[[0,0,n],[e.width,0,n],[0,e.height,n],[e.width,e.height,n],[0,0,-1],[e.width,0,-1],[0,e.height,-1],[e.width,e.height,-1]].map(e=>(function(e,t){let[i,r,n]=e,a=c6([i,r,n],t);return Number.isFinite(n)?a:[a[0],a[1],0]})(e,r));for(let r of t){let t=r.clone().translate(new l8(e.center).negate()),n=a.map(e=>t.transform(e)),s=new cF().ortho({left:Math.min(...n.map(e=>e[0])),right:Math.max(...n.map(e=>e[0])),bottom:Math.min(...n.map(e=>e[1])),top:Math.max(...n.map(e=>e[1])),near:Math.min(...n.map(e=>-e[2])),far:Math.max(...n.map(e=>-e[2]))});i.push(s.multiplyRight(r))}return i}),us=[0,0,0,1],uo=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],ul={name:"shadow",dependencies:[la],vs:ut,fs:ur,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:function(e){let{shadowEnabled:t=!0,project:i}=e;if(!t||!i||!e.shadowMatrices||!e.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:e.dummyShadowMap,shadow_uShadowMap1:e.dummyShadowMap};let r=la.getUniforms(i),n=un({viewport:i.viewport,center:r.center}),a=[],s=ua({shadowMatrices:e.shadowMatrices,viewport:i.viewport}).slice();for(let t=0;t<e.shadowMatrices.length;t++){let e=s[t],o=e.clone().translate(new l8(i.viewport.center).negate());r.coordinateSystem===oG.LNGLAT&&r.projectionMode===oY.WEB_MERCATOR?(s[t]=o,a[t]=n):(s[t]=e.clone().multiplyRight(uo),a[t]=o.transform(n))}let o={drawShadowMap:!!e.drawToShadowMap,useShadowMap:!!e.shadowMaps&&e.shadowMaps.length>0,color:e.shadowColor||us,lightId:e.shadowLightId||0,lightCount:e.shadowMatrices.length,shadow_uShadowMap0:e.dummyShadowMap,shadow_uShadowMap1:e.dummyShadowMap};for(let e=0;e<s.length;e++)o[`viewProjectionMatrix${e}`]=s[e],o[`projectCenter${e}`]=a[e];for(let t=0;t<2;t++)o[`shadow_uShadowMap${t}`]=e.shadowMaps&&e.shadowMaps[t]||e.dummyShadowMap;return o},uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},uc={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:[0,1,1,1]},vs:`\
uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,fs:`\
uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,getUniforms:function(e={},t){let i={};if(void 0===e.highlightedObjectColor||(null===e.highlightedObjectColor?i.isHighlightActive=!1:(i.isHighlightActive=!0,i.highlightedObjectColor=e.highlightedObjectColor.slice(0,3))),e.highlightColor){let t=Array.from(e.highlightColor,e=>e/255);Number.isFinite(t[3])||(t[3]=1),i.highlightColor=t}return void 0!==e.isActive&&(i.isActive=!!e.isActive,i.isAttribute=!!e.isAttribute),void 0!==e.useFloatColors&&(i.useFloatColors=!!e.useFloatColors),i}},uu={...uc,defaultUniforms:{...uc.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},uh=[aV],ud=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],uf=[],up=Symbol.for("component"),ug=Symbol.for("propTypes"),um=Symbol.for("deprecatedProps"),uv=Symbol.for("asyncPropDefaults"),uy=Symbol.for("asyncPropOriginal"),ub=Symbol.for("asyncPropResolved");var ux=e.i(53593);let u_={};function uw(e){u_=e}function uk(e,t,i,r){or.level>0&&u_[e]&&u_[e].call(null,t,i,r)}function uE(e,t=()=>!0){return Array.isArray(e)?function e(t,i,r){let n=-1;for(;++n<t.length;){let a=t[n];Array.isArray(a)?e(a,i,r):i(a)&&r.push(a)}return r}(e,t,[]):t(e)?[e]:[]}e.i(97894);var uT=e.i(45261);let uP=e=>null!==e&&"object"==typeof e,uS=e=>uP(e)&&e.constructor===({}).constructor,uM=e=>"undefined"!=typeof Response&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json,uC=e=>"undefined"!=typeof Blob&&e instanceof Blob,uA=e=>{let t,i;return t=e,"undefined"!=typeof ReadableStream&&t instanceof ReadableStream||uP(t)&&"function"==typeof t.tee&&"function"==typeof t.cancel&&"function"==typeof t.getReader||uP(i=e)&&"function"==typeof i.read&&"function"==typeof i.pipe&&"boolean"==typeof i.readable};function uI(e,t){if(!e)throw Error(t||"loader assertion failed.")}function uL(e){return!!e&&(Array.isArray(e)&&(e=e[0]),Array.isArray(e?.extensions))}function uD(e){let t;return uI(e,"null loader"),uI(uL(e),"invalid loader"),Array.isArray(e)&&(t=e[1],e={...e=e[0],options:{...e.options,...t}}),(e?.parseTextSync||e?.parseText)&&(e.text=!0),e.text||(e.binary=!0),e}let uO={};class uR extends Error{constructor(e,t){super(e),this.reason=t.reason,this.url=t.url,this.response=t.response}reason;url;response}let uN=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,uj=/^([-\w.]+\/[-\w.+]+)/;function uB(e,t){return e.toLowerCase()===t.toLowerCase()}function uF(e){let t=uN.exec(e);return t?t[1]:""}let uz=/\?.*/;function uV(e){return e.replace(uz,"")}function uU(e){return uM(e)?e.url:uC(e)?e.name||"":"string"==typeof e?e:""}function u$(e){if(uM(e)){let t,i=e.headers.get("content-type")||"",r=uV(e.url);return((t=uj.exec(i))?t[1]:i)||uF(r)}return uC(e)?e.type||"":"string"==typeof e?uF(e):""}async function uW(e){var t;if(uM(e))return e;let i={},r=uM(t=e)?t.headers["content-length"]||-1:uC(t)?t.size:"string"==typeof t?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1;r>=0&&(i["content-length"]=String(r));let n=uU(e),a=u$(e);a&&(i["content-type"]=a);let s=await uG(e);s&&(i["x-first-bytes"]=s),"string"==typeof e&&(e=new TextEncoder().encode(e));let o=new Response(e,{headers:i});return Object.defineProperty(o,"url",{value:n}),o}async function uH(e){if(!e.ok)throw await uq(e)}async function uq(e){let t=function(e){if(e.length<50)return e;let t=e.slice(e.length-15),i=e.substr(0,32);return`${i}...${t}`}(e.url),i=`Failed to fetch resource (${e.status}) ${e.statusText}: ${t}`;i=i.length>100?`${i.slice(0,100)}...`:i;let r={reason:e.statusText,url:e.url,response:e};try{let t=e.headers.get("Content-Type");r.reason=!e.bodyUsed&&t?.includes("application/json")?await e.json():await e.text()}catch(e){}return new uR(i,r)}async function uG(e){if("string"==typeof e)return`data:,${e.slice(0,5)}`;if(e instanceof Blob){let t=e.slice(0,5);return await new Promise(e=>{let i=new FileReader;i.onload=t=>e(t?.target?.result),i.readAsDataURL(t)})}if(e instanceof ArrayBuffer){let t=function(e){let t="",i=new Uint8Array(e);for(let e=0;e<i.byteLength;e++)t+=String.fromCharCode(i[e]);return btoa(t)}(e.slice(0,5));return`data:base64,${t}`}return null}async function uY(e,t){if("string"==typeof e){var i;let r=function(e){for(let t in uO)if(e.startsWith(t)){let i=uO[t];e=e.replace(t,i)}return e.startsWith("http://")||e.startsWith("https://")||(e=`${e}`),e}(e);return!((i=r).startsWith("http:")||i.startsWith("https:"))&&!r.startsWith("data:")&&globalThis.loaders?.fetchNode?globalThis.loaders?.fetchNode(r,t):await fetch(r,t)}return await uW(e)}let uX="4.3.3",uK=uX[0]>="0"&&uX[0]<="9"?`v${uX}`:"",uZ=(u=new oi.Log({id:"loaders.gl"}),globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=u,globalThis.loaders.version=uK,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=u,u),uJ=new oi.Log({id:"loaders.gl"});class uQ{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}let u0={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:e.g,document:"undefined"!=typeof document&&document};u0.self||u0.window||u0.global,u0.window||u0.self||u0.global,u0.global||u0.self||u0.window,u0.document;let u1=("object"!=typeof ux.default||"[object process]"!==String(ux.default),!0),u2=void 0!==ux.default&&ux.default.version&&/v([0-9]*)/.exec(ux.default.version);u2&&parseFloat(u2[1]);let u3={fetch:null,mimeType:void 0,nothrow:!1,log:new class{console;constructor(){this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}},useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:u1,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},u4={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function u5(){globalThis.loaders=globalThis.loaders||{};let{loaders:e}=globalThis;return e._state||(e._state={}),e._state}function u6(){let e=u5();return e.globalOptions=e.globalOptions||{...u3},e.globalOptions}function u8(e,t,i,r,n){let a=t||"Top level",s=t?`${t}.`:"";for(let o in e){let l=!t&&uP(e[o]),c="baseUri"===o&&!t,u="workerUrl"===o&&t;if(!(o in i)&&!c&&!u){if(o in r)uJ.warn(`${a} loader option '${s}${o}' no longer supported, use '${r[o]}'`)();else if(!l){let e=function(e,t){let i=e.toLowerCase(),r="";for(let n of t)for(let t in n.options){if(e===t)return`Did you mean '${n.id}.${t}'?`;let a=t.toLowerCase();(i.startsWith(a)||a.startsWith(i))&&(r=r||`Did you mean '${n.id}.${t}'?`)}return r}(o,n);uJ.warn(`${a} loader option '${s}${o}' not recognized. ${e}`)()}}}}function u9(e,t){for(let i in t)i in t&&(uS(t[i])&&uS(e[i])?e[i]={...e[i],...t[i]}:e[i]=t[i])}function u7(e,t){let i=u6(),r=e||i;return"function"==typeof r.fetch?r.fetch:uP(r.fetch)?e=>uY(e,r.fetch):t?.fetch?t?.fetch:uY}let he={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:e.g,document:"undefined"!=typeof document&&document};he.self||he.window||he.global,he.window||he.self||he.global,he.global||he.self||he.window,he.document;let ht="object"!=typeof ux.default||"[object process]"!==String(ux.default)||!0,hi="undefined"!=typeof window&&void 0!==window.orientation,hr=void 0!==ux.default&&ux.default.version&&/v([0-9]*)/.exec(ux.default.version);hr&&parseFloat(hr[1]);class hn{terminate(){}}function ha(e,t){if(!e)throw Error(t||"loaders.gl assertion failed.")}let hs=new Map;function ho(e){let t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}function hl(e){return!!e&&!!(e instanceof ArrayBuffer||"undefined"!=typeof MessagePort&&e instanceof MessagePort||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas)}let hc=()=>{};class hu{name;source;url;terminated=!1;worker;onMessage;onError;_loadableURL="";static isSupported(){return"undefined"!=typeof Worker&&ht||!ht}constructor(e){const{name:t,source:i,url:r}=e;ha(i||r),this.name=t,this.source=i,this.url=r,this.onMessage=hc,this.onError=e=>console.log(e),this.worker=ht?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=hc,this.onError=hc,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,t){t=t||function e(t,i=!0,r){let n=r||new Set;if(t){if(hl(t))n.add(t);else if(hl(t.buffer))n.add(t.buffer);else if(ArrayBuffer.isView(t));else if(i&&"object"==typeof t)for(let r in t)e(t[r],i,n)}return void 0===r?Array.from(n):[]}(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+=`worker ${this.name} from ${this.url}. `,e.message&&(t+=`${e.message} in `),e.lineno&&(t+=`:${e.lineno}:${e.colno}`),Error(t)}_createBrowserWorker(){var e,t,i;let r;this._loadableURL=(ha((e={source:this.source,url:this.url}).source&&!e.url||!e.source&&e.url),(r=hs.get(e.source||e.url))||(e.url&&(r=(t=e.url).startsWith("http")?ho((i=t,`\
try {
  importScripts('${i}');
} catch (error) {
  console.error(error);
  throw error;
}`)):t,hs.set(e.url,r)),e.source&&(r=ho(e.source),hs.set(e.source,r))),ha(r),r);let n=new Worker(this._loadableURL,{name:this.name});return n.onmessage=e=>{e.data?this.onMessage(e.data):this.onError(Error("No data received"))},n.onerror=e=>{this.onError(this._getErrorFromErrorEvent(e)),this.terminated=!0},n.onmessageerror=e=>console.error(e),n}_createNodeWorker(){let e;if(this.url)e=new hn(this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`,{eval:!1});else if(this.source)e=new hn(this.source,{eval:!0});else throw Error("no worker");return e.on("message",e=>{this.onMessage(e)}),e.on("error",e=>{this.onError(e)}),e.on("exit",e=>{}),e}}class hh{name;workerThread;isRunning=!0;result;_resolve=()=>{};_reject=()=>{};constructor(e,t){this.name=e,this.workerThread=t,this.result=new Promise((e,t)=>{this._resolve=e,this._reject=t})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){ha(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){ha(this.isRunning),this.isRunning=!1,this._reject(e)}}class hd{name="unnamed";source;url;maxConcurrency=1;maxMobileConcurrency=1;onDebug=()=>{};reuseWorkers=!0;props={};jobQueue=[];idleQueue=[];count=0;isDestroyed=!1;static isSupported(){return hu.isSupported()}constructor(e){this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},void 0!==e.name&&(this.name=e.name),void 0!==e.maxConcurrency&&(this.maxConcurrency=e.maxConcurrency),void 0!==e.maxMobileConcurrency&&(this.maxMobileConcurrency=e.maxMobileConcurrency),void 0!==e.reuseWorkers&&(this.reuseWorkers=e.reuseWorkers),void 0!==e.onDebug&&(this.onDebug=e.onDebug)}async startJob(e,t=(e,t,i)=>e.done(i),i=(e,t)=>e.error(t)){let r=new Promise(r=>(this.jobQueue.push({name:e,onMessage:t,onError:i,onStart:r}),this));return this._startQueuedJob(),await r}async _startQueuedJob(){if(!this.jobQueue.length)return;let e=this._getAvailableWorker();if(!e)return;let t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});let i=new hh(t.name,e);e.onMessage=e=>t.onMessage(i,e.type,e.payload),e.onError=e=>t.onError(i,e),t.onStart(i);try{await i.result}catch(e){console.error(`Worker exception: ${e}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!ht||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){return this.idleQueue.length>0?this.idleQueue.shift()||null:this.count<this._getMaxConcurrency()?(this.count++,new hu({name:`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`,source:this.source,url:this.url})):null}_getMaxConcurrency(){return hi?this.maxMobileConcurrency:this.maxConcurrency}}let hf={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class hp{props;workerPools=new Map;static _workerFarm;static isSupported(){return hu.isSupported()}static getWorkerFarm(e={}){return hp._workerFarm=hp._workerFarm||new hp({}),hp._workerFarm.setProps(e),hp._workerFarm}constructor(e){this.props={...hf},this.setProps(e),this.workerPools=new Map}destroy(){for(let e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){for(let t of(this.props={...this.props,...e},this.workerPools.values()))t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){let{name:t,source:i,url:r}=e,n=this.workerPools.get(t);return n||((n=new hd({name:t,source:i,url:r})).setProps(this._getWorkerPoolProps()),this.workerPools.set(t,n)),n}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}let hg=(globalThis._loadersgl_?.version||(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.3"),globalThis._loadersgl_.version);async function hm(e,t,i,r,n){let a=e.id,s=function(e,t={}){let i=t[e.id]||{},r=ht?`${e.id}-worker.js`:`${e.id}-worker-node.js`,n=i.workerUrl;if(n||"compression"!==e.id||(n=t.workerUrl),"test"===t._workerType&&(n=ht?`modules/${e.module}/dist/${r}`:`modules/${e.module}/src/workers/${e.id}-worker-node.ts`),!n){let t=e.version;"latest"===t&&(t="latest");let i=t?`@${t}`:"";n=`https://unpkg.com/@loaders.gl/${e.module}${i}/dist/${r}`}return ha(n),n}(e,i),o=hp.getWorkerFarm(i).getWorkerPool({name:a,url:s});i=JSON.parse(JSON.stringify(i)),r=JSON.parse(JSON.stringify(r||{}));let l=await o.startJob("process-on-worker",hv.bind(null,n));l.postMessage("process",{input:t,options:i,context:r});let c=await l.result;return await c.result}async function hv(e,t,i,r){switch(i){case"done":t.done(r);break;case"error":t.error(Error(r.error));break;case"process":let{id:n,input:a,options:s}=r;try{let i=await e(a,s);t.postMessage("done",{id:n,result:i})}catch(i){let e=i instanceof Error?i.message:"unknown error";t.postMessage("error",{id:n,error:e})}break;default:console.warn(`parse-with-worker unknown message ${i}`)}}async function hy(e){let t=[];for await(let i of e)t.push(i);return function(...e){var t=e;let i=t.map(e=>e instanceof ArrayBuffer?new Uint8Array(e):e),r=new Uint8Array(i.reduce((e,t)=>e+t.byteLength,0)),n=0;for(let e of i)r.set(e,n),n+=e.byteLength;return r.buffer}(...t)}async function*hb(e,t){let i=t?.chunkSize||1048576,r=0;for(;r<e.size;){let t=r+i,n=await e.slice(r,t).arrayBuffer();r=t,yield n}}function hx(e){if(e&&"object"==typeof e&&e.isBuffer||e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return 0===e.byteOffset&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if("string"==typeof e)return new TextEncoder().encode(e).buffer;if(e&&"object"==typeof e&&e._toArrayBuffer)return e._toArrayBuffer();throw Error("toArrayBuffer")}function h_(e,t){return u1?hw(e,t):hk(e,t)}async function*hw(e,t){let i,r=e.getReader();try{for(;;){let e=i||r.read();t?._streamReadAhead&&(i=r.read());let{done:n,value:a}=await e;if(n)return;yield hx(a)}}catch(e){r.releaseLock()}}async function*hk(e,t){for await(let t of e)yield hx(t)}let hE="Cannot convert supplied data type";async function hT(e,t,i){let r,n,a=e instanceof ArrayBuffer||ArrayBuffer.isView(e);if("string"==typeof e||a){let i;var s=e;if(t.text&&"string"==typeof s)return s;if((i=s)&&"object"==typeof i&&i.isBuffer&&(s=s.buffer),s instanceof ArrayBuffer){let e=s;return t.text&&!t.binary?new TextDecoder("utf8").decode(e):e}if(ArrayBuffer.isView(s)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(s);let e=s.buffer,i=s.byteLength||s.length;return(0!==s.byteOffset||i!==e.byteLength)&&(e=e.slice(s.byteOffset,s.byteOffset+i)),e}throw Error(hE)}if(uC(e)&&(e=await uW(e)),uM(e)){let i=e;return await uH(i),t.binary?await i.arrayBuffer():await i.text()}if(uA(e)&&(e=function(e,t){if("string"==typeof e)return function*(e,t){let i=t?.chunkSize||262144,r=0,n=new TextEncoder;for(;r<e.length;){let t=Math.min(e.length-r,i),a=e.slice(r,r+t);r+=t,yield n.encode(a)}}(e,t);if(e instanceof ArrayBuffer)return function*(e,t={}){let{chunkSize:i=262144}=t,r=0;for(;r<e.byteLength;){let t=Math.min(e.byteLength-r,i),n=new ArrayBuffer(t),a=new Uint8Array(e,r,t);new Uint8Array(n).set(a),r+=t,yield n}}(e,t);if(uC(e))return hb(e,t);if(uA(e))return h_(e,t);if(uM(e))return h_(e.body,t);throw Error("makeIterator")}(e,i)),(r=e)&&"function"==typeof r[Symbol.iterator]||(n=e)&&"function"==typeof n[Symbol.asyncIterator])return hy(e);throw Error(hE)}function hP(e){let t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(t+1):""}function hS(e){let t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(0,t):""}function hM(...e){return(e=e.map((t,i)=>(i&&(t=t.replace(RegExp("^/"),"")),i!==e.length-1&&(t=t.replace(RegExp("/$"),"")),t))).join("/")}function hC(...e){let t,i=[];for(let t=0;t<e.length;t++)i[t]=e[t];let r="",n=!1;for(let e=i.length-1;e>=-1&&!n;e--){let a;e>=0?a=i[e]:(void 0===t&&(t=function(){if(void 0!==ux.default&&void 0!==ux.default.cwd)return ux.default.cwd();let e=window.location?.pathname;return e?.slice(0,e.lastIndexOf("/")+1)||""}()),a=t),0!==a.length&&(r=`${a}/${r}`,n=a.charCodeAt(0)===hA)}return(r=function(e,t){let i,r="",n=-1,a=0,s=!1;for(let o=0;o<=e.length;++o){if(o<e.length)i=e.charCodeAt(o);else if(i===hA)break;else i=hA;if(i===hA){if(n===o-1||1===a);else if(n!==o-1&&2===a){if(r.length<2||!s||46!==r.charCodeAt(r.length-1)||46!==r.charCodeAt(r.length-2)){if(r.length>2){let e=r.length-1,t=e;for(;t>=0&&r.charCodeAt(t)!==hA;--t);if(t!==e){r=-1===t?"":r.slice(0,t),n=o,a=0,s=!1;continue}}else if(2===r.length||1===r.length){r="",n=o,a=0,s=!1;continue}}t&&(r.length>0?r+="/..":r="..",s=!0)}else{let t=e.slice(n+1,o);r.length>0?r+=`/${t}`:r=t,s=!1}n=o,a=0}else 46===i&&-1!==a?++a:a=-1}return r}(r,!n),n)?`/${r}`:r.length>0?r:"."}let hA=47;e.s(["dirname",()=>hS,"filename",()=>hP,"join",()=>hM,"resolve",()=>hC],9731);var hI=e.i(9731),hI=hI,hI=hI;let hL=()=>{let e=u5();return e.loaderRegistry=e.loaderRegistry||[],e.loaderRegistry},hD=/\.([^.]+)$/;async function hO(e,t=[],i,r){if(!hN(e))return null;let n=hR(e,t,{...i,nothrow:!0},r);if(n)return n;if(uC(e)&&(n=hR(e=await e.slice(0,10).arrayBuffer(),t,i,r)),!n&&!i?.nothrow)throw Error(hj(e));return n}function hR(e,t=[],i,r){var n,a,s,o,l,c;let u,h,d,f,p,g,v;if(!hN(e))return null;if(t&&!Array.isArray(t))return uD(t);let y=[];t&&(y=y.concat(t)),i?.ignoreRegisteredLoaders||y.push(...hL()),function(e){for(let t of e)uD(t)}(y);let b=(n=e,a=y,s=i,o=r,u=uU(n),h=u$(n),d=uV(u)||o?.url,f=null,p="",s?.mimeType&&(f=hB(a,s?.mimeType),p=`match forced by supplied MIME type ${s?.mimeType}`),f=f||(l=a,(v=(g=(c=d)&&hD.exec(c))&&g[1])?function(e,t){for(let i of(t=t.toLowerCase(),e))for(let e of i.extensions)if(e.toLowerCase()===t)return i;return null}(l,v):null),p=p||(f?`matched url ${d}`:""),f=f||hB(a,h),p=p||(f?`matched MIME type ${h}`:""),f=f||function(e,t){if(!t)return null;for(let i of e)if("string"==typeof t){if(function(e,t){return t.testText?t.testText(e):(Array.isArray(t.tests)?t.tests:[t.tests]).some(t=>e.startsWith(t))}(t,i))return i}else if(ArrayBuffer.isView(t)){if(hF(t.buffer,t.byteOffset,i))return i}else if(t instanceof ArrayBuffer&&hF(t,0,i))return i;return null}(a,n),p=p||(f?`matched initial data ${hz(n)}`:""),s?.fallbackMimeType&&(f=f||hB(a,s?.fallbackMimeType),p=p||(f?`matched fallback MIME type ${h}`:"")),p&&uZ.log(1,`selectLoader selected ${f?.name}: ${p}.`),f);if(!b&&!i?.nothrow)throw Error(hj(e));return b}function hN(e){return!(e instanceof Response)||204!==e.status}function hj(e){let t=uU(e),i=u$(e),r="No valid loader found (";r+=(t?`${hI.filename(t)}, `:"no url provided, ")+`MIME type: ${i?`"${i}"`:"not provided"}, `;let n=e?hz(e):"";return r+((n?` first bytes: "${n}"`:"first bytes: not available")+")")}function hB(e,t){for(let i of e)if(i.mimeTypes?.some(e=>uB(t,e))||uB(t,`application/x.${i.id}`))return i;return null}function hF(e,t,i){return(Array.isArray(i.tests)?i.tests:[i.tests]).some(i=>(function(e,t,i,r){if(r instanceof ArrayBuffer)return function(e,t,i){if(i=i||e.byteLength,e.byteLength<i||t.byteLength<i)return!1;let r=new Uint8Array(e),n=new Uint8Array(t);for(let e=0;e<r.length;++e)if(r[e]!==n[e])return!1;return!0}(r,e,r.byteLength);switch(typeof r){case"function":return r(e);case"string":let n=hV(e,t,r.length);return r===n;default:return!1}})(e,t,0,i))}function hz(e,t=5){return"string"==typeof e?e.slice(0,t):ArrayBuffer.isView(e)?hV(e.buffer,e.byteOffset,t):e instanceof ArrayBuffer?hV(e,0,t):""}function hV(e,t,i){if(e.byteLength<t+i)return"";let r=new DataView(e),n="";for(let e=0;e<i;e++)n+=String.fromCharCode(r.getUint8(t+e));return n}async function hU(e,t,i,r){var n,a,s,o,l,c,u;let h;!t||Array.isArray(t)||uL(t)||(r=void 0,i=t,t=void 0),e=await e,i=i||{};let d=uU(e),f=function(e,t){let i;if(e&&!Array.isArray(e))return e;if(e&&(i=Array.isArray(e)?e:[e]),t&&t.loaders){let e=Array.isArray(t.loaders)?t.loaders:[t.loaders];i=i?[...i,...e]:e}return i&&i.length?i:void 0}(t,r),p=await hO(e,f,i);if(!p)return null;return function(e,t){for(let i of(u8(e,null,u3,u4,t),t)){let r=e&&e[i.id]||{},n=i.options&&i.options[i.id]||{},a=i.deprecatedOptions&&i.deprecatedOptions[i.id]||{};u8(r,i.id,n,a,t)}}(n=i,a=Array.isArray(a=(a=f)||[])?a:[a]),r=function(e,t,i){if(i)return i;let r={fetch:u7(t,e),...e};if(r.url){let e,t=uV(r.url);r.baseUrl=t,e=r.url.match(uz),r.queryString=e&&e[0],r.filename=hI.filename(t),r.baseUrl=hI.dirname(t)}return Array.isArray(r.loaders)||(r.loaders=null),r}({url:d,_parse:hU,loaders:f},(s=p,o=n,l=d,c=h={...s.options||{}},!(u=l)||"baseUri"in c||(c.baseUri=u),null===h.log&&(h.log=new uQ),u9(h,u6()),u9(h,o),i=h),r||null),await h$(p,e,i,r)}async function h$(e,t,i,r){var n;if(!function(e,t=hg){ha(e,"no worker provided");e.version}(e),i=function e(t,i,r=0){if(r>3)return i;let n={...t};for(let[t,a]of Object.entries(i))a&&"object"==typeof a&&!Array.isArray(a)?n[t]=e(n[t]||{},i[t],r+1):n[t]=i[t];return n}(e.options||{},i),uM(t)){let e=t,{ok:i,redirected:n,status:a,statusText:s,type:o,url:l}=e;r.response={headers:Object.fromEntries(e.headers.entries()),ok:i,redirected:n,status:a,statusText:s,type:o,url:l}}if(t=await hT(t,e,i),e.parseTextSync&&"string"==typeof t)return e.parseTextSync(t,i,r);if(n=i,hp.isSupported()&&(ht||n?._nodeWorkers)&&e.worker&&n?.worker)return await hm(e,t,i,r,hU);if(e.parseText&&"string"==typeof t)return await e.parseText(t,i,r);if(e.parse)return await e.parse(t,i,r);throw ha(!e.parseSync),Error(`${e.id} loader - no parser found and worker is disabled`)}async function hW(e,t,i,r){let n,a;Array.isArray(t)||uL(t)?(n=t,a=i):(n=[],a=t);let s=u7(a),o=e;return"string"==typeof e&&(o=await s(e)),uC(e)&&(o=await s(e)),Array.isArray(n),await hU(o,n,a)}class hH{constructor(e,t,i){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=i,this.setData(t)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,t){if(e===this._data&&!t)return;this._data=e;let i=++this._loadCount,r=e;for(let t of("string"==typeof e&&(r=hW(e)),r instanceof Promise?(this.isLoaded=!1,this._loader=r.then(e=>{this._loadCount===i&&(this.isLoaded=!0,this._error=void 0,this._content=e)}).catch(e=>{this._loadCount===i&&(this.isLoaded=!0,this._error=e||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e),this._subscribers))t.onChange(this.getData())}}class hq{constructor(e){this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:e.device?.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return!!e.startsWith(this.protocol)||e in this._resources}add({resourceId:e,data:t,forceUpdate:i=!1,persistent:r=!0}){let n=this._resources[e];n?n.setData(t,i):(n=new hH(e,t,this._context),this._resources[e]=n),n.persistent=r}remove(e){let t=this._resources[e];t&&(t.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){let t=this._consumers[e];if(t){for(let e in t){let i=t[e],r=this._resources[i.resourceId];r&&r.unsubscribe(i)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:t,consumerId:i,requestId:r="default"}){let{_resources:n,protocol:a}=this;e.startsWith(a)&&(n[e=e.replace(a,"")]||this.add({resourceId:e,data:null,persistent:!1}));let s=n[e];if(this._track(i,r,s,t),s)return s.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(let e in this._resources)this._resources[e].delete()}_track(e,t,i,r){let n=this._consumers,a=n[e]=n[e]||{},s=a[t],o=s&&s.resourceId&&this._resources[s.resourceId];o&&(o.unsubscribe(s),this.prune()),i&&(s?(s.onChange=r,s.resourceId=i.id):s={onChange:r,resourceId:i.id},a[t]=s,i.subscribe(s))}_prune(){for(let e of(this._pruneRequest=null,Object.keys(this._resources))){let t=this._resources[e];t.persistent||t.inUse()||(t.delete(),delete this._resources[e])}}}let hG=new class{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,t,{size:i=1,type:r,padding:n=0,copy:a=!1,initialize:s=!1,maxCount:o}){let l=r||e&&e.constructor||Float32Array,c=t*i+n;if(ArrayBuffer.isView(e)){if(c<=e.length)return e;if(c*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new l(e.buffer,0,c)}let u=1/0;o&&(u=o*i+n);let h=this._allocate(l,c,s,u);return e&&a?h.set(e):s||h.fill(0,0,4),this._release(e),h}release(e){this._release(e)}_allocate(e,t,i,r){let n=Math.max(Math.ceil(t*this.opts.overAlloc),1);n>r&&(n=r);let a=this._pool,s=e.BYTES_PER_ELEMENT*n,o=a.findIndex(e=>e.byteLength>=s);if(o>=0){let t=new e(a.splice(o,1)[0],0,n);return i&&t.fill(0),t}return new e(n)}_release(e){if(!ArrayBuffer.isView(e))return;let t=this._pool,{buffer:i}=e,{byteLength:r}=i,n=t.findIndex(e=>e.byteLength>=r);n<0?t.push(i):(n>0||t.length<this.opts.poolSize)&&t.splice(n,0,i),t.length>this.opts.poolSize&&t.shift()}};function hY(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}let hX=new l8;function hK(e,t,i,r){hX.set(e,t,i);let n=hX.len();return{distance:r/n,normal:new l8(-e/n,-t/n,-i/n)}}function hZ(e,t){let{size:i=1,startIndex:r=0}=t,n=void 0!==t.endIndex?t.endIndex:e.length,s=(n-r)/i;a=hG.allocate(a,s,{type:Float32Array,size:2*i});let o=r,l=0;for(;o<n;){for(let t=0;t<i;t++){let r=e[o++];a[l+t]=r,a[l+t+i]=r-Math.fround(r)}l+=2*i}return a.subarray(0,s*i*2)}function hJ(e){let t=null,i=!1;for(let r of e)r&&(t?(i||(t=[[t[0][0],t[0][1]],[t[1][0],t[1][1]]],i=!0),t[0][0]=Math.min(t[0][0],r[0][0]),t[0][1]=Math.min(t[0][1],r[0][1]),t[1][0]=Math.max(t[1][0],r[1][0]),t[1][1]=Math.max(t[1][1],r[1][1])):t=r);return t}var sA=sA;let hQ=Math.PI/180,h0=hY(),h1=[0,0,0],h2={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};class h3{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||h2,this.focalDistance=e.focalDistance||1,this.position=e.position||h1,this.modelMatrix=e.modelMatrix||null;const{longitude:t,latitude:i}=e;this.isGeospatial=Number.isFinite(i)&&Number.isFinite(t),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?oY.WEB_MERCATOR:oY.WEB_MERCATOR_AUTO_OFFSET:oY.IDENTITY}equals(e){return e instanceof h3&&(this===e||e.width===this.width&&e.height===this.height&&e.scale===this.scale&&lh(e.projectionMatrix,this.projectionMatrix)&&lh(e.viewMatrix,this.viewMatrix))}project(e,{topLeft:t=!0}={}){let i=c5(this.projectPosition(e),this.pixelProjectionMatrix),[r,n]=i,a=t?n:this.height-n;return 2===e.length?[r,a]:[r,a,i[2]]}unproject(e,{topLeft:t=!0,targetZ:i}={}){let[r,n,a]=e,s=t?n:this.height-n,o=i&&i*this.distanceScales.unitsPerMeter[2],l=c6([r,s,a],this.pixelUnprojectionMatrix,o),[c,u,h]=this.unprojectPosition(l);return Number.isFinite(a)?[c,u,h]:Number.isFinite(i)?[c,u,i]:[c,u]}projectPosition(e){let[t,i]=this.projectFlat(e);return[t,i,(e[2]||0)*this.distanceScales.unitsPerMeter[2]]}unprojectPosition(e){let[t,i]=this.unprojectFlat(e);return[t,i,(e[2]||0)*this.distanceScales.metersPerUnit[2]]}projectFlat(e){if(this.isGeospatial){let t=cJ(e);return t[1]=lc(t[1],-318,830),t}return e}unprojectFlat(e){return this.isGeospatial?cQ(e):e}getBounds(e={}){let t={targetZ:e.z||0},i=this.unproject([0,0],t),r=this.unproject([this.width,0],t),n=this.unproject([0,this.height],t),a=this.unproject([this.width,this.height],t);return[Math.min(i[0],r[0],n[0],a[0]),Math.min(i[1],r[1],n[1],a[1]),Math.max(i[0],r[0],n[0],a[0]),Math.max(i[1],r[1],n[1],a[1])]}getDistanceScales(e){return e&&this.isGeospatial?c1({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:t,width:i=1,height:r=1}){return e<this.x+this.width&&this.x<e+i&&t<this.y+this.height&&this.y<t+r}getFrustumPlanes(){var e;return this._frustumPlanes.near?this._frustumPlanes:(Object.assign(this._frustumPlanes,{left:hK((e=this.viewProjectionMatrix)[3]+e[0],e[7]+e[4],e[11]+e[8],e[15]+e[12]),right:hK(e[3]-e[0],e[7]-e[4],e[11]-e[8],e[15]-e[12]),bottom:hK(e[3]+e[1],e[7]+e[5],e[11]+e[9],e[15]+e[13]),top:hK(e[3]-e[1],e[7]-e[5],e[11]-e[9],e[15]-e[13]),near:hK(e[3]+e[2],e[7]+e[6],e[11]+e[10],e[15]+e[14]),far:hK(e[3]-e[2],e[7]-e[6],e[11]-e[10],e[15]-e[14])}),this._frustumPlanes)}panByPosition(e,t){return null}_initProps(e){let t=e.longitude,i=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=function(e){let{latitude:t}=e;return cG(Number.isFinite(t)),cW(4003e4*Math.cos(t*cK))-9}({latitude:i})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||c1({latitude:i,longitude:t}));let r=Math.pow(2,this.zoom);this.scale=r;let{position:n,modelMatrix:a}=e,s=h1;if(n&&(s=a?new cF(a).transformAsVector(n,[]):n),this.isGeospatial){let e=this.projectPosition([t,i,0]);this.center=new l8(s).scale(this.distanceScales.unitsPerMeter).add(e)}else this.center=this.projectPosition(s)}_initMatrices(e){var t;let{viewMatrix:i=h0,projectionMatrix:r=null,orthographic:n=!1,fovyRadians:a,fovy:s=75,near:o=.1,far:l=1e3,padding:c=null,focalDistance:u=1}=e;this.viewMatrixUncentered=i,this.viewMatrix=new cF().multiplyRight(i).translate(new l8(this.center).negate()),this.projectionMatrix=r||function({width:e,height:t,orthographic:i,fovyRadians:r,focalDistance:n,padding:a,near:s,far:o}){let l=e/t,c=i?new cF().orthographic({fovy:r,aspect:l,focalDistance:n,near:s,far:o}):new cF().perspective({fovy:r,aspect:l,near:s,far:o});if(a){let{left:i=0,right:r=0,top:n=0,bottom:s=0}=a,o=lc((i+e-r)/2,0,e)-e/2,l=lc((n+t-s)/2,0,t)-t/2;c[8]-=2*o/e,c[9]+=2*l/t}return c}({width:this.width,height:this.height,orthographic:n,fovyRadians:a||s*hQ,focalDistance:u,padding:c,near:o,far:l});let h=hY();sA.multiply(h,h,this.projectionMatrix),sA.multiply(h,h,this.viewMatrix),this.viewProjectionMatrix=h,this.viewMatrixInverse=sA.invert([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=[(t=this.viewMatrixInverse)[12],t[13],t[14]];let d=hY(),f=hY();sA.scale(d,d,[this.width/2,-this.height/2,1]),sA.translate(d,d,[1,-1,0]),sA.multiply(f,d,this.viewProjectionMatrix),this.pixelProjectionMatrix=f,this.pixelUnprojectionMatrix=sA.invert(hY(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||or.warn("Pixel project matrix not invertible")()}}h3.displayName="Viewport";let h4=h3;class h5{constructor(e,t){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=e=>{uk("layerManager.activateViewport",this,e),e&&(this.context.viewport=e)};const{deck:i,stats:r,viewport:n,timeline:a}=t||{};this.layers=[],this.resourceManager=new hq({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e?.gl,deck:i,shaderAssembler:function(e){let t=aP.getDefaultShaderAssembler();for(let e of uh)t.addDefaultModule(e);for(let i of(t._hookFunctions.length=0,"glsl"===e?ud:uf))t.addShaderHook(i);return t}(e?.info?.shadingLanguage||"glsl"),defaultShaderModules:[aB],renderPass:void 0,stats:r||new uT.Stats({id:"deck.gl"}),viewport:n||new h4({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:a||new n7,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){for(let e of(this.resourceManager.finalize(),this.layers))this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;for(let i of(e.clearRedrawFlags&&(this._needsRedraw=!1),this.layers)){let r=i.getNeedsRedraw(e);t=t||r}return t}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(t=>e.find(e=>0===t.id.indexOf(e))):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,t){uk("layerManager.setLayers",this,t,e),this._lastRenderedLayers=e;let i=uE(e,Boolean);for(let e of i)e.context=this.context;this._updateLayers(this.layers,i)}updateLayers(){let e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){let{defaultShaderModules:t}=this.context;t.find(t=>t.name===e.name)||(t.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){let{defaultShaderModules:t}=this.context,i=t.findIndex(t=>t.name===e.name);i>=0&&(t.splice(i,1),this._defaultShaderModulesChanged=!0)}_handleError(e,t,i){i.raiseError(t,`${e} of ${i}`)}_updateLayers(e,t){let i={};for(let t of e)i[t.id]?or.warn(`Multiple old layers with same id ${t.id}`)():i[t.id]=t;if(this._defaultShaderModulesChanged){for(let t of e)t.setNeedsUpdate(),t.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}let r=[];this._updateSublayersRecursively(t,i,r),this._finalizeOldLayers(i);let n=!1;for(let e of r)if(e.hasUniformTransition()){n=`Uniform transition in ${e}`;break}this._needsUpdate=n,this.layers=r}_updateSublayersRecursively(e,t,i){for(let r of e){r.context=this.context;let e=t[r.id];null===e&&or.warn(`Multiple new layers with same id ${r.id}`)(),t[r.id]=null;let n=null;try{this._debug&&e!==r&&r.validateProps(),e?(this._transferLayerState(e,r),this._updateLayer(r)):this._initializeLayer(r),i.push(r),n=r.isComposite?r.getSubLayers():null}catch(e){this._handleError("matching",e,r)}n&&this._updateSublayersRecursively(n,t,i)}}_finalizeOldLayers(e){for(let t in e){let i=e[t];i&&this._finalizeLayer(i)}}_initializeLayer(e){try{e._initialize(),e.lifecycle="Initialized"}catch(t){this._handleError("initialization",t,e)}}_transferLayerState(e,t){t._transferState(e),t.lifecycle="Matched. State transferred from previous layer",t!==e&&(e.lifecycle="Discarded. Awaiting garbage collection")}_updateLayer(e){try{e._update()}catch(t){this._handleError("update",t,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle="No longer matched. Awaiting garbage collection";try{e._finalize(),e.lifecycle="Finalized! Awaiting garbage collection"}catch(t){this._handleError("finalization",t,e)}}}function h6(e,t,i){if(e===t)return!0;if(!i||!e||!t)return!1;if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!h6(e[r],t[r],i-1))return!1;return!0}if(Array.isArray(t))return!1;if("object"==typeof e&&"object"==typeof t){let r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(let n of r)if(!t.hasOwnProperty(n)||!h6(e[n],t[n],i-1))return!1;return!0}return!1}class h8{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(let e in this.controllers){let t=this.controllers[e];t&&t.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(let e in this.controllers){let t=this.controllers[e];t&&t.updateTransition()}}getViewports(e){return e?this._viewports.filter(t=>t.containsPixel(e)):this._viewports}getViews(){let e={};return this.views.forEach(t=>{e[t.id]=t}),e}getView(e){return this.views.find(t=>t.id===e)}getViewState(e){let t="string"==typeof e?this.getView(e):e,i=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(i):i}getViewport(e){return this._viewportMap[e]}unproject(e,t){let i=this.getViewports(),r={x:e[0],y:e[1]};for(let n=i.length-1;n>=0;--n){let a=i[n];if(a.containsPixel(r)){let i=e.slice();return i[0]-=a.x,i[1]-=a.y,a.unproject(i,t)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){(e!==this.width||t!==this.height)&&(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=uE(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?(h6(e,this.viewState,3)||this.setNeedsUpdate("viewState changed"),this.viewState=e):or.warn("missing `viewState` or `initialViewState`")()}_createController(e,t){return new t.type({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:t=>this.getView(e.id)?.makeViewport({viewState:t,width:this.width,height:this.height})})}_updateController(e,t,i,r){let n=e.controller;if(n&&i){let a={...t,...n,id:e.id,x:i.x,y:i.y,width:i.width,height:i.height};return r&&r.constructor===n.type||(r=this._createController(e,a)),r&&r.setProps(a),r}return null}_rebuildViewports(){let{views:e}=this,t=this.controllers;this._viewports=[],this.controllers={};let i=!1;for(let r=e.length;r--;){let n=e[r],a=this.getViewState(n),s=n.makeViewport({viewState:a,width:this.width,height:this.height}),o=t[n.id],l=!!n.controller;l&&!o&&(i=!0),(i||!l)&&o&&(o.finalize(),o=null),this.controllers[n.id]=this._updateController(n,a,s,o),s&&this._viewports.unshift(s)}for(let e in t){let i=t[e];i&&!this.controllers[e]&&i.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,t){return e.length!==t.length||e.some((i,r)=>!e[r].equals(t[r]))}}let h9=/([0-9]+\.?[0-9]*)(%|px)/;function h7(e){switch(typeof e){case"number":return{position:e,relative:!1};case"string":let t=h9.exec(e);if(t&&t.length>=3){let e="%"===t[2],i=parseFloat(t[1]);return{position:e?i/100:i,relative:e}}default:throw Error(`Could not parse position string ${e}`)}}function de(e,t){return e.relative?Math.round(e.position*t):e.position}class dt{constructor(e){const{id:t,x:i=0,y:r=0,width:n="100%",height:a="100%",padding:s=null}=e;this.id=t||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=h7(i),this._y=h7(r),this._width=h7(n),this._height=h7(a),this._padding=s&&{left:h7(s.left||0),right:h7(s.right||0),top:h7(s.top||0),bottom:h7(s.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e||this.constructor===e.constructor&&h6(this.props,e.props,2)}clone(e){return new this.constructor({...this.props,...e})}makeViewport({width:e,height:t,viewState:i}){i=this.filterViewState(i);let r=this.getDimensions({width:e,height:t});return r.height&&r.width?new(this.getViewportType(i))({...i,...this.props,...r}):null}getViewStateId(){let{viewState:e}=this.props;return"string"==typeof e?e:e?.id||this.id}filterViewState(e){if(this.props.viewState&&"object"==typeof this.props.viewState){if(!this.props.viewState.id)return this.props.viewState;let t={...e};for(let e in this.props.viewState)"id"!==e&&(t[e]=this.props.viewState[e]);return t}return e}getDimensions({width:e,height:t}){let i={x:de(this._x,e),y:de(this._y,t),width:de(this._width,e),height:de(this._height,t)};return this._padding&&(i.padding={left:de(this._padding.left,e),top:de(this._padding.top,t),right:de(this._padding.right,e),bottom:de(this._padding.bottom,t)}),i}get controller(){let e=this.props.controller;return e?!0===e?{type:this.ControllerType}:"function"==typeof e?{type:e}:{type:this.ControllerType,...e}:null}}var cH=cH;class di extends h4{constructor(e={}){let t;const{latitude:i=0,longitude:r=0,zoom:n=0,pitch:a=0,bearing:s=0,nearZMultiplier:o=.1,farZMultiplier:l=1.01,nearZ:c,farZ:u,orthographic:h=!1,projectionMatrix:d,repeat:f=!1,worldOffset:p=0,position:g,padding:v,legacyMeterSizes:y=!1}=e;let{width:b,height:x,altitude:_=1.5}=e;const w=Math.pow(2,n);b=b||1,x=x||1;let k=null;if(d)t=c3(_=d[5]/2);else{let r;if(e.fovy?_=c4(t=e.fovy):t=c3(_),v){const{top:e=0,bottom:t=0}=v;r=[0,lc((e+x-t)/2,0,x)-x/2]}k=function(e){let{width:t,height:i,altitude:r,pitch:n=0,offset:a,center:s,scale:o,nearZMultiplier:l=1,farZMultiplier:c=1}=e,{fovy:u=c3(1.5)}=e;void 0!==r&&(u=c3(r));let h=u*cK,d=n*cK,f=c4(u),p=f;s&&(p+=s[2]*o/Math.cos(d)/i);let g=h*(.5+(a?a[1]:0)/i),v=Math.sin(g)*p/Math.sin(c$(Math.PI/2-d-g,.01,Math.PI-.01));return{fov:h,aspect:t/i,focalDistance:f,near:l,far:Math.min((Math.sin(d)*v+p)*c,10*p)}}({width:b,height:x,scale:w,center:g&&[0,0,g[2]*c0(i)],offset:r,pitch:a,fovy:t,nearZMultiplier:o,farZMultiplier:l}),Number.isFinite(c)&&(k.near=c),Number.isFinite(u)&&(k.far=u)}let E=function(e){let{height:t,pitch:i,bearing:r,altitude:n,scale:a,center:s}=e,o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];sA.translate(o,o,[0,0,-n]),sA.rotateX(o,o,-i*cK),sA.rotateZ(o,o,r*cK);let l=a/t;return sA.scale(o,o,[l,l,l]),s&&sA.translate(o,o,cq.negate([],s)),o}({height:x,pitch:a,bearing:s,scale:w,altitude:_});p&&(E=new cF().translate([512*p,0,0]).multiplyLeft(E)),super({...e,width:b,height:x,viewMatrix:E,longitude:r,latitude:i,zoom:n,...k,fovy:t,focalDistance:_}),this.latitude=i,this.longitude=r,this.zoom=n,this.pitch=a,this.bearing=s,this.altitude=_,this.fovy=t,this.orthographic=h,this._subViewports=f?[]:null,this._pseudoMeters=y,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){let e=this.getBounds(),t=Math.floor((e[0]+180)/360),i=Math.ceil((e[2]-180)/360);for(let e=t;e<=i;e++){let t=e?new di({...this,worldOffset:e}):this;this._subViewports.push(t)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);let[t,i]=this.projectFlat(e);return[t,i,(e[2]||0)*c0(e[1])]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);let[t,i]=this.unprojectFlat(e),r=(e[2]||0)/c0(i);return[t,i,r]}addMetersToLngLat(e,t){return c2(e,t)}panByPosition(e,t){let i=c6(t,this.pixelUnprojectionMatrix),r=this.projectFlat(e),n=cH.add([],r,cH.negate([],i)),a=cH.add([],this.center,n),[s,o]=this.unprojectFlat(a);return{longitude:s,latitude:o}}getBounds(e={}){let t=function(e,t=0){let i,r,{width:n,height:a,unproject:s}=e,o={targetZ:t},l=s([0,a],o),c=s([n,a],o);return(e.fovy?.5*e.fovy*c8:Math.atan(.5/e.altitude))>(90-e.pitch)*c8-.01?(i=c9(e,0,t),r=c9(e,n,t)):(i=s([0,0],o),r=s([n,0],o)),[l,c,r,i]}(this,e.z||0);return[Math.min(t[0][0],t[1][0],t[2][0],t[3][0]),Math.min(t[0][1],t[1][1],t[2][1],t[3][1]),Math.max(t[0][0],t[1][0],t[2][0],t[3][0]),Math.max(t[0][1],t[1][1],t[2][1],t[3][1])]}fitBounds(e,t={}){let{width:i,height:r}=this,{longitude:n,latitude:a,zoom:s}=function(e){let{width:t,height:i,bounds:r,minExtent:n=0,maxZoom:a=24,offset:s=[0,0]}=e,[[o,l],[c,u]]=r,h=function(e=0){return"number"==typeof e?{top:e,bottom:e,left:e,right:e}:(cG(Number.isFinite(e.top)&&Number.isFinite(e.bottom)&&Number.isFinite(e.left)&&Number.isFinite(e.right)),e)}(e.padding),d=cJ([o,c$(u,-85.051129,85.051129)]),f=cJ([c,c$(l,-85.051129,85.051129)]),p=[Math.max(Math.abs(f[0]-d[0]),n),Math.max(Math.abs(f[1]-d[1]),n)],g=[t-h.left-h.right-2*Math.abs(s[0]),i-h.top-h.bottom-2*Math.abs(s[1])];cG(g[0]>0&&g[1]>0);let v=g[0]/p[0],y=g[1]/p[1],b=(h.right-h.left)/2/v,x=(h.top-h.bottom)/2/y,_=cQ([(f[0]+d[0])/2+b,(f[1]+d[1])/2+x]),w=Math.min(a,cW(Math.abs(Math.min(v,y))));return cG(Number.isFinite(w)),{longitude:_[0],latitude:_[1],zoom:w}}({width:i,height:r,bounds:e,...t});return new di({width:i,height:r,longitude:n,latitude:a,zoom:s})}}di.displayName="WebMercatorViewport";class dr{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){this.cancel(),this.settings=e,this._inProgress=!0,this.settings.onStart?.(this)}end(){this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,this.settings.onEnd?.(this))}cancel(){this._inProgress&&(this.settings.onInterrupt?.(this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){if(!this._inProgress)return!1;if(null===this._handle){let{_timeline:e,settings:t}=this;this._handle=e.addChannel({delay:e.getTime(),duration:t.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),this.settings.onUpdate?.(this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}let dn=()=>{},da=e=>e;class ds{constructor(e){this._onTransitionUpdate=e=>{let{time:t,settings:{interpolator:i,startProps:r,endProps:n,duration:a,easing:s}}=e,o=s(t/a),l=i.interpolateProps(r,n,o);this.propsInTransition=this.getControllerState({...this.props,...l}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new dr(e.timeline),this.onViewStateChange=e.onViewStateChange||dn,this.onStateChange=e.onStateChange||dn}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1,i=this.props;if(this.props=e,!i||this._shouldIgnoreViewportChange(i,e))return!1;if(this._isTransitionEnabled(e)){let r=i;if(this.transition.inProgress){let{interruption:e,endProps:t}=this.transition.settings;r={...i,...2===e?t:this.propsInTransition||i}}this._triggerTransition(r,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){let{transitionDuration:t,transitionInterpolator:i}=e;return(t>0||"auto"===t)&&!!i}_isUpdateDueToCurrentTransition(e){return!!this.transition.inProgress&&!!this.propsInTransition&&this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition)}_shouldIgnoreViewportChange(e,t){return this.transition.inProgress?3===this.transition.settings.interruption||this._isUpdateDueToCurrentTransition(t):!this._isTransitionEnabled(t)||t.transitionInterpolator.arePropsEqual(e,t)}_triggerTransition(e,t){let i=this.getControllerState(e),r=this.getControllerState(t).shortestPathFrom(i),n=t.transitionInterpolator,a=n.getDuration?n.getDuration(e,t):t.transitionDuration;if(0===a)return;let s=n.initializeProps(e,r);this.propsInTransition={};let o={duration:a,easing:t.transitionEasing||da,interpolator:n,interruption:t.transitionInterruption||1,startProps:s.start,endProps:s.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(o),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e?.(t)}}}function dl(e,t){if(!e)throw Error(t||"deck.gl: assertion failed.")}class dc{constructor(e){const{compare:t,extract:i,required:r}=e;this._propsToCompare=t,this._propsToExtract=i||t,this._requiredProps=r}arePropsEqual(e,t){for(let i of this._propsToCompare)if(!(i in e)||!(i in t)||!lh(e[i],t[i]))return!1;return!0}initializeProps(e,t){let i={},r={};for(let n of this._propsToExtract)(n in e||n in t)&&(i[n]=e[n],r[n]=t[n]);return this._checkRequiredProps(i),this._checkRequiredProps(r),{start:i,end:r}}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(t=>{let i=e[t];dl(Number.isFinite(i)||Array.isArray(i),`${t} is required for transition`)})}}let du=["longitude","latitude","zoom","bearing","pitch"],dh=["longitude","latitude","zoom"];class dd extends dc{constructor(e={}){const t=Array.isArray(e)?e:e.transitionProps,i=Array.isArray(e)?{}:e;i.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:du,required:dh},super(i.transitionProps),this.opts=i}initializeProps(e,t){let i=super.initializeProps(e,t),{makeViewport:r,around:n}=this.opts;if(r&&n){let a=r(e),s=r(t),o=a.unproject(n);i.start.around=n,Object.assign(i.end,{around:s.project(o),aroundPosition:o,width:t.width,height:t.height})}return i}interpolateProps(e,t,i){let r={};for(let n of this._propsToExtract)r[n]=lu(e[n]||0,t[n]||0,i);if(t.aroundPosition&&this.opts.makeViewport){let n=this.opts.makeViewport({...t,...r});Object.assign(r,n.panByPosition(t.aroundPosition,lu(e.around,t.around,i)))}return r}}let df={transitionDuration:0},dp=e=>1-(1-e)*(1-e),dg=["wheel"],dm=["panstart","panmove","panend"],dv=["pinchstart","pinchmove","pinchend"],dy=["multipanstart","multipanmove","multipanend"],db=["dblclick"],dx=["keydown"],d_={};class dw{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new ds({...e,getControllerState:e=>new this.ControllerState(e),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(let e in this._events)this._events[e]&&this.eventManager?.off(e,this.handleEvent);this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;let t=this._eventStartBlocked;switch(e.type){case"panstart":return!t&&this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return!t&&this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return!t&&this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){let{x:t,y:i}=this.props,{offsetCenter:r}=e;return[r.x-t,r.y-i]}isPointInBounds(e,t){let{width:i,height:r}=this.props;if(t&&t.handled)return!1;let n=e[0]>=0&&e[0]<=i&&e[1]>=0&&e[1]<=r;return n&&t&&t.stopPropagation(),n}isFunctionKeyPressed(e){let{srcEvent:t}=e;return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){let t=setTimeout(()=>{this._eventStartBlocked===t&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=t}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);let{inertia:t}=e;this.inertia=Number.isFinite(t)?t:300*(!0===t);let{scrollZoom:i=!0,dragPan:r=!0,dragRotate:n=!0,doubleClickZoom:a=!0,touchZoom:s=!0,touchRotate:o=!1,keyboard:l=!0}=e,c=!!this.onViewStateChange;this.toggleEvents(dg,c&&i),this.toggleEvents(dm,c),this.toggleEvents(dv,c&&(s||o)),this.toggleEvents(dy,c&&o),this.toggleEvents(db,c&&a),this.toggleEvents(dx,c&&l),this.scrollZoom=i,this.dragPan=r,this.dragRotate=n,this.doubleClickZoom=a,this.touchZoom=s,this.touchRotate=o,this.keyboard=l}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,t){this.eventManager&&e.forEach(e=>{this._events[e]!==t&&(this._events[e]=t,t?this.eventManager.on(e,this.handleEvent):this.eventManager.off(e,this.handleEvent))})}updateViewport(e,t=null,i={}){let r={...e.getViewportProps(),...t},n=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(i),n){let e=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:r,interactionState:this._interactionState,oldViewState:e,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){let t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let i=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||"pan"===this.dragMode)&&(i=!i);let r=this.controllerState[i?"panStart":"rotateStart"]({pos:t});return this._panMove=i,this.updateViewport(r,df,{isDragging:!0}),!0}_onPan(e){return!!this.isDragging()&&(this._panMove?this._onPanMove(e):this._onPanRotate(e))}_onPanEnd(e){return!!this.isDragging()&&(this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e))}_onPanMove(e){if(!this.dragPan)return!1;let t=this.getCenter(e),i=this.controllerState.pan({pos:t});return this.updateViewport(i,df,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){let{inertia:t}=this;if(this.dragPan&&t&&e.velocity){let i=this.getCenter(e),r=[i[0]+e.velocityX*t/2,i[1]+e.velocityY*t/2],n=this.controllerState.pan({pos:r}).panEnd();this.updateViewport(n,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:dp},{isDragging:!1,isPanning:!0})}else{let e=this.controllerState.panEnd();this.updateViewport(e,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;let t=this.getCenter(e),i=this.controllerState.rotate({pos:t});return this.updateViewport(i,df,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){let{inertia:t}=this;if(this.dragRotate&&t&&e.velocity){let i=this.getCenter(e),r=[i[0]+e.velocityX*t/2,i[1]+e.velocityY*t/2],n=this.controllerState.rotate({pos:r}).rotateEnd();this.updateViewport(n,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:dp},{isDragging:!1,isRotating:!0})}else{let e=this.controllerState.rotateEnd();this.updateViewport(e,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;let t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;e.srcEvent.preventDefault();let{speed:i=.01,smooth:r=!1}=!0===this.scrollZoom?{}:this.scrollZoom,{delta:n}=e,a=2/(1+Math.exp(-Math.abs(n*i)));n<0&&0!==a&&(a=1/a);let s=r?{...this._getTransitionProps({around:t}),transitionDuration:250}:df,o=this.controllerState.zoom({pos:t,scale:a});return this.updateViewport(o,s,{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(e){let t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let i=this.controllerState.rotateStart({pos:t});return this.updateViewport(i,df,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate||!this.isDragging())return!1;let t=this.getCenter(e);t[0]-=e.deltaX;let i=this.controllerState.rotate({pos:t});return this.updateViewport(i,df,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;let{inertia:t}=this;if(this.touchRotate&&t&&e.velocityY){let i=this.getCenter(e),r=[i[0],i[1]+=e.velocityY*t/2],n=this.controllerState.rotate({pos:r});this.updateViewport(n,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:dp},{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{let e=this.controllerState.rotateEnd();this.updateViewport(e,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){let t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let i=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return d_._startPinchRotation=e.rotation,d_._lastPinchEvent=e,this.updateViewport(i,df,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let t=this.controllerState;if(this.touchZoom){let{scale:i}=e,r=this.getCenter(e);t=t.zoom({pos:r,scale:i})}if(this.touchRotate){let{rotation:i}=e;t=t.rotate({deltaAngleX:d_._startPinchRotation-i})}return this.updateViewport(t,df,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),d_._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;let{inertia:t}=this,{_lastPinchEvent:i}=d_;if(this.touchZoom&&t&&i&&e.scale!==i.scale){let r=this.getCenter(e),n=this.controllerState.rotateEnd(),a=Math.log2(e.scale),s=(a-Math.log2(i.scale))/(e.deltaTime-i.deltaTime),o=Math.pow(2,a+s*t/2);n=n.zoom({pos:r,scale:o}).zoomEnd(),this.updateViewport(n,{...this._getTransitionProps({around:r}),transitionDuration:t,transitionEasing:dp},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(t)}else{let e=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(e,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return d_._startPinchRotation=null,d_._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;let t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let i=this.isFunctionKeyPressed(e),r=this.controllerState.zoom({pos:t,scale:i?.5:2});return this.updateViewport(r,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){let t;if(!this.keyboard)return!1;let i=this.isFunctionKeyPressed(e),{zoomSpeed:r,moveSpeed:n,rotateSpeedX:a,rotateSpeedY:s}=!0===this.keyboard?{}:this.keyboard,{controllerState:o}=this,l={};switch(e.srcEvent.code){case"Minus":t=i?o.zoomOut(r).zoomOut(r):o.zoomOut(r),l.isZooming=!0;break;case"Equal":t=i?o.zoomIn(r).zoomIn(r):o.zoomIn(r),l.isZooming=!0;break;case"ArrowLeft":i?(t=o.rotateLeft(a),l.isRotating=!0):(t=o.moveLeft(n),l.isPanning=!0);break;case"ArrowRight":i?(t=o.rotateRight(a),l.isRotating=!0):(t=o.moveRight(n),l.isPanning=!0);break;case"ArrowUp":i?(t=o.rotateUp(s),l.isRotating=!0):(t=o.moveUp(n),l.isPanning=!0);break;case"ArrowDown":i?(t=o.rotateDown(s),l.isRotating=!0):(t=o.moveDown(n),l.isPanning=!0);break;default:return!1}return this.updateViewport(t,this._getTransitionProps(),l),!0}_getTransitionProps(e){let{transition:t}=this;return t&&t.transitionInterpolator?e?{...t,transitionInterpolator:new dd({...e,...t.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:t:df}}class dk{constructor(e,t){this._viewportProps=this.applyConstraints(e),this._state=t}getViewportProps(){return this._viewportProps}getState(){return this._state}}class dE extends dk{constructor(e){const{width:t,height:i,latitude:r,longitude:n,zoom:a,bearing:s=0,pitch:o=0,altitude:l=1.5,position:c=[0,0,0],maxZoom:u=20,minZoom:h=0,maxPitch:d=60,minPitch:f=0,startPanLngLat:p,startZoomLngLat:g,startRotatePos:v,startBearing:y,startPitch:b,startZoom:x,normalize:_=!0}=e;dl(Number.isFinite(n)),dl(Number.isFinite(r)),dl(Number.isFinite(a)),super({width:t,height:i,latitude:r,longitude:n,zoom:a,bearing:s,pitch:o,altitude:l,maxZoom:u,minZoom:h,maxPitch:d,minPitch:f,normalize:_,position:c},{startPanLngLat:p,startZoomLngLat:g,startRotatePos:v,startBearing:y,startPitch:b,startZoom:x}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:t}){let i=this.getState().startPanLngLat||this._unproject(t);if(!i)return this;let r=this.makeViewport(this.getViewportProps()).panByPosition(i,e);return this._getUpdatedState(r)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:i=0}){let r,{startRotatePos:n,startBearing:a,startPitch:s}=this.getState();return n&&void 0!==a&&void 0!==s?(r=e?this._getNewRotation(e,n,s,a):{bearing:a+t,pitch:s+i},this._getUpdatedState(r)):this}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:t,scale:i}){let{startZoom:r,startZoomLngLat:n}=this.getState();if(n||(r=this.getViewportProps().zoom,n=this._unproject(t)||this._unproject(e)),!n)return this;let{maxZoom:a,minZoom:s}=this.getViewportProps(),o=r+Math.log2(i);o=lc(o,s,a);let l=this.makeViewport({...this.getViewportProps(),zoom:o});return this._getUpdatedState({zoom:o,...l.panByPosition(n,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){let t=e.getViewportProps(),i={...this.getViewportProps()},{bearing:r,longitude:n}=i;return Math.abs(r-t.bearing)>180&&(i.bearing=r<0?r+360:r-360),Math.abs(n-t.longitude)>180&&(i.longitude=n<0?n+360:n-360),i}applyConstraints(e){let{maxZoom:t,minZoom:i,zoom:r}=e;e.zoom=lc(r,i,t);let{maxPitch:n,minPitch:a,pitch:s}=e;e.pitch=lc(s,a,n);let{normalize:o=!0}=e;return o&&Object.assign(e,function(e){let{width:t,height:i,pitch:r=0}=e,{longitude:n,latitude:a,zoom:s,bearing:o=0}=e;(n<-180||n>180)&&(n=cU(n+180,360)-180),(o<-180||o>180)&&(o=cU(o+180,360)-180);let l=cW(i/512);if(s<=l)s=l,a=0;else{let e=i/2/Math.pow(2,s),t=cQ([0,e])[1];if(a<t)a=t;else{let t=cQ([0,512-e])[1];a>t&&(a=t)}}return{width:t,height:i,longitude:n,latitude:a,zoom:s,pitch:r,bearing:o}}(e)),e}_zoomFromCenter(e){let{width:t,height:i}=this.getViewportProps();return this.zoom({pos:[t/2,i/2],scale:e})}_panFromCenter(e){let{width:t,height:i}=this.getViewportProps();return this.pan({startPos:[t/2,i/2],pos:[t/2+e[0],i/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){let t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_getNewRotation(e,t,i,r){let n=e[0]-t[0],a=e[1]-t[1],s=e[1],o=t[1],{width:l,height:c}=this.getViewportProps(),u=0;a>0?Math.abs(c-o)>5&&(u=a/(o-c)*1.2):a<0&&o>5&&(u=1-s/o),u=lc(u,-1,1);let{minPitch:h,maxPitch:d}=this.getViewportProps(),f=i;return u>0?f=i+u*(d-i):u<0&&(f=i-u*(h-i)),{pitch:f,bearing:r+n/l*180}}}class dT extends dw{constructor(){super(...arguments),this.ControllerState=dE,this.transition={transitionDuration:300,transitionInterpolator:new dd({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];let t=this.props;super.setProps(e),t&&t.height===e.height||this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class dP extends dt{constructor(e={}){super(e)}getViewportType(){return di}get ControllerType(){return dT}}dP.displayName="MapView";let dS=[255,255,255],dM=0;class dC{constructor(e={}){this.type="ambient";const{color:t=dS}=e,{intensity:i=1}=e;this.id=e.id||`ambient-${dM++}`,this.color=t,this.intensity=i}}let dA=[255,255,255],dI=[0,0,-1],dL=0;class dD{constructor(e={}){this.type="directional";const{color:t=dA}=e,{intensity:i=1}=e,{direction:r=dI}=e,{_shadow:n=!1}=e;this.id=e.id||`directional-${dL++}`,this.color=t,this.intensity=i,this.type="directional",this.direction=new l8(r).normalize().toArray(),this.shadow=n}getProjectedLight(e){return this}}class dO{constructor(e,t={id:"pass"}){const{id:i}=t;this.id=i,this.device=e,this.props={...t}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class dR extends dO{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){let[t,i]=this.device.canvasContext.getDrawingBufferSize(),r=e.clearCanvas??!0,n=e.clearColor??(!!r&&[0,0,0,0]),a=e.colorMask??15,s={viewport:[0,0,t,i]};e.colorMask&&(s.colorMask=a),e.scissorRect&&(s.scissorRect=e.scissorRect);let o=this.device.beginRenderPass({framebuffer:e.target,parameters:s,clearColor:n,clearDepth:!!r&&1,clearStencil:!!r&&0});try{return this._drawLayers(o,e)}finally{o.end(),this.device.submit()}}_drawLayers(e,t){let{target:i,shaderModuleProps:r,viewports:n,views:a,onViewportActive:s,clearStack:o=!0}=t;t.pass=t.pass||"unknown",o&&(this._lastRenderIndex=-1);let l=[];for(let o of n){let n=a&&a[o.id];s?.(o);let c=this._getDrawLayerParams(o,t);for(let a of o.subViewports||[o]){let s=this._drawLayersInViewport(e,{target:i,shaderModuleProps:r,viewport:a,view:n,pass:t.pass,layers:t.layers},c);l.push(s)}}return l}_getDrawLayerParams(e,{layers:t,pass:i,isPicking:r=!1,layerFilter:n,cullRect:a,effects:s,shaderModuleProps:o},l=!1){let c=[],u=function e(t=0,i={}){let r={},n=(a,s)=>{let o,l=a.props._offset,c=a.id,u=a.parent&&a.parent.id;if(!u||u in i||n(a.parent,!1),u in r){let t=r[u]=r[u]||e(i[u],i);o=t(a,s),r[c]=t}else Number.isFinite(l)?(o=l+(i[u]||0),r[c]=null):o=t;return s&&o>=t&&(t=o+1),i[c]=o,o};return n}(this._lastRenderIndex+1),h={layer:t[0],viewport:e,isPicking:r,renderPass:i,cullRect:a},d={};for(let r=0;r<t.length;r++){let a=t[r],f=this._shouldDrawLayer(a,h,n,d),p={shouldDrawLayer:f};f&&!l&&(p.shouldDrawLayer=!0,p.layerRenderIndex=u(a,f),p.shaderModuleProps=this._getShaderModuleProps(a,s,i,o),p.layerParameters={...a.context.deck?.props.parameters,...this.getLayerParameters(a,r,e)}),c[r]=p}return c}_drawLayersInViewport(e,{layers:t,shaderModuleProps:i,pass:r,target:n,viewport:a,view:s},o){let l=function(e,{shaderModuleProps:t,target:i,viewport:r}){let n=t?.project?.devicePixelRatio??e.canvasContext.cssToDeviceRatio(),[,a]=e.canvasContext.getDrawingBufferSize(),s=i?i.height:a;return[r.x*n,s-(r.y+r.height)*n,r.width*n,r.height*n]}(this.device,{shaderModuleProps:i,target:n,viewport:a});if(s){let{clear:e,clearColor:t,clearDepth:i,clearStencil:r}=s.props;if(e){let e=[0,0,0,0],a=1,s=0;Array.isArray(t)?e=[...t.slice(0,3),t[3]||255].map(e=>e/255):!1===t&&(e=!1),void 0!==i&&(a=i),void 0!==r&&(s=r),this.device.beginRenderPass({framebuffer:n,parameters:{viewport:l,scissorRect:l},clearColor:e,clearDepth:a,clearStencil:s}).end()}}let c={totalCount:t.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:l});for(let i=0;i<t.length;i++){let n=t[i],s=o[i],{shouldDrawLayer:l}=s;if(l&&n.props.pickable&&c.pickableCount++,n.isComposite&&c.compositeCount++,n.isDrawable&&s.shouldDrawLayer){let{layerRenderIndex:t,shaderModuleProps:i,layerParameters:o}=s;c.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,t),i.project&&(i.project.viewport=a),n.context.renderPass=e;try{n._drawLayer({renderPass:e,shaderModuleProps:i,uniforms:{layerIndex:t},parameters:o})}catch(e){n.raiseError(e,`drawing ${n} to ${r}`)}}}return c}shouldDrawLayer(e){return!0}getShaderModuleProps(e,t,i){return null}getLayerParameters(e,t,i){return e.props.parameters}_shouldDrawLayer(e,t,i,r){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;t.layer=e;let n=e.parent;for(;n;){if(!n.props.visible||!n.filterSubLayer(t))return!1;t.layer=n,n=n.parent}if(i){let e=t.layer.id;if(e in r||(r[e]=i(t)),!r[e])return!1}return e.activateViewport(t.viewport),!0}_getShaderModuleProps(e,t,i,r){let n=this.device.canvasContext.cssToDeviceRatio(),a=e.internalState?.propsInTransition||e.props,s={layer:a,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:n,modelMatrix:a.modelMatrix,coordinateSystem:a.coordinateSystem,coordinateOrigin:a.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(t)for(let i of t)dN(s,i.getShaderModuleProps?.(e,s));return dN(s,this.getShaderModuleProps(e,t,s),r)}}function dN(e,...t){for(let i of t)if(i)for(let t in i)e[t]?Object.assign(e[t],i[t]):e[t]=i[t];return e}class dj extends dR{constructor(e,t){super(e,t);const i=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}}),r=e.createTexture({format:"depth16unorm",width:1,height:1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[i],depthStencilAttachment:r})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){let t=this.fbo,i=this.device.canvasContext.cssToDeviceRatio(),r=e.viewports[0],n=r.width*i,a=r.height*i;(n!==t.width||a!==t.height)&&t.resize({width:n,height:a}),super.render({...e,clearColor:[1,1,1,1],target:t,pass:"shadow"})}getLayerParameters(e,t,i){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return!1!==e.props.shadowEnabled}getShaderModuleProps(e,t,i){return{shadow:{project:i.project,drawToShadowMap:!0}}}}let dB={color:[255,255,255],intensity:1},dF=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],dz=[0,0,0,200/255];class dV{constructor(e={}){this.id="lighting-effect",this.shadowColor=dz,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;let{device:t,deck:i}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(t),i._addDefaultShaderModule(ul),this.dummyShadowMap=t.createTexture({width:1,height:1}))}setProps(e){for(let t in this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[],e){let i=e[t];switch(i.type){case"ambient":this.ambientLight=i;break;case"directional":this.directionalLights.push(i);break;case"point":this.pointLights.push(i)}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(e=>e.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:t,viewports:i,onViewportActive:r,views:n}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let a=0;a<this.shadowPasses.length;a++)this.shadowPasses[a].render({layers:e,layerFilter:t,viewports:i,onViewportActive:r,views:n,shaderModuleProps:{shadow:{shadowLightId:a,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(e,t){let i=this.shadow?{project:t.project,shadowMaps:this.shadowPasses.map(e=>e.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},r={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(t=>t.getProjectedLight({layer:e})),pointLights:this.pointLights.map(t=>t.getProjectedLight({layer:e}))},n=e.props.material;return{shadow:i,lighting:r,phongMaterial:n,gouraudMaterial:n}}cleanup(e){for(let e of this.shadowPasses)e.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(ul))}_calculateMatrices(){let e=[];for(let t of this.directionalLights){let i=new cF().lookAt({eye:new l8(t.direction).negate()});e.push(i)}return e}_createShadowPasses(e){for(let t=0;t<this.directionalLights.length;t++){let i=new dj(e);this.shadowPasses[t]=i}}_applyDefaultLights(){let{ambientLight:e,pointLights:t,directionalLights:i}=this;e||0!==t.length||0!==i.length||(this.ambientLight=new dC(dB),this.directionalLights.push(new dD(dF[0]),new dD(dF[1])))}}let dU=new dV;class d${constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){let t=this._defaultEffects;if(!t.find(t=>t.id===e.id)){let i=t.findIndex(t=>(t.order??1/0)-(e.order??1/0)>0);i<0?t.push(e):t.splice(i,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&!h6(e.effects,this.effects,1)&&this._setEffects(e.effects)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._resolvedEffects}_setEffects(e){let t={};for(let e of this.effects)t[e.id]=e;let i=[];for(let r of e){let e=t[r.id],n=r;e&&e!==r?e.setProps?(e.setProps(r.props),n=e):e.cleanup(this._context):e||r.setup(this._context),i.push(n),delete t[r.id]}for(let e in t)t[e].cleanup(this._context);this.effects=i,this._resolvedEffects=i.concat(this._defaultEffects),e.some(e=>e instanceof dV)||this._resolvedEffects.push(dU),this._needsRedraw="effects changed"}finalize(){for(let e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class dW extends dR{shouldDrawLayer(e){let{operation:t}=e.props;return t.includes("draw")||t.includes("terrain")}}let dH={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant",blendAlphaDstFactor:"zero"};class dq extends dR{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:t,views:i,viewports:r,onViewportActive:n,pickingFBO:a,deviceRect:{x:s,y:o,width:l,height:c},cullRect:u,effects:h,pass:d="picking",pickZ:f,shaderModuleProps:p}){this.pickZ=f;let g=this._resetColorEncoder(f),v=super.render({target:a,layers:e,layerFilter:t,views:i,viewports:r,onViewportActive:n,cullRect:u,effects:h?.filter(e=>e.useInPicking),pass:d,isPicking:!0,shaderModuleProps:p,clearColor:[0,0,0,0],colorMask:15,scissorRect:[s,o,l,c]});return this._colorEncoderState=null,{decodePickingColor:g&&dG.bind(null,g),stats:v}}shouldDrawLayer(e){let{pickable:t,operation:i}=e.props;return t&&i.includes("draw")||i.includes("terrain")||i.includes("mask")}getShaderModuleProps(e,t,i){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,t,i){let r={...e.props.parameters},{pickable:n,operation:a}=e.props;return!this._colorEncoderState||a.includes("terrain")?r.blend=!1:n&&a.includes("draw")&&(Object.assign(r,dH),r.blend=!0,r.blendColor=function(e,t,i){let r,{byLayer:n,byAlpha:a}=e,s=n.get(t);return s?(s.viewports.push(i),r=s.a):(r=n.size+1)<=255?(s={a:r,layer:t,viewports:[i]},n.set(t,s),a[r]=s):(or.warn("Too many pickable layers, only picking the first 255")(),r=0),[0,0,0,r/255]}(this._colorEncoderState,e,i)),r}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function dG(e,t){let i=e.byAlpha[t[3]];return i&&{pickedLayer:i.layer,pickedViewports:i.viewports,pickedObjectIndex:i.layer.decodePickingColor(t)}}class dY{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new dW(e),this.pickLayersPass=new dq(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;let t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,i={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};i.effects&&this._preRender(i.effects,i);let r=this.lastPostProcessEffect?this.renderBuffers[0]:i.target;this.lastPostProcessEffect&&(i.clearColor=[0,0,0,0],i.clearCanvas=!0);let n=t.render({...i,target:r});i.effects&&(this.lastPostProcessEffect&&(i.clearCanvas=void 0===e.clearCanvas||e.clearCanvas),this._postRender(i.effects,i)),this.renderCount++,uk("deckRenderer.renderLayers",this,n,e)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}finalize(){let{renderBuffers:e}=this;for(let t of e)t.delete();e.length=0}_preRender(e,t){for(let i of(this.lastPostProcessEffect=null,t.preRenderStats=t.preRenderStats||{},e))t.preRenderStats[i.id]=i.preRender(t),i.postRender&&(this.lastPostProcessEffect=i.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){let{renderBuffers:e}=this,t=this.device.canvasContext.getDrawingBufferSize(),[i,r]=t;for(let n of(0===e.length&&[0,1].map(t=>{let n=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"},width:i,height:r});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${t}`,colorAttachments:[n]}))}),e))n.resize(t)}_postRender(e,t){let{renderBuffers:i}=this,r={...t,inputBuffer:i[0],swapBuffer:i[1]};for(let n of e)if(n.postRender){r.target=n.id===this.lastPostProcessEffect?t.target:void 0;let e=n.postRender(r);r.inputBuffer=e,r.swapBuffer=e===i[0]?i[1]:i[0]}}}let dX={pickedColor:null,pickedObjectIndex:-1};function dK({pickedColors:e,decodePickingColor:t,deviceX:i,deviceY:r,deviceRadius:n,deviceRect:a}){let{x:s,y:o,width:l,height:c}=a,u=n*n,h=-1,d=0;for(let t=0;t<c;t++){let n=t+o-r,a=n*n;if(a>u)d+=4*l;else for(let t=0;t<l;t++){if(e[d+3]-1>=0){let e=t+s-i,r=e*e+a;r<=u&&(u=r,h=d)}d+=4}}if(h>=0){let i=e.slice(h,h+4),r=t(i);if(r){let e=Math.floor(h/4/l),t=h/4-e*l;return{...r,pickedColor:i,pickedX:s+t,pickedY:o+e}}or.error("Picked non-existent layer. Is picking buffer corrupt?")()}return dX}function dZ({pickedColors:e,decodePickingColor:t}){let i=new Map;if(e){for(let r=0;r<e.length;r+=4)if(e[r+3]-1>=0){let n=e.slice(r,r+4),a=n.join(",");if(!i.has(a)){let e=t(n);e?i.set(a,{...e,color:n}):or.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(i.values())}function dJ({pickInfo:e,viewports:t,pixelRatio:i,x:r,y:n,z:a}){let s,o=t[0];if(t.length>1&&(o=function(e,t){for(let i=e.length-1;i>=0;i--){let r=e[i];if(r.containsPixel(t))return r}return e[0]}(e?.pickedViewports||t,{x:r,y:n})),o){let e=[r-o.x,n-o.y];void 0!==a&&(e[2]=a),s=o.unproject(e)}return{color:null,layer:null,viewport:o,index:-1,picked:!1,x:r,y:n,pixel:[r,n],coordinate:s,devicePixel:e&&"pickedX"in e?[e.pickedX,e.pickedY]:void 0,pixelRatio:i}}function dQ(e){let{pickInfo:t,lastPickedInfo:i,mode:r,layers:n}=e,{pickedColor:a,pickedLayer:s,pickedObjectIndex:o}=t,l=s?[s]:[];if("hover"===r){let e=i.index,t=i.layerId,r=s?s.props.id:null;if(r!==t||o!==e){if(r!==t){let e=n.find(e=>e.props.id===t);e&&l.unshift(e)}i.layerId=r,i.index=o,i.info=null}}let c=dJ(e),u=new Map;return u.set(null,c),l.forEach(e=>{let t={...c};e===s&&(t.color=a,t.index=o,t.picked=!0);let n=(t=d0({layer:e,info:t,mode:r})).layer;e===s&&"hover"===r&&(i.info=t),u.set(n.id,t),"hover"===r&&n.updateAutoHighlight(t)}),u}function d0({layer:e,info:t,mode:i}){for(;e&&t;){let r=t.layer||null;t.sourceLayer=r,t.layer=e,t=e.getPickingInfo({info:t,mode:i,sourceLayer:r}),e=e.parent}return t}class d1{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new dq(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObjectAsync(e){return this._pickClosestObjectAsync(e)}pickObjectsAsync(e){return this._pickVisibleObjectsAsync(e)}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:t,layers:i,viewports:r},n=this.lastPickedInfo.info){let a=n&&n.layer&&n.layer.id,s=n&&n.viewport&&n.viewport.id,o=a?i.find(e=>e.id===a):null,l=s&&r.find(e=>e.id===s)||r[0],c=l&&l.unproject([e-l.x,t-l.y]);return{...n,x:e,y:t,viewport:l,coordinate:c,layer:o}}_resizeBuffer(){if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){let e=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=e}let{canvas:e}=this.device.getDefaultCanvasContext();this.pickingFBO?.resize({width:e.width,height:e.height}),this.depthFBO?.resize({width:e.width,height:e.height})}_getPickable(e){if(!1===this._pickable)return null;let t=e.filter(e=>this.pickLayersPass.shouldDrawLayer(e)&&!e.isComposite);return t.length?t:null}async _pickClosestObjectAsync({layers:e,views:t,viewports:i,x:r,y:n,radius:a=0,depth:s=1,mode:o="query",unproject3D:l,onViewportActive:c,effects:u}){let h,d=this.device.canvasContext.cssToDeviceRatio(),f=this._getPickable(e);if(!f||0===i.length)return{result:[],emptyInfo:dJ({viewports:i,x:r,y:n,pixelRatio:d})};this._resizeBuffer();let p=this.device.canvasContext.cssToDevicePixels([r,n],!0),g=[p.x+Math.floor(p.width/2),p.y+Math.floor(p.height/2)],v=Math.round(a*d),{width:y,height:b}=this.pickingFBO,x=this._getPickingRect({deviceX:g[0],deviceY:g[1],deviceRadius:v,deviceWidth:y,deviceHeight:b}),_={x:r-a,y:n-a,width:2*a+1,height:2*a+1},w=[],k=new Set;for(let e=0;e<s;e++){let a,p;if((a=x?dK({...this._drawAndSample({layers:f,views:t,viewports:i,onViewportActive:c,deviceRect:x,cullRect:_,effects:u,pass:`picking:${o}`}),deviceX:g[0],deviceY:g[1],deviceRadius:v,deviceRect:x}):{pickedColor:null,pickedObjectIndex:-1}).pickedLayer&&l&&this.depthFBO){let{pickedColors:e}=this._drawAndSample({layers:[a.pickedLayer],views:t,viewports:i,onViewportActive:c,deviceRect:{x:a.pickedX,y:a.pickedY,width:1,height:1},cullRect:_,effects:u,pass:`picking:${o}:z`},!0);e[3]&&(p=e[0])}for(let t of(a.pickedLayer&&e+1<s&&(k.add(a.pickedLayer),a.pickedLayer.disablePickingIndex(a.pickedObjectIndex)),(h=dQ({pickInfo:a,lastPickedInfo:this.lastPickedInfo,mode:o,layers:f,viewports:i,x:r,y:n,z:p,pixelRatio:d})).values()))t.layer&&w.push(t);if(!a.pickedColor)break}for(let e of k)e.restorePickingColors();return{result:w,emptyInfo:h.get(null)}}_pickClosestObject({layers:e,views:t,viewports:i,x:r,y:n,radius:a=0,depth:s=1,mode:o="query",unproject3D:l,onViewportActive:c,effects:u}){let h,d=this.device.canvasContext.cssToDeviceRatio(),f=this._getPickable(e);if(!f||0===i.length)return{result:[],emptyInfo:dJ({viewports:i,x:r,y:n,pixelRatio:d})};this._resizeBuffer();let p=this.device.canvasContext.cssToDevicePixels([r,n],!0),g=[p.x+Math.floor(p.width/2),p.y+Math.floor(p.height/2)],v=Math.round(a*d),{width:y,height:b}=this.pickingFBO,x=this._getPickingRect({deviceX:g[0],deviceY:g[1],deviceRadius:v,deviceWidth:y,deviceHeight:b}),_={x:r-a,y:n-a,width:2*a+1,height:2*a+1},w=[],k=new Set;for(let e=0;e<s;e++){let a,p;if((a=x?dK({...this._drawAndSample({layers:f,views:t,viewports:i,onViewportActive:c,deviceRect:x,cullRect:_,effects:u,pass:`picking:${o}`}),deviceX:g[0],deviceY:g[1],deviceRadius:v,deviceRect:x}):{pickedColor:null,pickedObjectIndex:-1}).pickedLayer&&l&&this.depthFBO){let{pickedColors:e}=this._drawAndSample({layers:[a.pickedLayer],views:t,viewports:i,onViewportActive:c,deviceRect:{x:a.pickedX,y:a.pickedY,width:1,height:1},cullRect:_,effects:u,pass:`picking:${o}:z`},!0);e[3]&&(p=e[0])}for(let t of(a.pickedLayer&&e+1<s&&(k.add(a.pickedLayer),a.pickedLayer.disablePickingIndex(a.pickedObjectIndex)),(h=dQ({pickInfo:a,lastPickedInfo:this.lastPickedInfo,mode:o,layers:f,viewports:i,x:r,y:n,z:p,pixelRatio:d})).values()))t.layer&&w.push(t);if(!a.pickedColor)break}for(let e of k)e.restorePickingColors();return{result:w,emptyInfo:h.get(null)}}async _pickVisibleObjectsAsync({layers:e,views:t,viewports:i,x:r,y:n,width:a=1,height:s=1,mode:o="query",maxObjects:l=null,onViewportActive:c,effects:u}){let h=this._getPickable(e);if(!h||0===i.length)return[];this._resizeBuffer();let d=this.device.canvasContext.cssToDeviceRatio(),f=this.device.canvasContext.cssToDevicePixels([r,n],!0),p=f.x,g=f.y+f.height,v=this.device.canvasContext.cssToDevicePixels([r+a,n+s],!0),y=v.x+v.width,b=v.y,x=this._drawAndSample({layers:h,views:t,viewports:i,onViewportActive:c,deviceRect:{x:p,y:b,width:y-p,height:g-b},cullRect:{x:r,y:n,width:a,height:s},effects:u,pass:`picking:${o}`}),_=dZ(x),w=new Map,k=[],E=Number.isFinite(l);for(let e=0;e<_.length&&(!E||!(k.length>=l));e++){let t=_[e],i={color:t.pickedColor,layer:null,index:t.pickedObjectIndex,picked:!0,x:r,y:n,pixelRatio:d},a=(i=d0({layer:t.pickedLayer,info:i,mode:o})).layer.id;w.has(a)||w.set(a,new Set);let s=w.get(a),l=i.object??i.index;s.has(l)||(s.add(l),k.push(i))}return k}_pickVisibleObjects({layers:e,views:t,viewports:i,x:r,y:n,width:a=1,height:s=1,mode:o="query",maxObjects:l=null,onViewportActive:c,effects:u}){let h=this._getPickable(e);if(!h||0===i.length)return[];this._resizeBuffer();let d=this.device.canvasContext.cssToDeviceRatio(),f=this.device.canvasContext.cssToDevicePixels([r,n],!0),p=f.x,g=f.y+f.height,v=this.device.canvasContext.cssToDevicePixels([r+a,n+s],!0),y=v.x+v.width,b=v.y,x=this._drawAndSample({layers:h,views:t,viewports:i,onViewportActive:c,deviceRect:{x:p,y:b,width:y-p,height:g-b},cullRect:{x:r,y:n,width:a,height:s},effects:u,pass:`picking:${o}`}),_=dZ(x),w=new Map,k=[],E=Number.isFinite(l);for(let e=0;e<_.length&&(!E||!(k.length>=l));e++){let t=_[e],i={color:t.pickedColor,layer:null,index:t.pickedObjectIndex,picked:!0,x:r,y:n,pixelRatio:d},a=(i=d0({layer:t.pickedLayer,info:i,mode:o})).layer.id;w.has(a)||w.set(a,new Set);let s=w.get(a),l=i.object??i.index;s.has(l)||(s.add(l),k.push(i))}return k}async _drawAndSampleAsync({layers:e,views:t,viewports:i,onViewportActive:r,deviceRect:n,cullRect:a,effects:s,pass:o},l=!1){let c=l?this.depthFBO:this.pickingFBO,u={layers:e,layerFilter:this.layerFilter,views:t,viewports:i,onViewportActive:r,pickingFBO:c,deviceRect:n,cullRect:a,effects:s,pass:o,pickZ:l,preRenderStats:{},isPicking:!0};for(let e of s)e.useInPicking&&(u.preRenderStats[e.id]=e.preRender(u));let{decodePickingColor:h}=this.pickLayersPass.render(u),{x:d,y:f,width:p,height:g}=n,v=new(l?Float32Array:Uint8Array)(p*g*4);return this.device.readPixelsToArrayWebGL(c,{sourceX:d,sourceY:f,sourceWidth:p,sourceHeight:g,target:v}),{pickedColors:v,decodePickingColor:h}}_drawAndSample({layers:e,views:t,viewports:i,onViewportActive:r,deviceRect:n,cullRect:a,effects:s,pass:o},l=!1){let c=l?this.depthFBO:this.pickingFBO,u={layers:e,layerFilter:this.layerFilter,views:t,viewports:i,onViewportActive:r,pickingFBO:c,deviceRect:n,cullRect:a,effects:s,pass:o,pickZ:l,preRenderStats:{},isPicking:!0};for(let e of s)e.useInPicking&&(u.preRenderStats[e.id]=e.preRender(u));let{decodePickingColor:h}=this.pickLayersPass.render(u),{x:d,y:f,width:p,height:g}=n,v=new(l?Float32Array:Uint8Array)(p*g*4);return this.device.readPixelsToArrayWebGL(c,{sourceX:d,sourceY:f,sourceWidth:p,sourceHeight:g,target:v}),{pickedColors:v,decodePickingColor:h}}_getPickingRect({deviceX:e,deviceY:t,deviceRadius:i,deviceWidth:r,deviceHeight:n}){let a=Math.max(0,e-i),s=Math.max(0,t-i),o=Math.min(r,e+i+1)-a,l=Math.min(n,t+i+1)-s;return o<=0||l<=0?null:{x:a,y:s,width:o,height:l}}}let d2={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},d3="__root";class d4{constructor({deck:e,parentElement:t}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,t?.classList.add("deck-widget-container"),this.parentElement=t}getWidgets(){return this.resolvedWidgets}setProps(e){if(e.widgets&&!h6(e.widgets,this.widgets,1)){let t=e.widgets.filter(Boolean);this._setWidgets(t)}}finalize(){for(let e of this.getWidgets())this._removeWidget(e);for(let e in this.defaultWidgets.length=0,this.resolvedWidgets.length=0,this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(t=>t.id===e.id)||(this._addWidget(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}onRedraw({viewports:e,layers:t}){let i=e.reduce((e,t)=>(e[t.id]=t,e),{});for(let r of this.getWidgets()){let{viewId:n}=r;if(n){let e=i[n];e&&(r.onViewportChange&&r.onViewportChange(e),r.onRedraw?.({viewports:[e],layers:t}))}else{if(r.onViewportChange)for(let t of e)r.onViewportChange(t);r.onRedraw?.({viewports:e,layers:t})}}this.lastViewports=i,this._updateContainers()}onHover(e,t){for(let i of this.getWidgets()){let{viewId:r}=i;r&&r!==e.viewport?.id||i.onHover?.(e,t)}}onEvent(e,t){let i=oK[t.type];if(i)for(let r of this.getWidgets()){let{viewId:n}=r;n&&n!==e.viewport?.id||r[i]?.(e,t)}}_setWidgets(e){let t={};for(let e of this.resolvedWidgets)t[e.id]=e;for(let e of(this.resolvedWidgets.length=0,this.defaultWidgets))t[e.id]=null,this.resolvedWidgets.push(e);for(let i of e){let e=t[i.id];e?e.viewId!==i.viewId||e.placement!==i.placement?(this._removeWidget(e),this._addWidget(i)):i!==e&&(e.setProps(i.props),i=e):this._addWidget(i),t[i.id]=null,this.resolvedWidgets.push(i)}for(let e in t){let i=t[e];i&&this._removeWidget(i)}this.widgets=e}_addWidget(e){let{viewId:t=null,placement:i="top-left"}=e;e.widgetManager=this,e.deck=this.deck,e.rootElement=e._onAdd({deck:this.deck,viewId:t}),e.rootElement&&this._getContainer(t,i).append(e.rootElement),e.updateHTML()}_removeWidget(e){e.onRemove?.(),e.rootElement&&e.rootElement.remove(),e.rootElement=void 0,e.deck=void 0,e.widgetManager=void 0}_getContainer(e,t){let i=e||d3,r=this.containers[i];r||((r=document.createElement("div")).style.pointerEvents="none",r.style.position="absolute",r.style.overflow="hidden",this.parentElement?.append(r),this.containers[i]=r);let n=r.querySelector(`.${t}`);return n||((n=globalThis.document.createElement("div")).className=t,n.style.position="absolute",n.style.zIndex="2",Object.assign(n.style,d2[t]),r.append(n)),n}_updateContainers(){let e=this.deck.width,t=this.deck.height;for(let i in this.containers){let r=this.lastViewports[i]||null,n=i===d3||r,a=this.containers[i];n?(a.style.display="block",a.style.left=`${r?r.x:0}px`,a.style.top=`${r?r.y:0}px`,a.style.width=`${r?r.width:e}px`,a.style.height=`${r?r.height:t}px`):a.style.display="none"}}}function d5(e,t){t&&Object.entries(t).map(([t,i])=>{t.startsWith("--")?e.style.setProperty(t,i):e.style[t]=i})}class d6{constructor(e){this.viewId=null,this.props={...this.constructor.defaultProps,...e},this.id=this.props.id}setProps(e){let t=this.props,i=this.rootElement;if(i&&t.className!==e.className&&(t.className&&i.classList.remove(t.className),e.className&&i.classList.add(e.className)),i&&!h6(t.style,e.style,1)){var r;(r=t.style)&&Object.keys(r).map(e=>{e.startsWith("--")?i.style.removeProperty(e):i.style[e]=""}),d5(i,e.style)}Object.assign(this.props,e),this.updateHTML()}updateHTML(){this.rootElement&&this.onRenderHTML(this.rootElement)}onCreateRootElement(){let e=["deck-widget",this.className,this.props.className],t=document.createElement("div");return e.filter(e=>"string"==typeof e&&e.length>0).forEach(e=>t.classList.add(e)),d5(t,this.props.style),t}_onAdd(e){return this.onAdd(e)??this.onCreateRootElement()}onAdd(e){}onRemove(){}onViewportChange(e){}onRedraw(e){}onHover(e,t){}onClick(e,t){}onDrag(e,t){}onDragStart(e,t){}onDragEnd(e,t){}}d6.defaultProps={id:"widget",style:{},className:""};let d8={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class d9 extends d6{constructor(e={}){super(e),this.id="default-tooltip",this.placement="fill",this.className="deck-tooltip",this.isVisible=!1,this.setProps(e)}onCreateRootElement(){let e=document.createElement("div");return e.className=this.className,Object.assign(e.style,d8),e}onRenderHTML(e){}onViewportChange(e){this.isVisible&&e.id===this.lastViewport?.id&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){let{deck:t}=this,i=t&&t.props.getTooltip;if(!i)return;let r=i(e);this.lastViewport=e.viewport,this.setTooltip(r,e.x,e.y)}setTooltip(e,t,i){let r=this.rootElement;if(r){if("string"==typeof e)r.innerText=e;else if(e)e.text&&(r.innerText=e.text),e.html&&(r.innerHTML=e.html),e.className&&(r.className=e.className);else{this.isVisible=!1,r.style.display="none";return}this.isVisible=!0,r.style.display="block",r.style.transform=`translate(${t}px, ${i}px)`,e&&"object"==typeof e&&"style"in e&&Object.assign(r.style,e.style)}}}d9.defaultProps={...d6.defaultProps};let d7=globalThis.loaders?.parseImageNode,fe="undefined"!=typeof Image,ft="undefined"!=typeof ImageBitmap,fi=!!u1||!!d7,fr=/^data:image\/svg\+xml/,fn=/\.svg((\?|#).*)?$/;function fa(e){return e&&(fr.test(e)||fn.test(e))}function fs(e,t){if(fa(t))throw Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(e)])}async function fo(e,t,i){let r=function(e,t){if(fa(t)){let t=new TextDecoder().decode(e);try{"function"==typeof unescape&&"function"==typeof encodeURIComponent&&(t=unescape(encodeURIComponent(t)))}catch(e){throw Error(e.message)}return`data:image/svg+xml;base64,${btoa(t)}`}return fs(e,t)}(e,i),n=self.URL||self.webkitURL,a="string"!=typeof r&&n.createObjectURL(r);try{return await fl(a||r,t)}finally{a&&n.revokeObjectURL(a)}}async function fl(e,t){let i=new Image;return(i.src=e,t.image&&t.image.decode&&i.decode)?(await i.decode(),i):await new Promise((e,t)=>{try{i.onload=()=>e(i),i.onerror=e=>{let i=e instanceof Error?e.message:"error";t(Error(i))}}catch(e){t(e)}})}let fc={},fu=!0;async function fh(e,t,i){let r;r=fa(i)?await fo(e,t,i):fs(e,i);let n=t&&t.imagebitmap;return await fd(r,n)}async function fd(e,t=null){if((function(e){for(let t in e||fc)return!1;return!0}(t)||!fu)&&(t=null),t)try{return await createImageBitmap(e,t)}catch(e){console.warn(e),fu=!1}return await createImageBitmap(e)}function ff(e){var t,i;let r,n,a,s,o=fp(e);return((r=fp(o)).byteLength>=24&&0x89504e47===r.getUint32(0,!1)?{mimeType:"image/png",width:r.getUint32(16,!1),height:r.getUint32(20,!1)}:null)||function(e){let t=fp(e);if(!(t.byteLength>=3&&65496===t.getUint16(0,!1)&&255===t.getUint8(2)))return null;let{tableMarkers:i,sofMarkers:r}=function(){let e=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)e.add(t);return{tableMarkers:e,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}(),n=2;for(;n+9<t.byteLength;){let e=t.getUint16(n,!1);if(r.has(e))return{mimeType:"image/jpeg",height:t.getUint16(n+5,!1),width:t.getUint16(n+7,!1)};if(!i.has(e))break;n+=2,n+=t.getUint16(n,!1)}return null}(o)||((n=fp(o)).byteLength>=10&&0x47494638===n.getUint32(0,!1)?{mimeType:"image/gif",width:n.getUint16(6,!0),height:n.getUint16(8,!0)}:null)||((a=fp(o)).byteLength>=14&&16973===a.getUint16(0,!1)&&a.getUint32(2,!0)===a.byteLength?{mimeType:"image/bmp",width:a.getUint32(18,!0),height:a.getUint32(22,!0)}:null)||((s=!function(e,t,i=0){let r=[...t].map(e=>e.charCodeAt(0));for(let t=0;t<r.length;++t)if(r[t]!==e[t+i])return!1;return!0}(i=new Uint8Array((t=o)instanceof DataView?t.buffer:t),"ftyp",4)||(96&i[8])==0?null:function(e){switch(String.fromCharCode(...e.slice(8,12)).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}(i))?{mimeType:s.mimeType,width:0,height:0}:null)}function fp(e){if(e instanceof DataView)return e;if(ArrayBuffer.isView(e))return new DataView(e.buffer);if(e instanceof ArrayBuffer)return new DataView(e);throw Error("toDataView")}async function fg(e,t){let{mimeType:i}=ff(e)||{},r=globalThis.loaders?.parseImageNode;return uI(r),await r(e,i)}let fm={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:"4.3.3",mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],parse:async function e(e,t,i){let r,n=((t=t||{}).image||{}).type||"auto",{url:a}=i||{};switch(function(e){switch(e){case"auto":case"data":if(ft)return"imagebitmap";if(fe)return"image";if(fi)return"data";throw Error("Install '@loaders.gl/polyfills' to parse images under Node.js");default:return!function(e){switch(e){case"auto":return ft;case"imagebitmap":case"image":case"data":return;default:throw Error(`@loaders.gl/images: image ${e} not supported in this environment`)}}(e),e}}(n)){case"imagebitmap":r=await fh(e,t,a);break;case"image":r=await fo(e,t,a);break;case"data":r=await fg(e,t);break;default:uI(!1)}return"data"===n&&(r=function(e){switch(function(e){var t;let i=(t=e,"undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap?"imagebitmap":"undefined"!=typeof Image&&t instanceof Image?"image":t&&"object"==typeof t&&t.data&&t.width&&t.height?"data":null);if(!i)throw Error("Not an image");return i}(e)){case"data":return e;case"image":case"imagebitmap":let t=document.createElement("canvas"),i=t.getContext("2d");if(!i)throw Error("getImageData");return t.width=e.width,t.height=e.height,i.drawImage(e,0,0),i.getImageData(0,0,e.width,e.height);default:throw Error("getImageData")}}(r)),r},tests:[e=>!!ff(new DataView(e))],options:{image:{type:"auto",decode:!0}}},fv={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:function(e){let t=e[0],i=e[e.length-1];return"{"===t&&"}"===i||"["===t&&"]"===i},parseTextSync:JSON.parse},fy=function(){let e="9.2.3",t=globalThis.deck&&globalThis.deck.VERSION;if(t&&t!==e)throw Error(`deck.gl - multiple versions detected: ${t} vs ${e}`);if(!t){or.log(1,`deck.gl ${e}`)(),globalThis.deck={...globalThis.deck,VERSION:e,version:e,log:or,_registerLoggers:uw};var i=[fv,[fm,{imagebitmap:{premultiplyAlpha:"none"}}]];let t=hL();for(let e of i=Array.isArray(i)?i:[i]){let i=uD(e);t.find(e=>i===e)||t.unshift(i)}}return e}();var fb=e.i(93779),fx=e.i(36131);let f_="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.";class fw{static defaultProps={...fb.Device.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0};stats=fx.lumaStats;log=aS.log;VERSION="9.2.4";spector;preregisteredAdapters=new Map;constructor(){if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw aS.log.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),aS.log.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),Error("luma.gl - multiple versions detected: see console log");aS.log.error("This version of luma.gl has already been initialized")()}aS.log.log(1,`${this.VERSION} - set luma.log.level=1 (or higher) to trace rendering`)(),globalThis.luma=this}async createDevice(e={}){let t={...fw.defaultProps,...e},i=this.selectAdapter(t.type,t.adapters);if(!i)throw Error(f_);return t.waitForPageLoad&&await i.pageLoaded,await i.create(t)}async attachDevice(e,t){let i=this._getTypeFromHandle(e,t.adapters),r=i&&this.selectAdapter(i,t.adapters);if(!r)throw Error(f_);return await r?.attach?.(e,t)}registerAdapters(e){for(let t of e)this.preregisteredAdapters.set(t.type,t)}getSupportedAdapters(e=[]){return Array.from(this._getAdapterMap(e)).map(([,e])=>e).filter(e=>e.isSupported?.()).map(e=>e.type)}getBestAvailableAdapterType(e=[]){let t=this._getAdapterMap(e);for(let e of["webgpu","webgl","null"])if(t.get(e)?.isSupported?.())return e;return null}selectAdapter(e,t=[]){let i=e;"best-available"===e&&(i=this.getBestAvailableAdapterType(t));let r=this._getAdapterMap(t);return i&&r.get(i)||null}enforceWebGL2(e=!0,t=[]){let i=this._getAdapterMap(t).get("webgl");i||aS.log.warn("enforceWebGL2: webgl adapter not found")(),i?.enforceWebGL2?.(e)}setDefaultDeviceProps(e){Object.assign(fw.defaultProps,e)}_getAdapterMap(e=[]){let t=new Map(this.preregisteredAdapters);for(let i of e)t.set(i.type,i);return t}_getTypeFromHandle(e,t=[]){return e instanceof WebGL2RenderingContext?"webgl":"undefined"!=typeof GPUDevice&&e instanceof GPUDevice||e?.queue?"webgpu":null===e?"null":(e instanceof WebGLRenderingContext?aS.log.warn("WebGL1 is not supported",e)():aS.log.warn("Unknown handle type",e)(),null)}}let fk=new fw;var fE=e.i(31211);class fT{get pageLoaded(){return fS||(fS=fP&&"complete"===document.readyState||"undefined"==typeof window?Promise.resolve():new Promise(e=>window.addEventListener("load",()=>e()))),fS}}let fP=(0,fE.isBrowser)()&&"undefined"!=typeof document,fS=null,fM={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}};var fC=e.i(83301),fA=e.i(45066);let fI=new class extends fT{type="webgl";constructor(){super(),fb.Device.defaultProps={...fb.Device.defaultProps,...fC.DEFAULT_SPECTOR_PROPS}}enforceWebGL2(e){!function(e=!0){let t=HTMLCanvasElement.prototype;if(!e&&t.originalGetContext){t.getContext=t.originalGetContext,t.originalGetContext=void 0;return}t.originalGetContext=t.getContext,t.getContext=function(e,t){if("webgl"===e||"experimental-webgl"===e){let e=this.originalGetContext("webgl2",t);return e instanceof HTMLElement&&function(e){e.getExtension("EXT_color_buffer_float");let t={...fM,WEBGL_disjoint_timer_query:e.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:{drawBuffersWEBGL:t=>e.drawBuffers(t),COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067},OES_vertex_array_object:{VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES:()=>e.createVertexArray(),deleteVertexArrayOES:t=>e.deleteVertexArray(t),isVertexArrayOES:t=>e.isVertexArray(t),bindVertexArrayOES:t=>e.bindVertexArray(t)},ANGLE_instanced_arrays:{VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE:(...t)=>e.drawArraysInstanced(...t),drawElementsInstancedANGLE:(...t)=>e.drawElementsInstanced(...t),vertexAttribDivisorANGLE:(...t)=>e.vertexAttribDivisor(...t)}},i=e.getExtension;e.getExtension=function(r){let n=i.call(e,r);return n||(r in t?t[r]:null)};let r=e.getSupportedExtensions;e.getSupportedExtensions=function(){let i=r.apply(e)||[];return i?.concat(Object.keys(t))}}(e),e}return this.originalGetContext(e,t)}}(e)}isSupported(){return"undefined"!=typeof WebGL2RenderingContext}isDeviceHandle(e){return!!("undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext)||("undefined"!=typeof WebGLRenderingContext&&e instanceof WebGLRenderingContext&&aS.log.warn("WebGL1 is not supported",e)(),!1)}async attach(t,i={}){var r;let{WebGLDevice:n}=await e.A(49628);if(t instanceof n)return t;if(t?.device instanceof n)return t.device;if(r=t,!("undefined"!=typeof WebGL2RenderingContext&&r instanceof WebGL2RenderingContext||r&&Number.isFinite(r._version)))throw Error("Invalid WebGL2RenderingContext");let a=!0===i.createCanvasContext?{}:i.createCanvasContext;return new n({...i,_handle:t,createCanvasContext:{canvas:t.canvas,autoResize:!1,...a}})}async create(t={}){let{WebGLDevice:i}=await e.A(49628);aS.log.groupCollapsed(1,"WebGLDevice created")();try{let e=[];for(let i of((t.debugWebGL||t.debug)&&e.push((0,fA.loadWebGLDeveloperTools)()),t.debugSpectorJS&&e.push((0,fC.loadSpectorJS)(t)),await Promise.allSettled(e)))"rejected"===i.status&&aS.log.error(`Failed to initialize debug libraries ${i.reason}`)();let r=new i(t),n=`\
${r._reused?"Reusing":"Created"} device with WebGL2 ${r.props.debug?"debug ":""}context: \
${r.info.vendor}, ${r.info.renderer} for canvas: ${r.canvasContext.id}`;return aS.log.probe(1,n)(),aS.log.table(1,r.info)(),r}finally{aS.log.groupEnd(1)()}}},fL=0;class fD{static defaultAnimationLoopProps={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:e=>console.error(e),stats:fk.stats.get(`animation-loop-${fL++}`),autoResizeViewport:!1};device=null;canvas=null;props;animationProps=null;timeline=null;stats;cpuTime;gpuTime;frameRate;display;needsRedraw="initialized";_initialized=!1;_running=!1;_animationFrameId=null;_nextFramePromise=null;_resolveNextFrame=null;_cpuStartTime=0;_error=null;constructor(e){if(this.props={...fD.defaultAnimationLoopProps,...e},!(e=this.props).device)throw Error("No device provided");this.stats=e.stats||new uT.Stats({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}reportError(e){this.props.onError(e),this._error=e}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;if(this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),!this._running)return null;return!1!==e&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this}catch(t){let e=t instanceof Error?t:Error("Unknown error");throw this.props.onError(e),e}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){return this.device?.isLost||this._error||(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers()),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){if(this._running){var e;this._animationFrameId=(e=this._animationFrame.bind(this),"undefined"!=typeof window&&window.requestAnimationFrame?window.requestAnimationFrame(e):setTimeout(e,1e3/60))}}_cancelAnimationFrame(){if(null!==this._animationFrameId){var e;e=this._animationFrameId,"undefined"!=typeof window&&window.cancelAnimationFrame?window.cancelAnimationFrame(e):clearTimeout(e),this._animationFrameId=null}}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){this.display?this.display._renderFrame(e):(this.props.onRender(this._getAnimationProps()),this.device?.submit())}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeViewport()}_initializeAnimationProps(){let e=this.device?.getDefaultCanvasContext();if(!this.device||!e)throw Error("loop");let t=e?.canvas,i=e.props.useDevicePixels;this.animationProps={animationLoop:this,device:this.device,canvasContext:e,canvas:t,useDevicePixels:i,timeline:this.timeline,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;let{width:e,height:t,aspect:i}=this._getSizeAndAspect();(e!==this.animationProps.width||t!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),i!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=i,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){if(this.device=await this.props.device,!this.device)throw Error("No device provided");this.canvas=this.device.getDefaultCanvasContext().canvas||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){let e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";let t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(t);let i=this.props.onAddHTML(t);i&&(t.innerHTML=i)}}_getSizeAndAspect(){if(!this.device)return{width:1,height:1,aspect:1};let[e,t]=this.device?.getDefaultCanvasContext().getDevicePixelSize()||[1,1],i=1,r=this.device?.getDefaultCanvasContext().canvas;return r&&r.clientHeight?i=r.clientWidth/r.clientHeight:e>0&&t>0&&(i=e/t),{width:e,height:t,aspect:i}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}function fO(){}let fR={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:fO,onWebGLInitialized:fO,onResize:fO,onViewStateChange:fO,onInteractionStateChange:fO,onBeforeRender:fO,onAfterRender:fO,onLoad:fO,onError:e=>or.error(e.message,e.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:({isDragging:e})=>e?"grabbing":"grab",getTooltip:null,debug:!1,drawPickingColors:!1};class fN{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new uT.Stats({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=e=>{let{_pickRequest:t}=this;if("pointerleave"===e.type)t.x=-1,t.y=-1,t.radius=0;else{if(e.leftButton||e.rightButton)return;let i=e.offsetCenter;if(!i)return;t.x=i.x,t.y=i.y,t.radius=this.props.pickingRadius}this.layerManager&&(this.layerManager.context.mousePosition={x:t.x,y:t.y}),t.event=e},this._onEvent=e=>{let t=oK[e.type],i=e.offsetCenter;if(!t||!i||!this.layerManager)return;let r=this.layerManager.getLayers(),n=this.deckPicker.getLastPickedObject({x:i.x,y:i.y,layers:r,viewports:this.getViewports(i)},this._lastPointerDownInfo),{layer:a}=n,s=a&&(a[t]||a.props[t]),o=this.props[t],l=!1;s&&(l=s.call(a,n,e)),l||(o?.(n,e),this.widgetManager.onEvent(n,e))},this._onPointerDown=e=>{if(this.device?.type==="webgpu")return;let t=e.offsetCenter,i=this._pick("pickObject","pickObject Time",{x:t.x,y:t.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=i.result[0]||i.emptyInfo},this.props={...fR,...e},(e=this.props).viewState&&e.initialViewState&&or.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let t=this.device;if(!t&&e.gl){e.gl instanceof WebGLRenderingContext&&or.error("WebGL1 context not supported.")();const i=this.props.deviceProps?.onResize;t=fI.attach(e.gl,{...this.props.deviceProps,onResize:(e,t)=>{let{width:r,height:n}=e.canvas;e.drawingBufferWidth=r,e.drawingBufferHeight=n,this._needsRedraw="Canvas resized",i?.(e,t)}})}t||(t=this._createDevice(e)),this.animationLoop=this._createAnimationLoop(t,e),this.setProps(e),e._typedArrayManagerProps&&hG.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){this.animationLoop?.stop(),this.animationLoop?.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager?.finalize(),this.layerManager=null,this.viewManager?.finalize(),this.viewManager=null,this.effectManager?.finalize(),this.effectManager=null,this.deckRenderer?.finalize(),this.deckRenderer=null,this.deckPicker?.finalize(),this.deckPicker=null,this.eventManager?.destroy(),this.eventManager=null,this.widgetManager?.finalize(),this.widgetManager=null,this.props.canvas||this.props.device||this.props.gl||!this.canvas||(this.canvas.parentElement?.removeChild(this.canvas),this.canvas=null)}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&or.removed("onLayerHover","onHover")(),"onLayerClick"in e&&or.removed("onLayerClick","onClick")(),e.initialViewState&&!h6(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);let t=Object.create(this.props);Object.assign(t,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),e.device&&e.device.id!==this.device?.id&&(this.animationLoop?.stop(),this.canvas!==e.device.canvasContext?.canvas&&(this.canvas?.remove(),this.eventManager?.destroy(),this.canvas=null),or.log(`recreating animation loop for new device! id=${e.device.id}`)(),this.animationLoop=this._createAnimationLoop(e.device,e),this.animationLoop.start()),this.animationLoop?.setProps(t),void 0!==e.useDevicePixels&&this.device?.canvasContext&&this.device.canvasContext.setProps({useDevicePixels:e.useDevicePixels}),this.layerManager&&(this.viewManager.setProps(t),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(t),this.effectManager.setProps(t),this.deckRenderer.setProps(t),this.deckPicker.setProps(t),this.widgetManager.setProps(t)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);let i=this.viewManager.needsRedraw(e),r=this.layerManager.needsRedraw(e),n=this.effectManager.needsRedraw(e),a=this.deckRenderer.needsRedraw(e);return t||i||r||n||a}redraw(e){if(!this.layerManager)return;let t=this.needsRedraw({clearRedrawFlags:!0});(t=e||t)&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(t):this._drawLayers(t))}get isInitialized(){return null!==this.viewManager}getViews(){return dl(this.viewManager),this.viewManager.views}getViewports(e){return dl(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){let t=this._pick("pickObject","pickObject Time",e).result;return t.length?t[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,t=!1){for(let i in e)this.layerManager.resourceManager.add({resourceId:i,data:e[i],forceUpdate:t})}_removeResources(e){for(let t of e)this.layerManager.resourceManager.remove(t)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){this.layerManager?.removeDefaultShaderModule(e)}_pick(e,t,i){dl(this.deckPicker);let{stats:r}=this;r.get("Pick Count").incrementCount(),r.get(t).timeStart();let n=this.deckPicker[e]({layers:this.layerManager.getLayers(i),views:this.viewManager.getViews(),viewports:this.getViewports(i),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...i});return r.get(t).timeEnd(),n}_createCanvas(e){let t=e.canvas;return"string"==typeof t&&dl(t=document.getElementById(t)),t||((t=document.createElement("canvas")).id=e.id||"deckgl-overlay",e.width&&"number"==typeof e.width&&(t.width=e.width),e.height&&"number"==typeof e.height&&(t.height=e.height),(e.parent||document.body).appendChild(t)),Object.assign(t.style,e.style),t}_setCanvasSize(e){if(!this.canvas)return;let{width:t,height:i}=e;if(t||0===t){let e=Number.isFinite(t)?`${t}px`:t;this.canvas.style.width=e}if(i||0===i){let t=Number.isFinite(i)?`${i}px`:i;this.canvas.style.position=e.style?.position||"absolute",this.canvas.style.height=t}}_updateCanvasSize(){let{canvas:e}=this;if(!e)return;let t=e.clientWidth??e.width,i=e.clientHeight??e.height;(t!==this.width||i!==this.height)&&(this.width=t,this.height=i,this.viewManager?.setProps({width:t,height:i}),this.layerManager?.activateViewport(this.getViewports()[0]),this.props.onResize({width:t,height:i}))}_createAnimationLoop(e,t){let{gl:i,onError:r}=t;return new fD({device:e,autoResizeDrawingBuffer:!i,autoResizeViewport:!1,onInitialize:e=>this._setDevice(e.device),onRender:this._onRenderFrame.bind(this),onError:r})}_createDevice(e){let t=this.props.deviceProps?.createCanvasContext,i={adapters:[],...e.deviceProps};i.adapters.includes(fI)||i.adapters.push(fI);let r={alphaMode:this.props.deviceProps?.type==="webgpu"?"premultiplied":void 0},n=this.props.deviceProps?.onResize;return fk.createDevice({_reuseDevices:!0,type:"webgl",...i,createCanvasContext:{...r,..."object"==typeof t?t:void 0,canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!0},onResize:(e,t)=>{this._needsRedraw="Canvas resized",n?.(e,t)}})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let{views:e}=this.props,t=Array.isArray(e)?e:e?[e]:[new dP({id:"default-view"})];return t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){let{onError:e}=this.props;this.animationLoop&&e&&e(Error("WebGL context is lost"))}_pickAndCallback(){if(this.device?.type==="webgpu")return;let{_pickRequest:e}=this;if(e.event){let{result:t,emptyInfo:i}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=t.length>0;let r=i,n=!1;for(let i of t)r=i,n=i.layer?.onHover(i,e.event)||n;n||(this.props.onHover?.(r,e.event),this.widgetManager.onHover(r,e.event)),e.event=null}}_updateCursor(){let e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=this.device.canvasContext?.canvas,!this.canvas.isConnected&&this.props.parent&&this.props.parent.insertBefore(this.canvas,this.props.parent.firstChild)),"webgl"===this.device.type&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),"webgl"===this.device.type&&this.props.onWebGLInitialized(this.device.gl);let t=new n7;for(let e in t.play(),this.animationLoop.attachTimeline(t),this.eventManager=new oq(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(oZ).map(e=>{let[t,i,r,n]=oZ[e],a=this.props.eventRecognizerOptions?.[e];return{recognizer:new t({...i,...a,event:e}),recognizeWith:r,requestFailure:n}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}}),oK)this.eventManager.on(e,this._onEvent);this.viewManager=new h8({timeline:t,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});let i=this.viewManager.getViewports()[0];this.layerManager=new h5(this.device,{deck:this,stats:this.stats,viewport:i,timeline:t}),this.effectManager=new d$({deck:this,device:this.device}),this.deckRenderer=new dY(this.device),this.deckPicker=new d1(this.device),this.widgetManager=new d4({deck:this,parentElement:this.canvas?.parentElement}),this.widgetManager.addDefault(new d9),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,t){let{device:i,gl:r}=this.layerManager.context;this.props.onBeforeRender({device:i,gl:r});let n={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...t};this.deckRenderer?.renderLayers(n),"screen"===n.pass&&this.widgetManager.onRedraw({viewports:n.viewports,layers:n.layers}),this.props.onAfterRender({device:i,gl:r})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60==0&&(this._getMetrics(),this.stats.reset(),or.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this.device?.type!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){let t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:t},!this.props.viewState&&this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){let{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();let t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}_getMetrics(){let{metrics:e,stats:t}=this;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();let i=fk.stats.get("Memory Usage");e.bufferMemory=i.get("Buffer Memory").count,e.textureMemory=i.get("Texture Memory").count,e.renderbufferMemory=i.get("Renderbuffer Memory").count,e.gpuMemory=i.get("GPU Memory").count}}fN.defaultProps=fR,fN.VERSION=fy;let fj="undefined"!=typeof window?x.useLayoutEffect:x.useEffect;function fB(e,t){for(;e;){if(e===t)return!0;e=Object.getPrototypeOf(e)}return!1}var fF=e.i(34271),fz=e.i(20237),fV=e.i(80849);let fU=fV.getDataType;function f$(e,t,i){let r="webgpu"===i&&"uint8"===t.type?"unorm8":t.type;return{attribute:e,format:t.size>1?`${r}x${t.size}`:t.type,byteOffset:t.offset||0}}function fW(e){return e.stride||e.size*e.bytesPerElement}function fH(e,t){t.offset&&or.removed("shaderAttribute.offset","vertexOffset, elementOffset")();let i=fW(e),r=(void 0!==t.vertexOffset?t.vertexOffset:e.vertexOffset||0)*i+(t.elementOffset||0)*e.bytesPerElement+(e.offset||0);return{...t,offset:r,stride:i}}class fq{constructor(e,t,i){let r;this._buffer=null,this.device=e,this.id=t.id||"",this.size=t.size||1;const n=t.logicalType||t.type,a="float64"===n;let{defaultValue:s}=t;s=Number.isFinite(s)?[s]:s||Array(this.size).fill(0),r=a?"float32":!n&&t.isIndexed?"uint32":n||"float32";let o=function(e){switch(e){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return(0,fV.getTypedArrayConstructor)(e)}}(n||r);this.doublePrecision=a,a&&!1===t.fp64&&(o=Float32Array),this.value=null,this.settings={...t,defaultType:o,defaultValue:s,logicalType:n,type:r,normalized:r.includes("norm"),size:this.size,bytesPerElement:o.BYTES_PER_ELEMENT},this.state={...i,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){let e=this.getAccessor();return e.vertexOffset?e.vertexOffset*fW(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),hG.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,t=null){let i={};if(this.state.constant){let r=this.value;if(t){let n=fH(this.getAccessor(),t),a=n.offset/r.BYTES_PER_ELEMENT,s=n.size||this.size;i[e]=r.subarray(a,a+s)}else i[e]=r}else i[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?i[`${e}64Low`]=i[e]:i[`${e}64Low`]=new Float32Array(this.size)),i}_getBufferLayout(e=this.id,t=null){let i=this.getAccessor(),r=[],n={name:this.id,byteStride:fW(i),attributes:r};if(this.doublePrecision){let n,a={high:n=fH(i,t||{}),low:{...n,offset:n.offset+4*i.size}};r.push(f$(e,{...i,...a.high},this.device.type),f$(`${e}64Low`,{...i,...a.low},this.device.type))}else if(t){let n=fH(i,t);r.push(f$(e,{...i,...n},this.device.type))}else r.push(f$(e,i,this.device.type));return n}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){let t=Array.from(this.value);e=[t,t]}else{let{value:t,numInstances:i,size:r}=this,n=i*r;if(t&&n&&t.length>=n){let i=Array(r).fill(1/0),a=Array(r).fill(-1/0);for(let e=0;e<n;)for(let n=0;n<r;n++){let r=t[e++];r<i[n]&&(i[n]=r),r>a[n]&&(a[n]=r)}e=[i,a]}}return this.state.bounds=e,e}setData(e){let t,{state:i}=this;t=ArrayBuffer.isView(e)?{value:e}:e instanceof fF.Buffer?{buffer:e}:e;let r={...this.settings,...t};if(ArrayBuffer.isView(t.value)){if(!t.type)if(this.doublePrecision&&t.value instanceof Float64Array)r.type="float32";else{let e=fU(t.value);r.type=r.normalized?e.replace("int","norm"):e}r.bytesPerElement=t.value.BYTES_PER_ELEMENT,r.stride=fW(r)}if(i.bounds=null,t.constant){let e=t.value;if(e=this._normalizeValue(e,[],0),this.settings.normalized&&(e=this.normalizeConstant(e)),!(!i.constant||!this._areValuesEqual(e,this.value)))return!1;i.externalBuffer=null,i.constant=!0,this.value=ArrayBuffer.isView(e)?e:new Float32Array(e)}else if(t.buffer)i.externalBuffer=t.buffer,i.constant=!1,this.value=t.value||null;else if(t.value){this._checkExternalBuffer(t);let e=t.value;i.externalBuffer=null,i.constant=!1,this.value=e;let{buffer:n}=this,a=fW(r),s=(r.vertexOffset||0)*a;if(this.doublePrecision&&e instanceof Float64Array&&(e=hZ(e,r)),this.settings.isIndexed){let t=this.settings.defaultType;e.constructor!==t&&(e=new t(e))}let o=e.byteLength+s+2*a;(!n||n.byteLength<o)&&(n=this._createBuffer(o)),n.write(e,s)}return this.setAccessor(r),!0}updateSubBuffer(e={}){this.state.bounds=null;let t=this.value,{startOffset:i=0,endOffset:r}=e;this.buffer.write(this.doublePrecision&&t instanceof Float64Array?hZ(t,{size:this.size,startIndex:i,endIndex:r}):t.subarray(i,r),i*t.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,t=!1){let{state:i}=this,r=i.allocatedValue,n=hG.allocate(r,e+1,{size:this.size,type:this.settings.defaultType,copy:t});this.value=n;let{byteOffset:a}=this,{buffer:s}=this;return(!s||s.byteLength<n.byteLength+a)&&(s=this._createBuffer(n.byteLength+a),t&&r&&s.write(r instanceof Float64Array?hZ(r,this):r,a)),i.allocatedValue=n,i.constant=!1,i.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){let{value:t}=e;if(!ArrayBuffer.isView(t))throw Error(`Attribute ${this.id} value is not TypedArray`);let i=this.settings.defaultType,r=!1;if(this.doublePrecision&&(r=t.BYTES_PER_ELEMENT<4),r)throw Error(`Attribute ${this.id} does not support ${t.constructor.name}`);t instanceof i||!this.settings.normalized||"normalized"in e||or.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(e=>(e+128)/255*2-1);case"snorm16":return new Float32Array(e).map(e=>(e+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(e=>e/255);case"unorm16":return new Float32Array(e).map(e=>e/65535);default:return e}}_normalizeValue(e,t,i){let{defaultValue:r,size:n}=this.settings;if(Number.isFinite(e))return t[i]=e,t;if(!e){let e=n;for(;--e>=0;)t[i+e]=r[e];return t}switch(n){case 4:t[i+3]=Number.isFinite(e[3])?e[3]:r[3];case 3:t[i+2]=Number.isFinite(e[2])?e[2]:r[2];case 2:t[i+1]=Number.isFinite(e[1])?e[1]:r[1];case 1:t[i+0]=Number.isFinite(e[0])?e[0]:r[0];break;default:let a=n;for(;--a>=0;)t[i+a]=Number.isFinite(e[a])?e[a]:r[a]}return t}_areValuesEqual(e,t){if(!e||!t)return!1;let{size:i}=this;for(let r=0;r<i;r++)if(e[r]!==t[r])return!1;return!0}_createBuffer(e){this._buffer&&this._buffer.destroy();let{isIndexed:t,type:i}=this.settings;return this._buffer=this.device.createBuffer({...this._buffer?.props,id:this.id,usage:(t?fF.Buffer.INDEX:fF.Buffer.VERTEX)|fF.Buffer.COPY_DST,indexType:t?i:void 0,byteLength:e}),this._buffer}}let fG=[],fY=[];function fX(e){return e&&e[Symbol.asyncIterator]}let fK=[],fZ=[[0,1/0]],fJ={interpolation:{duration:0,easing:e=>e},spring:{stiffness:.05,damping:.5}};function fQ(e,t){if(!e)return null;Number.isFinite(e)&&(e={type:"interpolation",duration:e});let i=e.type||"interpolation";return{...fJ[i],...t,...e,type:i}}class f0 extends fq{constructor(e,t){super(e,t,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:fZ}),this.constant=!1,this.settings.update=t.update||(t.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){let t=this.state.needsRedraw;return this.state.needsRedraw=t&&!e,t}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var t,i;(t=this.state).layoutChanged||(i=this.getAccessor(),t.layoutChanged=e.type!==i.type||e.size!==i.size||fW(e)!==fW(i)||(e.offset||0)!==(i.offset||0)),super.setAccessor(e)}getUpdateTriggers(){let{accessor:e}=this.settings;return[this.id].concat("function"!=typeof e&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;let{accessor:t}=this.settings,i=this.settings.transition;return fQ(Array.isArray(t)?e[t.find(t=>e[t])]:e[t],i)}setNeedsUpdate(e=this.id,t){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){let{startRow:e=0,endRow:i=1/0}=t;this.state.updateRanges=function(e,t){if(e===fZ||(t[0]<0&&(t[0]=0),t[0]>=t[1]))return e;let i=[],r=e.length,n=0;for(let a=0;a<r;a++){let r=e[a];r[1]<t[0]?(i.push(r),n=a+1):r[0]>t[1]?i.push(r):t=[Math.min(r[0],t[0]),Math.max(r[1],t[1])]}return i.splice(n,0,t),i}(this.state.updateRanges,[e,i])}else this.state.updateRanges=fZ}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=fK}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){let{state:t,settings:i}=this;return!i.noAlloc&&!!i.update&&(super.allocate(e,t.updateRanges!==fZ),!0)}updateBuffer({numInstances:e,data:t,props:i,context:r}){if(!this.needsUpdate())return!1;let{state:{updateRanges:n},settings:{update:a,noAlloc:s}}=this,o=!0;if(a){for(let[s,o]of n)a.call(r,this,{data:t,startRow:s,endRow:o,props:i,numInstances:e});if(this.value)if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(let[t,i]of n){let r=Number.isFinite(t)?this.getVertexOffset(t):0,n=Number.isFinite(i)?this.getVertexOffset(i):s||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:r,endOffset:n})}this._checkAttributeArray()}else o=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),o}setConstantValue(e,t){let i="webgpu"===this.device.type;if(i||void 0===t||"function"==typeof t){if(i&&"function"!=typeof t){let e=this._normalizeValue(t,[],0);this._areValuesEqual(e,this.value)||this.setNeedsUpdate("WebGPU constant updated")}return!1}let r=this.settings.transform&&e?this.settings.transform.call(e,t):t;return this.setData({constant:!0,value:r})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0}setExternalBuffer(e){let{state:t}=this;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e),!0)):(t.lastExternalBuffer=null,!1)}setBinaryValue(e,t=null){let{state:i,settings:r}=this;if(!e)return i.binaryValue=null,i.binaryAccessor=null,!1;if(r.noAlloc)return!1;if(i.binaryValue===e)return this.clearNeedsUpdate(),!0;if(i.binaryValue=e,this.setNeedsRedraw(),r.transform||t!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});let n=e;dl(ArrayBuffer.isView(n.value),`invalid ${r.accessor}`);let a=!!n.size&&n.size!==this.size;return i.binaryAccessor=function(e,t){let{size:i,stride:r,offset:n,startIndices:a,nested:s}=t,o=e.BYTES_PER_ELEMENT,l=r?r/o:i,c=n?n/o:0,u=Math.floor((e.length-c)/l);return(t,{index:r,target:n})=>{let o;if(!a){let t=r*l+c;for(let r=0;r<i;r++)n[r]=e[t+r];return n}let h=a[r],d=a[r+1]||u;if(s){o=Array(d-h);for(let t=h;t<d;t++){let r=t*l+c;n=Array(i);for(let t=0;t<i;t++)n[t]=e[r+t];o[t-h]=n}}else if(l===i)o=e.subarray(h*i+c,d*i+c);else{o=new e.constructor((d-h)*i);let t=0;for(let r=h;r<d;r++){let n=r*l+c;for(let r=0;r<i;r++)o[t++]=e[n+r]}}return o}}(n.value,{size:n.size||this.size,stride:n.stride,offset:n.offset,startIndices:t,nested:a}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){let{startIndices:t}=this;return(t?e<t.length?t[e]:this.numInstances:e)*this.size}getValue(){let e=this.settings.shaderAttributes,t=super.getValue();if(!e)return t;for(let i in e)Object.assign(t,super.getValue(i,e[i]));return t}getBufferLayout(e){this.state.layoutChanged=!1;let t=this.settings.shaderAttributes,i=super._getBufferLayout(),{stepMode:r}=this.settings;if("dynamic"===r?i.stepMode=e?e.isInstanced?"instance":"vertex":"instance":i.stepMode=r??"vertex",!t)return i;for(let e in t){let r=super._getBufferLayout(e,t[e]);i.attributes.push(...r.attributes)}return i}_autoUpdater(e,{data:t,startRow:i,endRow:r,props:n,numInstances:a}){if(e.constant&&"webgpu"!==this.context.device.type)return;let{settings:s,state:o,value:l,size:c,startIndices:u}=e,{accessor:h,transform:d}=s,f=o.binaryAccessor||("function"==typeof h?h:n[h]);"function"!=typeof f&&"string"==typeof h&&(f=()=>n[h]),dl("function"==typeof f,`accessor "${h}" is not a function`);let p=e.getVertexOffset(i),{iterable:g,objectInfo:v}=function(e,t=0,i=1/0){let r=fG,n={index:-1,data:e,target:[]};return e?"function"==typeof e[Symbol.iterator]?r=e:e.length>0&&(fY.length=e.length,r=fY):r=fG,(t>0||Number.isFinite(i))&&(r=(Array.isArray(r)?r:Array.from(r)).slice(t,i),n.index=t-1),{iterable:r,objectInfo:n}}(t,i,r);for(let t of g){v.index++;let i=f(t,v);if(d&&(i=d.call(this,i)),u){let t=(v.index<u.length-1?u[v.index+1]:a)-u[v.index];if(i&&Array.isArray(i[0])){let t=p;for(let r of i)e._normalizeValue(r,l,t),t+=c}else i&&i.length>c?l.set(i,p):(e._normalizeValue(i,v.target,0),function({target:e,source:t,start:i=0,count:r=1}){let n=t.length,a=r*n,s=0;for(let r=i;s<n;s++)e[r++]=t[s];for(;s<a;)s<a-s?(e.copyWithin(i+s,i,i+s),s*=2):(e.copyWithin(i+s,i,i+a-s),s=a)}({target:l,source:v.target,start:p,count:t}));p+=t*c}else e._normalizeValue(i,l,p),p+=c}}_validateAttributeUpdaters(){let{settings:e}=this;if(!(e.noAlloc||"function"==typeof e.update))throw Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){let{value:e}=this,t=Math.min(4,this.size);if(e&&e.length>=t){let i=!0;switch(t){case 4:i=i&&Number.isFinite(e[3]);case 3:i=i&&Number.isFinite(e[2]);case 2:i=i&&Number.isFinite(e[1]);case 1:i=i&&Number.isFinite(e[0]);break;default:i=!1}if(!i)throw Error(`Illegal attribute generated for ${this.id}`)}}}let f1=`\
out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,f2=`#version 300 es
${f1}`;var f3=e.i(55392),f4=e.i(1506),f5=e.i(63909),f6=e.i(67125);function f8(e){return Array.isArray(e)?0===e.length||"number"==typeof e[0]:ArrayBuffer.isView(e)&&!(e instanceof DataView)}class f9{name;uniforms={};modifiedUniforms={};modified=!0;bindingLayout={};needsRedraw="initialized";constructor(e){if(this.name=e?.name||"unnamed",e?.name&&e?.shaderLayout){const t=e?.shaderLayout.bindings?.find(t=>"uniform"===t.type&&t.name===e?.name);if(!t)throw Error(e?.name);for(const e of t.uniforms||[])this.bindingLayout[e.name]=e}}setUniforms(e){for(let[t,i]of Object.entries(e))this._setUniform(t,i),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${t}=${i}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,t){!function(e,t,i=16){if(e!==t||!f8(e))return!1;if(f8(t)&&e.length===t.length){for(let i=0;i<e.length;++i)if(t[i]!==e[i])return!1}return!0}(this.uniforms[e],t)&&(this.uniforms[e]=f8(t)?t.slice():t,this.modifiedUniforms[e]=!0,this.modified=!0)}}var f7=e.i(30735),pe=e.i(48194);class pt{layout={};byteLength;constructor(e,t={}){let i=0;for(const[r,n]of Object.entries(e)){const{type:e,components:a}=(0,f7.getVariableShaderTypeInfo)(n),s=a*(t?.[r]??1),o=i=(0,fV.alignTo)(i,s);i+=s,this.layout[r]={type:e,size:s,offset:o}}const r=4*(i+=(4-i%4)%4);this.byteLength=Math.max(r,1024)}getData(e){let t=(0,pe.getScratchArrayBuffer)(this.byteLength),i={i32:new Int32Array(t),u32:new Uint32Array(t),f32:new Float32Array(t),f16:new Uint16Array(t)};for(let[t,r]of Object.entries(e)){let e=this.layout[t];if(!e){aS.log.warn(`Supplied uniform value ${t} not present in uniform block layout`)();continue}let{type:n,size:a,offset:s}=e,o=i[n];if(1===a){if("number"!=typeof r&&"boolean"!=typeof r){aS.log.warn(`Supplied value for single component uniform ${t} is not a number: ${r}`)();continue}o[s]=Number(r)}else{if(!f8(r)){aS.log.warn(`Supplied value for multi component / array uniform ${t} is not a numeric array: ${r}`)();continue}o.set(r,s)}}return new Uint8Array(t,0,this.byteLength)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}class pi{uniformBlocks=new Map;uniformBufferLayouts=new Map;uniformBuffers=new Map;constructor(e){for(const[t,i]of Object.entries(e)){const e=new pt(i.uniformTypes??{},i.uniformSizes??{});this.uniformBufferLayouts.set(t,e);const r=new f9({name:t});r.setUniforms(i.defaultUniforms||{}),this.uniformBlocks.set(t,r)}}destroy(){for(let e of this.uniformBuffers.values())e.destroy()}setUniforms(e){for(let[t,i]of Object.entries(e))this.uniformBlocks.get(t)?.setUniforms(i);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e)?.byteLength||0}getUniformBufferData(e){let t=this.uniformBlocks.get(e)?.getAllUniforms()||{};return this.uniformBufferLayouts.get(e)?.getData(t)}createUniformBuffer(e,t,i){i&&this.setUniforms(i);let r=this.getUniformBufferByteLength(t),n=e.createBuffer({usage:fF.Buffer.UNIFORM|fF.Buffer.COPY_DST,byteLength:r}),a=this.getUniformBufferData(t);return n.write(a),n}getManagedUniformBuffer(e,t){if(!this.uniformBuffers.get(t)){let i=this.getUniformBufferByteLength(t),r=e.createBuffer({usage:fF.Buffer.UNIFORM|fF.Buffer.COPY_DST,byteLength:i});this.uniformBuffers.set(t,r)}return this.uniformBuffers.get(t)}updateUniformBuffers(){let e=!1;for(let t of this.uniformBlocks.keys()){let i=this.updateUniformBuffer(t);e||=i}return e&&aS.log.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){let t=this.uniformBlocks.get(e),i=this.uniformBuffers.get(e),r=!1;if(i&&t?.needsRedraw){r||=t.needsRedraw;let n=this.getUniformBufferData(e);i=this.uniformBuffers.get(e),i?.write(n);let a=this.uniformBlocks.get(e)?.getAllUniforms();aS.log.log(4,`Writing to uniform buffer ${String(e)}`,n,a)()}return r}}var pr=e.i(88073);class pn{constructor(e,t){this.name=e,this.attributes=t,this.size=0}get isArray(){return!1}get isStruct(){return!1}get isTemplate(){return!1}get isPointer(){return!1}getTypeName(){return this.name}}class pa{constructor(e,t,i){this.name=e,this.type=t,this.attributes=i,this.offset=0,this.size=0}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class ps extends pn{constructor(e,t){super(e,t),this.members=[],this.align=0,this.startLine=-1,this.endLine=-1,this.inUse=!1}get isStruct(){return!0}}class po extends pn{constructor(e,t){super(e,t),this.count=0,this.stride=0}get isArray(){return!0}getTypeName(){return`array<${this.format.getTypeName()}, ${this.count}>`}}class pl extends pn{constructor(e,t,i){super(e,i),this.format=t}get isPointer(){return!0}getTypeName(){return`&${this.format.getTypeName()}`}}class pc extends pn{constructor(e,t,i,r){super(e,i),this.format=t,this.access=r}get isTemplate(){return!0}getTypeName(){let e=this.name;if(null!==this.format){if("vec2"===e||"vec3"===e||"vec4"===e||"mat2x2"===e||"mat2x3"===e||"mat2x4"===e||"mat3x2"===e||"mat3x3"===e||"mat3x4"===e||"mat4x2"===e||"mat4x3"===e||"mat4x4"===e){if("f32"===this.format.name)return e+"f";if("i32"===this.format.name)return e+"i";if("u32"===this.format.name)return e+"u";if("bool"===this.format.name)return e+"b";if("f16"===this.format.name)return e+"h"}e+=`<${this.format.name}>`}return e}}(Ee=Ef||(Ef={}))[Ee.Uniform=0]="Uniform",Ee[Ee.Storage=1]="Storage",Ee[Ee.Texture=2]="Texture",Ee[Ee.Sampler=3]="Sampler",Ee[Ee.StorageTexture=4]="StorageTexture";class pu{constructor(e,t,i,r,n,a,s){this.name=e,this.type=t,this.group=i,this.binding=r,this.attributes=n,this.resourceType=a,this.access=s}get isArray(){return this.type.isArray}get isStruct(){return this.type.isStruct}get isTemplate(){return this.type.isTemplate}get size(){return this.type.size}get align(){return this.type.isStruct?this.type.align:0}get members(){return this.type.isStruct?this.type.members:null}get format(){return this.type.isArray||this.type.isTemplate?this.type.format:null}get count(){return this.type.isArray?this.type.count:0}get stride(){return this.type.isArray?this.type.stride:this.size}}class ph{constructor(e,t){this.name=e,this.type=t}}class pd{constructor(e,t,i,r){this.name=e,this.type=t,this.locationType=i,this.location=r,this.interpolation=null}}class pf{constructor(e,t,i,r){this.name=e,this.type=t,this.locationType=i,this.location=r}}class pp{constructor(e,t,i,r){this.name=e,this.type=t,this.attributes=i,this.id=r}}class pg{constructor(e,t,i){this.name=e,this.type=t,this.attributes=i}}class pm{constructor(e,t=null,i){this.stage=null,this.inputs=[],this.outputs=[],this.arguments=[],this.returnType=null,this.resources=[],this.overrides=[],this.startLine=-1,this.endLine=-1,this.inUse=!1,this.calls=new Set,this.name=e,this.stage=t,this.attributes=i}}class pv{constructor(){this.vertex=[],this.fragment=[],this.compute=[]}}let py=new Float32Array(1),pb=new Int32Array(py.buffer),px=new Uint16Array(1),p_=new Uint32Array(1),pw=new Float32Array(p_.buffer,0,1);function pk(e){return p_[0]=112+(e>>6&31)<<23|(63&e)<<17,pw[0]}function pE(e,t,i,r){let n=[0,0,0,0];for(let a=0;a<r;++a)switch(i){case"8unorm":n[a]=e[t]/255,t++;break;case"8snorm":n[a]=e[t]/255*2-1,t++;break;case"8uint":n[a]=e[t],t++;break;case"8sint":n[a]=e[t]-127,t++;break;case"16uint":n[a]=e[t]|e[t+1]<<8,t+=2;break;case"16sint":n[a]=(e[t]|e[t+1]<<8)-32768,t+=2;break;case"16float":n[a]=function(e){var t=(32768&e)>>15,i=(31744&e)>>10,r=1023&e;return 0==i?(t?-1:1)*6103515625e-14*(r/1024):31==i?r?NaN:1/0*(t?-1:1):(t?-1:1)*Math.pow(2,i-15)*(1+r/1024)}(e[t]|e[t+1]<<8),t+=2;break;case"32uint":case"32sint":n[a]=e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24,t+=4;break;case"32float":n[a]=new Float32Array(e.buffer,t,1)[0],t+=4}return n}function pT(e,t,i,r,n){for(let a=0;a<r;++a)switch(i){case"8unorm":e[t]=255*n[a],t++;break;case"8snorm":e[t]=.5*(n[a]+1)*255,t++;break;case"8uint":e[t]=n[a],t++;break;case"8sint":e[t]=n[a]+127,t++;break;case"16uint":new Uint16Array(e.buffer,t,1)[0]=n[a],t+=2;break;case"16sint":new Int16Array(e.buffer,t,1)[0]=n[a],t+=2;break;case"16float":{let i=function(e){py[0]=e;let t=pb[0],i=t>>31&1,r=t>>23&255,n=8388607&t;if(255===r)return px[0]=i<<15|31744|512*(0!==n),px[0];if(0===r){if(0===n)return px[0]=i<<15,px[0];n|=8388608;let e=113;for(;!(8388608&n);)n<<=1,e--;return n&=8388607,(r=127-e)>0?(n=(n>>126-r)+(n>>127-r&1),px[0]=i<<15|r<<10|n>>13):px[0]=i<<15,px[0]}return(r=r-127+15)>=31?px[0]=i<<15|31744:r<=0?r<-10?px[0]=i<<15:(n=(8388608|n)>>1-r,px[0]=i<<15|n>>13):(n>>=13,px[0]=i<<15|r<<10|n),px[0]}(n[a]);new Uint16Array(e.buffer,t,1)[0]=i,t+=2;break}case"32uint":new Uint32Array(e.buffer,t,1)[0]=n[a],t+=4;break;case"32sint":new Int32Array(e.buffer,t,1)[0]=n[a],t+=4;break;case"32float":new Float32Array(e.buffer,t,1)[0]=n[a],t+=4}return n}let pP={r8unorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8snorm:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8uint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r8sint:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg8unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8snorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg8sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"rgba8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8snorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba8sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},bgra8unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bgra8unorm-srgb":{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r16uint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16sint:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r16float:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg16uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg16float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba16uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba16float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},r32uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32sint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},r32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:1},rg32uint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32sint:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rg32float:{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,channels:2},rgba32uint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32sint:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgba32float:{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2uint:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rgb10a2unorm:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},rg11b10ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},stencil8:{bytesPerBlock:1,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!1,hasStencil:!0,channels:1},depth16unorm:{bytesPerBlock:2,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},depth24plus:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,depthOnlyFormat:"depth32float",channels:1},"depth24plus-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,depthOnlyFormat:"depth32float",channels:1},depth32float:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!1,channels:1},"depth32float-stencil8":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!1,isDepthStencil:!0,hasDepth:!0,hasStencil:!0,stencilOnlyFormat:"depth32float",channels:1},rgb9e5ufloat:{bytesPerBlock:4,blockWidth:1,blockHeight:1,isCompressed:!1,channels:4},"bc1-rgba-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc1-rgba-unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc2-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc3-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc4-r-unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc4-r-snorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:1},"bc5-rg-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc5-rg-snorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:2},"bc6h-rgb-ufloat":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc6h-rgb-float":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"bc7-rgba-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgb8a1unorm-srgb":{bytesPerBlock:8,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"etc2-rgba8unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"eac-r11unorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-r11snorm":{bytesPerBlock:8,blockWidth:1,blockHeight:1,isCompressed:!0,channels:1},"eac-rg11unorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"eac-rg11snorm":{bytesPerBlock:16,blockWidth:1,blockHeight:1,isCompressed:!0,channels:2},"astc-4x4-unorm":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-4x4-unorm-srgb":{bytesPerBlock:16,blockWidth:4,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x4-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:4,isCompressed:!0,channels:4},"astc-5x5-unorm":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-5x5-unorm-srgb":{bytesPerBlock:16,blockWidth:5,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x5-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:5,isCompressed:!0,channels:4},"astc-6x6-unorm":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-6x6-unorm-srgb":{bytesPerBlock:16,blockWidth:6,blockHeight:6,isCompressed:!0,channels:4},"astc-8x5-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x5-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:5,isCompressed:!0,channels:4},"astc-8x6-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x6-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:6,isCompressed:!0,channels:4},"astc-8x8-unorm":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-8x8-unorm-srgb":{bytesPerBlock:16,blockWidth:8,blockHeight:8,isCompressed:!0,channels:4},"astc-10x5-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x5-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:5,isCompressed:!0,channels:4},"astc-10x6-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x6-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:6,isCompressed:!0,channels:4},"astc-10x8-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x8-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:8,isCompressed:!0,channels:4},"astc-10x10-unorm":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-10x10-unorm-srgb":{bytesPerBlock:16,blockWidth:10,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x10-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:10,isCompressed:!0,channels:4},"astc-12x12-unorm":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4},"astc-12x12-unorm-srgb":{bytesPerBlock:16,blockWidth:12,blockHeight:12,isCompressed:!0,channels:4}};class pS{constructor(){this.id=pS._id++,this.line=0}get isAstNode(){return!0}get astNodeType(){return""}search(e){e(this)}searchBlock(e,t){if(e){for(let i of(t(pM.instance),e))i instanceof Array?this.searchBlock(i,t):i.search(t);t(pC.instance)}}constEvaluate(e,t){throw Error("Cannot evaluate node")}constEvaluateString(e){return this.constEvaluate(e).toString()}}pS._id=0;class pM extends pS{}pM.instance=new pM;class pC extends pS{}pC.instance=new pC;let pA=new Set(["all","all","any","select","arrayLength","abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","clamp","cos","cosh","countLeadingZeros","countOneBits","countTrailingZeros","cross","degrees","determinant","distance","dot","dot4U8Packed","dot4I8Packed","exp","exp2","extractBits","faceForward","firstLeadingBit","firstTrailingBit","floor","fma","fract","frexp","insertBits","inverseSqrt","ldexp","length","log","log2","max","min","mix","modf","normalize","pow","quantizeToF16","radians","reflect","refract","reverseBits","round","saturate","sign","sin","sinh","smoothStep","sqrt","step","tan","tanh","transpose","trunc","dpdx","dpdxCoarse","dpdxFine","dpdy","dpdyCoarse","dpdyFine","fwidth","fwidthCoarse","fwidthFine","textureDimensions","textureGather","textureGatherCompare","textureLoad","textureNumLayers","textureNumLevels","textureNumSamples","textureSample","textureSampleBias","textureSampleCompare","textureSampleCompareLevel","textureSampleGrad","textureSampleLevel","textureSampleBaseClampToEdge","textureStore","atomicLoad","atomicStore","atomicAdd","atomicSub","atomicMax","atomicMin","atomicAnd","atomicOr","atomicXor","atomicExchange","atomicCompareExchangeWeak","pack4x8snorm","pack4x8unorm","pack4xI8","pack4xU8","pack4x8Clamp","pack4xU8Clamp","pack2x16snorm","pack2x16unorm","pack2x16float","unpack4x8snorm","unpack4x8unorm","unpack4xI8","unpack4xU8","unpack2x16snorm","unpack2x16unorm","unpack2x16float","storageBarrier","textureBarrier","workgroupBarrier","workgroupUniformLoad","subgroupAdd","subgroupExclusiveAdd","subgroupInclusiveAdd","subgroupAll","subgroupAnd","subgroupAny","subgroupBallot","subgroupBroadcast","subgroupBroadcastFirst","subgroupElect","subgroupMax","subgroupMin","subgroupMul","subgroupExclusiveMul","subgroupInclusiveMul","subgroupOr","subgroupShuffle","subgroupShuffleDown","subgroupShuffleUp","subgroupShuffleXor","subgroupXor","quadBroadcast","quadSwapDiagonal","quadSwapX","quadSwapY"]);class pI extends pS{constructor(){super()}}class pL extends pI{constructor(e,t,i,r,n,a){super(),this.calls=new Set,this.name=e,this.args=t,this.returnType=i,this.body=r,this.startLine=n,this.endLine=a}get astNodeType(){return"function"}search(e){if(this.attributes)for(let t of this.attributes)e(t);for(let t of(e(this),this.args))e(t);this.searchBlock(this.body,e)}}class pD extends pI{constructor(e){super(),this.expression=e}get astNodeType(){return"staticAssert"}search(e){this.expression.search(e)}}class pO extends pI{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"while"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class pR extends pI{constructor(e,t){super(),this.body=e,this.loopId=t}get astNodeType(){return"continuing"}search(e){this.searchBlock(this.body,e)}}class pN extends pI{constructor(e,t,i,r){super(),this.init=e,this.condition=t,this.increment=i,this.body=r}get astNodeType(){return"for"}search(e){var t,i,r;null==(t=this.init)||t.search(e),null==(i=this.condition)||i.search(e),null==(r=this.increment)||r.search(e),this.searchBlock(this.body,e)}}class pj extends pI{constructor(e,t,i,r,n){super(),this.attributes=null,this.name=e,this.type=t,this.storage=i,this.access=r,this.value=n}get astNodeType(){return"var"}search(e){var t;e(this),null==(t=this.value)||t.search(e)}}class pB extends pI{constructor(e,t,i){super(),this.attributes=null,this.name=e,this.type=t,this.value=i}get astNodeType(){return"override"}search(e){var t;null==(t=this.value)||t.search(e)}}class pF extends pI{constructor(e,t,i,r,n){super(),this.attributes=null,this.name=e,this.type=t,this.storage=i,this.access=r,this.value=n}get astNodeType(){return"let"}search(e){var t;e(this),null==(t=this.value)||t.search(e)}}class pz extends pI{constructor(e,t,i,r,n){super(),this.attributes=null,this.name=e,this.type=t,this.storage=i,this.access=r,this.value=n}get astNodeType(){return"const"}constEvaluate(e,t){return this.value.constEvaluate(e,t)}search(e){var t;e(this),null==(t=this.value)||t.search(e)}}(Et=Ep||(Ep={})).increment="++",Et.decrement="--",(Ei=Ep||(Ep={})).parse=function(e){if("parse"==e)throw Error("Invalid value for IncrementOperator");return Ei[e]};class pV extends pI{constructor(e,t){super(),this.operator=e,this.variable=t}get astNodeType(){return"increment"}search(e){this.variable.search(e)}}(Er=Eg||(Eg={})).assign="=",Er.addAssign="+=",Er.subtractAssin="-=",Er.multiplyAssign="*=",Er.divideAssign="/=",Er.moduloAssign="%=",Er.andAssign="&=",Er.orAssign="|=",Er.xorAssign="^=",Er.shiftLeftAssign="<<=",Er.shiftRightAssign=">>=",(Eg||(Eg={})).parse=function(e){if("parse"==e)throw Error("Invalid value for AssignOperator");return e};class pU extends pI{constructor(e,t,i){super(),this.operator=e,this.variable=t,this.value=i}get astNodeType(){return"assign"}search(e){this.variable.search(e),this.value.search(e)}}class p$ extends pI{constructor(e,t){super(),this.name=e,this.args=t}get astNodeType(){return"call"}isBuiltin(){return pA.has(this.name)}search(e){for(let t of this.args)t.search(e);e(this)}}class pW extends pI{constructor(e,t){super(),this.body=e,this.continuing=t}get astNodeType(){return"loop"}search(e){var t;this.searchBlock(this.body,e),null==(t=this.continuing)||t.search(e)}}class pH extends pI{constructor(e,t){super(),this.condition=e,this.cases=t}get astNodeType(){return"switch"}search(e){for(let t of(e(this),this.cases))t.search(e)}}class pq extends pI{constructor(e,t,i,r){super(),this.condition=e,this.body=t,this.elseif=i,this.else=r}get astNodeType(){return"if"}search(e){this.condition.search(e),this.searchBlock(this.body,e),this.searchBlock(this.elseif,e),this.searchBlock(this.else,e)}}class pG extends pI{constructor(e){super(),this.value=e}get astNodeType(){return"return"}search(e){var t;null==(t=this.value)||t.search(e)}}class pY extends pI{constructor(e){super(),this.name=e}get astNodeType(){return"enable"}}class pX extends pI{constructor(e){super(),this.extensions=e}get astNodeType(){return"requires"}}class pK extends pI{constructor(e,t){super(),this.severity=e,this.rule=t}get astNodeType(){return"diagnostic"}}class pZ extends pI{constructor(e,t){super(),this.name=e,this.type=t}get astNodeType(){return"alias"}}class pJ extends pI{constructor(){super()}get astNodeType(){return"discard"}}class pQ extends pI{constructor(){super(),this.condition=null,this.loopId=-1}get astNodeType(){return"break"}}class p0 extends pI{constructor(){super(),this.loopId=-1}get astNodeType(){return"continue"}}class p1 extends pI{constructor(e){super(),this.attributes=null,this.name=e}get astNodeType(){return"type"}get isStruct(){return!1}get isArray(){return!1}static maxFormatType(e){let t=e[0];if("f32"===t.name)return t;for(let i=1;i<e.length;++i){let r=p1._priority.get(t.name);p1._priority.get(e[i].name)<r&&(t=e[i])}return"x32"===t.name?p1.i32:t}getTypeName(){return this.name}}p1.x32=new p1("x32"),p1.f32=new p1("f32"),p1.i32=new p1("i32"),p1.u32=new p1("u32"),p1.f16=new p1("f16"),p1.bool=new p1("bool"),p1.void=new p1("void"),p1._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class p2 extends p1{constructor(e){super(e)}}class p3 extends p1{constructor(e,t,i,r){super(e),this.members=t,this.startLine=i,this.endLine=r}get astNodeType(){return"struct"}get isStruct(){return!0}getMemberIndex(e){for(let t=0;t<this.members.length;t++)if(this.members[t].name==e)return t;return -1}search(e){for(let t of this.members)e(t)}}class p4 extends p1{constructor(e,t,i){super(e),this.format=t,this.access=i}get astNodeType(){return"template"}getTypeName(){let e=this.name;if(null!==this.format){if("vec2"===e||"vec3"===e||"vec4"===e||"mat2x2"===e||"mat2x3"===e||"mat2x4"===e||"mat3x2"===e||"mat3x3"===e||"mat3x4"===e||"mat4x2"===e||"mat4x3"===e||"mat4x4"===e){if("f32"===this.format.name)return e+"f";if("i32"===this.format.name)return e+"i";if("u32"===this.format.name)return e+"u";if("bool"===this.format.name)return e+"b";if("f16"===this.format.name)return e+"h"}e+=`<${this.format.name}>`}return e}}p4.vec2f=new p4("vec2",p1.f32,null),p4.vec3f=new p4("vec3",p1.f32,null),p4.vec4f=new p4("vec4",p1.f32,null),p4.vec2i=new p4("vec2",p1.i32,null),p4.vec3i=new p4("vec3",p1.i32,null),p4.vec4i=new p4("vec4",p1.i32,null),p4.vec2u=new p4("vec2",p1.u32,null),p4.vec3u=new p4("vec3",p1.u32,null),p4.vec4u=new p4("vec4",p1.u32,null),p4.vec2h=new p4("vec2",p1.f16,null),p4.vec3h=new p4("vec3",p1.f16,null),p4.vec4h=new p4("vec4",p1.f16,null),p4.vec2b=new p4("vec2",p1.bool,null),p4.vec3b=new p4("vec3",p1.bool,null),p4.vec4b=new p4("vec4",p1.bool,null),p4.mat2x2f=new p4("mat2x2",p1.f32,null),p4.mat2x3f=new p4("mat2x3",p1.f32,null),p4.mat2x4f=new p4("mat2x4",p1.f32,null),p4.mat3x2f=new p4("mat3x2",p1.f32,null),p4.mat3x3f=new p4("mat3x3",p1.f32,null),p4.mat3x4f=new p4("mat3x4",p1.f32,null),p4.mat4x2f=new p4("mat4x2",p1.f32,null),p4.mat4x3f=new p4("mat4x3",p1.f32,null),p4.mat4x4f=new p4("mat4x4",p1.f32,null),p4.mat2x2h=new p4("mat2x2",p1.f16,null),p4.mat2x3h=new p4("mat2x3",p1.f16,null),p4.mat2x4h=new p4("mat2x4",p1.f16,null),p4.mat3x2h=new p4("mat3x2",p1.f16,null),p4.mat3x3h=new p4("mat3x3",p1.f16,null),p4.mat3x4h=new p4("mat3x4",p1.f16,null),p4.mat4x2h=new p4("mat4x2",p1.f16,null),p4.mat4x3h=new p4("mat4x3",p1.f16,null),p4.mat4x4h=new p4("mat4x4",p1.f16,null),p4.mat2x2i=new p4("mat2x2",p1.i32,null),p4.mat2x3i=new p4("mat2x3",p1.i32,null),p4.mat2x4i=new p4("mat2x4",p1.i32,null),p4.mat3x2i=new p4("mat3x2",p1.i32,null),p4.mat3x3i=new p4("mat3x3",p1.i32,null),p4.mat3x4i=new p4("mat3x4",p1.i32,null),p4.mat4x2i=new p4("mat4x2",p1.i32,null),p4.mat4x3i=new p4("mat4x3",p1.i32,null),p4.mat4x4i=new p4("mat4x4",p1.i32,null),p4.mat2x2u=new p4("mat2x2",p1.u32,null),p4.mat2x3u=new p4("mat2x3",p1.u32,null),p4.mat2x4u=new p4("mat2x4",p1.u32,null),p4.mat3x2u=new p4("mat3x2",p1.u32,null),p4.mat3x3u=new p4("mat3x3",p1.u32,null),p4.mat3x4u=new p4("mat3x4",p1.u32,null),p4.mat4x2u=new p4("mat4x2",p1.u32,null),p4.mat4x3u=new p4("mat4x3",p1.u32,null),p4.mat4x4u=new p4("mat4x4",p1.u32,null);class p5 extends p1{constructor(e,t,i,r){super(e),this.storage=t,this.type=i,this.access=r}get astNodeType(){return"pointer"}}class p6 extends p1{constructor(e,t,i,r){super(e),this.attributes=t,this.format=i,this.count=r}get astNodeType(){return"array"}get isArray(){return!0}}class p8 extends p1{constructor(e,t,i){super(e),this.format=t,this.access=i}get astNodeType(){return"sampler"}}class p9 extends pS{constructor(){super(),this.postfix=null}}class p7 extends p9{constructor(e){super(),this.value=e}get astNodeType(){return"stringExpr"}toString(){return this.value}constEvaluateString(){return this.value}}class ge extends p9{constructor(e,t){super(),this.type=e,this.args=t}get astNodeType(){return"createExpr"}search(e){if(e(this),this.args)for(let t of this.args)t.search(e)}constEvaluate(e,t){return t&&(t[0]=this.type),e.evalExpression(this,e.context)}}class gt extends p9{constructor(e,t){super(),this.cachedReturnValue=null,this.name=e,this.args=t}get astNodeType(){return"callExpr"}setCachedReturnValue(e){this.cachedReturnValue=e}get isBuiltin(){return pA.has(this.name)}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){for(let t of this.args)t.search(e);e(this)}}class gi extends p9{constructor(e){super(),this.name=e}get astNodeType(){return"varExpr"}search(e){e(this),this.postfix&&this.postfix.search(e)}constEvaluate(e,t){return e.evalExpression(this,e.context)}}class gr extends p9{constructor(e,t){super(),this.name=e,this.initializer=t}get astNodeType(){return"constExpr"}constEvaluate(e,t){if(this.initializer){let t=e.evalExpression(this.initializer,e.context);return null!==t&&this.postfix?t.getSubData(e,this.postfix,e.context):t}return null}search(e){this.initializer.search(e)}}class gn extends p9{constructor(e,t){super(),this.value=e,this.type=t}get astNodeType(){return"literalExpr"}constEvaluate(e,t){return void 0!==t&&(t[0]=this.type),this.value}get isScalar(){return this.value instanceof g_}get isVector(){return this.value instanceof gw||this.value instanceof gk}get scalarValue(){return this.value instanceof g_?this.value.value:(console.error("Value is not scalar."),0)}get vectorValue(){return this.value instanceof gw||this.value instanceof gk?this.value.data:(console.error("Value is not a vector or matrix."),new Float32Array(0))}}class ga extends p9{constructor(e,t){super(),this.type=e,this.value=t}get astNodeType(){return"bitcastExpr"}search(e){this.value.search(e)}}class gs extends p9{constructor(e){super(),this.index=e}search(e){this.index.search(e)}}class go extends p9{constructor(){super()}}class gl extends go{constructor(e,t){super(),this.operator=e,this.right=t}get astNodeType(){return"unaryOp"}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.right.search(e)}}class gc extends go{constructor(e,t,i){super(),this.operator=e,this.left=t,this.right=i}get astNodeType(){return"binaryOp"}_getPromotedType(e,t){return e.name===t.name?e:"f32"===e.name||"f32"===t.name?p1.f32:"u32"===e.name||"u32"===t.name?p1.u32:p1.i32}constEvaluate(e,t){return e.evalExpression(this,e.context)}search(e){this.left.search(e),this.right.search(e)}}class gu extends pS{constructor(e){super(),this.body=e}search(e){e(this),this.searchBlock(this.body,e)}}class gh extends p9{constructor(){super()}get astNodeType(){return"default"}}class gd extends gu{constructor(e,t){super(t),this.selectors=e}get astNodeType(){return"case"}search(e){this.searchBlock(this.body,e)}}class gf extends gu{constructor(e){super(e)}get astNodeType(){return"default"}search(e){this.searchBlock(this.body,e)}}class gp extends pS{constructor(e,t,i){super(),this.name=e,this.type=t,this.attributes=i}get astNodeType(){return"argument"}}class gg extends pS{constructor(e,t){super(),this.condition=e,this.body=t}get astNodeType(){return"elseif"}search(e){this.condition.search(e),this.searchBlock(this.body,e)}}class gm extends pS{constructor(e,t,i){super(),this.name=e,this.type=t,this.attributes=i}get astNodeType(){return"member"}}class gv extends pS{constructor(e,t){super(),this.name=e,this.value=t}get astNodeType(){return"attribute"}}class gy{constructor(e,t){this.parent=null,this.typeInfo=e,this.parent=t,this.id=gy._id++}clone(){throw`Clone: Not implemented for ${this.constructor.name}`}setDataValue(e,t,i,r){console.error(`SetDataValue: Not implemented for ${this.constructor.name}`)}getSubData(e,t,i){return console.error(`GetDataValue: Not implemented for ${this.constructor.name}`),null}toString(){return`<${this.typeInfo.getTypeName()}>`}}gy._id=0;class gb extends gy{constructor(){super(new pn("void",null),null)}toString(){return"void"}}gb.void=new gb;class gx extends gy{constructor(e){super(new pl("pointer",e.typeInfo,null),null),this.reference=e}clone(){return this}setDataValue(e,t,i,r){this.reference.setDataValue(e,t,i,r)}getSubData(e,t,i){return t?this.reference.getSubData(e,t,i):this}toString(){return`&${this.reference.toString()}`}}class g_ extends gy{constructor(e,t,i=null){super(t,i),e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array?this.data=e:"x32"===this.typeInfo.name?e-Math.floor(e)!=0?this.data=new Float32Array([e]):this.data=e>=0?new Uint32Array([e]):new Int32Array([e]):"i32"===this.typeInfo.name||"bool"===this.typeInfo.name?this.data=new Int32Array([e]):"u32"===this.typeInfo.name?this.data=new Uint32Array([e]):"f32"===this.typeInfo.name||"f16"===this.typeInfo.name?this.data=new Float32Array([e]):console.error("ScalarData2: Invalid type",t)}clone(){if(this.data instanceof Float32Array)return new g_(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new g_(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new g_(new Uint32Array(this.data),this.typeInfo,null);throw"ScalarData: Invalid data type"}get value(){return this.data[0]}set value(e){this.data[0]=e}setDataValue(e,t,i,r){if(i)return void console.error("SetDataValue: Scalar data does not support postfix",i);if(!(t instanceof g_))return void console.error("SetDataValue: Invalid value",t);let n=t.data[0];"i32"===this.typeInfo.name||"u32"===this.typeInfo.name?n=Math.floor(n):"bool"===this.typeInfo.name&&(n=+!!n),this.data[0]=n}getSubData(e,t,i){return t?(console.error("getSubData: Scalar data does not support postfix",t),null):this}toString(){return`${this.value}`}}class gw extends gy{constructor(e,t,i=null){if(super(t,i),e instanceof Float32Array||e instanceof Uint32Array||e instanceof Int32Array)this.data=e;else{const t=this.typeInfo.name;"vec2f"===t||"vec3f"===t||"vec4f"===t?this.data=new Float32Array(e):"vec2i"===t||"vec3i"===t||"vec4i"===t?this.data=new Int32Array(e):"vec2u"===t||"vec3u"===t||"vec4u"===t?this.data=new Uint32Array(e):"vec2h"===t||"vec3h"===t||"vec4h"===t?this.data=new Float32Array(e):"vec2b"===t||"vec3b"===t||"vec4b"===t?this.data=new Int32Array(e):"vec2"===t||"vec3"===t||"vec4"===t?this.data=new Float32Array(e):console.error(`VectorData: Invalid type ${t}`)}}clone(){if(this.data instanceof Float32Array)return new gw(new Float32Array(this.data),this.typeInfo,null);if(this.data instanceof Int32Array)return new gw(new Int32Array(this.data),this.typeInfo,null);if(this.data instanceof Uint32Array)return new gw(new Uint32Array(this.data),this.typeInfo,null);throw"VectorData: Invalid data type"}setDataValue(e,t,i,r){i instanceof p7?console.error("TODO: Set vector postfix"):t instanceof gw?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,i){if(null===t)return this;let r=e.getTypeInfo("f32");if(this.typeInfo instanceof pc)r=this.typeInfo.format||r;else{let t=this.typeInfo.name;"vec2f"===t||"vec3f"===t||"vec4f"===t?r=e.getTypeInfo("f32"):"vec2i"===t||"vec3i"===t||"vec4i"===t?r=e.getTypeInfo("i32"):"vec2b"===t||"vec3b"===t||"vec4b"===t?r=e.getTypeInfo("bool"):"vec2u"===t||"vec3u"===t||"vec4u"===t?r=e.getTypeInfo("u32"):"vec2h"===t||"vec3h"===t||"vec4h"===t?r=e.getTypeInfo("f16"):console.error(`GetSubData: Unknown type ${t}`)}let n=this;for(;null!==t&&null!==n;){if(t instanceof gs){let a=t.index,s=-1;if(a instanceof gn){if(!(a.value instanceof g_))return console.error(`GetSubData: Invalid array index ${a.value}`),null;s=a.value.value}else{let t=e.evalExpression(a,i);if(!(t instanceof g_))return console.error("GetSubData: Unknown index type",a),null;s=t.value}if(s<0||s>=n.data.length)return console.error("GetSubData: Index out of range",s),null;if(n.data instanceof Float32Array)return new g_(new Float32Array(n.data.buffer,n.data.byteOffset+4*s,1),r);if(n.data instanceof Int32Array)return new g_(new Int32Array(n.data.buffer,n.data.byteOffset+4*s,1),r);if(n.data instanceof Uint32Array)return new g_(new Uint32Array(n.data.buffer,n.data.byteOffset+4*s,1),r);throw"GetSubData: Invalid data type"}if(!(t instanceof p7))return console.error("GetSubData: Unknown postfix",t),null;{let i=t.value.toLowerCase();if(1===i.length){let e=0;if("x"===i||"r"===i)e=0;else if("y"===i||"g"===i)e=1;else if("z"===i||"b"===i)e=2;else{if("w"!==i&&"a"!==i)return console.error(`GetSubData: Unknown member ${i}`),null;e=3}if(this.data instanceof Float32Array)return new g_(new Float32Array(this.data.buffer,this.data.byteOffset+4*e,1),r,this);if(this.data instanceof Int32Array)return new g_(new Int32Array(this.data.buffer,this.data.byteOffset+4*e,1),r,this);if(this.data instanceof Uint32Array)return new g_(new Uint32Array(this.data.buffer,this.data.byteOffset+4*e,1),r,this)}let a=[];for(let e of i)"x"===e||"r"===e?a.push(this.data[0]):"y"===e||"g"===e?a.push(this.data[1]):"z"===e||"b"===e?a.push(this.data[2]):"w"===e||"a"===e?a.push(this.data[3]):console.error(`GetDataValue: Unknown member ${e}`);n=function(e,t,i){let r=t.length;return 2===r?"f32"===i?new gw(new Float32Array(t),e.getTypeInfo("vec2f")):"i32"===i||"bool"===i?new gw(new Int32Array(t),e.getTypeInfo("vec2i")):"u32"===i?new gw(new Uint32Array(t),e.getTypeInfo("vec2u")):"f16"===i?new gw(new Float32Array(t),e.getTypeInfo("vec2h")):(console.error(`getSubData: Unknown format ${i}`),null):3===r?"f32"===i?new gw(new Float32Array(t),e.getTypeInfo("vec3f")):"i32"===i||"bool"===i?new gw(new Int32Array(t),e.getTypeInfo("vec3i")):"u32"===i?new gw(new Uint32Array(t),e.getTypeInfo("vec3u")):"f16"===i?new gw(new Float32Array(t),e.getTypeInfo("vec3h")):(console.error(`getSubData: Unknown format ${i}`),null):4===r?"f32"===i?new gw(new Float32Array(t),e.getTypeInfo("vec4f")):"i32"===i||"bool"===i?new gw(new Int32Array(t),e.getTypeInfo("vec4i")):"u32"===i?new gw(new Uint32Array(t),e.getTypeInfo("vec4u")):"f16"===i?new gw(new Float32Array(t),e.getTypeInfo("vec4h")):(console.error(`getSubData: Unknown format ${i}`),null):(console.error(`getSubData: Invalid vector size ${t.length}`),null)}(e,a,r.name)}t=t.postfix}return n}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class gk extends gy{constructor(e,t,i=null){super(t,i),e instanceof Float32Array?this.data=e:this.data=new Float32Array(e)}clone(){return new gk(new Float32Array(this.data),this.typeInfo,null)}setDataValue(e,t,i,r){i instanceof p7?console.error("TODO: Set matrix postfix"):t instanceof gk?this.data=t.data:console.error("SetDataValue: Invalid value",t)}getSubData(e,t,i){if(null===t)return this;let r=this.typeInfo.name;if(e.getTypeInfo("f32"),this.typeInfo instanceof pc)this.typeInfo.format;else if(r.endsWith("f"))e.getTypeInfo("f32");else if(r.endsWith("i"))e.getTypeInfo("i32");else if(r.endsWith("u"))e.getTypeInfo("u32");else{if(!r.endsWith("h"))return console.error(`GetDataValue: Unknown type ${r}`),null;e.getTypeInfo("f16")}if(t instanceof gs){let n,a=t.index,s=-1;if(a instanceof gn){if(!(a.value instanceof g_))return console.error(`GetDataValue: Invalid array index ${a.value}`),null;s=a.value.value}else{let t=e.evalExpression(a,i);if(!(t instanceof g_))return console.error("GetDataValue: Unknown index type",a),null;s=t.value}if(s<0||s>=this.data.length)return console.error("GetDataValue: Index out of range",s),null;let o=r.endsWith("h")?"h":"f";if("mat2x2"===r||"mat2x2f"===r||"mat2x2h"===r||"mat3x2"===r||"mat3x2f"===r||"mat3x2h"===r||"mat4x2"===r||"mat4x2f"===r||"mat4x2h"===r)n=new gw(new Float32Array(this.data.buffer,this.data.byteOffset+2*s*4,2),e.getTypeInfo(`vec2${o}`));else if("mat2x3"===r||"mat2x3f"===r||"mat2x3h"===r||"mat3x3"===r||"mat3x3f"===r||"mat3x3h"===r||"mat4x3"===r||"mat4x3f"===r||"mat4x3h"===r)n=new gw(new Float32Array(this.data.buffer,this.data.byteOffset+3*s*4,3),e.getTypeInfo(`vec3${o}`));else{if("mat2x4"!==r&&"mat2x4f"!==r&&"mat2x4h"!==r&&"mat3x4"!==r&&"mat3x4f"!==r&&"mat3x4h"!==r&&"mat4x4"!==r&&"mat4x4f"!==r&&"mat4x4h"!==r)return console.error(`GetDataValue: Unknown type ${r}`),null;n=new gw(new Float32Array(this.data.buffer,this.data.byteOffset+4*s*4,4),e.getTypeInfo(`vec4${o}`))}return t.postfix?n.getSubData(e,t.postfix,i):n}return console.error("GetDataValue: Invalid postfix",t),null}toString(){let e=`${this.data[0]}`;for(let t=1;t<this.data.length;++t)e+=`, ${this.data[t]}`;return e}}class gE extends gy{constructor(e,t,i=0,r=null){super(t,r),this.buffer=e instanceof ArrayBuffer?e:e.buffer,this.offset=i}clone(){return new gE(new Uint8Array(new Uint8Array(this.buffer,this.offset,this.typeInfo.size)).buffer,this.typeInfo,0,null)}setDataValue(e,t,i,r){if(null===t)return void console.log("setDataValue: NULL data.");let n=this.offset,a=this.typeInfo;for(;i;){if(i instanceof gs)if(a instanceof po){let t=i.index;if(t instanceof gn){if(!(t.value instanceof g_))return void console.error(`SetDataValue: Invalid index type ${t.value}`);n+=t.value.value*a.stride}else{let i=e.evalExpression(t,r);if(!(i instanceof g_))return void console.error("SetDataValue: Unknown index type",t);n+=i.value*a.stride}a=a.format}else console.error(`SetDataValue: Type ${a.getTypeName()} is not an array`);else{if(!(i instanceof p7))return void console.error("SetDataValue: Unknown postfix type",i);{let e=i.value;if(a instanceof ps){let t=!1;for(let i of a.members)if(i.name===e){n+=i.offset,a=i.type,t=!0;break}if(!t)return void console.error(`SetDataValue: Member ${e} not found`)}else if(a instanceof pn){let i=a.getTypeName(),r=0;if("x"===e||"r"===e)r=0;else if("y"===e||"g"===e)r=1;else if("z"===e||"b"===e)r=2;else{if("w"!==e&&"a"!==e)return void console.error(`SetDataValue: Unknown member ${e}`);r=3}if(!(t instanceof g_))return void console.error("SetDataValue: Invalid value",t);let s=t.value;return"vec2f"===i?void(new Float32Array(this.buffer,n,2)[r]=s):"vec3f"===i?void(new Float32Array(this.buffer,n,3)[r]=s):"vec4f"===i?void(new Float32Array(this.buffer,n,4)[r]=s):"vec2i"===i?void(new Int32Array(this.buffer,n,2)[r]=s):"vec3i"===i?void(new Int32Array(this.buffer,n,3)[r]=s):"vec4i"===i?void(new Int32Array(this.buffer,n,4)[r]=s):"vec2u"===i?void(new Uint32Array(this.buffer,n,2)[r]=s):"vec3u"===i?void(new Uint32Array(this.buffer,n,3)[r]=s):"vec4u"===i?void(new Uint32Array(this.buffer,n,4)[r]=s):void console.error(`SetDataValue: Type ${i} is not a struct`)}}}i=i.postfix}this.setData(e,t,a,n,r)}setData(e,t,i,r,n){let a=i.getTypeName();if("f32"!==a&&"f16"!==a)if("i32"!==a&&"atomic<i32>"!==a&&"x32"!==a)if("u32"!==a&&"atomic<u32>"!==a)if("bool"!==a){if("vec2f"===a||"vec2h"===a){let e=new Float32Array(this.buffer,r,2);return void(t instanceof gw?(e[0]=t.data[0],e[1]=t.data[1]):(e[0]=t[0],e[1]=t[1]))}if("vec3f"===a||"vec3h"===a){let e=new Float32Array(this.buffer,r,3);return void(t instanceof gw?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2]):(e[0]=t[0],e[1]=t[1],e[2]=t[2]))}if("vec4f"===a||"vec4h"===a){let e=new Float32Array(this.buffer,r,4);return void(t instanceof gw?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]))}if("vec2i"===a){let e=new Int32Array(this.buffer,r,2);return void(t instanceof gw?(e[0]=t.data[0],e[1]=t.data[1]):(e[0]=t[0],e[1]=t[1]))}if("vec3i"===a){let e=new Int32Array(this.buffer,r,3);return void(t instanceof gw?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2]):(e[0]=t[0],e[1]=t[1],e[2]=t[2]))}if("vec4i"===a){let e=new Int32Array(this.buffer,r,4);return void(t instanceof gw?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]))}if("vec2u"===a){let e=new Uint32Array(this.buffer,r,2);return void(t instanceof gw?(e[0]=t.data[0],e[1]=t.data[1]):(e[0]=t[0],e[1]=t[1]))}if("vec3u"===a){let e=new Uint32Array(this.buffer,r,3);return void(t instanceof gw?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2]):(e[0]=t[0],e[1]=t[1],e[2]=t[2]))}if("vec4u"===a){let e=new Uint32Array(this.buffer,r,4);return void(t instanceof gw?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]))}if("vec2b"===a){let e=new Uint32Array(this.buffer,r,2);return void(t instanceof gw?(e[0]=t.data[0],e[1]=t.data[1]):(e[0]=t[0],e[1]=t[1]))}if("vec3b"===a){let e=new Uint32Array(this.buffer,r,3);return void(t instanceof gw?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2]):(e[0]=t[0],e[1]=t[1],e[2]=t[2]))}if("vec4b"===a){let e=new Uint32Array(this.buffer,r,4);return void(t instanceof gw?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]))}if("mat2x2f"===a||"mat2x2h"===a){let e=new Float32Array(this.buffer,r,4);return void(t instanceof gk?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3]))}if("mat2x3f"===a||"mat2x3h"===a){let e=new Float32Array(this.buffer,r,6);return void(t instanceof gk?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5]))}if("mat2x4f"===a||"mat2x4h"===a){let e=new Float32Array(this.buffer,r,8);return void(t instanceof gk?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7]))}if("mat3x2f"===a||"mat3x2h"===a){let e=new Float32Array(this.buffer,r,6);return void(t instanceof gk?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5]))}if("mat3x3f"===a||"mat3x3h"===a){let e=new Float32Array(this.buffer,r,9);return void(t instanceof gk?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7],e[8]=t.data[8]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8]))}if("mat3x4f"===a||"mat3x4h"===a){let e=new Float32Array(this.buffer,r,12);return void(t instanceof gk?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7],e[8]=t.data[8],e[9]=t.data[9],e[10]=t.data[10],e[11]=t.data[11]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11]))}if("mat4x2f"===a||"mat4x2h"===a){let e=new Float32Array(this.buffer,r,8);return void(t instanceof gk?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7]))}if("mat4x3f"===a||"mat4x3h"===a){let e=new Float32Array(this.buffer,r,12);return void(t instanceof gk?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7],e[8]=t.data[8],e[9]=t.data[9],e[10]=t.data[10],e[11]=t.data[11]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11]))}if("mat4x4f"===a||"mat4x4h"===a){let e=new Float32Array(this.buffer,r,16);return void(t instanceof gk?(e[0]=t.data[0],e[1]=t.data[1],e[2]=t.data[2],e[3]=t.data[3],e[4]=t.data[4],e[5]=t.data[5],e[6]=t.data[6],e[7]=t.data[7],e[8]=t.data[8],e[9]=t.data[9],e[10]=t.data[10],e[11]=t.data[11],e[12]=t.data[12],e[13]=t.data[13],e[14]=t.data[14],e[15]=t.data[15]):(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]))}if(t instanceof gE){if(i===t.typeInfo)return void new Uint8Array(this.buffer,r,t.buffer.byteLength).set(new Uint8Array(t.buffer));console.error("SetDataValue: Type mismatch",a,t.typeInfo.getTypeName())}else console.error(`SetData: Unknown type ${a}`)}else t instanceof g_&&(new Int32Array(this.buffer,r,1)[0]=t.value);else t instanceof g_&&(new Uint32Array(this.buffer,r,1)[0]=t.value);else t instanceof g_&&(new Int32Array(this.buffer,r,1)[0]=t.value);else t instanceof g_&&(new Float32Array(this.buffer,r,1)[0]=t.value)}getSubData(e,t,i){var r,n,a;if(null===t)return this;let s=this.offset,o=this.typeInfo;for(;t;){if(t instanceof gs){let r=t.index,n=r instanceof p9?e.evalExpression(r,i):r,a=0;if(n instanceof g_?a=n.value:"number"==typeof n?a=n:console.error("GetDataValue: Invalid index type",r),o instanceof po)s+=a*o.stride,o=o.format;else{let t=o.getTypeName();"mat4x4"===t||"mat4x4f"===t||"mat4x4h"===t?(s+=16*a,o=e.getTypeInfo("vec4f")):console.error(`getDataValue: Type ${o.getTypeName()} is not an array`)}}else{if(!(t instanceof p7))return console.error("GetDataValue: Unknown postfix type",t),null;{let i=t.value;if(o instanceof ps){let e=!1;for(let t of o.members)if(t.name===i){s+=t.offset,o=t.type,e=!0;break}if(!e)return console.error(`GetDataValue: Member ${i} not found`),null}else if(o instanceof pn){let t=o.getTypeName();if("vec2f"===t||"vec3f"===t||"vec4f"===t||"vec2i"===t||"vec3i"===t||"vec4i"===t||"vec2u"===t||"vec3u"===t||"vec4u"===t||"vec2b"===t||"vec3b"===t||"vec4b"===t||"vec2h"===t||"vec3h"===t||"vec4h"===t||"vec2"===t||"vec3"===t||"vec4"===t){if(i.length>0&&i.length<5){let r="f",n=[];for(let a=0;a<i.length;++a){let o=i[a].toLowerCase(),l=0;if("x"===o||"r"===o)l=0;else if("y"===o||"g"===o)l=1;else if("z"===o||"b"===o)l=2;else{if("w"!==o&&"a"!==o)return console.error(`Unknown member ${i}`),null;l=3}if(1===i.length){if(t.endsWith("f"))return this.buffer.byteLength<s+4*l+4?(console.log("Insufficient buffer data"),null):new g_(new Float32Array(this.buffer,s+4*l,1),e.getTypeInfo("f32"),this);if(t.endsWith("h"))return new g_(new Float32Array(this.buffer,s+4*l,1),e.getTypeInfo("f16"),this);if(t.endsWith("i"))return new g_(new Int32Array(this.buffer,s+4*l,1),e.getTypeInfo("i32"),this);if(t.endsWith("b"))return new g_(new Int32Array(this.buffer,s+4*l,1),e.getTypeInfo("bool"),this);if(t.endsWith("u"))return new g_(new Uint32Array(this.buffer,s+4*l,1),e.getTypeInfo("i32"),this)}if("vec2f"===t)n.push(new Float32Array(this.buffer,s,2)[l]);else if("vec3f"===t){if(s+12>=this.buffer.byteLength)return console.log("Insufficient buffer data"),null;let e=new Float32Array(this.buffer,s,3);n.push(e[l])}else if("vec4f"===t)n.push(new Float32Array(this.buffer,s,4)[l]);else if("vec2i"===t)r="i",n.push(new Int32Array(this.buffer,s,2)[l]);else if("vec3i"===t)r="i",n.push(new Int32Array(this.buffer,s,3)[l]);else if("vec4i"===t)r="i",n.push(new Int32Array(this.buffer,s,4)[l]);else if("vec2u"===t){r="u";let e=new Uint32Array(this.buffer,s,2);n.push(e[l])}else"vec3u"===t?(r="u",n.push(new Uint32Array(this.buffer,s,3)[l])):"vec4u"===t&&(r="u",n.push(new Uint32Array(this.buffer,s,4)[l]))}return 2===n.length?o=e.getTypeInfo(`vec2${r}`):3===n.length?o=e.getTypeInfo(`vec3${r}`):4===n.length?o=e.getTypeInfo(`vec4${r}`):console.error(`GetDataValue: Invalid vector length ${n.length}`),new gw(n,o,null)}return console.error(`GetDataValue: Unknown member ${i}`),null}return console.error(`GetDataValue: Type ${t} is not a struct`),null}}}t=t.postfix}let l=o.getTypeName();return"f32"===l?new g_(new Float32Array(this.buffer,s,1),o,this):"i32"===l?new g_(new Int32Array(this.buffer,s,1),o,this):"u32"===l?new g_(new Uint32Array(this.buffer,s,1),o,this):"vec2f"===l?new gw(new Float32Array(this.buffer,s,2),o,this):"vec3f"===l?new gw(new Float32Array(this.buffer,s,3),o,this):"vec4f"===l?new gw(new Float32Array(this.buffer,s,4),o,this):"vec2i"===l?new gw(new Int32Array(this.buffer,s,2),o,this):"vec3i"===l?new gw(new Int32Array(this.buffer,s,3),o,this):"vec4i"===l?new gw(new Int32Array(this.buffer,s,4),o,this):"vec2u"===l?new gw(new Uint32Array(this.buffer,s,2),o,this):"vec3u"===l?new gw(new Uint32Array(this.buffer,s,3),o,this):"vec4u"===l?new gw(new Uint32Array(this.buffer,s,4),o,this):o instanceof pc&&"atomic"===o.name?"u32"===(null==(r=o.format)?void 0:r.name)?new g_(new Uint32Array(this.buffer,s,1)[0],o.format,this):"i32"===(null==(n=o.format)?void 0:n.name)?new g_(new Int32Array(this.buffer,s,1)[0],o.format,this):(console.error(`GetDataValue: Invalid atomic format ${null==(a=o.format)?void 0:a.name}`),null):new gE(this.buffer,o,s,this)}toString(){let e="";if(this.typeInfo instanceof po)if("f32"===this.typeInfo.format.name){let t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let i=1;i<t.length;++i)e+=`, ${t[i]}`}else if("i32"===this.typeInfo.format.name){let t=new Int32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let i=1;i<t.length;++i)e+=`, ${t[i]}`}else if("u32"===this.typeInfo.format.name){let t=new Uint32Array(this.buffer,this.offset);e=`[${t[0]}`;for(let i=1;i<t.length;++i)e+=`, ${t[i]}`}else if("vec2f"===this.typeInfo.format.name){let t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}]`;for(let i=1;i<t.length/2;++i)e+=`, [${t[2*i]}, ${t[2*i+1]}]`}else if("vec3f"===this.typeInfo.format.name){let t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}]`;for(let i=4;i<t.length;i+=4)e+=`, [${t[i]}, ${t[i+1]}, ${t[i+2]}]`}else if("vec4f"===this.typeInfo.format.name){let t=new Float32Array(this.buffer,this.offset);e=`[${t[0]}, ${t[1]}, ${t[2]}, ${t[3]}]`;for(let i=4;i<t.length;i+=4)e+=`, [${t[i]}, ${t[i+1]}, ${t[i+2]}, ${t[i+3]}]`}else e="[...]";else this.typeInfo instanceof ps?e+="{...}":e="[...]";return e}}class gT extends gy{constructor(e,t,i,r){super(t,null),this.data=e,this.descriptor=i,this.view=r}clone(){return new gT(this.data,this.typeInfo,this.descriptor,this.view)}get width(){var e,t;let i=this.descriptor.size;return i instanceof Array&&i.length>0?null!=(e=i[0])?e:0:i instanceof Object&&null!=(t=i.width)?t:0}get height(){var e,t;let i=this.descriptor.size;return i instanceof Array&&i.length>1?null!=(e=i[1])?e:0:i instanceof Object&&null!=(t=i.height)?t:0}get depthOrArrayLayers(){var e,t;let i=this.descriptor.size;return i instanceof Array&&i.length>2?null!=(e=i[2])?e:0:i instanceof Object&&null!=(t=i.depthOrArrayLayers)?t:0}get format(){var e;return this.descriptor&&null!=(e=this.descriptor.format)?e:"rgba8unorm"}get sampleCount(){var e;return this.descriptor&&null!=(e=this.descriptor.sampleCount)?e:1}get mipLevelCount(){var e;return this.descriptor&&null!=(e=this.descriptor.mipLevelCount)?e:1}get dimension(){var e;return this.descriptor&&null!=(e=this.descriptor.dimension)?e:"2d"}getMipLevelSize(e){if(e>=this.mipLevelCount)return[0,0,0];let t=[this.width,this.height,this.depthOrArrayLayers];for(let i=0;i<t.length;++i)t[i]=Math.max(1,t[i]>>e);return t}get texelByteSize(){let e=pP[this.format];return e?e.isDepthStencil?4:e.bytesPerBlock:0}get bytesPerRow(){return this.width*this.texelByteSize}get isDepthStencil(){let e=pP[this.format];return!!e&&e.isDepthStencil}getGpuSize(){let e=this.format,t=pP[e],i=this.width;if(!e||i<=0||!t)return -1;let r=this.height,n=this.depthOrArrayLayers,a=this.dimension;return i/t.blockWidth*("1d"===a?1:r/t.blockHeight)*t.bytesPerBlock*n}getPixel(e,t,i=0,r=0){let n=this.texelByteSize,a=this.bytesPerRow,s=this.height;return function(e,t,i,r,n,a,s,o,l){let c=r*(s>>=n)*(a>>=n)+i*s+t*o;switch(l){case"r8unorm":return[pE(e,c,"8unorm",1)[0]];case"r8snorm":return[pE(e,c,"8snorm",1)[0]];case"r8uint":return[pE(e,c,"8uint",1)[0]];case"r8sint":return[pE(e,c,"8sint",1)[0]];case"rg8unorm":{let t=pE(e,c,"8unorm",2);return[t[0],t[1]]}case"rg8snorm":{let t=pE(e,c,"8snorm",2);return[t[0],t[1]]}case"rg8uint":{let t=pE(e,c,"8uint",2);return[t[0],t[1]]}case"rg8sint":{let t=pE(e,c,"8sint",2);return[t[0],t[1]]}case"rgba8unorm-srgb":case"rgba8unorm":{let t=pE(e,c,"8unorm",4);return[t[0],t[1],t[2],t[3]]}case"rgba8snorm":{let t=pE(e,c,"8snorm",4);return[t[0],t[1],t[2],t[3]]}case"rgba8uint":{let t=pE(e,c,"8uint",4);return[t[0],t[1],t[2],t[3]]}case"rgba8sint":{let t=pE(e,c,"8sint",4);return[t[0],t[1],t[2],t[3]]}case"bgra8unorm-srgb":case"bgra8unorm":{let t=pE(e,c,"8unorm",4);return[t[2],t[1],t[0],t[3]]}case"r16uint":return[pE(e,c,"16uint",1)[0]];case"r16sint":return[pE(e,c,"16sint",1)[0]];case"r16float":return[pE(e,c,"16float",1)[0]];case"rg16uint":{let t=pE(e,c,"16uint",2);return[t[0],t[1]]}case"rg16sint":{let t=pE(e,c,"16sint",2);return[t[0],t[1]]}case"rg16float":{let t=pE(e,c,"16float",2);return[t[0],t[1]]}case"rgba16uint":{let t=pE(e,c,"16uint",4);return[t[0],t[1],t[2],t[3]]}case"rgba16sint":{let t=pE(e,c,"16sint",4);return[t[0],t[1],t[2],t[3]]}case"rgba16float":{let t=pE(e,c,"16float",4);return[t[0],t[1],t[2],t[3]]}case"r32uint":return[pE(e,c,"32uint",1)[0]];case"r32sint":return[pE(e,c,"32sint",1)[0]];case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return[pE(e,c,"32float",1)[0]];case"rg32uint":{let t=pE(e,c,"32uint",2);return[t[0],t[1]]}case"rg32sint":{let t=pE(e,c,"32sint",2);return[t[0],t[1]]}case"rg32float":{let t=pE(e,c,"32float",2);return[t[0],t[1]]}case"rgba32uint":{let t=pE(e,c,"32uint",4);return[t[0],t[1],t[2],t[3]]}case"rgba32sint":{let t=pE(e,c,"32sint",4);return[t[0],t[1],t[2],t[3]]}case"rgba32float":{let t=pE(e,c,"32float",4);return[t[0],t[1],t[2],t[3]]}case"rg11b10ufloat":{var u;let t=new Uint32Array(e.buffer,c,1)[0];return[pk(2047&t),pk((4192256&t)>>11),(u=(0xffc00000&t)>>22,p_[0]=112+(u>>5&31)<<23|(31&u)<<18,pw[0]),1]}}return null}(new Uint8Array(this.data[r]),e,t,i,r,s,a,n,this.format)}setPixel(e,t,i,r,n){let a=this.texelByteSize,s=this.bytesPerRow,o=this.height;!function(e,t,i,r,n,a,s,o,l,c){let u=r*(s>>=n)*(a>>=n)+i*s+t*o;switch(l){case"r8unorm":return pT(e,u,"8unorm",1,c);case"r8snorm":return pT(e,u,"8snorm",1,c);case"r8uint":return pT(e,u,"8uint",1,c);case"r8sint":return pT(e,u,"8sint",1,c);case"rg8unorm":return pT(e,u,"8unorm",2,c);case"rg8snorm":return pT(e,u,"8snorm",2,c);case"rg8uint":return pT(e,u,"8uint",2,c);case"rg8sint":return pT(e,u,"8sint",2,c);case"rgba8unorm-srgb":case"rgba8unorm":case"bgra8unorm-srgb":case"bgra8unorm":return pT(e,u,"8unorm",4,c);case"rgba8snorm":return pT(e,u,"8snorm",4,c);case"rgba8uint":return pT(e,u,"8uint",4,c);case"rgba8sint":return pT(e,u,"8sint",4,c);case"r16uint":return pT(e,u,"16uint",1,c);case"r16sint":return pT(e,u,"16sint",1,c);case"r16float":return pT(e,u,"16float",1,c);case"rg16uint":return pT(e,u,"16uint",2,c);case"rg16sint":return pT(e,u,"16sint",2,c);case"rg16float":return pT(e,u,"16float",2,c);case"rgba16uint":return pT(e,u,"16uint",4,c);case"rgba16sint":return pT(e,u,"16sint",4,c);case"rgba16float":return pT(e,u,"16float",4,c);case"r32uint":return pT(e,u,"32uint",1,c);case"r32sint":return pT(e,u,"32sint",1,c);case"depth16unorm":case"depth24plus":case"depth24plus-stencil8":case"depth32float":case"depth32float-stencil8":case"r32float":return pT(e,u,"32float",1,c);case"rg32uint":return pT(e,u,"32uint",2,c);case"rg32sint":return pT(e,u,"32sint",2,c);case"rg32float":return pT(e,u,"32float",2,c);case"rgba32uint":return pT(e,u,"32uint",4,c);case"rgba32sint":return pT(e,u,"32sint",4,c);case"rgba32float":return pT(e,u,"32float",4,c);case"rg11b10ufloat":console.error("TODO: rg11b10ufloat not supported for writing")}}(new Uint8Array(this.data[r]),e,t,i,r,o,s,a,this.format,n)}}(En=Em||(Em={}))[En.token=0]="token",En[En.keyword=1]="keyword",En[En.reserved=2]="reserved";class gP{constructor(e,t,i){this.name=e,this.type=t,this.rule=i}toString(){return this.name}}class gS{}gS.none=new gP("",Em.reserved,""),gS.eof=new gP("EOF",Em.token,""),gS.reserved={asm:new gP("asm",Em.reserved,"asm"),bf16:new gP("bf16",Em.reserved,"bf16"),do:new gP("do",Em.reserved,"do"),enum:new gP("enum",Em.reserved,"enum"),f16:new gP("f16",Em.reserved,"f16"),f64:new gP("f64",Em.reserved,"f64"),handle:new gP("handle",Em.reserved,"handle"),i8:new gP("i8",Em.reserved,"i8"),i16:new gP("i16",Em.reserved,"i16"),i64:new gP("i64",Em.reserved,"i64"),mat:new gP("mat",Em.reserved,"mat"),premerge:new gP("premerge",Em.reserved,"premerge"),regardless:new gP("regardless",Em.reserved,"regardless"),typedef:new gP("typedef",Em.reserved,"typedef"),u8:new gP("u8",Em.reserved,"u8"),u16:new gP("u16",Em.reserved,"u16"),u64:new gP("u64",Em.reserved,"u64"),unless:new gP("unless",Em.reserved,"unless"),using:new gP("using",Em.reserved,"using"),vec:new gP("vec",Em.reserved,"vec"),void:new gP("void",Em.reserved,"void")},gS.keywords={array:new gP("array",Em.keyword,"array"),atomic:new gP("atomic",Em.keyword,"atomic"),bool:new gP("bool",Em.keyword,"bool"),f32:new gP("f32",Em.keyword,"f32"),i32:new gP("i32",Em.keyword,"i32"),mat2x2:new gP("mat2x2",Em.keyword,"mat2x2"),mat2x3:new gP("mat2x3",Em.keyword,"mat2x3"),mat2x4:new gP("mat2x4",Em.keyword,"mat2x4"),mat3x2:new gP("mat3x2",Em.keyword,"mat3x2"),mat3x3:new gP("mat3x3",Em.keyword,"mat3x3"),mat3x4:new gP("mat3x4",Em.keyword,"mat3x4"),mat4x2:new gP("mat4x2",Em.keyword,"mat4x2"),mat4x3:new gP("mat4x3",Em.keyword,"mat4x3"),mat4x4:new gP("mat4x4",Em.keyword,"mat4x4"),ptr:new gP("ptr",Em.keyword,"ptr"),sampler:new gP("sampler",Em.keyword,"sampler"),sampler_comparison:new gP("sampler_comparison",Em.keyword,"sampler_comparison"),struct:new gP("struct",Em.keyword,"struct"),texture_1d:new gP("texture_1d",Em.keyword,"texture_1d"),texture_2d:new gP("texture_2d",Em.keyword,"texture_2d"),texture_2d_array:new gP("texture_2d_array",Em.keyword,"texture_2d_array"),texture_3d:new gP("texture_3d",Em.keyword,"texture_3d"),texture_cube:new gP("texture_cube",Em.keyword,"texture_cube"),texture_cube_array:new gP("texture_cube_array",Em.keyword,"texture_cube_array"),texture_multisampled_2d:new gP("texture_multisampled_2d",Em.keyword,"texture_multisampled_2d"),texture_storage_1d:new gP("texture_storage_1d",Em.keyword,"texture_storage_1d"),texture_storage_2d:new gP("texture_storage_2d",Em.keyword,"texture_storage_2d"),texture_storage_2d_array:new gP("texture_storage_2d_array",Em.keyword,"texture_storage_2d_array"),texture_storage_3d:new gP("texture_storage_3d",Em.keyword,"texture_storage_3d"),texture_depth_2d:new gP("texture_depth_2d",Em.keyword,"texture_depth_2d"),texture_depth_2d_array:new gP("texture_depth_2d_array",Em.keyword,"texture_depth_2d_array"),texture_depth_cube:new gP("texture_depth_cube",Em.keyword,"texture_depth_cube"),texture_depth_cube_array:new gP("texture_depth_cube_array",Em.keyword,"texture_depth_cube_array"),texture_depth_multisampled_2d:new gP("texture_depth_multisampled_2d",Em.keyword,"texture_depth_multisampled_2d"),texture_external:new gP("texture_external",Em.keyword,"texture_external"),u32:new gP("u32",Em.keyword,"u32"),vec2:new gP("vec2",Em.keyword,"vec2"),vec3:new gP("vec3",Em.keyword,"vec3"),vec4:new gP("vec4",Em.keyword,"vec4"),bitcast:new gP("bitcast",Em.keyword,"bitcast"),block:new gP("block",Em.keyword,"block"),break:new gP("break",Em.keyword,"break"),case:new gP("case",Em.keyword,"case"),continue:new gP("continue",Em.keyword,"continue"),continuing:new gP("continuing",Em.keyword,"continuing"),default:new gP("default",Em.keyword,"default"),diagnostic:new gP("diagnostic",Em.keyword,"diagnostic"),discard:new gP("discard",Em.keyword,"discard"),else:new gP("else",Em.keyword,"else"),enable:new gP("enable",Em.keyword,"enable"),fallthrough:new gP("fallthrough",Em.keyword,"fallthrough"),false:new gP("false",Em.keyword,"false"),fn:new gP("fn",Em.keyword,"fn"),for:new gP("for",Em.keyword,"for"),function:new gP("function",Em.keyword,"function"),if:new gP("if",Em.keyword,"if"),let:new gP("let",Em.keyword,"let"),const:new gP("const",Em.keyword,"const"),loop:new gP("loop",Em.keyword,"loop"),while:new gP("while",Em.keyword,"while"),private:new gP("private",Em.keyword,"private"),read:new gP("read",Em.keyword,"read"),read_write:new gP("read_write",Em.keyword,"read_write"),return:new gP("return",Em.keyword,"return"),requires:new gP("requires",Em.keyword,"requires"),storage:new gP("storage",Em.keyword,"storage"),switch:new gP("switch",Em.keyword,"switch"),true:new gP("true",Em.keyword,"true"),alias:new gP("alias",Em.keyword,"alias"),type:new gP("type",Em.keyword,"type"),uniform:new gP("uniform",Em.keyword,"uniform"),var:new gP("var",Em.keyword,"var"),override:new gP("override",Em.keyword,"override"),workgroup:new gP("workgroup",Em.keyword,"workgroup"),write:new gP("write",Em.keyword,"write"),r8unorm:new gP("r8unorm",Em.keyword,"r8unorm"),r8snorm:new gP("r8snorm",Em.keyword,"r8snorm"),r8uint:new gP("r8uint",Em.keyword,"r8uint"),r8sint:new gP("r8sint",Em.keyword,"r8sint"),r16uint:new gP("r16uint",Em.keyword,"r16uint"),r16sint:new gP("r16sint",Em.keyword,"r16sint"),r16float:new gP("r16float",Em.keyword,"r16float"),rg8unorm:new gP("rg8unorm",Em.keyword,"rg8unorm"),rg8snorm:new gP("rg8snorm",Em.keyword,"rg8snorm"),rg8uint:new gP("rg8uint",Em.keyword,"rg8uint"),rg8sint:new gP("rg8sint",Em.keyword,"rg8sint"),r32uint:new gP("r32uint",Em.keyword,"r32uint"),r32sint:new gP("r32sint",Em.keyword,"r32sint"),r32float:new gP("r32float",Em.keyword,"r32float"),rg16uint:new gP("rg16uint",Em.keyword,"rg16uint"),rg16sint:new gP("rg16sint",Em.keyword,"rg16sint"),rg16float:new gP("rg16float",Em.keyword,"rg16float"),rgba8unorm:new gP("rgba8unorm",Em.keyword,"rgba8unorm"),rgba8unorm_srgb:new gP("rgba8unorm_srgb",Em.keyword,"rgba8unorm_srgb"),rgba8snorm:new gP("rgba8snorm",Em.keyword,"rgba8snorm"),rgba8uint:new gP("rgba8uint",Em.keyword,"rgba8uint"),rgba8sint:new gP("rgba8sint",Em.keyword,"rgba8sint"),bgra8unorm:new gP("bgra8unorm",Em.keyword,"bgra8unorm"),bgra8unorm_srgb:new gP("bgra8unorm_srgb",Em.keyword,"bgra8unorm_srgb"),rgb10a2unorm:new gP("rgb10a2unorm",Em.keyword,"rgb10a2unorm"),rg11b10float:new gP("rg11b10float",Em.keyword,"rg11b10float"),rg32uint:new gP("rg32uint",Em.keyword,"rg32uint"),rg32sint:new gP("rg32sint",Em.keyword,"rg32sint"),rg32float:new gP("rg32float",Em.keyword,"rg32float"),rgba16uint:new gP("rgba16uint",Em.keyword,"rgba16uint"),rgba16sint:new gP("rgba16sint",Em.keyword,"rgba16sint"),rgba16float:new gP("rgba16float",Em.keyword,"rgba16float"),rgba32uint:new gP("rgba32uint",Em.keyword,"rgba32uint"),rgba32sint:new gP("rgba32sint",Em.keyword,"rgba32sint"),rgba32float:new gP("rgba32float",Em.keyword,"rgba32float"),static_assert:new gP("static_assert",Em.keyword,"static_assert")},gS.tokens={decimal_float_literal:new gP("decimal_float_literal",Em.token,/((-?[0-9]*\.[0-9]+|-?[0-9]+\.[0-9]*)((e|E)(\+|-)?[0-9]+)?[fh]?)|(-?[0-9]+(e|E)(\+|-)?[0-9]+[fh]?)|(-?[0-9]+[fh])/),hex_float_literal:new gP("hex_float_literal",Em.token,/-?0x((([0-9a-fA-F]*\.[0-9a-fA-F]+|[0-9a-fA-F]+\.[0-9a-fA-F]*)((p|P)(\+|-)?[0-9]+[fh]?)?)|([0-9a-fA-F]+(p|P)(\+|-)?[0-9]+[fh]?))/),int_literal:new gP("int_literal",Em.token,/-?0x[0-9a-fA-F]+|0i?|-?[1-9][0-9]*i?/),uint_literal:new gP("uint_literal",Em.token,/0x[0-9a-fA-F]+u|0u|[1-9][0-9]*u/),name:new gP("name",Em.token,/([_\p{XID_Start}][\p{XID_Continue}]+)|([\p{XID_Start}])/u),ident:new gP("ident",Em.token,/[_a-zA-Z][0-9a-zA-Z_]*/),and:new gP("and",Em.token,"&"),and_and:new gP("and_and",Em.token,"&&"),arrow:new gP("arrow ",Em.token,"->"),attr:new gP("attr",Em.token,"@"),forward_slash:new gP("forward_slash",Em.token,"/"),bang:new gP("bang",Em.token,"!"),bracket_left:new gP("bracket_left",Em.token,"["),bracket_right:new gP("bracket_right",Em.token,"]"),brace_left:new gP("brace_left",Em.token,"{"),brace_right:new gP("brace_right",Em.token,"}"),colon:new gP("colon",Em.token,":"),comma:new gP("comma",Em.token,","),equal:new gP("equal",Em.token,"="),equal_equal:new gP("equal_equal",Em.token,"=="),not_equal:new gP("not_equal",Em.token,"!="),greater_than:new gP("greater_than",Em.token,">"),greater_than_equal:new gP("greater_than_equal",Em.token,">="),shift_right:new gP("shift_right",Em.token,">>"),less_than:new gP("less_than",Em.token,"<"),less_than_equal:new gP("less_than_equal",Em.token,"<="),shift_left:new gP("shift_left",Em.token,"<<"),modulo:new gP("modulo",Em.token,"%"),minus:new gP("minus",Em.token,"-"),minus_minus:new gP("minus_minus",Em.token,"--"),period:new gP("period",Em.token,"."),plus:new gP("plus",Em.token,"+"),plus_plus:new gP("plus_plus",Em.token,"++"),or:new gP("or",Em.token,"|"),or_or:new gP("or_or",Em.token,"||"),paren_left:new gP("paren_left",Em.token,"("),paren_right:new gP("paren_right",Em.token,")"),semicolon:new gP("semicolon",Em.token,";"),star:new gP("star",Em.token,"*"),tilde:new gP("tilde",Em.token,"~"),underscore:new gP("underscore",Em.token,"_"),xor:new gP("xor",Em.token,"^"),plus_equal:new gP("plus_equal",Em.token,"+="),minus_equal:new gP("minus_equal",Em.token,"-="),times_equal:new gP("times_equal",Em.token,"*="),division_equal:new gP("division_equal",Em.token,"/="),modulo_equal:new gP("modulo_equal",Em.token,"%="),and_equal:new gP("and_equal",Em.token,"&="),or_equal:new gP("or_equal",Em.token,"|="),xor_equal:new gP("xor_equal",Em.token,"^="),shift_right_equal:new gP("shift_right_equal",Em.token,">>="),shift_left_equal:new gP("shift_left_equal",Em.token,"<<=")},gS.simpleTokens={"@":gS.tokens.attr,"{":gS.tokens.brace_left,"}":gS.tokens.brace_right,":":gS.tokens.colon,",":gS.tokens.comma,"(":gS.tokens.paren_left,")":gS.tokens.paren_right,";":gS.tokens.semicolon},gS.literalTokens={"&":gS.tokens.and,"&&":gS.tokens.and_and,"->":gS.tokens.arrow,"/":gS.tokens.forward_slash,"!":gS.tokens.bang,"[":gS.tokens.bracket_left,"]":gS.tokens.bracket_right,"=":gS.tokens.equal,"==":gS.tokens.equal_equal,"!=":gS.tokens.not_equal,">":gS.tokens.greater_than,">=":gS.tokens.greater_than_equal,">>":gS.tokens.shift_right,"<":gS.tokens.less_than,"<=":gS.tokens.less_than_equal,"<<":gS.tokens.shift_left,"%":gS.tokens.modulo,"-":gS.tokens.minus,"--":gS.tokens.minus_minus,".":gS.tokens.period,"+":gS.tokens.plus,"++":gS.tokens.plus_plus,"|":gS.tokens.or,"||":gS.tokens.or_or,"*":gS.tokens.star,"~":gS.tokens.tilde,_:gS.tokens.underscore,"^":gS.tokens.xor,"+=":gS.tokens.plus_equal,"-=":gS.tokens.minus_equal,"*=":gS.tokens.times_equal,"/=":gS.tokens.division_equal,"%=":gS.tokens.modulo_equal,"&=":gS.tokens.and_equal,"|=":gS.tokens.or_equal,"^=":gS.tokens.xor_equal,">>=":gS.tokens.shift_right_equal,"<<=":gS.tokens.shift_left_equal},gS.regexTokens={decimal_float_literal:gS.tokens.decimal_float_literal,hex_float_literal:gS.tokens.hex_float_literal,int_literal:gS.tokens.int_literal,uint_literal:gS.tokens.uint_literal,ident:gS.tokens.ident},gS.storage_class=[gS.keywords.function,gS.keywords.private,gS.keywords.workgroup,gS.keywords.uniform,gS.keywords.storage],gS.access_mode=[gS.keywords.read,gS.keywords.write,gS.keywords.read_write],gS.sampler_type=[gS.keywords.sampler,gS.keywords.sampler_comparison],gS.sampled_texture_type=[gS.keywords.texture_1d,gS.keywords.texture_2d,gS.keywords.texture_2d_array,gS.keywords.texture_3d,gS.keywords.texture_cube,gS.keywords.texture_cube_array],gS.multisampled_texture_type=[gS.keywords.texture_multisampled_2d],gS.storage_texture_type=[gS.keywords.texture_storage_1d,gS.keywords.texture_storage_2d,gS.keywords.texture_storage_2d_array,gS.keywords.texture_storage_3d],gS.depth_texture_type=[gS.keywords.texture_depth_2d,gS.keywords.texture_depth_2d_array,gS.keywords.texture_depth_cube,gS.keywords.texture_depth_cube_array,gS.keywords.texture_depth_multisampled_2d],gS.texture_external_type=[gS.keywords.texture_external],gS.any_texture_type=[...gS.sampled_texture_type,...gS.multisampled_texture_type,...gS.storage_texture_type,...gS.depth_texture_type,...gS.texture_external_type],gS.texel_format=[gS.keywords.r8unorm,gS.keywords.r8snorm,gS.keywords.r8uint,gS.keywords.r8sint,gS.keywords.r16uint,gS.keywords.r16sint,gS.keywords.r16float,gS.keywords.rg8unorm,gS.keywords.rg8snorm,gS.keywords.rg8uint,gS.keywords.rg8sint,gS.keywords.r32uint,gS.keywords.r32sint,gS.keywords.r32float,gS.keywords.rg16uint,gS.keywords.rg16sint,gS.keywords.rg16float,gS.keywords.rgba8unorm,gS.keywords.rgba8unorm_srgb,gS.keywords.rgba8snorm,gS.keywords.rgba8uint,gS.keywords.rgba8sint,gS.keywords.bgra8unorm,gS.keywords.bgra8unorm_srgb,gS.keywords.rgb10a2unorm,gS.keywords.rg11b10float,gS.keywords.rg32uint,gS.keywords.rg32sint,gS.keywords.rg32float,gS.keywords.rgba16uint,gS.keywords.rgba16sint,gS.keywords.rgba16float,gS.keywords.rgba32uint,gS.keywords.rgba32sint,gS.keywords.rgba32float],gS.const_literal=[gS.tokens.int_literal,gS.tokens.uint_literal,gS.tokens.decimal_float_literal,gS.tokens.hex_float_literal,gS.keywords.true,gS.keywords.false],gS.literal_or_ident=[gS.tokens.ident,gS.tokens.int_literal,gS.tokens.uint_literal,gS.tokens.decimal_float_literal,gS.tokens.hex_float_literal,gS.tokens.name],gS.element_count_expression=[gS.tokens.int_literal,gS.tokens.uint_literal,gS.tokens.ident],gS.template_types=[gS.keywords.vec2,gS.keywords.vec3,gS.keywords.vec4,gS.keywords.mat2x2,gS.keywords.mat2x3,gS.keywords.mat2x4,gS.keywords.mat3x2,gS.keywords.mat3x3,gS.keywords.mat3x4,gS.keywords.mat4x2,gS.keywords.mat4x3,gS.keywords.mat4x4,gS.keywords.atomic,gS.keywords.bitcast,...gS.any_texture_type],gS.attribute_name=[gS.tokens.ident,gS.keywords.block,gS.keywords.diagnostic],gS.assignment_operators=[gS.tokens.equal,gS.tokens.plus_equal,gS.tokens.minus_equal,gS.tokens.times_equal,gS.tokens.division_equal,gS.tokens.modulo_equal,gS.tokens.and_equal,gS.tokens.or_equal,gS.tokens.xor_equal,gS.tokens.shift_right_equal,gS.tokens.shift_left_equal],gS.increment_operators=[gS.tokens.plus_plus,gS.tokens.minus_minus];class gM{constructor(e,t,i,r,n){this.type=e,this.lexeme=t,this.line=i,this.start=r,this.end=n}toString(){return this.lexeme}isTemplateType(){return -1!=gS.template_types.indexOf(this.type)}isArrayType(){return this.type==gS.keywords.array}isArrayOrTemplateType(){return this.isArrayType()||this.isTemplateType()}}class gC{constructor(e){this._tokens=[],this._start=0,this._current=0,this._line=1,this._source=null!=e?e:""}scanTokens(){for(;!this._isAtEnd();)if(this._start=this._current,!this.scanToken())throw`Invalid syntax at line ${this._line}`;return this._tokens.push(new gM(gS.eof,"",this._line,this._current,this._current)),this._tokens}scanToken(){let e=this._advance();if("\n"==e)return this._line++,!0;if(this._isWhitespace(e))return!0;if("/"==e){if("/"==this._peekAhead()){for(;"\n"!=e;){if(this._isAtEnd())return!0;e=this._advance()}return this._line++,!0}if("*"==this._peekAhead()){this._advance();let t=1;for(;t>0&&!this._isAtEnd();)if("\n"==(e=this._advance()))this._line++;else if("*"==e){if("/"==this._peekAhead()&&(this._advance(),0==--t))break}else"/"==e&&"*"==this._peekAhead()&&(this._advance(),t++);return!0}}let t=gS.simpleTokens[e];if(t)return this._addToken(t),!0;let i=gS.none,r=this._isAlpha(e),n="_"===e;if(this._isAlphaNumeric(e)){let t=this._peekAhead();for(;this._isAlphaNumeric(t);)e+=this._advance(),t=this._peekAhead()}if(r){let t=gS.keywords[e];if(t)return this._addToken(t),!0}if(r||n)return this._addToken(gS.tokens.ident),!0;for(;;){let t=this._findType(e),r=this._peekAhead();if("-"==e&&this._tokens.length>0){if("="==r)return this._current++,e+=r,this._addToken(gS.tokens.minus_equal),!0;if("-"==r)return this._current++,e+=r,this._addToken(gS.tokens.minus_minus),!0;let i=this._tokens.length-1;if((-1!=gS.literal_or_ident.indexOf(this._tokens[i].type)||this._tokens[i].type==gS.tokens.paren_right)&&">"!=r)return this._addToken(t),!0}if(">"==e&&(">"==r||"="==r)){let e=!1,i=this._tokens.length-1;for(let t=0;t<5&&i>=0&&-1===gS.assignment_operators.indexOf(this._tokens[i].type);++t,--i)if(this._tokens[i].type===gS.tokens.less_than){i>0&&this._tokens[i-1].isArrayOrTemplateType()&&(e=!0);break}if(e)return this._addToken(t),!0}if(t===gS.none){let r=e,n=0;for(let e=0;e<2;++e)if(r+=this._peekAhead(e),(t=this._findType(r))!==gS.none){n=e;break}if(t===gS.none)return i!==gS.none&&(this._current--,this._addToken(i),!0);e=r,this._current+=n+1}if(i=t,this._isAtEnd())break;e+=this._advance()}return i!==gS.none&&(this._addToken(i),!0)}_findType(e){for(let t in gS.regexTokens){let i=gS.regexTokens[t];if(this._match(e,i.rule))return i}return gS.literalTokens[e]||gS.none}_match(e,t){let i=t.exec(e);return i&&0==i.index&&i[0]==e}_isAtEnd(){return this._current>=this._source.length}_isAlpha(e){return!this._isNumeric(e)&&!this._isWhitespace(e)&&"_"!==e&&"."!==e&&"("!==e&&")"!==e&&"["!==e&&"]"!==e&&"{"!==e&&"}"!==e&&","!==e&&";"!==e&&":"!==e&&"="!==e&&"!"!==e&&"<"!==e&&">"!==e&&"+"!==e&&"-"!==e&&"*"!==e&&"/"!==e&&"%"!==e&&"&"!==e&&"|"!==e&&"^"!==e&&"~"!==e&&"@"!==e&&"#"!==e&&"?"!==e&&"'"!==e&&"`"!==e&&'"'!==e&&"\\"!==e&&"\n"!==e&&"\r"!==e&&"	"!==e&&"\0"!==e}_isNumeric(e){return e>="0"&&e<="9"}_isAlphaNumeric(e){return this._isAlpha(e)||this._isNumeric(e)||"_"===e}_isWhitespace(e){return" "==e||"	"==e||"\r"==e}_advance(e=0){let t=this._source[this._current];return e=e||0,e++,this._current+=e,t}_peekAhead(e=0){return e=e||0,this._current+e>=this._source.length?"\0":this._source[this._current+e]}_addToken(e){let t=this._source.substring(this._start,this._current);this._tokens.push(new gM(e,t,this._line,this._start,this._current))}}function gA(e){return Array.isArray(e)||(null==e?void 0:e.buffer)instanceof ArrayBuffer}let gI=new Float32Array(1),gL=new Uint32Array(gI.buffer),gD=new Uint32Array(gI.buffer),gO=new Int32Array(1),gR=new Float32Array(gO.buffer),gN=new Uint32Array(gO.buffer),gj=new Uint32Array(1),gB=new Float32Array(gj.buffer),gF=new Int32Array(gj.buffer);function gz(e,t,i){if(t===i)return e;if("f32"===t){if("i32"===i||"x32"===i)return gI[0]=e,gL[0];if("u32"===i)return gI[0]=e,gD[0]}else if("i32"===t||"x32"===t){if("f32"===i)return gO[0]=e,gR[0];if("u32"===i)return gO[0]=e,gN[0]}else if("u32"===t){if("f32"===i)return gj[0]=e,gB[0];if("i32"===i||"x32"===i)return gj[0]=e,gF[0]}return console.error(`Unsupported cast from ${t} to ${i}`),e}class gV{constructor(e){this.resources=null,this.inUse=!1,this.info=null,this.node=e}}class gU{constructor(e,t){this.align=e,this.size=t}}class g${constructor(){this.uniforms=[],this.storage=[],this.textures=[],this.samplers=[],this.aliases=[],this.overrides=[],this.structs=[],this.entry=new pv,this.functions=[],this._types=new Map,this._functions=new Map}_isStorageTexture(e){return"texture_storage_1d"==e.name||"texture_storage_2d"==e.name||"texture_storage_2d_array"==e.name||"texture_storage_3d"==e.name}updateAST(e){for(let t of e)t instanceof pL&&this._functions.set(t.name,new gV(t));for(let t of e)if(t instanceof p3){let e=this.getTypeInfo(t,null);e instanceof ps&&this.structs.push(e)}for(let t of e)if(t instanceof pZ)this.aliases.push(this._getAliasInfo(t));else{if(t instanceof pB){let e=this._getAttributeNum(t.attributes,"id",0),i=null!=t.type?this.getTypeInfo(t.type,t.attributes):null;this.overrides.push(new pp(t.name,i,t.attributes,e));continue}if(this._isUniformVar(t)){let e=this._getAttributeNum(t.attributes,"group",0),i=this._getAttributeNum(t.attributes,"binding",0),r=this.getTypeInfo(t.type,t.attributes),n=new pu(t.name,r,e,i,t.attributes,Ef.Uniform,t.access);n.access||(n.access="read"),this.uniforms.push(n);continue}if(this._isStorageVar(t)){let e=this._getAttributeNum(t.attributes,"group",0),i=this._getAttributeNum(t.attributes,"binding",0),r=this.getTypeInfo(t.type,t.attributes),n=this._isStorageTexture(r),a=new pu(t.name,r,e,i,t.attributes,n?Ef.StorageTexture:Ef.Storage,t.access);a.access||(a.access="read"),this.storage.push(a);continue}if(this._isTextureVar(t)){let e=this._getAttributeNum(t.attributes,"group",0),i=this._getAttributeNum(t.attributes,"binding",0),r=this.getTypeInfo(t.type,t.attributes),n=this._isStorageTexture(r),a=new pu(t.name,r,e,i,t.attributes,n?Ef.StorageTexture:Ef.Texture,t.access);a.access||(a.access="read"),n?this.storage.push(a):this.textures.push(a);continue}if(this._isSamplerVar(t)){let e=this._getAttributeNum(t.attributes,"group",0),i=this._getAttributeNum(t.attributes,"binding",0),r=this.getTypeInfo(t.type,t.attributes),n=new pu(t.name,r,e,i,t.attributes,Ef.Sampler,t.access);this.samplers.push(n);continue}}for(let t of e)if(t instanceof pL){let e=this._getAttribute(t,"vertex"),i=this._getAttribute(t,"fragment"),r=this._getAttribute(t,"compute"),n=e||i||r,a=new pm(t.name,null==n?void 0:n.name,t.attributes);a.attributes=t.attributes,a.startLine=t.startLine,a.endLine=t.endLine,this.functions.push(a),this._functions.get(t.name).info=a,n&&(this._functions.get(t.name).inUse=!0,a.inUse=!0,a.resources=this._findResources(t,!!n),a.inputs=this._getInputs(t.args),a.outputs=this._getOutputs(t.returnType),this.entry[n.name].push(a)),a.arguments=t.args.map(e=>new pg(e.name,this.getTypeInfo(e.type,e.attributes),e.attributes)),a.returnType=t.returnType?this.getTypeInfo(t.returnType,t.attributes):null;continue}for(let e of this._functions.values())e.info&&(e.info.inUse=e.inUse,this._addCalls(e.node,e.info.calls));for(let e of this._functions.values())e.node.search(t=>{var i,r,n;if(t instanceof gv){if(t.value)if(gA(t.value))for(let r of t.value)for(let t of this.overrides)r===t.name&&(null==(i=e.info)||i.overrides.push(t));else for(let i of this.overrides)t.value===i.name&&(null==(r=e.info)||r.overrides.push(i))}else if(t instanceof gi)for(let i of this.overrides)t.name===i.name&&(null==(n=e.info)||n.overrides.push(i))});for(let e of this.uniforms)this._markStructsInUse(e.type);for(let e of this.storage)this._markStructsInUse(e.type)}getFunctionInfo(e){for(let t of this.functions)if(t.name==e)return t;return null}getStructInfo(e){for(let t of this.structs)if(t.name==e)return t;return null}getOverrideInfo(e){for(let t of this.overrides)if(t.name==e)return t;return null}_markStructsInUse(e){if(e)if(e.isStruct){if(e.inUse=!0,e.members)for(let t of e.members)this._markStructsInUse(t.type)}else if(e.isArray)this._markStructsInUse(e.format);else if(e.isTemplate)e.format&&this._markStructsInUse(e.format);else{let t=this._getAlias(e.name);t&&this._markStructsInUse(t)}}_addCalls(e,t){var i;for(let r of e.calls){let e=null==(i=this._functions.get(r.name))?void 0:i.info;e&&t.add(e)}}findResource(e,t,i){if(i){for(let r of this.entry.compute)if(r.name===i){for(let i of r.resources)if(i.group==e&&i.binding==t)return i}for(let r of this.entry.vertex)if(r.name===i){for(let i of r.resources)if(i.group==e&&i.binding==t)return i}for(let r of this.entry.fragment)if(r.name===i){for(let i of r.resources)if(i.group==e&&i.binding==t)return i}}for(let i of this.uniforms)if(i.group==e&&i.binding==t)return i;for(let i of this.storage)if(i.group==e&&i.binding==t)return i;for(let i of this.textures)if(i.group==e&&i.binding==t)return i;for(let i of this.samplers)if(i.group==e&&i.binding==t)return i;return null}_findResource(e){for(let t of this.uniforms)if(t.name==e)return t;for(let t of this.storage)if(t.name==e)return t;for(let t of this.textures)if(t.name==e)return t;for(let t of this.samplers)if(t.name==e)return t;return null}_markStructsFromAST(e){let t=this.getTypeInfo(e,null);this._markStructsInUse(t)}_findResources(e,t){let i=[],r=this,n=[];return e.search(a=>{if(a instanceof pM)n.push({});else if(a instanceof pC)n.pop();else if(a instanceof pj)t&&null!==a.type&&this._markStructsFromAST(a.type),n.length>0&&(n[n.length-1][a.name]=a);else if(a instanceof ge)t&&null!==a.type&&this._markStructsFromAST(a.type);else if(a instanceof pF)t&&null!==a.type&&this._markStructsFromAST(a.type),n.length>0&&(n[n.length-1][a.name]=a);else if(a instanceof gi){if(n.length>0&&n[n.length-1][a.name])return;let e=r._findResource(a.name);e&&i.push(e)}else if(a instanceof gt){let n=r._functions.get(a.name);n&&(t&&(n.inUse=!0),e.calls.add(n.node),null===n.resources&&(n.resources=r._findResources(n.node,t)),i.push(...n.resources))}else if(a instanceof p$){let n=r._functions.get(a.name);n&&(t&&(n.inUse=!0),e.calls.add(n.node),null===n.resources&&(n.resources=r._findResources(n.node,t)),i.push(...n.resources))}}),[...new Map(i.map(e=>[e.name,e])).values()]}getBindGroups(){let e=[];function t(t,i){t>=e.length&&(e.length=t+1),void 0===e[t]&&(e[t]=[]),i>=e[t].length&&(e[t].length=i+1)}for(let i of this.uniforms)t(i.group,i.binding),e[i.group][i.binding]=i;for(let i of this.storage)t(i.group,i.binding),e[i.group][i.binding]=i;for(let i of this.textures)t(i.group,i.binding),e[i.group][i.binding]=i;for(let i of this.samplers)t(i.group,i.binding),e[i.group][i.binding]=i;return e}_getOutputs(e,t){if(void 0===t&&(t=[]),e instanceof p3)this._getStructOutputs(e,t);else{let i=this._getOutputInfo(e);null!==i&&t.push(i)}return t}_getStructOutputs(e,t){for(let i of e.members)if(i.type instanceof p3)this._getStructOutputs(i.type,t);else{let e=this._getAttribute(i,"location")||this._getAttribute(i,"builtin");if(null!==e){let r=this.getTypeInfo(i.type,i.type.attributes),n=this._parseInt(e.value),a=new pf(i.name,r,e.name,n);t.push(a)}}}_getOutputInfo(e){let t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(null!==t){let i=this.getTypeInfo(e,e.attributes),r=this._parseInt(t.value);return new pf("",i,t.name,r)}return null}_getInputs(e,t){for(let i of(void 0===t&&(t=[]),e))if(i.type instanceof p3)this._getStructInputs(i.type,t);else{let e=this._getInputInfo(i);null!==e&&t.push(e)}return t}_getStructInputs(e,t){for(let i of e.members)if(i.type instanceof p3)this._getStructInputs(i.type,t);else{let e=this._getInputInfo(i);null!==e&&t.push(e)}}_getInputInfo(e){let t=this._getAttribute(e,"location")||this._getAttribute(e,"builtin");if(null!==t){let i=this._getAttribute(e,"interpolation"),r=this.getTypeInfo(e.type,e.attributes),n=this._parseInt(t.value),a=new pd(e.name,r,t.name,n);return null!==i&&(a.interpolation=this._parseString(i.value)),a}return null}_parseString(e){return e instanceof Array&&(e=e[0]),e}_parseInt(e){e instanceof Array&&(e=e[0]);let t=parseInt(e);return isNaN(t)?e:t}_getAlias(e){for(let t of this.aliases)if(t.name==e)return t.type;return null}_getAliasInfo(e){return new ph(e.name,this.getTypeInfo(e.type,null))}getTypeInfoByName(e){for(let t of this.structs)if(t.name==e)return t;for(let t of this.aliases)if(t.name==e)return t.type;return null}getTypeInfo(e,t=null){if(this._types.has(e))return this._types.get(e);if(e instanceof p5){let i=e.type?this.getTypeInfo(e.type,e.attributes):null,r=new pl(e.name,i,t);return this._types.set(e,r),this._updateTypeInfo(r),r}if(e instanceof p6){let i=e.format?this.getTypeInfo(e.format,e.attributes):null,r=new po(e.name,t);return r.format=i,r.count=e.count,this._types.set(e,r),this._updateTypeInfo(r),r}if(e instanceof p3){let i=new ps(e.name,t);for(let t of(i.startLine=e.startLine,i.endLine=e.endLine,e.members)){let e=this.getTypeInfo(t.type,t.attributes);i.members.push(new pa(t.name,e,t.attributes))}return this._types.set(e,i),this._updateTypeInfo(i),i}if(e instanceof p8){let i=e.format instanceof p1,r=e.format?i?this.getTypeInfo(e.format,null):new pn(e.format,null):null,n=new pc(e.name,r,t,e.access);return this._types.set(e,n),this._updateTypeInfo(n),n}if(e instanceof p4){let i=e.format?this.getTypeInfo(e.format,null):null,r=new pc(e.name,i,t,e.access);return this._types.set(e,r),this._updateTypeInfo(r),r}let i=new pn(e.name,t);return this._types.set(e,i),this._updateTypeInfo(i),i}_updateTypeInfo(e){var t,i,r;let n=this._getTypeSize(e);if(e.size=null!=(t=null==n?void 0:n.size)?t:0,e instanceof po&&e.format){let t=this._getTypeSize(e.format);e.stride=Math.max(null!=(i=null==t?void 0:t.size)?i:0,null!=(r=null==t?void 0:t.align)?r:0),this._updateTypeInfo(e.format)}e instanceof pl&&this._updateTypeInfo(e.format),e instanceof ps&&this._updateStructInfo(e)}_updateStructInfo(e){let t=0,i=0,r=0,n=0;for(let a=0,s=e.members.length;a<s;++a){let s=e.members[a],o=this._getTypeSize(s);if(!o)continue;null!=this._getAlias(s.type.name)||s.type;let l=o.align,c=o.size;t=this._roundUp(l,t+i),i=c,r=t,n=Math.max(n,l),s.offset=t,s.size=c,this._updateTypeInfo(s.type)}e.size=this._roundUp(n,r+i),e.align=n}_getTypeSize(e){var t,i;if(null==e)return null;let r=this._getAttributeNum(e.attributes,"size",0),n=this._getAttributeNum(e.attributes,"align",0);if(e instanceof pa&&(e=e.type),e instanceof pn){let t=this._getAlias(e.name);null!==t&&(e=t)}{let i=g$._typeInfo[e.name];if(void 0!==i){let a="f16"===(null==(t=e.format)?void 0:t.name)?2:1;return new gU(Math.max(n,i.align/a),Math.max(r,i.size/a))}}{let t=g$._typeInfo[e.name.substring(0,e.name.length-1)];if(t){let i="h"===e.name[e.name.length-1]?2:1;return new gU(Math.max(n,t.align/i),Math.max(r,t.size/i))}}if(e instanceof po){let t=e,a=8,s=8,o=this._getTypeSize(t.format);return null!==o&&(s=o.size,a=o.align),s=t.count*this._getAttributeNum(null!=(i=null==e?void 0:e.attributes)?i:null,"stride",this._roundUp(a,s)),r&&(s=r),new gU(Math.max(n,a),Math.max(r,s))}if(e instanceof ps){let t=0,i=0,a=0,s=0,o=0;for(let i of e.members){let e=this._getTypeSize(i.type);null!==e&&(t=Math.max(e.align,t),a=this._roundUp(e.align,a+s),s=e.size,o=a)}return i=this._roundUp(t,o+s),new gU(Math.max(n,t),Math.max(r,i))}return null}_isUniformVar(e){return e instanceof pj&&"uniform"==e.storage}_isStorageVar(e){return e instanceof pj&&"storage"==e.storage}_isTextureVar(e){return e instanceof pj&&null!==e.type&&-1!=g$._textureTypes.indexOf(e.type.name)}_isSamplerVar(e){return e instanceof pj&&null!==e.type&&-1!=g$._samplerTypes.indexOf(e.type.name)}_getAttribute(e,t){if(!e||!e.attributes)return null;for(let i of e.attributes)if(i.name==t)return i;return null}_getAttributeNum(e,t,i){if(null===e)return i;for(let r of e)if(r.name==t){let e=null!==r&&null!==r.value?r.value:i;return e instanceof Array&&(e=e[0]),"number"==typeof e?e:"string"==typeof e?parseInt(e):i}return i}_roundUp(e,t){return Math.ceil(t/e)*e}}g$._typeInfo={f16:{align:2,size:2},i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},atomic:{align:4,size:4},vec2:{align:8,size:8},vec3:{align:16,size:12},vec4:{align:16,size:16},mat2x2:{align:8,size:16},mat3x2:{align:8,size:24},mat4x2:{align:8,size:32},mat2x3:{align:16,size:32},mat3x3:{align:16,size:48},mat4x3:{align:16,size:64},mat2x4:{align:16,size:32},mat3x4:{align:16,size:48},mat4x4:{align:16,size:64}},g$._textureTypes=gS.any_texture_type.map(e=>e.name),g$._samplerTypes=gS.sampler_type.map(e=>e.name);let gW=0;class gH{constructor(e,t,i){this.id=gW++,this.name=e,this.value=t,this.node=i}clone(){return new gH(this.name,this.value,this.node)}}class gq{constructor(e){this.id=gW++,this.name=e.name,this.node=e}clone(){return new gq(this.node)}}class gG{constructor(e){this.parent=null,this.variables=new Map,this.functions=new Map,this.currentFunctionName="",this.id=gW++,e&&(this.parent=e,this.currentFunctionName=e.currentFunctionName)}getVariable(e){var t;return this.variables.has(e)?null!=(t=this.variables.get(e))?t:null:this.parent?this.parent.getVariable(e):null}getFunction(e){var t;return this.functions.has(e)?null!=(t=this.functions.get(e))?t:null:this.parent?this.parent.getFunction(e):null}createVariable(e,t,i){this.variables.set(e,new gH(e,t,null!=i?i:null))}setVariable(e,t,i){let r=this.getVariable(e);null!==r?r.value=t:this.createVariable(e,t,i)}getVariableValue(e){var t;let i=this.getVariable(e);return null!=(t=null==i?void 0:i.value)?t:null}clone(){return new gG(this)}}class gY{evalExpression(e,t){return null}getTypeInfo(e){return null}getVariableName(e,t){return""}}class gX{constructor(e){this.exec=e}getTypeInfo(e){return this.exec.getTypeInfo(e)}All(e,t){let i=this.exec.evalExpression(e.args[0],t),r=!0;if(i instanceof gw)return i.data.forEach(e=>{e||(r=!1)}),new g_(+!!r,this.getTypeInfo("bool"));throw Error(`All() expects a vector argument. Line ${e.line}`)}Any(e,t){let i=this.exec.evalExpression(e.args[0],t);if(i instanceof gw)return new g_(+!!i.data.some(e=>e),this.getTypeInfo("bool"));throw Error(`Any() expects a vector argument. Line ${e.line}`)}Select(e,t){let i=this.exec.evalExpression(e.args[2],t);if(!(i instanceof g_))throw Error(`Select() expects a bool condition. Line ${e.line}`);return i.value?this.exec.evalExpression(e.args[1],t):this.exec.evalExpression(e.args[0],t)}ArrayLength(e,t){let i=e.args[0];i instanceof gl&&(i=i.right);let r=this.exec.evalExpression(i,t);if(r instanceof gE&&0===r.typeInfo.size){let e=r.typeInfo;return new g_(r.buffer.byteLength/e.stride,this.getTypeInfo("u32"))}return new g_(r.typeInfo.size,this.getTypeInfo("u32"))}Abs(e,t){let i=this.exec.evalExpression(e.args[0],t);return i instanceof gw?new gw(i.data.map(e=>Math.abs(e)),i.typeInfo):new g_(Math.abs(i.value),i.typeInfo)}Acos(e,t){let i=this.exec.evalExpression(e.args[0],t);return i instanceof gw?new gw(i.data.map(e=>Math.acos(e)),i.typeInfo):new g_(Math.acos(i.value),i.typeInfo)}Acosh(e,t){let i=this.exec.evalExpression(e.args[0],t);return i instanceof gw?new gw(i.data.map(e=>Math.acosh(e)),i.typeInfo):new g_(Math.acosh(i.value),i.typeInfo)}Asin(e,t){let i=this.exec.evalExpression(e.args[0],t);return i instanceof gw?new gw(i.data.map(e=>Math.asin(e)),i.typeInfo):new g_(Math.asin(i.value),i.typeInfo)}Asinh(e,t){let i=this.exec.evalExpression(e.args[0],t);return i instanceof gw?new gw(i.data.map(e=>Math.asinh(e)),i.typeInfo):new g_(Math.asinh(i.value),i.typeInfo)}Atan(e,t){let i=this.exec.evalExpression(e.args[0],t);return i instanceof gw?new gw(i.data.map(e=>Math.atan(e)),i.typeInfo):new g_(Math.atan(i.value),i.typeInfo)}Atanh(e,t){let i=this.exec.evalExpression(e.args[0],t);return i instanceof gw?new gw(i.data.map(e=>Math.atanh(e)),i.typeInfo):new g_(Math.atanh(i.value),i.typeInfo)}Atan2(e,t){let i=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);return i instanceof gw&&r instanceof gw?new gw(i.data.map((e,t)=>Math.atan2(e,r.data[t])),i.typeInfo):new g_(Math.atan2(i.value,r.value),i.typeInfo)}Ceil(e,t){let i=this.exec.evalExpression(e.args[0],t);return i instanceof gw?new gw(i.data.map(e=>Math.ceil(e)),i.typeInfo):new g_(Math.ceil(i.value),i.typeInfo)}_clamp(e,t,i){return Math.min(Math.max(e,t),i)}Clamp(e,t){let i=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t),n=this.exec.evalExpression(e.args[2],t);return i instanceof gw&&r instanceof gw&&n instanceof gw?new gw(i.data.map((e,t)=>this._clamp(e,r.data[t],n.data[t])),i.typeInfo):new g_(this._clamp(i.value,r.value,n.value),i.typeInfo)}Cos(e,t){let i=this.exec.evalExpression(e.args[0],t);return i instanceof gw?new gw(i.data.map(e=>Math.cos(e)),i.typeInfo):new g_(Math.cos(i.value),i.typeInfo)}Cosh(e,t){let i=this.exec.evalExpression(e.args[0],t);return i instanceof gw?new gw(i.data.map(e=>Math.cosh(e)),i.typeInfo):new g_(Math.cos(i.value),i.typeInfo)}CountLeadingZeros(e,t){let i=this.exec.evalExpression(e.args[0],t);return i instanceof gw?new gw(i.data.map(e=>Math.clz32(e)),i.typeInfo):new g_(Math.clz32(i.value),i.typeInfo)}_countOneBits(e){let t=0;for(;0!==e;)1&e&&t++,e>>=1;return t}CountOneBits(e,t){let i=this.exec.evalExpression(e.args[0],t);return i instanceof gw?new gw(i.data.map(e=>this._countOneBits(e)),i.typeInfo):new g_(this._countOneBits(i.value),i.typeInfo)}_countTrailingZeros(e){if(0===e)return 32;let t=0;for(;!(1&e);)e>>=1,t++;return t}CountTrailingZeros(e,t){let i=this.exec.evalExpression(e.args[0],t);return i instanceof gw?new gw(i.data.map(e=>this._countTrailingZeros(e)),i.typeInfo):new g_(this._countTrailingZeros(i.value),i.typeInfo)}Cross(e,t){let i=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);if(i instanceof gw&&r instanceof gw){if(3!==i.data.length||3!==r.data.length)return console.error(`Cross() expects 3D vectors. Line ${e.line}`),null;let t=i.data,n=r.data;return new gw([t[1]*n[2]-n[1]*t[2],t[2]*n[0]-n[2]*t[0],t[0]*n[1]-n[0]*t[1]],i.typeInfo)}return console.error(`Cross() expects vector arguments. Line ${e.line}`),null}Degrees(e,t){let i=this.exec.evalExpression(e.args[0],t),r=180/Math.PI;return i instanceof gw?new gw(i.data.map(e=>e*r),i.typeInfo):new g_(i.value*r,this.getTypeInfo("f32"))}Determinant(e,t){let i=this.exec.evalExpression(e.args[0],t);if(i instanceof gk){let e=i.data,t=i.typeInfo.getTypeName(),r=t.endsWith("h")?this.getTypeInfo("f16"):this.getTypeInfo("f32");if("mat2x2"===t||"mat2x2f"===t||"mat2x2h"===t)return new g_(e[0]*e[3]-e[1]*e[2],r);if("mat2x3"===t||"mat2x3f"===t||"mat2x3h"===t)return new g_(e[0]*(e[4]*e[8]-e[5]*e[7])-e[1]*(e[3]*e[8]-e[5]*e[6])+e[2]*(e[3]*e[7]-e[4]*e[6]),r);if("mat2x4"===t||"mat2x4f"===t||"mat2x4h"===t)console.error(`TODO: Determinant for ${t}`);else if("mat3x2"===t||"mat3x2f"===t||"mat3x2h"===t)console.error(`TODO: Determinant for ${t}`);else{if("mat3x3"===t||"mat3x3f"===t||"mat3x3h"===t)return new g_(e[0]*(e[4]*e[8]-e[5]*e[7])-e[1]*(e[3]*e[8]-e[5]*e[6])+e[2]*(e[3]*e[7]-e[4]*e[6]),r);"mat3x4"===t||"mat3x4f"===t||"mat3x4h"===t||"mat4x2"===t||"mat4x2f"===t||"mat4x2h"===t||"mat4x3"===t||"mat4x3f"===t||"mat4x3h"===t?console.error(`TODO: Determinant for ${t}`):"mat4x4"!==t&&"mat4x4f"!==t&&"mat4x4h"!==t||console.error(`TODO: Determinant for ${t}`)}}return console.error(`Determinant expects a matrix argument. Line ${e.line}`),null}Distance(e,t){let i=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);if(i instanceof gw&&r instanceof gw){let e=0;for(let t=0;t<i.data.length;++t)e+=(i.data[t]-r.data[t])*(i.data[t]-r.data[t]);return new g_(Math.sqrt(e),this.getTypeInfo("f32"))}return new g_(Math.abs(i.value-r.value),i.typeInfo)}_dot(e,t){let i=0;for(let r=0;r<e.length;++r)i+=t[r]*e[r];return i}Dot(e,t){let i=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);return i instanceof gw&&r instanceof gw?new g_(this._dot(i.data,r.data),this.getTypeInfo("f32")):(console.error(`Dot() expects vector arguments. Line ${e.line}`),null)}Dot4U8Packed(e,t){return console.error(`TODO: dot4U8Packed. Line ${e.line}`),null}Dot4I8Packed(e,t){return console.error(`TODO: dot4I8Packed. Line ${e.line}`),null}Exp(e,t){let i=this.exec.evalExpression(e.args[0],t);return i instanceof gw?new gw(i.data.map(e=>Math.exp(e)),i.typeInfo):new g_(Math.exp(i.value),i.typeInfo)}Exp2(e,t){let i=this.exec.evalExpression(e.args[0],t);return i instanceof gw?new gw(i.data.map(e=>Math.pow(2,e)),i.typeInfo):new g_(Math.pow(2,i.value),i.typeInfo)}ExtractBits(e,t){let i=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t),n=this.exec.evalExpression(e.args[2],t);if("u32"!==r.typeInfo.name&&"x32"!==r.typeInfo.name)return console.error(`ExtractBits() expects an i32 offset argument. Line ${e.line}`),null;if("u32"!==n.typeInfo.name&&"x32"!==n.typeInfo.name)return console.error(`ExtractBits() expects an i32 count argument. Line ${e.line}`),null;let a=r.value,s=n.value;return i instanceof gw?new gw(i.data.map(e=>e>>a&(1<<s)-1),i.typeInfo):"i32"!==i.typeInfo.name&&"x32"!==i.typeInfo.name?(console.error(`ExtractBits() expects an i32 argument. Line ${e.line}`),null):new g_(i.value>>a&(1<<s)-1,this.getTypeInfo("i32"))}FaceForward(e,t){let i=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t),n=this.exec.evalExpression(e.args[2],t);return i instanceof gw&&r instanceof gw&&n instanceof gw?new gw(0>this._dot(r.data,n.data)?Array.from(i.data):i.data.map(e=>-e),i.typeInfo):(console.error(`FaceForward() expects vector arguments. Line ${e.line}`),null)}_firstLeadingBit(e){return 0===e?-1:31-Math.clz32(e)}FirstLeadingBit(e,t){let i=this.exec.evalExpression(e.args[0],t);return i instanceof gw?new gw(i.data.map(e=>this._firstLeadingBit(e)),i.typeInfo):new g_(this._firstLeadingBit(i.value),i.typeInfo)}_firstTrailingBit(e){return 0===e?-1:Math.log2(e&-e)}FirstTrailingBit(e,t){let i=this.exec.evalExpression(e.args[0],t);return i instanceof gw?new gw(i.data.map(e=>this._firstTrailingBit(e)),i.typeInfo):new g_(this._firstTrailingBit(i.value),i.typeInfo)}Floor(e,t){let i=this.exec.evalExpression(e.args[0],t);return i instanceof gw?new gw(i.data.map(e=>Math.floor(e)),i.typeInfo):new g_(Math.floor(i.value),i.typeInfo)}Fma(e,t){let i=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t),n=this.exec.evalExpression(e.args[2],t);return i instanceof gw&&r instanceof gw&&n instanceof gw?i.data.length!==r.data.length||i.data.length!==n.data.length?(console.error(`Fma() expects vectors of the same length. Line ${e.line}`),null):new gw(i.data.map((e,t)=>e*r.data[t]+n.data[t]),i.typeInfo):new g_(i.value*r.value+n.value,i.typeInfo)}Fract(e,t){let i=this.exec.evalExpression(e.args[0],t);return i instanceof gw?new gw(i.data.map(e=>e-Math.floor(e)),i.typeInfo):new g_(i.value-Math.floor(i.value),i.typeInfo)}Frexp(e,t){return console.error(`TODO: frexp. Line ${e.line}`),null}InsertBits(e,t){let i=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t),n=this.exec.evalExpression(e.args[2],t),a=this.exec.evalExpression(e.args[3],t);if("u32"!==n.typeInfo.name&&"x32"!==n.typeInfo.name)return console.error(`InsertBits() expects an i32 offset argument. Line ${e.line}`),null;let s=n.value,o=(1<<a.value)-1<<s,l=~o;return i instanceof gw&&r instanceof gw?new gw(i.data.map((e,t)=>e&l|r.data[t]<<s&o),i.typeInfo):new g_(i.value&l|r.value<<s&o,i.typeInfo)}InverseSqrt(e,t){let i=this.exec.evalExpression(e.args[0],t);return i instanceof gw?new gw(i.data.map(e=>1/Math.sqrt(e)),i.typeInfo):new g_(1/Math.sqrt(i.value),i.typeInfo)}Ldexp(e,t){return console.error(`TODO: ldexp. Line ${e.line}`),null}Length(e,t){let i=this.exec.evalExpression(e.args[0],t);if(i instanceof gw){let e=0;return i.data.forEach(t=>{e+=t*t}),new g_(Math.sqrt(e),this.getTypeInfo("f32"))}return new g_(Math.abs(i.value),i.typeInfo)}Log(e,t){let i=this.exec.evalExpression(e.args[0],t);return i instanceof gw?new gw(i.data.map(e=>Math.log(e)),i.typeInfo):new g_(Math.log(i.value),i.typeInfo)}Log2(e,t){let i=this.exec.evalExpression(e.args[0],t);return i instanceof gw?new gw(i.data.map(e=>Math.log2(e)),i.typeInfo):new g_(Math.log2(i.value),i.typeInfo)}Max(e,t){let i=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);return i instanceof gw&&r instanceof gw?new gw(i.data.map((e,t)=>Math.max(e,r.data[t])),i.typeInfo):new g_(Math.max(i.value,r.value),i.typeInfo)}Min(e,t){let i=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);return i instanceof gw&&r instanceof gw?new gw(i.data.map((e,t)=>Math.min(e,r.data[t])),i.typeInfo):new g_(Math.min(i.value,r.value),i.typeInfo)}Mix(e,t){let i=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t),n=this.exec.evalExpression(e.args[2],t);return i instanceof gw&&r instanceof gw&&n instanceof gw?new gw(i.data.map((e,t)=>i.data[t]*(1-n.data[t])+r.data[t]*n.data[t]),i.typeInfo):new g_(i.value*(1-n.value)+r.value*n.value,i.typeInfo)}Modf(e,t){let i=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);return i instanceof gw&&r instanceof gw?new gw(i.data.map((e,t)=>e%r.data[t]),i.typeInfo):new g_(i.value%r.value,i.typeInfo)}Normalize(e,t){let i=this.exec.evalExpression(e.args[0],t);if(i instanceof gw){let r=this.Length(e,t).value;return new gw(i.data.map(e=>e/r),i.typeInfo)}return console.error(`Normalize() expects a vector argument. Line ${e.line}`),null}Pow(e,t){let i=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);return i instanceof gw&&r instanceof gw?new gw(i.data.map((e,t)=>Math.pow(e,r.data[t])),i.typeInfo):new g_(Math.pow(i.value,r.value),i.typeInfo)}QuantizeToF16(e,t){let i=this.exec.evalExpression(e.args[0],t);return i instanceof gw?new gw(i.data.map(e=>e),i.typeInfo):new g_(i.value,i.typeInfo)}Radians(e,t){let i=this.exec.evalExpression(e.args[0],t);return i instanceof gw?new gw(i.data.map(e=>e*Math.PI/180),i.typeInfo):new g_(i.value*Math.PI/180,this.getTypeInfo("f32"))}Reflect(e,t){let i=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);if(i instanceof gw&&r instanceof gw){let e=this._dot(i.data,r.data);return new gw(i.data.map((t,i)=>t-2*e*r.data[i]),i.typeInfo)}return console.error(`Reflect() expects vector arguments. Line ${e.line}`),null}Refract(e,t){let i=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t),n=this.exec.evalExpression(e.args[2],t);if(i instanceof gw&&r instanceof gw&&n instanceof g_){let e=this._dot(r.data,i.data);return new gw(i.data.map((t,i)=>{let a=1-n.value*n.value*(1-e*e);if(a<0)return 0;let s=Math.sqrt(a);return n.value*t-(n.value*e+s)*r.data[i]}),i.typeInfo)}return console.error(`Refract() expects vector arguments and a scalar argument. Line ${e.line}`),null}ReverseBits(e,t){return console.error(`TODO: reverseBits. Line ${e.line}`),null}Round(e,t){let i=this.exec.evalExpression(e.args[0],t);return i instanceof gw?new gw(i.data.map(e=>Math.round(e)),i.typeInfo):new g_(Math.round(i.value),i.typeInfo)}Saturate(e,t){let i=this.exec.evalExpression(e.args[0],t);return i instanceof gw?new gw(i.data.map(e=>Math.min(Math.max(e,0),1)),i.typeInfo):new g_(Math.min(Math.max(i.value,0),1),i.typeInfo)}Sign(e,t){let i=this.exec.evalExpression(e.args[0],t);return i instanceof gw?new gw(i.data.map(e=>Math.sign(e)),i.typeInfo):new g_(Math.sign(i.value),i.typeInfo)}Sin(e,t){let i=this.exec.evalExpression(e.args[0],t);return i instanceof gw?new gw(i.data.map(e=>Math.sin(e)),i.typeInfo):new g_(Math.sin(i.value),i.typeInfo)}Sinh(e,t){let i=this.exec.evalExpression(e.args[0],t);return i instanceof gw?new gw(i.data.map(e=>Math.sinh(e)),i.typeInfo):new g_(Math.sinh(i.value),i.typeInfo)}_smoothstep(e,t,i){let r=Math.min(Math.max((i-e)/(t-e),0),1);return r*r*(3-2*r)}SmoothStep(e,t){let i=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t),n=this.exec.evalExpression(e.args[2],t);return n instanceof gw&&i instanceof gw&&r instanceof gw?new gw(n.data.map((e,t)=>this._smoothstep(i.data[t],r.data[t],e)),n.typeInfo):new g_(this._smoothstep(i.value,r.value,n.value),n.typeInfo)}Sqrt(e,t){let i=this.exec.evalExpression(e.args[0],t);return i instanceof gw?new gw(i.data.map(e=>Math.sqrt(e)),i.typeInfo):new g_(Math.sqrt(i.value),i.typeInfo)}Step(e,t){let i=this.exec.evalExpression(e.args[0],t),r=this.exec.evalExpression(e.args[1],t);return r instanceof gw&&i instanceof gw?new gw(r.data.map((e,t)=>e<i.data[t]?0:1),r.typeInfo):new g_(r.value<i.value?0:1,i.typeInfo)}Tan(e,t){let i=this.exec.evalExpression(e.args[0],t);return i instanceof gw?new gw(i.data.map(e=>Math.tan(e)),i.typeInfo):new g_(Math.tan(i.value),i.typeInfo)}Tanh(e,t){let i=this.exec.evalExpression(e.args[0],t);return i instanceof gw?new gw(i.data.map(e=>Math.tanh(e)),i.typeInfo):new g_(Math.tanh(i.value),i.typeInfo)}_getTransposeType(e){let t=e.getTypeName();return"mat2x2f"===t||"mat2x2h"===t?e:"mat2x3f"===t?this.getTypeInfo("mat3x2f"):"mat2x3h"===t?this.getTypeInfo("mat3x2h"):"mat2x4f"===t?this.getTypeInfo("mat4x2f"):"mat2x4h"===t?this.getTypeInfo("mat4x2h"):"mat3x2f"===t?this.getTypeInfo("mat2x3f"):"mat3x2h"===t?this.getTypeInfo("mat2x3h"):"mat3x3f"===t||"mat3x3h"===t?e:"mat3x4f"===t?this.getTypeInfo("mat4x3f"):"mat3x4h"===t?this.getTypeInfo("mat4x3h"):"mat4x2f"===t?this.getTypeInfo("mat2x4f"):"mat4x2h"===t?this.getTypeInfo("mat2x4h"):"mat4x3f"===t?this.getTypeInfo("mat3x4f"):"mat4x3h"===t?this.getTypeInfo("mat3x4h"):("mat4x4f"===t||"mat4x4h"===t||console.error(`Invalid matrix type ${t}`),e)}Transpose(e,t){let i=this.exec.evalExpression(e.args[0],t);if(!(i instanceof gk))return console.error(`Transpose() expects a matrix argument. Line ${e.line}`),null;let r=this._getTransposeType(i.typeInfo);if("mat2x2"===i.typeInfo.name||"mat2x2f"===i.typeInfo.name||"mat2x2h"===i.typeInfo.name){let e=i.data;return new gk([e[0],e[2],e[1],e[3]],r)}if("mat2x3"===i.typeInfo.name||"mat2x3f"===i.typeInfo.name||"mat2x3h"===i.typeInfo.name){let e=i.data;return new gk([e[0],e[3],e[6],e[1],e[4],e[7]],r)}if("mat2x4"===i.typeInfo.name||"mat2x4f"===i.typeInfo.name||"mat2x4h"===i.typeInfo.name){let e=i.data;return new gk([e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13]],r)}if("mat3x2"===i.typeInfo.name||"mat3x2f"===i.typeInfo.name||"mat3x2h"===i.typeInfo.name){let e=i.data;return new gk([e[0],e[3],e[1],e[4],e[2],e[5]],r)}if("mat3x3"===i.typeInfo.name||"mat3x3f"===i.typeInfo.name||"mat3x3h"===i.typeInfo.name){let e=i.data;return new gk([e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8]],r)}if("mat3x4"===i.typeInfo.name||"mat3x4f"===i.typeInfo.name||"mat3x4h"===i.typeInfo.name){let e=i.data;return new gk([e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14]],r)}if("mat4x2"===i.typeInfo.name||"mat4x2f"===i.typeInfo.name||"mat4x2h"===i.typeInfo.name){let e=i.data;return new gk([e[0],e[4],e[1],e[5],e[2],e[6]],r)}if("mat4x3"===i.typeInfo.name||"mat4x3f"===i.typeInfo.name||"mat4x3h"===i.typeInfo.name){let e=i.data;return new gk([e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]],r)}if("mat4x4"===i.typeInfo.name||"mat4x4f"===i.typeInfo.name||"mat4x4h"===i.typeInfo.name){let e=i.data;return new gk([e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15]],r)}return console.error(`Invalid matrix type ${i.typeInfo.name}`),null}Trunc(e,t){let i=this.exec.evalExpression(e.args[0],t);return i instanceof gw?new gw(i.data.map(e=>Math.trunc(e)),i.typeInfo):new g_(Math.trunc(i.value),i.typeInfo)}Dpdx(e,t){return console.error(`TODO: dpdx. Line ${e.line}`),null}DpdxCoarse(e,t){return console.error(`TODO: dpdxCoarse. Line ${e.line}`),null}DpdxFine(e,t){return console.error("TODO: dpdxFine"),null}Dpdy(e,t){return console.error("TODO: dpdy"),null}DpdyCoarse(e,t){return console.error("TODO: dpdyCoarse"),null}DpdyFine(e,t){return console.error("TODO: dpdyFine"),null}Fwidth(e,t){return console.error("TODO: fwidth"),null}FwidthCoarse(e,t){return console.error("TODO: fwidthCoarse"),null}FwidthFine(e,t){return console.error("TODO: fwidthFine"),null}TextureDimensions(e,t){let i=e.args[0],r=e.args.length>1?this.exec.evalExpression(e.args[1],t).value:0;if(i instanceof gi){let n=i.name,a=t.getVariableValue(n);if(a instanceof gT){if(r<0||r>=a.mipLevelCount)return console.error(`Invalid mip level for textureDimensions. Line ${e.line}`),null;let t=a.getMipLevelSize(r),i=a.dimension;return"1d"===i?new g_(t[0],this.getTypeInfo("u32")):"3d"===i?new gw(t,this.getTypeInfo("vec3u")):"2d"===i?new gw(t.slice(0,2),this.getTypeInfo("vec2u")):(console.error(`Invalid texture dimension ${i} not found. Line ${e.line}`),null)}return console.error(`Texture ${n} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureDimensions. Line ${e.line}`),null}TextureGather(e,t){return console.error("TODO: textureGather"),null}TextureGatherCompare(e,t){return console.error("TODO: textureGatherCompare"),null}TextureLoad(e,t){let i=e.args[0],r=this.exec.evalExpression(e.args[1],t),n=e.args.length>2?this.exec.evalExpression(e.args[2],t).value:0;if(!(r instanceof gw)||2!==r.data.length)return console.error(`Invalid UV argument for textureLoad. Line ${e.line}`),null;if(i instanceof gi){let a=i.name,s=t.getVariableValue(a);if(s instanceof gT){let t=Math.floor(r.data[0]),i=Math.floor(r.data[1]);if(t<0||t>=s.width||i<0||i>=s.height)return console.error(`Texture ${a} out of bounds. Line ${e.line}`),null;let o=s.getPixel(t,i,0,n);return null===o?(console.error(`Invalid texture format for textureLoad. Line ${e.line}`),null):new gw(o,this.getTypeInfo("vec4f"))}return console.error(`Texture ${a} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureLoad. Line ${e.line}`),null}TextureNumLayers(e,t){let i=e.args[0];if(i instanceof gi){let r=i.name,n=t.getVariableValue(r);return n instanceof gT?new g_(n.depthOrArrayLayers,this.getTypeInfo("u32")):(console.error(`Texture ${r} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLayers. Line ${e.line}`),null}TextureNumLevels(e,t){let i=e.args[0];if(i instanceof gi){let r=i.name,n=t.getVariableValue(r);return n instanceof gT?new g_(n.mipLevelCount,this.getTypeInfo("u32")):(console.error(`Texture ${r} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumLevels. Line ${e.line}`),null}TextureNumSamples(e,t){let i=e.args[0];if(i instanceof gi){let r=i.name,n=t.getVariableValue(r);return n instanceof gT?new g_(n.sampleCount,this.getTypeInfo("u32")):(console.error(`Texture ${r} not found. Line ${e.line}`),null)}return console.error(`Invalid texture argument for textureNumSamples. Line ${e.line}`),null}TextureSample(e,t){return console.error("TODO: textureSample"),null}TextureSampleBias(e,t){return console.error("TODO: textureSampleBias"),null}TextureSampleCompare(e,t){return console.error("TODO: textureSampleCompare"),null}TextureSampleCompareLevel(e,t){return console.error("TODO: textureSampleCompareLevel"),null}TextureSampleGrad(e,t){return console.error("TODO: textureSampleGrad"),null}TextureSampleLevel(e,t){return console.error("TODO: textureSampleLevel"),null}TextureSampleBaseClampToEdge(e,t){return console.error("TODO: textureSampleBaseClampToEdge"),null}TextureStore(e,t){let i=e.args[0],r=this.exec.evalExpression(e.args[1],t),n=4===e.args.length?this.exec.evalExpression(e.args[2],t).value:0,a=4===e.args.length?this.exec.evalExpression(e.args[3],t).data:this.exec.evalExpression(e.args[2],t).data;if(4!==a.length)return console.error(`Invalid value argument for textureStore. Line ${e.line}`),null;if(!(r instanceof gw)||2!==r.data.length)return console.error(`Invalid UV argument for textureStore. Line ${e.line}`),null;if(i instanceof gi){let s=i.name,o=t.getVariableValue(s);if(o instanceof gT){let t=o.getMipLevelSize(0),i=Math.floor(r.data[0]),l=Math.floor(r.data[1]);return i<0||i>=t[0]||l<0||l>=t[1]?console.error(`Texture ${s} out of bounds. Line ${e.line}`):o.setPixel(i,l,0,n,Array.from(a)),null}return console.error(`Texture ${s} not found. Line ${e.line}`),null}return console.error(`Invalid texture argument for textureStore. Line ${e.line}`),null}AtomicLoad(e,t){let i=e.args[0];i instanceof gl&&(i=i.right);let r=this.exec.getVariableName(i,t);return t.getVariable(r).value.getSubData(this.exec,i.postfix,t)}AtomicStore(e,t){let i=e.args[0];i instanceof gl&&(i=i.right);let r=this.exec.getVariableName(i,t),n=t.getVariable(r),a=e.args[1],s=this.exec.evalExpression(a,t),o=n.value.getSubData(this.exec,i.postfix,t);return o instanceof g_&&s instanceof g_&&(o.value=s.value),n.value instanceof gE&&n.value.setDataValue(this.exec,o,i.postfix,t),null}AtomicAdd(e,t){let i=e.args[0];i instanceof gl&&(i=i.right);let r=this.exec.getVariableName(i,t),n=t.getVariable(r),a=e.args[1],s=this.exec.evalExpression(a,t),o=n.value.getSubData(this.exec,i.postfix,t),l=new g_(o.value,o.typeInfo);return o instanceof g_&&s instanceof g_&&(o.value+=s.value),n.value instanceof gE&&n.value.setDataValue(this.exec,o,i.postfix,t),l}AtomicSub(e,t){let i=e.args[0];i instanceof gl&&(i=i.right);let r=this.exec.getVariableName(i,t),n=t.getVariable(r),a=e.args[1],s=this.exec.evalExpression(a,t),o=n.value.getSubData(this.exec,i.postfix,t),l=new g_(o.value,o.typeInfo);return o instanceof g_&&s instanceof g_&&(o.value-=s.value),n.value instanceof gE&&n.value.setDataValue(this.exec,o,i.postfix,t),l}AtomicMax(e,t){let i=e.args[0];i instanceof gl&&(i=i.right);let r=this.exec.getVariableName(i,t),n=t.getVariable(r),a=e.args[1],s=this.exec.evalExpression(a,t),o=n.value.getSubData(this.exec,i.postfix,t),l=new g_(o.value,o.typeInfo);return o instanceof g_&&s instanceof g_&&(o.value=Math.max(o.value,s.value)),n.value instanceof gE&&n.value.setDataValue(this.exec,o,i.postfix,t),l}AtomicMin(e,t){let i=e.args[0];i instanceof gl&&(i=i.right);let r=this.exec.getVariableName(i,t),n=t.getVariable(r),a=e.args[1],s=this.exec.evalExpression(a,t),o=n.value.getSubData(this.exec,i.postfix,t),l=new g_(o.value,o.typeInfo);return o instanceof g_&&s instanceof g_&&(o.value=Math.min(o.value,s.value)),n.value instanceof gE&&n.value.setDataValue(this.exec,o,i.postfix,t),l}AtomicAnd(e,t){let i=e.args[0];i instanceof gl&&(i=i.right);let r=this.exec.getVariableName(i,t),n=t.getVariable(r),a=e.args[1],s=this.exec.evalExpression(a,t),o=n.value.getSubData(this.exec,i.postfix,t),l=new g_(o.value,o.typeInfo);return o instanceof g_&&s instanceof g_&&(o.value=o.value&s.value),n.value instanceof gE&&n.value.setDataValue(this.exec,o,i.postfix,t),l}AtomicOr(e,t){let i=e.args[0];i instanceof gl&&(i=i.right);let r=this.exec.getVariableName(i,t),n=t.getVariable(r),a=e.args[1],s=this.exec.evalExpression(a,t),o=n.value.getSubData(this.exec,i.postfix,t),l=new g_(o.value,o.typeInfo);return o instanceof g_&&s instanceof g_&&(o.value=o.value|s.value),n.value instanceof gE&&n.value.setDataValue(this.exec,o,i.postfix,t),l}AtomicXor(e,t){let i=e.args[0];i instanceof gl&&(i=i.right);let r=this.exec.getVariableName(i,t),n=t.getVariable(r),a=e.args[1],s=this.exec.evalExpression(a,t),o=n.value.getSubData(this.exec,i.postfix,t),l=new g_(o.value,o.typeInfo);return o instanceof g_&&s instanceof g_&&(o.value=o.value^s.value),n.value instanceof gE&&n.value.setDataValue(this.exec,o,i.postfix,t),l}AtomicExchange(e,t){let i=e.args[0];i instanceof gl&&(i=i.right);let r=this.exec.getVariableName(i,t),n=t.getVariable(r),a=e.args[1],s=this.exec.evalExpression(a,t),o=n.value.getSubData(this.exec,i.postfix,t),l=new g_(o.value,o.typeInfo);return o instanceof g_&&s instanceof g_&&(o.value=s.value),n.value instanceof gE&&n.value.setDataValue(this.exec,o,i.postfix,t),l}AtomicCompareExchangeWeak(e,t){return console.error("TODO: atomicCompareExchangeWeak"),null}Pack4x8snorm(e,t){return console.error("TODO: pack4x8snorm"),null}Pack4x8unorm(e,t){return console.error("TODO: pack4x8unorm"),null}Pack4xI8(e,t){return console.error("TODO: pack4xI8"),null}Pack4xU8(e,t){return console.error("TODO: pack4xU8"),null}Pack4x8Clamp(e,t){return console.error("TODO: pack4x8Clamp"),null}Pack4xU8Clamp(e,t){return console.error("TODO: pack4xU8Clamp"),null}Pack2x16snorm(e,t){return console.error("TODO: pack2x16snorm"),null}Pack2x16unorm(e,t){return console.error("TODO: pack2x16unorm"),null}Pack2x16float(e,t){return console.error("TODO: pack2x16float"),null}Unpack4x8snorm(e,t){return console.error("TODO: unpack4x8snorm"),null}Unpack4x8unorm(e,t){return console.error("TODO: unpack4x8unorm"),null}Unpack4xI8(e,t){return console.error("TODO: unpack4xI8"),null}Unpack4xU8(e,t){return console.error("TODO: unpack4xU8"),null}Unpack2x16snorm(e,t){return console.error("TODO: unpack2x16snorm"),null}Unpack2x16unorm(e,t){return console.error("TODO: unpack2x16unorm"),null}Unpack2x16float(e,t){return console.error("TODO: unpack2x16float"),null}StorageBarrier(e,t){return null}TextureBarrier(e,t){return null}WorkgroupBarrier(e,t){return null}WorkgroupUniformLoad(e,t){return null}SubgroupAdd(e,t){return console.error("TODO: subgroupAdd"),null}SubgroupExclusiveAdd(e,t){return console.error("TODO: subgroupExclusiveAdd"),null}SubgroupInclusiveAdd(e,t){return console.error("TODO: subgroupInclusiveAdd"),null}SubgroupAll(e,t){return console.error("TODO: subgroupAll"),null}SubgroupAnd(e,t){return console.error("TODO: subgroupAnd"),null}SubgroupAny(e,t){return console.error("TODO: subgroupAny"),null}SubgroupBallot(e,t){return console.error("TODO: subgroupBallot"),null}SubgroupBroadcast(e,t){return console.error("TODO: subgroupBroadcast"),null}SubgroupBroadcastFirst(e,t){return console.error("TODO: subgroupBroadcastFirst"),null}SubgroupElect(e,t){return console.error("TODO: subgroupElect"),null}SubgroupMax(e,t){return console.error("TODO: subgroupMax"),null}SubgroupMin(e,t){return console.error("TODO: subgroupMin"),null}SubgroupMul(e,t){return console.error("TODO: subgroupMul"),null}SubgroupExclusiveMul(e,t){return console.error("TODO: subgroupExclusiveMul"),null}SubgroupInclusiveMul(e,t){return console.error("TODO: subgroupInclusiveMul"),null}SubgroupOr(e,t){return console.error("TODO: subgroupOr"),null}SubgroupShuffle(e,t){return console.error("TODO: subgroupShuffle"),null}SubgroupShuffleDown(e,t){return console.error("TODO: subgroupShuffleDown"),null}SubgroupShuffleUp(e,t){return console.error("TODO: subgroupShuffleUp"),null}SubgroupShuffleXor(e,t){return console.error("TODO: subgroupShuffleXor"),null}SubgroupXor(e,t){return console.error("TODO: subgroupXor"),null}QuadBroadcast(e,t){return console.error("TODO: quadBroadcast"),null}QuadSwapDiagonal(e,t){return console.error("TODO: quadSwapDiagonal"),null}QuadSwapX(e,t){return console.error("TODO: quadSwapX"),null}QuadSwapY(e,t){return console.error("TODO: quadSwapY"),null}}let gK={vec2:2,vec2f:2,vec2i:2,vec2u:2,vec2b:2,vec2h:2,vec3:3,vec3f:3,vec3i:3,vec3u:3,vec3b:3,vec3h:3,vec4:4,vec4f:4,vec4i:4,vec4u:4,vec4b:4,vec4h:4},gZ={mat2x2:[2,2,4],mat2x2f:[2,2,4],mat2x2h:[2,2,4],mat2x3:[2,3,6],mat2x3f:[2,3,6],mat2x3h:[2,3,6],mat2x4:[2,4,8],mat2x4f:[2,4,8],mat2x4h:[2,4,8],mat3x2:[3,2,6],mat3x2f:[3,2,6],mat3x2h:[3,2,6],mat3x3:[3,3,9],mat3x3f:[3,3,9],mat3x3h:[3,3,9],mat3x4:[3,4,12],mat3x4f:[3,4,12],mat3x4h:[3,4,12],mat4x2:[4,2,8],mat4x2f:[4,2,8],mat4x2h:[4,2,8],mat4x3:[4,3,12],mat4x3f:[4,3,12],mat4x3h:[4,3,12],mat4x4:[4,4,16],mat4x4f:[4,4,16],mat4x4h:[4,4,16]};class gJ extends gY{constructor(e,t){var i;super(),this.ast=null!=e?e:[],this.reflection=new g$,this.reflection.updateAST(this.ast),this.context=null!=(i=null==t?void 0:t.clone())?i:new gG,this.builtins=new gX(this),this.typeInfo={bool:this.getTypeInfo(p1.bool),i32:this.getTypeInfo(p1.i32),u32:this.getTypeInfo(p1.u32),f32:this.getTypeInfo(p1.f32),f16:this.getTypeInfo(p1.f16),vec2f:this.getTypeInfo(p4.vec2f),vec2u:this.getTypeInfo(p4.vec2u),vec2i:this.getTypeInfo(p4.vec2i),vec2h:this.getTypeInfo(p4.vec2h),vec3f:this.getTypeInfo(p4.vec3f),vec3u:this.getTypeInfo(p4.vec3u),vec3i:this.getTypeInfo(p4.vec3i),vec3h:this.getTypeInfo(p4.vec3h),vec4f:this.getTypeInfo(p4.vec4f),vec4u:this.getTypeInfo(p4.vec4u),vec4i:this.getTypeInfo(p4.vec4i),vec4h:this.getTypeInfo(p4.vec4h),mat2x2f:this.getTypeInfo(p4.mat2x2f),mat2x3f:this.getTypeInfo(p4.mat2x3f),mat2x4f:this.getTypeInfo(p4.mat2x4f),mat3x2f:this.getTypeInfo(p4.mat3x2f),mat3x3f:this.getTypeInfo(p4.mat3x3f),mat3x4f:this.getTypeInfo(p4.mat3x4f),mat4x2f:this.getTypeInfo(p4.mat4x2f),mat4x3f:this.getTypeInfo(p4.mat4x3f),mat4x4f:this.getTypeInfo(p4.mat4x4f)}}getVariableValue(e){var t,i;let r=null!=(i=null==(t=this.context.getVariable(e))?void 0:t.value)?i:null;if(null===r)return null;if(r instanceof g_)return r.value;if(r instanceof gw||r instanceof gk)return Array.from(r.data);if(r instanceof gE&&r.typeInfo instanceof po){if("u32"===r.typeInfo.format.name)return Array.from(new Uint32Array(r.buffer,r.offset,r.typeInfo.count));if("i32"===r.typeInfo.format.name)return Array.from(new Int32Array(r.buffer,r.offset,r.typeInfo.count));if("f32"===r.typeInfo.format.name)return Array.from(new Float32Array(r.buffer,r.offset,r.typeInfo.count))}return console.error(`Unsupported return variable type ${r.typeInfo.name}`),null}execute(e){(e=null!=e?e:{}).constants&&this._setOverrides(e.constants,this.context),this._execStatements(this.ast,this.context)}dispatchWorkgroups(e,t,i,r){let n=this.context.clone();(r=null!=r?r:{}).constants&&this._setOverrides(r.constants,n),this._execStatements(this.ast,n);let a=n.getFunction(e);if(!a)return void console.error(`Function ${e} not found`);if("number"==typeof t)t=[t,1,1];else{if(0===t.length)return void console.error("Invalid dispatch count");1===t.length?t=[t[0],1,1]:2===t.length?t=[t[0],t[1],1]:t.length>3&&(t=[t[0],t[1],t[2]])}let s=t[0],o=t[1],l=t[2],c=this.getTypeInfo("vec3u");n.setVariable("@num_workgroups",new gw(t,c));let u=this.reflection.getFunctionInfo(e);for(let t in null===u&&console.error(`Function ${e} not found in reflection data`),i)for(let e in i[t]){let r=i[t][e];n.variables.forEach(i=>{var n;let a=i.node;if(null==a?void 0:a.attributes){let s=null,o=null;for(let e of a.attributes)"binding"===e.name?s=e.value:"group"===e.name&&(o=e.value);if(e==s&&t==o){let s=!1;for(let r of u.resources)if(r.name===i.name&&r.group===parseInt(t)&&r.binding===parseInt(e)){s=!0;break}s&&(void 0!==r.texture&&void 0!==r.descriptor?i.value=new gT(r.texture,this.getTypeInfo(a.type),r.descriptor,null!=(n=r.texture.view)?n:null):void 0!==r.uniform?i.value=new gE(r.uniform,this.getTypeInfo(a.type)):i.value=new gE(r,this.getTypeInfo(a.type)))}}})}for(let e=0;e<l;++e)for(let t=0;t<o;++t)for(let i=0;i<s;++i)n.setVariable("@workgroup_id",new gw([i,t,e],this.getTypeInfo("vec3u"))),this._dispatchWorkgroup(a,[i,t,e],n)}execStatement(e,t){if(e instanceof pG)return this.evalExpression(e.value,t);if(e instanceof pQ){if(e.condition){let i=this.evalExpression(e.condition,t);if(!(i instanceof g_))throw Error("Invalid break-if condition");if(!i.value)return null}return gJ._breakObj}if(e instanceof p0)return gJ._continueObj;if(e instanceof pF)this._let(e,t);else if(e instanceof pj)this._var(e,t);else if(e instanceof pz)this._const(e,t);else if(e instanceof pL)this._function(e,t);else{if(e instanceof pq)return this._if(e,t);if(e instanceof pH)return this._switch(e,t);if(e instanceof pN)return this._for(e,t);if(e instanceof pO)return this._while(e,t);if(e instanceof pW)return this._loop(e,t);if(e instanceof pR){let i=t.clone();return i.currentFunctionName=t.currentFunctionName,this._execStatements(e.body,i)}if(e instanceof pU)this._assign(e,t);else if(e instanceof pV)this._increment(e,t);else{if(e instanceof p3)return null;if(e instanceof pB){let i=e.name;null===t.getVariable(i)&&t.setVariable(i,new g_(0,this.getTypeInfo("u32")))}else if(e instanceof p$)this._call(e,t);else{if(e instanceof pK||e instanceof pZ)return null;console.error("Invalid statement type.",e,`Line ${e.line}`)}}}return null}evalExpression(e,t){return e instanceof gc?this._evalBinaryOp(e,t):e instanceof gn?this._evalLiteral(e,t):e instanceof gi?this._evalVariable(e,t):e instanceof gt?this._evalCall(e,t):e instanceof ge?this._evalCreate(e,t):e instanceof gr?this._evalConst(e,t):e instanceof ga?this._evalBitcast(e,t):e instanceof gl?this._evalUnaryOp(e,t):(console.error("Invalid expression type",e,`Line ${e.line}`),null)}getTypeInfo(e){var t;if(e instanceof p1){let t=this.reflection.getTypeInfo(e);if(null!==t)return t}let i=null!=(t=this.typeInfo[e])?t:null;return null!==i||(i=this.reflection.getTypeInfoByName(e)),i}_setOverrides(e,t){for(let i in e){let r=e[i],n=this.reflection.getOverrideInfo(i);null!==n?(null===n.type&&(n.type=this.getTypeInfo("u32")),"u32"===n.type.name||"i32"===n.type.name||"f32"===n.type.name||"f16"===n.type.name?t.setVariable(i,new g_(r,n.type)):"bool"===n.type.name?t.setVariable(i,new g_(+!!r,n.type)):"vec2"===n.type.name||"vec3"===n.type.name||"vec4"===n.type.name||"vec2f"===n.type.name||"vec3f"===n.type.name||"vec4f"===n.type.name||"vec2i"===n.type.name||"vec3i"===n.type.name||"vec4i"===n.type.name||"vec2u"===n.type.name||"vec3u"===n.type.name||"vec4u"===n.type.name||"vec2h"===n.type.name||"vec3h"===n.type.name||"vec4h"===n.type.name?t.setVariable(i,new gw(r,n.type)):console.error(`Invalid constant type for ${i}`)):console.error(`Override ${i} does not exist in the shader.`)}}_dispatchWorkgroup(e,t,i){let r=[1,1,1];for(let t of e.node.attributes)if("workgroup_size"===t.name){if(t.value.length>0){let e=i.getVariableValue(t.value[0]);r[0]=e instanceof g_?e.value:parseInt(t.value[0])}if(t.value.length>1){let e=i.getVariableValue(t.value[1]);r[1]=e instanceof g_?e.value:parseInt(t.value[1])}if(t.value.length>2){let e=i.getVariableValue(t.value[2]);r[2]=e instanceof g_?e.value:parseInt(t.value[2])}}let n=this.getTypeInfo("vec3u"),a=this.getTypeInfo("u32");i.setVariable("@workgroup_size",new gw(r,n));let s=r[0],o=r[1],l=r[2];for(let c=0,u=0;c<l;++c)for(let l=0;l<o;++l)for(let o=0;o<s;++o,++u){let s=[o,l,c],h=[o+t[0]*r[0],l+t[1]*r[1],c+t[2]*r[2]];i.setVariable("@local_invocation_id",new gw(s,n)),i.setVariable("@global_invocation_id",new gw(h,n)),i.setVariable("@local_invocation_index",new g_(u,a)),this._dispatchExec(e,i)}}_dispatchExec(e,t){for(let i of e.node.args)for(let e of i.attributes)if("builtin"===e.name){let r=`@${e.value}`,n=t.getVariable(r);void 0!==n&&t.variables.set(i.name,n)}this._execStatements(e.node.body,t)}getVariableName(e,t){for(;e instanceof gl;)e=e.right;return e instanceof gi?e.name:(console.error("Unknown variable type",e,"Line",e.line),null)}_execStatements(e,t){for(let i of e){if(i instanceof Array){let e=t.clone(),r=this._execStatements(i,e);if(r)return r;continue}let e=this.execStatement(i,t);if(e)return e}return null}_call(e,t){let i=t.clone();i.currentFunctionName=e.name;let r=t.getFunction(e.name);if(r){for(let t=0;t<r.node.args.length;++t){let n=r.node.args[t],a=this.evalExpression(e.args[t],i);i.setVariable(n.name,a,n)}this._execStatements(r.node.body,i)}else e.isBuiltin?this._callBuiltinFunction(e,i):this.getTypeInfo(e.name)&&this._evalCreate(e,t)}_increment(e,t){let i=this.getVariableName(e.variable,t),r=t.getVariable(i);r?"++"===e.operator?r.value instanceof g_?r.value.value++:console.error(`Variable ${i} is not a scalar. Line ${e.line}`):"--"===e.operator?r.value instanceof g_?r.value.value--:console.error(`Variable ${i} is not a scalar. Line ${e.line}`):console.error(`Unknown increment operator ${e.operator}. Line ${e.line}`):console.error(`Variable ${i} not found. Line ${e.line}`)}_getVariableData(e,t){if(e instanceof gi){let i=this.getVariableName(e,t),r=t.getVariable(i);return null===r?(console.error(`Variable ${i} not found. Line ${e.line}`),null):r.value.getSubData(this,e.postfix,t)}if(e instanceof gl){if("*"===e.operator){let i=this._getVariableData(e.right,t);return i instanceof gx?i.reference.getSubData(this,e.postfix,t):(console.error(`Variable ${e.right} is not a pointer. Line ${e.line}`),null)}if("&"===e.operator)return new gx(this._getVariableData(e.right,t))}return null}_assign(e,t){let i=null,r="<var>",n=null;if(e.variable instanceof gl){let i=this._getVariableData(e.variable,t),r=this.evalExpression(e.value,t),n=e.operator;if("="===n){if(i instanceof g_||i instanceof gw||i instanceof gk){if(r instanceof g_||r instanceof gw||r instanceof gk&&i.data.length===r.data.length)return void i.data.set(r.data);console.error(`Invalid assignment. Line ${e.line}`)}else if(i instanceof gE&&r instanceof gE&&i.buffer.byteLength-i.offset>=r.buffer.byteLength-r.offset)return void(i.buffer.byteLength%4==0?new Uint32Array(i.buffer,i.offset,i.typeInfo.size/4).set(new Uint32Array(r.buffer,r.offset,r.typeInfo.size/4)):new Uint8Array(i.buffer,i.offset,i.typeInfo.size).set(new Uint8Array(r.buffer,r.offset,r.typeInfo.size)));return console.error(`Invalid assignment. Line ${e.line}`),null}if("+="===n)return i instanceof g_||i instanceof gw||i instanceof gk?r instanceof g_||r instanceof gw||r instanceof gk?void i.data.set(r.data.map((e,t)=>i.data[t]+e)):void console.error(`Invalid assignment . Line ${e.line}`):void console.error(`Invalid assignment. Line ${e.line}`);if("-="===n)return(i instanceof g_||i instanceof gw||i instanceof gk)&&(r instanceof g_||r instanceof gw||r instanceof gk)?void i.data.set(r.data.map((e,t)=>i.data[t]-e)):void console.error(`Invalid assignment. Line ${e.line}`)}if(e.variable instanceof gl){if("*"===e.variable.operator){r=this.getVariableName(e.variable.right,t);let n=t.getVariable(r);if(!(n&&n.value instanceof gx))return void console.error(`Variable ${r} is not a pointer. Line ${e.line}`);i=n.value.reference;let a=e.variable.postfix;if(!a){let t=e.variable.right;for(;t instanceof gl;){if(t.postfix){a=t.postfix;break}t=t.right}}a&&(i=i.getSubData(this,a,t))}}else{n=e.variable.postfix,r=this.getVariableName(e.variable,t);let a=t.getVariable(r);if(null===a)return void console.error(`Variable ${r} not found. Line ${e.line}`);i=a.value}if(i instanceof gx&&(i=i.reference),null===i)return void console.error(`Variable ${r} not found. Line ${e.line}`);let a=this.evalExpression(e.value,t),s=e.operator;if("="!==s){let r=i.getSubData(this,n,t);if(r instanceof gw&&a instanceof g_){let t=r.data,i=a.value;if("+="===s)for(let e=0;e<t.length;++e)t[e]+=i;else if("-="===s)for(let e=0;e<t.length;++e)t[e]-=i;else if("*="===s)for(let e=0;e<t.length;++e)t[e]*=i;else if("/="===s)for(let e=0;e<t.length;++e)t[e]/=i;else if("%="===s)for(let e=0;e<t.length;++e)t[e]%=i;else if("&="===s)for(let e=0;e<t.length;++e)t[e]&=i;else if("|="===s)for(let e=0;e<t.length;++e)t[e]|=i;else if("^="===s)for(let e=0;e<t.length;++e)t[e]^=i;else if("<<="===s)for(let e=0;e<t.length;++e)t[e]<<=i;else if(">>="===s)for(let e=0;e<t.length;++e)t[e]>>=i;else console.error(`Invalid operator ${s}. Line ${e.line}`)}else if(r instanceof gw&&a instanceof gw){let t=r.data,i=a.data;if(t.length!==i.length)return void console.error(`Vector length mismatch. Line ${e.line}`);if("+="===s)for(let e=0;e<t.length;++e)t[e]+=i[e];else if("-="===s)for(let e=0;e<t.length;++e)t[e]-=i[e];else if("*="===s)for(let e=0;e<t.length;++e)t[e]*=i[e];else if("/="===s)for(let e=0;e<t.length;++e)t[e]/=i[e];else if("%="===s)for(let e=0;e<t.length;++e)t[e]%=i[e];else if("&="===s)for(let e=0;e<t.length;++e)t[e]&=i[e];else if("|="===s)for(let e=0;e<t.length;++e)t[e]|=i[e];else if("^="===s)for(let e=0;e<t.length;++e)t[e]^=i[e];else if("<<="===s)for(let e=0;e<t.length;++e)t[e]<<=i[e];else if(">>="===s)for(let e=0;e<t.length;++e)t[e]>>=i[e];else console.error(`Invalid operator ${s}. Line ${e.line}`)}else{if(!(r instanceof g_&&a instanceof g_))return void console.error(`Invalid type for ${e.operator} operator. Line ${e.line}`);"+="===s?r.value+=a.value:"-="===s?r.value-=a.value:"*="===s?r.value*=a.value:"/="===s?r.value/=a.value:"%="===s?r.value%=a.value:"&="===s?r.value&=a.value:"|="===s?r.value|=a.value:"^="===s?r.value^=a.value:"<<="===s?r.value<<=a.value:">>="===s?r.value>>=a.value:console.error(`Invalid operator ${s}. Line ${e.line}`)}return void(i instanceof gE&&i.setDataValue(this,r,n,t))}if(i instanceof gE)i.setDataValue(this,a,n,t);else if(n){if(!(i instanceof gw||i instanceof gk))return void console.error(`Variable ${r} is not a vector or matrix. Line ${e.line}`);if(n instanceof gs){let s=this.evalExpression(n.index,t).value;if(i instanceof gw){if(!(a instanceof g_))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);i.data[s]=a.value}else{if(!(i instanceof gk))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);{let s=this.evalExpression(n.index,t).value;if(s<0||!(a instanceof gw))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);{let t=i.typeInfo.getTypeName();if("mat2x2"===t||"mat2x2f"===t||"mat2x2h"===t){if(!(s<2&&2===a.data.length))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);i.data[2*s]=a.data[0],i.data[2*s+1]=a.data[1]}else if("mat2x3"===t||"mat2x3f"===t||"mat2x3h"===t){if(!(s<2&&3===a.data.length))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);i.data[3*s]=a.data[0],i.data[3*s+1]=a.data[1],i.data[3*s+2]=a.data[2]}else if("mat2x4"===t||"mat2x4f"===t||"mat2x4h"===t){if(!(s<2&&4===a.data.length))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);i.data[4*s]=a.data[0],i.data[4*s+1]=a.data[1],i.data[4*s+2]=a.data[2],i.data[4*s+3]=a.data[3]}else if("mat3x2"===t||"mat3x2f"===t||"mat3x2h"===t){if(!(s<3&&2===a.data.length))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);i.data[2*s]=a.data[0],i.data[2*s+1]=a.data[1]}else if("mat3x3"===t||"mat3x3f"===t||"mat3x3h"===t){if(!(s<3&&3===a.data.length))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);i.data[3*s]=a.data[0],i.data[3*s+1]=a.data[1],i.data[3*s+2]=a.data[2]}else if("mat3x4"===t||"mat3x4f"===t||"mat3x4h"===t){if(!(s<3&&4===a.data.length))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);i.data[4*s]=a.data[0],i.data[4*s+1]=a.data[1],i.data[4*s+2]=a.data[2],i.data[4*s+3]=a.data[3]}else if("mat4x2"===t||"mat4x2f"===t||"mat4x2h"===t){if(!(s<4&&2===a.data.length))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);i.data[2*s]=a.data[0],i.data[2*s+1]=a.data[1]}else if("mat4x3"===t||"mat4x3f"===t||"mat4x3h"===t){if(!(s<4&&3===a.data.length))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);i.data[3*s]=a.data[0],i.data[3*s+1]=a.data[1],i.data[3*s+2]=a.data[2]}else{if("mat4x4"!==t&&"mat4x4f"!==t&&"mat4x4h"!==t||!(s<4&&4===a.data.length))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);i.data[4*s]=a.data[0],i.data[4*s+1]=a.data[1],i.data[4*s+2]=a.data[2],i.data[4*s+3]=a.data[3]}}}}}else if(n instanceof p7){let t=n.value;if(!(i instanceof gw))return void console.error(`Invalid assignment to ${t}. Variable ${r} is not a vector. Line ${e.line}`);if(a instanceof g_){if(t.length>1)return void console.error(`Invalid assignment to ${t} for variable ${r}. Line ${e.line}`);if("x"===t)i.data[0]=a.value;else if("y"===t){if(i.data.length<2)return void console.error(`Invalid assignment to ${t} for variable ${r}. Line ${e.line}`);i.data[1]=a.value}else if("z"===t){if(i.data.length<3)return void console.error(`Invalid assignment to ${t} for variable ${r}. Line ${e.line}`);i.data[2]=a.value}else if("w"===t){if(i.data.length<4)return void console.error(`Invalid assignment to ${t} for variable ${r}. Line ${e.line}`);i.data[3]=a.value}}else{if(!(a instanceof gw))return void console.error(`Invalid assignment to ${r}. Line ${e.line}`);if(t.length!==a.data.length)return void console.error(`Invalid assignment to ${t} for variable ${r}. Line ${e.line}`);for(let n=0;n<t.length;++n){let s=t[n];if("x"===s||"r"===s)i.data[0]=a.data[n];else if("y"===s||"g"===s){if(a.data.length<2)return void console.error(`Invalid assignment to ${s} for variable ${r}. Line ${e.line}`);i.data[1]=a.data[n]}else if("z"===s||"b"===s){if(a.data.length<3)return void console.error(`Invalid assignment to ${s} for variable ${r}. Line ${e.line}`);i.data[2]=a.data[n]}else{if("w"!==s&&"a"!==s||a.data.length<4)return void console.error(`Invalid assignment to ${s} for variable ${r}. Line ${e.line}`);i.data[3]=a.data[n]}}}}}else i instanceof g_&&a instanceof g_?i.value=a.value:i instanceof gw&&a instanceof gw||i instanceof gk&&a instanceof gk?i.data.set(a.data):console.error(`Invalid assignment to ${r}. Line ${e.line}`)}_function(e,t){let i=new gq(e);t.functions.set(e.name,i)}_const(e,t){let i=null;null!==e.value&&(i=this.evalExpression(e.value,t)),t.createVariable(e.name,i,e)}_let(e,t){let i=null;if(null!==e.value){if(null===(i=this.evalExpression(e.value,t)))return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof gl||(i=i.clone())}else{let r=e.type.name;if("f32"===r||"i32"===r||"u32"===r||"bool"===r||"f16"===r||"vec2"===r||"vec3"===r||"vec4"===r||"vec2f"===r||"vec3f"===r||"vec4f"===r||"vec2i"===r||"vec3i"===r||"vec4i"===r||"vec2u"===r||"vec3u"===r||"vec4u"===r||"vec2h"===r||"vec3h"===r||"vec4h"===r||"vec2b"===r||"vec3b"===r||"vec4b"===r||"mat2x2"===r||"mat2x3"===r||"mat2x4"===r||"mat3x2"===r||"mat3x3"===r||"mat3x4"===r||"mat4x2"===r||"mat4x3"===r||"mat4x4"===r||"mat2x2f"===r||"mat2x3f"===r||"mat2x4f"===r||"mat3x2f"===r||"mat3x3f"===r||"mat3x4f"===r||"mat4x2f"===r||"mat4x3f"===r||"mat4x4f"===r||"mat2x2h"===r||"mat2x3h"===r||"mat2x4h"===r||"mat3x2h"===r||"mat3x3h"===r||"mat3x4h"===r||"mat4x2h"===r||"mat4x3h"===r||"mat4x4h"===r||"array"===r){let r=new ge(e.type,[]);i=this._evalCreate(r,t)}}t.createVariable(e.name,i,e)}_var(e,t){let i=null;if(null!==e.value){if(null===(i=this.evalExpression(e.value,t)))return void console.error(`Invalid value for variable ${e.name}. Line ${e.line}`);e.value instanceof gl||(i=i.clone())}else{if(null===e.type)return void console.error(`Variable ${e.name} has no type. Line ${e.line}`);let r=e.type.name;if("f32"===r||"i32"===r||"u32"===r||"bool"===r||"f16"===r||"vec2"===r||"vec3"===r||"vec4"===r||"vec2f"===r||"vec3f"===r||"vec4f"===r||"vec2i"===r||"vec3i"===r||"vec4i"===r||"vec2u"===r||"vec3u"===r||"vec4u"===r||"vec2h"===r||"vec3h"===r||"vec4h"===r||"vec2b"===r||"vec3b"===r||"vec4b"===r||"mat2x2"===r||"mat2x3"===r||"mat2x4"===r||"mat3x2"===r||"mat3x3"===r||"mat3x4"===r||"mat4x2"===r||"mat4x3"===r||"mat4x4"===r||"mat2x2f"===r||"mat2x3f"===r||"mat2x4f"===r||"mat3x2f"===r||"mat3x3f"===r||"mat3x4f"===r||"mat4x2f"===r||"mat4x3f"===r||"mat4x4f"===r||"mat2x2h"===r||"mat2x3h"===r||"mat2x4h"===r||"mat3x2h"===r||"mat3x3h"===r||"mat3x4h"===r||"mat4x2h"===r||"mat4x3h"===r||"mat4x4h"===r||e.type instanceof p6||e.type instanceof p3||e.type instanceof p4){let r=new ge(e.type,[]);i=this._evalCreate(r,t)}}t.createVariable(e.name,i,e)}_switch(e,t){t=t.clone();let i=this.evalExpression(e.condition,t);if(!(i instanceof g_))return console.error(`Invalid if condition. Line ${e.line}`),null;let r=null;for(let n of e.cases)if(n instanceof gd)for(let a of n.selectors){if(a instanceof gh){r=n;continue}let s=this.evalExpression(a,t);if(!(s instanceof g_))return console.error(`Invalid case selector. Line ${e.line}`),null;if(s.value===i.value)return this._execStatements(n.body,t)}else n instanceof gf&&(r=n);return r?this._execStatements(r.body,t):null}_if(e,t){t=t.clone();let i=this.evalExpression(e.condition,t);if(!(i instanceof g_))return console.error(`Invalid if condition. Line ${e.line}`),null;if(i.value)return this._execStatements(e.body,t);for(let i of e.elseif){let r=this.evalExpression(i.condition,t);if(!(r instanceof g_))return console.error(`Invalid if condition. Line ${e.line}`),null;if(r.value)return this._execStatements(i.body,t)}return e.else?this._execStatements(e.else,t):null}_getScalarValue(e){return e instanceof g_?e.value:(console.error("Expected scalar value.",e),0)}_for(e,t){for(t=t.clone(),this.execStatement(e.init,t);this._getScalarValue(this.evalExpression(e.condition,t));){let i=this._execStatements(e.body,t);if(i===gJ._breakObj)break;if(null!==i&&i!==gJ._continueObj)return i;this.execStatement(e.increment,t)}return null}_loop(e,t){for(t=t.clone();;){let i=this._execStatements(e.body,t);if(i===gJ._breakObj)break;if(i===gJ._continueObj){if(e.continuing&&this._execStatements(e.continuing.body,t)===gJ._breakObj)break}else if(null!==i)return i}return null}_while(e,t){for(t=t.clone();this._getScalarValue(this.evalExpression(e.condition,t));){let i=this._execStatements(e.body,t);if(i===gJ._breakObj)break;if(i!==gJ._continueObj&&null!==i)return i}return null}_evalBitcast(e,t){let i=this.evalExpression(e.value,t),r=e.type;if(i instanceof g_)return new g_(gz(i.value,i.typeInfo.name,r.name),this.getTypeInfo(r));if(i instanceof gw){let t=i.typeInfo.getTypeName(),n="";if(t.endsWith("f"))n="f32";else if(t.endsWith("i"))n="i32";else if(t.endsWith("u"))n="u32";else if(t.endsWith("b"))n="bool";else{if(!t.endsWith("h"))return console.error(`Unknown vector type ${t}. Line ${e.line}`),null;n="f16"}let a=r.getTypeName(),s="";if(a.endsWith("f"))s="f32";else if(a.endsWith("i"))s="i32";else if(a.endsWith("u"))s="u32";else if(a.endsWith("b"))s="bool";else{if(!a.endsWith("h"))return console.error(`Unknown vector type ${s}. Line ${e.line}`),null;s="f16"}return new gw(function(e,t,i){if(t===i)return e;let r=Array(e.length);for(let n=0;n<e.length;n++)r[n]=gz(e[n],t,i);return r}(Array.from(i.data),n,s),this.getTypeInfo(r))}return console.error(`TODO: bitcast for ${i.typeInfo.name}. Line ${e.line}`),null}_evalConst(e,t){return t.getVariableValue(e.name).clone().getSubData(this,e.postfix,t)}_evalCreate(e,t){var i;if(e instanceof ge){if(null===e.type)return gb.void;switch(e.type.getTypeName()){case"bool":case"i32":case"u32":case"f32":case"f16":return this._callConstructorValue(e,t);case"vec2":case"vec3":case"vec4":case"vec2f":case"vec3f":case"vec4f":case"vec2h":case"vec3h":case"vec4h":case"vec2i":case"vec3i":case"vec4i":case"vec2u":case"vec3u":case"vec4u":case"vec2b":case"vec3b":case"vec4b":return this._callConstructorVec(e,t);case"mat2x2":case"mat2x2f":case"mat2x2h":case"mat2x3":case"mat2x3f":case"mat2x3h":case"mat2x4":case"mat2x4f":case"mat2x4h":case"mat3x2":case"mat3x2f":case"mat3x2h":case"mat3x3":case"mat3x3f":case"mat3x3h":case"mat3x4":case"mat3x4f":case"mat3x4h":case"mat4x2":case"mat4x2f":case"mat4x2h":case"mat4x3":case"mat4x3f":case"mat4x3h":case"mat4x4":case"mat4x4f":case"mat4x4h":return this._callConstructorMatrix(e,t)}}let r=e instanceof ge?e.type.name:e.name,n=e instanceof ge?this.getTypeInfo(e.type):this.getTypeInfo(e.name);if(null===n)return console.error(`Unknown type ${r}. Line ${e.line}`),null;if(0===n.size)return null;let a=new gE(new ArrayBuffer(n.size),n,0);if(n instanceof ps){if(e.args)for(let i=0;i<e.args.length;++i){let r=n.members[i],s=e.args[i],o=this.evalExpression(s,t);a.setData(this,o,r.type,r.offset,t)}}else if(n instanceof po){let r=0;if(e.args)for(let s=0;s<e.args.length;++s){let o=e.args[s],l=this.evalExpression(o,t);null===n.format&&("x32"===(null==(i=l.typeInfo)?void 0:i.name)?n.format=this.getTypeInfo("i32"):n.format=l.typeInfo),a.setData(this,l,n.format,r,t),r+=n.stride}}else console.error(`Unknown type "${r}". Line ${e.line}`);return e instanceof ge?a.getSubData(this,e.postfix,t):a}_evalLiteral(e,t){let i=this.getTypeInfo(e.type),r=i.name;return"x32"===r||"u32"===r||"f32"===r||"f16"===r||"i32"===r||"bool"===r?new g_(e.scalarValue,i):"vec2"===r||"vec3"===r||"vec4"===r||"vec2f"===r||"vec3f"===r||"vec4f"===r||"vec2h"===r||"vec3h"===r||"vec4h"===r||"vec2i"===r||"vec3i"===r||"vec4i"===r||"vec2u"===r||"vec3u"===r||"vec4u"===r?this._callConstructorVec(e,t):"mat2x2"===r||"mat2x3"===r||"mat2x4"===r||"mat3x2"===r||"mat3x3"===r||"mat3x4"===r||"mat4x2"===r||"mat4x3"===r||"mat4x4"===r||"mat2x2f"===r||"mat2x3f"===r||"mat2x4f"===r||"mat3x2f"===r||"mat3x3f"===r||"mat3x4f"===r||"mat4x2f"===r||"mat4x3f"===r||"mat4x4f"===r||"mat2x2h"===r||"mat2x3h"===r||"mat2x4h"===r||"mat3x2h"===r||"mat3x3h"===r||"mat3x4h"===r||"mat4x2h"===r||"mat4x3h"===r||"mat4x4h"===r?this._callConstructorMatrix(e,t):e.value}_evalVariable(e,t){let i=t.getVariableValue(e.name);return null===i?i:i.getSubData(this,e.postfix,t)}_maxFormatTypeInfo(e){let t=e[0];if("f32"===t.name)return t;for(let i=1;i<e.length;++i){let r=gJ._priority.get(t.name);gJ._priority.get(e[i].name)<r&&(t=e[i])}return"x32"===t.name?this.getTypeInfo("i32"):t}_evalUnaryOp(e,t){let i=this.evalExpression(e.right,t);if("&"===e.operator)return new gx(i);if("*"===e.operator)return i instanceof gx?i.reference.getSubData(this,e.postfix,t):(console.error(`Invalid dereference. Line ${e.line}`),null);let r=i instanceof g_?i.value:i instanceof gw?Array.from(i.data):null;switch(e.operator){case"+":if(gA(r))return new gw(r.map((e,t)=>+e),i.typeInfo);return new g_(+r,this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]));case"-":if(gA(r))return new gw(r.map((e,t)=>-e),i.typeInfo);return new g_(-r,this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]));case"!":if(gA(r))return new gw(r.map((e,t)=>+!e),i.typeInfo);return new g_(+!r,this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]));case"~":if(gA(r))return new gw(r.map((e,t)=>~e),i.typeInfo);return new g_(~r,this._maxFormatTypeInfo([i.typeInfo,i.typeInfo]))}return console.error(`Invalid unary operator ${e.operator}. Line ${e.line}`),null}_evalBinaryOp(e,t){let i=this.evalExpression(e.left,t),r=this.evalExpression(e.right,t),n=i instanceof g_?i.value:i instanceof gw||i instanceof gk?Array.from(i.data):null,a=r instanceof g_?r.value:r instanceof gw||r instanceof gk?Array.from(r.data):null;switch(e.operator){case"+":if(gA(n)&&gA(a)){if(n.length!==a.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;return new gw(n.map((e,t)=>e+a[t]),i.typeInfo)}if(gA(n))return new gw(n.map((e,t)=>e+a),i.typeInfo);if(gA(a))return new gw(a.map((e,t)=>n+e),r.typeInfo);return new g_(n+a,this._maxFormatTypeInfo([i.typeInfo,r.typeInfo]));case"-":if(gA(n)&&gA(a)){if(n.length!==a.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;return new gw(n.map((e,t)=>e-a[t]),i.typeInfo)}if(gA(n))return new gw(n.map((e,t)=>e-a),i.typeInfo);if(gA(a))return new gw(a.map((e,t)=>n-e),r.typeInfo);return new g_(n-a,this._maxFormatTypeInfo([i.typeInfo,r.typeInfo]));case"*":if(gA(n)&&gA(a)){if(i instanceof gk&&r instanceof gk){let t=function(e,t,i,r){if(void 0===gZ[t.name]||void 0===gZ[r.name])return null;let n=gZ[t.name][0],a=gZ[t.name][1],s=gZ[r.name][0];if(n!==gZ[r.name][1])return null;let o=Array(s*a);for(let t=0;t<a;t++)for(let r=0;r<s;r++){let l=0;for(let s=0;s<n;s++)l+=e[s*a+t]*i[r*n+s];o[t*s+r]=l}return o}(n,i.typeInfo,a,r.typeInfo);if(null===t)return console.error(`Matrix multiplication failed. Line ${e.line}.`),null;let s=gZ[r.typeInfo.name][0],o=gZ[i.typeInfo.name][1];return new gk(t,this.getTypeInfo(`mat${s}x${o}f`))}if(i instanceof gk&&r instanceof gw){let t=function(e,t,i,r){if(void 0===gZ[t.name]||void 0===gK[r.name])return null;let n=gZ[t.name][0],a=gZ[t.name][1];if(n!==i.length)return null;let s=Array(a);for(let t=0;t<a;t++){let r=0;for(let s=0;s<n;s++)r+=e[s*a+t]*i[s];s[t]=r}return s}(n,i.typeInfo,a,r.typeInfo);return null===t?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new gw(t,r.typeInfo)}if(i instanceof gw&&r instanceof gk){let t=function(e,t,i,r){if(void 0===gK[t.name]||void 0===gZ[r.name])return null;let n=gZ[r.name][0],a=gZ[r.name][1];if(a!==e.length)return null;let s=[];for(let t=0;t<n;t++){let r=0;for(let s=0;s<a;s++)r+=e[s]*i[s*n+t];s[t]=r}return s}(n,i.typeInfo,a,r.typeInfo);return null===t?(console.error(`Matrix vector multiplication failed. Line ${e.line}.`),null):new gw(t,i.typeInfo)}if(n.length!==a.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;return new gw(n.map((e,t)=>e*a[t]),i.typeInfo)}if(gA(n)){let e=n.map((e,t)=>e*a);return i instanceof gk?new gk(e,i.typeInfo):new gw(e,i.typeInfo)}if(gA(a)){let e=a.map((e,t)=>n*e);return r instanceof gk?new gk(e,r.typeInfo):new gw(e,r.typeInfo)}return new g_(n*a,this._maxFormatTypeInfo([i.typeInfo,r.typeInfo]));case"%":if(gA(n)&&gA(a)){if(n.length!==a.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;return new gw(n.map((e,t)=>e%a[t]),i.typeInfo)}if(gA(n))return new gw(n.map((e,t)=>e%a),i.typeInfo);if(gA(a))return new gw(a.map((e,t)=>n%e),r.typeInfo);return new g_(n%a,this._maxFormatTypeInfo([i.typeInfo,r.typeInfo]));case"/":if(gA(n)&&gA(a)){if(n.length!==a.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;return new gw(n.map((e,t)=>e/a[t]),i.typeInfo)}if(gA(n))return new gw(n.map((e,t)=>e/a),i.typeInfo);if(gA(a))return new gw(a.map((e,t)=>n/e),r.typeInfo);return new g_(n/a,this._maxFormatTypeInfo([i.typeInfo,r.typeInfo]));case"&":if(gA(n)&&gA(a)){if(n.length!==a.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;return new gw(n.map((e,t)=>e&a[t]),i.typeInfo)}if(gA(n))return new gw(n.map((e,t)=>e&a),i.typeInfo);if(gA(a))return new gw(a.map((e,t)=>n&e),r.typeInfo);return new g_(n&a,this._maxFormatTypeInfo([i.typeInfo,r.typeInfo]));case"|":if(gA(n)&&gA(a)){if(n.length!==a.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;return new gw(n.map((e,t)=>e|a[t]),i.typeInfo)}if(gA(n))return new gw(n.map((e,t)=>e|a),i.typeInfo);if(gA(a))return new gw(a.map((e,t)=>n|e),r.typeInfo);return new g_(n|a,this._maxFormatTypeInfo([i.typeInfo,r.typeInfo]));case"^":if(gA(n)&&gA(a)){if(n.length!==a.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;return new gw(n.map((e,t)=>e^a[t]),i.typeInfo)}if(gA(n))return new gw(n.map((e,t)=>e^a),i.typeInfo);if(gA(a))return new gw(a.map((e,t)=>n^e),r.typeInfo);return new g_(n^a,this._maxFormatTypeInfo([i.typeInfo,r.typeInfo]));case"<<":if(gA(n)&&gA(a)){if(n.length!==a.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;return new gw(n.map((e,t)=>e<<a[t]),i.typeInfo)}if(gA(n))return new gw(n.map((e,t)=>e<<a),i.typeInfo);if(gA(a))return new gw(a.map((e,t)=>n<<e),r.typeInfo);return new g_(n<<a,this._maxFormatTypeInfo([i.typeInfo,r.typeInfo]));case">>":if(gA(n)&&gA(a)){if(n.length!==a.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;return new gw(n.map((e,t)=>e>>a[t]),i.typeInfo)}if(gA(n))return new gw(n.map((e,t)=>e>>a),i.typeInfo);if(gA(a))return new gw(a.map((e,t)=>n>>e),r.typeInfo);return new g_(n>>a,this._maxFormatTypeInfo([i.typeInfo,r.typeInfo]));case">":if(gA(n)&&gA(a)){if(n.length!==a.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;return new gw(n.map((e,t)=>+(e>a[t])),i.typeInfo)}if(gA(n))return new gw(n.map((e,t)=>+(e>a)),i.typeInfo);if(gA(a))return new gw(a.map((e,t)=>+(n>e)),r.typeInfo);return new g_(+(n>a),this.getTypeInfo("bool"));case"<":if(gA(n)&&gA(a)){if(n.length!==a.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;return new gw(n.map((e,t)=>+(e<a[t])),i.typeInfo)}if(gA(n))return new gw(n.map((e,t)=>+(e<a)),i.typeInfo);if(gA(a))return new gw(a.map((e,t)=>+(n<e)),r.typeInfo);return new g_(+(n<a),this.getTypeInfo("bool"));case"==":if(gA(n)&&gA(a)){if(n.length!==a.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;return new gw(n.map((e,t)=>+(e===a[t])),i.typeInfo)}if(gA(n))return new gw(n.map((e,t)=>+(e==a)),i.typeInfo);if(gA(a))return new gw(a.map((e,t)=>+(n==e)),r.typeInfo);return new g_(+(n===a),this.getTypeInfo("bool"));case"!=":if(gA(n)&&gA(a)){if(n.length!==a.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;return new gw(n.map((e,t)=>+(e!==a[t])),i.typeInfo)}if(gA(n))return new gw(n.map((e,t)=>+(e!==a)),i.typeInfo);if(gA(a))return new gw(a.map((e,t)=>+(n!==e)),r.typeInfo);return new g_(+(n!==a),this.getTypeInfo("bool"));case">=":if(gA(n)&&gA(a)){if(n.length!==a.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;return new gw(n.map((e,t)=>+(e>=a[t])),i.typeInfo)}if(gA(n))return new gw(n.map((e,t)=>+(e>=a)),i.typeInfo);if(gA(a))return new gw(a.map((e,t)=>+(n>=e)),r.typeInfo);return new g_(+(n>=a),this.getTypeInfo("bool"));case"<=":if(gA(n)&&gA(a)){if(n.length!==a.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;return new gw(n.map((e,t)=>+(e<=a[t])),i.typeInfo)}if(gA(n))return new gw(n.map((e,t)=>+(e<=a)),i.typeInfo);if(gA(a))return new gw(a.map((e,t)=>+(n<=e)),r.typeInfo);return new g_(+(n<=a),this.getTypeInfo("bool"));case"&&":if(gA(n)&&gA(a)){if(n.length!==a.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;return new gw(n.map((e,t)=>e&&a[t]?1:0),i.typeInfo)}if(gA(n))return new gw(n.map((e,t)=>e&&a?1:0),i.typeInfo);if(gA(a))return new gw(a.map((e,t)=>n&&e?1:0),r.typeInfo);return new g_(n&&a?1:0,this.getTypeInfo("bool"));case"||":if(gA(n)&&gA(a)){if(n.length!==a.length)return console.error(`Vector length mismatch. Line ${e.line}.`),null;return new gw(n.map((e,t)=>e||a[t]?1:0),i.typeInfo)}if(gA(n))return new gw(n.map((e,t)=>e||a?1:0),i.typeInfo);if(gA(a))return new gw(a.map((e,t)=>n||e?1:0),r.typeInfo);return new g_(n||a?1:0,this.getTypeInfo("bool"))}return console.error(`Unknown operator ${e.operator}. Line ${e.line}`),null}_evalCall(e,t){if(null!==e.cachedReturnValue)return e.cachedReturnValue;let i=t.clone();i.currentFunctionName=e.name;let r=t.getFunction(e.name);if(!r)return e.isBuiltin?this._callBuiltinFunction(e,i):this.getTypeInfo(e.name)?this._evalCreate(e,t):(console.error(`Unknown function "${e.name}". Line ${e.line}`),null);for(let t=0;t<r.node.args.length;++t){let n=r.node.args[t],a=this.evalExpression(e.args[t],i);i.createVariable(n.name,a,n)}return this._execStatements(r.node.body,i)}_callBuiltinFunction(e,t){switch(e.name){case"all":return this.builtins.All(e,t);case"any":return this.builtins.Any(e,t);case"select":return this.builtins.Select(e,t);case"arrayLength":return this.builtins.ArrayLength(e,t);case"abs":return this.builtins.Abs(e,t);case"acos":return this.builtins.Acos(e,t);case"acosh":return this.builtins.Acosh(e,t);case"asin":return this.builtins.Asin(e,t);case"asinh":return this.builtins.Asinh(e,t);case"atan":return this.builtins.Atan(e,t);case"atanh":return this.builtins.Atanh(e,t);case"atan2":return this.builtins.Atan2(e,t);case"ceil":return this.builtins.Ceil(e,t);case"clamp":return this.builtins.Clamp(e,t);case"cos":return this.builtins.Cos(e,t);case"cosh":return this.builtins.Cosh(e,t);case"countLeadingZeros":return this.builtins.CountLeadingZeros(e,t);case"countOneBits":return this.builtins.CountOneBits(e,t);case"countTrailingZeros":return this.builtins.CountTrailingZeros(e,t);case"cross":return this.builtins.Cross(e,t);case"degrees":return this.builtins.Degrees(e,t);case"determinant":return this.builtins.Determinant(e,t);case"distance":return this.builtins.Distance(e,t);case"dot":return this.builtins.Dot(e,t);case"dot4U8Packed":return this.builtins.Dot4U8Packed(e,t);case"dot4I8Packed":return this.builtins.Dot4I8Packed(e,t);case"exp":return this.builtins.Exp(e,t);case"exp2":return this.builtins.Exp2(e,t);case"extractBits":return this.builtins.ExtractBits(e,t);case"faceForward":return this.builtins.FaceForward(e,t);case"firstLeadingBit":return this.builtins.FirstLeadingBit(e,t);case"firstTrailingBit":return this.builtins.FirstTrailingBit(e,t);case"floor":return this.builtins.Floor(e,t);case"fma":return this.builtins.Fma(e,t);case"fract":return this.builtins.Fract(e,t);case"frexp":return this.builtins.Frexp(e,t);case"insertBits":return this.builtins.InsertBits(e,t);case"inverseSqrt":return this.builtins.InverseSqrt(e,t);case"ldexp":return this.builtins.Ldexp(e,t);case"length":return this.builtins.Length(e,t);case"log":return this.builtins.Log(e,t);case"log2":return this.builtins.Log2(e,t);case"max":return this.builtins.Max(e,t);case"min":return this.builtins.Min(e,t);case"mix":return this.builtins.Mix(e,t);case"modf":return this.builtins.Modf(e,t);case"normalize":return this.builtins.Normalize(e,t);case"pow":return this.builtins.Pow(e,t);case"quantizeToF16":return this.builtins.QuantizeToF16(e,t);case"radians":return this.builtins.Radians(e,t);case"reflect":return this.builtins.Reflect(e,t);case"refract":return this.builtins.Refract(e,t);case"reverseBits":return this.builtins.ReverseBits(e,t);case"round":return this.builtins.Round(e,t);case"saturate":return this.builtins.Saturate(e,t);case"sign":return this.builtins.Sign(e,t);case"sin":return this.builtins.Sin(e,t);case"sinh":return this.builtins.Sinh(e,t);case"smoothstep":return this.builtins.SmoothStep(e,t);case"sqrt":return this.builtins.Sqrt(e,t);case"step":return this.builtins.Step(e,t);case"tan":return this.builtins.Tan(e,t);case"tanh":return this.builtins.Tanh(e,t);case"transpose":return this.builtins.Transpose(e,t);case"trunc":return this.builtins.Trunc(e,t);case"dpdx":return this.builtins.Dpdx(e,t);case"dpdxCoarse":return this.builtins.DpdxCoarse(e,t);case"dpdxFine":return this.builtins.DpdxFine(e,t);case"dpdy":return this.builtins.Dpdy(e,t);case"dpdyCoarse":return this.builtins.DpdyCoarse(e,t);case"dpdyFine":return this.builtins.DpdyFine(e,t);case"fwidth":return this.builtins.Fwidth(e,t);case"fwidthCoarse":return this.builtins.FwidthCoarse(e,t);case"fwidthFine":return this.builtins.FwidthFine(e,t);case"textureDimensions":return this.builtins.TextureDimensions(e,t);case"textureGather":return this.builtins.TextureGather(e,t);case"textureGatherCompare":return this.builtins.TextureGatherCompare(e,t);case"textureLoad":return this.builtins.TextureLoad(e,t);case"textureNumLayers":return this.builtins.TextureNumLayers(e,t);case"textureNumLevels":return this.builtins.TextureNumLevels(e,t);case"textureNumSamples":return this.builtins.TextureNumSamples(e,t);case"textureSample":return this.builtins.TextureSample(e,t);case"textureSampleBias":return this.builtins.TextureSampleBias(e,t);case"textureSampleCompare":return this.builtins.TextureSampleCompare(e,t);case"textureSampleCompareLevel":return this.builtins.TextureSampleCompareLevel(e,t);case"textureSampleGrad":return this.builtins.TextureSampleGrad(e,t);case"textureSampleLevel":return this.builtins.TextureSampleLevel(e,t);case"textureSampleBaseClampToEdge":return this.builtins.TextureSampleBaseClampToEdge(e,t);case"textureStore":return this.builtins.TextureStore(e,t);case"atomicLoad":return this.builtins.AtomicLoad(e,t);case"atomicStore":return this.builtins.AtomicStore(e,t);case"atomicAdd":return this.builtins.AtomicAdd(e,t);case"atomicSub":return this.builtins.AtomicSub(e,t);case"atomicMax":return this.builtins.AtomicMax(e,t);case"atomicMin":return this.builtins.AtomicMin(e,t);case"atomicAnd":return this.builtins.AtomicAnd(e,t);case"atomicOr":return this.builtins.AtomicOr(e,t);case"atomicXor":return this.builtins.AtomicXor(e,t);case"atomicExchange":return this.builtins.AtomicExchange(e,t);case"atomicCompareExchangeWeak":return this.builtins.AtomicCompareExchangeWeak(e,t);case"pack4x8snorm":return this.builtins.Pack4x8snorm(e,t);case"pack4x8unorm":return this.builtins.Pack4x8unorm(e,t);case"pack4xI8":return this.builtins.Pack4xI8(e,t);case"pack4xU8":return this.builtins.Pack4xU8(e,t);case"pack4x8Clamp":return this.builtins.Pack4x8Clamp(e,t);case"pack4xU8Clamp":return this.builtins.Pack4xU8Clamp(e,t);case"pack2x16snorm":return this.builtins.Pack2x16snorm(e,t);case"pack2x16unorm":return this.builtins.Pack2x16unorm(e,t);case"pack2x16float":return this.builtins.Pack2x16float(e,t);case"unpack4x8snorm":return this.builtins.Unpack4x8snorm(e,t);case"unpack4x8unorm":return this.builtins.Unpack4x8unorm(e,t);case"unpack4xI8":return this.builtins.Unpack4xI8(e,t);case"unpack4xU8":return this.builtins.Unpack4xU8(e,t);case"unpack2x16snorm":return this.builtins.Unpack2x16snorm(e,t);case"unpack2x16unorm":return this.builtins.Unpack2x16unorm(e,t);case"unpack2x16float":return this.builtins.Unpack2x16float(e,t);case"storageBarrier":return this.builtins.StorageBarrier(e,t);case"textureBarrier":return this.builtins.TextureBarrier(e,t);case"workgroupBarrier":return this.builtins.WorkgroupBarrier(e,t);case"workgroupUniformLoad":return this.builtins.WorkgroupUniformLoad(e,t);case"subgroupAdd":return this.builtins.SubgroupAdd(e,t);case"subgroupExclusiveAdd":return this.builtins.SubgroupExclusiveAdd(e,t);case"subgroupInclusiveAdd":return this.builtins.SubgroupInclusiveAdd(e,t);case"subgroupAll":return this.builtins.SubgroupAll(e,t);case"subgroupAnd":return this.builtins.SubgroupAnd(e,t);case"subgroupAny":return this.builtins.SubgroupAny(e,t);case"subgroupBallot":return this.builtins.SubgroupBallot(e,t);case"subgroupBroadcast":return this.builtins.SubgroupBroadcast(e,t);case"subgroupBroadcastFirst":return this.builtins.SubgroupBroadcastFirst(e,t);case"subgroupElect":return this.builtins.SubgroupElect(e,t);case"subgroupMax":return this.builtins.SubgroupMax(e,t);case"subgroupMin":return this.builtins.SubgroupMin(e,t);case"subgroupMul":return this.builtins.SubgroupMul(e,t);case"subgroupExclusiveMul":return this.builtins.SubgroupExclusiveMul(e,t);case"subgroupInclusiveMul":return this.builtins.SubgroupInclusiveMul(e,t);case"subgroupOr":return this.builtins.SubgroupOr(e,t);case"subgroupShuffle":return this.builtins.SubgroupShuffle(e,t);case"subgroupShuffleDown":return this.builtins.SubgroupShuffleDown(e,t);case"subgroupShuffleUp":return this.builtins.SubgroupShuffleUp(e,t);case"subgroupShuffleXor":return this.builtins.SubgroupShuffleXor(e,t);case"subgroupXor":return this.builtins.SubgroupXor(e,t);case"quadBroadcast":return this.builtins.QuadBroadcast(e,t);case"quadSwapDiagonal":return this.builtins.QuadSwapDiagonal(e,t);case"quadSwapX":return this.builtins.QuadSwapX(e,t);case"quadSwapY":return this.builtins.QuadSwapY(e,t)}let i=t.getFunction(e.name);if(i){let r=t.clone();for(let t=0;t<i.node.args.length;++t){let n=i.node.args[t],a=this.evalExpression(e.args[t],r);r.setVariable(n.name,a,n)}return this._execStatements(i.node.body,r)}return null}_callConstructorValue(e,t){if(!e.args||0===e.args.length)return new g_(0,this.getTypeInfo(e.type));let i=this.evalExpression(e.args[0],t);return i.typeInfo=this.getTypeInfo(e.type),i.getSubData(this,e.postfix,t).clone()}_callConstructorVec(e,t){let i=this.getTypeInfo(e.type),r=e.type.getTypeName(),n=gK[r];if(void 0===n)return console.error(`Invalid vec constructor ${r}. Line ${e.line}`),null;let a=[];if(e instanceof gn)if(e.isVector)for(let t of e.vectorValue)a.push(t);else a.push(e.scalarValue);else if(e.args)for(let i of e.args){let e=this.evalExpression(i,t);if(e instanceof gw){let t=e.data;for(let e=0;e<t.length;++e){let i=t[e];a.push(i)}}else if(e instanceof g_){let t=e.value;a.push(t)}}if(e.type instanceof p4&&null===e.type.format&&(e.type.format=p4.f32),0===a.length)return new gw(Array(n).fill(0),i).getSubData(this,e.postfix,t);if(1===a.length)for(;a.length<n;)a.push(a[0]);return a.length<n?(console.error(`Invalid vec constructor. Line ${e.line}`),null):new gw(a.length>n?a.slice(0,n):a,i).getSubData(this,e.postfix,t)}_callConstructorMatrix(e,t){let i=this.getTypeInfo(e.type),r=e.type.getTypeName(),n=gZ[r];if(void 0===n)return console.error(`Invalid matrix constructor ${r}. Line ${e.line}`),null;let a=[];if(e instanceof gn)if(e.isVector)for(let t of e.vectorValue)a.push(t);else a.push(e.scalarValue);else if(e.args)for(let i of e.args){let e=this.evalExpression(i,t);e instanceof gw?a.push(...e.data):e instanceof g_?a.push(e.value):e instanceof gk&&a.push(...e.data)}return(i instanceof pc&&null===i.format&&(i.format=this.getTypeInfo("f32")),0===a.length)?new gk(Array(n[2]).fill(0),i).getSubData(this,e.postfix,t):a.length!==n[2]?(console.error(`Invalid matrix constructor. Line ${e.line}`),null):new gk(a,i).getSubData(this,e.postfix,t)}}gJ._breakObj=new gy(new pn("BREAK",null),null),gJ._continueObj=new gy(new pn("CONTINUE",null),null),gJ._priority=new Map([["f32",0],["f16",1],["u32",2],["i32",3],["x32",3]]);class gQ{constructor(){this.constants=new Map,this.aliases=new Map,this.structs=new Map}}class g0{constructor(){this._tokens=[],this._current=0,this._currentLine=1,this._deferArrayCountEval=[],this._currentLoop=[],this._context=new gQ,this._exec=new gJ,this._forwardTypeCount=0}parse(e){this._initialize(e),this._deferArrayCountEval.length=0;let t=[];for(;!this._isAtEnd();){let e=this._global_decl_or_directive();if(!e)break;t.push(e)}if(this._deferArrayCountEval.length>0){for(let e of this._deferArrayCountEval){let t=e.arrayType,i=e.countNode;if(i instanceof gi){let e=i.name,r=this._context.constants.get(e);if(r)try{t.count=r.constEvaluate(this._exec)}catch(e){}}}this._deferArrayCountEval.length=0}if(this._forwardTypeCount>0)for(let e of t)e.search(e=>{e instanceof gm||e instanceof p5?e.type=this._forwardType(e.type):e instanceof p6?e.format=this._forwardType(e.format):e instanceof pj||e instanceof pF||e instanceof pz?e.type=this._forwardType(e.type):e instanceof pL?e.returnType=this._forwardType(e.returnType):e instanceof gp&&(e.type=this._forwardType(e.type))});return t}_forwardType(e){if(e instanceof p2){let t=this._getType(e.name);if(t)return t}else e instanceof p5?e.type=this._forwardType(e.type):e instanceof p6&&(e.format=this._forwardType(e.format));return e}_initialize(e){if(e)if("string"==typeof e){let t=new gC(e);this._tokens=t.scanTokens()}else this._tokens=e;else this._tokens=[];this._current=0}_updateNode(e,t){return e.line=null!=t?t:this._currentLine,e}_error(e,t){return{token:e,message:t,toString:()=>`${t}`}}_isAtEnd(){return this._current>=this._tokens.length||this._peek().type==gS.eof}_match(e){if(e instanceof gP)return!!this._check(e)&&(this._advance(),!0);for(let t=0,i=e.length;t<i;++t){let i=e[t];if(this._check(i))return this._advance(),!0}return!1}_consume(e,t){if(this._check(e))return this._advance();throw this._error(this._peek(),`${t}. Line:${this._currentLine}`)}_check(e){if(this._isAtEnd())return!1;let t=this._peek();if(e instanceof Array){let i=t.type,r=!1;for(let t of e){if(i===t)return!0;t===gS.tokens.name&&(r=!0)}if(r){let e=gS.tokens.name.rule.exec(t.lexeme);if(e&&0==e.index&&e[0]==t.lexeme)return!0}return!1}if(t.type===e)return!0;if(e===gS.tokens.name){let e=gS.tokens.name.rule.exec(t.lexeme);return e&&0==e.index&&e[0]==t.lexeme}return!1}_advance(){var e,t;return this._currentLine=null!=(t=null==(e=this._peek())?void 0:e.line)?t:-1,this._isAtEnd()||this._current++,this._previous()}_peek(){return this._tokens[this._current]}_previous(){return this._tokens[this._current-1]}_global_decl_or_directive(){for(;this._match(gS.tokens.semicolon)&&!this._isAtEnd(););if(this._match(gS.keywords.alias)){let e=this._type_alias();return this._consume(gS.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}if(this._match(gS.keywords.diagnostic)){let e=this._diagnostic();return this._consume(gS.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}if(this._match(gS.keywords.requires)){let e=this._requires_directive();return this._consume(gS.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}if(this._match(gS.keywords.enable)){let e=this._enable_directive();return this._consume(gS.tokens.semicolon,"Expected ';'"),this._exec.reflection.updateAST([e]),e}let e=this._attribute();if(this._check(gS.keywords.var)){let t=this._global_variable_decl();return null!=t&&(t.attributes=e),this._consume(gS.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(gS.keywords.override)){let t=this._override_variable_decl();return null!=t&&(t.attributes=e),this._consume(gS.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(gS.keywords.let)){let t=this._global_let_decl();return null!=t&&(t.attributes=e),this._consume(gS.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(gS.keywords.const)){let t=this._global_const_decl();return null!=t&&(t.attributes=e),this._consume(gS.tokens.semicolon,"Expected ';'."),this._exec.reflection.updateAST([t]),t}if(this._check(gS.keywords.struct)){let t=this._struct_decl();return null!=t&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}if(this._check(gS.keywords.fn)){let t=this._function_decl();return null!=t&&(t.attributes=e),this._exec.reflection.updateAST([t]),t}return null}_function_decl(){if(!this._match(gS.keywords.fn))return null;let e=this._currentLine,t=this._consume(gS.tokens.ident,"Expected function name.").toString();this._consume(gS.tokens.paren_left,"Expected '(' for function arguments.");let i=[];if(!this._check(gS.tokens.paren_right))do{if(this._check(gS.tokens.paren_right))break;let e=this._attribute(),t=this._consume(gS.tokens.name,"Expected argument name.").toString();this._consume(gS.tokens.colon,"Expected ':' for argument type.");let r=this._attribute(),n=this._type_decl();null!=n&&(n.attributes=r,i.push(this._updateNode(new gp(t,n,e))))}while(this._match(gS.tokens.comma))this._consume(gS.tokens.paren_right,"Expected ')' after function arguments.");let r=null;if(this._match(gS.tokens.arrow)){let e=this._attribute();null!=(r=this._type_decl())&&(r.attributes=e)}let n=this._compound_statement(),a=this._currentLine;return this._updateNode(new pL(t,i,r,n,e,a),e)}_compound_statement(){let e=[];for(this._consume(gS.tokens.brace_left,"Expected '{' for block.");!this._check(gS.tokens.brace_right);){let t=this._statement();null!==t&&e.push(t)}return this._consume(gS.tokens.brace_right,"Expected '}' for block."),e}_statement(){for(;this._match(gS.tokens.semicolon)&&!this._isAtEnd(););if(this._check(gS.tokens.attr)&&this._attribute(),this._check(gS.keywords.if))return this._if_statement();if(this._check(gS.keywords.switch))return this._switch_statement();if(this._check(gS.keywords.loop))return this._loop_statement();if(this._check(gS.keywords.for))return this._for_statement();if(this._check(gS.keywords.while))return this._while_statement();if(this._check(gS.keywords.continuing))return this._continuing_statement();if(this._check(gS.keywords.static_assert))return this._static_assert_statement();if(this._check(gS.tokens.brace_left))return this._compound_statement();let e=null;if(this._check(gS.keywords.return))e=this._return_statement();else if(this._check([gS.keywords.var,gS.keywords.let,gS.keywords.const]))e=this._variable_statement();else if(this._match(gS.keywords.discard))e=this._updateNode(new pJ);else if(this._match(gS.keywords.break)){let t=this._updateNode(new pQ);this._currentLoop.length>0&&(t.loopId=this._currentLoop[this._currentLoop.length-1].id),e=t,this._check(gS.keywords.if)&&(this._advance(),t.condition=this._optional_paren_expression())}else if(this._match(gS.keywords.continue)){let t=this._updateNode(new p0);if(!(this._currentLoop.length>0))throw this._error(this._peek(),`Continue statement must be inside a loop. Line: ${t.line}`);t.loopId=this._currentLoop[this._currentLoop.length-1].id,e=t}else e=this._increment_decrement_statement()||this._func_call_statement()||this._assignment_statement();return null!=e&&this._consume(gS.tokens.semicolon,"Expected ';' after statement."),e}_static_assert_statement(){if(!this._match(gS.keywords.static_assert))return null;let e=this._currentLine,t=this._optional_paren_expression();return this._updateNode(new pD(t),e)}_while_statement(){if(!this._match(gS.keywords.while))return null;let e=this._updateNode(new pO(null,null));return this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(gS.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_continuing_statement(){let e=this._currentLoop.length>0?this._currentLoop[this._currentLoop.length-1].id:-1;if(!this._match(gS.keywords.continuing))return null;let t=this._currentLine,i=this._compound_statement();return this._updateNode(new pR(i,e),t)}_for_statement(){if(!this._match(gS.keywords.for))return null;this._consume(gS.tokens.paren_left,"Expected '('.");let e=this._updateNode(new pN(null,null,null,null));return this._currentLoop.push(e),e.init=this._check(gS.tokens.semicolon)?null:this._for_init(),this._consume(gS.tokens.semicolon,"Expected ';'."),e.condition=this._check(gS.tokens.semicolon)?null:this._short_circuit_or_expression(),this._consume(gS.tokens.semicolon,"Expected ';'."),e.increment=this._check(gS.tokens.paren_right)?null:this._for_increment(),this._consume(gS.tokens.paren_right,"Expected ')'."),this._check(gS.tokens.attr)&&this._attribute(),e.body=this._compound_statement(),this._currentLoop.pop(),e}_for_init(){return this._variable_statement()||this._func_call_statement()||this._assignment_statement()}_for_increment(){return this._func_call_statement()||this._increment_decrement_statement()||this._assignment_statement()}_variable_statement(){if(this._check(gS.keywords.var)){let e=this._variable_decl();if(null===e)throw this._error(this._peek(),"Variable declaration expected.");let t=null;return this._match(gS.tokens.equal)&&(t=this._short_circuit_or_expression()),this._updateNode(new pj(e.name,e.type,e.storage,e.access,t),e.line)}if(this._match(gS.keywords.let)){let e=this._currentLine,t=this._consume(gS.tokens.name,"Expected name for let.").toString(),i=null;if(this._match(gS.tokens.colon)){let e=this._attribute();null!=(i=this._type_decl())&&(i.attributes=e)}this._consume(gS.tokens.equal,"Expected '=' for let.");let r=this._short_circuit_or_expression();return this._updateNode(new pF(t,i,null,null,r),e)}if(this._match(gS.keywords.const)){let e=this._currentLine,t=this._consume(gS.tokens.name,"Expected name for const.").toString(),i=null;if(this._match(gS.tokens.colon)){let e=this._attribute();null!=(i=this._type_decl())&&(i.attributes=e)}this._consume(gS.tokens.equal,"Expected '=' for const.");let r=this._short_circuit_or_expression();return null===i&&r instanceof gn&&(i=r.type),this._updateNode(new pz(t,i,null,null,r),e)}return null}_increment_decrement_statement(){let e=this._current,t=this._unary_expression();if(null==t)return null;if(!this._check(gS.increment_operators))return this._current=e,null;let i=this._consume(gS.increment_operators,"Expected increment operator");return this._updateNode(new pV(i.type===gS.tokens.plus_plus?Ep.increment:Ep.decrement,t))}_assignment_statement(){let e=null,t=this._currentLine;if(this._check(gS.tokens.brace_right))return null;let i=this._match(gS.tokens.underscore);if(i||(e=this._unary_expression()),!i&&null==e)return null;let r=this._consume(gS.assignment_operators,"Expected assignment operator."),n=this._short_circuit_or_expression();return this._updateNode(new pU(Eg.parse(r.lexeme),e,n),t)}_func_call_statement(){if(!this._check(gS.tokens.ident))return null;let e=this._currentLine,t=this._current,i=this._consume(gS.tokens.ident,"Expected function name."),r=this._argument_expression_list();return null===r?(this._current=t,null):this._updateNode(new p$(i.lexeme,r),e)}_loop_statement(){if(!this._match(gS.keywords.loop))return null;this._check(gS.tokens.attr)&&this._attribute(),this._consume(gS.tokens.brace_left,"Expected '{' for loop.");let e=this._updateNode(new pW([],null));this._currentLoop.push(e);let t=this._statement();for(;null!==t;){if(Array.isArray(t))for(let i of t)e.body.push(i);else e.body.push(t);if(t instanceof pR){e.continuing=t;break}t=this._statement()}return this._currentLoop.pop(),this._consume(gS.tokens.brace_right,"Expected '}' for loop."),e}_switch_statement(){if(!this._match(gS.keywords.switch))return null;let e=this._updateNode(new pH(null,[]));if(this._currentLoop.push(e),e.condition=this._optional_paren_expression(),this._check(gS.tokens.attr)&&this._attribute(),this._consume(gS.tokens.brace_left,"Expected '{' for switch."),e.cases=this._switch_body(),null==e.cases||0==e.cases.length)throw this._error(this._previous(),"Expected 'case' or 'default'.");return this._consume(gS.tokens.brace_right,"Expected '}' for switch."),this._currentLoop.pop(),e}_switch_body(){let e=[],t=!1;for(;this._check([gS.keywords.default,gS.keywords.case]);){if(this._match(gS.keywords.case)){let i=this._case_selectors();for(let e of i)if(e instanceof gh){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");t=!0;break}this._match(gS.tokens.colon),this._check(gS.tokens.attr)&&this._attribute(),this._consume(gS.tokens.brace_left,"Exected '{' for switch case.");let r=this._case_body();this._consume(gS.tokens.brace_right,"Exected '}' for switch case."),e.push(this._updateNode(new gd(i,r)))}if(this._match(gS.keywords.default)){if(t)throw this._error(this._previous(),"Multiple default cases in switch statement.");this._match(gS.tokens.colon),this._check(gS.tokens.attr)&&this._attribute(),this._consume(gS.tokens.brace_left,"Exected '{' for switch default.");let i=this._case_body();this._consume(gS.tokens.brace_right,"Exected '}' for switch default."),e.push(this._updateNode(new gf(i)))}}return e}_case_selectors(){let e=[];for(this._match(gS.keywords.default)?e.push(this._updateNode(new gh)):e.push(this._shift_expression());this._match(gS.tokens.comma);)this._match(gS.keywords.default)?e.push(this._updateNode(new gh)):e.push(this._shift_expression());return e}_case_body(){if(this._match(gS.keywords.fallthrough))return this._consume(gS.tokens.semicolon,"Expected ';'"),[];let e=this._statement();if(null==e)return[];e instanceof Array||(e=[e]);let t=this._case_body();return 0==t.length?e:[...e,t[0]]}_if_statement(){if(!this._match(gS.keywords.if))return null;let e=this._currentLine,t=this._optional_paren_expression();this._check(gS.tokens.attr)&&this._attribute();let i=this._compound_statement(),r=[];this._match_elseif()&&(this._check(gS.tokens.attr)&&this._attribute(),r=this._elseif_statement(r));let n=null;return this._match(gS.keywords.else)&&(this._check(gS.tokens.attr)&&this._attribute(),n=this._compound_statement()),this._updateNode(new pq(t,i,r,n),e)}_match_elseif(){return this._tokens[this._current].type===gS.keywords.else&&this._tokens[this._current+1].type===gS.keywords.if&&(this._advance(),this._advance(),!0)}_elseif_statement(e=[]){let t=this._optional_paren_expression(),i=this._compound_statement();return e.push(this._updateNode(new gg(t,i))),this._match_elseif()&&(this._check(gS.tokens.attr)&&this._attribute(),this._elseif_statement(e)),e}_return_statement(){if(!this._match(gS.keywords.return))return null;let e=this._short_circuit_or_expression();return this._updateNode(new pG(e))}_short_circuit_or_expression(){let e=this._short_circuit_and_expr();for(;this._match(gS.tokens.or_or);)e=this._updateNode(new gc(this._previous().toString(),e,this._short_circuit_and_expr()));return e}_short_circuit_and_expr(){let e=this._inclusive_or_expression();for(;this._match(gS.tokens.and_and);)e=this._updateNode(new gc(this._previous().toString(),e,this._inclusive_or_expression()));return e}_inclusive_or_expression(){let e=this._exclusive_or_expression();for(;this._match(gS.tokens.or);)e=this._updateNode(new gc(this._previous().toString(),e,this._exclusive_or_expression()));return e}_exclusive_or_expression(){let e=this._and_expression();for(;this._match(gS.tokens.xor);)e=this._updateNode(new gc(this._previous().toString(),e,this._and_expression()));return e}_and_expression(){let e=this._equality_expression();for(;this._match(gS.tokens.and);)e=this._updateNode(new gc(this._previous().toString(),e,this._equality_expression()));return e}_equality_expression(){let e=this._relational_expression();return this._match([gS.tokens.equal_equal,gS.tokens.not_equal])?this._updateNode(new gc(this._previous().toString(),e,this._relational_expression())):e}_relational_expression(){let e=this._shift_expression();for(;this._match([gS.tokens.less_than,gS.tokens.greater_than,gS.tokens.less_than_equal,gS.tokens.greater_than_equal]);)e=this._updateNode(new gc(this._previous().toString(),e,this._shift_expression()));return e}_shift_expression(){let e=this._additive_expression();for(;this._match([gS.tokens.shift_left,gS.tokens.shift_right]);)e=this._updateNode(new gc(this._previous().toString(),e,this._additive_expression()));return e}_additive_expression(){let e=this._multiplicative_expression();for(;this._match([gS.tokens.plus,gS.tokens.minus]);)e=this._updateNode(new gc(this._previous().toString(),e,this._multiplicative_expression()));return e}_multiplicative_expression(){let e=this._unary_expression();for(;this._match([gS.tokens.star,gS.tokens.forward_slash,gS.tokens.modulo]);)e=this._updateNode(new gc(this._previous().toString(),e,this._unary_expression()));return e}_unary_expression(){return this._match([gS.tokens.minus,gS.tokens.bang,gS.tokens.tilde,gS.tokens.star,gS.tokens.and])?this._updateNode(new gl(this._previous().toString(),this._unary_expression())):this._singular_expression()}_singular_expression(){let e=this._primary_expression(),t=this._postfix_expression();return t&&(e.postfix=t),e}_postfix_expression(){if(this._match(gS.tokens.bracket_left)){let e=this._short_circuit_or_expression();this._consume(gS.tokens.bracket_right,"Expected ']'.");let t=this._updateNode(new gs(e)),i=this._postfix_expression();return i&&(t.postfix=i),t}if(this._match(gS.tokens.period)){let e=this._consume(gS.tokens.name,"Expected member name."),t=this._postfix_expression(),i=this._updateNode(new p7(e.lexeme));return t&&(i.postfix=t),i}return null}_getStruct(e){return this._context.aliases.has(e)?this._context.aliases.get(e).type:this._context.structs.has(e)?this._context.structs.get(e):null}_getType(e){let t=this._getStruct(e);if(null!==t)return t;switch(e){case"void":return p1.void;case"bool":return p1.bool;case"i32":return p1.i32;case"u32":return p1.u32;case"f32":return p1.f32;case"f16":return p1.f16;case"vec2f":return p4.vec2f;case"vec3f":return p4.vec3f;case"vec4f":return p4.vec4f;case"vec2i":return p4.vec2i;case"vec3i":return p4.vec3i;case"vec4i":return p4.vec4i;case"vec2u":return p4.vec2u;case"vec3u":return p4.vec3u;case"vec4u":return p4.vec4u;case"vec2h":return p4.vec2h;case"vec3h":return p4.vec3h;case"vec4h":return p4.vec4h;case"mat2x2f":return p4.mat2x2f;case"mat2x3f":return p4.mat2x3f;case"mat2x4f":return p4.mat2x4f;case"mat3x2f":return p4.mat3x2f;case"mat3x3f":return p4.mat3x3f;case"mat3x4f":return p4.mat3x4f;case"mat4x2f":return p4.mat4x2f;case"mat4x3f":return p4.mat4x3f;case"mat4x4f":return p4.mat4x4f;case"mat2x2h":return p4.mat2x2h;case"mat2x3h":return p4.mat2x3h;case"mat2x4h":return p4.mat2x4h;case"mat3x2h":return p4.mat3x2h;case"mat3x3h":return p4.mat3x3h;case"mat3x4h":return p4.mat3x4h;case"mat4x2h":return p4.mat4x2h;case"mat4x3h":return p4.mat4x3h;case"mat4x4h":return p4.mat4x4h;case"mat2x2i":return p4.mat2x2i;case"mat2x3i":return p4.mat2x3i;case"mat2x4i":return p4.mat2x4i;case"mat3x2i":return p4.mat3x2i;case"mat3x3i":return p4.mat3x3i;case"mat3x4i":return p4.mat3x4i;case"mat4x2i":return p4.mat4x2i;case"mat4x3i":return p4.mat4x3i;case"mat4x4i":return p4.mat4x4i;case"mat2x2u":return p4.mat2x2u;case"mat2x3u":return p4.mat2x3u;case"mat2x4u":return p4.mat2x4u;case"mat3x2u":return p4.mat3x2u;case"mat3x3u":return p4.mat3x3u;case"mat3x4u":return p4.mat3x4u;case"mat4x2u":return p4.mat4x2u;case"mat4x3u":return p4.mat4x3u;case"mat4x4u":return p4.mat4x4u}return null}_validateTypeRange(e,t){if("i32"===t.name){if(e<-0x80000000||e>0x7fffffff)throw this._error(this._previous(),`Value out of range for i32: ${e}. Line: ${this._currentLine}.`)}else if("u32"===t.name&&(e<0||e>0xffffffff))throw this._error(this._previous(),`Value out of range for u32: ${e}. Line: ${this._currentLine}.`)}_primary_expression(){if(this._match(gS.tokens.ident)){let e=this._previous().toString();if(this._check(gS.tokens.paren_left)){let t=this._argument_expression_list(),i=this._getType(e);return null!==i?this._updateNode(new ge(i,t)):this._updateNode(new gt(e,t))}if(this._context.constants.has(e)){let t=this._context.constants.get(e);return this._updateNode(new gr(e,t.value))}return this._updateNode(new gi(e))}if(this._match(gS.tokens.int_literal)){let e=this._previous().toString(),t=e.endsWith("i")||e.endsWith("i")?p1.i32:e.endsWith("u")||e.endsWith("U")?p1.u32:p1.x32,i=parseInt(e);return this._validateTypeRange(i,t),this._updateNode(new gn(new g_(i,this._exec.getTypeInfo(t)),t))}if(this._match(gS.tokens.uint_literal)){let e=parseInt(this._previous().toString());return this._validateTypeRange(e,p1.u32),this._updateNode(new gn(new g_(e,this._exec.getTypeInfo(p1.u32)),p1.u32))}if(this._match([gS.tokens.decimal_float_literal,gS.tokens.hex_float_literal])){let e=this._previous().toString(),t=e.endsWith("h");t&&(e=e.substring(0,e.length-1));let i=parseFloat(e);this._validateTypeRange(i,t?p1.f16:p1.f32);let r=t?p1.f16:p1.f32;return this._updateNode(new gn(new g_(i,this._exec.getTypeInfo(r)),r))}if(this._match([gS.keywords.true,gS.keywords.false])){let e=this._previous().toString()===gS.keywords.true.rule;return this._updateNode(new gn(new g_(+!!e,this._exec.getTypeInfo(p1.bool)),p1.bool))}if(this._check(gS.tokens.paren_left))return this._paren_expression();if(this._match(gS.keywords.bitcast)){this._consume(gS.tokens.less_than,"Expected '<'.");let e=this._type_decl();this._consume(gS.tokens.greater_than,"Expected '>'.");let t=this._paren_expression();return this._updateNode(new ga(e,t))}let e=this._type_decl(),t=this._argument_expression_list();return this._updateNode(new ge(e,t))}_argument_expression_list(){if(!this._match(gS.tokens.paren_left))return null;let e=[];do{if(this._check(gS.tokens.paren_right))break;let t=this._short_circuit_or_expression();e.push(t)}while(this._match(gS.tokens.comma))return this._consume(gS.tokens.paren_right,"Expected ')' for agument list"),e}_optional_paren_expression(){this._match(gS.tokens.paren_left);let e=this._short_circuit_or_expression();return this._match(gS.tokens.paren_right),e}_paren_expression(){this._consume(gS.tokens.paren_left,"Expected '('.");let e=this._short_circuit_or_expression();return this._consume(gS.tokens.paren_right,"Expected ')'."),e}_struct_decl(){if(!this._match(gS.keywords.struct))return null;let e=this._currentLine,t=this._consume(gS.tokens.ident,"Expected name for struct.").toString();this._consume(gS.tokens.brace_left,"Expected '{' for struct body.");let i=[];for(;!this._check(gS.tokens.brace_right);){let e=this._attribute(),t=this._consume(gS.tokens.name,"Expected variable name.").toString();this._consume(gS.tokens.colon,"Expected ':' for struct member type.");let r=this._attribute(),n=this._type_decl();null!=n&&(n.attributes=r),this._check(gS.tokens.brace_right)?this._match(gS.tokens.comma):this._consume(gS.tokens.comma,"Expected ',' for struct member."),i.push(this._updateNode(new gm(t,n,e)))}this._consume(gS.tokens.brace_right,"Expected '}' after struct body.");let r=this._currentLine,n=this._updateNode(new p3(t,i,e,r),e);return this._context.structs.set(t,n),n}_global_variable_decl(){let e=this._variable_decl();if(!e)return null;if(this._match(gS.tokens.equal)&&(e.value=this._const_expression()),null!==e.type&&e.value instanceof gn){if("x32"!==e.value.type.name&&e.type.getTypeName()!==e.value.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${e.value.type.name} to ${e.type.name}. Line:${this._currentLine}`);e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type),e.value.type=e.type}else null===e.type&&e.value instanceof gn&&(e.type="x32"===e.value.type.name?p1.i32:e.value.type,e.value.isScalar&&this._validateTypeRange(e.value.scalarValue,e.type));return e}_override_variable_decl(){let e=this._override_decl();return e&&this._match(gS.tokens.equal)&&(e.value=this._const_expression()),e}_global_const_decl(){var e;if(!this._match(gS.keywords.const))return null;let t=this._consume(gS.tokens.name,"Expected variable name"),i=this._currentLine,r=null;if(this._match(gS.tokens.colon)){let e=this._attribute();null!=(r=this._type_decl())&&(r.attributes=e)}let n=null;this._consume(gS.tokens.equal,"const declarations require an assignment");let a=this._short_circuit_or_expression();try{let e=[p1.f32],i=a.constEvaluate(this._exec,e);i instanceof g_&&this._validateTypeRange(i.value,e[0]),e[0]instanceof p4&&null===e[0].format&&i.typeInfo instanceof pc&&null!==i.typeInfo.format&&("f16"===i.typeInfo.format.name?e[0].format=p1.f16:"f32"===i.typeInfo.format.name?e[0].format=p1.f32:"i32"===i.typeInfo.format.name?e[0].format=p1.i32:"u32"===i.typeInfo.format.name?e[0].format=p1.u32:"bool"===i.typeInfo.format.name?e[0].format=p1.bool:console.error(`TODO: impelement template format type ${i.typeInfo.format.name}`)),n=this._updateNode(new gn(i,e[0])),this._exec.context.setVariable(t.toString(),i)}catch(e){n=a}if(null!==r&&n instanceof gn){if("x32"!==n.type.name&&r.getTypeName()!==n.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${n.type.name} to ${r.name}. Line:${this._currentLine}`);n.type=r,n.isScalar&&this._validateTypeRange(n.scalarValue,n.type)}else null===r&&n instanceof gn&&(r=null!=(e=null==n?void 0:n.type)?e:p1.f32)===p1.x32&&(r=p1.i32);let s=this._updateNode(new pz(t.toString(),r,"","",n),i);return this._context.constants.set(s.name,s),s}_global_let_decl(){if(!this._match(gS.keywords.let))return null;let e=this._currentLine,t=this._consume(gS.tokens.name,"Expected variable name"),i=null;if(this._match(gS.tokens.colon)){let e=this._attribute();null!=(i=this._type_decl())&&(i.attributes=e)}let r=null;if(this._match(gS.tokens.equal)&&(r=this._const_expression()),null!==i&&r instanceof gn){if("x32"!==r.type.name&&i.getTypeName()!==r.type.getTypeName())throw this._error(this._peek(),`Invalid cast from ${r.type.name} to ${i.name}. Line:${this._currentLine}`);r.type=i}else null===i&&r instanceof gn&&(i="x32"===r.type.name?p1.i32:r.type);return r instanceof gn&&r.isScalar&&this._validateTypeRange(r.scalarValue,i),this._updateNode(new pF(t.toString(),i,"","",r),e)}_const_expression(){return this._short_circuit_or_expression()}_variable_decl(){if(!this._match(gS.keywords.var))return null;let e=this._currentLine,t="",i="";this._match(gS.tokens.less_than)&&(t=this._consume(gS.storage_class,"Expected storage_class.").toString(),this._match(gS.tokens.comma)&&(i=this._consume(gS.access_mode,"Expected access_mode.").toString()),this._consume(gS.tokens.greater_than,"Expected '>'."));let r=this._consume(gS.tokens.name,"Expected variable name"),n=null;if(this._match(gS.tokens.colon)){let e=this._attribute();null!=(n=this._type_decl())&&(n.attributes=e)}return this._updateNode(new pj(r.toString(),n,t,i,null),e)}_override_decl(){if(!this._match(gS.keywords.override))return null;let e=this._consume(gS.tokens.name,"Expected variable name"),t=null;if(this._match(gS.tokens.colon)){let e=this._attribute();null!=(t=this._type_decl())&&(t.attributes=e)}return this._updateNode(new pB(e.toString(),t,null))}_diagnostic(){this._consume(gS.tokens.paren_left,"Expected '('");let e=this._consume(gS.tokens.ident,"Expected severity control name.");this._consume(gS.tokens.comma,"Expected ','");let t=this._consume(gS.tokens.ident,"Expected diagnostic rule name.").toString();return this._match(gS.tokens.period)&&(t+=`.${this._consume(gS.tokens.ident,"Expected diagnostic message.").toString()}`),this._consume(gS.tokens.paren_right,"Expected ')'"),this._updateNode(new pK(e.toString(),t))}_enable_directive(){let e=this._consume(gS.tokens.ident,"identity expected.");return this._updateNode(new pY(e.toString()))}_requires_directive(){let e=[this._consume(gS.tokens.ident,"identity expected.").toString()];for(;this._match(gS.tokens.comma);){let t=this._consume(gS.tokens.ident,"identity expected.");e.push(t.toString())}return this._updateNode(new pX(e))}_type_alias(){let e=this._consume(gS.tokens.ident,"identity expected.");this._consume(gS.tokens.equal,"Expected '=' for type alias.");let t=this._type_decl();if(null===t)throw this._error(this._peek(),"Expected Type for Alias.");this._context.aliases.has(t.name)&&(t=this._context.aliases.get(t.name).type);let i=this._updateNode(new pZ(e.toString(),t));return this._context.aliases.set(i.name,i),i}_type_decl(){if(this._check([gS.tokens.ident,...gS.texel_format,gS.keywords.bool,gS.keywords.f32,gS.keywords.i32,gS.keywords.u32])){let e=this._advance().toString();if(this._context.structs.has(e))return this._context.structs.get(e);if(this._context.aliases.has(e))return this._context.aliases.get(e).type;if(!this._getType(e)){let t=this._updateNode(new p2(e));return this._forwardTypeCount++,t}return this._updateNode(new p1(e))}let e=this._texture_sampler_types();if(e)return e;if(this._check(gS.template_types)){let e=this._advance().toString(),t=null,i=null;return this._match(gS.tokens.less_than)&&(t=this._type_decl(),i=null,this._match(gS.tokens.comma)&&(i=this._consume(gS.access_mode,"Expected access_mode for pointer").toString()),this._consume(gS.tokens.greater_than,"Expected '>' for type.")),this._updateNode(new p4(e,t,i))}if(this._match(gS.keywords.ptr)){let e=this._previous().toString();this._consume(gS.tokens.less_than,"Expected '<' for pointer.");let t=this._consume(gS.storage_class,"Expected storage_class for pointer");this._consume(gS.tokens.comma,"Expected ',' for pointer.");let i=this._type_decl(),r=null;return this._match(gS.tokens.comma)&&(r=this._consume(gS.access_mode,"Expected access_mode for pointer").toString()),this._consume(gS.tokens.greater_than,"Expected '>' for pointer."),this._updateNode(new p5(e,t.toString(),i,r))}let t=this._attribute();if(this._match(gS.keywords.array)){let e=null,i=-1,r=this._previous(),n=null;if(this._match(gS.tokens.less_than)){e=this._type_decl(),this._context.aliases.has(e.name)&&(e=this._context.aliases.get(e.name).type);let t="";if(this._match(gS.tokens.comma)){n=this._shift_expression();try{t=n.constEvaluate(this._exec).toString(),n=null}catch(e){t="1"}}this._consume(gS.tokens.greater_than,"Expected '>' for array."),i=t?parseInt(t):0}let a=this._updateNode(new p6(r.toString(),t,e,i));return n&&this._deferArrayCountEval.push({arrayType:a,countNode:n}),a}return null}_texture_sampler_types(){if(this._match(gS.sampler_type)||this._match(gS.depth_texture_type))return this._updateNode(new p8(this._previous().toString(),null,null));if(this._match(gS.sampled_texture_type)||this._match(gS.multisampled_texture_type)){let e=this._previous();this._consume(gS.tokens.less_than,"Expected '<' for sampler type.");let t=this._type_decl();return this._consume(gS.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new p8(e.toString(),t,null))}if(this._match(gS.storage_texture_type)){let e=this._previous();this._consume(gS.tokens.less_than,"Expected '<' for sampler type.");let t=this._consume(gS.texel_format,"Invalid texel format.").toString();this._consume(gS.tokens.comma,"Expected ',' after texel format.");let i=this._consume(gS.access_mode,"Expected access mode for storage texture type.").toString();return this._consume(gS.tokens.greater_than,"Expected '>' for sampler type."),this._updateNode(new p8(e.toString(),t,i))}return null}_attribute(){let e=[];for(;this._match(gS.tokens.attr);){let t=this._consume(gS.attribute_name,"Expected attribute name"),i=this._updateNode(new gv(t.toString(),null));if(this._match(gS.tokens.paren_left)){if(i.value=this._consume(gS.literal_or_ident,"Expected attribute value").toString(),this._check(gS.tokens.comma)){this._advance();do{let e=this._consume(gS.literal_or_ident,"Expected attribute value").toString();i.value instanceof Array||(i.value=[i.value]),i.value.push(e)}while(this._match(gS.tokens.comma))}this._consume(gS.tokens.paren_right,"Expected ')'")}e.push(i)}return 0==e.length?null:e}}class g1 extends g${constructor(e){super(),e&&this.update(e)}update(e){let t=(new g0).parse(e);this.updateAST(t)}}function g2(e){return e?.format?`${e.name}<${e.format.name}>`:e.name}var g3=e.i(92964);let g4={};function g5(e="id"){g4[e]=g4[e]||1;let t=g4[e]++;return`${e}-${t}`}class g6{id;userData={};topology;bufferLayout=[];vertexCount;indices;attributes;constructor(e){if(this.id=e.id||g5("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&fF.Buffer.INDEX))throw Error("Index buffer must have INDEX usage")}destroy(){for(let e of(this.indices?.destroy(),Object.values(this.attributes)))e.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}var g8=e.i(64220);class g9 extends g8.Resource{get[Symbol.toStringTag](){return"ComputePipeline"}hash="";shaderLayout;constructor(e,t){super(e,t,g9.defaultProps),this.shaderLayout=t.shaderLayout}static defaultProps={...g8.Resource.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0}}class g7{static defaultProps={...f6.RenderPipeline.defaultProps};static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new g7(e),e._lumaData.defaultPipelineFactory}device;cachingEnabled;destroyPolicy;debug;_hashCounter=0;_hashes={};_renderPipelineCache={};_computePipelineCache={};get[Symbol.toStringTag](){return"PipelineFactory"}toString(){return`PipelineFactory(${this.device.id})`}constructor(e){this.device=e,this.cachingEnabled=e.props._cachePipelines,this.destroyPolicy=e.props._cacheDestroyPolicy,this.debug=e.props.debugFactories}createRenderPipeline(e){if(!this.cachingEnabled)return this.device.createRenderPipeline(e);let t={...f6.RenderPipeline.defaultProps,...e},i=this._renderPipelineCache,r=this._hashRenderPipeline(t),n=i[r]?.pipeline;return n?(i[r].useCount++,this.debug&&aS.log.warn(`${this}: ${i[r].pipeline} reused, count=${i[r].useCount}, (id=${e.id})`)()):((n=this.device.createRenderPipeline({...t,id:t.id?`${t.id}-cached`:g5("unnamed-cached")})).hash=r,i[r]={pipeline:n,useCount:1},this.debug&&aS.log.warn(`${this}: ${n} created, count=${i[r].useCount}`)()),n}createComputePipeline(e){if(!this.cachingEnabled)return this.device.createComputePipeline(e);let t={...g9.defaultProps,...e},i=this._computePipelineCache,r=this._hashComputePipeline(t),n=i[r]?.pipeline;return n?(i[r].useCount++,this.debug&&aS.log.warn(`${this}: ${i[r].pipeline} reused, count=${i[r].useCount}, (id=${e.id})`)()):((n=this.device.createComputePipeline({...t,id:t.id?`${t.id}-cached`:void 0})).hash=r,i[r]={pipeline:n,useCount:1},this.debug&&aS.log.warn(`${this}: ${n} created, count=${i[r].useCount}`)()),n}release(e){if(!this.cachingEnabled)return void e.destroy();let t=this._getCache(e),i=e.hash;t[i].useCount--,0===t[i].useCount?(this._destroyPipeline(e),this.debug&&aS.log.warn(`${this}: ${e} released and destroyed`)()):t[i].useCount<0?(aS.log.error(`${this}: ${e} released, useCount < 0, resetting`)(),t[i].useCount=0):this.debug&&aS.log.warn(`${this}: ${e} released, count=${t[i].useCount}`)()}_destroyPipeline(e){let t=this._getCache(e);switch(this.destroyPolicy){case"never":return!1;case"unused":return delete t[e.hash],e.destroy(),!0}}_getCache(e){let t;if(e instanceof g9&&(t=this._computePipelineCache),e instanceof f6.RenderPipeline&&(t=this._renderPipelineCache),!t)throw Error(`${this}`);if(!t[e.hash])throw Error(`${this}: ${e} matched incorrect entry`);return t}_hashComputePipeline(e){let{type:t}=this.device,i=this._getHash(e.shader.source);return`${t}/C/${i}`}_hashRenderPipeline(e){let t=e.vs?this._getHash(e.vs.source):0,i=e.fs?this._getHash(e.fs.source):0,r=this._getHash(JSON.stringify(e.bufferLayout)),{type:n}=this.device;if("webgl"===n)return`${n}/R/${t}/${i}V-BL${r}`;{let a=this._getHash(JSON.stringify(e.parameters));return`${n}/R/${t}/${i}V-T${e.topology}P${a}BL${r}`}}_getHash(e){return void 0===this._hashes[e]&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}}var me=e.i(92268);class mt{static defaultProps={...me.Shader.defaultProps};static getDefaultShaderFactory(e){return e._lumaData.defaultShaderFactory||=new mt(e),e._lumaData.defaultShaderFactory}device;cachingEnabled;destroyPolicy;debug;_cache={};get[Symbol.toStringTag](){return"ShaderFactory"}toString(){return`${this[Symbol.toStringTag]}(${this.device.id})`}constructor(e){this.device=e,this.cachingEnabled=e.props._cacheShaders,this.destroyPolicy=e.props._cacheDestroyPolicy,this.debug=!0}createShader(e){if(!this.cachingEnabled)return this.device.createShader(e);let t=this._hashShader(e),i=this._cache[t];if(i)i.useCount++,this.debug&&aS.log.warn(`${this}: Reusing shader ${i.shader.id} count=${i.useCount}`)();else{let r=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[t]=i={shader:r,useCount:1},this.debug&&aS.log.warn(`${this}: Created new shader ${r.id}`)()}return i.shader}release(e){if(!this.cachingEnabled)return void e.destroy();let t=this._hashShader(e),i=this._cache[t];if(i)if(i.useCount--,0===i.useCount)"unused"===this.destroyPolicy&&(delete this._cache[t],i.shader.destroy(),this.debug&&aS.log.warn(`${this}: Releasing shader ${e.id}, destroyed`)());else if(i.useCount<0)throw Error(`ShaderFactory: Shader ${e.id} released too many times`);else this.debug&&aS.log.warn(`${this}: Releasing shader ${e.id} count=${i.useCount}`)()}_hashShader(e){return`${e.stage}:${e.source}`}}let mi=null,mr=null;class mn{bufferLayouts;constructor(e){this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(t=>t.name===e)||null}getAttributeNamesForBuffer(e){return e.attributes?e.attributes?.map(e=>e.attribute):[e.name]}mergeBufferLayouts(e,t){let i=[...e];for(let e of t){let t=i.findIndex(t=>t.name===e.name);t<0?i.push(e):i[t]=e}return i}getBufferIndex(e){let t=this.bufferLayouts.findIndex(t=>t.name===e);return -1===t&&aS.log.warn(`BufferLayout: Missing buffer for "${e}".`)(),t}}class ma{options={disableWarnings:!1};modules;moduleUniforms;moduleBindings;constructor(e,t){for(const i of(Object.assign(this.options,t),ah(Object.values(e).filter(e=>e.dependencies))))e[i.name]=i;for(const[t,i]of(aS.log.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={},Object.entries(e)))this._addModule(i),i.name&&t!==i.name&&!this.options.disableWarnings&&aS.log.warn(`Module name: ${t} vs ${i.name}`)()}destroy(){}setProps(e){for(let t of Object.keys(e)){let i=e[t]||{},r=this.modules[t];if(!r){this.options.disableWarnings||aS.log.warn(`Module ${t} not found`)();continue}let n=this.moduleUniforms[t],a=this.moduleBindings[t],{uniforms:s,bindings:o}=function(e){let t={bindings:{},uniforms:{}};return Object.keys(e).forEach(i=>{let r=e[i];(!ArrayBuffer.isView(r)||r instanceof DataView)&&(Array.isArray(r)?0!==r.length&&"number"!=typeof r[0]:1)&&"number"!=typeof r&&"boolean"!=typeof r?t.bindings[i]=r:t.uniforms[i]=r}),t}(r.getUniforms?.(i,n)||i);this.moduleUniforms[t]={...n,...s},this.moduleBindings[t]={...a,...o}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){let e={};for(let t of Object.values(this.moduleBindings))Object.assign(e,t);return e}getDebugTable(){let e={};for(let[t,i]of Object.entries(this.moduleUniforms))for(let[r,n]of Object.entries(i))e[`${t}.${r}`]={type:this.modules[t].uniformTypes?.[r],value:String(n)};return e}_addModule(e){let t=e.name;this.moduleUniforms[t]=e.defaultUniforms||{},this.moduleBindings[t]={}}}async function ms(e,t){let i=new Image;return i.crossOrigin=t?.crossOrigin||"anonymous",i.src=e.startsWith("http")?e:""+e,await i.decode(),t?await createImageBitmap(i,t):await createImageBitmap(i)}let mo=["+X","-X","+Y","-Y","+Z","-Z"],ml=["+X","-X","+Y","-Y","+Z","-Z"];class mc{device;id;props;texture;sampler;view;ready;isReady=!1;destroyed=!1;resolveReady=()=>{};rejectReady=()=>{};get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}constructor(e,t){this.device=e;const i=g5("async-texture");this.props={...mc.defaultProps,id:i,...t},this.id=this.props.id,t={...t},"string"==typeof t?.data&&"2d"===t.dimension&&(t.data=ms(t.data)),t.mipmaps&&(t.mipLevels="auto"),this.ready=new Promise((e,t)=>{this.resolveReady=()=>{this.isReady=!0,e()},this.rejectReady=t}),this.initAsync(t)}async initAsync(e){let t=e.data,i=await mu(t).then(void 0,this.rejectReady);if(this.destroyed)return;let r=this.props.width&&this.props.height?{width:this.props.width,height:this.props.height}:this.getTextureDataSize(i);if(!r)throw Error("Texture size could not be determined");let n={...r,...e,data:void 0,mipLevels:1},a=this.device.getMipLevelCount(n.width,n.height);if(n.mipLevels="auto"===this.props.mipLevels?a:Math.min(a,this.props.mipLevels),this.texture=this.device.createTexture(n),this.sampler=this.texture.sampler,this.view=this.texture.view,e.data)switch(this.props.dimension){case"1d":this._setTexture1DData(this.texture,i);break;case"2d":this._setTexture2DData(i);break;case"3d":this._setTexture3DData(this.texture,i);break;case"2d-array":this._setTextureArrayData(this.texture,i);break;case"cube":this._setTextureCubeData(this.texture,i);break;case"cube-array":this._setTextureCubeArrayData(this.texture,i)}this.props.mipmaps&&this.generateMipmaps(),aS.log.info(1,`${this} loaded`),this.resolveReady()}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}generateMipmaps(){this.texture.generateMipmapsWebGL()}setSampler(e={}){this.texture.setSampler(e instanceof f5.Sampler?e:this.device.createSampler(e))}resize(e){if(!this.isReady)throw Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){let t=this.texture;this.texture=t.clone(e),t.destroy()}return!0}isTextureLevelData(e){return ArrayBuffer.isView(e?.data)}getTextureDataSize(e){if(!e||ArrayBuffer.isView(e))return null;if(Array.isArray(e))return this.getTextureDataSize(e[0]);if(this.device.isExternalImage(e))return this.device.getExternalImageSize(e);if(e&&"object"==typeof e&&e.constructor===Object){let t=Object.values(e)[0];return{width:t.width,height:t.height}}throw Error("texture size deduction failed")}getCubeFaceDepth(e){switch(e){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw Error(e)}}setTextureData(e){}_setTexture1DData(e,t){throw Error("setTexture1DData not supported in WebGL.")}_setTexture2DData(e,t=0){if(!this.texture)throw Error("Texture not initialized");let i=this._normalizeTextureData(e);i.length>1&&!1!==this.props.mipmaps&&aS.log.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let e=0;e<i.length;e++){let r=i[e];this.device.isExternalImage(r)?this.texture.copyExternalImage({image:r,depth:t,mipLevel:e,flipY:!0}):this.texture.copyImageData({data:r.data,mipLevel:e})}}_setTexture3DData(e,t){if(this.texture?.props.dimension!=="3d")throw Error(this.id);for(let e=0;e<t.length;e++)this._setTexture2DData(t[e],e)}_setTextureCubeData(e,t){if(this.texture?.props.dimension!=="cube")throw Error(this.id);for(let[e,i]of Object.entries(t)){let t=ml.indexOf(e);this._setTexture2DData(i,t)}}_setTextureArrayData(e,t){if(this.texture?.props.dimension!=="2d-array")throw Error(this.id);for(let e=0;e<t.length;e++)this._setTexture2DData(t[e],e)}_setTextureCubeArrayData(e,t){throw Error("setTextureCubeArrayData not supported in WebGL2.")}_setTextureCubeFaceData(e,t,i,r=0){Array.isArray(t)&&t.length>1&&!1!==this.props.mipmaps&&aS.log.warn(`${this.id} has mipmap and multiple LODs.`)();let n=mo.indexOf(i);this._setTexture2DData(t,n)}_normalizeTextureData(e){let t=this.texture;return ArrayBuffer.isView(e)?[{data:e,width:t.width,height:t.height}]:Array.isArray(e)?e:[e]}static defaultProps={...f3.Texture.defaultProps,data:null,mipmaps:!1}}async function mu(e){if(Array.isArray(e=await e))return await Promise.all(e.map(mu));if(e&&"object"==typeof e&&e.constructor===Object){let t=e,i=await Promise.all(Object.values(t)),r=Object.keys(t),n={};for(let e=0;e<r.length;e++)n[r[e]]=i[e];return n}return e}class mh{static defaultProps={...f6.RenderPipeline.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:aP.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0};device;id;source;vs;fs;pipelineFactory;shaderFactory;userData={};parameters;topology;bufferLayout;isInstanced=void 0;instanceCount=0;vertexCount;indexBuffer=null;bufferAttributes={};constantAttributes={};bindings={};vertexArray;transformFeedback=null;pipeline;shaderInputs;_uniformStore;_attributeInfos={};_gpuGeometry=null;props;_pipelineNeedsUpdate="newly created";_needsRedraw="initializing";_destroyed=!1;_lastDrawTimestamp=-1;get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}constructor(e,t){this.props={...mh.defaultProps,...t},t=this.props,this.id=t.id||g5("model"),this.device=e,Object.assign(this.userData,t.userData);const i=Object.fromEntries(this.props.modules?.map(e=>[e.name,e])||[]),r=t.shaderInputs||new ma(i,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(r);const n=function(e){return{type:e.type,shaderLanguage:e.info.shadingLanguage,shaderLanguageVersion:e.info.shadingLanguageVersion,gpu:e.info.gpu,features:e.features}}(e),a=(this.props.modules?.length>0?this.props.modules:this.shaderInputs?.getModules())||[];if("webgpu"===this.device.type&&this.props.source){const{source:e,getUniforms:t}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:n,...this.props,modules:a});this.source=e,this._getModuleUniforms=t,this.props.shaderLayout||=function(e){let t,i={attributes:[],bindings:[]};try{t=function(e){try{return new g1(e)}catch(t){if(t instanceof Error)throw t;let e="WGSL parse error";throw"object"==typeof t&&t?.message&&(e+=`: ${t.message} `),"object"==typeof t&&t?.token&&(e+=t.token.line||""),Error(e,{cause:t})}}(e)}catch(e){return aS.log.error(e.message)(),i}for(let e of t.uniforms){let t=[];for(let i of e.type?.members||[])t.push({name:i.name,type:g2(i.type)});i.bindings.push({type:"uniform",name:e.name,group:e.group,location:e.binding,members:t})}for(let e of t.textures)i.bindings.push({type:"texture",name:e.name,group:e.group,location:e.binding});for(let e of t.samplers)i.bindings.push({type:"sampler",name:e.name,group:e.group,location:e.binding});let r=t.entry.vertex[0],n=r?.inputs.length||0;for(let e=0;e<n;e++){let t=r.inputs[e];if("location"===t.locationType){let e=g2(t.type);i.attributes.push({name:t.name,location:Number(t.location),type:e})}}return i}(this.source)}else{const{vs:e,fs:t,getUniforms:i}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:n,...this.props,modules:a});this.vs=e,this.fs=t,this._getModuleUniforms=i}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,t.geometry&&this.setGeometry(t.geometry),this.pipelineFactory=t.pipelineFactory||g7.getDefaultPipelineFactory(this.device),this.shaderFactory=t.shaderFactory||mt.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({shaderLayout:this.pipeline.shaderLayout,bufferLayout:this.pipeline.bufferLayout}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in t&&(this.isInstanced=t.isInstanced),t.instanceCount&&this.setInstanceCount(t.instanceCount),t.vertexCount&&this.setVertexCount(t.vertexCount),t.indexBuffer&&this.setIndexBuffer(t.indexBuffer),t.attributes&&this.setAttributes(t.attributes),t.constantAttributes&&this.setConstantAttributes(t.constantAttributes),t.bindings&&this.setBindings(t.bindings),t.transformFeedback&&(this.transformFeedback=t.transformFeedback),Object.seal(this)}destroy(){this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),this._gpuGeometry?.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");let e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||=e}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){let t,i=this._areBindingsLoading();if(i)return aS.log.info(2,`>>> DRAWING ABORTED ${this.id}: ${i} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();let i=this._getBindings();this.pipeline.setBindings(i,{disableWarnings:this.props.disableWarnings});let{indexBuffer:r}=this.vertexArray,n=r?r.byteLength/("uint32"===r.indexType?4:2):void 0;t=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:n,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),t?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",t}setGeometry(e){this._gpuGeometry?.destroy();let t=e&&function(e,t){if(t instanceof g6)return t;let i=function(e,t){if(!t.indices)return;let i=t.indices.value;return e.createBuffer({usage:fF.Buffer.INDEX,data:i})}(e,t),{attributes:r,bufferLayout:n}=function(e,t){let i=[],r={};for(let[n,a]of Object.entries(t.attributes)){let t=n;switch(n){case"POSITION":t="positions";break;case"NORMAL":t="normals";break;case"TEXCOORD_0":t="texCoords";break;case"COLOR_0":t="colors"}if(a){r[t]=e.createBuffer({data:a.value,id:`${n}-buffer`});let{value:s,size:o,normalized:l}=a;i.push({name:t,format:(0,g3.getVertexFormatFromAttribute)(s,o,l)})}}return{attributes:r,bufferLayout:i,vertexCount:t._calculateVertexCount(t.attributes,t.indices)}}(e,t);return new g6({topology:t.topology||"triangle-list",bufferLayout:n,vertexCount:t.vertexCount,indices:i,attributes:r})}(this.device,e);if(t){this.setTopology(t.topology||"triangle-list");let e=new mn(this.bufferLayout);this.bufferLayout=e.mergeBufferLayouts(t.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(t)}this._gpuGeometry=t}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){let t=new mn(this.bufferLayout);this.bufferLayout=this._gpuGeometry?t.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({shaderLayout:this.pipeline.shaderLayout,bufferLayout:this.pipeline.bufferLayout}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){!function e(t,i,r){if(t===i)return!0;if(!r||!t||!i)return!1;if(Array.isArray(t)){if(!Array.isArray(i)||t.length!==i.length)return!1;for(let n=0;n<t.length;n++)if(!e(t[n],i[n],r-1))return!1;return!0}if(Array.isArray(i))return!1;if("object"==typeof t&&"object"==typeof i){let n=Object.keys(t),a=Object.keys(i);if(n.length!==a.length)return!1;for(let a of n)if(!i.hasOwnProperty(a)||!e(t[a],i[a],r-1))return!1;return!0}return!1}(e,this.parameters,2)&&(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,void 0===this.isInstanced&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){for(let[i,r]of(this.shaderInputs=e,this._uniformStore=new pi(this.shaderInputs.modules),Object.entries(this.shaderInputs.modules))){var t;if((t=r).uniformTypes&&!function(e){for(let t in e)return!1;return!0}(t.uniformTypes)){let e=this._uniformStore.getManagedUniformBuffer(this.device,i);this.bindings[`${i}Uniforms`]=e}}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,t){var i,r;let n,a,s=t?.disableWarnings??this.props.disableWarnings;e.indices&&aS.log.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)(),this.bufferLayout=(i=this.pipeline.shaderLayout,r=this.bufferLayout,n=Object.fromEntries(i.attributes.map(e=>[e.name,e.location])),(a=r.slice()).sort((e,t)=>{let i=e.attributes?e.attributes.map(e=>e.attribute):[e.name],r=t.attributes?t.attributes.map(e=>e.attribute):[t.name];return Math.min(...i.map(e=>n[e]))-Math.min(...r.map(e=>n[e]))}),a);let o=new mn(this.bufferLayout);for(let[t,i]of Object.entries(e)){let e=o.getBufferLayout(t);if(!e){s||aS.log.warn(`Model(${this.id}): Missing layout for buffer "${t}".`)();continue}let r=o.getAttributeNamesForBuffer(e),n=!1;for(let e of r){let t=this._attributeInfos[e];if(t){let e="webgpu"===this.device.type?o.getBufferIndex(t.bufferName):t.location;this.vertexArray.setBuffer(e,i),n=!0}}n||s||aS.log.warn(`Model(${this.id}): Ignoring buffer "${i.id}" for unknown attribute "${t}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,t){for(let[i,r]of Object.entries(e)){let e=this._attributeInfos[i];e?this.vertexArray.setConstantWebGL(e.location,r):(t?.disableWarnings??this.props.disableWarnings)||aS.log.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${i}"`)()}this.setNeedsRedraw("constants")}_areBindingsLoading(){for(let e of Object.values(this.bindings))if(e instanceof mc&&!e.isReady)return e.id;return!1}_getBindings(){let e={};for(let[t,i]of Object.entries(this.bindings))i instanceof mc?i.isReady&&(e[t]=i.texture):e[t]=i;return e}_getBindingsUpdateTimestamp(){let e=0;for(let t of Object.values(this.bindings))t instanceof f4.TextureView?e=Math.max(e,t.texture.updateTimestamp):t instanceof fF.Buffer||t instanceof f3.Texture?e=Math.max(e,t.updateTimestamp):t instanceof mc?e=t.texture?Math.max(e,t.texture.updateTimestamp):1/0:t instanceof f5.Sampler||(e=Math.max(e,t.buffer.updateTimestamp));return e}_setGeometryAttributes(e){let t={...e.attributes};for(let[e]of Object.entries(t))this.pipeline.shaderLayout.attributes.find(t=>t.name===e)||"positions"===e||delete t[e];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(t,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||=e,this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,t=null;this.pipeline&&(aS.log.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,t=this.pipeline.fs),this._pipelineNeedsUpdate=!1;let i=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders}),r=null;this.source?r=i:this.fs&&(r=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:i,fs:r}),this._attributeInfos=(0,pr.getAttributeInfosFromLayouts)(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),t&&this.shaderFactory.release(t)}return this.pipeline}_lastLogTime=0;_logOpen=!1;_logDrawCallStart(){let e=aS.log.level>3?0:1e4;aS.log.level<2||Date.now()-this._lastLogTime<e||(this._lastLogTime=Date.now(),this._logOpen=!0,aS.log.group(2,`>>> DRAWING MODEL ${this.id}`,{collapsed:aS.log.level<=2})())}_logDrawCallEnd(){if(this._logOpen){let e=function(e,t){let i={},r="Values";if(0===e.attributes.length&&!e.varyings?.length)return{"No attributes or varyings":{[r]:"N/A"}};for(let t of e.attributes)if(t){let e=`${t.location} ${t.name}: ${t.type}`;i[`in ${e}`]={[r]:t.stepMode||"vertex"}}for(let t of e.varyings||[]){let e=`${t.location} ${t.name}`;i[`out ${e}`]={[r]:JSON.stringify(t)}}return i}(this.pipeline.shaderLayout,this.id);aS.log.table(2,e)();let t=this.shaderInputs.getDebugTable();aS.log.table(2,t)();let i=this._getAttributeDebugTable();aS.log.table(2,this._attributeInfos)(),aS.log.table(2,i)(),aS.log.groupEnd(2)(),this._logOpen=!1}}_drawCount=0;_logFramebuffer(e){let t=this.device.props.debugFramebuffers;if(this._drawCount++,!t)return;let i=e.props.framebuffer;i&&function(e,{id:t,minimap:i,opaque:r,top:n="0",left:a="0",rgbaScale:s=1}){mi||((mi=document.createElement("canvas")).id=t,mi.title=t,mi.style.zIndex="100",mi.style.position="absolute",mi.style.top=n,mi.style.left=a,mi.style.border="blue 5px solid",mi.style.transform="scaleY(-1)",document.body.appendChild(mi),mr=mi.getContext("2d")),(mi.width!==e.width||mi.height!==e.height)&&(mi.width=e.width/2,mi.height=e.height/2,mi.style.width="400px",mi.style.height="400px");let o=e.device.readPixelsToArrayWebGL(e),l=mr?.createImageData(e.width,e.height);if(l){for(let e=0;e<o.length;e+=4)l.data[0+e+0]=o[e+0]*s,l.data[0+e+1]=o[e+1]*s,l.data[0+e+2]=o[e+2]*s,l.data[0+e+3]=r?255:o[e+3]*s;mr?.putImageData(l,0,0)}}(i,{id:i.id,minimap:!0})}_getAttributeDebugTable(){let e={};for(let[t,i]of Object.entries(this._attributeInfos)){let r=this.vertexArray.attributes[i.location];e[i.location]={name:t,type:i.shaderType,values:r?this._getBufferOrConstantValues(r,i.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){let{indexBuffer:t}=this.vertexArray,i="uint32"===t.indexType?new Uint32Array(t.debugData):new Uint16Array(t.debugData);e.indices={name:"indices",type:t.indexType,values:i.toString()}}return e}_getBufferOrConstantValues(e,t){let i=(0,fV.getTypedArrayConstructor)(t);return(e instanceof fF.Buffer?new i(e.debugData):e).toString()}}class md{device;model;transformFeedback;static defaultProps={...mh.defaultProps,outputs:void 0,feedbackBuffers:void 0};static isSupported(e){return e?.info?.type==="webgl"}constructor(e,t=md.defaultProps){if(!md.isSupported(e))throw Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new mh(this.device,{id:t.id||"buffer-transform-model",fs:t.fs||function(e){let{input:t,inputChannels:i,output:r}={};if(!t)return f2;if(!i)throw Error("inputChannels");let n=function(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw Error(`invalid channels: ${e}`)}}(i),a=function(e,t){switch(t){case 1:return`vec4(${e}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${e}, 0.0, 1.0)`;case 3:return`vec4(${e}, 1.0)`;case 4:return e;default:throw Error(`invalid channels: ${t}`)}}(t,i);return`\
#version 300 es
in ${n} ${t};
out vec4 ${r};
void main() {
  ${r} = ${a};
}`}(),topology:t.topology||"point-list",varyings:t.outputs||t.varyings,...t}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:t.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){e?.inputBuffers&&this.model.setAttributes(e.inputBuffers),e?.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);let t=this.device.beginRenderPass(e);this.model.draw(t),t.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){let t=this.getBuffer(e);if(!t)throw Error("BufferTransform#getBuffer");if(t instanceof fF.Buffer)return t.readAsync();let{buffer:i,byteOffset:r=0,byteLength:n=i.byteLength}=t;return i.readAsync(r,n)}}function mf(e,t=[],i=0){let r=Math.fround(e),n=e-r;return t[i]=r,t[i+1]=n,t}let mp={name:"fp64arithmetic",vs:`\

uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,defaultUniforms:{ONE:1},uniformTypes:{ONE:"f32"},fp64ify:mf,fp64LowPart:function(e){return e-Math.fround(e)},fp64ifyMatrix4:function(e){let t=new Float32Array(32);for(let i=0;i<4;++i)for(let r=0;r<4;++r){let n=4*i+r;mf(e[4*r+i],t,2*n)}return t}};function mg(e){let{source:t,target:i,start:r=0,size:n,getData:a}=e,s=e.end||i.length,o=t.length,l=s-r;if(o>l)return void i.set(t.subarray(0,l),r);if(i.set(t,r),!a)return;let c=o;for(;c<l;){let e=a(c,t);for(let t=0;t<n;t++)i[r+c]=e[t]||0,c++}}function mm(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw Error(`No defined attribute type for size "${e}"`)}}function mv(e){switch(e){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw Error("invalid type size")}}function my(e){e.push(e.shift())}function mb({device:e,source:t,target:i}){return(!i||i.byteLength<t.byteLength)&&(i?.destroy(),i=e.createBuffer({byteLength:t.byteLength,usage:t.usage})),i}function mx({device:e,buffer:t,attribute:i,fromLength:r,toLength:n,fromStartIndices:a,getData:s=e=>e}){let o=i.doublePrecision&&i.value instanceof Float64Array?2:1,l=i.size*o,c=i.byteOffset,u=i.settings.bytesPerElement<4?c/i.settings.bytesPerElement*4:c,h=i.startIndices,d=a&&h,f=i.isConstant;if(!d&&t&&r>=n)return t;let p=i.value instanceof Float64Array?Float32Array:i.value.constructor,g=f?i.value:new p(i.getBuffer().readSyncWebGL(c,n*p.BYTES_PER_ELEMENT).buffer);if(i.settings.normalized&&!f){let e=s;s=(t,r)=>i.normalizeConstant(e(t,r))}let v=f?(e,t)=>s(g,t):(e,t)=>s(g.subarray(e+c,e+c+l),t),y=new Float32Array(t?t.readSyncWebGL(u,4*r).buffer:0),b=new Float32Array(n);return!function({source:e,target:t,size:i,getData:r,sourceStartIndices:n,targetStartIndices:a}){if(!n||!a)return mg({source:e,target:t,size:i,getData:r});let s=0,o=0,l=r&&((e,t)=>r(e+o,t)),c=Math.min(n.length,a.length);for(let r=1;r<c;r++){let c=n[r]*i,u=a[r]*i;mg({source:e.subarray(s,c),target:t,start:o,end:u,size:i,getData:l}),s=c,o=u}o<t.length&&mg({source:[],target:t,start:o,size:i,getData:l})}({source:y,target:b,sourceStartIndices:a,targetStartIndices:h,size:l,getData:v}),(!t||t.byteLength<b.byteLength+u)&&(t?.destroy(),t=e.createBuffer({byteLength:b.byteLength+u,usage:35050})),t.write(b,u),t}class m_{constructor({device:e,attribute:t,timeline:i}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new dr(i),this.attribute=t,this.attributeInTransition=function(e){let{device:t,settings:i,value:r}=e,n=new f0(t,i);return n.setData({value:r instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:i.normalized}),n}(t),this.currentStartIndices=t.startIndices}get inProgress(){return this.transition.inProgress}start(e,t,i=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=function(e,t){let{doublePrecision:i,settings:r,value:n,size:a}=e,s=i&&n instanceof Float64Array?2:1,o=0,{shaderAttributes:l}=e.settings;if(l)for(let e of Object.values(l))o=Math.max(o,e.vertexOffset??0);return(r.noAlloc?n.length:(t+o)*a)*s}(this.attribute,t),this.transition.start({...e,duration:i})}update(){let e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){for(let e of(this.cancel(),this.buffers))e.destroy();this.buffers.length=0}}let mw={name:"interpolation",vs:`\
uniform interpolationUniforms {
  float time;
} interpolation;
`,uniformTypes:{time:"f32"}},mk=`\
#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,mE=`\
#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function mT(e){return e.doublePrecision&&e.value instanceof Float64Array}let mP={name:"spring",vs:`\
uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,uniformTypes:{damping:"f32",stiffness:"f32"}},mS=`\
#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,mM=`\
#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`,mC={interpolation:class extends m_{constructor({device:e,attribute:t,timeline:i}){super({device:e,attribute:t,timeline:i}),this.type="interpolation",this.transform=function(e,t){let i=t.size,r=mm(i),n=mv(i),a=t.getBufferLayout();return mT(t)?new md(e,{vs:mE,bufferLayout:[{name:"aFrom",byteStride:8*i,attributes:[{attribute:"aFrom",format:n,byteOffset:0},{attribute:"aFrom64Low",format:n,byteOffset:4*i}]},{name:"aTo",byteStride:8*i,attributes:[{attribute:"aTo",format:n,byteOffset:0},{attribute:"aTo64Low",format:n,byteOffset:4*i}]}],modules:[mp,mw],defines:{ATTRIBUTE_TYPE:r,ATTRIBUTE_SIZE:i},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new md(e,{vs:mk,bufferLayout:[{name:"aFrom",format:n},{name:"aTo",format:a.attributes[0].format}],modules:[mw],defines:{ATTRIBUTE_TYPE:r},varyings:["vCurrent"],disableWarnings:!0})}(e,t)}start(e,t){let i=this.currentLength,r=this.currentStartIndices;if(super.start(e,t,e.duration),e.duration<=0)return void this.transition.cancel();let{buffers:n,attribute:a}=this;my(n),n[0]=mx({device:this.device,buffer:n[0],attribute:a,fromLength:i,toLength:this.currentLength,fromStartIndices:r,getData:e.enter}),n[1]=mb({device:this.device,source:n[0],target:n[1]}),this.setBuffer(n[1]);let{transform:s}=this,o=s.model,l=Math.floor(this.currentLength/a.size);mT(a)&&(l/=2),o.setVertexCount(l),a.isConstant?(o.setAttributes({aFrom:n[0]}),o.setConstantAttributes({aTo:a.value})):o.setAttributes({aFrom:n[0],aTo:a.getBuffer()}),s.transformFeedback.setBuffers({vCurrent:n[1]})}onUpdate(){let{duration:e,easing:t}=this.settings,{time:i}=this.transition,r=i/e;t&&(r=t(r));let{model:n}=this.transform,a={time:r};n.shaderInputs.setProps({interpolation:a}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}},spring:class extends m_{constructor({device:e,attribute:t,timeline:i}){var r,n;super({device:e,attribute:t,timeline:i}),this.type="spring",this.texture=e.createTexture({data:new Uint8Array(4),format:"rgba8unorm",width:1,height:1}),this.framebuffer=(r=e,n=this.texture,r.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[n]})),this.transform=function(e,t){let i=mm(t.size),r=mv(t.size);return new md(e,{vs:mS,fs:mM,bufferLayout:[{name:"aPrev",format:r},{name:"aCur",format:r},{name:"aTo",format:t.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[mP],defines:{ATTRIBUTE_TYPE:i},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}(e,t)}start(e,t){let i=this.currentLength,r=this.currentStartIndices;super.start(e,t);let{buffers:n,attribute:a}=this;for(let t=0;t<2;t++)n[t]=mx({device:this.device,buffer:n[t],attribute:a,fromLength:i,toLength:this.currentLength,fromStartIndices:r,getData:e.enter});n[2]=mb({device:this.device,source:n[0],target:n[2]}),this.setBuffer(n[1]);let{model:s}=this.transform;s.setVertexCount(Math.floor(this.currentLength/a.size)),a.isConstant?s.setConstantAttributes({aTo:a.value}):s.setAttributes({aTo:a.getBuffer()})}onUpdate(){let{buffers:e,transform:t,framebuffer:i,transition:r}=this,n=this.settings;t.model.setAttributes({aPrev:e[0],aCur:e[1]}),t.transformFeedback.setBuffers({vNext:e[2]});let a={stiffness:n.stiffness,damping:n.damping};t.model.shaderInputs.setProps({spring:a}),t.run({framebuffer:i,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),my(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(i)[0]>0||r.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}};class mA{constructor(e,{id:t,timeline:i}){if(!e)throw Error("AttributeTransitionManager is constructed without device");this.id=t,this.device=e,this.timeline=i,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(let e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:t,numInstances:i}){for(let r in this.numInstances=i||1,e){let i=e[r],n=i.getTransitionSetting(t);n&&this._updateAttribute(r,i,n)}for(let i in this.transitions){let r=e[i];r&&r.getTransitionSetting(t)||this._removeTransition(i)}}hasAttribute(e){let t=this.transitions[e];return t&&t.inProgress}getAttributes(){let e={};for(let t in this.transitions){let i=this.transitions[t];i.inProgress&&(e[t]=i.attributeInTransition)}return e}run(){if(0===this.numInstances)return!1;for(let e in this.transitions)this.transitions[e].update()&&(this.needsRedraw=!0);let e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,t,i){let r=this.transitions[e],n=!r||r.type!==i.type;if(n){r&&this._removeTransition(e);let a=mC[i.type];a?this.transitions[e]=new a({attribute:t,timeline:this.timeline,device:this.device}):(or.error(`unsupported transition type '${i.type}'`)(),n=!1)}(n||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(i,this.numInstances))}}let mI="attributeManager.invalidate";class mL{constructor(e,{id:t="attribute-manager",stats:i,timeline:r}={}){this.mergeBoundsMemoized=oJ(hJ),this.id=t,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=i,this.attributeTransitionManager=new mA(e,{id:`${t}-transitions`,timeline:r}),Object.seal(this)}finalize(){for(let e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){let t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(let t of e)void 0!==this.attributes[t]&&(this.attributes[t].delete(),delete this.attributes[t])}invalidate(e,t){let i=this._invalidateTrigger(e,t);uk(mI,this,e,i)}invalidateAll(e){for(let t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);uk(mI,this,"all")}update({data:e,numInstances:t,startIndices:i=null,transitions:r,props:n={},buffers:a={},context:s={}}){let o=!1;for(let r in uk("attributeManager.updateStart",this),this.stats&&this.stats.get("Update Attributes").timeStart(),this.attributes){let l=this.attributes[r],c=l.settings.accessor;l.startIndices=i,l.numInstances=t,n[r]&&or.removed(`props.${r}`,`data.attributes.${r}`)(),l.setExternalBuffer(a[r])||l.setBinaryValue("string"==typeof c?a[c]:void 0,e.startIndices)||"string"==typeof c&&!a[c]&&l.setConstantValue(s,n[c])||l.needsUpdate()&&(o=!0,this._updateAttribute({attribute:l,numInstances:t,data:e,props:n,context:s})),this.needsRedraw=this.needsRedraw||l.needsRedraw()}o&&uk("attributeManager.updateEnd",this,t),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:t,transitions:r})}updateTransition(){let{attributeTransitionManager:e}=this,t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){let t=e.map(e=>this.attributes[e]?.getBounds());return this.mergeBoundsMemoized(t)}getChangedAttributes(e={clearChangedFlags:!1}){let{attributes:t,attributeTransitionManager:i}=this,r={...i.getAttributes()};for(let n in t){let a=t[n];a.needsRedraw(e)&&!i.hasAttribute(n)&&(r[n]=a)}return r}getBufferLayouts(e){return Object.values(this.getAttributes()).map(t=>t.getBufferLayout(e))}_add(e,t){for(let i in e){let r=e[i],n={...r,id:i,size:r.isIndexed&&1||r.size||1,...t};this.attributes[i]=new f0(this.device,n)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){let e={};for(let t in this.attributes)this.attributes[t].getUpdateTriggers().forEach(i=>{e[i]||(e[i]=[]),e[i].push(t)});this.updateTriggers=e}_invalidateTrigger(e,t){let{attributes:i,updateTriggers:r}=this,n=r[e];return n&&n.forEach(e=>{let r=i[e];r&&r.setNeedsUpdate(r.id,t)}),n}_updateAttribute(e){let{attribute:t,numInstances:i}=e;(uk("attribute.updateStart",t),t.constant)?t.setConstantValue(e.context,t.value):(t.allocate(i)&&uk("attribute.allocate",t,i),t.updateBuffer(e)&&(this.needsRedraw=!0,uk("attribute.updateEnd",t,i)))}}function mD(e,t,i,r,n){let a=t-e;return(i-t)*n+-a*r+a+t}function mO(e,t){if(Array.isArray(e)){let i=0;for(let r=0;r<e.length;r++){let n=e[r]-t[r];i+=n*n}return Math.sqrt(i)}return Math.abs(e-t)}let mR={interpolation:class extends dr{get value(){return this._value}_onUpdate(){let{time:e,settings:{fromValue:t,toValue:i,duration:r,easing:n}}=this,a=n(e/r);this._value=lu(t,i,a)}},spring:class extends dr{get value(){return this._currValue}_onUpdate(){let{fromValue:e,toValue:t,damping:i,stiffness:r}=this.settings,{_prevValue:n=e,_currValue:a=e}=this,s=function(e,t,i,r,n){if(Array.isArray(i)){let a=[];for(let s=0;s<i.length;s++)a[s]=mD(e[s],t[s],i[s],r,n);return a}return mD(e,t,i,r,n)}(n,a,t,i,r),o=mO(s,t),l=mO(s,a);o<1e-5&&l<1e-5&&(s=t,this.end()),this._prevValue=a,this._currValue=s}}};class mN{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,t,i,r){let{transitions:n}=this;if(n.has(e)){let i=n.get(e),{value:r=i.settings.fromValue}=i;t=r,this.remove(e)}if(!(r=fQ(r)))return;let a=mR[r.type];if(!a)return void or.error(`unsupported transition type '${r.type}'`)();let s=new a(this.timeline);s.start({...r,fromValue:t,toValue:i}),n.set(e,s)}remove(e){let{transitions:t}=this;t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){let e={};for(let[t,i]of this.transitions)i.update(),e[t]=i.value,i.inProgress||this.remove(t);return e}clear(){for(let e of this.transitions.keys())this.remove(e)}}function mj({newProps:e,oldProps:t,ignoreProps:i={},propTypes:r={},triggerName:n="props"}){if(t===e)return!1;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return`${n} changed shallowly`;for(let a of Object.keys(e))if(!(a in i)){if(!(a in t))return`${n}.${a} added`;let i=mB(e[a],t[a],r[a]);if(i)return`${n}.${a} ${i}`}for(let a of Object.keys(t))if(!(a in i)){if(!(a in e))return`${n}.${a} dropped`;if(!Object.hasOwnProperty.call(e,a)){let i=mB(e[a],t[a],r[a]);if(i)return`${n}.${a} ${i}`}}return!1}function mB(e,t,i){let r=i&&i.equal;return r&&!r(e,t,i)||!r&&(r=e&&t&&e.equals)&&!r.call(e,t)?"changed deeply":r||t===e?null:"changed shallowly"}function mF(e,t,i){let r=e.updateTriggers[i];r=null==r?{}:r;let n=t.updateTriggers[i];return mj({oldProps:n=null==n?{}:n,newProps:r,triggerName:i})}function mz(e,t){if(!t)return e;let i={...e,...t};if("defines"in t&&(i.defines={...e.defines,...t.defines}),"modules"in t&&(i.modules=(e.modules||[]).concat(t.modules),t.modules.some(e=>"project64"===e.name))){let e=i.modules.findIndex(e=>"project32"===e.name);e>=0&&i.modules.splice(e,1)}if("inject"in t)if(e.inject){let r={...e.inject};for(let e in t.inject)r[e]=(r[e]||"")+t.inject[e];i.inject=r}else i.inject=t.inject;return i}var cq=cq,ot=ot;let mV=[0,0,0];function mU(e,t,i=!1){let r=t.projectPosition(e);if(i&&t instanceof di){let[i,n,a=0]=e,s=t.getDistanceScales([i,n]);r[2]=a*s.unitsPerMeter[2]}return r}function m$(e,{viewport:t,modelMatrix:i,coordinateSystem:r,coordinateOrigin:n,offsetMode:a}){let[s,o,l=0]=e;switch(i&&([s,o,l]=ot.transformMat4([],[s,o,l,1],i)),r){case oG.LNGLAT:return mU([s,o,l],t,a);case oG.LNGLAT_OFFSETS:return mU([s+n[0],o+n[1],l+(n[2]||0)],t,a);case oG.METER_OFFSETS:return mU(c2(n,[s,o,l]),t,a);case oG.CARTESIAN:default:return t.isGeospatial?[s+n[0],o+n[1],l+n[2]]:t.projectPosition([s,o,l])}}let mW={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},mH={},mq={boolean:{validate:(e,t)=>!0,equal:(e,t,i)=>!!e==!!t},number:{validate:(e,t)=>Number.isFinite(e)&&(!("max"in t)||e<=t.max)&&(!("min"in t)||e>=t.min)},color:{validate:(e,t)=>t.optional&&!e||mY(e)&&(3===e.length||4===e.length),equal:(e,t,i)=>h6(e,t,1)},accessor:{validate(e,t){let i=mX(e);return"function"===i||i===mX(t.value)},equal:(e,t,i)=>"function"==typeof t||h6(e,t,1)},array:{validate:(e,t)=>t.optional&&!e||mY(e),equal(e,t,i){let{compare:r}=i,n=Number.isInteger(r)?r:+!!r;return r?h6(e,t,n):e===t}},object:{equal(e,t,i){if(i.ignore)return!0;let{compare:r}=i,n=Number.isInteger(r)?r:+!!r;return r?h6(e,t,n):e===t}},function:{validate:(e,t)=>t.optional&&!e||"function"==typeof e,equal:(e,t,i)=>!i.compare&&!1!==i.ignore||e===t},data:{transform:(e,t,i)=>{if(!e)return e;let{dataTransform:r}=i.props;return r?r(e):"string"==typeof e.shape&&e.shape.endsWith("-table")&&Array.isArray(e.data)?e.data:e}},image:{transform:(e,t,i)=>{let r=i.context;return r&&r.device?function(e,t,i,r){if(i instanceof f3.Texture)return i;i.constructor&&"Object"!==i.constructor.name&&(i={data:i});let n=null;i.compressed&&(n={minFilter:"linear",mipmapFilter:i.data.length>1?"nearest":"linear"});let{width:a,height:s}=i.data,o=t.createTexture({...i,sampler:{...mW,...n,...r},mipLevels:t.getMipLevelCount(a,s)});return o.generateMipmapsWebGL(),mH[o.id]=e,o}(i.id,r.device,e,{...t.parameters,...i.props.textureParameters}):null},release:(e,t,i)=>{var r;r=i.id,e&&e instanceof f3.Texture&&mH[e.id]===r&&(e.delete(),delete mH[e.id])}}};function mG(e,t){return"type"in t?{name:e,...mq[t.type],...t}:"value"in t?{name:e,type:mX(t.value),...t}:{name:e,type:"object",value:t}}function mY(e){return Array.isArray(e)||ArrayBuffer.isView(e)}function mX(e){return mY(e)?"array":null===e?"null":typeof e}function mK(e,t){return Object.prototype.hasOwnProperty.call(e,t)}let mZ=0;class mJ{constructor(...e){this.props=function(e,t){let i;for(let e=t.length-1;e>=0;e--){let r=t[e];"extensions"in r&&(i=r.extensions)}let r=Object.create(function e(t,i){var r,n;if(!(t instanceof mQ.constructor))return{};let a="_mergedDefaultProps";if(i)for(let e of i){let t=e.constructor;t&&(a+=`:${t.extensionName||t.name}`)}let s=mK(r=t,n=a)&&r[n];return s||(t[a]=function(t,i){var r;let n;if(!t.prototype)return null;let a=e(Object.getPrototypeOf(t)),s=function(e){let t={},i={},r={};for(let[n,a]of Object.entries(e)){let e=a?.deprecatedFor;if(e)r[n]=Array.isArray(e)?e:[e];else{let e=function(e,t){switch(mX(t)){case"object":return mG(e,t);case"array":return mG(e,{type:"array",value:t,compare:!1});case"boolean":return mG(e,{type:"boolean",value:t});case"number":return mG(e,{type:"number",value:t});case"function":return mG(e,{type:"function",value:t,compare:!0});default:return{name:e,type:"unknown",value:t}}}(n,a);t[n]=e,i[n]=e.value}}return{propTypes:t,defaultProps:i,deprecatedProps:r}}(function(e,t){return mK(e,t)&&e[t]}(t,"defaultProps")||{}),o=Object.assign(Object.create(null),a,s.defaultProps),l=Object.assign(Object.create(null),a?.[ug],s.propTypes),c=Object.assign(Object.create(null),a?.[um],s.deprecatedProps);for(let t of i){let i=e(t.constructor);i&&(Object.assign(o,i),Object.assign(l,i[ug]),Object.assign(c,i[um]))}return Object.defineProperties(o,{id:{writable:!0,value:((n=(r=t).componentName)||or.warn(`${r.name}.componentName not specified`)(),n||r.name)}}),function(e,t){let i={},r={};for(let e in t){let n=t[e],{name:a,value:s}=n;n.async&&(i[a]=s,r[a]=function(e){return{enumerable:!0,set(t){"string"==typeof t||t instanceof Promise||fX(t)?this[uy][e]=t:this[ub][e]=t},get(){if(this[ub]){if(e in this[ub])return this[ub][e]||this[uv][e];if(e in this[uy]){let t=this[up]&&this[up].internalState;if(t&&t.hasAsyncProp(e))return t.getAsyncProp(e)||this[uv][e]}}return this[uv][e]}}}(a))}e[uv]=i,e[uy]={},Object.defineProperties(e,r)}(o,l),function(e,t){for(let i in t)Object.defineProperty(e,i,{enumerable:!1,set(e){let r=`${this.id}: ${i}`;for(let r of t[i])mK(this,r)||(this[r]=e);or.deprecated(r,t[i].join("/"))()}})}(o,c),o[ug]=l,o[um]=c,0!==i.length||mK(t,"_propTypes")||(t._propTypes=l),o}(t,i||[]))}(e.constructor,i));r[up]=e,r[uy]={},r[ub]={};for(let e=0;e<t.length;++e){let i=t[e];for(let e in i)r[e]=i[e]}return Object.freeze(r),r}(this,e),this.id=this.props.id,this.count=mZ++}clone(e){let{props:t}=this,i={};for(let e in t[uv])e in t[ub]?i[e]=t[ub][e]:e in t[uy]&&(i[e]=t[uy][e]);return new this.constructor({...t,...i,...e})}}mJ.componentName="Component",mJ.defaultProps={};let mQ=mJ,m0=Object.freeze({});class m1{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(let e in this.asyncProps){let t=this.asyncProps[e];t&&t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||m0}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){let t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){if(e){let t=this.asyncProps[e];return!!(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(let e in this.asyncProps)if(this.isAsyncPropLoading(e))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){this.component=e[up]||this.component;let t=e[ub]||{},i=e[uy]||e,r=e[uv]||{};for(let e in t){let i=t[e];this._createAsyncPropData(e,r[e]),this._updateAsyncProp(e,i),t[e]=this.getAsyncProp(e)}for(let e in i){let t=i[e];this._createAsyncPropData(e,r[e]),this._updateAsyncProp(e,t)}}_fetch(e,t){return null}_onResolve(e,t){}_onError(e,t){}_updateAsyncProp(e,t){if(this._didAsyncInputValueChange(e,t)){if("string"==typeof t&&(t=this._fetch(e,t)),t instanceof Promise)return void this._watchPromise(e,t);if(fX(t))return void this._resolveAsyncIterable(e,t);this._setPropValue(e,t)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps)for(let e in this.oldAsyncProps=Object.create(this.oldProps),this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}_didAsyncInputValueChange(e,t){let i=this.asyncProps[e];return t!==i.resolvedValue&&t!==i.lastValue&&(i.lastValue=t,!0)}_setPropValue(e,t){this._freezeAsyncOldProps();let i=this.asyncProps[e];i&&(t=this._postProcessValue(i,t),i.resolvedValue=t,i.pendingLoadCount++,i.resolvedLoadCount=i.pendingLoadCount)}_setAsyncPropValue(e,t,i){let r=this.asyncProps[e];r&&i>=r.resolvedLoadCount&&void 0!==t&&(this._freezeAsyncOldProps(),r.resolvedValue=t,r.resolvedLoadCount=i,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){let i=this.asyncProps[e];if(i){i.pendingLoadCount++;let r=i.pendingLoadCount;t.then(t=>{this.component&&(t=this._postProcessValue(i,t),this._setAsyncPropValue(e,t,r),this._onResolve(e,t))}).catch(t=>{this._onError(e,t)})}}async _resolveAsyncIterable(e,t){if("data"!==e)return void this._setPropValue(e,t);let i=this.asyncProps[e];if(!i)return;i.pendingLoadCount++;let r=i.pendingLoadCount,n=[],a=0;for await(let i of t){if(!this.component)return;let{dataTransform:t}=this.component.props;Object.defineProperty(n=t?t(i,n):n.concat(i),"__diff",{enumerable:!1,value:[{startRow:a,endRow:n.length}]}),a=n.length,this._setAsyncPropValue(e,n,r)}this._onResolve(e,n)}_postProcessValue(e,t){let i=e.type;return i&&this.component&&(i.release&&i.release(e.resolvedValue,i,this.component),i.transform)?i.transform(t,i,this.component):t}_createAsyncPropData(e,t){if(!this.asyncProps[e]){let i=this.component&&this.component.props[ug];this.asyncProps[e]={type:i&&i[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}}class m2 extends m1{constructor({attributeManager:e,layer:t}){super(t),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,t){let i=this.layer,r=i?.props.fetch;return r?r(t,{propName:e,layer:i}):super._fetch(e,t)}_onResolve(e,t){let i=this.layer;if(i){let r=i.props.onDataLoad;"data"===e&&r&&r(t,{propName:e,layer:i})}}_onError(e,t){let i=this.layer;i&&i.raiseError(t,`loading ${e} of ${this.layer}`)}}let m3=Object.freeze([]),m4=oJ(({oldViewport:e,viewport:t})=>e.equals(t)),m5=new Uint8ClampedArray(0),m6={data:{type:"data",value:m3,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:e=>e&&e.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(e,{propName:t,layer:i,loaders:r,loadOptions:n,signal:a})=>{let{resourceManager:s}=i.context;n=n||i.getLoadOptions(),r=r||i.props.loaders,a&&(n={...n,fetch:{...n?.fetch,signal:a}});let o=s.contains(e);return(o||n||(s.add({resourceId:e,data:hW(e,r),persistent:!1}),o=!0),o)?s.subscribe({resourceId:e,onChange:e=>i.internalState?.reloadAsyncProp(t,e),consumerId:i.id,requestId:t}):hW(e,r,n)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:oG.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:e})=>[0,-(100*e)]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class m8 extends mQ{constructor(){super(...arguments),this.internalState=null,this.lifecycle="Awaiting state",this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){let e=this.constructor.layerName||this.constructor.name;return`${e}({id: '${this.props.id}'})`}project(e){dl(this.internalState);let t=this.internalState.viewport||this.context.viewport,[i,r,n]=c5(m$(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),t.pixelProjectionMatrix);return 2===e.length?[i,r]:[i,r,n]}unproject(e){return dl(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,t){return dl(this.internalState),function(e,t){let{viewport:i,coordinateSystem:r,coordinateOrigin:n,modelMatrix:a,fromCoordinateSystem:s,fromCoordinateOrigin:o}=function(e){let{viewport:t,modelMatrix:i,coordinateOrigin:r}=e,{coordinateSystem:n,fromCoordinateSystem:a,fromCoordinateOrigin:s}=e;return n===oG.DEFAULT&&(n=t.isGeospatial?oG.LNGLAT:oG.CARTESIAN),void 0===a&&(a=n),void 0===s&&(s=r),{viewport:t,coordinateSystem:n,coordinateOrigin:r,modelMatrix:i,fromCoordinateSystem:a,fromCoordinateOrigin:s}}(t),{autoOffset:l=!0}=t,{geospatialOrigin:c=mV,shaderCoordinateOrigin:u=mV,offsetMode:h=!1}=l?o5(i,r,n):{},d=m$(e,{viewport:i,modelMatrix:a,coordinateSystem:s,coordinateOrigin:o,offsetMode:h});if(h){let e=i.projectPosition(c||u);cq.sub(d,d,e)}return d}(e,{viewport:this.internalState.viewport||this.context.viewport,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...t})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return!!this.internalState&&!this.internalState.isAsyncPropLoading()}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){let e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(...e){for(let t of this.getModels())t.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){let{coordinateSystem:e}=this.props;return e===oG.DEFAULT||e===oG.LNGLAT||e===oG.CARTESIAN}onHover(e,t){return!!this.props.onHover&&(this.props.onHover(e,t)||!1)}onClick(e,t){return!!this.props.onClick&&(this.props.onClick(e,t)||!1)}nullPickingColor(){return[0,0,0]}encodePickingColor(e,t=[]){return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){dl(e instanceof Uint8Array);let[t,i,r]=e;return t+256*i+65536*r-1}getNumInstances(){if(Number.isFinite(this.props.numInstances))return this.props.numInstances;if(this.state&&void 0!==this.state.numInstances)return this.state.numInstances;var e,t,i=this.props.data;if(null===(e=i)||"object"!=typeof e)throw Error("count(): argument not an object");if("function"==typeof i.count)return i.count();if(Number.isFinite(i.size))return i.size;if(Number.isFinite(i.length))return i.length;if(null!==(t=i)&&"object"==typeof t&&t.constructor===Object)return Object.keys(i).length;throw Error("count(): argument not a container")}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){return this.getAttributeManager()?.getBounds(["positions","instancePositions"])}getShaders(e){for(let t of(e=mz(e,{disableWarnings:!0,modules:this.context.defaultShaderModules}),this.props.extensions))e=mz(e,t.getShaders.call(this,t));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){let t=this.getAttributeManager(),{dataChanged:i}=e.changeFlags;if(i&&t)if(Array.isArray(i))for(let e of i)t.invalidateAll(e);else t.invalidateAll();if(t){let{props:i}=e,r=this.internalState.hasPickingBuffer,n=Number.isInteger(i.highlightedObjectIndex)||i.pickable||i.extensions.some(e=>e.getNeedsPickingBuffer.call(this,e));if(r!==n){this.internalState.hasPickingBuffer=n;let{pickingColors:e,instancePickingColors:i}=t.attributes,r=e||i;r&&(n&&r.constant&&(r.constant=!1,t.invalidate(r.id)),r.value||n||(r.constant=!0,r.value=[0,0,0]))}}}finalizeState(e){for(let e of this.getModels())e.destroy();let t=this.getAttributeManager();t&&t.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(let t of this.getModels())t.draw(e.renderPass)}getPickingInfo({info:e,mode:t,sourceLayer:i}){let{index:r}=e;return r>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[r]),e}raiseError(e,t){t&&(e=Error(`${t}: ${e.message}`,{cause:e})),this.props.onError?.(e)||this.context?.onError?.(e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return!!this.internalState&&(this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()))}hasUniformTransition(){return this.internalState?.uniformTransitions.active||!1}activateViewport(e){if(!this.internalState)return;let t=this.internalState.viewport;this.internalState.viewport=e,t&&m4({oldViewport:t,viewport:e})||(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){let t=this.getAttributeManager();t&&("all"===e?t.invalidateAll():t.invalidate(e))}updateAttributes(e){let t=!1;for(let i in e)e[i].layoutChanged()&&(t=!0);for(let i of this.getModels())this._setModelAttributes(i,e,t)}_updateAttributes(){let e=this.getAttributeManager();if(!e)return;let t=this.props,i=this.getNumInstances(),r=this.getStartIndices();e.update({data:t.data,numInstances:i,startIndices:r,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this});let n=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(n)}_updateAttributeTransition(){let e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){let{uniformTransitions:e}=this.internalState;if(e.active){let t=e.update(),i=Object.create(this.props);for(let e in t)Object.defineProperty(i,e,{value:t[e]});return i}return this.props}calculateInstancePickingColors(e,{numInstances:t}){if(e.constant)return;let i=Math.floor(m5.length/4);if(this.internalState.usesPickingColorCache=!0,i<t){t>0xffffff&&or.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")();let e=Math.floor((m5=hG.allocate(m5,t,{size:4,copy:!0,maxCount:Math.max(t,0xffffff)})).length/4),r=[0,0,0];for(let t=i;t<e;t++)this.encodePickingColor(t,r),m5[4*t+0]=r[0],m5[4*t+1]=r[1],m5[4*t+2]=r[2],m5[4*t+3]=0}e.value=m5.subarray(0,4*t)}_setModelAttributes(e,t,i=!1){if(!Object.keys(t).length)return;if(i){let i=this.getAttributeManager();e.setBufferLayout(i.getBufferLayouts(e)),t=i.getAttributes()}let r=e.userData?.excludeAttributes||{},n={},a={};for(let i in t){if(r[i])continue;let s=t[i].getValue();for(let r in s){let o=s[r];o instanceof fF.Buffer?t[i].settings.isIndexed?e.setIndexBuffer(o):n[r]=o:o&&(a[r]=o)}}e.setAttributes(n),e.setConstantAttributes(a)}disablePickingIndex(e){let t=this.props.data;if(!("attributes"in t))return void this._disablePickingIndex(e);let{pickingColors:i,instancePickingColors:r}=this.getAttributeManager().attributes,n=i||r,a=n&&t.attributes&&t.attributes[n.id];if(a&&a.value){let i=a.value,r=this.encodePickingColor(e);for(let e=0;e<t.length;e++){let t=n.getVertexOffset(e);i[t]===r[0]&&i[t+1]===r[1]&&i[t+2]===r[2]&&this._disablePickingIndex(e)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){let{pickingColors:t,instancePickingColors:i}=this.getAttributeManager().attributes,r=t||i;if(!r)return;let n=r.getVertexOffset(e),a=r.getVertexOffset(e+1);r.buffer.write(new Uint8Array(a-n),n)}restorePickingColors(){let{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes,i=e||t;i&&(this.internalState.usesPickingColorCache&&i.value.buffer!==m5.buffer&&(i.value=m5.subarray(0,i.value.length)),i.updateSubBuffer({startOffset:0}))}_initialize(){dl(!this.internalState),dl(Number.isFinite(this.props.coordinateSystem)),uk("layer.initialize",this);let e=this._getAttributeManager();for(let t of(e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new m2({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(or.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new mN(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context),this.props.extensions))t.initializeState.call(this,this.context,t);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){uk("layer.matched",this,this===e);let{state:t,internalState:i}=e;this!==e&&(this.internalState=i,this.state=t,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){let e=this.needsUpdate();if(uk("layer.update",this,e),!e)return;let t=this.props,i=this.context,r=this.internalState,n=i.viewport,a=this._updateUniformTransition();r.propsInTransition=a,i.viewport=r.viewport||n,this.props=a;try{let e=this._getUpdateParams(),t=this.getModels();if(i.device)this.updateState(e);else try{this.updateState(e)}catch(e){}for(let t of this.props.extensions)t.updateState.call(this,e,t);this.setNeedsRedraw(),this._updateAttributes();let r=this.getModels()[0]!==t[0];this._postUpdate(e,r)}finally{i.viewport=n,this.props=t,this._clearChangeFlags(),r.needsUpdate=!1,r.resetOldProps()}}_finalize(){for(let e of(uk("layer.finalize",this),this.finalizeState(this.context),this.props.extensions))e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,shaderModuleProps:t=null,uniforms:i={},parameters:r={}}){this._updateAttributeTransition();let n=this.props,a=this.context;this.props=this.internalState.propsInTransition||n;try{t&&this.setShaderModuleProps(t);let{getPolygonOffset:n}=this.props,s=n&&n(i)||[0,0];for(let e of(a.device instanceof fz.WebGLDevice&&a.device.setParametersWebGL({polygonOffset:s}),this.getModels()))"webgpu"===e.device.type?e.setParameters({...e.parameters,...r}):e.setParameters(r);if(a.device instanceof fz.WebGLDevice)a.device.withParametersWebGL(r,()=>{let n={renderPass:e,shaderModuleProps:t,uniforms:i,parameters:r,context:a};for(let e of this.props.extensions)e.draw.call(this,n,e);this.draw(n)});else{let n={renderPass:e,shaderModuleProps:t,uniforms:i,parameters:r,context:a};for(let e of this.props.extensions)e.draw.call(this,n,e);this.draw(n)}}finally{this.props=n}}getChangeFlags(){return this.internalState?.changeFlags}setChangeFlags(e){if(!this.internalState)return;let{changeFlags:t}=this.internalState;for(let i in e)if(e[i]){let r=!1;if("dataChanged"===i){let n=e[i],a=t[i];n&&Array.isArray(a)&&(t.dataChanged=Array.isArray(n)?a.concat(n):n,r=!0)}t[i]||(t[i]=e[i],r=!0),r&&uk("layer.changeFlag",this,i,e)}let i=!!(t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged);t.propsOrDataChanged=i,t.somethingChanged=i||t.viewportChanged||t.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,t){let i,r,n,a=(i=mj({newProps:e,oldProps:t,propTypes:e[ug],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),r=function(e,t){if(null===t)return"oldProps is null, initial diff";let i=!1,{dataComparator:r,_dataDiff:n}=e;return r?r(e.data,t.data)||(i="Data comparator detected a change"):e.data!==t.data&&(i="A new data container was supplied"),i&&n&&(i=n(e.data,t.data)||i),i}(e,t),n=!1,r||(n=function(e,t){if(null===t||"all"in e.updateTriggers&&mF(e,t,"all"))return{all:!0};let i={},r=!1;for(let n in e.updateTriggers)"all"!==n&&mF(e,t,n)&&(i[n]=!0,r=!0);return!!r&&i}(e,t)),{dataChanged:r,propsChanged:i,updateTriggersChanged:n,extensionsChanged:function(e,t){if(null===t)return!0;let i=t.extensions,{extensions:r}=e;if(r===i)return!1;if(!i||!r||r.length!==i.length)return!0;for(let e=0;e<r.length;e++)if(!r[e].equals(i[e]))return!0;return!1}(e,t),transitionsChanged:function(e,t){if(!e.transitions)return!1;let i={},r=e[ug],n=!1;for(let a in e.transitions){let s=r[a],o=s&&s.type;("number"===o||"color"===o||"array"===o)&&mB(e[a],t[a],s)&&(i[a]=!0,n=!0)}return!!n&&i}(e,t)});if(a.updateTriggersChanged)for(let e in a.updateTriggersChanged)a.updateTriggersChanged[e]&&this.invalidateAttribute(e);if(a.transitionsChanged)for(let i in a.transitionsChanged)this.internalState.uniformTransitions.add(i,t[i],e[i],e.transitions?.[i]);return this.setChangeFlags(a)}validateProps(){!function(e){let t=e[ug];for(let i in t){let r=t[i],{validate:n}=r;if(n&&!n(e[i],r))throw Error(`Invalid prop ${i}: ${e[i]}`)}}(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){let t={highlightedObjectColor:e.picked?e.color:null},{highlightColor:i}=this.props;e.picked&&"function"==typeof i&&(t.highlightColor=i(e)),this.setShaderModuleProps({picking:t}),this.setNeedsRedraw()}_getAttributeManager(){let e=this.context;return new mL(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,t){let{props:i,oldProps:r}=e,n=this.state.model;n?.isInstanced&&n.setInstanceCount(this.getNumInstances());let{autoHighlight:a,highlightedObjectIndex:s,highlightColor:o}=i;if(t||r.autoHighlight!==a||r.highlightedObjectIndex!==s||r.highlightColor!==o){let e={};Array.isArray(o)&&(e.highlightColor=o),(t||r.autoHighlight!==a||s!==r.highlightedObjectIndex)&&(e.highlightedObjectColor=Number.isFinite(s)&&s>=0?this.encodePickingColor(s):null),this.setShaderModuleProps({picking:e})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=this.internalState.needsRedraw&&this.id;let i=this.getAttributeManager(),r=!!i&&i.getNeedsRedraw(e);if(t=t||r)for(let e of this.props.extensions)e.onNeedsRedraw.call(this,e);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,t}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}m8.defaultProps=m6,m8.layerName="Layer";let m9=m8,m7={position:"absolute",zIndex:-1};function ve(e){return e&&"object"==typeof e&&"type"in e||!1}let vt=(0,x.createContext)(),vi={mixBlendMode:null};function vr(e){e.redrawReason&&(e.deck._drawLayers(e.redrawReason),e.redrawReason=null)}let vn=x.forwardRef(function(e,t){let[i,r]=(0,x.useState)(0),n=(0,x.useRef)({control:null,version:i,forceUpdate:()=>r(e=>e+1)}).current,a=(0,x.useRef)(null),s=(0,x.useRef)(null),o=(0,x.useMemo)(()=>(function({children:e,layers:t=[],views:i=null}){let r=[],n=[],a={};return x.Children.forEach(function e(t){if("function"==typeof t)return(0,x.createElement)(dt,{},t);if(Array.isArray(t))return t.map(e);if(ve(t)){if(t.type===x.Fragment)return e(t.props.children);fB(t.type,dt)}return t}(e),e=>{if(ve(e)){let t=e.type;if(fB(t,m9)){let i=function(e,t){let i={},r=e.defaultProps||{};for(let e in t)r[e]!==t[e]&&(i[e]=t[e]);return new e(i)}(t,e.props);n.push(i)}else r.push(e);if(fB(t,dt)&&t!==dt&&e.props.id){let i=new t(e.props);a[i.id]=i}}else e&&r.push(e)}),Object.keys(a).length>0&&(Array.isArray(i)?i.forEach(e=>{a[e.id]=e}):i&&(a[i.id]=i),i=Object.values(a)),{layers:t=n.length>0?[...n,...t]:t,children:r,views:i}})(e),[e.layers,e.views,e.children]),l=!0,c=t=>l&&e.viewState?(n.viewStateUpdateRequested=t,null):(n.viewStateUpdateRequested=null,e.onViewStateChange?.(t)),u=t=>{l?n.interactionStateUpdateRequested=t:(n.interactionStateUpdateRequested=null,e.onInteractionStateChange?.(t))},h=(0,x.useMemo)(()=>{let t={widgets:[],...e,style:null,width:"100%",height:"100%",parent:a.current,canvas:s.current,layers:o.layers,views:o.views,onViewStateChange:c,onInteractionStateChange:u};return delete t._customRender,n.deck&&n.deck.setProps(t),t},[e]);(0,x.useEffect)(()=>{var t;let i;return i=new(e.Deck||fN)({...t={...h,parent:a.current,canvas:s.current},_customRender:t.deviceProps?.adapters?.[0]?.type==="webgpu"?void 0:e=>{n.redrawReason=e;let t=i.getViewports();n.lastRenderedViewports!==t?n.forceUpdate():vr(n)}}),n.deck=i,()=>n.deck?.finalize()},[]),fj(()=>{vr(n);let{viewStateUpdateRequested:e,interactionStateUpdateRequested:t}=n;e&&c(e),t&&u(t),n.deck?.isInitialized&&n.deck.redraw("Initial render")}),(0,x.useImperativeHandle)(t,()=>({get deck(){return n.deck},pickObject:e=>n.deck.pickObject(e),pickMultipleObjects:e=>n.deck.pickMultipleObjects(e),pickObjects:e=>n.deck.pickObjects(e)}),[]);let d=n.deck&&n.deck.isInitialized?n.deck.getViewports():void 0,{ContextProvider:f,width:p="100%",height:g="100%",id:v,style:y}=e,{containerStyle:b,canvasStyle:_}=(0,x.useMemo)(()=>(function({width:e,height:t,style:i}){let r={position:"absolute",zIndex:0,left:0,top:0,width:e,height:t},n={left:0,top:0};if(i)for(let e in i)e in vi?n[e]=i[e]:r[e]=i[e];return{containerStyle:r,canvasStyle:n}})({width:p,height:g,style:y}),[p,g,y]);if(!n.viewStateUpdateRequested&&n.lastRenderedViewports===d||n.version!==i){n.lastRenderedViewports=d,n.version=i;let e=function({children:e,deck:t,ContextProvider:i=vt.Provider}){let{viewManager:r}=t||{};if(!r||!r.views.length)return[];let n={},a=r.views[0].id;for(let t of e){let e=a,i=t;ve(t)&&fB(t.type,dt)&&(e=t.props.id||a,i=t.props.children);let s=r.getViewport(e),o=r.getViewState(e);if(s){o.padding=s.padding;let{x:t,y:r,width:a,height:l}=s;i=function e(t,i){if("function"==typeof t)return t(i);if(Array.isArray(t))return t.map(t=>e(t,i));if(ve(t)){var r;if(r=t,r.props?.mapStyle)return i.style=m7,(0,x.cloneElement)(t,i);if(function(e){let t=e.type;return t&&t.deckGLViewProps}(t))return(0,x.cloneElement)(t,i)}return t}(i,{x:t,y:r,width:a,height:l,viewport:s,viewState:o}),n[e]||(n[e]={viewport:s,children:[]}),n[e].children.push(i)}}return Object.keys(n).map(e=>{let{viewport:r,children:a}=n[e],{x:s,y:o,width:l,height:c}=r,u=`view-${e}`,h=(0,x.createElement)("div",{key:u,id:u,style:{position:"absolute",left:s,top:o,width:l,height:c}},...a),d={deck:t,viewport:r,container:t.canvas.offsetParent,eventManager:t.eventManager,onViewStateChange:i=>{i.viewId=e,t._onViewStateChange(i)},widgets:[]},f=`view-${e}-context`;return(0,x.createElement)(i,{key:f,value:d},h)})}({children:o.children,deck:n.deck,ContextProvider:f}),t=(0,x.createElement)("canvas",{key:"canvas",id:v||"deckgl-overlay",ref:s,style:_});n.control=(0,x.createElement)("div",{id:`${v||"deckgl"}-wrapper`,ref:a,style:b},[t,e])}return l=!1,n.control});class va{id;topology;vertexCount;indices;attributes;userData={};constructor(e){const{attributes:t={},indices:i=null,vertexCount:r=null}=e;for(const[r,n]of(this.id=e.id||g5("geometry"),this.topology=e.topology,i&&(this.indices=ArrayBuffer.isView(i)?{value:i,size:1}:i),this.attributes={},Object.entries(t))){const e=ArrayBuffer.isView(n)?{value:n}:n;if(!ArrayBuffer.isView(e.value))throw Error(`${this._print(r)}: must be typed array or object with value as typed array`);if("POSITION"!==r&&"positions"!==r||e.size||(e.size=3),"indices"===r){if(this.indices)throw Error("Multiple indices detected");this.indices=e}else this.attributes[r]=e}this.indices&&void 0!==this.indices.isIndexed&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=r||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,t){return this}_calculateVertexCount(e,t){if(t)return t.value.length;let i=1/0;for(let t of Object.values(e)){let{value:e,size:r,constant:n}=t;!n&&e&&void 0!==r&&r>=1&&(i=Math.min(i,e.length/r))}return i}}let vs=`\
uniform scatterplotUniforms {
  float radiusScale;
  float radiusMinPixels;
  float radiusMaxPixels;
  float lineWidthScale;
  float lineWidthMinPixels;
  float lineWidthMaxPixels;
  float stroked;
  float filled;
  bool antialiasing;
  bool billboard;
  highp int radiusUnits;
  highp int lineWidthUnits;
} scatterplot;
`,vo={name:"scatterplot",vs:vs,fs:vs,source:"",uniformTypes:{radiusScale:"f32",radiusMinPixels:"f32",radiusMaxPixels:"f32",lineWidthScale:"f32",lineWidthMinPixels:"f32",lineWidthMaxPixels:"f32",stroked:"f32",filled:"f32",antialiasing:"f32",billboard:"f32",radiusUnits:"i32",lineWidthUnits:"i32"}},vl=`\
#version 300 es
#define SHADER_NAME scatterplot-layer-vertex-shader
in vec3 positions;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in float instanceRadius;
in float instanceLineWidths;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in vec3 instancePickingColors;
out vec4 vFillColor;
out vec4 vLineColor;
out vec2 unitPosition;
out float innerUnitRadius;
out float outerRadiusPixels;
void main(void) {
geometry.worldPosition = instancePositions;
outerRadiusPixels = clamp(
project_size_to_pixel(scatterplot.radiusScale * instanceRadius, scatterplot.radiusUnits),
scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
);
float lineWidthPixels = clamp(
project_size_to_pixel(scatterplot.lineWidthScale * instanceLineWidths, scatterplot.lineWidthUnits),
scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
);
outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
float edgePadding = scatterplot.antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
unitPosition = edgePadding * positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / outerRadiusPixels;
if (scatterplot.billboard) {
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
vec3 offset = edgePadding * positions * outerRadiusPixels;
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
} else {
vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
}
vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vFillColor, geometry);
vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`,vc=`\
#version 300 es
#define SHADER_NAME scatterplot-layer-fragment-shader
precision highp float;
in vec4 vFillColor;
in vec4 vLineColor;
in vec2 unitPosition;
in float innerUnitRadius;
in float outerRadiusPixels;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition;
float distToCenter = length(unitPosition) * outerRadiusPixels;
float inCircle = scatterplot.antialiasing ?
smoothedge(distToCenter, outerRadiusPixels) :
step(distToCenter, outerRadiusPixels);
if (inCircle == 0.0) {
discard;
}
if (scatterplot.stroked > 0.5) {
float isLine = scatterplot.antialiasing ?
smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
step(innerUnitRadius * outerRadiusPixels, distToCenter);
if (scatterplot.filled > 0.5) {
fragColor = mix(vFillColor, vLineColor, isLine);
} else {
if (isLine == 0.0) {
discard;
}
fragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
}
} else if (scatterplot.filled < 0.5) {
discard;
} else {
fragColor = vFillColor;
}
fragColor.a *= inCircle;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,vu=`\
// Main shaders

struct ScatterplotUniforms {
  radiusScale: f32,
  radiusMinPixels: f32,
  radiusMaxPixels: f32,
  lineWidthScale: f32,
  lineWidthMinPixels: f32,
  lineWidthMaxPixels: f32,
  stroked: f32,
  filled: i32,
  antialiasing: i32,
  billboard: i32,
  radiusUnits: i32,
  lineWidthUnits: i32,
};

struct ConstantAttributeUniforms {
 instancePositions: vec3<f32>,
 instancePositions64Low: vec3<f32>,
 instanceRadius: f32,
 instanceLineWidths: f32,
 instanceFillColors: vec4<f32>,
 instanceLineColors: vec4<f32>,
 instancePickingColors: vec3<f32>,

 instancePositionsConstant: i32,
 instancePositions64LowConstant: i32,
 instanceRadiusConstant: i32,
 instanceLineWidthsConstant: i32,
 instanceFillColorsConstant: i32,
 instanceLineColorsConstant: i32,
 instancePickingColorsConstant: i32
};

@group(0) @binding(2) var<uniform> scatterplot: ScatterplotUniforms;

struct ConstantAttributes {
  instancePositions: vec3<f32>,
  instancePositions64Low: vec3<f32>,
  instanceRadius: f32,
  instanceLineWidths: f32,
  instanceFillColors: vec4<f32>,
  instanceLineColors: vec4<f32>,
  instancePickingColors: vec3<f32>
};

const constants = ConstantAttributes(
  vec3<f32>(0.0),
  vec3<f32>(0.0),
  0.0,
  0.0,
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec4<f32>(0.0, 0.0, 0.0, 1.0),
  vec3<f32>(0.0)
);

struct Attributes {
  @builtin(instance_index) instanceIndex : u32,
  @builtin(vertex_index) vertexIndex : u32,
  @location(0) positions: vec3<f32>,
  @location(1) instancePositions: vec3<f32>,
  @location(2) instancePositions64Low: vec3<f32>,
  @location(3) instanceRadius: f32,
  @location(4) instanceLineWidths: f32,
  @location(5) instanceFillColors: vec4<f32>,
  @location(6) instanceLineColors: vec4<f32>,
  @location(7) instancePickingColors: vec3<f32>
};

struct Varyings {
  @builtin(position) position: vec4<f32>,
  @location(0) vFillColor: vec4<f32>,
  @location(1) vLineColor: vec4<f32>,
  @location(2) unitPosition: vec2<f32>,
  @location(3) innerUnitRadius: f32,
  @location(4) outerRadiusPixels: f32,
};

@vertex
fn vertexMain(attributes: Attributes) -> Varyings {
  var varyings: Varyings;

  // Draw an inline geometry constant array clip space triangle to verify that rendering works.
  // var positions = array<vec2<f32>, 3>(vec2(0.0, 0.5), vec2(-0.5, -0.5), vec2(0.5, -0.5));
  // if (attributes.instanceIndex == 0) {
  //   varyings.position = vec4<f32>(positions[attributes.vertexIndex], 0.0, 1.0);
  //   return varyings;
  // }

  // var geometry: Geometry;
  // geometry.worldPosition = instancePositions;

  // Multiply out radius and clamp to limits
  varyings.outerRadiusPixels = clamp(
    project_unit_size_to_pixel(scatterplot.radiusScale * attributes.instanceRadius, scatterplot.radiusUnits),
    scatterplot.radiusMinPixels, scatterplot.radiusMaxPixels
  );

  // Multiply out line width and clamp to limits
  let lineWidthPixels = clamp(
    project_unit_size_to_pixel(scatterplot.lineWidthScale * attributes.instanceLineWidths, scatterplot.lineWidthUnits),
    scatterplot.lineWidthMinPixels, scatterplot.lineWidthMaxPixels
  );

  // outer radius needs to offset by half stroke width
  varyings.outerRadiusPixels += scatterplot.stroked * lineWidthPixels / 2.0;
  // Expand geometry to accommodate edge smoothing
  let edgePadding = select(
    (varyings.outerRadiusPixels + SMOOTH_EDGE_RADIUS) / varyings.outerRadiusPixels,
    1.0,
    scatterplot.antialiasing != 0
  );

  // position on the containing square in [-1, 1] space
  varyings.unitPosition = edgePadding * attributes.positions.xy;
  geometry.uv = varyings.unitPosition;
  geometry.pickingColor = attributes.instancePickingColors;

  varyings.innerUnitRadius = 1.0 - scatterplot.stroked * lineWidthPixels / varyings.outerRadiusPixels;

  if (scatterplot.billboard != 0) {
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, vec3<f32>(0.0)); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
    let offset = attributes.positions; // * edgePadding * varyings.outerRadiusPixels;
    // DECKGL_FILTER_SIZE(offset, geometry);
    let clipPixels = project_pixel_size_to_clipspace(offset.xy);
    varyings.position.x = clipPixels.x;
    varyings.position.y = clipPixels.y;
  } else {
    let offset = edgePadding * attributes.positions * project_pixel_size_float(varyings.outerRadiusPixels);
    // DECKGL_FILTER_SIZE(offset, geometry);
    varyings.position = project_position_to_clipspace(attributes.instancePositions, attributes.instancePositions64Low, offset); // TODO , geometry.position);
    // DECKGL_FILTER_GL_POSITION(varyings.position, geometry);
  }

  // Apply opacity to instance color, or return instance picking color
  varyings.vFillColor = vec4<f32>(attributes.instanceFillColors.rgb, attributes.instanceFillColors.a * color.opacity);
  // DECKGL_FILTER_COLOR(varyings.vFillColor, geometry);
  varyings.vLineColor = vec4<f32>(attributes.instanceLineColors.rgb, attributes.instanceLineColors.a * color.opacity);
  // DECKGL_FILTER_COLOR(varyings.vLineColor, geometry);

  return varyings;
}

@fragment
fn fragmentMain(varyings: Varyings) -> @location(0) vec4<f32> {
  // var geometry: Geometry;
  // geometry.uv = unitPosition;

  let distToCenter = length(varyings.unitPosition) * varyings.outerRadiusPixels;
  let inCircle = select(
    smoothedge(distToCenter, varyings.outerRadiusPixels),
    step(distToCenter, varyings.outerRadiusPixels),
    scatterplot.antialiasing != 0
  );

  if (inCircle == 0.0) {
    discard;
  }

  var fragColor: vec4<f32>;

  if (scatterplot.stroked != 0) {
    let isLine = select(
      smoothedge(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      step(varyings.innerUnitRadius * varyings.outerRadiusPixels, distToCenter),
      scatterplot.antialiasing != 0
    );

    if (scatterplot.filled != 0) {
      fragColor = mix(varyings.vFillColor, varyings.vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        discard;
      }
      fragColor = vec4<f32>(varyings.vLineColor.rgb, varyings.vLineColor.a * isLine);
    }
  } else if (scatterplot.filled == 0) {
    discard;
  } else {
    fragColor = varyings.vFillColor;
  }

  fragColor.a *= inCircle;
  // DECKGL_FILTER_COLOR(fragColor, geometry);

  // Apply premultiplied alpha as required by transparent canvas
  fragColor = deckgl_premultiplied_alpha(fragColor);

  return fragColor;
  // return vec4<f32>(0, 0, 1, 1);
}
`,vh=[0,0,0,255],vd={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:e=>e.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:vh},getLineColor:{type:"accessor",value:vh},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class vf extends m9{getShaders(){return super.getShaders({vs:vl,fs:vc,source:vu,modules:[ls,aF,uu,vo]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,type:"unorm8",accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState(e){super.updateState(e),e.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){let{radiusUnits:t,radiusScale:i,radiusMinPixels:r,radiusMaxPixels:n,stroked:a,filled:s,billboard:o,antialiasing:l,lineWidthUnits:c,lineWidthScale:u,lineWidthMinPixels:h,lineWidthMaxPixels:d}=this.props,f={stroked:a,filled:s,billboard:o,antialiasing:l,radiusUnits:oX[t],radiusScale:i,radiusMinPixels:r,radiusMaxPixels:n,lineWidthUnits:oX[c],lineWidthScale:u,lineWidthMinPixels:h,lineWidthMaxPixels:d},p=this.state.model;p.shaderInputs.setProps({scatterplot:f}),"webgpu"===this.context.device.type&&(p.instanceCount=this.props.data.length),p.draw(this.context.renderPass)}_getModel(){let e="webgpu"===this.context.device.type?{depthWriteEnabled:!0,depthCompare:"less-equal"}:void 0;return new mh(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new va({topology:"triangle-strip",attributes:{positions:{size:3,value:new Float32Array([-1,-1,0,1,-1,0,-1,1,0,1,1,0])}}}),isInstanced:!0,parameters:e})}}vf.defaultProps=vd,vf.layerName="ScatterplotLayer";let vp=`\
uniform arcUniforms {
  bool greatCircle;
  bool useShortestPath;
  float numSegments;
  float widthScale;
  float widthMinPixels;
  float widthMaxPixels;
  highp int widthUnits;
} arc;
`,vg={name:"arc",vs:vp,fs:vp,uniformTypes:{greatCircle:"f32",useShortestPath:"f32",numSegments:"f32",widthScale:"f32",widthMinPixels:"f32",widthMaxPixels:"f32",widthUnits:"i32"}},vm=`\
#version 300 es
#define SHADER_NAME arc-layer-vertex-shader
in vec4 instanceSourceColors;
in vec4 instanceTargetColors;
in vec3 instanceSourcePositions;
in vec3 instanceSourcePositions64Low;
in vec3 instanceTargetPositions;
in vec3 instanceTargetPositions64Low;
in vec3 instancePickingColors;
in float instanceWidths;
in float instanceHeights;
in float instanceTilts;
out vec4 vColor;
out vec2 uv;
out float isValid;
float paraboloid(float distance, float sourceZ, float targetZ, float ratio) {
float deltaZ = targetZ - sourceZ;
float dh = distance * instanceHeights;
if (dh == 0.0) {
return sourceZ + deltaZ * ratio;
}
float unitZ = deltaZ / dh;
float p2 = unitZ * unitZ + 1.0;
float dir = step(deltaZ, 0.0);
float z0 = mix(sourceZ, targetZ, dir);
float r = mix(ratio, 1.0 - ratio, dir);
return sqrt(r * (p2 - r)) * dh + z0;
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
vec2 dir_screenspace = normalize(line_clipspace * project.viewportSize);
dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
return dir_screenspace * offset_direction * width / 2.0;
}
float getSegmentRatio(float index) {
return smoothstep(0.0, 1.0, index / (arc.numSegments - 1.0));
}
vec3 interpolateFlat(vec3 source, vec3 target, float segmentRatio) {
float distance = length(source.xy - target.xy);
float z = paraboloid(distance, source.z, target.z, segmentRatio);
float tiltAngle = radians(instanceTilts);
vec2 tiltDirection = normalize(target.xy - source.xy);
vec2 tilt = vec2(-tiltDirection.y, tiltDirection.x) * z * sin(tiltAngle);
return vec3(
mix(source.xy, target.xy, segmentRatio) + tilt,
z * cos(tiltAngle)
);
}
float getAngularDist (vec2 source, vec2 target) {
vec2 sourceRadians = radians(source);
vec2 targetRadians = radians(target);
vec2 sin_half_delta = sin((sourceRadians - targetRadians) / 2.0);
vec2 shd_sq = sin_half_delta * sin_half_delta;
float a = shd_sq.y + cos(sourceRadians.y) * cos(targetRadians.y) * shd_sq.x;
return 2.0 * asin(sqrt(a));
}
vec3 interpolateGreatCircle(vec3 source, vec3 target, vec3 source3D, vec3 target3D, float angularDist, float t) {
vec2 lngLat;
if(abs(angularDist - PI) < 0.001) {
lngLat = (1.0 - t) * source.xy + t * target.xy;
} else {
float a = sin((1.0 - t) * angularDist);
float b = sin(t * angularDist);
vec3 p = source3D.yxz * a + target3D.yxz * b;
lngLat = degrees(vec2(atan(p.y, -p.x), atan(p.z, length(p.xy))));
}
float z = paraboloid(angularDist * EARTH_RADIUS, source.z, target.z, t);
return vec3(lngLat, z);
}
void main(void) {
geometry.worldPosition = instanceSourcePositions;
geometry.worldPositionAlt = instanceTargetPositions;
float segmentIndex = float(gl_VertexID / 2);
float segmentSide = mod(float(gl_VertexID), 2.) == 0. ? -1. : 1.;
float segmentRatio = getSegmentRatio(segmentIndex);
float prevSegmentRatio = getSegmentRatio(max(0.0, segmentIndex - 1.0));
float nextSegmentRatio = getSegmentRatio(min(arc.numSegments - 1.0, segmentIndex + 1.0));
float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
isValid = 1.0;
uv = vec2(segmentRatio, segmentSide);
geometry.uv = uv;
geometry.pickingColor = instancePickingColors;
vec4 curr;
vec4 next;
vec3 source;
vec3 target;
if ((arc.greatCircle || project.projectionMode == PROJECTION_MODE_GLOBE) && project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
source = project_globe_(vec3(instanceSourcePositions.xy, 0.0));
target = project_globe_(vec3(instanceTargetPositions.xy, 0.0));
float angularDist = getAngularDist(instanceSourcePositions.xy, instanceTargetPositions.xy);
vec3 prevPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, prevSegmentRatio);
vec3 currPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, segmentRatio);
vec3 nextPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, nextSegmentRatio);
if (abs(currPos.x - prevPos.x) > 180.0) {
indexDir = -1.0;
isValid = 0.0;
} else if (abs(currPos.x - nextPos.x) > 180.0) {
indexDir = 1.0;
isValid = 0.0;
}
nextPos = indexDir < 0.0 ? prevPos : nextPos;
nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;
if (isValid == 0.0) {
nextPos.x += nextPos.x > 0.0 ? -360.0 : 360.0;
float t = ((currPos.x > 0.0 ? 180.0 : -180.0) - currPos.x) / (nextPos.x - currPos.x);
currPos = mix(currPos, nextPos, t);
segmentRatio = mix(segmentRatio, nextSegmentRatio, t);
}
vec3 currPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, segmentRatio);
vec3 nextPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, nextSegmentRatio);
curr = project_position_to_clipspace(currPos, currPos64Low, vec3(0.0), geometry.position);
next = project_position_to_clipspace(nextPos, nextPos64Low, vec3(0.0));
} else {
vec3 source_world = instanceSourcePositions;
vec3 target_world = instanceTargetPositions;
if (arc.useShortestPath) {
source_world.x = mod(source_world.x + 180., 360.0) - 180.;
target_world.x = mod(target_world.x + 180., 360.0) - 180.;
float deltaLng = target_world.x - source_world.x;
if (deltaLng > 180.) target_world.x -= 360.;
if (deltaLng < -180.) source_world.x -= 360.;
}
source = project_position(source_world, instanceSourcePositions64Low);
target = project_position(target_world, instanceTargetPositions64Low);
float antiMeridianX = 0.0;
if (arc.useShortestPath) {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
antiMeridianX = -(project.coordinateOrigin.x + 180.) / 360. * TILE_SIZE;
}
float thresholdRatio = (antiMeridianX - source.x) / (target.x - source.x);
if (prevSegmentRatio <= thresholdRatio && nextSegmentRatio > thresholdRatio) {
isValid = 0.0;
indexDir = sign(segmentRatio - thresholdRatio);
segmentRatio = thresholdRatio;
}
}
nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;
vec3 currPos = interpolateFlat(source, target, segmentRatio);
vec3 nextPos = interpolateFlat(source, target, nextSegmentRatio);
if (arc.useShortestPath) {
if (nextPos.x < antiMeridianX) {
currPos.x += TILE_SIZE;
nextPos.x += TILE_SIZE;
}
}
curr = project_common_position_to_clipspace(vec4(currPos, 1.0));
next = project_common_position_to_clipspace(vec4(nextPos, 1.0));
geometry.position = vec4(currPos, 1.0);
}
float widthPixels = clamp(
project_size_to_pixel(instanceWidths * arc.widthScale, arc.widthUnits),
arc.widthMinPixels, arc.widthMaxPixels
);
vec3 offset = vec3(
getExtrusionOffset((next.xy - curr.xy) * indexDir, segmentSide, widthPixels),
0.0);
DECKGL_FILTER_SIZE(offset, geometry);
DECKGL_FILTER_GL_POSITION(curr, geometry);
gl_Position = curr + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio);
vColor = vec4(color.rgb, color.a * layer.opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,vv=`\
#version 300 es
#define SHADER_NAME arc-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 uv;
in float isValid;
out vec4 fragColor;
void main(void) {
if (isValid == 0.0) {
discard;
}
fragColor = vColor;
geometry.uv = uv;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,vy=[0,0,0,255],vb={getSourcePosition:{type:"accessor",value:e=>e.sourcePosition},getTargetPosition:{type:"accessor",value:e=>e.targetPosition},getSourceColor:{type:"accessor",value:vy},getTargetColor:{type:"accessor",value:vy},getWidth:{type:"accessor",value:1},getHeight:{type:"accessor",value:1},getTilt:{type:"accessor",value:0},greatCircle:!1,numSegments:{type:"number",value:50,min:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}};class vx extends m9{getBounds(){return this.getAttributeManager()?.getBounds(["instanceSourcePositions","instanceTargetPositions"])}getShaders(){return super.getShaders({vs:vm,fs:vv,modules:[ls,uu,vg]})}get wrapLongitude(){return!1}initializeState(){this.getAttributeManager().addInstanced({instanceSourcePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceSourceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getSourceColor",defaultValue:vy},instanceTargetColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getTargetColor",defaultValue:vy},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1},instanceHeights:{size:1,transition:!0,accessor:"getHeight",defaultValue:1},instanceTilts:{size:1,transition:!0,accessor:"getTilt",defaultValue:0}})}updateState(e){super.updateState(e),e.changeFlags.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll())}draw({uniforms:e}){let{widthUnits:t,widthScale:i,widthMinPixels:r,widthMaxPixels:n,greatCircle:a,wrapLongitude:s,numSegments:o}=this.props,l={numSegments:o,widthUnits:oX[t],widthScale:i,widthMinPixels:r,widthMaxPixels:n,greatCircle:a,useShortestPath:s},c=this.state.model;c.shaderInputs.setProps({arc:l}),c.setVertexCount(2*o),c.draw(this.context.renderPass)}_getModel(){return new mh(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),topology:"triangle-strip",isInstanced:!0})}}function v_({data:e}){let{jtbd:t=[]}=e||{},i=(0,x.useMemo)(()=>[{id:"",name:"Validation",lat:40.6928,lon:-74.006,entropy:50,color:[255,165,0]},{id:"",name:"Temporal",lat:40.6978,lon:-73.986,entropy:45.8,color:[255,140,0]},{id:"",name:"Geographic",lat:40.7028,lon:-73.966,entropy:40,color:[255,100,0]},{id:"",name:"Batch",lat:40.7078,lon:-73.946,entropy:32.9,color:[255,69,0]},{id:"",name:"Threshold",lat:40.7128,lon:-73.926,entropy:26.6,color:[220,20,60]},{id:"",name:"Cascading",lat:40.7128+.005,lon:-73.906,entropy:20.4,color:[178,34,52]},{id:"",name:"Complex",lat:40.7228,lon:-73.886,entropy:14.2,color:[139,0,0]},{id:"",name:"Deterministic",lat:40.7278,lon:-73.866,entropy:8,color:[75,0,130]}],[]),r=(0,x.useMemo)(()=>{let e=[];for(let t=0;t<i.length-1;t++){let r=i[t],n=i[t+1];e.push({sourcePosition:[r.lon,r.lat],targetPosition:[n.lon,n.lat],entropy:r.entropy-n.entropy})}return e},[i]),n=(0,x.useMemo)(()=>t.map((e,t)=>({position:[-74.256+.08*t,40.7128+.02+.04*Math.random()],latency:e.latency,reduction:e.reduction,name:e.name,color:[100+20*t,150,200],size:Math.min(100*e.reduction,5e4)})),[t]),a=[new vx({id:"operator-flow",data:r,getSourcePosition:e=>e.sourcePosition,getTargetPosition:e=>e.targetPosition,getSourceColor:e=>[100,150,255,200],getTargetColor:e=>[100,100,255,100],getWidth:e=>2*e.entropy,widthScale:20,widthMinPixels:2,interactive:!0,pickable:!0}),new vf({id:"operators",data:i,getPosition:e=>[e.lon,e.lat],getRadius:e=>1e3*Math.sqrt(e.entropy),getColor:e=>e.color,radiusScale:6,radiusMinPixels:15,radiusMaxPixels:40,interactive:!0,pickable:!0,autoHighlight:!0,onHover:e=>{e.object?document.body.style.cursor="pointer":document.body.style.cursor="default"}}),new vf({id:"jtbd-scenarios",data:n,getPosition:e=>e.position,getRadius:e=>e.size,getColor:e=>e.color,radiusScale:10,radiusMinPixels:8,radiusMaxPixels:30,interactive:!0,pickable:!0,autoHighlight:!0})];return(0,b.jsxs)("div",{className:"card space-y-4 h-96",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold text-cyan-400",children:"Geographic Operator Distribution"}),(0,b.jsx)("p",{className:"text-sm text-slate-400",children:"Information cascade across 8 operators with JTBD scenario density. Arc width represents entropy reduction per operator."})]}),(0,b.jsxs)("div",{className:"relative h-96 rounded border border-slate-700 overflow-hidden bg-slate-950",children:[(0,b.jsx)(vn,{layers:a,initialViewState:{longitude:-74.006,latitude:40.7128,zoom:10,pitch:45,bearing:0},controller:!0,onViewStateChange:({viewState:e})=>{}}),(0,b.jsxs)("div",{className:"absolute bottom-4 left-4 bg-slate-900/80 border border-slate-700 rounded p-3 text-xs text-slate-300 backdrop-blur",children:[(0,b.jsx)("div",{className:"font-semibold text-cyan-400 mb-2",children:"Map Controls"}),(0,b.jsx)("div",{children:" Drag to rotate |  Scroll to zoom | Right-click drag to tilt"}),(0,b.jsxs)("div",{className:"mt-2 space-y-1",children:[(0,b.jsx)("div",{children:" Orange: Operators - (high entropy)"}),(0,b.jsx)("div",{children:" Red: Operators - (medium entropy)"}),(0,b.jsx)("div",{children:" Purple:  (deterministic output)"}),(0,b.jsx)("div",{children:" Blue: JTBD scenarios (density heatmap)"})]})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-xs",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("div",{className:"font-semibold text-cyan-400",children:"Operator Cascade"}),i.slice(0,4).map(e=>(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:`rgb(${e.color.join(",")})`}}),(0,b.jsxs)("span",{className:"text-slate-300",children:[e.id,": ",e.name]})]},e.id))]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("div",{className:"font-semibold text-cyan-400",children:"Entropy Levels"}),i.slice(4).map(e=>(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:`rgb(${e.color.join(",")})`}}),(0,b.jsxs)("span",{className:"text-slate-300",children:[e.id,": ",e.entropy.toFixed(1)," nats"]})]},e.id))]})]})]})}function vw(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=Array(t);i<t;i++)r[i]=e[i];return r}function vk(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function vE(e,t,i){return t&&function(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,vC(r.key),r)}}(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function vT(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=vI(e))||t){i&&(e=i);var r=0,n=function(){};return{s:n,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:n}}throw TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,s=!0,o=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return s=e.done,e},e:function(e){o=!0,a=e},f:function(){try{s||null==i.return||i.return()}finally{if(o)throw a}}}}function vP(e,t,i){return(t=vC(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function vS(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var i=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=i){var r,n,a,s,o=[],l=!0,c=!1;try{if(a=(i=i.call(e)).next,0===t){if(Object(i)!==i)return;l=!1}else for(;!(l=(r=a.call(i)).done)&&(o.push(r.value),o.length!==t);l=!0);}catch(e){c=!0,n=e}finally{try{if(!l&&null!=i.return&&(s=i.return(),Object(s)!==s))return}finally{if(c)throw n}}return o}}(e,t)||vI(e,t)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function vM(e){return function(e){if(Array.isArray(e))return vw(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||vI(e)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function vC(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var r=i.call(e,t);if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"==typeof t?t:t+""}function vA(e){return(vA="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function vI(e,t){if(e){if("string"==typeof e)return vw(e,t);var i=({}).toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?vw(e,t):void 0}}vx.layerName="ArcLayer",vx.defaultProps=vb;var vL="undefined"==typeof window?null:window,vD=vL?vL.navigator:null;vL&&vL.document;var vO=vA(""),vR=vA({}),vN=vA(function(){}),vj="undefined"==typeof HTMLElement?"undefined":vA(HTMLElement),vB=function(e){return e&&e.instanceString&&vz(e.instanceString)?e.instanceString():null},vF=function(e){return null!=e&&vA(e)==vO},vz=function(e){return null!=e&&vA(e)===vN},vV=function(e){return!vH(e)&&(Array.isArray?Array.isArray(e):null!=e&&e instanceof Array)},vU=function(e){return null!=e&&vA(e)===vR&&!vV(e)&&e.constructor===Object},v$=function(e){return null!=e&&vA(e)===vA(1)&&!isNaN(e)},vW=function(e){if("undefined"!==vj)return null!=e&&e instanceof HTMLElement},vH=function(e){return vq(e)||vG(e)},vq=function(e){return"collection"===vB(e)&&e._private.single},vG=function(e){return"collection"===vB(e)&&!e._private.single},vY=function(e){return"core"===vB(e)},vX=function(e){return"stylesheet"===vB(e)},vK=function(e){return null==e||!!(""===e||e.match(/^\s+$/))},vZ=function(e){return null!=e&&vA(e)===vR&&vz(e.then)},vJ=function(e,t){t||(t=function(){if(1==arguments.length)return arguments[0];if(0==arguments.length)return"undefined";for(var e=[],t=0;t<arguments.length;t++)e.push(arguments[t]);return e.join("$")});var i=function(){var r,n=arguments,a=t.apply(this,n),s=i.cache;return(r=s[a])||(r=s[a]=e.apply(this,n)),r};return i.cache={},i},vQ=vJ(function(e){return e.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()})}),v0=vJ(function(e){return e.replace(/(-\w)/g,function(e){return e[1].toUpperCase()})}),v1=vJ(function(e,t){return e+t[0].toUpperCase()+t.substring(1)},function(e,t){return e+"$"+t}),v2=function(e){return vK(e)?e:e.charAt(0).toUpperCase()+e.substring(1)},v3=function(e,t){return e.slice(-1*t.length)===t},v4="(?:[-+]?(?:(?:\\d+|\\d*\\.\\d+)(?:[Ee][+-]?\\d+)?))",v5="rgb[a]?\\(("+v4+"[%]?)\\s*,\\s*("+v4+"[%]?)\\s*,\\s*("+v4+"[%]?)(?:\\s*,\\s*("+v4+"))?\\)",v6="rgb[a]?\\((?:"+v4+"[%]?)\\s*,\\s*(?:"+v4+"[%]?)\\s*,\\s*(?:"+v4+"[%]?)(?:\\s*,\\s*(?:"+v4+"))?\\)",v8="hsl[a]?\\(("+v4+")\\s*,\\s*("+v4+"[%])\\s*,\\s*("+v4+"[%])(?:\\s*,\\s*("+v4+"))?\\)",v9="hsl[a]?\\((?:"+v4+")\\s*,\\s*(?:"+v4+"[%])\\s*,\\s*(?:"+v4+"[%])(?:\\s*,\\s*(?:"+v4+"))?\\)",v7=function(e,t){return e<t?-1:+(e>t)},ye=null!=Object.assign?Object.assign.bind(Object):function(e){for(var t=arguments,i=1;i<t.length;i++){var r=t[i];if(null!=r)for(var n=Object.keys(r),a=0;a<n.length;a++){var s=n[a];e[s]=r[s]}}return e},yt=function(e){if((4===e.length||7===e.length)&&"#"===e[0]){var t,i,r;return 4===e.length?(t=parseInt(e[1]+e[1],16),i=parseInt(e[2]+e[2],16),r=parseInt(e[3]+e[3],16)):(t=parseInt(e[1]+e[2],16),i=parseInt(e[3]+e[4],16),r=parseInt(e[5]+e[6],16)),[t,i,r]}},yi=function(e){function t(e,t,i){return(i<0&&(i+=1),i>1&&(i-=1),i<1/6)?e+(t-e)*6*i:i<.5?t:i<2/3?e+(t-e)*(2/3-i)*6:e}var i,r,n,a,s,o,l,c,u=RegExp("^"+v8+"$").exec(e);if(u){if((r=parseInt(u[1]))<0?r=(360- -1*r%360)%360:r>360&&(r%=360),r/=360,(n=parseFloat(u[2]))<0||n>100||(n/=100,(a=parseFloat(u[3]))<0||a>100)||(a/=100,void 0!==(s=u[4])&&((s=parseFloat(s))<0||s>1)))return;if(0===n)o=l=c=Math.round(255*a);else{var h=a<.5?a*(1+n):a+n-a*n,d=2*a-h;o=Math.round(255*t(d,h,r+1/3)),l=Math.round(255*t(d,h,r)),c=Math.round(255*t(d,h,r-1/3))}i=[o,l,c,s]}return i},yr=function(e){var t,i=RegExp("^"+v5+"$").exec(e);if(i){t=[];for(var r=[],n=1;n<=3;n++){var a=i[n];if("%"===a[a.length-1]&&(r[n]=!0),a=parseFloat(a),r[n]&&(a=a/100*255),a<0||a>255)return;t.push(Math.floor(a))}var s=r[1]||r[2]||r[3],o=r[1]&&r[2]&&r[3];if(s&&!o)return;var l=i[4];if(void 0!==l){if((l=parseFloat(l))<0||l>1)return;t.push(l)}}return t},yn=function(e){return(vV(e)?e:null)||ya[e.toLowerCase()]||yt(e)||yr(e)||yi(e)},ya={transparent:[0,0,0,0],aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],grey:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},ys=function(e){for(var t=e.map,i=e.keys,r=i.length,n=0;n<r;n++){var a=i[n];if(vU(a))throw Error("Tried to set map with object key");n<i.length-1?(null==t[a]&&(t[a]={}),t=t[a]):t[a]=e.value}},yo=function(e){for(var t=e.map,i=e.keys,r=i.length,n=0;n<r;n++){var a=i[n];if(vU(a))throw Error("Tried to get map with object key");if(null==(t=t[a]))break}return t},yl="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:e.g;function yc(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function yu(){return Ey?Ev:(Ey=1,Ev=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)})}function yh(){if(Ew)return E_;Ew=1;var e=Ex?Eb:(Ex=1,Eb="object"==typeof yl&&yl&&yl.Object===Object&&yl),t="object"==typeof self&&self&&self.Object===Object&&self;return E_=e||t||Function("return this")()}function yd(){return EA?EC:(EA=1,EC=yh().Symbol)}function yf(){if(EN)return ER;EN=1;var e=yd(),t=function(){if(EL)return EI;EL=1;var e=yd(),t=Object.prototype,i=t.hasOwnProperty,r=t.toString,n=e?e.toStringTag:void 0;return EI=function(e){var t=i.call(e,n),a=e[n];try{e[n]=void 0;var s=!0}catch(e){}var o=r.call(e);return s&&(t?e[n]=a:delete e[n]),o}}(),i=function(){if(EO)return ED;EO=1;var e=Object.prototype.toString;return ED=function(t){return e.call(t)}}(),r=e?e.toStringTag:void 0;return ER=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":r&&r in Object(e)?t(e):i(e)}}function yp(){if(Ez)return EF;Ez=1;var e=yf(),t=EB?Ej:(EB=1,Ej=function(e){return null!=e&&"object"==typeof e});return EF=function(i){return"symbol"==typeof i||t(i)&&"[object Symbol]"==e(i)}}var yg=yc(function(){if(EW)return E$;EW=1;var e=yu(),t=function(){if(EE)return Ek;EE=1;var e=yh();return Ek=function(){return e.Date.now()}}(),i=function(){if(EU)return EV;EU=1;var e=function(){if(EM)return ES;EM=1;var e=function(){if(EP)return ET;EP=1;var e=/\s/;return ET=function(t){for(var i=t.length;i--&&e.test(t.charAt(i)););return i}}(),t=/^\s+/;return ES=function(i){return i?i.slice(0,e(i)+1).replace(t,""):i}}(),t=yu(),i=yp(),r=0/0,n=/^[-+]0x[0-9a-f]+$/i,a=/^0b[01]+$/i,s=/^0o[0-7]+$/i,o=parseInt;return EV=function(l){if("number"==typeof l)return l;if(i(l))return r;if(t(l)){var c="function"==typeof l.valueOf?l.valueOf():l;l=t(c)?c+"":c}if("string"!=typeof l)return 0===l?l:+l;l=e(l);var u=a.test(l);return u||s.test(l)?o(l.slice(2),u?2:8):n.test(l)?r:+l}}(),r=Math.max,n=Math.min;return E$=function(a,s,o){var l,c,u,h,d,f,p=0,g=!1,v=!1,y=!0;if("function"!=typeof a)throw TypeError("Expected a function");function b(e){var t=l,i=c;return l=c=void 0,p=e,h=a.apply(i,t)}function x(e){var t=e-f,i=e-p;return void 0===f||t>=s||t<0||v&&i>=u}function _(){var e,i,r,a=t();if(x(a))return w(a);d=setTimeout(_,(e=a-f,i=a-p,r=s-e,v?n(r,u-i):r))}function w(e){return(d=void 0,y&&l)?b(e):(l=c=void 0,h)}function k(){var e,i=t(),r=x(i);if(l=arguments,c=this,f=i,r){if(void 0===d)return p=e=f,d=setTimeout(_,s),g?b(e):h;if(v)return clearTimeout(d),d=setTimeout(_,s),b(f)}return void 0===d&&(d=setTimeout(_,s)),h}return s=i(s)||0,e(o)&&(g=!!o.leading,u=(v="maxWait"in o)?r(i(o.maxWait)||0,s):u,y="trailing"in o?!!o.trailing:y),k.cancel=function(){void 0!==d&&clearTimeout(d),p=0,l=f=c=d=void 0},k.flush=function(){return void 0===d?h:w(t())},k}}()),ym=vL?vL.performance:null,yv=ym&&ym.now?function(){return ym.now()}:function(){return Date.now()},yy=function(){if(vL){if(vL.requestAnimationFrame)return function(e){vL.requestAnimationFrame(e)};else if(vL.mozRequestAnimationFrame)return function(e){vL.mozRequestAnimationFrame(e)};else if(vL.webkitRequestAnimationFrame)return function(e){vL.webkitRequestAnimationFrame(e)};else if(vL.msRequestAnimationFrame)return function(e){vL.msRequestAnimationFrame(e)}}return function(e){e&&setTimeout(function(){e(yv())},1e3/60)}}(),yb=function(e){return yy(e)},yx=function(e){for(var t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9261,r=i;!(t=e.next()).done;)r=65599*r+t.value|0;return r},y_=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:9261;return 65599*t+e|0},yw=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5381;return(t<<5)+t+e|0},yk=function(e){return 2097152*e[0]+e[1]},yE=function(e,t){return[y_(e[0],t[0]),yw(e[1],t[1])]},yT=function(e,t){var i={value:0,done:!1},r=0,n=e.length;return yx({next:function(){return r<n?i.value=e[r++]:i.done=!0,i}},t)},yP=function(e,t){var i={value:0,done:!1},r=0,n=e.length;return yx({next:function(){return r<n?i.value=e.charCodeAt(r++):i.done=!0,i}},t)},yS=function(){return yM(arguments)},yM=function(e){for(var t,i=0;i<e.length;i++){var r=e[i];t=0===i?yP(r):yP(r,t)}return t},yC=!0,yA=null!=console.warn,yI=null!=console.trace,yL=Number.MAX_SAFE_INTEGER||0x1fffffffffffff,yD=function(){return!0},yO=function(){return!1},yR=function(){return 0},yN=function(){},yj=function(e){throw Error(e)},yB=function(e){if(void 0===e)return yC;yC=!!e},yF=function(e){yB()&&(yA?console.warn(e):(console.log(e),yI&&console.trace()))},yz=function(e){return null==e?e:vV(e)?e.slice():vU(e)?ye({},e):e},yV=function(e,t){for(t=e="";e++<36;t+=51*e&52?(15^e?8^Math.random()*(20^e?16:4):4).toString(16):"-");return t},yU={},y$=function(){return yU},yW=function(e){var t=Object.keys(e);return function(i){for(var r={},n=0;n<t.length;n++){var a=t[n],s=null==i?void 0:i[a];r[a]=void 0===s?e[a]:s}return r}},yH=function(e,t,i){for(var r=e.length-1;r>=0;r--)e[r]===t&&e.splice(r,1)},yq=function(e){e.splice(0,e.length)},yG=function(e,t){for(var i=0;i<t.length;i++){var r=t[i];e.push(r)}},yY=function(e,t,i){return i&&(t=v1(i,t)),e[t]},yX=function(e,t,i,r){i&&(t=v1(i,t)),e[t]=r},yK=vE(function e(){vk(this,e),this._obj={}},[{key:"set",value:function(e,t){return this._obj[e]=t,this}},{key:"delete",value:function(e){return this._obj[e]=void 0,this}},{key:"clear",value:function(){this._obj={}}},{key:"has",value:function(e){return void 0!==this._obj[e]}},{key:"get",value:function(e){return this._obj[e]}}]),yZ="undefined"!=typeof Map?Map:yK,yJ=vE(function e(t){if(vk(this,e),this._obj=Object.create(null),this.size=0,null!=t){var i;i=null!=t.instanceString&&t.instanceString()===this.instanceString()?t.toArray():t;for(var r=0;r<i.length;r++)this.add(i[r])}},[{key:"instanceString",value:function(){return"set"}},{key:"add",value:function(e){var t=this._obj;1!==t[e]&&(t[e]=1,this.size++)}},{key:"delete",value:function(e){var t=this._obj;1===t[e]&&(t[e]=0,this.size--)}},{key:"clear",value:function(){this._obj=Object.create(null)}},{key:"has",value:function(e){return 1===this._obj[e]}},{key:"toArray",value:function(){var e=this;return Object.keys(this._obj).filter(function(t){return e.has(t)})}},{key:"forEach",value:function(e,t){return this.toArray().forEach(e,t)}}]),yQ=("undefined"==typeof Set?"undefined":vA(Set))!=="undefined"?Set:yJ,y0=function(e,t){var i=!(arguments.length>2)||void 0===arguments[2]||arguments[2];if(void 0===e||void 0===t||!vY(e))return void yj("An element must have a core reference and parameters set");var r=t.group;if(null==r&&(r=t.data&&null!=t.data.source&&null!=t.data.target?"edges":"nodes"),"nodes"!==r&&"edges"!==r)return void yj("An element must be of type `nodes` or `edges`; you specified `"+r+"`");this.length=1,this[0]=this;var n=this._private={cy:e,single:!0,data:t.data||{},position:t.position||{x:0,y:0},autoWidth:void 0,autoHeight:void 0,autoPadding:void 0,compoundBoundsClean:!1,listeners:[],group:r,style:{},rstyle:{},styleCxts:[],styleKeys:{},removed:!0,selected:!!t.selected,selectable:void 0===t.selectable||!!t.selectable,locked:!!t.locked,grabbed:!1,grabbable:void 0===t.grabbable||!!t.grabbable,pannable:void 0===t.pannable?"edges"===r:!!t.pannable,active:!1,classes:new yQ,animation:{current:[],queue:[]},rscratch:{},scratch:t.scratch||{},edges:[],children:[],parent:t.parent&&t.parent.isNode()?t.parent:null,traversalCache:{},backgrounding:!1,bbCache:null,bbCacheShift:{x:0,y:0},bodyBounds:null,overlayBounds:null,labelBounds:{all:null,source:null,target:null,main:null},arrowBounds:{source:null,target:null,"mid-source":null,"mid-target":null}};if(null==n.position.x&&(n.position.x=0),null==n.position.y&&(n.position.y=0),t.renderedPosition){var a=t.renderedPosition,s=e.pan(),o=e.zoom();n.position={x:(a.x-s.x)/o,y:(a.y-s.y)/o}}var l=[];vV(t.classes)?l=t.classes:vF(t.classes)&&(l=t.classes.split(/\s+/));for(var c=0,u=l.length;c<u;c++){var h=l[c];h&&""!==h&&n.classes.add(h)}this.createEmitter(),(void 0===i||i)&&this.restore();var d=t.style||t.css;d&&(yF("Setting a `style` bypass at element creation should be done only when absolutely necessary.  Try to use the stylesheet instead."),this.style(d))},y1=function(e){return e={bfs:e.bfs||!e.dfs,dfs:e.dfs||!e.bfs},function(t,i,r){vU(t)&&!vH(t)&&(t=(n=t).roots||n.root,i=n.visit,r=n.directed),r=2!=arguments.length||vz(i)?r:i,i=vz(i)?i:function(){};for(var n,a,s,o=this._private.cy,l=t=vF(t)?this.filter(t):t,c=[],u=[],h={},d={},f={},p=0,g=this.byGroup(),v=g.nodes,y=g.edges,b=0;b<l.length;b++){var x=l[b],_=x.id();x.isNode()&&(c.unshift(x),e.bfs&&(f[_]=!0,u.push(x)),d[_]=0)}for(;0!==c.length&&(0===(s=function(){var t,n=e.bfs?c.shift():c.pop(),s=n.id();if(e.dfs){if(f[s])return 0;f[s]=!0,u.push(n)}var o=d[s],l=h[s],g=null!=l?l.source():null,b=null!=l?l.target():null,x=null==l?void 0:n.same(g)?b[0]:g[0];if(!0===(t=i(n,l,x,p++,o)))return a=n,1;if(!1===t)return 1;for(var _=n.connectedEdges().filter(function(e){return(!r||e.source().same(n))&&y.has(e)}),w=0;w<_.length;w++){var k=_[w],E=k.connectedNodes().filter(function(e){return!e.same(n)&&v.has(e)}),T=E.id();0===E.length||f[T]||(E=E[0],c.push(E),e.bfs&&(f[T]=!0,u.push(E)),h[T]=k,d[T]=d[s]+1)}}())||1!==s););for(var w=o.collection(),k=0;k<u.length;k++){var E=u[k],T=h[E.id()];null!=T&&w.push(T),w.push(E)}return{path:o.collection(w),found:o.collection(a)}}},y2={breadthFirstSearch:y1({bfs:!0}),depthFirstSearch:y1({dfs:!0})};y2.bfs=y2.breadthFirstSearch,y2.dfs=y2.depthFirstSearch;var y3={exports:{}},y4=y3.exports,y5=yc(EG?Eq:(EG=1,Eq=function(){return EH?y3.exports:(EH=1,(function(){var e,t,i,r,n,a,s,o,l,c,u,h,d,f,p;i=Math.floor,c=Math.min,t=function(e,t){return e<t?-1:+(e>t)},l=function(e,r,n,a,s){var o;if(null==n&&(n=0),null==s&&(s=t),n<0)throw Error("lo must be non-negative");for(null==a&&(a=e.length);n<a;)0>s(r,e[o=i((n+a)/2)])?a=o:n=o+1;return[].splice.apply(e,[n,n-n].concat(r)),r},a=function(e,i,r){return null==r&&(r=t),e.push(i),f(e,0,e.length-1,r)},n=function(e,i){var r,n;return null==i&&(i=t),r=e.pop(),e.length?(n=e[0],e[0]=r,p(e,0,i)):n=r,n},o=function(e,i,r){var n;return null==r&&(r=t),n=e[0],e[0]=i,p(e,0,r),n},s=function(e,i,r){var n;return null==r&&(r=t),e.length&&0>r(e[0],i)&&(i=(n=[e[0],i])[0],e[0]=n[1],p(e,0,r)),i},r=function(e,r){var n,a,s,o,l,c;for(null==r&&(r=t),o=(function(){c=[];for(var t=0,r=i(e.length/2);0<=r?t<r:t>r;0<=r?t++:t--)c.push(t);return c}).apply(this).reverse(),l=[],a=0,s=o.length;a<s;a++)n=o[a],l.push(p(e,n,r));return l},d=function(e,i,r){var n;if(null==r&&(r=t),-1!==(n=e.indexOf(i)))return f(e,0,n,r),p(e,n,r)},u=function(e,i,n){var a,o,l,c;if(null==n&&(n=t),!(a=e.slice(0,i)).length)return a;for(r(a,n),o=0,l=(c=e.slice(i)).length;o<l;o++)s(a,c[o],n);return a.sort(n).reverse()},h=function(e,i,a){var s,o,u,h,d,f,p,g,v;if(null==a&&(a=t),10*i<=e.length){if(!(u=e.slice(0,i).sort(a)).length)return u;for(h=0,o=u[u.length-1],f=(p=e.slice(i)).length;h<f;h++)0>a(s=p[h],o)&&(l(u,s,0,null,a),u.pop(),o=u[u.length-1]);return u}for(r(e,a),v=[],d=0,g=c(i,e.length);0<=g?d<g:d>g;0<=g?++d:--d)v.push(n(e,a));return v},f=function(e,i,r,n){var a,s,o;for(null==n&&(n=t),a=e[r];r>i;){if(0>n(a,s=e[o=r-1>>1])){e[r]=s,r=o;continue}break}return e[r]=a},p=function(e,i,r){var n,a,s,o,l;for(null==r&&(r=t),a=e.length,l=i,s=e[i],n=2*i+1;n<a;)(o=n+1)<a&&!(0>r(e[n],e[o]))&&(n=o),e[i]=e[n],n=2*(i=n)+1;return e[i]=s,f(e,l,i,r)},e=function(){function e(e){this.cmp=null!=e?e:t,this.nodes=[]}return e.push=a,e.pop=n,e.replace=o,e.pushpop=s,e.heapify=r,e.updateItem=d,e.nlargest=u,e.nsmallest=h,e.prototype.push=function(e){return a(this.nodes,e,this.cmp)},e.prototype.pop=function(){return n(this.nodes,this.cmp)},e.prototype.peek=function(){return this.nodes[0]},e.prototype.contains=function(e){return -1!==this.nodes.indexOf(e)},e.prototype.replace=function(e){return o(this.nodes,e,this.cmp)},e.prototype.pushpop=function(e){return s(this.nodes,e,this.cmp)},e.prototype.heapify=function(){return r(this.nodes,this.cmp)},e.prototype.updateItem=function(e){return d(this.nodes,e,this.cmp)},e.prototype.clear=function(){return this.nodes=[]},e.prototype.empty=function(){return 0===this.nodes.length},e.prototype.size=function(){return this.nodes.length},e.prototype.clone=function(){var t;return(t=new e).nodes=this.nodes.slice(0),t},e.prototype.toArray=function(){return this.nodes.slice(0)},e.prototype.insert=e.prototype.push,e.prototype.top=e.prototype.peek,e.prototype.front=e.prototype.peek,e.prototype.has=e.prototype.contains,e.prototype.copy=e.prototype.clone,e}(),y3.exports=e}).call(y4),y3.exports)}())),y6=yW({root:null,weight:function(e){return 1},directed:!1}),y8=yW({root:null,goal:null,weight:function(e){return 1},heuristic:function(e){return 0},directed:!1}),y9=yW({weight:function(e){return 1},directed:!1}),y7=yW({weight:function(e){return 1},directed:!1,root:null}),be=Math.sqrt(2),bt=function(e,t,i){0===i.length&&yj("Karger-Stein must be run on a connected (sub)graph");for(var r=i[e],n=r[1],a=r[2],s=t[n],o=t[a],l=i.length-1;l>=0;l--){var c=i[l],u=c[1],h=c[2];(t[u]===s&&t[h]===o||t[u]===o&&t[h]===s)&&i.splice(l,1)}for(var d=0;d<i.length;d++){var f=i[d];f[1]===o?(i[d]=f.slice(),i[d][1]=s):f[2]===o&&(i[d]=f.slice(),i[d][2]=s)}for(var p=0;p<t.length;p++)t[p]===o&&(t[p]=s);return i},bi=function(e,t,i,r){for(;i>r;)t=bt(Math.floor(Math.random()*t.length),e,t),i--;return t},br=function(e,t,i){return{x:e.x*t+i.x,y:e.y*t+i.y}},bn=function(e,t,i){return{x:(e.x-i.x)/t,y:(e.y-i.y)/t}},ba=function(e){return{x:e[0],y:e[1]}},bs=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.length,r=1/0,n=t;n<i;n++){var a=e[n];isFinite(a)&&(r=Math.min(a,r))}return r},bo=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.length,r=-1/0,n=t;n<i;n++){var a=e[n];isFinite(a)&&(r=Math.max(a,r))}return r},bl=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.length,r=0,n=0,a=t;a<i;a++){var s=e[a];isFinite(s)&&(r+=s,n++)}return r/n},bc=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.length,r=!(arguments.length>3)||void 0===arguments[3]||arguments[3],n=!(arguments.length>4)||void 0===arguments[4]||arguments[4],a=!(arguments.length>5)||void 0===arguments[5]||arguments[5];r?e=e.slice(t,i):(i<e.length&&e.splice(i,e.length-i),t>0&&e.splice(0,t));for(var s=0,o=e.length-1;o>=0;o--){var l=e[o];a?!isFinite(l)&&(e[o]=-1/0,s++):e.splice(o,1)}n&&e.sort(function(e,t){return e-t});var c=e.length,u=Math.floor(c/2);return c%2!=0?e[u+1+s]:(e[u-1+s]+e[u+s])/2},bu=function(e,t){return Math.atan2(t,e)-Math.PI/2},bh=Math.log2||function(e){return Math.log(e)/Math.log(2)},bd=function(e){return e>0?1:e<0?-1:0},bf=function(e,t){return Math.sqrt(bp(e,t))},bp=function(e,t){var i=t.x-e.x,r=t.y-e.y;return i*i+r*r},bg=function(e){for(var t=e.length,i=0,r=0;r<t;r++)i+=e[r];for(var n=0;n<t;n++)e[n]=e[n]/i;return e},bm=function(e,t,i,r){return(1-r)*(1-r)*e+2*(1-r)*r*t+r*r*i},bv=function(e,t,i,r){return{x:bm(e.x,t.x,i.x,r),y:bm(e.y,t.y,i.y,r)}},by=function(e,t,i,r){var n={x:t.x-e.x,y:t.y-e.y},a=bf(e,t),s={x:n.x/a,y:n.y/a};return i=null==i?0:i,r=null!=r?r:i*a,{x:e.x+s.x*r,y:e.y+s.y*r}},bb=function(e,t,i){return Math.max(e,Math.min(i,t))},bx=function(e){if(null==e)return{x1:1/0,y1:1/0,x2:-1/0,y2:-1/0,w:0,h:0};if(null!=e.x1&&null!=e.y1){if(null!=e.x2&&null!=e.y2&&e.x2>=e.x1&&e.y2>=e.y1)return{x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,w:e.x2-e.x1,h:e.y2-e.y1};else if(null!=e.w&&null!=e.h&&e.w>=0&&e.h>=0)return{x1:e.x1,y1:e.y1,x2:e.x1+e.w,y2:e.y1+e.h,w:e.w,h:e.h}}},b_=function(e){e.x1=1/0,e.y1=1/0,e.x2=-1/0,e.y2=-1/0,e.w=0,e.h=0},bw=function(e,t){e.x1=Math.min(e.x1,t.x1),e.x2=Math.max(e.x2,t.x2),e.w=e.x2-e.x1,e.y1=Math.min(e.y1,t.y1),e.y2=Math.max(e.y2,t.y2),e.h=e.y2-e.y1},bk=function(e,t,i){e.x1=Math.min(e.x1,t),e.x2=Math.max(e.x2,t),e.w=e.x2-e.x1,e.y1=Math.min(e.y1,i),e.y2=Math.max(e.y2,i),e.h=e.y2-e.y1},bE=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e.x1-=t,e.x2+=t,e.y1-=t,e.y2+=t,e.w=e.x2-e.x1,e.h=e.y2-e.y1,e},bT=function(e){var t,i,r,n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0];if(1===a.length)t=i=r=n=a[0];else if(2===a.length)t=r=a[0],n=i=a[1];else if(4===a.length){var s=vS(a,4);t=s[0],i=s[1],r=s[2],n=s[3]}return e.x1-=n,e.x2+=i,e.y1-=t,e.y2+=r,e.w=e.x2-e.x1,e.h=e.y2-e.y1,e},bP=function(e,t){e.x1=t.x1,e.y1=t.y1,e.x2=t.x2,e.y2=t.y2,e.w=e.x2-e.x1,e.h=e.y2-e.y1},bS=function(e,t){return!(e.x1>t.x2)&&!(t.x1>e.x2)&&!(e.x2<t.x1)&&!(t.x2<e.x1)&&!(e.y2<t.y1)&&!(t.y2<e.y1)&&!(e.y1>t.y2)&&!(t.y1>e.y2)&&!0},bM=function(e,t,i){return e.x1<=t&&t<=e.x2&&e.y1<=i&&i<=e.y2},bC=function(e,t){return bM(e,t.x,t.y)},bA=function(e,t){return bM(e,t.x1,t.y1)&&bM(e,t.x2,t.y2)},bI=null!=(EY=Math.hypot)?EY:function(e,t){return Math.sqrt(e*e+t*t)},bL=function(e,t,i,r,n,a,s){var o,l,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"auto",u="auto"===c?b2(n,a):c,h=n/2,d=a/2,f=(u=Math.min(u,h,d))!==h,p=u!==d;if(f){var g=i-h+u-s,v=r-d-s,y=i+h-u+s;if((o=bY(e,t,i,r,g,v,y,v,!1)).length>0)return o}if(p){var b=i+h+s,x=r-d+u-s,_=r+d-u+s;if((o=bY(e,t,i,r,b,x,b,_,!1)).length>0)return o}if(f){var w=i-h+u-s,k=r+d+s,E=i+h-u+s;if((o=bY(e,t,i,r,w,k,E,k,!1)).length>0)return o}if(p){var T=i-h-s,P=r-d+u-s,S=r+d-u+s;if((o=bY(e,t,i,r,T,P,T,S,!1)).length>0)return o}var M=i-h+u,C=r-d+u;if((l=bq(e,t,i,r,M,C,u+s)).length>0&&l[0]<=M&&l[1]<=C)return[l[0],l[1]];var A=i+h-u,I=r-d+u;if((l=bq(e,t,i,r,A,I,u+s)).length>0&&l[0]>=A&&l[1]<=I)return[l[0],l[1]];var L=i+h-u,D=r+d-u;if((l=bq(e,t,i,r,L,D,u+s)).length>0&&l[0]>=L&&l[1]>=D)return[l[0],l[1]];var O=i-h+u,R=r+d-u;return(l=bq(e,t,i,r,O,R,u+s)).length>0&&l[0]<=O&&l[1]>=R?[l[0],l[1]]:[]},bD=function(e,t,i,r,n,a,s){var o=Math.min(i,n),l=Math.max(i,n),c=Math.min(r,a),u=Math.max(r,a);return o-s<=e&&e<=l+s&&c-s<=t&&t<=u+s},bO=function(e,t,i,r,n,a,s,o,l){var c={x1:Math.min(i,s,n)-l,x2:Math.max(i,s,n)+l,y1:Math.min(r,o,a)-l,y2:Math.max(r,o,a)+l};return!(e<c.x1)&&!(e>c.x2)&&!(t<c.y1)&&!(t>c.y2)},bR=function(e,t,i,r){var n=t*t-4*e*(i-=r);if(n<0)return[];var a=Math.sqrt(n),s=2*e;return[(-t+a)/s,(-t-a)/s]},bN=function(e,t,i,r,n){var a,s,o,l,c,u,h,d;if(0===e&&(e=1e-5),t/=e,i/=e,r/=e,a=(s=(3*i-t*t)/9)*s*s+(o=(-(27*r)+t*(9*i-t*t*2))/54)*o,n[1]=0,h=t/3,a>0){c=(c=o+Math.sqrt(a))<0?-Math.pow(-c,1/3):Math.pow(c,1/3),u=(u=o-Math.sqrt(a))<0?-Math.pow(-u,1/3):Math.pow(u,1/3),n[0]=-h+c+u,h+=(c+u)/2,n[4]=n[2]=-h,h=Math.sqrt(3)*(-u+c)/2,n[3]=h,n[5]=-h;return}if(n[5]=n[3]=0,0===a){d=o<0?-Math.pow(-o,1/3):Math.pow(o,1/3),n[0]=-h+2*d,n[4]=n[2]=-(d+h);return}l=Math.acos(o/Math.sqrt(l=(s=-s)*s*s)),d=2*Math.sqrt(s),n[0]=-h+d*Math.cos(l/3),n[2]=-h+d*Math.cos((l+2*Math.PI)/3),n[4]=-h+d*Math.cos((l+4*Math.PI)/3)},bj=function(e,t,i,r,n,a,s,o){var l,c=[];bN(i*i-4*i*n+2*i*s+4*n*n-4*n*s+s*s+r*r-4*r*a+2*r*o+4*a*a-4*a*o+o*o,9*i*n-3*i*i-3*i*s-6*n*n+3*n*s+9*r*a-3*r*r-3*r*o-6*a*a+3*a*o,3*i*i-6*i*n+i*s-i*e+2*n*n+2*n*e-s*e+3*r*r-6*r*a+r*o-r*t+2*a*a+2*a*t-o*t,i*n-i*i+i*e-n*e+r*a-r*r+r*t-a*t,c);for(var u=[],h=0;h<6;h+=2)1e-7>Math.abs(c[h+1])&&c[h]>=0&&c[h]<=1&&u.push(c[h]);u.push(1),u.push(0);for(var d=-1,f=0;f<u.length;f++)l=Math.pow(Math.pow(1-u[f],2)*i+2*(1-u[f])*u[f]*n+u[f]*u[f]*s-e,2)+Math.pow(Math.pow(1-u[f],2)*r+2*(1-u[f])*u[f]*a+u[f]*u[f]*o-t,2),d>=0?l<d&&(d=l):d=l;return d},bB=function(e,t,i,r,n,a){var s=[e-i,t-r],o=[n-i,a-r],l=o[0]*o[0]+o[1]*o[1],c=s[0]*s[0]+s[1]*s[1],u=s[0]*o[0]+s[1]*o[1],h=u*u/l;return u<0?c:h>l?(e-n)*(e-n)+(t-a)*(t-a):c-h},bF=function(e,t,i){for(var r,n,a,s,o=0,l=0;l<i.length/2;l++)if(r=i[2*l],n=i[2*l+1],l+1<i.length/2?(a=i[(l+1)*2],s=i[(l+1)*2+1]):(a=i[(l+1-i.length/2)*2],s=i[(l+1-i.length/2)*2+1]),r==e&&a==e);else{if((!(r>=e)||!(e>=a))&&(!(r<=e)||!(e<=a)))continue;(e-r)/(a-r)*(s-n)+n>t&&o++}return o%2!=0},bz=function(e,t,i,r,n,a,s,o,l){var c,u=Array(i.length);null!=o[0]?(c=Math.atan(o[1]/o[0]),o[0]<0?c+=Math.PI/2:c=-c-Math.PI/2):c=o;for(var h=Math.cos(-c),d=Math.sin(-c),f=0;f<u.length/2;f++)u[2*f]=a/2*(i[2*f]*h-i[2*f+1]*d),u[2*f+1]=s/2*(i[2*f+1]*h+i[2*f]*d),u[2*f]+=r,u[2*f+1]+=n;return bF(e,t,l>0?bU(b$(u,-l)):u)},bV=function(e,t,i,r,n,a,s,o){for(var l=Array(2*i.length),c=0;c<o.length;c++){var u=o[c];if(l[4*c+0]=u.startX,l[4*c+1]=u.startY,l[4*c+2]=u.stopX,l[4*c+3]=u.stopY,Math.pow(u.cx-e,2)+Math.pow(u.cy-t,2)<=Math.pow(u.radius,2))return!0}return bF(e,t,l)},bU=function(e){for(var t,i,r,n,a,s,o,l,c=Array(e.length/2),u=0;u<e.length/4;u++){t=e[4*u],i=e[4*u+1],r=e[4*u+2],n=e[4*u+3],u<e.length/4-1?(a=e[(u+1)*4],s=e[(u+1)*4+1],o=e[(u+1)*4+2],l=e[(u+1)*4+3]):(a=e[0],s=e[1],o=e[2],l=e[3]);var h=bY(t,i,r,n,a,s,o,l,!0);c[2*u]=h[0],c[2*u+1]=h[1]}return c},b$=function(e,t){for(var i,r,n,a,s=Array(2*e.length),o=0;o<e.length/2;o++){i=e[2*o],r=e[2*o+1],o<e.length/2-1?(n=e[(o+1)*2],a=e[(o+1)*2+1]):(n=e[0],a=e[1]);var l=a-r,c=-(n-i),u=Math.sqrt(l*l+c*c),h=l/u,d=c/u;s[4*o]=i+h*t,s[4*o+1]=r+d*t,s[4*o+2]=n+h*t,s[4*o+3]=a+d*t}return s},bW=function(e,t,i,r,n,a){var s=i-e,o=r-t,l=Math.sqrt((s/=n)*s+(o/=a)*o),c=l-1;if(c<0)return[];var u=c/l;return[(i-e)*u+e,(r-t)*u+t]},bH=function(e,t,i,r,n,a,s){return e-=n,t-=a,(e/=i/2+s)*e+(t/=r/2+s)*t<=1},bq=function(e,t,i,r,n,a,s){var o=[i-e,r-t],l=[e-n,t-a],c=o[0]*o[0]+o[1]*o[1],u=2*(l[0]*o[0]+l[1]*o[1]),h=u*u-4*c*(l[0]*l[0]+l[1]*l[1]-s*s);if(h<0)return[];var d=(-u+Math.sqrt(h))/(2*c),f=(-u-Math.sqrt(h))/(2*c),p=Math.min(d,f),g=Math.max(d,f),v=[];if(p>=0&&p<=1&&v.push(p),g>=0&&g<=1&&v.push(g),0===v.length)return[];var y=v[0]*o[0]+e,b=v[0]*o[1]+t;return v.length>1?v[0]==v[1]?[y,b]:[y,b,v[1]*o[0]+e,v[1]*o[1]+t]:[y,b]},bG=function(e,t,i){return t<=e&&e<=i||i<=e&&e<=t?e:e<=t&&t<=i||i<=t&&t<=e?t:i},bY=function(e,t,i,r,n,a,s,o,l){var c=e-n,u=i-e,h=s-n,d=t-a,f=r-t,p=o-a,g=h*d-p*c,v=u*d-f*c,y=p*u-h*f;if(0!==y){var b=g/y,x=v/y;return -.001<=b&&b<=1.001&&-.001<=x&&x<=1.001||l?[e+b*u,t+b*f]:[]}return 0!==g&&0!==v?[]:bG(e,i,s)===s?[s,o]:bG(e,i,n)===n?[n,a]:bG(n,s,i)===i?[i,r]:[]},bX=function(e,t,i,r,n){var a=[],s=r/2,o=n/2;a.push({x:t+s*e[0],y:i+o*e[1]});for(var l=1;l<e.length/2;l++)a.push({x:t+s*e[2*l],y:i+o*e[2*l+1]});return a},bK=function(e,t,i,r,n,a,s,o){var l,c,u,h,d,f,p=[],g=Array(i.length),v=!0;if(null==a&&(v=!1),v){for(var y=0;y<g.length/2;y++)g[2*y]=i[2*y]*a+r,g[2*y+1]=i[2*y+1]*s+n;c=o>0?bU(b$(g,-o)):g}else c=i;for(var b=0;b<c.length/2;b++)u=c[2*b],h=c[2*b+1],b<c.length/2-1?(d=c[(b+1)*2],f=c[(b+1)*2+1]):(d=c[0],f=c[1]),0!==(l=bY(e,t,r,n,u,h,d,f)).length&&p.push(l[0],l[1]);return p},bZ=function(e,t,i,r,n,a,s,o,l){var c,u=[],h=Array(2*i.length);l.forEach(function(i,a){0===a?(h[h.length-2]=i.startX,h[h.length-1]=i.startY):(h[4*a-2]=i.startX,h[4*a-1]=i.startY),h[4*a]=i.stopX,h[4*a+1]=i.stopY,0!==(c=bq(e,t,r,n,i.cx,i.cy,i.radius)).length&&u.push(c[0],c[1])});for(var d=0;d<h.length/4;d++)0!==(c=bY(e,t,r,n,h[4*d],h[4*d+1],h[4*d+2],h[4*d+3],!1)).length&&u.push(c[0],c[1]);if(u.length>2){for(var f=[u[0],u[1]],p=Math.pow(f[0]-e,2)+Math.pow(f[1]-t,2),g=1;g<u.length/2;g++){var v=Math.pow(u[2*g]-e,2)+Math.pow(u[2*g+1]-t,2);v<=p&&(f[0]=u[2*g],f[1]=u[2*g+1],p=v)}return f}return u},bJ=function(e,t,i){var r=[e[0]-t[0],e[1]-t[1]],n=Math.sqrt(r[0]*r[0]+r[1]*r[1]),a=(n-i)/n;return a<0&&(a=1e-5),[t[0]+a*r[0],t[1]+a*r[1]]},bQ=function(e,t){var i=b1(e,t);return b0(i)},b0=function(e){for(var t,i,r=e.length/2,n=1/0,a=1/0,s=-1/0,o=-1/0,l=0;l<r;l++)t=e[2*l],i=e[2*l+1],n=Math.min(n,t),s=Math.max(s,t),a=Math.min(a,i),o=Math.max(o,i);for(var c=2/(s-n),u=2/(o-a),h=0;h<r;h++)t=e[2*h]=e[2*h]*c,i=e[2*h+1]=e[2*h+1]*u,n=Math.min(n,t),s=Math.max(s,t),a=Math.min(a,i),o=Math.max(o,i);if(a<-1)for(var d=0;d<r;d++)i=e[2*d+1]=e[2*d+1]+(-1-a);return e},b1=function(e,t){var i,r=1/e*2*Math.PI,n=e%2==0?Math.PI/2+r/2:Math.PI/2;n+=t;for(var a=Array(2*e),s=0;s<e;s++)i=s*r+n,a[2*s]=Math.cos(i),a[2*s+1]=Math.sin(-i);return a},b2=function(e,t){return Math.min(e/4,t/4,8)},b3=function(e,t){return Math.min(e/10,t/10,8)},b4=function(){return 8},b5=function(e,t){return{heightOffset:Math.min(15,.05*t),widthOffset:Math.min(100,.25*e),ctrlPtOffsetPct:.05}};function b6(e,t){function i(e){for(var t=[],i=0;i<e.length;i++){var r=e[i],n=e[(i+1)%e.length],a={x:n.x-r.x,y:n.y-r.y},s={x:-a.y,y:a.x},o=Math.sqrt(s.x*s.x+s.y*s.y);t.push({x:s.x/o,y:s.y/o})}return t}function r(e,t){var i,r=1/0,n=-1/0,a=vT(e);try{for(a.s();!(i=a.n()).done;){var s=i.value,o=s.x*t.x+s.y*t.y;r=Math.min(r,o),n=Math.max(n,o)}}catch(e){a.e(e)}finally{a.f()}return{min:r,max:n}}var n,a=vT([].concat(vM(i(e)),vM(i(t))));try{for(a.s();!(n=a.n()).done;){var s=n.value,o=r(e,s),l=r(t,s);if(o.max<l.min||l.max<o.min)return!1}}catch(e){a.e(e)}finally{a.f()}return!0}var b8=yW({dampingFactor:.8,precision:1e-6,iterations:200,weight:function(e){return 1}}),b9=yW({root:null,weight:function(e){return 1},directed:!1,alpha:0}),b7={degreeCentralityNormalized:function(e){e=b9(e);var t=this.cy(),i=this.nodes(),r=i.length;if(e.directed){for(var n={},a={},s=0,o=0,l=0;l<r;l++){var c=i[l],u=c.id();e.root=c;var h=this.degreeCentrality(e);s<h.indegree&&(s=h.indegree),o<h.outdegree&&(o=h.outdegree),n[u]=h.indegree,a[u]=h.outdegree}return{indegree:function(e){return 0==s?0:(vF(e)&&(e=t.filter(e)),n[e.id()]/s)},outdegree:function(e){return 0===o?0:(vF(e)&&(e=t.filter(e)),a[e.id()]/o)}}}for(var d={},f=0,p=0;p<r;p++){var g=i[p];e.root=g;var v=this.degreeCentrality(e);f<v.degree&&(f=v.degree),d[g.id()]=v.degree}return{degree:function(e){return 0===f?0:(vF(e)&&(e=t.filter(e)),d[e.id()]/f)}}},degreeCentrality:function(e){e=b9(e);var t=this.cy(),i=this,r=e,n=r.root,a=r.weight,s=r.directed,o=r.alpha;if(n=t.collection(n)[0],s){for(var l=n.connectedEdges(),c=l.filter(function(e){return e.target().same(n)&&i.has(e)}),u=l.filter(function(e){return e.source().same(n)&&i.has(e)}),h=c.length,d=u.length,f=0,p=0,g=0;g<c.length;g++)f+=a(c[g]);for(var v=0;v<u.length;v++)p+=a(u[v]);return{indegree:Math.pow(h,1-o)*Math.pow(f,o),outdegree:Math.pow(d,1-o)*Math.pow(p,o)}}for(var y=n.connectedEdges().intersection(i),b=y.length,x=0,_=0;_<y.length;_++)x+=a(y[_]);return{degree:Math.pow(b,1-o)*Math.pow(x,o)}}};b7.dc=b7.degreeCentrality,b7.dcn=b7.degreeCentralityNormalised=b7.degreeCentralityNormalized;var xe=yW({harmonic:!0,weight:function(){return 1},directed:!1,root:null}),xt={closenessCentralityNormalized:function(e){for(var t=xe(e),i=t.harmonic,r=t.weight,n=t.directed,a=this.cy(),s={},o=0,l=this.nodes(),c=this.floydWarshall({weight:r,directed:n}),u=0;u<l.length;u++){for(var h=0,d=l[u],f=0;f<l.length;f++)if(u!==f){var p=c.distance(d,l[f]);i?h+=1/p:h+=p}i||(h=1/h),o<h&&(o=h),s[d.id()]=h}return{closeness:function(e){return 0==o?0:s[e=vF(e)?a.filter(e)[0].id():e.id()]/o}}},closenessCentrality:function(e){var t=xe(e),i=t.root,r=t.weight,n=t.directed,a=t.harmonic;i=this.filter(i)[0];for(var s=this.dijkstra({root:i,weight:r,directed:n}),o=0,l=this.nodes(),c=0;c<l.length;c++){var u=l[c];if(!u.same(i)){var h=s.distanceTo(u);a?o+=1/h:o+=h}}return a?o:1/o}};xt.cc=xt.closenessCentrality,xt.ccn=xt.closenessCentralityNormalised=xt.closenessCentralityNormalized;var xi=yW({weight:null,directed:!1}),xr={betweennessCentrality:function(e){for(var t=xi(e),i=t.directed,r=t.weight,n=null!=r,a=this.cy(),s=this.nodes(),o={},l={},c=0,u=function(e,t){l[e]=t,t>c&&(c=t)},h=function(e){return l[e]},d=0;d<s.length;d++){var f=s[d],p=f.id();i?o[p]=f.outgoers().nodes():o[p]=f.openNeighborhood().nodes(),u(p,0)}for(var g=0;g<s.length;g++)!function(){for(var e=s[g].id(),t=[],i={},l={},c={},d=new y5(function(e,t){return c[e]-c[t]}),f=0;f<s.length;f++){var p=s[f].id();i[p]=[],l[p]=0,c[p]=1/0}for(l[e]=1,c[e]=0,d.push(e);!d.empty();){var v=d.pop();if(t.push(v),n)for(var y=0;y<o[v].length;y++){var b=o[v][y],x=a.getElementById(v),_=r(x.edgesTo(b).length>0?x.edgesTo(b)[0]:b.edgesTo(x)[0]);c[b=b.id()]>c[v]+_&&(c[b]=c[v]+_,0>d.nodes.indexOf(b)?d.push(b):d.updateItem(b),l[b]=0,i[b]=[]),c[b]==c[v]+_&&(l[b]=l[b]+l[v],i[b].push(v))}else for(var w=0;w<o[v].length;w++){var k=o[v][w].id();c[k]==1/0&&(d.push(k),c[k]=c[v]+1),c[k]==c[v]+1&&(l[k]=l[k]+l[v],i[k].push(v))}}for(var E={},T=0;T<s.length;T++)E[s[T].id()]=0;for(;t.length>0;){for(var P=t.pop(),S=0;S<i[P].length;S++){var M=i[P][S];E[M]=E[M]+l[M]/l[P]*(1+E[P])}P!=s[g].id()&&u(P,h(P)+E[P])}}();var v={betweenness:function(e){return h(a.collection(e).id())},betweennessNormalized:function(e){return 0==c?0:h(a.collection(e).id())/c}};return v.betweennessNormalised=v.betweennessNormalized,v}};xr.bc=xr.betweennessCentrality;var xn=yW({expandFactor:2,inflateFactor:2,multFactor:1,maxIterations:20,attributes:[function(e){return 1}]}),xa=function(e,t){for(var i=0,r=0;r<t.length;r++)i+=t[r](e);return i},xs=function(e,t,i){for(var r=0;r<t;r++)e[r*t+r]=i},xo=function(e,t){for(var i,r=0;r<t;r++){i=0;for(var n=0;n<t;n++)i+=e[n*t+r];for(var a=0;a<t;a++)e[a*t+r]=e[a*t+r]/i}},xl=function(e,t,i){for(var r=Array(i*i),n=0;n<i;n++){for(var a=0;a<i;a++)r[n*i+a]=0;for(var s=0;s<i;s++)for(var o=0;o<i;o++)r[n*i+o]+=e[n*i+s]*t[s*i+o]}return r},xc=function(e,t,i){for(var r=e.slice(0),n=1;n<i;n++)e=xl(e,r,t);return e},xu=function(e,t,i){for(var r=Array(t*t),n=0;n<t*t;n++)r[n]=Math.pow(e[n],i);return xo(r,t),r},xh=function(e,t,i,r){for(var n=0;n<i;n++)if(Math.round(e[n]*Math.pow(10,r))/Math.pow(10,r)!=Math.round(t[n]*Math.pow(10,r))/Math.pow(10,r))return!1;return!0},xd=function(e,t,i,r){for(var n=[],a=0;a<t;a++){for(var s=[],o=0;o<t;o++)Math.round(1e3*e[a*t+o])/1e3>0&&s.push(i[o]);0!==s.length&&n.push(r.collection(s))}return n},xf=function(e,t){for(var i=0;i<e.length;i++)if(!t[i]||e[i].id()!==t[i].id())return!1;return!0},xp=function(e){for(var t=0;t<e.length;t++)for(var i=0;i<e.length;i++)t!=i&&xf(e[t],e[i])&&e.splice(i,1);return e},xg=function(e){for(var t=this.nodes(),i=this.edges(),r=this.cy(),n=xn(e),a={},s=0;s<t.length;s++)a[t[s].id()]=s;for(var o,l=t.length,c=l*l,u=Array(c),h=0;h<c;h++)u[h]=0;for(var d=0;d<i.length;d++){var f=i[d],p=a[f.source().id()],g=a[f.target().id()],v=xa(f,n.attributes);u[p*l+g]+=v,u[g*l+p]+=v}xs(u,l,n.multFactor),xo(u,l);for(var y=!0,b=0;y&&b<n.maxIterations;)y=!1,xh(u=xu(o=xc(u,l,n.expandFactor),l,n.inflateFactor),o,c,4)||(y=!0),b++;var x=xd(u,l,t,r);return xp(x)},xm=function(e){return e},xv=function(e,t){return Math.abs(t-e)},xy=function(e,t,i){return e+xv(t,i)},xb=function(e,t,i){return e+Math.pow(i-t,2)},xx=function(e){return Math.sqrt(e)},x_=function(e,t,i){return Math.max(e,xv(t,i))},xw=function(e,t,i,r,n){for(var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:xm,s=r,o=0;o<e;o++)s=n(s,t(o),i(o));return a(s)},xk={euclidean:function(e,t,i){return e>=2?xw(e,t,i,0,xb,xx):xw(e,t,i,0,xy)},squaredEuclidean:function(e,t,i){return xw(e,t,i,0,xb)},manhattan:function(e,t,i){return xw(e,t,i,0,xy)},max:function(e,t,i){return xw(e,t,i,-1/0,x_)}};function xE(e,t,i,r,n,a){var s;return(s=vz(e)?e:xk[e]||xk.euclidean,0===t&&vz(e))?s(n,a):s(t,i,r,n,a)}xk["squared-euclidean"]=xk.squaredEuclidean,xk.squaredeuclidean=xk.squaredEuclidean;var xT=yW({k:2,m:2,sensitivityThreshold:1e-4,distance:"euclidean",maxIterations:10,attributes:[],testMode:!1,testCentroids:null}),xP=function(e){return xT(e)},xS=function(e,t,i,r,n){var a="kMedoids"!==n?function(e){return i[e]}:function(e){return r[e](i)};return xE(e,r.length,a,function(e){return r[e](t)},i,t)},xM=function(e,t,i){for(var r=i.length,n=Array(r),a=Array(r),s=Array(t),o=null,l=0;l<r;l++)n[l]=e.min(i[l]).value,a[l]=e.max(i[l]).value;for(var c=0;c<t;c++){o=[];for(var u=0;u<r;u++)o[u]=Math.random()*(a[u]-n[u])+n[u];s[c]=o}return s},xC=function(e,t,i,r,n){for(var a=1/0,s=0,o=0;o<t.length;o++){var l=xS(i,e,t[o],r,n);l<a&&(a=l,s=o)}return s},xA=function(e,t,i){for(var r=[],n=null,a=0;a<t.length;a++)i[(n=t[a]).id()]===e&&r.push(n);return r},xI=function(e,t,i){for(var r=0;r<e.length;r++)for(var n=0;n<e[r].length;n++)if(Math.abs(e[r][n]-t[r][n])>i)return!1;return!0},xL=function(e,t,i){for(var r=0;r<i;r++)if(e===t[r])return!0;return!1},xD=function(e,t){var i=Array(t);if(e.length<50)for(var r=0;r<t;r++){for(var n=e[Math.floor(Math.random()*e.length)];xL(n,i,r);)n=e[Math.floor(Math.random()*e.length)];i[r]=n}else for(var a=0;a<t;a++)i[a]=e[Math.floor(Math.random()*e.length)];return i},xO=function(e,t,i){for(var r=0,n=0;n<t.length;n++)r+=xS("manhattan",t[n],e,i,"kMedoids");return r},xR=function(e,t,i,r,n){for(var a,s,o=0;o<t.length;o++)for(var l=0;l<e.length;l++)r[o][l]=Math.pow(i[o][l],n.m);for(var c=0;c<e.length;c++)for(var u=0;u<n.attributes.length;u++){a=0,s=0;for(var h=0;h<t.length;h++)a+=r[h][c]*n.attributes[u](t[h]),s+=r[h][c];e[c][u]=a/s}},xN=function(e,t,i,r,n){for(var a,s=0;s<e.length;s++)t[s]=e[s].slice();for(var o=2/(n.m-1),l=0;l<i.length;l++)for(var c=0;c<r.length;c++){a=0;for(var u=0;u<i.length;u++)a+=Math.pow(xS(n.distance,r[c],i[l],n.attributes,"cmeans")/xS(n.distance,r[c],i[u],n.attributes,"cmeans"),o);e[c][l]=1/a}},xj=function(e,t,i,r){for(var n,a,s=Array(i.k),o=0;o<s.length;o++)s[o]=[];for(var l=0;l<t.length;l++){n=-1/0,a=-1;for(var c=0;c<t[0].length;c++)t[l][c]>n&&(n=t[l][c],a=c);s[a].push(e[l])}for(var u=0;u<s.length;u++)s[u]=r.collection(s[u]);return s},xB=function(e){var t,i,r,n,a=this.cy(),s=this.nodes(),o=xP(e);r=Array(s.length);for(var l=0;l<s.length;l++)r[l]=Array(o.k);i=Array(s.length);for(var c=0;c<s.length;c++)i[c]=Array(o.k);for(var u=0;u<s.length;u++){for(var h=0,d=0;d<o.k;d++)i[u][d]=Math.random(),h+=i[u][d];for(var f=0;f<o.k;f++)i[u][f]=i[u][f]/h}t=Array(o.k);for(var p=0;p<o.k;p++)t[p]=Array(o.attributes.length);n=Array(s.length);for(var g=0;g<s.length;g++)n[g]=Array(o.k);for(var v=!0,y=0;v&&y<o.maxIterations;)v=!1,xR(t,s,i,n,o),xN(i,r,t,s,o),xI(i,r,o.sensitivityThreshold)||(v=!0),y++;return{clusters:xj(s,i,o,a),degreeOfMembership:i}},xF=yW({distance:"euclidean",linkage:"min",mode:"threshold",threshold:1/0,addDendrogram:!1,dendrogramDepth:0,attributes:[]}),xz={single:"min",complete:"max"},xV=function(e){var t=xF(e),i=xz[t.linkage];return null!=i&&(t.linkage=i),t},xU=function(e,t,i,r,n){for(var a,s,o=0,l=1/0,c=n.attributes,u=function(e,t){return xE(n.distance,c.length,function(t){return c[t](e)},function(e){return c[e](t)},e,t)},h=0;h<e.length;h++){var d=e[h].key,f=i[d][r[d]];f<l&&(o=d,l=f)}if("threshold"===n.mode&&l>=n.threshold||"dendrogram"===n.mode&&1===e.length)return!1;var p=t[o],g=t[r[o]];s="dendrogram"===n.mode?{left:p,right:g,key:p.key}:{value:p.value.concat(g.value),key:p.key},e[p.index]=s,e.splice(g.index,1),t[p.key]=s;for(var v=0;v<e.length;v++){var y=e[v];p.key===y.key?a=1/0:"min"===n.linkage?(a=i[p.key][y.key],i[p.key][y.key]>i[g.key][y.key]&&(a=i[g.key][y.key])):"max"===n.linkage?(a=i[p.key][y.key],i[p.key][y.key]<i[g.key][y.key]&&(a=i[g.key][y.key])):a="mean"===n.linkage?(i[p.key][y.key]*p.size+i[g.key][y.key]*g.size)/(p.size+g.size):"dendrogram"===n.mode?u(y.value,p.value):u(y.value[0],p.value[0]),i[p.key][y.key]=i[y.key][p.key]=a}for(var b=0;b<e.length;b++){var x=e[b].key;if(r[x]===p.key||r[x]===g.key){for(var _=x,w=0;w<e.length;w++){var k=e[w].key;i[x][k]<i[x][_]&&(_=k)}r[x]=_}e[b].index=b}return p.key=g.key=p.index=g.index=null,!0},x$=function(e,t,i){e&&(e.value?t.push(e.value):(e.left&&x$(e.left,t),e.right&&x$(e.right,t)))},xW=function(e,t){if(!e)return"";if(e.left&&e.right){var i=xW(e.left,t),r=xW(e.right,t),n=t.add({group:"nodes",data:{id:i+","+r}});return t.add({group:"edges",data:{source:i,target:n.id()}}),t.add({group:"edges",data:{source:r,target:n.id()}}),n.id()}if(e.value)return e.value.id()},xH=function(e,t,i){if(!e)return[];var r=[],n=[],a=[];if(0===t)return e.left&&x$(e.left,r),e.right&&x$(e.right,n),a=r.concat(n),[i.collection(a)];if(1===t)if(e.value)return[i.collection(e.value)];else return e.left&&x$(e.left,r),e.right&&x$(e.right,n),[i.collection(r),i.collection(n)];return e.value?[i.collection(e.value)]:(e.left&&(r=xH(e.left,t-1,i)),e.right&&(n=xH(e.right,t-1,i)),r.concat(n))},xq=function(e){for(var t,i=this.cy(),r=this.nodes(),n=xV(e),a=n.attributes,s=function(e,t){return xE(n.distance,a.length,function(t){return a[t](e)},function(e){return a[e](t)},e,t)},o=[],l=[],c=[],u=[],h=0;h<r.length;h++){var d={value:"dendrogram"===n.mode?r[h]:[r[h]],key:h,index:h};o[h]=d,u[h]=d,l[h]=[],c[h]=0}for(var f=0;f<o.length;f++)for(var p=0;p<=f;p++){var g=void 0;g="dendrogram"===n.mode?f===p?1/0:s(o[f].value,o[p].value):f===p?1/0:s(o[f].value[0],o[p].value[0]),l[f][p]=g,l[p][f]=g,g<l[f][c[f]]&&(c[f]=p)}for(var v=xU(o,u,l,c,n);v;)v=xU(o,u,l,c,n);return"dendrogram"===n.mode?(t=xH(o[0],n.dendrogramDepth,i),n.addDendrogram&&xW(o[0],i)):(t=Array(o.length),o.forEach(function(e,r){e.key=e.index=null,t[r]=i.collection(e.value)})),t},xG=yW({distance:"euclidean",preference:"median",damping:.8,maxIterations:1e3,minIterations:100,attributes:[]}),xY=function(e){var t=e.damping,i=e.preference;.5<=t&&t<1||yj("Damping must range on [0.5, 1).  Got: ".concat(t));var r=["median","mean","min","max"];return r.some(function(e){return e===i})||v$(i)||yj("Preference must be one of [".concat(r.map(function(e){return"'".concat(e,"'")}).join(", "),"] or a number.  Got: ").concat(i)),xG(e)},xX=function(e,t,i,r){var n=function(e,t){return r[t](e)};return-xE(e,r.length,function(e){return n(t,e)},function(e){return n(i,e)},t,i)},xK=function(e,t){return"median"===t?bc(e):"mean"===t?bl(e):"min"===t?bs(e):"max"===t?bo(e):t},xZ=function(e,t,i){for(var r=[],n=0;n<e;n++)t[n*e+n]+i[n*e+n]>0&&r.push(n);return r},xJ=function(e,t,i){for(var r=[],n=0;n<e;n++){for(var a=-1,s=-1/0,o=0;o<i.length;o++){var l=i[o];t[n*e+l]>s&&(a=l,s=t[n*e+l])}a>0&&r.push(a)}for(var c=0;c<i.length;c++)r[i[c]]=i[c];return r},xQ=function(e,t,i){for(var r=xJ(e,t,i),n=0;n<i.length;n++){for(var a=[],s=0;s<r.length;s++)r[s]===i[n]&&a.push(s);for(var o=-1,l=-1/0,c=0;c<a.length;c++){for(var u=0,h=0;h<a.length;h++)u+=t[a[h]*e+a[c]];u>l&&(o=c,l=u)}i[n]=a[o]}return xJ(e,t,i)},x0=function(e){for(var t,i,r,n,a,s,o,l=this.cy(),c=this.nodes(),u=xY(e),h={},d=0;d<c.length;d++)h[c[d].id()]=d;r=Array(i=(t=c.length)*t);for(var f=0;f<i;f++)r[f]=-1/0;for(var p=0;p<t;p++)for(var g=0;g<t;g++)p!==g&&(r[p*t+g]=xX(u.distance,c[p],c[g],u.attributes));n=xK(r,u.preference);for(var v=0;v<t;v++)r[v*t+v]=n;a=Array(i);for(var y=0;y<i;y++)a[y]=0;s=Array(i);for(var b=0;b<i;b++)s[b]=0;for(var x=Array(t),_=Array(t),w=Array(t),k=0;k<t;k++)x[k]=0,_[k]=0,w[k]=0;for(var E=Array(t*u.minIterations),T=0;T<E.length;T++)E[T]=0;for(o=0;o<u.maxIterations;o++){for(var P=0;P<t;P++){for(var S=-1/0,M=-1/0,C=-1,A=0,I=0;I<t;I++)x[I]=a[P*t+I],(A=s[P*t+I]+r[P*t+I])>=S?(M=S,S=A,C=I):A>M&&(M=A);for(var L=0;L<t;L++)a[P*t+L]=(1-u.damping)*(r[P*t+L]-S)+u.damping*x[L];a[P*t+C]=(1-u.damping)*(r[P*t+C]-M)+u.damping*x[C]}for(var D=0;D<t;D++){for(var O=0,R=0;R<t;R++)x[R]=s[R*t+D],_[R]=Math.max(0,a[R*t+D]),O+=_[R];O-=_[D],_[D]=a[D*t+D],O+=_[D];for(var N=0;N<t;N++)s[N*t+D]=(1-u.damping)*Math.min(0,O-_[N])+u.damping*x[N];s[D*t+D]=(1-u.damping)*(O-_[D])+u.damping*x[D]}for(var j=0,B=0;B<t;B++){var F=+(s[B*t+B]+a[B*t+B]>0);E[o%u.minIterations*t+B]=F,j+=F}if(j>0&&(o>=u.minIterations-1||o==u.maxIterations-1)){for(var z=0,V=0;V<t;V++){w[V]=0;for(var U=0;U<u.minIterations;U++)w[V]+=E[U*t+V];(0===w[V]||w[V]===u.minIterations)&&z++}if(z===t)break}}for(var $=xZ(t,a,s),W=xQ(t,r,$),H={},q=0;q<$.length;q++)H[$[q]]=[];for(var G=0;G<c.length;G++){var Y=W[h[c[G].id()]];null!=Y&&H[Y].push(c[G])}for(var X=Array($.length),K=0;K<$.length;K++)X[K]=l.collection(H[$[K]]);return X},x1=yW({root:void 0,directed:!1}),x2=function(){var e=this,t={},i=0,r=0,n=[],a=[],s={},o=function(i,r){for(var s=a.length-1,o=[],l=e.spawn();a[s].x!=i||a[s].y!=r;)o.push(a.pop().edge),s--;o.push(a.pop().edge),o.forEach(function(i){var r=i.connectedNodes().intersection(e);l.merge(i),r.forEach(function(i){var r=i.id(),n=i.connectedEdges().intersection(e);l.merge(i),t[r].cutVertex?l.merge(n.filter(function(e){return e.isLoop()})):l.merge(n)})}),n.push(l)},l=function(c,u,h){c===h&&(r+=1),t[u]={id:i,low:i++,cutVertex:!1};var d,f,p,g,v=e.getElementById(u).connectedEdges().intersection(e);0===v.size()?n.push(e.spawn(e.getElementById(u))):v.forEach(function(e){d=e.source().id(),f=e.target().id(),(p=d===u?f:d)!==h&&(s[g=e.id()]||(s[g]=!0,a.push({x:u,y:p,edge:e})),p in t?t[u].low=Math.min(t[u].low,t[p].id):(l(c,p,u),t[u].low=Math.min(t[u].low,t[p].low),t[u].id<=t[p].low&&(t[u].cutVertex=!0,o(u,p))))})};e.forEach(function(e){if(e.isNode()){var i=e.id();i in t||(r=0,l(i,i),t[i].cutVertex=r>1)}});var c=Object.keys(t).filter(function(e){return t[e].cutVertex}).map(function(t){return e.getElementById(t)});return{cut:e.spawn(c),components:n}},x3=function(){var e=this,t={},i=0,r=[],n=[],a=e.spawn(e),s=function(o){if(n.push(o),t[o]={index:i,low:i++,explored:!1},e.getElementById(o).connectedEdges().intersection(e).forEach(function(e){var i=e.target().id();i!==o&&(i in t||s(i),t[i].explored||(t[o].low=Math.min(t[o].low,t[i].low)))}),t[o].index===t[o].low){for(var l=e.spawn();;){var c=n.pop();if(l.merge(e.getElementById(c)),t[c].low=t[o].index,t[c].explored=!0,c===o)break}var u=l.edgesWith(l),h=l.merge(u);r.push(h),a=a.difference(h)}};return e.forEach(function(e){if(e.isNode()){var i=e.id();i in t||s(i)}}),{cut:a,components:r}},x4={};[y2,{dijkstra:function(e){if(!vU(e)){var t=arguments;e={root:t[0],weight:t[1],directed:t[2]}}var i=y6(e),r=i.root,n=i.weight,a=i.directed,s=this,o=vF(r)?this.filter(r)[0]:r[0],l={},c={},u={},h=this.byGroup(),d=h.nodes,f=h.edges;f.unmergeBy(function(e){return e.isLoop()});for(var p=function(e){return l[e.id()]},g=new y5(function(e,t){return p(e)-p(t)}),v=0;v<d.length;v++){var y=d[v];l[y.id()]=y.same(o)?0:1/0,g.push(y)}for(;g.size()>0;){var b=g.pop(),x=p(b);if(u[b.id()]=x,x!==1/0)for(var _=b.neighborhood().intersect(d),w=0;w<_.length;w++){var k=_[w],E=k.id(),T=function(e,t){for(var i,r=(a?e.edgesTo(t):e.edgesWith(t)).intersect(f),s=1/0,o=0;o<r.length;o++){var l=r[o],c=n(l);(c<s||!i)&&(s=c,i=l)}return{edge:i,dist:s}}(b,k),P=x+T.dist;P<p(k)&&(l[k.id()]=P,g.updateItem(k),c[E]={node:b,edge:T.edge})}}return{distanceTo:function(e){return u[(vF(e)?d.filter(e)[0]:e[0]).id()]},pathTo:function(e){var t=vF(e)?d.filter(e)[0]:e[0],i=[],r=t,n=r.id();if(t.length>0)for(i.unshift(t);c[n];){var a=c[n];i.unshift(a.edge),i.unshift(a.node),n=(r=a.node).id()}return s.spawn(i)}}}},{kruskal:function(e){e=e||function(e){return 1};for(var t=this.byGroup(),i=t.nodes,r=t.edges,n=i.length,a=Array(n),s=function(e){for(var t=0;t<a.length;t++)if(a[t].has(e))return t},o=0;o<n;o++)a[o]=this.spawn(i[o]);for(var l=r.sort(function(t,i){return e(t)-e(i)}),c=0;c<l.length;c++){var u=l[c],h=u.source()[0],d=u.target()[0],f=s(h),p=s(d),g=a[f],v=a[p];f!==p&&(i.merge(u),g.merge(v),a.splice(p,1))}return i}},{aStar:function(e){var t,i,r=this.cy(),n=y8(e),a=n.root,s=n.goal,o=n.heuristic,l=n.directed,c=n.weight;a=r.collection(a)[0],s=r.collection(s)[0];var u=a.id(),h=s.id(),d={},f={},p={},g=new y5(function(e,t){return f[e.id()]-f[t.id()]}),v=new yQ,y={},b={},x=function(e,t){g.push(e),v.add(t)};x(a,u),d[u]=0,f[u]=o(a);for(var _=0;g.size()>0;){if(i=(t=g.pop()).id(),v.delete(i),_++,i===h){for(var w=[],k=s,E=h,T=b[E];w.unshift(k),null!=T&&w.unshift(T),null!=(k=y[E]);)T=b[E=k.id()];return{found:!0,distance:d[i],path:this.spawn(w),steps:_}}p[i]=!0;for(var P=t._private.edges,S=0;S<P.length;S++){var M=P[S];if(this.hasElementWithId(M.id())&&(!l||M.data("source")===i)){var C=M.source(),A=M.target(),I=C.id()!==i?C:A,L=I.id();if(this.hasElementWithId(L)&&!p[L]){var D=d[i]+c(M);if(!v.has(L)){d[L]=D,f[L]=D+o(I),x(I,L),y[L]=t,b[L]=M;continue}D<d[L]&&(d[L]=D,f[L]=D+o(I),y[L]=t,b[L]=M)}}}}return{found:!1,distance:void 0,path:void 0,steps:_}}},{floydWarshall:function(e){for(var t=this.cy(),i=y9(e),r=i.weight,n=i.directed,a=this.byGroup(),s=a.nodes,o=a.edges,l=s.length,c=l*l,u=function(e){return s.indexOf(e)},h=function(e){return s[e]},d=Array(c),f=0;f<c;f++){var p=f%l;(f-p)/l===p?d[f]=0:d[f]=1/0}for(var g=Array(c),v=Array(c),y=0;y<o.length;y++){var b=o[y],x=b.source()[0],_=b.target()[0];if(x!==_){var w=u(x),k=u(_),E=w*l+k,T=r(b);if(d[E]>T&&(d[E]=T,g[E]=k,v[E]=b),!n){var P=k*l+w;!n&&d[P]>T&&(d[P]=T,g[P]=w,v[P]=b)}}}for(var S=0;S<l;S++)for(var M=0;M<l;M++)for(var C=M*l+S,A=0;A<l;A++){var I=M*l+A,L=S*l+A;d[C]+d[L]<d[I]&&(d[I]=d[C]+d[L],g[I]=g[C])}var D=function(e){return u((vF(e)?t.filter(e):e)[0])};return{distance:function(e,t){return d[D(e)*l+D(t)]},path:function(e,i){var r,n=D(e),a=D(i),s=h(n);if(n===a)return s.collection();if(null==g[n*l+a])return t.collection();var o=t.collection(),c=n;for(o.merge(s);n!==a;)c=n,n=g[n*l+a],r=v[c*l+n],o.merge(r),o.merge(h(n));return o}}}},{bellmanFord:function(e){var t=this,i=y7(e),r=i.weight,n=i.directed,a=i.root,s=this,o=this.cy(),l=this.byGroup(),c=l.edges,u=l.nodes,h=u.length,d=new yZ,f=!1,p=[];a=o.collection(a)[0],c.unmergeBy(function(e){return e.isLoop()});for(var g=c.length,v=function(e){var t=d.get(e.id());return t||(t={},d.set(e.id(),t)),t},y=function(e){return(vF(e)?o.$(e):e)[0]},b=0;b<h;b++){var x=u[b],_=v(x);x.same(a)?_.dist=0:_.dist=1/0,_.pred=null,_.edge=null}for(var w=!1,k=function(e,t,i,r,n,a){var s=r.dist+a;s<n.dist&&!i.same(r.edge)&&(n.dist=s,n.pred=e,n.edge=i,w=!0)},E=1;E<h;E++){w=!1;for(var T=0;T<g;T++){var P=c[T],S=P.source(),M=P.target(),C=r(P),A=v(S),I=v(M);k(S,M,P,A,I,C),n||k(M,S,P,I,A,C)}if(!w)break}if(w)for(var L=[],D=0;D<g;D++){var O=c[D],R=O.source(),N=O.target(),j=r(O),B=v(R).dist,F=v(N).dist;if(B+j<F||!n&&F+j<B)if(f||(yF("Graph contains a negative weight cycle for Bellman-Ford"),f=!0),!1!==e.findNegativeWeightCycles){var z=[];B+j<F&&z.push(R),!n&&F+j<B&&z.push(N);for(var V=z.length,U=0;U<V;U++){var $=z[U],W=[$];W.push(v($).edge);for(var H=v($).pred;-1===W.indexOf(H);)W.push(H),W.push(v(H).edge),H=v(H).pred;for(var q=(W=W.slice(W.indexOf(H)))[0].id(),G=0,Y=2;Y<W.length;Y+=2)W[Y].id()<q&&(q=W[Y].id(),G=Y);(W=W.slice(G).concat(W.slice(0,G))).push(W[0]);var X=W.map(function(e){return e.id()}).join(",");-1===L.indexOf(X)&&(p.push(s.spawn(W)),L.push(X))}}else break}return{distanceTo:function(e){return v(y(e)).dist},pathTo:function(e){for(var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a,r=y(e),n=[],o=r;;){if(null==o)return t.spawn();var l=v(o),c=l.edge,u=l.pred;if(n.unshift(o[0]),o.same(i)&&n.length>0)break;null!=c&&n.unshift(c),o=u}return s.spawn(n)},hasNegativeWeightCycle:f,negativeWeightCycles:p}}},{kargerStein:function(){var e=this,t=this.byGroup(),i=t.nodes,r=t.edges;r.unmergeBy(function(e){return e.isLoop()});var n=i.length,a=r.length,s=Math.ceil(Math.pow(Math.log(n)/Math.LN2,2)),o=Math.floor(n/be);if(n<2)return void yj("At least 2 nodes are required for Karger-Stein algorithm");for(var l=[],c=0;c<a;c++){var u=r[c];l.push([c,i.indexOf(u.source()),i.indexOf(u.target())])}for(var h=1/0,d=[],f=Array(n),p=Array(n),g=Array(n),v=function(e,t){for(var i=0;i<n;i++)t[i]=e[i]},y=0;y<=s;y++){for(var b=0;b<n;b++)p[b]=b;var x=bi(p,l.slice(),n,o),_=x.slice();v(p,g);var w=bi(p,x,o,2),k=bi(g,_,o,2);w.length<=k.length&&w.length<h?(h=w.length,d=w,v(p,f)):k.length<=w.length&&k.length<h&&(h=k.length,d=k,v(g,f))}for(var E=this.spawn(d.map(function(e){return r[e[0]]})),T=this.spawn(),P=this.spawn(),S=f[0],M=0;M<f.length;M++){var C=f[M],A=i[M];C===S?T.merge(A):P.merge(A)}var I=function(t){var i=e.spawn();return t.forEach(function(t){i.merge(t),t.connectedEdges().forEach(function(t){e.contains(t)&&!E.contains(t)&&i.merge(t)})}),i};return{cut:E,components:[I(T),I(P)],partition1:T,partition2:P}}},{pageRank:function(e){for(var t,i=b8(e),r=i.dampingFactor,n=i.precision,a=i.iterations,s=i.weight,o=this._private.cy,l=this.byGroup(),c=l.nodes,u=l.edges,h=c.length,d=h*h,f=u.length,p=Array(d),g=Array(h),v=(1-r)/h,y=0;y<h;y++){for(var b=0;b<h;b++)p[y*h+b]=0;g[y]=0}for(var x=0;x<f;x++){var _=u[x],w=_.data("source"),k=_.data("target");if(w!==k){var E=c.indexOfId(w),T=c.indexOfId(k),P=s(_),S=T*h+E;p[S]+=P,g[E]+=P}}for(var M=1/h+v,C=0;C<h;C++)if(0===g[C])for(var A=0;A<h;A++)p[A*h+C]=M;else for(var I=0;I<h;I++){var L=I*h+C;p[L]=p[L]/g[C]+v}for(var D=Array(h),O=Array(h),R=0;R<h;R++)D[R]=1;for(var N=0;N<a;N++){for(var j=0;j<h;j++)O[j]=0;for(var B=0;B<h;B++)for(var F=0;F<h;F++){var z=B*h+F;O[B]+=p[z]*D[F]}bg(O),t=D,D=O,O=t;for(var V=0,U=0;U<h;U++){var $=t[U]-D[U];V+=$*$}if(V<n)break}return{rank:function(e){return e=o.collection(e)[0],D[c.indexOf(e)]}}}},b7,xt,xr,{markovClustering:xg,mcl:xg},{kMeans:function(e){var t,i=this.cy(),r=this.nodes(),n=null,a=xP(e),s=Array(a.k),o={};a.testMode?"number"==typeof a.testCentroids?(a.testCentroids,t=xM(r,a.k,a.attributes)):t="object"===vA(a.testCentroids)?a.testCentroids:xM(r,a.k,a.attributes):t=xM(r,a.k,a.attributes);for(var l=!0,c=0;l&&c<a.maxIterations;){for(var u=0;u<r.length;u++)o[(n=r[u]).id()]=xC(n,t,a.distance,a.attributes,"kMeans");l=!1;for(var h=0;h<a.k;h++){var d=xA(h,r,o);if(0!==d.length){for(var f=a.attributes.length,p=t[h],g=Array(f),v=Array(f),y=0;y<f;y++){v[y]=0;for(var b,x=0;x<d.length;x++)n=d[x],v[y]+=a.attributes[y](n);g[y]=v[y]/d.length,b=g[y],Math.abs(p[y]-b)<=a.sensitivityThreshold||(l=!0)}t[h]=g,s[h]=i.collection(d)}}c++}return s},kMedoids:function(e){var t,i,r=this.cy(),n=this.nodes(),a=null,s=xP(e),o=Array(s.k),l={},c=Array(s.k);s.testMode?"number"==typeof s.testCentroids||(t="object"===vA(s.testCentroids)?s.testCentroids:xD(n,s.k)):t=xD(n,s.k);for(var u=!0,h=0;u&&h<s.maxIterations;){for(var d=0;d<n.length;d++)l[(a=n[d]).id()]=xC(a,t,s.distance,s.attributes,"kMedoids");u=!1;for(var f=0;f<t.length;f++){var p=xA(f,n,l);if(0!==p.length){c[f]=xO(t[f],p,s.attributes);for(var g=0;g<p.length;g++)(i=xO(p[g],p,s.attributes))<c[f]&&(c[f]=i,t[f]=p[g],u=!0);o[f]=r.collection(p)}}h++}return o},fuzzyCMeans:xB,fcm:xB},{hierarchicalClustering:xq,hca:xq},{affinityPropagation:x0,ap:x0},{hierholzer:function(e){if(!vU(e)){var t,i,r,n=arguments;e={root:n[0],directed:n[1]}}var a=x1(e),s=a.root,o=a.directed,l=!1;s&&(r=vF(s)?this.filter(s)[0].id():s[0].id());var c={},u={};o?this.forEach(function(e){var r=e.id();if(e.isNode()){var n=e.indegree(!0),a=e.outdegree(!0),s=n-a,o=a-n;1==s?t?l=!0:t=r:1==o?i?l=!0:i=r:(o>1||s>1)&&(l=!0),c[r]=[],e.outgoers().forEach(function(e){e.isEdge()&&c[r].push(e.id())})}else u[r]=[void 0,e.target().id()]}):this.forEach(function(e){var r=e.id();e.isNode()?(e.degree(!0)%2&&(t?i?l=!0:i=r:t=r),c[r]=[],e.connectedEdges().forEach(function(e){return c[r].push(e.id())})):u[r]=[e.source().id(),e.target().id()]});var h={found:!1,trail:void 0};if(l)return h;if(i&&t)if(o){if(r&&i!=r)return h;r=i}else{if(r&&i!=r&&t!=r)return h;r||(r=i)}else r||(r=this[0].id());var d=function(e){for(var t,i,r,n=e,a=[e];c[n].length;)i=u[t=c[n].shift()][0],n!=(r=u[t][1])?(c[r]=c[r].filter(function(e){return e!=t}),n=r):o||n==i||(c[i]=c[i].filter(function(e){return e!=t}),n=i),a.unshift(t),a.unshift(n);return a},f=[],p=[];for(p=d(r);1!=p.length;)0==c[p[0]].length?(f.unshift(this.getElementById(p.shift())),f.unshift(this.getElementById(p.shift()))):p=d(p.shift()).concat(p);for(var g in f.unshift(this.getElementById(p.shift())),c)if(c[g].length)return h;return h.found=!0,h.trail=this.spawn(f,!0),h}},{hopcroftTarjanBiconnected:x2,htbc:x2,htb:x2,hopcroftTarjanBiconnectedComponents:x2},{tarjanStronglyConnected:x3,tsc:x3,tscc:x3,tarjanStronglyConnectedComponents:x3}].forEach(function(e){ye(x4,e)});var x5=function(e){if(!(this instanceof x5))return new x5(e);this.id="Thenable/1.0.7",this.state=0,this.fulfillValue=void 0,this.rejectReason=void 0,this.onFulfilled=[],this.onRejected=[],this.proxy={then:this.then.bind(this)},"function"==typeof e&&e.call(this,this.fulfill.bind(this),this.reject.bind(this))};x5.prototype={fulfill:function(e){return x6(this,1,"fulfillValue",e)},reject:function(e){return x6(this,2,"rejectReason",e)},then:function(e,t){var i=new x5;return this.onFulfilled.push(x7(e,i,"fulfill")),this.onRejected.push(x7(t,i,"reject")),x8(this),i.proxy}};var x6=function(e,t,i,r){return 0===e.state&&(e.state=t,e[i]=r,x8(e)),e},x8=function(e){1===e.state?x9(e,"onFulfilled",e.fulfillValue):2===e.state&&x9(e,"onRejected",e.rejectReason)},x9=function(e,t,i){if(0!==e[t].length){var r=e[t];e[t]=[];var n=function(){for(var e=0;e<r.length;e++)r[e](i)};"function"==typeof setImmediate?setImmediate(n):setTimeout(n,0)}},x7=function(e,t,i){return function(r){if("function"!=typeof e)t[i].call(t,r);else{var n;try{n=e(r)}catch(e){t.reject(e);return}_e(t,n)}}},_e=function(e,t){if(e===t||e.proxy===t)return void e.reject(TypeError("cannot resolve promise with itself"));if("object"===vA(t)&&null!==t||"function"==typeof t)try{i=t.then}catch(t){e.reject(t);return}if("function"==typeof i){var i,r=!1;try{i.call(t,function(i){r||(r=!0,i===t?e.reject(TypeError("circular thenable chain")):_e(e,i))},function(t){r||(r=!0,e.reject(t))})}catch(t){r||e.reject(t)}return}e.fulfill(t)};x5.all=function(e){return new x5(function(t,i){for(var r=Array(e.length),n=0,a=function(i,a){r[i]=a,++n===e.length&&t(r)},s=0;s<e.length;s++)!function(t){var r=e[t];null!=r&&null!=r.then?r.then(function(e){a(t,e)},function(e){i(e)}):a(t,r)}(s)})},x5.resolve=function(e){return new x5(function(t,i){t(e)})},x5.reject=function(e){return new x5(function(t,i){i(e)})};var _t="undefined"!=typeof Promise?Promise:x5,_i=function(e,t,i){var r=vY(e),n=this._private=ye({duration:1e3},t,i);if(n.target=e,n.style=n.style||n.css,n.started=!1,n.playing=!1,n.hooked=!1,n.applying=!1,n.progress=0,n.completes=[],n.frames=[],n.complete&&vz(n.complete)&&n.completes.push(n.complete),!r){var a=e.position();n.startPosition=n.startPosition||{x:a.x,y:a.y},n.startStyle=n.startStyle||e.cy().style().getAnimationStartStyle(e,n.style)}if(r){var s=e.pan();n.startPan={x:s.x,y:s.y},n.startZoom=e.zoom()}this.length=1,this[0]=this},_r=_i.prototype;function _n(){return EK?EX:(EK=1,EX=Array.isArray)}function _a(){if(Ti)return Tt;Ti=1;var e=function(){if(E9)return E8;E9=1;var e=function(){if(E0)return EQ;E0=1;var e=yf(),t=yu();return EQ=function(i){if(!t(i))return!1;var r=e(i);return"[object Function]"==r||"[object GeneratorFunction]"==r||"[object AsyncFunction]"==r||"[object Proxy]"==r}}(),t=function(){if(E4)return E3;E4=1;var e,t=E2?E1:(E2=1,E1=yh()["__core-js_shared__"]),i=(e=/[^.]+$/.exec(t&&t.keys&&t.keys.IE_PROTO||""))?"Symbol(src)_1."+e:"";return E3=function(e){return!!i&&i in e}}(),i=yu(),r=function(){if(E6)return E5;E6=1;var e=Function.prototype.toString;return E5=function(t){if(null!=t){try{return e.call(t)}catch(e){}try{return t+""}catch(e){}}return""}}(),n=/^\[object .+?Constructor\]$/,a=Object.prototype,s=Function.prototype.toString,o=a.hasOwnProperty,l=RegExp("^"+s.call(o).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");return E8=function(a){return!(!i(a)||t(a))&&(e(a)?l:n).test(r(a))}}(),t=Te?E7:(Te=1,E7=function(e,t){return null==e?void 0:e[t]});return Tt=function(i,r){var n=t(i,r);return e(n)?n:void 0}}function _s(){return Tn?Tr:(Tn=1,Tr=_a()(Object,"create"))}function _o(){return Tx?Tb:(Tx=1,Tb=function(e,t){return e===t||e!=e&&t!=t})}function _l(){if(Tw)return T_;Tw=1;var e=_o();return T_=function(t,i){for(var r=t.length;r--;)if(e(t[r][0],i))return r;return -1}}function _c(){if(Tz)return TF;Tz=1;var e=TB?Tj:(TB=1,Tj=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e});return TF=function(t,i){var r=t.__data__;return e(i)?r["string"==typeof i?"string":"hash"]:r.map}}function _u(){if(T2)return T1;T2=1;var e=function(){if(T0)return TQ;T0=1;var e=function(){if(TJ)return TZ;TJ=1;var e=function(){if(TK)return TX;TK=1;var e=function(){if(TN)return TR;TN=1;var e=function(){if(Tm)return Tg;Tm=1;var e=function(){if(Ts)return Ta;Ts=1;var e=_s();return Ta=function(){this.__data__=e?e(null):{},this.size=0}}(),t=Tl?To:(Tl=1,To=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=!!t,t}),i=function(){if(Tu)return Tc;Tu=1;var e=_s(),t=Object.prototype.hasOwnProperty;return Tc=function(i){var r=this.__data__;if(e){var n=r[i];return"__lodash_hash_undefined__"===n?void 0:n}return t.call(r,i)?r[i]:void 0}}(),r=function(){if(Td)return Th;Td=1;var e=_s(),t=Object.prototype.hasOwnProperty;return Th=function(i){var r=this.__data__;return e?void 0!==r[i]:t.call(r,i)}}(),n=function(){if(Tp)return Tf;Tp=1;var e=_s();return Tf=function(t,i){var r=this.__data__;return this.size+=+!this.has(t),r[t]=e&&void 0===i?"__lodash_hash_undefined__":i,this}}();function a(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}return a.prototype.clear=e,a.prototype.delete=t,a.prototype.get=i,a.prototype.has=r,a.prototype.set=n,Tg=a}(),t=function(){if(TL)return TI;TL=1;var e=Ty?Tv:(Ty=1,Tv=function(){this.__data__=[],this.size=0}),t=function(){if(TE)return Tk;TE=1;var e=_l(),t=Array.prototype.splice;return Tk=function(i){var r=this.__data__,n=e(r,i);return!(n<0)&&(n==r.length-1?r.pop():t.call(r,n,1),--this.size,!0)}}(),i=function(){if(TP)return TT;TP=1;var e=_l();return TT=function(t){var i=this.__data__,r=e(i,t);return r<0?void 0:i[r][1]}}(),r=function(){if(TM)return TS;TM=1;var e=_l();return TS=function(t){return e(this.__data__,t)>-1}}(),n=function(){if(TA)return TC;TA=1;var e=_l();return TC=function(t,i){var r=this.__data__,n=e(r,t);return n<0?(++this.size,r.push([t,i])):r[n][1]=i,this}}();function a(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}return a.prototype.clear=e,a.prototype.delete=t,a.prototype.get=i,a.prototype.has=r,a.prototype.set=n,TI=a}(),i=TO?TD:(TO=1,TD=_a()(yh(),"Map"));return TR=function(){this.size=0,this.__data__={hash:new e,map:new(i||t),string:new e}}}(),t=function(){if(TU)return TV;TU=1;var e=_c();return TV=function(t){var i=e(this,t).delete(t);return this.size-=!!i,i}}(),i=function(){if(TW)return T$;TW=1;var e=_c();return T$=function(t){return e(this,t).get(t)}}(),r=function(){if(Tq)return TH;Tq=1;var e=_c();return TH=function(t){return e(this,t).has(t)}}(),n=function(){if(TY)return TG;TY=1;var e=_c();return TG=function(t,i){var r=e(this,t),n=r.size;return r.set(t,i),this.size+=+(r.size!=n),this}}();function a(e){var t=-1,i=null==e?0:e.length;for(this.clear();++t<i;){var r=e[t];this.set(r[0],r[1])}}return a.prototype.clear=e,a.prototype.delete=t,a.prototype.get=i,a.prototype.has=r,a.prototype.set=n,TX=a}();function t(i,r){if("function"!=typeof i||null!=r&&"function"!=typeof r)throw TypeError("Expected a function");var n=function(){var e=arguments,t=r?r.apply(this,e):e[0],a=n.cache;if(a.has(t))return a.get(t);var s=i.apply(this,e);return n.cache=a.set(t,s)||a,s};return n.cache=new(t.Cache||e),n}return t.Cache=e,TZ=t}();return TQ=function(t){var i=e(t,function(e){return 500===r.size&&r.clear(),e}),r=i.cache;return i}}(),t=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,i=/\\(\\)?/g;return T1=e(function(e){var r=[];return 46===e.charCodeAt(0)&&r.push(""),e.replace(t,function(e,t,n,a){r.push(n?a.replace(i,"$1"):t||e)}),r})}function _h(){return T4?T3:(T4=1,T3=function(e,t){for(var i=-1,r=null==e?0:e.length,n=Array(r);++i<r;)n[i]=t(e[i],i,e);return n})}function _d(){if(T9)return T8;T9=1;var e=function(){if(T6)return T5;T6=1;var e=yd(),t=_h(),i=_n(),r=yp(),n=e?e.prototype:void 0,a=n?n.toString:void 0;return T5=function e(n){if("string"==typeof n)return n;if(i(n))return t(n,e)+"";if(r(n))return a?a.call(n):"";var s=n+"";return"0"==s&&1/n==-1/0?"-0":s}}();return T8=function(t){return null==t?"":e(t)}}function _f(){if(Pe)return T7;Pe=1;var e=_n(),t=function(){if(EJ)return EZ;EJ=1;var e=_n(),t=yp(),i=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,r=/^\w*$/;return EZ=function(n,a){if(e(n))return!1;var s=typeof n;return!!("number"==s||"symbol"==s||"boolean"==s||null==n||t(n))||r.test(n)||!i.test(n)||null!=a&&n in Object(a)}}(),i=_u(),r=_d();return T7=function(n,a){return e(n)?n:t(n,a)?[n]:i(r(n))}}function _p(){if(Pi)return Pt;Pi=1;var e=yp();return Pt=function(t){if("string"==typeof t||e(t))return t;var i=t+"";return"0"==i&&1/t==-1/0?"-0":i}}ye(_r,{instanceString:function(){return"animation"},hook:function(){var e=this._private;if(!e.hooked){var t=e.target._private.animation;(e.queue?t.queue:t.current).push(this),vH(e.target)&&e.target.cy().addToAnimationPool(e.target),e.hooked=!0}return this},play:function(){var e=this._private;return 1===e.progress&&(e.progress=0),e.playing=!0,e.started=!1,e.stopped=!1,this.hook(),this},playing:function(){return this._private.playing},apply:function(){var e=this._private;return e.applying=!0,e.started=!1,e.stopped=!1,this.hook(),this},applying:function(){return this._private.applying},pause:function(){var e=this._private;return e.playing=!1,e.started=!1,this},stop:function(){var e=this._private;return e.playing=!1,e.started=!1,e.stopped=!0,this},rewind:function(){return this.progress(0)},fastforward:function(){return this.progress(1)},time:function(e){var t=this._private;return void 0===e?t.progress*t.duration:this.progress(e/t.duration)},progress:function(e){var t=this._private,i=t.playing;return void 0===e?t.progress:(i&&this.pause(),t.progress=e,t.started=!1,i&&this.play(),this)},completed:function(){return 1===this._private.progress},reverse:function(){var e=this._private,t=e.playing;t&&this.pause(),e.progress=1-e.progress,e.started=!1;var i=function(t,i){var r=e[t];null!=r&&(e[t]=e[i],e[i]=r)};if(i("zoom","startZoom"),i("pan","startPan"),i("position","startPosition"),e.style)for(var r=0;r<e.style.length;r++){var n=e.style[r],a=n.name,s=e.startStyle[a];e.startStyle[a]=n,e.style[r]=s}return t&&this.play(),this},promise:function(e){var t,i=this._private;return t="frame"===e?i.frames:i.completes,new _t(function(e,i){t.push(function(){e()})})}}),_r.complete=_r.completed,_r.run=_r.play,_r.running=_r.playing;var _g=yc(function(){if(Ps)return Pa;Ps=1;var e=function(){if(Pn)return Pr;Pn=1;var e=_f(),t=_p();return Pr=function(i,r){r=e(r,i);for(var n=0,a=r.length;null!=i&&n<a;)i=i[t(r[n++])];return n&&n==a?i:void 0}}();return Pa=function(t,i,r){var n=null==t?void 0:e(t,i);return void 0===n?r:n}}()),_m=yc(function(){if(Py)return Pv;Py=1;var e=function(){if(Pm)return Pg;Pm=1;var e=function(){if(Pd)return Ph;Pd=1;var e=function(){if(Pu)return Pc;Pu=1;var e=function(){if(Pl)return Po;Pl=1;var e=_a();return Po=function(){try{var t=e(Object,"defineProperty");return t({},"",{}),t}catch(e){}}()}();return Pc=function(t,i,r){"__proto__"==i&&e?e(t,i,{configurable:!0,enumerable:!0,value:r,writable:!0}):t[i]=r}}(),t=_o(),i=Object.prototype.hasOwnProperty;return Ph=function(r,n,a){var s=r[n];i.call(r,n)&&t(s,a)&&(void 0!==a||n in r)||e(r,n,a)}}(),t=_f(),i=function(){if(Pp)return Pf;Pp=1;var e=/^(?:0|[1-9]\d*)$/;return Pf=function(t,i){var r=typeof t;return!!(i=null==i?0x1fffffffffffff:i)&&("number"==r||"symbol"!=r&&e.test(t))&&t>-1&&t%1==0&&t<i}}(),r=yu(),n=_p();return Pg=function(a,s,o,l){if(!r(a))return a;s=t(s,a);for(var c=-1,u=s.length,h=u-1,d=a;null!=d&&++c<u;){var f=n(s[c]),p=o;if("__proto__"===f||"constructor"===f||"prototype"===f)break;if(c!=h){var g=d[f];void 0===(p=l?l(g,f,d):void 0)&&(p=r(g)?g:i(s[c+1])?[]:{})}e(d,f,p),d=d[f]}return a}}();return Pv=function(t,i,r){return null==t?t:e(t,i,r)}}()),_v=yc(function(){if(Pw)return P_;Pw=1;var e=_h(),t=Px?Pb:(Px=1,Pb=function(e,t){var i=-1,r=e.length;for(t||(t=Array(r));++i<r;)t[i]=e[i];return t}),i=_n(),r=yp(),n=_u(),a=_p(),s=_d();return P_=function(o){return i(o)?e(o,a):r(o)?[o]:t(n(s(o)))}}()),_y={};[{animated:function(){return function(){var e=void 0!==this.length;if(!(this._private.cy||this).styleEnabled())return!1;var t=(e?this:[this])[0];if(t)return t._private.animation.current.length>0}},clearQueue:function(){return function(){var e=void 0!==this.length?this:[this];if(!(this._private.cy||this).styleEnabled())return this;for(var t=0;t<e.length;t++)e[t]._private.animation.queue=[];return this}},delay:function(){return function(e,t){return(this._private.cy||this).styleEnabled()?this.animate({delay:e,duration:e,complete:t}):this}},delayAnimation:function(){return function(e,t){return(this._private.cy||this).styleEnabled()?this.animation({delay:e,duration:e,complete:t}):this}},animation:function(){return function(e,t){var i=void 0!==this.length,r=i?this:[this],n=this._private.cy||this,a=!i,s=!a;if(!n.styleEnabled())return this;var o=n.style();if(0===Object.keys(e=ye({},e,t)).length)return new _i(r[0],e);switch(void 0===e.duration&&(e.duration=400),e.duration){case"slow":e.duration=600;break;case"fast":e.duration=200}if(s&&(e.style=o.getPropsList(e.style||e.css),e.css=void 0),s&&null!=e.renderedPosition){var l=e.renderedPosition,c=n.pan(),u=n.zoom();e.position=bn(l,u,c)}if(a&&null!=e.panBy){var h=e.panBy,d=n.pan();e.pan={x:d.x+h.x,y:d.y+h.y}}var f=e.center||e.centre;if(a&&null!=f){var p=n.getCenterPan(f.eles,e.zoom);null!=p&&(e.pan=p)}if(a&&null!=e.fit){var g=e.fit,v=n.getFitViewport(g.eles||g.boundingBox,g.padding);null!=v&&(e.pan=v.pan,e.zoom=v.zoom)}if(a&&vU(e.zoom)){var y=n.getZoomedViewport(e.zoom);null!=y?(y.zoomed&&(e.zoom=y.zoom),y.panned&&(e.pan=y.pan)):e.zoom=null}return new _i(r[0],e)}},animate:function(){return function(e,t){var i=void 0!==this.length?this:[this];if(!(this._private.cy||this).styleEnabled())return this;t&&(e=ye({},e,t));for(var r=0;r<i.length;r++){var n=i[r],a=n.animated()&&(void 0===e.queue||e.queue);n.animation(e,a?{queue:!0}:void 0).play()}return this}},stop:function(){return function(e,t){var i=void 0!==this.length?this:[this],r=this._private.cy||this;if(!r.styleEnabled())return this;for(var n=0;n<i.length;n++){for(var a=i[n]._private,s=a.animation.current,o=0;o<s.length;o++){var l=s[o]._private;t&&(l.duration=0)}e&&(a.animation.queue=[]),t||(a.animation.current=[])}return r.notify("draw"),this}}},{data:function(e){return e=ye({},{field:"data",bindingEvent:"data",allowBinding:!1,allowSetting:!1,allowGetting:!1,settingEvent:"data",settingTriggersEvent:!1,triggerFnName:"trigger",immutableKeys:{},updateStyle:!1,beforeGet:function(e){},beforeSet:function(e,t){},onSet:function(e){},canSet:function(e){return!0}},e),function(t,i){var r,n=e,a=void 0!==this.length,s=a?this:[this],o=a?this[0]:this;if(vF(t)){var l,c=-1!==t.indexOf(".")&&_v(t);if(n.allowGetting&&void 0===i)return o&&(n.beforeGet(o),l=c&&void 0===o._private[n.field][t]?_g(o._private[n.field],c):o._private[n.field][t]),l;if(n.allowSetting&&void 0!==i&&!n.immutableKeys[t]){var u=vP({},t,i);n.beforeSet(this,u);for(var h=0,d=s.length;h<d;h++){var f=s[h];n.canSet(f)&&(c&&void 0===o._private[n.field][t]?_m(f._private[n.field],c,i):f._private[n.field][t]=i)}n.updateStyle&&this.updateStyle(),n.onSet(this),n.settingTriggersEvent&&this[n.triggerFnName](n.settingEvent)}}else if(n.allowSetting&&vU(t)){var p,g,v=Object.keys(t);n.beforeSet(this,t);for(var y=0;y<v.length;y++)if(g=t[p=v[y]],!n.immutableKeys[p])for(var b=0;b<s.length;b++){var x=s[b];n.canSet(x)&&(x._private[n.field][p]=g)}n.updateStyle&&this.updateStyle(),n.onSet(this),n.settingTriggersEvent&&this[n.triggerFnName](n.settingEvent)}else if(n.allowBinding&&vz(t))this.on(n.bindingEvent,t);else if(n.allowGetting&&void 0===t)return o&&(n.beforeGet(o),r=o._private[n.field]),r;return this}},removeData:function(e){return e=ye({},{field:"data",event:"data",triggerFnName:"trigger",triggerEvent:!1,immutableKeys:{}},e),function(t){var i=e,r=void 0!==this.length?this:[this];if(vF(t)){for(var n=t.split(/\s+/),a=n.length,s=0;s<a;s++){var o=n[s];if(!vK(o)&&!i.immutableKeys[o])for(var l=0,c=r.length;l<c;l++)r[l]._private[i.field][o]=void 0}i.triggerEvent&&this[i.triggerFnName](i.event)}else if(void 0===t){for(var u=0,h=r.length;u<h;u++)for(var d=r[u]._private[i.field],f=Object.keys(d),p=0;p<f.length;p++){var g=f[p];i.immutableKeys[g]||(d[g]=void 0)}i.triggerEvent&&this[i.triggerFnName](i.event)}return this}}},{eventAliasesOn:function(e){e.addListener=e.listen=e.bind=e.on,e.unlisten=e.unbind=e.off=e.removeListener,e.trigger=e.emit,e.pon=e.promiseOn=function(e,t){var i=this,r=Array.prototype.slice.call(arguments,0);return new _t(function(e,t){var n=r.concat([function(t){i.off.apply(i,a),e(t)}]),a=n.concat([]);i.on.apply(i,n)})}}}].forEach(function(e){ye(_y,e)});var _b={animate:_y.animate(),animation:_y.animation(),animated:_y.animated(),clearQueue:_y.clearQueue(),delay:_y.delay(),delayAnimation:_y.delayAnimation(),stop:_y.stop()},_x={classes:function(e){if(void 0===e){var t=[];return this[0]._private.classes.forEach(function(e){return t.push(e)}),t}vV(e)||(e=(e||"").match(/\S+/g)||[]);for(var i=[],r=new yQ(e),n=0;n<this.length;n++){for(var a=this[n],s=a._private,o=s.classes,l=!1,c=0;c<e.length;c++){var u=e[c];if(!o.has(u)){l=!0;break}}l||(l=o.size!==e.length),l&&(s.classes=r,i.push(a))}return i.length>0&&this.spawn(i).updateStyle().emit("class"),this},addClass:function(e){return this.toggleClass(e,!0)},hasClass:function(e){var t=this[0];return null!=t&&t._private.classes.has(e)},toggleClass:function(e,t){vV(e)||(e=e.match(/\S+/g)||[]);for(var i=void 0===t,r=[],n=0,a=this.length;n<a;n++)for(var s=this[n],o=s._private.classes,l=!1,c=0;c<e.length;c++){var u=e[c],h=o.has(u),d=!1;t||i&&!h?(o.add(u),d=!0):(!t||i&&h)&&(o.delete(u),d=!0),!l&&d&&(r.push(s),l=!0)}return r.length>0&&this.spawn(r).updateStyle().emit("class"),this},removeClass:function(e){return this.toggleClass(e,!1)},flashClass:function(e,t){var i=this;if(null==t)t=250;else if(0===t)return i;return i.addClass(e),setTimeout(function(){i.removeClass(e)},t),i}};_x.className=_x.classNames=_x.classes;var __={metaChar:"[\\!\\\"\\#\\$\\%\\&\\'\\(\\)\\*\\+\\,\\.\\/\\:\\;\\<\\=\\>\\?\\@\\[\\]\\^\\`\\{\\|\\}\\~]",comparatorOp:"=|\\!=|>|>=|<|<=|\\$=|\\^=|\\*=",boolOp:"\\?|\\!|\\^",string:"\"(?:\\\\\"|[^\"])*\"|'(?:\\\\'|[^'])*'",number:v4,meta:"degree|indegree|outdegree",separator:"\\s*,\\s*",descendant:"\\s+",child:"\\s+>\\s+",subject:"\\$",group:"node|edge|\\*",directedEdge:"\\s+->\\s+",undirectedEdge:"\\s+<->\\s+"};for(Eo=0,__.variable="(?:[\\w-.]|(?:\\\\"+__.metaChar+"))+",__.className="(?:[\\w-]|(?:\\\\"+__.metaChar+"))+",__.value=__.string+"|"+__.number,__.id=__.variable,Ea=__.comparatorOp.split("|");Eo<Ea.length;Eo++)Es=Ea[Eo],__.comparatorOp+="|@"+Es;for(Eo=0,Ea=__.comparatorOp.split("|");Eo<Ea.length;Eo++)(Es=Ea[Eo]).indexOf("!")>=0||"="!==Es&&(__.comparatorOp+="|\\!"+Es);var _w=function(){return{checks:[]}},_k=[{selector:":selected",matches:function(e){return e.selected()}},{selector:":unselected",matches:function(e){return!e.selected()}},{selector:":selectable",matches:function(e){return e.selectable()}},{selector:":unselectable",matches:function(e){return!e.selectable()}},{selector:":locked",matches:function(e){return e.locked()}},{selector:":unlocked",matches:function(e){return!e.locked()}},{selector:":visible",matches:function(e){return e.visible()}},{selector:":hidden",matches:function(e){return!e.visible()}},{selector:":transparent",matches:function(e){return e.transparent()}},{selector:":grabbed",matches:function(e){return e.grabbed()}},{selector:":free",matches:function(e){return!e.grabbed()}},{selector:":removed",matches:function(e){return e.removed()}},{selector:":inside",matches:function(e){return!e.removed()}},{selector:":grabbable",matches:function(e){return e.grabbable()}},{selector:":ungrabbable",matches:function(e){return!e.grabbable()}},{selector:":animated",matches:function(e){return e.animated()}},{selector:":unanimated",matches:function(e){return!e.animated()}},{selector:":parent",matches:function(e){return e.isParent()}},{selector:":childless",matches:function(e){return e.isChildless()}},{selector:":child",matches:function(e){return e.isChild()}},{selector:":orphan",matches:function(e){return e.isOrphan()}},{selector:":nonorphan",matches:function(e){return e.isChild()}},{selector:":compound",matches:function(e){return e.isNode()?e.isParent():e.source().isParent()||e.target().isParent()}},{selector:":loop",matches:function(e){return e.isLoop()}},{selector:":simple",matches:function(e){return e.isSimple()}},{selector:":active",matches:function(e){return e.active()}},{selector:":inactive",matches:function(e){return!e.active()}},{selector:":backgrounding",matches:function(e){return e.backgrounding()}},{selector:":nonbackgrounding",matches:function(e){return!e.backgrounding()}}].sort(function(e,t){return -1*v7(e.selector,t.selector)}),_E=function(){for(var e,t={},i=0;i<_k.length;i++)t[(e=_k[i]).selector]=e.matches;return t}(),_T="("+_k.map(function(e){return e.selector}).join("|")+")",_P=function(e){return e.replace(RegExp("\\\\("+__.metaChar+")","g"),function(e,t){return t})},_S=function(e,t,i){e[e.length-1]=i},_M=[{name:"group",query:!0,regex:"("+__.group+")",populate:function(e,t,i){var r=vS(i,1)[0];t.checks.push({type:0,value:"*"===r?r:r+"s"})}},{name:"state",query:!0,regex:_T,populate:function(e,t,i){var r=vS(i,1)[0];t.checks.push({type:7,value:r})}},{name:"id",query:!0,regex:"\\#("+__.id+")",populate:function(e,t,i){var r=vS(i,1)[0];t.checks.push({type:8,value:_P(r)})}},{name:"className",query:!0,regex:"\\.("+__.className+")",populate:function(e,t,i){var r=vS(i,1)[0];t.checks.push({type:9,value:_P(r)})}},{name:"dataExists",query:!0,regex:"\\[\\s*("+__.variable+")\\s*\\]",populate:function(e,t,i){var r=vS(i,1)[0];t.checks.push({type:4,field:_P(r)})}},{name:"dataCompare",query:!0,regex:"\\[\\s*("+__.variable+")\\s*("+__.comparatorOp+")\\s*("+__.value+")\\s*\\]",populate:function(e,t,i){var r=vS(i,3),n=r[0],a=r[1],s=r[2];s=null!=RegExp("^"+__.string+"$").exec(s)?s.substring(1,s.length-1):parseFloat(s),t.checks.push({type:3,field:_P(n),operator:a,value:s})}},{name:"dataBool",query:!0,regex:"\\[\\s*("+__.boolOp+")\\s*("+__.variable+")\\s*\\]",populate:function(e,t,i){var r=vS(i,2),n=r[0],a=r[1];t.checks.push({type:5,field:_P(a),operator:n})}},{name:"metaCompare",query:!0,regex:"\\[\\[\\s*("+__.meta+")\\s*("+__.comparatorOp+")\\s*("+__.number+")\\s*\\]\\]",populate:function(e,t,i){var r=vS(i,3),n=r[0],a=r[1],s=r[2];t.checks.push({type:6,field:_P(n),operator:a,value:parseFloat(s)})}},{name:"nextQuery",separator:!0,regex:__.separator,populate:function(e,t){var i=e.currentSubject,r=e.edgeCount,n=e.compoundCount,a=e[e.length-1];return null!=i&&(a.subject=i,e.currentSubject=null),a.edgeCount=r,a.compoundCount=n,e.edgeCount=0,e.compoundCount=0,e[e.length++]=_w()}},{name:"directedEdge",separator:!0,regex:__.directedEdge,populate:function(e,t){if(null==e.currentSubject){var i=_w(),r=_w();return i.checks.push({type:11,source:t,target:r}),_S(e,t,i),e.edgeCount++,r}var n=_w(),a=_w();return n.checks.push({type:12,source:t,target:a}),_S(e,t,n),e.edgeCount++,a}},{name:"undirectedEdge",separator:!0,regex:__.undirectedEdge,populate:function(e,t){if(null==e.currentSubject){var i=_w(),r=_w();return i.checks.push({type:10,nodes:[t,r]}),_S(e,t,i),e.edgeCount++,r}var n=_w(),a=_w();return n.checks.push({type:14,node:t,neighbor:a}),_S(e,t,n),a}},{name:"child",separator:!0,regex:__.child,populate:function(e,t){if(null==e.currentSubject){var i=_w(),r=_w(),n=e[e.length-1];return i.checks.push({type:15,parent:n,child:r}),_S(e,t,i),e.compoundCount++,r}if(e.currentSubject===t){var a=_w(),s=e[e.length-1],o=_w(),l=_w(),c=_w(),u=_w();return a.checks.push({type:19,left:s,right:o,subject:l}),l.checks=t.checks,t.checks=[{type:20}],u.checks.push({type:20}),o.checks.push({type:17,parent:u,child:c}),_S(e,s,a),e.currentSubject=l,e.compoundCount++,c}var h=_w(),d=_w(),f=[{type:17,parent:h,child:d}];return h.checks=t.checks,t.checks=f,e.compoundCount++,d}},{name:"descendant",separator:!0,regex:__.descendant,populate:function(e,t){if(null==e.currentSubject){var i=_w(),r=_w(),n=e[e.length-1];return i.checks.push({type:16,ancestor:n,descendant:r}),_S(e,t,i),e.compoundCount++,r}if(e.currentSubject===t){var a=_w(),s=e[e.length-1],o=_w(),l=_w(),c=_w(),u=_w();return a.checks.push({type:19,left:s,right:o,subject:l}),l.checks=t.checks,t.checks=[{type:20}],u.checks.push({type:20}),o.checks.push({type:18,ancestor:u,descendant:c}),_S(e,s,a),e.currentSubject=l,e.compoundCount++,c}var h=_w(),d=_w(),f=[{type:18,ancestor:h,descendant:d}];return h.checks=t.checks,t.checks=f,e.compoundCount++,d}},{name:"subject",modifier:!0,regex:__.subject,populate:function(e,t){if(null!=e.currentSubject&&e.currentSubject!==t)return yF("Redefinition of subject in selector `"+e.toString()+"`"),!1;e.currentSubject=t;var i=e[e.length-1].checks[0],r=null==i?null:i.type;11===r?i.type=13:10===r&&(i.type=14,i.node=i.nodes[1],i.neighbor=i.nodes[0],i.nodes=null)}}];_M.forEach(function(e){return e.regexObj=RegExp("^"+e.regex)});var _C=function(e){for(var t,i,r,n=0;n<_M.length;n++){var a=_M[n],s=a.name,o=e.match(a.regexObj);if(null!=o){i=o,t=a,r=s;var l=o[0];e=e.substring(l.length);break}}return{expr:t,match:i,name:r,remaining:e}},_A=function(e){var t=e.match(/^\s+/);if(t){var i=t[0];e=e.substring(i.length)}return e},_I=function(e,t,i){var r,n,a,s=vF(e),o=v$(e),l=vF(i),c=!1,u=!1,h=!1;switch(t.indexOf("!")>=0&&(t=t.replace("!",""),u=!0),t.indexOf("@")>=0&&(t=t.replace("@",""),c=!0),(s||l||c)&&(n=s||o?""+e:"",a=""+i),c&&(e=n=n.toLowerCase(),i=a=a.toLowerCase()),t){case"*=":r=n.indexOf(a)>=0;break;case"$=":r=n.indexOf(a,n.length-a.length)>=0;break;case"^=":r=0===n.indexOf(a);break;case"=":r=e===i;break;case">":h=!0,r=e>i;break;case">=":h=!0,r=e>=i;break;case"<":h=!0,r=e<i;break;case"<=":h=!0,r=e<=i;break;default:r=!1}return u&&(null!=e||!h)&&(r=!r),r},_L=function(e,t){switch(t){case"?":return!!e;case"!":return!e;case"^":return void 0===e}},_D=function(e,t){return e.data(t)},_O=[],_R=function(e,t){return e.checks.every(function(e){return _O[e.type](e,t)})};_O[0]=function(e,t){var i=e.value;return"*"===i||i===t.group()},_O[7]=function(e,t){var i;return i=e.value,_E[i](t)},_O[8]=function(e,t){var i=e.value;return t.id()===i},_O[9]=function(e,t){var i=e.value;return t.hasClass(i)},_O[6]=function(e,t){var i=e.field,r=e.operator,n=e.value;return _I(t[i](),r,n)},_O[3]=function(e,t){var i=e.field,r=e.operator,n=e.value;return _I(_D(t,i),r,n)},_O[5]=function(e,t){var i=e.field,r=e.operator;return _L(_D(t,i),r)},_O[4]=function(e,t){var i=e.field;return e.operator,void 0!==_D(t,i)},_O[10]=function(e,t){var i=e.nodes[0],r=e.nodes[1],n=t.source(),a=t.target();return _R(i,n)&&_R(r,a)||_R(r,n)&&_R(i,a)},_O[14]=function(e,t){return _R(e.node,t)&&t.neighborhood().some(function(t){return t.isNode()&&_R(e.neighbor,t)})},_O[11]=function(e,t){return _R(e.source,t.source())&&_R(e.target,t.target())},_O[12]=function(e,t){return _R(e.source,t)&&t.outgoers().some(function(t){return t.isNode()&&_R(e.target,t)})},_O[13]=function(e,t){return _R(e.target,t)&&t.incomers().some(function(t){return t.isNode()&&_R(e.source,t)})},_O[15]=function(e,t){return _R(e.child,t)&&_R(e.parent,t.parent())},_O[17]=function(e,t){return _R(e.parent,t)&&t.children().some(function(t){return _R(e.child,t)})},_O[16]=function(e,t){return _R(e.descendant,t)&&t.ancestors().some(function(t){return _R(e.ancestor,t)})},_O[18]=function(e,t){return _R(e.ancestor,t)&&t.descendants().some(function(t){return _R(e.descendant,t)})},_O[19]=function(e,t){return _R(e.subject,t)&&_R(e.left,t)&&_R(e.right,t)},_O[20]=function(){return!0},_O[1]=function(e,t){return e.value.has(t)},_O[2]=function(e,t){return(0,e.value)(t)};var _N=function(e){this.inputText=e,this.currentSubject=null,this.compoundCount=0,this.edgeCount=0,this.length=0,null==e||vF(e)&&e.match(/^\s*$/)||(vH(e)?this.addQuery({checks:[{type:1,value:e.collection()}]}):vz(e)?this.addQuery({checks:[{type:2,value:e}]}):vF(e)?this.parse(e)||(this.invalid=!0):yj("A selector must be created from a string; found "))},_j=_N.prototype;[{parse:function(e){var t=this.inputText=e,i=this[0]=_w();for(this.length=1,t=_A(t);;){var r=_C(t);if(null==r.expr)return yF("The selector `"+e+"`is invalid"),!1;var n=r.match.slice(1),a=r.expr.populate(this,i,n);if(!1===a)return!1;if(null!=a&&(i=a),(t=r.remaining).match(/^\s*$/))break}var s=this[this.length-1];null!=this.currentSubject&&(s.subject=this.currentSubject),s.edgeCount=this.edgeCount,s.compoundCount=this.compoundCount;for(var o=0;o<this.length;o++){var l=this[o];if(l.compoundCount>0&&l.edgeCount>0)return yF("The selector `"+e+"` is invalid because it uses both a compound selector and an edge selector"),!1;if(l.edgeCount>1)return yF("The selector `"+e+"` is invalid because it uses multiple edge selectors"),!1;1===l.edgeCount&&yF("The selector `"+e+"` is deprecated.  Edge selectors do not take effect on changes to source and target nodes after an edge is added, for performance reasons.  Use a class or data selector on edges instead, updating the class or data of an edge when your app detects a change in source or target nodes.")}return!0},toString:function(){if(null!=this.toStringCache)return this.toStringCache;for(var e=function(e){return null==e?"":e},t=function(t){return vF(t)?'"'+t+'"':e(t)},i=function(e){return" "+e+" "},r=function(r,a){var s=r.type,o=r.value;switch(s){case 0:var l=e(o);return l.substring(0,l.length-1);case 3:return"["+r.field+i(e(r.operator))+t(o)+"]";case 5:var c=r.operator,u=r.field;return"["+e(c)+u+"]";case 4:return"["+r.field+"]";case 6:var h=r.operator;return"[["+r.field+i(e(h))+t(o)+"]]";case 7:return o;case 8:return"#"+o;case 9:return"."+o;case 17:case 15:return n(r.parent,a)+i(">")+n(r.child,a);case 18:case 16:return n(r.ancestor,a)+" "+n(r.descendant,a);case 19:var d=n(r.left,a),f=n(r.subject,a),p=n(r.right,a);return d+(d.length>0?" ":"")+f+p;case 20:return""}},n=function(e,t){return e.checks.reduce(function(i,n,a){return i+(t===e&&0===a?"$":"")+r(n,t)},"")},a="",s=0;s<this.length;s++){var o=this[s];a+=n(o,o.subject),this.length>1&&s<this.length-1&&(a+=", ")}return this.toStringCache=a,a}},{matches:function(e){for(var t=0;t<this.length;t++)if(_R(this[t],e))return!0;return!1},filter:function(e){var t=this;if(1===t.length&&1===t[0].checks.length&&8===t[0].checks[0].type)return e.getElementById(t[0].checks[0].value).collection();var i=function(e){for(var i=0;i<t.length;i++)if(_R(t[i],e))return!0;return!1};return null==t.text()&&(i=function(){return!0}),e.filter(i)}}].forEach(function(e){return ye(_j,e)}),_j.text=function(){return this.inputText},_j.size=function(){return this.length},_j.eq=function(e){return this[e]},_j.sameText=function(e){return!this.invalid&&!e.invalid&&this.text()===e.text()},_j.addQuery=function(e){this[this.length++]=e},_j.selector=_j.toString;var _B={allAre:function(e){var t=new _N(e);return this.every(function(e){return t.matches(e)})},is:function(e){var t=new _N(e);return this.some(function(e){return t.matches(e)})},some:function(e,t){for(var i=0;i<this.length;i++)if(t?e.apply(t,[this[i],i,this]):e(this[i],i,this))return!0;return!1},every:function(e,t){for(var i=0;i<this.length;i++)if(!(t?e.apply(t,[this[i],i,this]):e(this[i],i,this)))return!1;return!0},same:function(e){if(this===e)return!0;e=this.cy().collection(e);var t=this.length;return t===e.length&&(1===t?this[0]===e[0]:this.every(function(t){return e.hasElementWithId(t.id())}))},anySame:function(e){return e=this.cy().collection(e),this.some(function(t){return e.hasElementWithId(t.id())})},allAreNeighbors:function(e){e=this.cy().collection(e);var t=this.neighborhood();return e.every(function(e){return t.hasElementWithId(e.id())})},contains:function(e){e=this.cy().collection(e);var t=this;return e.every(function(e){return t.hasElementWithId(e.id())})}};_B.allAreNeighbours=_B.allAreNeighbors,_B.has=_B.contains,_B.equal=_B.equals=_B.same;var _F=function(e,t){return function(i,r,n,a){if(null==i?s="":vH(i)&&1===i.length&&(s=i.id()),1!==this.length||!s)return e.call(this,i,r,n,a);var s,o=this[0]._private,l=o.traversalCache=o.traversalCache||{},c=l[t]=l[t]||[],u=yP(s),h=c[u];return h||(c[u]=e.call(this,i,r,n,a))}},_z={parent:function(e){var t=[];if(1===this.length){var i=this[0]._private.parent;if(i)return i}for(var r=0;r<this.length;r++){var n=this[r]._private.parent;n&&t.push(n)}return this.spawn(t,!0).filter(e)},parents:function(e){for(var t=[],i=this.parent();i.nonempty();){for(var r=0;r<i.length;r++){var n=i[r];t.push(n)}i=i.parent()}return this.spawn(t,!0).filter(e)},commonAncestors:function(e){for(var t,i=0;i<this.length;i++){var r=this[i].parents();t=(t=t||r).intersect(r)}return t.filter(e)},orphans:function(e){return this.stdFilter(function(e){return e.isOrphan()}).filter(e)},nonorphans:function(e){return this.stdFilter(function(e){return e.isChild()}).filter(e)},children:_F(function(e){for(var t=[],i=0;i<this.length;i++)for(var r=this[i]._private.children,n=0;n<r.length;n++)t.push(r[n]);return this.spawn(t,!0).filter(e)},"children"),siblings:function(e){return this.parent().children().not(this).filter(e)},isParent:function(){var e=this[0];if(e)return e.isNode()&&0!==e._private.children.length},isChildless:function(){var e=this[0];if(e)return e.isNode()&&0===e._private.children.length},isChild:function(){var e=this[0];if(e)return e.isNode()&&null!=e._private.parent},isOrphan:function(){var e=this[0];if(e)return e.isNode()&&null==e._private.parent},descendants:function(e){var t=[];return!function e(i){for(var r=0;r<i.length;r++){var n=i[r];t.push(n),n.children().nonempty()&&e(n.children())}}(this.children()),this.spawn(t,!0).filter(e)}};function _V(e,t,i,r){for(var n=[],a=new yQ,s=e.cy().hasCompoundNodes(),o=0;o<e.length;o++){var l=e[o];i?n.push(l):s&&r(n,a,l)}for(;n.length>0;){var c=n.shift();t(c),a.add(c.id()),s&&r(n,a,c)}return e}function _U(e,t,i){if(i.isParent())for(var r=i._private.children,n=0;n<r.length;n++){var a=r[n];t.has(a.id())||e.push(a)}}function _$(e,t,i){if(i.isChild()){var r=i._private.parent;t.has(r.id())||e.push(r)}}function _W(e,t,i){_$(e,t,i),_U(e,t,i)}_z.forEachDown=function(e){var t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];return _V(this,e,t,_U)},_z.forEachUp=function(e){var t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];return _V(this,e,t,_$)},_z.forEachUpAndDown=function(e){var t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];return _V(this,e,t,_W)},_z.ancestors=_z.parents,(Pk=PE={data:_y.data({field:"data",bindingEvent:"data",allowBinding:!0,allowSetting:!0,settingEvent:"data",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0,immutableKeys:{id:!0,source:!0,target:!0,parent:!0},updateStyle:!0}),removeData:_y.removeData({field:"data",event:"data",triggerFnName:"trigger",triggerEvent:!0,immutableKeys:{id:!0,source:!0,target:!0,parent:!0},updateStyle:!0}),scratch:_y.data({field:"scratch",bindingEvent:"scratch",allowBinding:!0,allowSetting:!0,settingEvent:"scratch",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0,updateStyle:!0}),removeScratch:_y.removeData({field:"scratch",event:"scratch",triggerFnName:"trigger",triggerEvent:!0,updateStyle:!0}),rscratch:_y.data({field:"rscratch",allowBinding:!1,allowSetting:!0,settingTriggersEvent:!1,allowGetting:!0}),removeRscratch:_y.removeData({field:"rscratch",triggerEvent:!1}),id:function(){var e=this[0];if(e)return e._private.data.id}}).attr=Pk.data,Pk.removeAttr=Pk.removeData;var _H={};function _q(e){return function(t){if(void 0===t&&(t=!0),0!==this.length)if(!this.isNode()||this.removed())return;else{for(var i=0,r=this[0],n=r._private.edges,a=0;a<n.length;a++){var s=n[a];!t&&s.isLoop()||(i+=e(r,s))}return i}}}function _G(e,t){return function(i){for(var r,n=this.nodes(),a=0;a<n.length;a++){var s=n[a][e](i);void 0!==s&&(void 0===r||t(s,r))&&(r=s)}return r}}ye(_H,{degree:_q(function(e,t){return t.source().same(t.target())?2:1}),indegree:_q(function(e,t){return+!!t.target().same(e)}),outdegree:_q(function(e,t){return+!!t.source().same(e)})}),ye(_H,{minDegree:_G("degree",function(e,t){return e<t}),maxDegree:_G("degree",function(e,t){return e>t}),minIndegree:_G("indegree",function(e,t){return e<t}),maxIndegree:_G("indegree",function(e,t){return e>t}),minOutdegree:_G("outdegree",function(e,t){return e<t}),maxOutdegree:_G("outdegree",function(e,t){return e>t})}),ye(_H,{totalDegree:function(e){for(var t=0,i=this.nodes(),r=0;r<i.length;r++)t+=i[r].degree(e);return t}});var _Y=function(e,t,i){for(var r=0;r<e.length;r++){var n=e[r];if(!n.locked()){var a=n._private.position,s={x:null!=t.x?t.x-a.x:0,y:null!=t.y?t.y-a.y:0};n.isParent()&&(0!==s.x||0!==s.y)&&n.children().shift(s,i),n.dirtyBoundingBoxCache()}}},_X={field:"position",bindingEvent:"position",allowBinding:!0,allowSetting:!0,settingEvent:"position",settingTriggersEvent:!0,triggerFnName:"emitAndNotify",allowGetting:!0,validKeys:["x","y"],beforeGet:function(e){e.updateCompoundBounds()},beforeSet:function(e,t){_Y(e,t,!1)},onSet:function(e){e.dirtyCompoundBoundsCache()},canSet:function(e){return!e.locked()}};(PT=PP={position:_y.data(_X),silentPosition:_y.data(ye({},_X,{allowBinding:!1,allowSetting:!0,settingTriggersEvent:!1,allowGetting:!1,beforeSet:function(e,t){_Y(e,t,!0)},onSet:function(e){e.dirtyCompoundBoundsCache()}})),positions:function(e,t){if(vU(e))t?this.silentPosition(e):this.position(e);else if(vz(e)){var i=this.cy();i.startBatch();for(var r=0;r<this.length;r++){var n=this[r],a=void 0;(a=e(n,r))&&(t?n.silentPosition(a):n.position(a))}i.endBatch()}return this},silentPositions:function(e){return this.positions(e,!0)},shift:function(e,t,i){var r;if(vU(e)?(r={x:v$(e.x)?e.x:0,y:v$(e.y)?e.y:0},i=t):vF(e)&&v$(t)&&((r={x:0,y:0})[e]=t),null!=r){var n=this.cy();n.startBatch();for(var a=0;a<this.length;a++){var s=this[a];if(!(n.hasCompoundNodes()&&s.isChild()&&s.ancestors().anySame(this))){var o=s.position(),l={x:o.x+r.x,y:o.y+r.y};i?s.silentPosition(l):s.position(l)}}n.endBatch()}return this},silentShift:function(e,t){return vU(e)?this.shift(e,!0):vF(e)&&v$(t)&&this.shift(e,t,!0),this},renderedPosition:function(e,t){var i=this[0],r=this.cy(),n=r.zoom(),a=r.pan(),s=vU(e)?e:void 0,o=void 0!==s||void 0!==t&&vF(e);if(i&&i.isNode())if(!o)return(s=br(i.position(),n,a),void 0===e)?s:s[e];else for(var l=0;l<this.length;l++){var c=this[l];void 0!==t?c.position(e,(t-a[e])/n):void 0!==s&&c.position(bn(s,n,a))}else if(!o)return;return this},relativePosition:function(e,t){var i=this[0],r=this.cy(),n=vU(e)?e:void 0,a=void 0!==n||void 0!==t&&vF(e),s=r.hasCompoundNodes();if(i&&i.isNode())if(a)for(var o=0;o<this.length;o++){var l=this[o],c=s?l.parent():null,u=c&&c.length>0;u&&(c=c[0]);var h=u?c.position():{x:0,y:0};void 0!==t?l.position(e,t+h[e]):void 0!==n&&l.position({x:n.x+h.x,y:n.y+h.y})}else{var d=i.position(),f=s?i.parent():null,p=f&&f.length>0;p&&(f=f[0]);var g=p?f.position():{x:0,y:0};return(n={x:d.x-g.x,y:d.y-g.y},void 0===e)?n:n[e]}else if(!a)return;return this}}).modelPosition=PT.point=PT.position,PT.modelPositions=PT.points=PT.positions,PT.renderedPoint=PT.renderedPosition,PT.relativePoint=PT.relativePosition,PS=PM={},PM.renderedBoundingBox=function(e){var t=this.boundingBox(e),i=this.cy(),r=i.zoom(),n=i.pan(),a=t.x1*r+n.x,s=t.x2*r+n.x,o=t.y1*r+n.y,l=t.y2*r+n.y;return{x1:a,x2:s,y1:o,y2:l,w:s-a,h:l-o}},PM.dirtyCompoundBoundsCache=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.cy();return t.styleEnabled()&&t.hasCompoundNodes()&&this.forEachUp(function(t){if(t.isParent()){var i=t._private;i.compoundBoundsClean=!1,i.bbCache=null,e||t.emitAndNotify("bounds")}}),this},PM.updateCompoundBounds=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.cy();if(!t.styleEnabled()||!t.hasCompoundNodes()||!e&&t.batching())return this;for(var i=0;i<this.length;i++){var r=this[i],n=r._private;(!n.compoundBoundsClean||e)&&(!function(e){if(e.isParent()){var t=e._private,i=e.children(),r="include"===e.pstyle("compound-sizing-wrt-labels").value,n={width:{val:e.pstyle("min-width").pfValue,left:e.pstyle("min-width-bias-left"),right:e.pstyle("min-width-bias-right")},height:{val:e.pstyle("min-height").pfValue,top:e.pstyle("min-height-bias-top"),bottom:e.pstyle("min-height-bias-bottom")}},a=i.boundingBox({includeLabels:r,includeOverlays:!1,useCache:!1}),s=t.position;(0===a.w||0===a.h)&&((a={w:e.pstyle("width").pfValue,h:e.pstyle("height").pfValue}).x1=s.x-a.w/2,a.x2=s.x+a.w/2,a.y1=s.y-a.h/2,a.y2=s.y+a.h/2);var o=n.width.left.value;"px"===n.width.left.units&&n.width.val>0&&(o=100*o/n.width.val);var l=n.width.right.value;"px"===n.width.right.units&&n.width.val>0&&(l=100*l/n.width.val);var c=n.height.top.value;"px"===n.height.top.units&&n.height.val>0&&(c=100*c/n.height.val);var u=n.height.bottom.value;"px"===n.height.bottom.units&&n.height.val>0&&(u=100*u/n.height.val);var h=y(n.width.val-a.w,o,l),d=h.biasDiff,f=h.biasComplementDiff,p=y(n.height.val-a.h,c,u),g=p.biasDiff,v=p.biasComplementDiff;t.autoPadding=function(e,t,i,r){if("%"===i.units)switch(r){case"width":return e>0?i.pfValue*e:0;case"height":return t>0?i.pfValue*t:0;case"average":return e>0&&t>0?i.pfValue*(e+t)/2:0;case"min":return e>0&&t>0?e>t?i.pfValue*t:i.pfValue*e:0;case"max":return e>0&&t>0?e>t?i.pfValue*e:i.pfValue*t:0;default:return 0}return"px"===i.units?i.pfValue:0}(a.w,a.h,e.pstyle("padding"),e.pstyle("padding-relative-to").value),t.autoWidth=Math.max(a.w,n.width.val),s.x=(-d+a.x1+a.x2+f)/2,t.autoHeight=Math.max(a.h,n.height.val),s.y=(-g+a.y1+a.y2+v)/2}function y(e,t,i){var r=0,n=0,a=t+i;return e>0&&a>0&&(r=t/a*e,n=i/a*e),{biasDiff:r,biasComplementDiff:n}}}(r),t.batching()||(n.compoundBoundsClean=!0))}return this};var _K=function(e){return e===1/0||e===-1/0?0:e},_Z=function(e,t,i,r,n){r-t==0||n-i==0||null!=t&&null!=i&&null!=r&&null!=n&&(e.x1=t<e.x1?t:e.x1,e.x2=r>e.x2?r:e.x2,e.y1=i<e.y1?i:e.y1,e.y2=n>e.y2?n:e.y2,e.w=e.x2-e.x1,e.h=e.y2-e.y1)},_J=function(e,t){return null==t?e:_Z(e,t.x1,t.y1,t.x2,t.y2)},_Q=function(e,t,i){return yY(e,t,i)},_0=function(e,t,i){if(!t.cy().headless()){var r,n,a=t._private,s=a.rstyle,o=s.arrowWidth/2;if("none"!==t.pstyle(i+"-arrow-shape").value){"source"===i?(r=s.srcX,n=s.srcY):"target"===i?(r=s.tgtX,n=s.tgtY):(r=s.midX,n=s.midY);var l=a.arrowBounds=a.arrowBounds||{},c=l[i]=l[i]||{};c.x1=r-o,c.y1=n-o,c.x2=r+o,c.y2=n+o,c.w=c.x2-c.x1,c.h=c.y2-c.y1,bE(c,1),_Z(e,c.x1,c.y1,c.x2,c.y2)}}},_1=function(e,t,i){if(!t.cy().headless()){a=i?i+"-":"";var r=t._private,n=r.rstyle;if(t.pstyle(a+"label").strValue){var a,s,o,l,c,u=t.pstyle("text-halign"),h=t.pstyle("text-valign"),d=_Q(n,"labelWidth",i),f=_Q(n,"labelHeight",i),p=_Q(n,"labelX",i),g=_Q(n,"labelY",i),v=t.pstyle(a+"text-margin-x").pfValue,y=t.pstyle(a+"text-margin-y").pfValue,b=t.isEdge(),x=t.pstyle(a+"text-rotation"),_=t.pstyle("text-outline-width").pfValue,w=t.pstyle("text-border-width").pfValue/2,k=t.pstyle("text-background-padding").pfValue,E=d/2,T=f/2;if(b)s=p-E,o=p+E,l=g-T,c=g+T;else{switch(u.value){case"left":s=p-d,o=p;break;case"center":s=p-E,o=p+E;break;case"right":s=p,o=p+d}switch(h.value){case"top":l=g-f,c=g;break;case"center":l=g-T,c=g+T;break;case"bottom":l=g,c=g+f}}var P=v-Math.max(_,w)-k-2,S=v+Math.max(_,w)+k+2,M=y-Math.max(_,w)-k-2,C=y+Math.max(_,w)+k+2;s+=P,o+=S,l+=M,c+=C;var A=i||"main",I=r.labelBounds,L=I[A]=I[A]||{};L.x1=s,L.y1=l,L.x2=o,L.y2=c,L.w=o-s,L.h=c-l,L.leftPad=P,L.rightPad=S,L.topPad=M,L.botPad=C;var D=b&&"autorotate"===x.strValue,O=null!=x.pfValue&&0!==x.pfValue;if(D||O){var R=D?_Q(r.rstyle,"labelAngle",i):x.pfValue,N=Math.cos(R),j=Math.sin(R),B=(s+o)/2,F=(l+c)/2;if(!b){switch(u.value){case"left":B=o;break;case"right":B=s}switch(h.value){case"top":F=c;break;case"bottom":F=l}}var z=function(e,t){return{x:(e-=B)*N-(t-=F)*j+B,y:e*j+t*N+F}},V=z(s,l),U=z(s,c),$=z(o,l),W=z(o,c);s=Math.min(V.x,U.x,$.x,W.x),o=Math.max(V.x,U.x,$.x,W.x),l=Math.min(V.y,U.y,$.y,W.y),c=Math.max(V.y,U.y,$.y,W.y)}var H=A+"Rot",q=I[H]=I[H]||{};q.x1=s,q.y1=l,q.x2=o,q.y2=c,q.w=o-s,q.h=c-l,_Z(e,s,l,o,c),_Z(r.labelBounds.all,s,l,o,c)}return e}},_2=function(e,t){if(!t.cy().headless()){var i=t.pstyle("outline-opacity").value,r=t.pstyle("outline-width").value+t.pstyle("outline-offset").value;_3(e,t,i,r,"outside",r/2)}},_3=function(e,t,i,r,n,a){if(0!==i&&!(r<=0)&&"inside"!==n){var s=t.cy(),o=t.pstyle("shape").value,l=s.renderer().nodeShapes[o],c=t.position(),u=c.x,h=c.y,d=t.width(),f=t.height();l.hasMiterBounds?("center"===n&&(r/=2),_J(e,l.miterBounds(u,h,d,f,r))):null!=a&&a>0&&bT(e,[a,a,a,a])}},_4=function(e,t){if(!t.cy().headless()){var i=t.pstyle("border-opacity").value,r=t.pstyle("border-width").pfValue,n=t.pstyle("border-position").value;_3(e,t,i,r,n)}},_5=function(e,t){var i=e._private.cy,r=i.styleEnabled(),n=i.headless(),a=bx(),s=e._private,o=e.isNode(),l=e.isEdge(),c=s.rstyle,u=o&&r?e.pstyle("bounds-expansion").pfValue:[0],h=function(e){return"none"!==e.pstyle("display").value},d=!r||h(e)&&(!l||h(e.source())&&h(e.target()));if(d){var f=0;r&&t.includeOverlays&&0!==e.pstyle("overlay-opacity").value&&(f=e.pstyle("overlay-padding").value);var p=0;r&&t.includeUnderlays&&0!==e.pstyle("underlay-opacity").value&&(p=e.pstyle("underlay-padding").value);var g=Math.max(f,p),v=0;if(r&&(v=e.pstyle("width").pfValue/2),o&&t.includeNodes){var y=e.position();T=y.x,P=y.y;var b=e.outerWidth()/2,x=e.outerHeight()/2;_=T-b,w=T+b,_Z(a,_,k=P-x,w,E=P+x),r&&_2(a,e),r&&t.includeOutlines&&!n&&_2(a,e),r&&_4(a,e)}else if(l&&t.includeEdges)if(r&&!n){var _,w,k,E,T,P,S,M=e.pstyle("curve-style").strValue;if(_=Math.min(c.srcX,c.midX,c.tgtX),w=Math.max(c.srcX,c.midX,c.tgtX),k=Math.min(c.srcY,c.midY,c.tgtY),E=Math.max(c.srcY,c.midY,c.tgtY),_-=v,w+=v,_Z(a,_,k-=v,w,E+=v),"haystack"===M){var C=c.haystackPts;if(C&&2===C.length){if(_=C[0].x,k=C[0].y,w=C[1].x,E=C[1].y,_>w){var A=_;_=w,w=A}if(k>E){var I=k;k=E,E=I}_Z(a,_-v,k-v,w+v,E+v)}}else if("bezier"===M||"unbundled-bezier"===M||v3(M,"segments")||v3(M,"taxi")){switch(M){case"bezier":case"unbundled-bezier":S=c.bezierPts;break;case"segments":case"taxi":case"round-segments":case"round-taxi":S=c.linePts}if(null!=S)for(var L=0;L<S.length;L++){var D=S[L];_=D.x-v,w=D.x+v,_Z(a,_,k=D.y-v,w,E=D.y+v)}}}else{var O=e.source().position(),R=e.target().position();if(_=O.x,w=R.x,k=O.y,E=R.y,_>w){var N=_;_=w,w=N}if(k>E){var j=k;k=E,E=j}_-=v,w+=v,_Z(a,_,k-=v,w,E+=v)}if(r&&t.includeEdges&&l&&(_0(a,e,"mid-source"),_0(a,e,"mid-target"),_0(a,e,"source"),_0(a,e,"target")),r&&"yes"===e.pstyle("ghost").value){var B=e.pstyle("ghost-offset-x").pfValue,F=e.pstyle("ghost-offset-y").pfValue;_Z(a,a.x1+B,a.y1+F,a.x2+B,a.y2+F)}var z=s.bodyBounds=s.bodyBounds||{};bP(z,a),bT(z,u),bE(z,1),r&&(_=a.x1,w=a.x2,k=a.y1,E=a.y2,_Z(a,_-g,k-g,w+g,E+g));var V=s.overlayBounds=s.overlayBounds||{};bP(V,a),bT(V,u),bE(V,1);var U=s.labelBounds=s.labelBounds||{};null!=U.all?b_(U.all):U.all=bx(),r&&t.includeLabels&&(t.includeMainLabels&&_1(a,e,null),l&&(t.includeSourceLabels&&_1(a,e,"source"),t.includeTargetLabels&&_1(a,e,"target")))}return a.x1=_K(a.x1),a.y1=_K(a.y1),a.x2=_K(a.x2),a.y2=_K(a.y2),a.w=_K(a.x2-a.x1),a.h=_K(a.y2-a.y1),a.w>0&&a.h>0&&d&&(bT(a,u),bE(a,1)),a},_6=function(e){var t=0,i=function(e){return!!e<<t++};return 0+i(e.incudeNodes)+i(e.includeEdges)+i(e.includeLabels)+i(e.includeMainLabels)+i(e.includeSourceLabels)+i(e.includeTargetLabels)+i(e.includeOverlays)+i(e.includeOutlines)},_8=function(e){var t=function(e){return Math.round(e)};if(e.isEdge()){var i=e.source().position(),r=e.target().position();return yT([t(i.x),t(i.y),t(r.x),t(r.y)])}var n=e.position();return yT([t(n.x),t(n.y)])},_9=function(e,t){var i,r=e._private,n=e.isEdge(),a=null==t?we:_6(t);if(null==r.bbCache?(r.bbCache=i=_5(e,_7),r.bbCachePosKey=_8(e)):i=r.bbCache,a!==we){var s=e.isNode();i=bx(),(t.includeNodes&&s||t.includeEdges&&!s)&&(t.includeOverlays?_J(i,r.overlayBounds):_J(i,r.bodyBounds)),t.includeLabels&&(t.includeMainLabels&&(!n||t.includeSourceLabels&&t.includeTargetLabels)?_J(i,r.labelBounds.all):(t.includeMainLabels&&_J(i,r.labelBounds.mainRot),t.includeSourceLabels&&_J(i,r.labelBounds.sourceRot),t.includeTargetLabels&&_J(i,r.labelBounds.targetRot))),i.w=i.x2-i.x1,i.h=i.y2-i.y1}return i},_7={includeNodes:!0,includeEdges:!0,includeLabels:!0,includeMainLabels:!0,includeSourceLabels:!0,includeTargetLabels:!0,includeOverlays:!0,includeUnderlays:!0,includeOutlines:!0,useCache:!0},we=_6(_7),wt=yW(_7);PM.boundingBox=function(e){var t,i=void 0===e||void 0===e.useCache||!0===e.useCache,r=vJ(function(e){var t=e._private;return null==t.bbCache||t.styleDirty||t.bbCachePosKey!==_8(e)},function(e){return e.id()});if(i&&1===this.length&&!r(this[0]))e=void 0===e?_7:wt(e),t=_9(this[0],e);else{t=bx();var n=wt(e=e||_7),a=this.cy().styleEnabled();this.edges().forEach(r),this.nodes().forEach(r),a&&this.recalculateRenderedStyle(i),this.updateCompoundBounds(!i);for(var s=0;s<this.length;s++){var o=this[s];r(o)&&o.dirtyBoundingBoxCache(),_J(t,_9(o,n))}}return t.x1=_K(t.x1),t.y1=_K(t.y1),t.x2=_K(t.x2),t.y2=_K(t.y2),t.w=_K(t.x2-t.x1),t.h=_K(t.y2-t.y1),t},PM.dirtyBoundingBoxCache=function(){for(var e=0;e<this.length;e++){var t=this[e]._private;t.bbCache=null,t.bbCachePosKey=null,t.bodyBounds=null,t.overlayBounds=null,t.labelBounds.all=null,t.labelBounds.source=null,t.labelBounds.target=null,t.labelBounds.main=null,t.labelBounds.sourceRot=null,t.labelBounds.targetRot=null,t.labelBounds.mainRot=null,t.arrowBounds.source=null,t.arrowBounds.target=null,t.arrowBounds["mid-source"]=null,t.arrowBounds["mid-target"]=null}return this.emitAndNotify("bounds"),this},PM.boundingBoxAt=function(e){var t,i=this.nodes(),r=this.cy(),n=r.hasCompoundNodes(),a=r.collection();if(n&&(a=i.filter(function(e){return e.isParent()}),i=i.not(a)),vU(e)){var s=e;e=function(){return s}}r.startBatch(),i.forEach(function(t,i){return t._private.bbAtOldPos=e(t,i)}).silentPositions(e),n&&(a.dirtyCompoundBoundsCache(),a.dirtyBoundingBoxCache(),a.updateCompoundBounds(!0));var o={x1:(t=this.boundingBox({useCache:!1})).x1,x2:t.x2,w:t.w,y1:t.y1,y2:t.y2,h:t.h};return i.silentPositions(function(e){return e._private.bbAtOldPos}),n&&(a.dirtyCompoundBoundsCache(),a.dirtyBoundingBoxCache(),a.updateCompoundBounds(!0)),r.endBatch(),o},PS.boundingbox=PS.bb=PS.boundingBox,PS.renderedBoundingbox=PS.renderedBoundingBox,PC=PA={};var wi=function(e){e.uppercaseName=v2(e.name),e.autoName="auto"+e.uppercaseName,e.labelName="label"+e.uppercaseName,e.outerName="outer"+e.uppercaseName,e.uppercaseOuterName=v2(e.outerName),PC[e.name]=function(){var t=this[0],i=t._private,r=i.cy._private.styleEnabled;if(t)if(!r)return 1;else{if(t.isParent())return t.updateCompoundBounds(),i[e.autoName]||0;var n=t.pstyle(e.name);return"label"===n.strValue?(t.recalculateRenderedStyle(),i.rstyle[e.labelName]||0):n.pfValue}},PC["outer"+e.uppercaseName]=function(){var t=this[0],i=t._private.cy._private.styleEnabled;if(t)if(!i)return 1;else{var r=t[e.name](),n=t.pstyle("border-position").value;return r+("center"===n?t.pstyle("border-width").pfValue:"outside"===n?2*t.pstyle("border-width").pfValue:0)+2*t.padding()}},PC["rendered"+e.uppercaseName]=function(){var t=this[0];if(t)return t[e.name]()*this.cy().zoom()},PC["rendered"+e.uppercaseOuterName]=function(){var t=this[0];if(t)return t[e.outerName]()*this.cy().zoom()}};wi({name:"width"}),wi({name:"height"}),PA.padding=function(){var e=this[0],t=e._private;return e.isParent()&&(e.updateCompoundBounds(),void 0!==t.autoPadding)?t.autoPadding:e.pstyle("padding").pfValue},PA.paddedHeight=function(){var e=this[0];return e.height()+2*e.padding()},PA.paddedWidth=function(){var e=this[0];return e.width()+2*e.padding()};var wr=function(e,t){if(e.isEdge()&&e.takesUpSpace())return t(e)},wn=function(e,t){if(e.isEdge()&&e.takesUpSpace()){var i=e.cy();return br(t(e),i.zoom(),i.pan())}},wa=function(e,t){if(e.isEdge()&&e.takesUpSpace()){var i=e.cy(),r=i.pan(),n=i.zoom();return t(e).map(function(e){return br(e,n,r)})}},ws={controlPoints:{get:function(e){return e.renderer().getControlPoints(e)},mult:!0},segmentPoints:{get:function(e){return e.renderer().getSegmentPoints(e)},mult:!0},sourceEndpoint:{get:function(e){return e.renderer().getSourceEndpoint(e)}},targetEndpoint:{get:function(e){return e.renderer().getTargetEndpoint(e)}},midpoint:{get:function(e){return e.renderer().getEdgeMidpoint(e)}}},wo=ye({},PP,PM,PA,Object.keys(ws).reduce(function(e,t){var i=ws[t],r="rendered"+t[0].toUpperCase()+t.substr(1);return e[t]=function(){return wr(this,i.get)},i.mult?e[r]=function(){return wa(this,i.get)}:e[r]=function(){return wn(this,i.get)},e},{})),wl=function(e,t){this.recycle(e,t)};function wc(){return!1}function wu(){return!0}wl.prototype={instanceString:function(){return"event"},recycle:function(e,t){if(this.isImmediatePropagationStopped=this.isPropagationStopped=this.isDefaultPrevented=wc,null!=e&&e.preventDefault?(this.type=e.type,this.isDefaultPrevented=e.defaultPrevented?wu:wc):null!=e&&e.type?t=e:this.type=e,null!=t&&(this.originalEvent=t.originalEvent,this.type=null!=t.type?t.type:this.type,this.cy=t.cy,this.target=t.target,this.position=t.position,this.renderedPosition=t.renderedPosition,this.namespace=t.namespace,this.layout=t.layout),null!=this.cy&&null!=this.position&&null==this.renderedPosition){var i=this.position,r=this.cy.zoom(),n=this.cy.pan();this.renderedPosition={x:i.x*r+n.x,y:i.y*r+n.y}}this.timeStamp=e&&e.timeStamp||Date.now()},preventDefault:function(){this.isDefaultPrevented=wu;var e=this.originalEvent;e&&e.preventDefault&&e.preventDefault()},stopPropagation:function(){this.isPropagationStopped=wu;var e=this.originalEvent;e&&e.stopPropagation&&e.stopPropagation()},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=wu,this.stopPropagation()},isDefaultPrevented:wc,isPropagationStopped:wc,isImmediatePropagationStopped:wc};var wh=/^([^.]+)(\.(?:[^.]+))?$/,wd={qualifierCompare:function(e,t){return e===t},eventMatches:function(){return!0},addEventFields:function(){},callbackContext:function(e){return e},beforeEmit:function(){},afterEmit:function(){},bubble:function(){return!1},parent:function(){return null},context:null},wf=Object.keys(wd),wp={};function wg(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:wp,t=arguments.length>1?arguments[1]:void 0,i=0;i<wf.length;i++){var r=wf[i];this[r]=e[r]||wd[r]}this.context=t||this.context,this.listeners=[],this.emitting=0}var wm=wg.prototype,wv=function(e,t,i,r,n,a,s){vz(r)&&(n=r,r=null),s&&(a=null==a?s:ye({},a,s));for(var o=vV(i)?i:i.split(/\s+/),l=0;l<o.length;l++){var c=o[l];if(!vK(c)){var u=c.match(wh);if(u&&!1===t(e,c,u[1],u[2]?u[2]:null,r,n,a))break}}},wy=function(e,t){return e.addEventFields(e.context,t),new wl(t.type,t)},wb=function(e,t,i){if("event"===vB(i))return void t(e,i);if(vU(i))return void t(e,wy(e,i));for(var r=vV(i)?i:i.split(/\s+/),n=0;n<r.length;n++){var a=r[n];if(!vK(a)){var s=a.match(wh);if(s){var o=wy(e,{type:s[1],namespace:s[2]?s[2]:null,target:e.context});t(e,o)}}}};wm.on=wm.addListener=function(e,t,i,r,n){return wv(this,function(e,t,i,r,n,a,s){vz(a)&&e.listeners.push({event:t,callback:a,type:i,namespace:r,qualifier:n,conf:s})},e,t,i,r,n),this},wm.one=function(e,t,i,r){return this.on(e,t,i,r,{one:!0})},wm.removeListener=wm.off=function(e,t,i,r){var n=this;0!==this.emitting&&(this.listeners=this.listeners.slice());for(var a=this.listeners,s=function(s){var o=a[s];wv(n,function(t,i,r,n,l,c){if((o.type===r||"*"===e)&&(!n&&".*"!==o.namespace||o.namespace===n)&&(!l||t.qualifierCompare(o.qualifier,l))&&(!c||o.callback===c))return a.splice(s,1),!1},e,t,i,r)},o=a.length-1;o>=0;o--)s(o);return this},wm.removeAllListeners=function(){return this.removeListener("*")},wm.emit=wm.trigger=function(e,t,i){var r=this.listeners,n=r.length;return this.emitting++,vV(t)||(t=[t]),wb(this,function(e,a){null!=i&&(n=(r=[{event:a.event,type:a.type,namespace:a.namespace,callback:i}]).length);for(var s=0;s<n;s++)!function(){var i=r[s];if(i.type===a.type&&(!i.namespace||i.namespace===a.namespace||".*"===i.namespace)&&e.eventMatches(e.context,i,a)){var n=[a];null!=t&&yG(n,t),e.beforeEmit(e.context,i,a),i.conf&&i.conf.one&&(e.listeners=e.listeners.filter(function(e){return e!==i}));var o=e.callbackContext(e.context,i,a),l=i.callback.apply(o,n);e.afterEmit(e.context,i,a),!1===l&&(a.stopPropagation(),a.preventDefault())}}();e.bubble(e.context)&&!a.isPropagationStopped()&&e.parent(e.context).emit(a,t)},e),this.emitting--,this};var wx={qualifierCompare:function(e,t){return null==e||null==t?null==e&&null==t:e.sameText(t)},eventMatches:function(e,t,i){var r=t.qualifier;return null==r||e!==i.target&&vq(i.target)&&r.matches(i.target)},addEventFields:function(e,t){t.cy=e.cy(),t.target=e},callbackContext:function(e,t,i){return null!=t.qualifier?i.target:e},beforeEmit:function(e,t){t.conf&&t.conf.once&&t.conf.onceCollection.removeListener(t.event,t.qualifier,t.callback)},bubble:function(){return!0},parent:function(e){return e.isChild()?e.parent():e.cy()}},w_=function(e){return vF(e)?new _N(e):e},ww={createEmitter:function(){for(var e=0;e<this.length;e++){var t=this[e],i=t._private;i.emitter||(i.emitter=new wg(wx,t))}return this},emitter:function(){return this._private.emitter},on:function(e,t,i){for(var r=w_(t),n=0;n<this.length;n++)this[n].emitter().on(e,r,i);return this},removeListener:function(e,t,i){for(var r=w_(t),n=0;n<this.length;n++)this[n].emitter().removeListener(e,r,i);return this},removeAllListeners:function(){for(var e=0;e<this.length;e++)this[e].emitter().removeAllListeners();return this},one:function(e,t,i){for(var r=w_(t),n=0;n<this.length;n++)this[n].emitter().one(e,r,i);return this},once:function(e,t,i){for(var r=w_(t),n=0;n<this.length;n++)this[n].emitter().on(e,r,i,{once:!0,onceCollection:this})},emit:function(e,t){for(var i=0;i<this.length;i++)this[i].emitter().emit(e,t);return this},emitAndNotify:function(e,t){if(0!==this.length)return this.cy().notify(e,this),this.emit(e,t),this}};_y.eventAliasesOn(ww);var wk={nodes:function(e){return this.filter(function(e){return e.isNode()}).filter(e)},edges:function(e){return this.filter(function(e){return e.isEdge()}).filter(e)},byGroup:function(){for(var e=this.spawn(),t=this.spawn(),i=0;i<this.length;i++){var r=this[i];r.isNode()?e.push(r):t.push(r)}return{nodes:e,edges:t}},filter:function(e,t){if(void 0===e)return this;if(vF(e)||vH(e))return new _N(e).filter(this);if(vz(e)){for(var i=this.spawn(),r=0;r<this.length;r++){var n=this[r];(t?e.apply(t,[n,r,this]):e(n,r,this))&&i.push(n)}return i}return this.spawn()},not:function(e){if(!e)return this;vF(e)&&(e=this.filter(e));for(var t=this.spawn(),i=0;i<this.length;i++){var r=this[i];e.has(r)||t.push(r)}return t},absoluteComplement:function(){return this.cy().mutableElements().not(this)},intersect:function(e){if(vF(e))return this.filter(e);for(var t=this.spawn(),i=this.length<e.length,r=i?this:e,n=i?e:this,a=0;a<r.length;a++){var s=r[a];n.has(s)&&t.push(s)}return t},xor:function(e){var t=this._private.cy;vF(e)&&(e=t.$(e));var i=this.spawn(),r=e,n=function(e,t){for(var r=0;r<e.length;r++){var n=e[r],a=n._private.data.id;t.hasElementWithId(a)||i.push(n)}};return n(this,r),n(r,this),i},diff:function(e){var t=this._private.cy;vF(e)&&(e=t.$(e));var i=this.spawn(),r=this.spawn(),n=this.spawn(),a=e,s=function(e,t,i){for(var r=0;r<e.length;r++){var a=e[r],s=a._private.data.id;t.hasElementWithId(s)?n.merge(a):i.push(a)}};return s(this,a,i),s(a,this,r),{left:i,right:r,both:n}},add:function(e){var t=this._private.cy;if(!e)return this;if(vF(e)){var i=e;e=t.mutableElements().filter(i)}for(var r=this.spawnSelf(),n=0;n<e.length;n++){var a=e[n];this.has(a)||r.push(a)}return r},merge:function(e){var t=this._private,i=t.cy;if(!e)return this;if(e&&vF(e)){var r=e;e=i.mutableElements().filter(r)}for(var n=t.map,a=0;a<e.length;a++){var s=e[a],o=s._private.data.id;if(!n.has(o)){var l=this.length++;this[l]=s,n.set(o,{ele:s,index:l})}}return this},unmergeAt:function(e){var t=this[e].id(),i=this._private.map;this[e]=void 0,i.delete(t);var r=e===this.length-1;if(this.length>1&&!r){var n=this.length-1,a=this[n],s=a._private.data.id;this[n]=void 0,this[e]=a,i.set(s,{ele:a,index:e})}return this.length--,this},unmergeOne:function(e){e=e[0];var t=this._private,i=e._private.data.id,r=t.map.get(i);if(!r)return this;var n=r.index;return this.unmergeAt(n),this},unmerge:function(e){var t=this._private.cy;if(!e)return this;if(e&&vF(e)){var i=e;e=t.mutableElements().filter(i)}for(var r=0;r<e.length;r++)this.unmergeOne(e[r]);return this},unmergeBy:function(e){for(var t=this.length-1;t>=0;t--)e(this[t])&&this.unmergeAt(t);return this},map:function(e,t){for(var i=[],r=0;r<this.length;r++){var n=this[r],a=t?e.apply(t,[n,r,this]):e(n,r,this);i.push(a)}return i},reduce:function(e,t){for(var i=t,r=0;r<this.length;r++)i=e(i,this[r],r,this);return i},max:function(e,t){for(var i,r=-1/0,n=0;n<this.length;n++){var a=this[n],s=t?e.apply(t,[a,n,this]):e(a,n,this);s>r&&(r=s,i=a)}return{value:r,ele:i}},min:function(e,t){for(var i,r=1/0,n=0;n<this.length;n++){var a=this[n],s=t?e.apply(t,[a,n,this]):e(a,n,this);s<r&&(r=s,i=a)}return{value:r,ele:i}}};wk.u=wk["|"]=wk["+"]=wk.union=wk.or=wk.add,wk["\\"]=wk["!"]=wk["-"]=wk.difference=wk.relativeComplement=wk.subtract=wk.not,wk.n=wk["&"]=wk["."]=wk.and=wk.intersection=wk.intersect,wk["^"]=wk["(+)"]=wk["(-)"]=wk.symmetricDifference=wk.symdiff=wk.xor,wk.fnFilter=wk.filterFn=wk.stdFilter=wk.filter,wk.complement=wk.abscomp=wk.absoluteComplement;var wE=function(e,t){var i=e.cy().hasCompoundNodes();function r(e){var t=e.pstyle("z-compound-depth");return"auto"===t.value?i?e.zDepth():0:"bottom"===t.value?-1:"top"===t.value?yL:0}var n=r(e)-r(t);if(0!==n)return n;function a(e){return"auto"===e.pstyle("z-index-compare").value?+!!e.isNode():0}var s=a(e)-a(t);if(0!==s)return s;var o=e.pstyle("z-index").value-t.pstyle("z-index").value;return 0!==o?o:e.poolIndex()-t.poolIndex()},wT={forEach:function(e,t){if(vz(e))for(var i=this.length,r=0;r<i;r++){var n=this[r];if(!1===(t?e.apply(t,[n,r,this]):e(n,r,this)))break}return this},toArray:function(){for(var e=[],t=0;t<this.length;t++)e.push(this[t]);return e},slice:function(e,t){var i=[],r=this.length;null==t&&(t=r),null==e&&(e=0),e<0&&(e=r+e),t<0&&(t=r+t);for(var n=e;n>=0&&n<t&&n<r;n++)i.push(this[n]);return this.spawn(i)},size:function(){return this.length},eq:function(e){return this[e]||this.spawn()},first:function(){return this[0]||this.spawn()},last:function(){return this[this.length-1]||this.spawn()},empty:function(){return 0===this.length},nonempty:function(){return!this.empty()},sort:function(e){if(!vz(e))return this;var t=this.toArray().sort(e);return this.spawn(t)},sortByZIndex:function(){return this.sort(wE)},zDepth:function(){var e=this[0];if(e){var t=e._private;if("nodes"===t.group){var i=t.data.parent?e.parents().size():0;return e.isParent()?i:yL-1}var r=t.source,n=t.target;return Math.max(r.zDepth(),n.zDepth(),0)}}};wT.each=wT.forEach,("undefined"==typeof Symbol?"undefined":vA(Symbol))!="undefined"&&"undefined"!=vA(Symbol.iterator)&&(wT[Symbol.iterator]=function(){var e=this,t={value:void 0,done:!1},i=0,r=this.length;return vP({next:function(){return i<r?t.value=e[i++]:(t.value=void 0,t.done=!0),t}},Symbol.iterator,function(){return this})});var wP=yW({nodeDimensionsIncludeLabels:!1}),wS={layoutDimensions:function(e){if(e=wP(e),this.takesUpSpace())if(e.nodeDimensionsIncludeLabels){var t,i=this.boundingBox();t={w:i.w,h:i.h}}else t={w:this.outerWidth(),h:this.outerHeight()};else t={w:0,h:0};return(0===t.w||0===t.h)&&(t.w=t.h=1),t},layoutPositions:function(e,t,i){var r=this.nodes().filter(function(e){return!e.isParent()}),n=this.cy(),a=t.eles,s=function(e){return e.id()},o=vJ(i,s);e.emit({type:"layoutstart",layout:e}),e.animations=[];var l=function(e,t,i){var r={x:t.x1+t.w/2,y:t.y1+t.h/2},n={x:(i.x-r.x)*e,y:(i.y-r.y)*e};return{x:r.x+n.x,y:r.y+n.y}},c=t.spacingFactor&&1!==t.spacingFactor,u=function(){if(!c)return null;for(var e=bx(),t=0;t<r.length;t++){var i=o(r[t],t);bk(e,i.x,i.y)}return e}(),h=vJ(function(e,i){var r=o(e,i);return c&&(r=l(Math.abs(t.spacingFactor),u,r)),null!=t.transform&&(r=t.transform(e,r)),r},s);if(t.animate){for(var d=0;d<r.length;d++){var f=r[d],p=h(f,d);if(null==t.animateFilter||t.animateFilter(f,d)){var g=f.animation({position:p,duration:t.animationDuration,easing:t.animationEasing});e.animations.push(g)}else f.position(p)}if(t.fit){var v=n.animation({fit:{boundingBox:a.boundingBoxAt(h),padding:t.padding},duration:t.animationDuration,easing:t.animationEasing});e.animations.push(v)}else if(void 0!==t.zoom&&void 0!==t.pan){var y=n.animation({zoom:t.zoom,pan:t.pan,duration:t.animationDuration,easing:t.animationEasing});e.animations.push(y)}e.animations.forEach(function(e){return e.play()}),e.one("layoutready",t.ready),e.emit({type:"layoutready",layout:e}),_t.all(e.animations.map(function(e){return e.promise()})).then(function(){e.one("layoutstop",t.stop),e.emit({type:"layoutstop",layout:e})})}else r.positions(h),t.fit&&n.fit(t.eles,t.padding),null!=t.zoom&&n.zoom(t.zoom),t.pan&&n.pan(t.pan),e.one("layoutready",t.ready),e.emit({type:"layoutready",layout:e}),e.one("layoutstop",t.stop),e.emit({type:"layoutstop",layout:e});return this},layout:function(e){return this.cy().makeLayout(ye({},e,{eles:this}))}};function wM(e,t,i){var r,n=i._private,a=n.styleCache=n.styleCache||[];return null!=(r=a[e])?r:r=a[e]=t(i)}function wC(e,t){return e=yP(e),function(i){return wM(e,t,i)}}function wA(e,t){e=yP(e);var i=function(e){return t.call(e)};return function(){var t=this[0];if(t)return wM(e,i,t)}}wS.createLayout=wS.makeLayout=wS.layout;var wI={recalculateRenderedStyle:function(e){var t=this.cy(),i=t.renderer(),r=t.styleEnabled();return i&&r&&i.recalculateRenderedStyle(this,e),this},dirtyStyleCache:function(){var e,t=this.cy(),i=function(e){return e._private.styleCache=null};return t.hasCompoundNodes()?((e=this.spawnSelf().merge(this.descendants()).merge(this.parents())).merge(e.connectedEdges()),e.forEach(i)):this.forEach(function(e){i(e),e.connectedEdges().forEach(i)}),this},updateStyle:function(e){var t=this._private.cy;if(!t.styleEnabled())return this;if(t.batching())return t._private.batchStyleEles.merge(this),this;var i=t.hasCompoundNodes(),r=this;e=!!e||void 0===e,i&&(r=this.spawnSelf().merge(this.descendants()).merge(this.parents()));var n=r;return e?n.emitAndNotify("style"):n.emit("style"),r.forEach(function(e){return e._private.styleDirty=!0}),this},cleanStyle:function(){var e=this.cy();if(e.styleEnabled())for(var t=0;t<this.length;t++){var i=this[t];i._private.styleDirty&&(i._private.styleDirty=!1,e.style().apply(i))}},parsedStyle:function(e){var t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],i=this[0],r=i.cy();if(r.styleEnabled()&&i){i._private.styleDirty&&(i._private.styleDirty=!1,r.style().apply(i));var n=i._private.style[e];return null!=n?n:t?r.style().getDefaultProperty(e):null}},numericStyle:function(e){var t=this[0];if(t.cy().styleEnabled()&&t){var i=t.pstyle(e);return void 0!==i.pfValue?i.pfValue:i.value}},numericStyleUnits:function(e){var t=this[0];if(t.cy().styleEnabled()&&t)return t.pstyle(e).units},renderedStyle:function(e){var t=this.cy();if(!t.styleEnabled())return this;var i=this[0];if(i)return t.style().getRenderedStyle(i,e)},style:function(e,t){var i=this.cy();if(!i.styleEnabled())return this;var r=i.style();if(vU(e))r.applyBypass(this,e,!1),this.emitAndNotify("style");else if(vF(e))if(void 0===t){var n=this[0];return n?r.getStylePropertyValue(n,e):void 0}else r.applyBypass(this,e,t,!1),this.emitAndNotify("style");else if(void 0===e){var a=this[0];return a?r.getRawStyle(a):void 0}return this},removeStyle:function(e){var t=this.cy();if(!t.styleEnabled())return this;var i=t.style();if(void 0===e)for(var r=0;r<this.length;r++){var n=this[r];i.removeAllBypasses(n,!1)}else{e=e.split(/\s+/);for(var a=0;a<this.length;a++){var s=this[a];i.removeBypasses(s,e,!1)}}return this.emitAndNotify("style"),this},show:function(){return this.css("display","element"),this},hide:function(){return this.css("display","none"),this},effectiveOpacity:function(){var e=this.cy();if(!e.styleEnabled())return 1;var t=e.hasCompoundNodes(),i=this[0];if(i){var r=i._private,n=i.pstyle("opacity").value;if(!t)return n;var a=r.data.parent?i.parents():null;if(a)for(var s=0;s<a.length;s++)n*=a[s].pstyle("opacity").value;return n}},transparent:function(){if(!this.cy().styleEnabled())return!1;var e=this[0],t=e.cy().hasCompoundNodes();if(e)if(!t)return 0===e.pstyle("opacity").value;else return 0===e.effectiveOpacity()},backgrounding:function(){return!!this.cy().styleEnabled()&&!!this[0]._private.backgrounding}};function wL(e,t){var i=e._private.data.parent?e.parents():null;if(i){for(var r=0;r<i.length;r++)if(!t(i[r]))return!1}return!0}function wD(e){var t=e.ok,i=e.edgeOkViaNode||e.ok,r=e.parentOk||e.ok;return function(){var e=this.cy();if(!e.styleEnabled())return!0;var n=this[0],a=e.hasCompoundNodes();if(n){var s=n._private;if(!t(n))return!1;if(n.isNode())return!a||wL(n,r);var o=s.source,l=s.target;return i(o)&&(!a||wL(o,i))&&(o===l||i(l)&&(!a||wL(l,i)))}}}var wO=wC("eleTakesUpSpace",function(e){return"element"===e.pstyle("display").value&&0!==e.width()&&(!e.isNode()||0!==e.height())});wI.takesUpSpace=wA("takesUpSpace",wD({ok:wO})),wI.interactive=wA("interactive",wD({ok:wC("eleInteractive",function(e){return"yes"===e.pstyle("events").value&&"visible"===e.pstyle("visibility").value&&wO(e)}),parentOk:wC("parentInteractive",function(e){return"visible"===e.pstyle("visibility").value&&wO(e)}),edgeOkViaNode:wO})),wI.noninteractive=function(){var e=this[0];if(e)return!e.interactive()},wI.visible=wA("visible",wD({ok:wC("eleVisible",function(e){return"visible"===e.pstyle("visibility").value&&0!==e.pstyle("opacity").pfValue&&wO(e)}),edgeOkViaNode:wO})),wI.hidden=function(){var e=this[0];if(e)return!e.visible()},wI.isBundledBezier=wA("isBundledBezier",function(){return!!this.cy().styleEnabled()&&!this.removed()&&"bezier"===this.pstyle("curve-style").value&&this.takesUpSpace()}),wI.bypass=wI.css=wI.style,wI.renderedCss=wI.renderedStyle,wI.removeBypass=wI.removeCss=wI.removeStyle,wI.pstyle=wI.parsedStyle;var wR={};function wN(e){return function(){var t=arguments,i=[];if(2===t.length){var r=t[0],n=t[1];this.on(e.event,r,n)}else if(1===t.length&&vz(t[0])){var a=t[0];this.on(e.event,a)}else if(0===t.length||1===t.length&&vV(t[0])){for(var s=1===t.length?t[0]:null,o=0;o<this.length;o++){var l=this[o],c=!e.ableField||l._private[e.ableField],u=l._private[e.field]!=e.value;if(e.overrideAble){var h=e.overrideAble(l);if(void 0!==h&&(c=h,!h))return this}c&&(l._private[e.field]=e.value,u&&i.push(l))}var d=this.spawn(i);d.updateStyle(),d.emit(e.event),s&&d.emit(s)}return this}}function wj(e){wR[e.field]=function(){var t=this[0];if(t){if(e.overrideField){var i=e.overrideField(t);if(void 0!==i)return i}return t._private[e.field]}},wR[e.on]=wN({event:e.on,field:e.field,ableField:e.ableField,overrideAble:e.overrideAble,value:!0}),wR[e.off]=wN({event:e.off,field:e.field,ableField:e.ableField,overrideAble:e.overrideAble,value:!1})}wj({field:"locked",overrideField:function(e){return!!e.cy().autolock()||void 0},on:"lock",off:"unlock"}),wj({field:"grabbable",overrideField:function(e){return!(e.cy().autoungrabify()||e.pannable())&&void 0},on:"grabify",off:"ungrabify"}),wj({field:"selected",ableField:"selectable",overrideAble:function(e){return!e.cy().autounselectify()&&void 0},on:"select",off:"unselect"}),wj({field:"selectable",overrideField:function(e){return!e.cy().autounselectify()&&void 0},on:"selectify",off:"unselectify"}),wR.deselect=wR.unselect,wR.grabbed=function(){var e=this[0];if(e)return e._private.grabbed},wj({field:"active",on:"activate",off:"unactivate"}),wj({field:"pannable",on:"panify",off:"unpanify"}),wR.inactive=function(){var e=this[0];if(e)return!e._private.active};var wB={},wF=function(e){return function(t){for(var i=[],r=0;r<this.length;r++){var n=this[r];if(n.isNode()){for(var a=!1,s=n.connectedEdges(),o=0;o<s.length;o++){var l=s[o],c=l.source(),u=l.target();if(e.noIncomingEdges&&u===n&&c!==n||e.noOutgoingEdges&&c===n&&u!==n){a=!0;break}}a||i.push(n)}}return this.spawn(i,!0).filter(t)}},wz=function(e){return function(t){for(var i=[],r=0;r<this.length;r++){var n=this[r];if(n.isNode())for(var a=n.connectedEdges(),s=0;s<a.length;s++){var o=a[s],l=o.source(),c=o.target();e.outgoing&&l===n?(i.push(o),i.push(c)):e.incoming&&c===n&&(i.push(o),i.push(l))}}return this.spawn(i,!0).filter(t)}},wV=function(e){return function(t){for(var i=this,r=[],n={};;){var a=e.outgoing?i.outgoers():i.incomers();if(0===a.length)break;for(var s=!1,o=0;o<a.length;o++){var l=a[o],c=l.id();n[c]||(n[c]=!0,r.push(l),s=!0)}if(!s)break;i=a}return this.spawn(r,!0).filter(t)}};function wU(e){return function(t){for(var i=[],r=0;r<this.length;r++){var n=this[r]._private[e.attr];n&&i.push(n)}return this.spawn(i,!0).filter(t)}}function w$(e){return function(t){var i=[],r=this._private.cy,n=e||{};vF(t)&&(t=r.$(t));for(var a=0;a<t.length;a++)for(var s=t[a]._private.edges,o=0;o<s.length;o++){var l=s[o],c=l._private.data,u=this.hasElementWithId(c.source)&&t.hasElementWithId(c.target),h=t.hasElementWithId(c.source)&&this.hasElementWithId(c.target);if(u||h){if((n.thisIsSrc||n.thisIsTgt)&&(n.thisIsSrc&&!u||n.thisIsTgt&&!h))continue;i.push(l)}}return this.spawn(i,!0)}}function wW(e){return e=ye({},{codirected:!1},e),function(t){for(var i=[],r=this.edges(),n=e,a=0;a<r.length;a++)for(var s=r[a]._private,o=s.source,l=o._private.data.id,c=s.data.target,u=o._private.edges,h=0;h<u.length;h++){var d=u[h],f=d._private.data,p=f.target,g=f.source,v=p===c&&g===l,y=l===p&&c===g;(n.codirected&&v||!n.codirected&&(v||y))&&i.push(d)}return this.spawn(i,!0).filter(t)}}wB.clearTraversalCache=function(){for(var e=0;e<this.length;e++)this[e]._private.traversalCache=null},ye(wB,{roots:wF({noIncomingEdges:!0}),leaves:wF({noOutgoingEdges:!0}),outgoers:_F(wz({outgoing:!0}),"outgoers"),successors:wV({outgoing:!0}),incomers:_F(wz({incoming:!0}),"incomers"),predecessors:wV({})}),ye(wB,{neighborhood:_F(function(e){for(var t=[],i=this.nodes(),r=0;r<i.length;r++)for(var n=i[r],a=n.connectedEdges(),s=0;s<a.length;s++){var o=a[s],l=o.source(),c=o.target(),u=n===l?c:l;u.length>0&&t.push(u[0]),t.push(o[0])}return this.spawn(t,!0).filter(e)},"neighborhood"),closedNeighborhood:function(e){return this.neighborhood().add(this).filter(e)},openNeighborhood:function(e){return this.neighborhood(e)}}),wB.neighbourhood=wB.neighborhood,wB.closedNeighbourhood=wB.closedNeighborhood,wB.openNeighbourhood=wB.openNeighborhood,ye(wB,{source:_F(function(e){var t,i=this[0];return i&&(t=i._private.source||i.cy().collection()),t&&e?t.filter(e):t},"source"),target:_F(function(e){var t,i=this[0];return i&&(t=i._private.target||i.cy().collection()),t&&e?t.filter(e):t},"target"),sources:wU({attr:"source"}),targets:wU({attr:"target"})}),ye(wB,{edgesWith:_F(w$(),"edgesWith"),edgesTo:_F(w$({thisIsSrc:!0}),"edgesTo")}),ye(wB,{connectedEdges:_F(function(e){for(var t=[],i=0;i<this.length;i++){var r=this[i];if(r.isNode())for(var n=r._private.edges,a=0;a<n.length;a++){var s=n[a];t.push(s)}}return this.spawn(t,!0).filter(e)},"connectedEdges"),connectedNodes:_F(function(e){for(var t=[],i=0;i<this.length;i++){var r=this[i];r.isEdge()&&(t.push(r.source()[0]),t.push(r.target()[0]))}return this.spawn(t,!0).filter(e)},"connectedNodes"),parallelEdges:_F(wW(),"parallelEdges"),codirectedEdges:_F(wW({codirected:!0}),"codirectedEdges")}),ye(wB,{components:function(e){var t=this,i=t.cy(),r=i.collection(),n=null==e?t.nodes():e.nodes(),a=[];null!=e&&n.empty()&&(n=e.sources());var s=function(e,t){r.merge(e),n.unmerge(e),t.merge(e)};if(n.empty())return t.spawn();do!function(){var e=i.collection();a.push(e);var r=n[0];s(r,e),t.bfs({directed:!1,roots:r,visit:function(t){return s(t,e)}}),e.forEach(function(i){i.connectedEdges().forEach(function(i){t.has(i)&&e.has(i.source())&&e.has(i.target())&&e.merge(i)})})}();while(n.length>0)return a},component:function(){var e=this[0];return e.cy().mutableElements().components(e)[0]}}),wB.componentsOf=wB.components;var wH=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(void 0===e)return void yj("A collection must have a reference to the core");var n=new yZ,a=!1;if(t){if(t.length>0&&vU(t[0])&&!vq(t[0])){a=!0;for(var s=[],o=new yQ,l=0,c=t.length;l<c;l++){var u=t[l];null==u.data&&(u.data={});var h=u.data;if(null==h.id)h.id=yV();else if(e.hasElementWithId(h.id)||o.has(h.id))continue;var d=new y0(e,u,!1);s.push(d),o.add(h.id)}t=s}}else t=[];this.length=0;for(var f=0,p=t.length;f<p;f++){var g=t[f][0];if(null!=g){var v=g._private.data.id;(!i||!n.has(v))&&(i&&n.set(v,{index:this.length,ele:g}),this[this.length]=g,this.length++)}}this._private={eles:this,cy:e,get map(){return null==this.lazyMap&&this.rebuildMap(),this.lazyMap},set map(m){this.lazyMap=m},rebuildMap:function(){for(var e=this.lazyMap=new yZ,t=this.eles,i=0;i<t.length;i++){var r=t[i];e.set(r.id(),{index:i,ele:r})}}},i&&(this._private.map=n),a&&!r&&this.restore()},wq=y0.prototype=wH.prototype=Object.create(Array.prototype);wq.instanceString=function(){return"collection"},wq.spawn=function(e,t){return new wH(this.cy(),e,t)},wq.spawnSelf=function(){return this.spawn(this)},wq.cy=function(){return this._private.cy},wq.renderer=function(){return this._private.cy.renderer()},wq.element=function(){return this[0]},wq.collection=function(){return vG(this)?this:new wH(this._private.cy,[this])},wq.unique=function(){return new wH(this._private.cy,this,!0)},wq.hasElementWithId=function(e){return e=""+e,this._private.map.has(e)},wq.getElementById=function(e){e=""+e;var t=this._private.cy,i=this._private.map.get(e);return i?i.ele:new wH(t)},wq.$id=wq.getElementById,wq.poolIndex=function(){var e=this._private.cy._private.elements,t=this[0]._private.data.id;return e._private.map.get(t).index},wq.indexOf=function(e){var t=e[0]._private.data.id;return this._private.map.get(t).index},wq.indexOfId=function(e){return e=""+e,this._private.map.get(e).index},wq.json=function(e){var t=this.element(),i=this.cy();if(null==t&&e)return this;if(null!=t){var r=t._private;if(vU(e)){if(i.startBatch(),e.data){t.data(e.data);var n=r.data;if(t.isEdge()){var a=!1,s={},o=e.data.source,l=e.data.target;null!=o&&o!=n.source&&(s.source=""+o,a=!0),null!=l&&l!=n.target&&(s.target=""+l,a=!0),a&&(t=t.move(s))}else{var c="parent"in e.data,u=e.data.parent;c&&(null!=u||null!=n.parent)&&u!=n.parent&&(void 0===u&&(u=null),null!=u&&(u=""+u),t=t.move({parent:u}))}}e.position&&t.position(e.position);var h=function(i,n,a){var s=e[i];null!=s&&s!==r[i]&&(s?t[n]():t[a]())};return h("removed","remove","restore"),h("selected","select","unselect"),h("selectable","selectify","unselectify"),h("locked","lock","unlock"),h("grabbable","grabify","ungrabify"),h("pannable","panify","unpanify"),null!=e.classes&&t.classes(e.classes),i.endBatch(),this}if(void 0===e){var d={data:yz(r.data),position:yz(r.position),group:r.group,removed:r.removed,selected:r.selected,selectable:r.selectable,locked:r.locked,grabbable:r.grabbable,pannable:r.pannable,classes:null};d.classes="";var f=0;return r.classes.forEach(function(e){return d.classes+=0==f++?e:" "+e}),d}}},wq.jsons=function(){for(var e=[],t=0;t<this.length;t++){var i=this[t].json();e.push(i)}return e},wq.clone=function(){for(var e=this.cy(),t=[],i=0;i<this.length;i++){var r=new y0(e,this[i].json(),!1);t.push(r)}return new wH(e,t)},wq.copy=wq.clone,wq.restore=function(){for(var e=!(arguments.length>0)||void 0===arguments[0]||arguments[0],t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],i=this.cy(),r=i._private,n=[],a=[],s=0,o=this.length;s<o;s++){var l=this[s];(!t||l.removed())&&(l.isNode()?n.push(l):a.push(l))}I=n.concat(a);var c=function(){I.splice(L,1),L--};for(L=0;L<I.length;L++){var u=I[L],h=u._private,d=h.data;if(u.clearTraversalCache(),t||h.removed){if(void 0===d.id)d.id=yV();else if(v$(d.id))d.id=""+d.id;else if(vK(d.id)||!vF(d.id)){yj("Can not create element with invalid string ID `"+d.id+"`"),c();continue}else if(i.hasElementWithId(d.id)){yj("Can not create second element with ID `"+d.id+"`"),c();continue}}var f=d.id;if(u.isNode()){var p=h.position;null==p.x&&(p.x=0),null==p.y&&(p.y=0)}if(u.isEdge()){for(var g=["source","target"],v=g.length,y=!1,b=0;b<v;b++){var x=g[b],_=d[x];v$(_)&&(_=d[x]=""+d[x]),null==_||""===_?(yj("Can not create edge `"+f+"` with unspecified "+x),y=!0):i.hasElementWithId(_)||(yj("Can not create edge `"+f+"` with nonexistant "+x+" `"+_+"`"),y=!0)}if(y){c();continue}var w=i.getElementById(d.source),k=i.getElementById(d.target);w.same(k)?w._private.edges.push(u):(w._private.edges.push(u),k._private.edges.push(u)),u._private.source=w,u._private.target=k}h.map=new yZ,h.map.set(f,{ele:u,index:0}),h.removed=!1,t&&i.addToPool(u)}for(var E=0;E<n.length;E++){var T=n[E],P=T._private.data;v$(P.parent)&&(P.parent=""+P.parent);var S=P.parent;if(null!=S||T._private.parent){var M=T._private.parent?i.collection().merge(T._private.parent):i.getElementById(S);if(M.empty())P.parent=void 0;else if(M[0].removed())yF("Node added with missing parent, reference to parent removed"),P.parent=void 0,T._private.parent=null;else{for(var C=!1,A=M;!A.empty();){if(T.same(A)){C=!0,P.parent=void 0;break}A=A.parent()}C||(M[0]._private.children.push(T),T._private.parent=M[0],r.hasCompoundNodes=!0)}}}if(I.length>0){for(var I,L,D,O=I.length===this.length?this:new wH(i,I),R=0;R<O.length;R++){var N=O[R];N.isNode()||(N.parallelEdges().clearTraversalCache(),N.source().clearTraversalCache(),N.target().clearTraversalCache())}(r.hasCompoundNodes?i.collection().merge(O).merge(O.connectedNodes()).merge(O.parent()):O).dirtyCompoundBoundsCache().dirtyBoundingBoxCache().updateStyle(e),e?O.emitAndNotify("add"):t&&O.emit("add")}return this},wq.removed=function(){var e=this[0];return e&&e._private.removed},wq.inside=function(){var e=this[0];return e&&!e._private.removed},wq.remove=function(){for(var e=!(arguments.length>0)||void 0===arguments[0]||arguments[0],t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],i=[],r={},n=this._private.cy,a=0,s=this.length;a<s;a++)!function e(n){var a=r[n.id()];if(!(t&&n.removed())&&!a)if(r[n.id()]=!0,n.isNode()){i.push(n);for(var s=n._private.edges,o=0;o<s.length;o++)e(s[o]);for(var l=n._private.children,c=0;c<l.length;c++)e(l[c])}else i.unshift(n)}(this[a]);function o(e,t){yH(e._private.edges,t),e.clearTraversalCache()}var l=[];l.ids={},this.dirtyCompoundBoundsCache(),t&&n.removeFromPool(i);for(var c=0;c<i.length;c++){var u=i[c];if(u.isEdge()){var h=u.source()[0],d=u.target()[0];o(h,u),o(d,u);for(var f=u.parallelEdges(),p=0;p<f.length;p++){var g=f[p];g.clearTraversalCache(),g.isBundledBezier()&&g.dirtyBoundingBoxCache()}}else{var v=u.parent();0!==v.length&&function(e,t){t=t[0];var i=(e=e[0])._private.children,r=e.id();yH(i,t),t._private.parent=null,l.ids[r]||(l.ids[r]=!0,l.push(e))}(v,u)}t&&(u._private.removed=!0)}var y=n._private.elements;n._private.hasCompoundNodes=!1;for(var b=0;b<y.length;b++)if(y[b].isParent()){n._private.hasCompoundNodes=!0;break}var x=new wH(this.cy(),i);x.size()>0&&(e?x.emitAndNotify("remove"):t&&x.emit("remove"));for(var _=0;_<l.length;_++){var w=l[_];t&&w.removed()||w.updateStyle()}return x},wq.move=function(e){var t=this._private.cy,i=this,r=function(e){return null==e?e:""+e};if(void 0!==e.source||void 0!==e.target){var n=r(e.source),a=r(e.target),s=null!=n&&t.hasElementWithId(n),o=null!=a&&t.hasElementWithId(a);(s||o)&&(t.batch(function(){i.remove(!1,!1),i.emitAndNotify("moveout");for(var e=0;e<i.length;e++){var t=i[e],r=t._private.data;t.isEdge()&&(s&&(r.source=n),o&&(r.target=a))}i.restore(!1,!1)}),i.emitAndNotify("move"))}else if(void 0!==e.parent){var l=r(e.parent);if(null===l||t.hasElementWithId(l)){var c=null===l?void 0:l;t.batch(function(){var e=i.remove(!1,!1);e.emitAndNotify("moveout");for(var t=0;t<i.length;t++){var r=i[t],n=r._private.data;r.isNode()&&(n.parent=c)}e.restore(!1,!1)}),i.emitAndNotify("move")}}return this},[x4,_b,_x,_B,_z,PE,_H,wo,ww,wk,{isNode:function(){return"nodes"===this.group()},isEdge:function(){return"edges"===this.group()},isLoop:function(){return this.isEdge()&&this.source()[0]===this.target()[0]},isSimple:function(){return this.isEdge()&&this.source()[0]!==this.target()[0]},group:function(){var e=this[0];if(e)return e._private.group}},wT,wS,wI,wR,wB].forEach(function(e){ye(wq,e)});var wG=function(){function e(e){return-e.tension*e.x-e.friction*e.v}function t(t,i,r){var n={x:t.x+r.dx*i,v:t.v+r.dv*i,tension:t.tension,friction:t.friction};return{dx:n.v,dv:e(n)}}return function i(r,n,a){var s,o,l,c,u,h,d,f,p,g,v,y={x:-1,v:0,tension:null,friction:null},b=[0],x=0;for(r=parseFloat(r)||500,n=parseFloat(n)||20,a=a||null,y.tension=r,y.friction=n,g=(p=null!==a)?(x=i(r,n))/a*.016:.016;s=v||y,o=g,l={dx:s.v,dv:e(s)},c=t(s,.5*o,l),u=t(s,.5*o,c),h=t(s,o,u),d=1/6*(l.dx+2*(c.dx+u.dx)+h.dx),f=1/6*(l.dv+2*(c.dv+u.dv)+h.dv),s.x=s.x+d*o,s.v=s.v+f*o,v=s,b.push(1+v.x),x+=16,Math.abs(v.x)>1e-4&&Math.abs(v.v)>1e-4;);return p?function(e){return b[e*(b.length-1)|0]}:x}}(),wY=function(e,t,i,r){var n=function(e,t,i,r){var n="undefined"!=typeof Float32Array;if(4!=arguments.length)return!1;for(var a=0;a<4;++a)if("number"!=typeof arguments[a]||isNaN(arguments[a])||!isFinite(arguments[a]))return!1;e=Math.min(e,1),i=Math.min(i,1),e=Math.max(e,0),i=Math.max(i,0);var s=n?new Float32Array(11):Array(11);function o(e,t,i){return(((1-3*i+3*t)*e+(3*i-6*t))*e+3*t)*e}function l(e,t,i){return 3*(1-3*i+3*t)*e*e+2*(3*i-6*t)*e+3*t}var c=!1,u=function(n){return(c||(c=!0,(e!==t||i!==r)&&function(){for(var t=0;t<11;++t)s[t]=o(.1*t,e,i)}()),e===t&&i===r)?n:0===n?0:1===n?1:o(function(t){for(var r=0,n=1;10!==n&&s[n]<=t;++n)r+=.1;var a=r+(t-s[--n])/(s[n+1]-s[n])*.1,c=l(a,e,i);if(c>=.001){for(var u=a,h=0;h<4;++h){var d=l(u,e,i);if(0===d)break;var f=o(u,e,i)-t;u-=f/d}return u}return 0===c?a:function(t,r,n){var a,s,l=0;do(a=o(s=r+(n-r)/2,e,i)-t)>0?n=s:r=s;while(Math.abs(a)>1e-7&&++l<10)return s}(t,r,r+.1)}(n),t,r)};u.getControlPoints=function(){return[{x:e,y:t},{x:i,y:r}]};var h="generateBezier("+[e,t,i,r]+")";return u.toString=function(){return h},u}(e,t,i,r);return function(e,t,i){return e+(t-e)*n(i)}},wX={linear:function(e,t,i){return e+(t-e)*i},ease:wY(.25,.1,.25,1),"ease-in":wY(.42,0,1,1),"ease-out":wY(0,0,.58,1),"ease-in-out":wY(.42,0,.58,1),"ease-in-sine":wY(.47,0,.745,.715),"ease-out-sine":wY(.39,.575,.565,1),"ease-in-out-sine":wY(.445,.05,.55,.95),"ease-in-quad":wY(.55,.085,.68,.53),"ease-out-quad":wY(.25,.46,.45,.94),"ease-in-out-quad":wY(.455,.03,.515,.955),"ease-in-cubic":wY(.55,.055,.675,.19),"ease-out-cubic":wY(.215,.61,.355,1),"ease-in-out-cubic":wY(.645,.045,.355,1),"ease-in-quart":wY(.895,.03,.685,.22),"ease-out-quart":wY(.165,.84,.44,1),"ease-in-out-quart":wY(.77,0,.175,1),"ease-in-quint":wY(.755,.05,.855,.06),"ease-out-quint":wY(.23,1,.32,1),"ease-in-out-quint":wY(.86,0,.07,1),"ease-in-expo":wY(.95,.05,.795,.035),"ease-out-expo":wY(.19,1,.22,1),"ease-in-out-expo":wY(1,0,0,1),"ease-in-circ":wY(.6,.04,.98,.335),"ease-out-circ":wY(.075,.82,.165,1),"ease-in-out-circ":wY(.785,.135,.15,.86),spring:function(e,t,i){if(0===i)return wX.linear;var r=wG(e,t,i);return function(e,t,i){return e+(t-e)*r(i)}},"cubic-bezier":wY};function wK(e,t,i,r,n){if(1===r||t===i)return i;var a=n(t,i,r);return null==e||((e.roundValue||e.color)&&(a=Math.round(a)),void 0!==e.min&&(a=Math.max(a,e.min)),void 0!==e.max&&(a=Math.min(a,e.max))),a}function wZ(e,t){return null==e.pfValue&&null==e.value?e:null!=e.pfValue&&(null==t||"%"!==t.type.units)?e.pfValue:e.value}function wJ(e,t,i,r,n){var a=null!=n?n.type:null;i<0?i=0:i>1&&(i=1);var s=wZ(e,n),o=wZ(t,n);if(v$(s)&&v$(o))return wK(a,s,o,i,r);if(vV(s)&&vV(o)){for(var l=[],c=0;c<o.length;c++){var u=s[c],h=o[c];if(null!=u&&null!=h){var d=wK(a,u,h,i,r);l.push(d)}else l.push(h)}return l}}function wQ(e,t){return null!=e&&null!=t&&(!!(v$(e)&&v$(t))||!!e&&!!t)}function w0(e,t){var i=t._private.aniEles,r=[];function n(t,i){var n=t._private,a=n.animation.current,s=n.animation.queue,o=!1;if(0===a.length){var l=s.shift();l&&a.push(l)}for(var c=function(e){for(var t=e.length-1;t>=0;t--)(0,e[t])();e.splice(0,e.length)},u=a.length-1;u>=0;u--){var h=a[u],d=h._private;if(d.stopped){a.splice(u,1),d.hooked=!1,d.playing=!1,d.started=!1,c(d.frames);continue}(d.playing||d.applying)&&(d.playing&&d.applying&&(d.applying=!1),d.started||function(e,t,i,r){var n=t._private;n.started=!0,n.startTime=i-n.progress*n.duration}(0,h,e),function(e,t,i,r){var n,a,s,o,l=!r,c=e._private,u=t._private,h=u.easing,d=u.startTime,f=(r?e:e.cy()).style();u.easingImpl||(null==h?u.easingImpl=wX.linear:(n=vF(h)?f.parse("transition-timing-function",h).value:h,vF(n)?(a=n,s=[]):(a=n[1],s=n.slice(2).map(function(e){return+e})),s.length>0?("spring"===a&&s.push(u.duration),u.easingImpl=wX[a].apply(null,s)):u.easingImpl=wX[a]));var p=u.easingImpl;if(o=0===u.duration?1:(i-d)/u.duration,u.applying&&(o=u.progress),o<0?o=0:o>1&&(o=1),null==u.delay){var g=u.startPosition,v=u.position;if(v&&l&&!e.locked()){var y={};wQ(g.x,v.x)&&(y.x=wJ(g.x,v.x,o,p)),wQ(g.y,v.y)&&(y.y=wJ(g.y,v.y,o,p)),e.position(y)}var b=u.startPan,x=u.pan,_=c.pan,w=null!=x&&r;w&&(wQ(b.x,x.x)&&(_.x=wJ(b.x,x.x,o,p)),wQ(b.y,x.y)&&(_.y=wJ(b.y,x.y,o,p)),e.emit("pan"));var k=u.startZoom,E=u.zoom,T=null!=E&&r;T&&(wQ(k,E)&&(c.zoom=bb(c.minZoom,wJ(k,E,o,p),c.maxZoom)),e.emit("zoom")),(w||T)&&e.emit("viewport");var P=u.style;if(P&&P.length>0&&l){for(var S=0;S<P.length;S++){var M=P[S],C=M.name,A=u.startStyle[C],I=f.properties[A.name],L=wJ(A,M,o,p,I);f.overrideBypass(e,C,L)}e.emit("style")}}u.progress=o}(t,h,e,i),d.applying&&(d.applying=!1),c(d.frames),null!=d.step&&d.step(e),h.completed()&&(a.splice(u,1),d.hooked=!1,d.playing=!1,d.started=!1,c(d.completes)),o=!0)}return i||0!==a.length||0!==s.length||r.push(t),o}for(var a=!1,s=0;s<i.length;s++){var o=n(i[s]);a=a||o}var l=n(t,!0);(a||l)&&(i.length>0?t.notify("draw",i):t.notify("draw")),i.unmerge(r),t.emit("step")}var w1={animate:_y.animate(),animation:_y.animation(),animated:_y.animated(),clearQueue:_y.clearQueue(),delay:_y.delay(),delayAnimation:_y.delayAnimation(),stop:_y.stop(),addToAnimationPool:function(e){this.styleEnabled()&&this._private.aniEles.merge(e)},stopAnimationLoop:function(){this._private.animationsRunning=!1},startAnimationLoop:function(){var e=this;if(e._private.animationsRunning=!0,e.styleEnabled()){var t=e.renderer();t&&t.beforeRender?t.beforeRender(function(t,i){w0(i,e)},t.beforeRenderPriorities.animations):function t(){e._private.animationsRunning&&yb(function(i){w0(i,e),t()})}()}}},w2={qualifierCompare:function(e,t){return null==e||null==t?null==e&&null==t:e.sameText(t)},eventMatches:function(e,t,i){var r=t.qualifier;return null==r||e!==i.target&&vq(i.target)&&r.matches(i.target)},addEventFields:function(e,t){t.cy=e,t.target=e},callbackContext:function(e,t,i){return null!=t.qualifier?i.target:e}},w3=function(e){return vF(e)?new _N(e):e},w4={createEmitter:function(){var e=this._private;return e.emitter||(e.emitter=new wg(w2,this)),this},emitter:function(){return this._private.emitter},on:function(e,t,i){return this.emitter().on(e,w3(t),i),this},removeListener:function(e,t,i){return this.emitter().removeListener(e,w3(t),i),this},removeAllListeners:function(){return this.emitter().removeAllListeners(),this},one:function(e,t,i){return this.emitter().one(e,w3(t),i),this},once:function(e,t,i){return this.emitter().one(e,w3(t),i),this},emit:function(e,t){return this.emitter().emit(e,t),this},emitAndNotify:function(e,t){return this.emit(e),this.notify(e,t),this}};_y.eventAliasesOn(w4);var w5={png:function(e){return e=e||{},this._private.renderer.png(e)},jpg:function(e){var t=this._private.renderer;return(e=e||{}).bg=e.bg||"#fff",t.jpg(e)}};w5.jpeg=w5.jpg;var w6={layout:function(e){if(null==e)return void yj("Layout options must be specified to make a layout");if(null==e.name)return void yj("A `name` must be specified to make a layout");var t,i=e.name,r=this.extension("layout",i);return null==r?void yj("No such layout `"+i+"` found.  Did you forget to import it and `cytoscape.use()` it?"):(t=vF(e.eles)?this.$(e.eles):null!=e.eles?e.eles:this.$(),new r(ye({},e,{cy:this,eles:t})))}};w6.createLayout=w6.makeLayout=w6.layout;var w8=yW({hideEdgesOnViewport:!1,textureOnViewport:!1,motionBlur:!1,motionBlurOpacity:.05,pixelRatio:void 0,desktopTapThreshold:4,touchTapThreshold:8,wheelSensitivity:1,debug:!1,showFps:!1,webgl:!1,webglDebug:!1,webglDebugShowAtlases:!1,webglTexSize:2048,webglTexRows:36,webglTexRowsNodes:18,webglBatchSize:2048,webglTexPerBatch:14,webglBgColor:[255,255,255]}),w9={renderTo:function(e,t,i,r){return this._private.renderer.renderTo(e,t,i,r),this},renderer:function(){return this._private.renderer},forceRender:function(){return this.notify("draw"),this},resize:function(){return this.invalidateSize(),this.emitAndNotify("resize"),this},initRenderer:function(e){var t=this.extension("renderer",e.name);if(null==t)return void yj("Can not initialise: No such renderer `".concat(e.name,"` found. Did you forget to import it and `cytoscape.use()` it?"));void 0!==e.wheelSensitivity&&yF("You have set a custom wheel sensitivity.  This will make your app zoom unnaturally when using mainstream mice.  You should change this value from the default only if you can guarantee that all your users will use the same hardware and OS configuration as your current machine.");var i=w8(e);i.cy=this,this._private.renderer=new t(i),this.notify("init")},destroyRenderer:function(){this.notify("destroy");var e=this.container();if(e)for(e._cyreg=null;e.childNodes.length>0;)e.removeChild(e.childNodes[0]);this._private.renderer=null,this.mutableElements().forEach(function(e){var t=e._private;t.rscratch={},t.rstyle={},t.animation.current=[],t.animation.queue=[]})},onRender:function(e){return this.on("render",e)},offRender:function(e){return this.off("render",e)}};w9.invalidateDimensions=w9.resize;var w7={collection:function(e,t){return vF(e)?this.$(e):vH(e)?e.collection():vV(e)?(t||(t={}),new wH(this,e,t.unique,t.removed)):new wH(this)},nodes:function(e){var t=this.$(function(e){return e.isNode()});return e?t.filter(e):t},edges:function(e){var t=this.$(function(e){return e.isEdge()});return e?t.filter(e):t},$:function(e){var t=this._private.elements;return e?t.filter(e):t.spawnSelf()},mutableElements:function(){return this._private.elements}};w7.elements=w7.filter=w7.$;var ke={};ke.apply=function(e){for(var t=this._private.cy.collection(),i=0;i<e.length;i++){var r=e[i],n=this.getContextMeta(r);if(!n.empty){var a=this.getContextStyle(n),s=this.applyContextStyle(n,a,r);r._private.appliedInitStyle?this.updateTransitions(r,s.diffProps):r._private.appliedInitStyle=!0,this.updateStyleHints(r)&&t.push(r)}}return t},ke.getPropertiesDiff=function(e,t){var i=this._private.propDiffs=this._private.propDiffs||{},r=e+"-"+t,n=i[r];if(n)return n;for(var a=[],s={},o=0;o<this.length;o++){var l=this[o],c="t"===e[o],u="t"===t[o],h=c!==u,d=l.mappedProperties.length>0;if(h||u&&d){var f=void 0;h&&d||h?f=l.properties:d&&(f=l.mappedProperties);for(var p=0;p<f.length;p++){for(var g=f[p],v=g.name,y=!1,b=o+1;b<this.length;b++){var x=this[b];if("t"===t[b]&&(y=null!=x.properties[g.name]))break}s[v]||y||(s[v]=!0,a.push(v))}}}return i[r]=a,a},ke.getContextMeta=function(e){for(var t,i="",r=e._private.styleCxtKey||"",n=0;n<this.length;n++){var a=this[n];a.selector&&a.selector.matches(e)?i+="t":i+="f"}return t=this.getPropertiesDiff(r,i),e._private.styleCxtKey=i,{key:i,diffPropNames:t,empty:0===t.length}},ke.getContextStyle=function(e){var t=e.key,i=this._private.contextStyles=this._private.contextStyles||{};if(i[t])return i[t];for(var r={_private:{key:t}},n=0;n<this.length;n++){var a=this[n];if("t"===t[n])for(var s=0;s<a.properties.length;s++){var o=a.properties[s];r[o.name]=o}}return i[t]=r,r},ke.applyContextStyle=function(e,t,i){for(var r=e.diffPropNames,n={},a=this.types,s=0;s<r.length;s++){var o=r[s],l=t[o],c=i.pstyle(o);if(!l)if(!c)continue;else l=c.bypass?{name:o,deleteBypassed:!0}:{name:o,delete:!0};if(c!==l){if(l.mapped===a.fn&&null!=c&&null!=c.mapping&&c.mapping.value===l.value){var u=c.mapping;if((u.fnValue=l.value(i))===u.prevFnValue)continue}var h=n[o]={prev:c};this.applyParsedProperty(i,l),h.next=i.pstyle(o),h.next&&h.next.bypass&&(h.next=h.next.bypassed)}}return{diffProps:n}},ke.updateStyleHints=function(e){var t=e._private,i=this,r=i.propertyGroupNames,n=i.propertyGroupKeys,a=function(e,t,r){return i.getPropertiesHash(e,t,r)},s=t.styleKey;if(e.removed())return!1;var o="nodes"===t.group,l=e._private.style;r=Object.keys(l);for(var c=0;c<n.length;c++){var u=n[c];t.styleKeys[u]=[9261,5381]}for(var h=function(e,i){return t.styleKeys[i][0]=y_(e,t.styleKeys[i][0])},d=function(e,i){return t.styleKeys[i][1]=yw(e,t.styleKeys[i][1])},f=function(e,t){for(var i=0;i<e.length;i++){var r=e.charCodeAt(i);h(r,t),d(r,t)}},p=0;p<r.length;p++){var g=r[p],v=l[g];if(null!=v){var y,b,x=this.properties[g],_=x.type,w=x.groupKey,k=void 0;null!=x.hashOverride?k=x.hashOverride(e,v):null!=v.pfValue&&(k=v.pfValue);var E=null==x.enums?v.value:null,T=null!=k,P=null!=E,S=T||P,M=v.units;_.number&&S&&!_.multiple?(h(b=-128<(y=T?k:E)&&y<128&&Math.floor(y)!==y?2e9-(1024*y|0):y,w),d(b,w),T||null==M||f(M,w)):f(v.strValue,w)}}for(var C=[9261,5381],A=0;A<n.length;A++){var I=n[A],L=t.styleKeys[I];C[0]=y_(L[0],C[0]),C[1]=yw(L[1],C[1])}t.styleKey=2097152*C[0]+C[1];var D=t.styleKeys;t.labelDimsKey=yk(D.labelDimensions);var O=a(e,["label"],D.labelDimensions);if(t.labelKey=yk(O),t.labelStyleKey=yk(yE(D.commonLabel,O)),!o){var R=a(e,["source-label"],D.labelDimensions);t.sourceLabelKey=yk(R),t.sourceLabelStyleKey=yk(yE(D.commonLabel,R));var N=a(e,["target-label"],D.labelDimensions);t.targetLabelKey=yk(N),t.targetLabelStyleKey=yk(yE(D.commonLabel,N))}if(o){var j=t.styleKeys,B=j.nodeBody,F=j.nodeBorder,z=j.nodeOutline,V=j.backgroundImage,U=j.compound,$=j.pie,W=j.stripe;t.nodeKey=yk([B,F,z,V,U,$,W].filter(function(e){return null!=e}).reduce(yE,[9261,5381])),t.hasPie=null!=$&&9261!==$[0]&&5381!==$[1],t.hasStripe=null!=W&&9261!==W[0]&&5381!==W[1]}return s!==t.styleKey},ke.clearStyleHints=function(e){var t=e._private;t.styleCxtKey="",t.styleKeys={},t.styleKey=null,t.labelKey=null,t.labelStyleKey=null,t.sourceLabelKey=null,t.sourceLabelStyleKey=null,t.targetLabelKey=null,t.targetLabelStyleKey=null,t.nodeKey=null,t.hasPie=null,t.hasStripe=null},ke.applyParsedProperty=function(e,t){var i=this,r=t,n=e._private.style,a=i.types,s=i.properties[r.name].type,o=r.bypass,l=n[r.name],c=l&&l.bypass,u=e._private,h="mapping",d=function(e){return null==e?null:null!=e.pfValue?e.pfValue:e.value},f=function(){var t=d(l),n=d(r);i.checkTriggers(e,r.name,t,n)};if("curve-style"===t.name&&e.isEdge()&&("bezier"!==t.value&&e.isLoop()||"haystack"===t.value&&(e.source().isParent()||e.target().isParent()))&&(r=t=this.parse(t.name,"bezier",o)),r.delete)return n[r.name]=void 0,f(),!0;if(r.deleteBypassed)if(!l)return f(),!0;else if(l.bypass)return l.bypassed=void 0,f(),!0;else return!1;if(r.deleteBypass)if(!l)return f(),!0;else if(l.bypass)return n[r.name]=l.bypassed,f(),!0;else return!1;var p=function(){yF("Do not assign mappings to elements without corresponding data (i.e. ele `"+e.id()+"` has no mapping for property `"+r.name+"` with data field `"+r.field+"`); try a `["+r.field+"]` selector to limit scope to elements with `"+r.field+"` defined")};switch(r.mapped){case a.mapData:for(var g,v,y=r.field.split("."),b=u.data,x=0;x<y.length&&b;x++)b=b[y[x]];if(null==b)return p(),!1;if(!v$(b))return yF("Do not use continuous mappers without specifying numeric data (i.e. `"+r.field+": "+b+"` for `"+e.id()+"` is non-numeric)"),!1;var _=r.fieldMax-r.fieldMin;if((v=0===_?0:(b-r.fieldMin)/_)<0?v=0:v>1&&(v=1),s.color){var w=r.valueMin[0],k=r.valueMax[0],E=r.valueMin[1],T=r.valueMax[1],P=r.valueMin[2],S=r.valueMax[2],M=null==r.valueMin[3]?1:r.valueMin[3],C=[Math.round(w+(k-w)*v),Math.round(E+(T-E)*v),Math.round(P+(S-P)*v),Math.round(M+((null==r.valueMax[3]?1:r.valueMax[3])-M)*v)];g={bypass:r.bypass,name:r.name,value:C,strValue:"rgb("+C[0]+", "+C[1]+", "+C[2]+")"}}else{if(!s.number)return!1;var A=r.valueMin+(r.valueMax-r.valueMin)*v;g=this.parse(r.name,A,r.bypass,h)}if(!g)return p(),!1;g.mapping=r,r=g;break;case a.data:for(var I=r.field.split("."),L=u.data,D=0;D<I.length&&L;D++)L=L[I[D]];if(null!=L&&(g=this.parse(r.name,L,r.bypass,h)),!g)return p(),!1;g.mapping=r,r=g;break;case a.fn:var O=r.value,R=null!=r.fnValue?r.fnValue:O(e);if(r.prevFnValue=R,null==R)return yF("Custom function mappers may not return null (i.e. `"+r.name+"` for ele `"+e.id()+"` is null)"),!1;if(!(g=this.parse(r.name,R,r.bypass,h)))return yF("Custom function mappers may not return invalid values for the property type (i.e. `"+r.name+"` for ele `"+e.id()+"` is invalid)"),!1;g.mapping=yz(r),r=g;break;case void 0:break;default:return!1}return o?(c?r.bypassed=l.bypassed:r.bypassed=l,n[r.name]=r):c?l.bypassed=r:n[r.name]=r,f(),!0},ke.cleanElements=function(e,t){for(var i=0;i<e.length;i++){var r=e[i];if(this.clearStyleHints(r),r.dirtyCompoundBoundsCache(),r.dirtyBoundingBoxCache(),t)for(var n=r._private.style,a=Object.keys(n),s=0;s<a.length;s++){var o=a[s],l=n[o];null!=l&&(l.bypass?l.bypassed=null:n[o]=null)}else r._private.style={}}},ke.update=function(){this._private.cy.mutableElements().updateStyle()},ke.updateTransitions=function(e,t){var i=this,r=e._private,n=e.pstyle("transition-property").value,a=e.pstyle("transition-duration").pfValue,s=e.pstyle("transition-delay").pfValue;if(n.length>0&&a>0){for(var o={},l=!1,c=0;c<n.length;c++){var u=n[c],h=e.pstyle(u),d=t[u];if(d){var f=d.prev,p=null!=d.next?d.next:h,g=!1,v=void 0;f&&(v$(f.pfValue)&&v$(p.pfValue)?(g=p.pfValue-f.pfValue,v=f.pfValue+1e-6*g):v$(f.value)&&v$(p.value)?(g=p.value-f.value,v=f.value+1e-6*g):vV(f.value)&&vV(p.value)&&(g=f.value[0]!==p.value[0]||f.value[1]!==p.value[1]||f.value[2]!==p.value[2],v=f.strValue),g&&(o[u]=p.strValue,this.applyBypass(e,u,v),l=!0))}}if(!l)return;r.transitioning=!0,new _t(function(t){s>0?e.delayAnimation(s).play().promise().then(t):t()}).then(function(){return e.animation({style:o,duration:a,easing:e.pstyle("transition-timing-function").value,queue:!1}).play().promise()}).then(function(){i.removeBypasses(e,n),e.emitAndNotify("style"),r.transitioning=!1})}else r.transitioning&&(this.removeBypasses(e,n),e.emitAndNotify("style"),r.transitioning=!1)},ke.checkTrigger=function(e,t,i,r,n,a){var s=this.properties[t],o=n(s);!e.removed()&&null!=o&&o(i,r,e)&&a(s)},ke.checkZOrderTrigger=function(e,t,i,r){var n=this;this.checkTrigger(e,t,i,r,function(e){return e.triggersZOrder},function(){n._private.cy.notify("zorder",e)})},ke.checkBoundsTrigger=function(e,t,i,r){this.checkTrigger(e,t,i,r,function(e){return e.triggersBounds},function(t){e.dirtyCompoundBoundsCache(),e.dirtyBoundingBoxCache()})},ke.checkConnectedEdgesBoundsTrigger=function(e,t,i,r){this.checkTrigger(e,t,i,r,function(e){return e.triggersBoundsOfConnectedEdges},function(t){e.connectedEdges().forEach(function(e){e.dirtyBoundingBoxCache()})})},ke.checkParallelEdgesBoundsTrigger=function(e,t,i,r){this.checkTrigger(e,t,i,r,function(e){return e.triggersBoundsOfParallelEdges},function(t){e.parallelEdges().forEach(function(e){e.dirtyBoundingBoxCache()})})},ke.checkTriggers=function(e,t,i,r){e.dirtyStyleCache(),this.checkZOrderTrigger(e,t,i,r),this.checkBoundsTrigger(e,t,i,r),this.checkConnectedEdgesBoundsTrigger(e,t,i,r),this.checkParallelEdgesBoundsTrigger(e,t,i,r)};var kt={};kt.applyBypass=function(e,t,i,r){var n=[];if("*"===t||"**"===t){if(void 0!==i)for(var a=0;a<this.properties.length;a++){var s=this.properties[a].name,o=this.parse(s,i,!0);o&&n.push(o)}}else if(vF(t)){var l=this.parse(t,i,!0);l&&n.push(l)}else{if(!vU(t))return!1;r=i;for(var c=Object.keys(t),u=0;u<c.length;u++){var h=c[u],d=t[h];if(void 0===d&&(d=t[v0(h)]),void 0!==d){var f=this.parse(h,d,!0);f&&n.push(f)}}}if(0===n.length)return!1;for(var p=!1,g=0;g<e.length;g++){for(var v=e[g],y={},b=void 0,x=0;x<n.length;x++){var _=n[x];if(r){var w=v.pstyle(_.name);b=y[_.name]={prev:w}}p=this.applyParsedProperty(v,yz(_))||p,r&&(b.next=v.pstyle(_.name))}p&&this.updateStyleHints(v),r&&this.updateTransitions(v,y,!0)}return p},kt.overrideBypass=function(e,t,i){t=vQ(t);for(var r=0;r<e.length;r++){var n=e[r],a=n._private.style[t],s=this.properties[t].type,o=s.color,l=s.mutiple,c=a?null!=a.pfValue?a.pfValue:a.value:null;a&&a.bypass?(a.value=i,null!=a.pfValue&&(a.pfValue=i),o?a.strValue="rgb("+i.join(",")+")":l?a.strValue=i.join(" "):a.strValue=""+i,this.updateStyleHints(n)):this.applyBypass(n,t,i),this.checkTriggers(n,t,c,i)}},kt.removeAllBypasses=function(e,t){return this.removeBypasses(e,this.propertyNames,t)},kt.removeBypasses=function(e,t,i){for(var r=0;r<e.length;r++){for(var n=e[r],a={},s=0;s<t.length;s++){var o=t[s],l=this.properties[o],c=n.pstyle(l.name);if(c&&c.bypass){var u=this.parse(o,"",!0),h=a[l.name]={prev:c};this.applyParsedProperty(n,u),h.next=n.pstyle(l.name)}}this.updateStyleHints(n),i&&this.updateTransitions(n,a,!0)}};var ki={};ki.getEmSizeInPixels=function(){var e=this.containerCss("font-size");return null!=e?parseFloat(e):1},ki.containerCss=function(e){var t=this._private.cy,i=t.container(),r=t.window();if(r&&i&&r.getComputedStyle)return r.getComputedStyle(i).getPropertyValue(e)};var kr={};kr.getRenderedStyle=function(e,t){return t?this.getStylePropertyValue(e,t,!0):this.getRawStyle(e,!0)},kr.getRawStyle=function(e,t){if(e=e[0]){for(var i={},r=0;r<this.properties.length;r++){var n=this.properties[r],a=this.getStylePropertyValue(e,n.name,t);null!=a&&(i[n.name]=a,i[v0(n.name)]=a)}return i}},kr.getIndexedStyle=function(e,t,i,r){var n=e.pstyle(t)[i][r];return null!=n?n:e.cy().style().getDefaultProperty(t)[i][0]},kr.getStylePropertyValue=function(e,t,i){if(e=e[0]){var r=this.properties[t];r.alias&&(r=r.pointsTo);var n=r.type,a=e.pstyle(r.name);if(a){var s=a.value,o=a.units,l=a.strValue;if(i&&n.number&&null!=s&&v$(s)){var c=e.cy().zoom(),u=function(e){return e*c},h=function(e,t){return u(e)+t},d=vV(s);if(d?o.every(function(e){return null!=e}):null!=o)if(d)return s.map(function(e,t){return h(e,o[t])}).join(" ");else return h(s,o);return d?s.map(function(e){return vF(e)?e:""+u(e)}).join(" "):""+u(s)}if(null!=l)return l}return null}},kr.getAnimationStartStyle=function(e,t){for(var i={},r=0;r<t.length;r++){var n=t[r].name,a=e.pstyle(n);void 0!==a&&(a=vU(a)?this.parse(n,a.strValue):this.parse(n,a)),a&&(i[n]=a)}return i},kr.getPropsList=function(e){var t=[],i=this.properties;if(e)for(var r=Object.keys(e),n=0;n<r.length;n++){var a=r[n],s=e[a],o=i[a]||i[vQ(a)],l=this.parse(o.name,s);l&&t.push(l)}return t},kr.getNonDefaultPropertiesHash=function(e,t,i){var r,n,a,s,o,l,c=i.slice();for(o=0;o<t.length;o++)if(r=t[o],null!=(n=e.pstyle(r,!1)))if(null!=n.pfValue)c[0]=y_(s,c[0]),c[1]=yw(s,c[1]);else for(l=0,a=n.strValue;l<a.length;l++)s=a.charCodeAt(l),c[0]=y_(s,c[0]),c[1]=yw(s,c[1]);return c},kr.getPropertiesHash=kr.getNonDefaultPropertiesHash;var kn={};kn.appendFromJson=function(e){for(var t=0;t<e.length;t++){var i=e[t],r=i.selector,n=i.style||i.css,a=Object.keys(n);this.selector(r);for(var s=0;s<a.length;s++){var o=a[s],l=n[o];this.css(o,l)}}return this},kn.fromJson=function(e){return this.resetToDefault(),this.appendFromJson(e),this},kn.json=function(){for(var e=[],t=this.defaultLength;t<this.length;t++){for(var i=this[t],r=i.selector,n=i.properties,a={},s=0;s<n.length;s++){var o=n[s];a[o.name]=o.strValue}e.push({selector:r?r.toString():"core",style:a})}return e};var ka={};ka.appendFromString=function(e){var t,i,r,n=""+e;function a(){n=n.length>t.length?n.substr(t.length):""}function s(){i=i.length>r.length?i.substr(r.length):""}for(n=n.replace(/[/][*](\s|.)+?[*][/]/g,"");!n.match(/^\s*$/);){var o=n.match(/^\s*((?:.|\s)+?)\s*\{((?:.|\s)+?)\}/);if(!o){yF("Halting stylesheet parsing: String stylesheet contains more to parse but no selector and block found in: "+n);break}t=o[0];var l=o[1];if("core"!==l&&new _N(l).invalid){yF("Skipping parsing of block: Invalid selector found in string stylesheet: "+l),a();continue}var c=o[2],u=!1;i=c;for(var h=[];!i.match(/^\s*$/);){var d=i.match(/^\s*(.+?)\s*:\s*(.+?)(?:\s*;|\s*$)/);if(!d){yF("Skipping parsing of block: Invalid formatting of style property and value definitions found in:"+c),u=!0;break}r=d[0];var f=d[1],p=d[2];if(!this.properties[f]){yF("Skipping property: Invalid property name in: "+r),s();continue}if(!this.parse(f,p)){yF("Skipping property: Invalid property definition in: "+r),s();continue}h.push({name:f,val:p}),s()}if(u){a();break}this.selector(l);for(var g=0;g<h.length;g++){var v=h[g];this.css(v.name,v.val)}a()}return this},ka.fromString=function(e){return this.resetToDefault(),this.appendFromString(e),this};var ks={};!function(){var e=function(e){return"^"+e+"\\s*\\(\\s*([\\w\\.]+)\\s*\\)$"},t=function(e){var t=v4+"|\\w+|"+v6+"|"+v9+"|\\#[0-9a-fA-F]{3}|\\#[0-9a-fA-F]{6}";return"^"+e+"\\s*\\(([\\w\\.]+)\\s*\\,\\s*("+v4+")\\s*\\,\\s*("+v4+")\\s*,\\s*("+t+")\\s*\\,\\s*("+t+")\\)$"},i=["^url\\s*\\(\\s*['\"]?(.+?)['\"]?\\s*\\)$","^(none)$","^(.+)$"];ks.types={time:{number:!0,min:0,units:"s|ms",implicitUnits:"ms"},percent:{number:!0,min:0,max:100,units:"%",implicitUnits:"%"},percentages:{number:!0,min:0,max:100,units:"%",implicitUnits:"%",multiple:!0},zeroOneNumber:{number:!0,min:0,max:1,unitless:!0},zeroOneNumbers:{number:!0,min:0,max:1,unitless:!0,multiple:!0},nOneOneNumber:{number:!0,min:-1,max:1,unitless:!0},nonNegativeInt:{number:!0,min:0,integer:!0,unitless:!0},nonNegativeNumber:{number:!0,min:0,unitless:!0},position:{enums:["parent","origin"]},nodeSize:{number:!0,min:0,enums:["label"]},number:{number:!0,unitless:!0},numbers:{number:!0,unitless:!0,multiple:!0},positiveNumber:{number:!0,unitless:!0,min:0,strictMin:!0},size:{number:!0,min:0},bidirectionalSize:{number:!0},bidirectionalSizeMaybePercent:{number:!0,allowPercent:!0},bidirectionalSizes:{number:!0,multiple:!0},sizeMaybePercent:{number:!0,min:0,allowPercent:!0},axisDirection:{enums:["horizontal","leftward","rightward","vertical","upward","downward","auto"]},axisDirectionExplicit:{enums:["leftward","rightward","upward","downward"]},axisDirectionPrimary:{enums:["horizontal","vertical"]},paddingRelativeTo:{enums:["width","height","average","min","max"]},bgWH:{number:!0,min:0,allowPercent:!0,enums:["auto"],multiple:!0},bgPos:{number:!0,allowPercent:!0,multiple:!0},bgRelativeTo:{enums:["inner","include-padding"],multiple:!0},bgRepeat:{enums:["repeat","repeat-x","repeat-y","no-repeat"],multiple:!0},bgFit:{enums:["none","contain","cover"],multiple:!0},bgCrossOrigin:{enums:["anonymous","use-credentials","null"],multiple:!0},bgClip:{enums:["none","node"],multiple:!0},bgContainment:{enums:["inside","over"],multiple:!0},boxSelection:{enums:["contain","overlap","none"]},color:{color:!0},colors:{color:!0,multiple:!0},fill:{enums:["solid","linear-gradient","radial-gradient"]},bool:{enums:["yes","no"]},bools:{enums:["yes","no"],multiple:!0},lineStyle:{enums:["solid","dotted","dashed"]},lineCap:{enums:["butt","round","square"]},linePosition:{enums:["center","inside","outside"]},lineJoin:{enums:["round","bevel","miter"]},borderStyle:{enums:["solid","dotted","dashed","double"]},curveStyle:{enums:["bezier","unbundled-bezier","haystack","segments","straight","straight-triangle","taxi","round-segments","round-taxi"]},radiusType:{enums:["arc-radius","influence-radius"],multiple:!0},fontFamily:{regex:'^([\\w- \\"]+(?:\\s*,\\s*[\\w- \\"]+)*)$'},fontStyle:{enums:["italic","normal","oblique"]},fontWeight:{enums:["normal","bold","bolder","lighter","100","200","300","400","500","600","800","900",100,200,300,400,500,600,700,800,900]},textDecoration:{enums:["none","underline","overline","line-through"]},textTransform:{enums:["none","uppercase","lowercase"]},textWrap:{enums:["none","wrap","ellipsis"]},textOverflowWrap:{enums:["whitespace","anywhere"]},textBackgroundShape:{enums:["rectangle","roundrectangle","round-rectangle","circle"]},nodeShape:{enums:["rectangle","roundrectangle","round-rectangle","cutrectangle","cut-rectangle","bottomroundrectangle","bottom-round-rectangle","barrel","ellipse","triangle","round-triangle","square","pentagon","round-pentagon","hexagon","round-hexagon","concavehexagon","concave-hexagon","heptagon","round-heptagon","octagon","round-octagon","tag","round-tag","star","diamond","round-diamond","vee","rhomboid","right-rhomboid","polygon"]},overlayShape:{enums:["roundrectangle","round-rectangle","ellipse"]},cornerRadius:{number:!0,min:0,units:"px|em",implicitUnits:"px",enums:["auto"]},compoundIncludeLabels:{enums:["include","exclude"]},arrowShape:{enums:["tee","triangle","triangle-tee","circle-triangle","triangle-cross","triangle-backcurve","vee","square","circle","diamond","chevron","none"]},arrowFill:{enums:["filled","hollow"]},arrowWidth:{number:!0,units:"%|px|em",implicitUnits:"px",enums:["match-line"]},display:{enums:["element","none"]},visibility:{enums:["hidden","visible"]},zCompoundDepth:{enums:["bottom","orphan","auto","top"]},zIndexCompare:{enums:["auto","manual"]},valign:{enums:["top","center","bottom"]},halign:{enums:["left","center","right"]},justification:{enums:["left","center","right","auto"]},text:{string:!0},data:{mapping:!0,regex:e("data")},layoutData:{mapping:!0,regex:e("layoutData")},scratch:{mapping:!0,regex:e("scratch")},mapData:{mapping:!0,regex:t("mapData")},mapLayoutData:{mapping:!0,regex:t("mapLayoutData")},mapScratch:{mapping:!0,regex:t("mapScratch")},fn:{mapping:!0,fn:!0},url:{regexes:i,singleRegexMatchValue:!0},urls:{regexes:i,singleRegexMatchValue:!0,multiple:!0},propList:{propList:!0},angle:{number:!0,units:"deg|rad",implicitUnits:"rad"},textRotation:{number:!0,units:"deg|rad",implicitUnits:"rad",enums:["none","autorotate"]},polygonPointList:{number:!0,multiple:!0,evenMultiple:!0,min:-1,max:1,unitless:!0},edgeDistances:{enums:["intersection","node-position","endpoints"]},edgeEndpoint:{number:!0,multiple:!0,units:"%|px|em|deg|rad",implicitUnits:"px",enums:["inside-to-node","outside-to-node","outside-to-node-or-label","outside-to-line","outside-to-line-or-label"],singleEnum:!0,validate:function(e,t){switch(e.length){case 2:return"deg"!==t[0]&&"rad"!==t[0]&&"deg"!==t[1]&&"rad"!==t[1];case 1:return vF(e[0])||"deg"===t[0]||"rad"===t[0];default:return!1}}},easing:{regexes:["^(spring)\\s*\\(\\s*("+v4+")\\s*,\\s*("+v4+")\\s*\\)$","^(cubic-bezier)\\s*\\(\\s*("+v4+")\\s*,\\s*("+v4+")\\s*,\\s*("+v4+")\\s*,\\s*("+v4+")\\s*\\)$"],enums:["linear","ease","ease-in","ease-out","ease-in-out","ease-in-sine","ease-out-sine","ease-in-out-sine","ease-in-quad","ease-out-quad","ease-in-out-quad","ease-in-cubic","ease-out-cubic","ease-in-out-cubic","ease-in-quart","ease-out-quart","ease-in-out-quart","ease-in-quint","ease-out-quint","ease-in-out-quint","ease-in-expo","ease-out-expo","ease-in-out-expo","ease-in-circ","ease-out-circ","ease-in-out-circ"]},gradientDirection:{enums:["to-bottom","to-top","to-left","to-right","to-bottom-right","to-bottom-left","to-top-right","to-top-left","to-right-bottom","to-left-bottom","to-right-top","to-left-top"]},boundsExpansion:{number:!0,multiple:!0,min:0,validate:function(e){var t=e.length;return 1===t||2===t||4===t}}};var r=function(e,t){return(null==e||null==t)&&e!==t||0==e&&0!=t||0!=e&&0==t},n=function(e,t){return e!=t},a=ks.types,s=[{name:"label",type:a.text,triggersBounds:n,triggersZOrder:function(e,t){var i=vK(e),r=vK(t);return i&&!r||!i&&r}},{name:"text-rotation",type:a.textRotation,triggersBounds:n},{name:"text-margin-x",type:a.bidirectionalSize,triggersBounds:n},{name:"text-margin-y",type:a.bidirectionalSize,triggersBounds:n}],o=[{name:"source-label",type:a.text,triggersBounds:n},{name:"source-text-rotation",type:a.textRotation,triggersBounds:n},{name:"source-text-margin-x",type:a.bidirectionalSize,triggersBounds:n},{name:"source-text-margin-y",type:a.bidirectionalSize,triggersBounds:n},{name:"source-text-offset",type:a.size,triggersBounds:n}],l=[{name:"target-label",type:a.text,triggersBounds:n},{name:"target-text-rotation",type:a.textRotation,triggersBounds:n},{name:"target-text-margin-x",type:a.bidirectionalSize,triggersBounds:n},{name:"target-text-margin-y",type:a.bidirectionalSize,triggersBounds:n},{name:"target-text-offset",type:a.size,triggersBounds:n}],c=[{name:"font-family",type:a.fontFamily,triggersBounds:n},{name:"font-style",type:a.fontStyle,triggersBounds:n},{name:"font-weight",type:a.fontWeight,triggersBounds:n},{name:"font-size",type:a.size,triggersBounds:n},{name:"text-transform",type:a.textTransform,triggersBounds:n},{name:"text-wrap",type:a.textWrap,triggersBounds:n},{name:"text-overflow-wrap",type:a.textOverflowWrap,triggersBounds:n},{name:"text-max-width",type:a.size,triggersBounds:n},{name:"text-outline-width",type:a.size,triggersBounds:n},{name:"line-height",type:a.positiveNumber,triggersBounds:n}],u=[{name:"text-valign",type:a.valign,triggersBounds:n},{name:"text-halign",type:a.halign,triggersBounds:n},{name:"color",type:a.color},{name:"text-outline-color",type:a.color},{name:"text-outline-opacity",type:a.zeroOneNumber},{name:"text-background-color",type:a.color},{name:"text-background-opacity",type:a.zeroOneNumber},{name:"text-background-padding",type:a.size,triggersBounds:n},{name:"text-border-opacity",type:a.zeroOneNumber},{name:"text-border-color",type:a.color},{name:"text-border-width",type:a.size,triggersBounds:n},{name:"text-border-style",type:a.borderStyle,triggersBounds:n},{name:"text-background-shape",type:a.textBackgroundShape,triggersBounds:n},{name:"text-justification",type:a.justification},{name:"box-select-labels",type:a.bool,triggersBounds:n}],h=[{name:"events",type:a.bool,triggersZOrder:n},{name:"text-events",type:a.bool,triggersZOrder:n},{name:"box-selection",type:a.boxSelection,triggersZOrder:n}],d=[{name:"display",type:a.display,triggersZOrder:n,triggersBounds:n,triggersBoundsOfConnectedEdges:n,triggersBoundsOfParallelEdges:function(e,t,i){return e!==t&&"bezier"===i.pstyle("curve-style").value}},{name:"visibility",type:a.visibility,triggersZOrder:n},{name:"opacity",type:a.zeroOneNumber,triggersZOrder:r},{name:"text-opacity",type:a.zeroOneNumber},{name:"min-zoomed-font-size",type:a.size},{name:"z-compound-depth",type:a.zCompoundDepth,triggersZOrder:n},{name:"z-index-compare",type:a.zIndexCompare,triggersZOrder:n},{name:"z-index",type:a.number,triggersZOrder:n}],f=[{name:"overlay-padding",type:a.size,triggersBounds:n},{name:"overlay-color",type:a.color},{name:"overlay-opacity",type:a.zeroOneNumber,triggersBounds:r},{name:"overlay-shape",type:a.overlayShape,triggersBounds:n},{name:"overlay-corner-radius",type:a.cornerRadius}],p=[{name:"underlay-padding",type:a.size,triggersBounds:n},{name:"underlay-color",type:a.color},{name:"underlay-opacity",type:a.zeroOneNumber,triggersBounds:r},{name:"underlay-shape",type:a.overlayShape,triggersBounds:n},{name:"underlay-corner-radius",type:a.cornerRadius}],g=[{name:"transition-property",type:a.propList},{name:"transition-duration",type:a.time},{name:"transition-delay",type:a.time},{name:"transition-timing-function",type:a.easing}],v=function(e,t){return"label"===t.value?-e.poolIndex():t.pfValue},y=[{name:"height",type:a.nodeSize,triggersBounds:n,hashOverride:v},{name:"width",type:a.nodeSize,triggersBounds:n,hashOverride:v},{name:"shape",type:a.nodeShape,triggersBounds:n},{name:"shape-polygon-points",type:a.polygonPointList,triggersBounds:n},{name:"corner-radius",type:a.cornerRadius},{name:"background-color",type:a.color},{name:"background-fill",type:a.fill},{name:"background-opacity",type:a.zeroOneNumber},{name:"background-blacken",type:a.nOneOneNumber},{name:"background-gradient-stop-colors",type:a.colors},{name:"background-gradient-stop-positions",type:a.percentages},{name:"background-gradient-direction",type:a.gradientDirection},{name:"padding",type:a.sizeMaybePercent,triggersBounds:n},{name:"padding-relative-to",type:a.paddingRelativeTo,triggersBounds:n},{name:"bounds-expansion",type:a.boundsExpansion,triggersBounds:n}],b=[{name:"border-color",type:a.color},{name:"border-opacity",type:a.zeroOneNumber},{name:"border-width",type:a.size,triggersBounds:n},{name:"border-style",type:a.borderStyle},{name:"border-cap",type:a.lineCap},{name:"border-join",type:a.lineJoin},{name:"border-dash-pattern",type:a.numbers},{name:"border-dash-offset",type:a.number},{name:"border-position",type:a.linePosition}],x=[{name:"outline-color",type:a.color},{name:"outline-opacity",type:a.zeroOneNumber},{name:"outline-width",type:a.size,triggersBounds:n},{name:"outline-style",type:a.borderStyle},{name:"outline-offset",type:a.size,triggersBounds:n}],_=[{name:"background-image",type:a.urls},{name:"background-image-crossorigin",type:a.bgCrossOrigin},{name:"background-image-opacity",type:a.zeroOneNumbers},{name:"background-image-containment",type:a.bgContainment},{name:"background-image-smoothing",type:a.bools},{name:"background-position-x",type:a.bgPos},{name:"background-position-y",type:a.bgPos},{name:"background-width-relative-to",type:a.bgRelativeTo},{name:"background-height-relative-to",type:a.bgRelativeTo},{name:"background-repeat",type:a.bgRepeat},{name:"background-fit",type:a.bgFit},{name:"background-clip",type:a.bgClip},{name:"background-width",type:a.bgWH},{name:"background-height",type:a.bgWH},{name:"background-offset-x",type:a.bgPos},{name:"background-offset-y",type:a.bgPos}],w=[{name:"position",type:a.position,triggersBounds:n},{name:"compound-sizing-wrt-labels",type:a.compoundIncludeLabels,triggersBounds:n},{name:"min-width",type:a.size,triggersBounds:n},{name:"min-width-bias-left",type:a.sizeMaybePercent,triggersBounds:n},{name:"min-width-bias-right",type:a.sizeMaybePercent,triggersBounds:n},{name:"min-height",type:a.size,triggersBounds:n},{name:"min-height-bias-top",type:a.sizeMaybePercent,triggersBounds:n},{name:"min-height-bias-bottom",type:a.sizeMaybePercent,triggersBounds:n}],k=[{name:"line-style",type:a.lineStyle},{name:"line-color",type:a.color},{name:"line-fill",type:a.fill},{name:"line-cap",type:a.lineCap},{name:"line-opacity",type:a.zeroOneNumber},{name:"line-dash-pattern",type:a.numbers},{name:"line-dash-offset",type:a.number},{name:"line-outline-width",type:a.size},{name:"line-outline-color",type:a.color},{name:"line-gradient-stop-colors",type:a.colors},{name:"line-gradient-stop-positions",type:a.percentages},{name:"curve-style",type:a.curveStyle,triggersBounds:n,triggersBoundsOfParallelEdges:function(e,t){return e!==t&&("bezier"===e||"bezier"===t)}},{name:"haystack-radius",type:a.zeroOneNumber,triggersBounds:n},{name:"source-endpoint",type:a.edgeEndpoint,triggersBounds:n},{name:"target-endpoint",type:a.edgeEndpoint,triggersBounds:n},{name:"control-point-step-size",type:a.size,triggersBounds:n},{name:"control-point-distances",type:a.bidirectionalSizes,triggersBounds:n},{name:"control-point-weights",type:a.numbers,triggersBounds:n},{name:"segment-distances",type:a.bidirectionalSizes,triggersBounds:n},{name:"segment-weights",type:a.numbers,triggersBounds:n},{name:"segment-radii",type:a.numbers,triggersBounds:n},{name:"radius-type",type:a.radiusType,triggersBounds:n},{name:"taxi-turn",type:a.bidirectionalSizeMaybePercent,triggersBounds:n},{name:"taxi-turn-min-distance",type:a.size,triggersBounds:n},{name:"taxi-direction",type:a.axisDirection,triggersBounds:n},{name:"taxi-radius",type:a.number,triggersBounds:n},{name:"edge-distances",type:a.edgeDistances,triggersBounds:n},{name:"arrow-scale",type:a.positiveNumber,triggersBounds:n},{name:"loop-direction",type:a.angle,triggersBounds:n},{name:"loop-sweep",type:a.angle,triggersBounds:n},{name:"source-distance-from-node",type:a.size,triggersBounds:n},{name:"target-distance-from-node",type:a.size,triggersBounds:n}],E=[{name:"ghost",type:a.bool,triggersBounds:n},{name:"ghost-offset-x",type:a.bidirectionalSize,triggersBounds:n},{name:"ghost-offset-y",type:a.bidirectionalSize,triggersBounds:n},{name:"ghost-opacity",type:a.zeroOneNumber}],T=[{name:"selection-box-color",type:a.color},{name:"selection-box-opacity",type:a.zeroOneNumber},{name:"selection-box-border-color",type:a.color},{name:"selection-box-border-width",type:a.size},{name:"active-bg-color",type:a.color},{name:"active-bg-opacity",type:a.zeroOneNumber},{name:"active-bg-size",type:a.size},{name:"outside-texture-bg-color",type:a.color},{name:"outside-texture-bg-opacity",type:a.zeroOneNumber}],P=[];ks.pieBackgroundN=16,P.push({name:"pie-size",type:a.sizeMaybePercent}),P.push({name:"pie-hole",type:a.sizeMaybePercent}),P.push({name:"pie-start-angle",type:a.angle});for(var S=1;S<=ks.pieBackgroundN;S++)P.push({name:"pie-"+S+"-background-color",type:a.color}),P.push({name:"pie-"+S+"-background-size",type:a.percent}),P.push({name:"pie-"+S+"-background-opacity",type:a.zeroOneNumber});var M=[];ks.stripeBackgroundN=16,M.push({name:"stripe-size",type:a.sizeMaybePercent}),M.push({name:"stripe-direction",type:a.axisDirectionPrimary});for(var C=1;C<=ks.stripeBackgroundN;C++)M.push({name:"stripe-"+C+"-background-color",type:a.color}),M.push({name:"stripe-"+C+"-background-size",type:a.percent}),M.push({name:"stripe-"+C+"-background-opacity",type:a.zeroOneNumber});var A=[],I=ks.arrowPrefixes=["source","mid-source","target","mid-target"];[{name:"arrow-shape",type:a.arrowShape,triggersBounds:n},{name:"arrow-color",type:a.color},{name:"arrow-fill",type:a.arrowFill},{name:"arrow-width",type:a.arrowWidth}].forEach(function(e){I.forEach(function(t){var i=t+"-"+e.name,r=e.type,n=e.triggersBounds;A.push({name:i,type:r,triggersBounds:n})})},{});var L=ks.properties=[].concat(h,g,d,f,p,E,u,c,s,o,l,y,b,x,_,P,M,w,k,A,T),D=ks.propertyGroups={behavior:h,transition:g,visibility:d,overlay:f,underlay:p,ghost:E,commonLabel:u,labelDimensions:c,mainLabel:s,sourceLabel:o,targetLabel:l,nodeBody:y,nodeBorder:b,nodeOutline:x,backgroundImage:_,pie:P,stripe:M,compound:w,edgeLine:k,edgeArrow:A,core:T},O=ks.propertyGroupNames={};(ks.propertyGroupKeys=Object.keys(D)).forEach(function(e){O[e]=D[e].map(function(e){return e.name}),D[e].forEach(function(t){return t.groupKey=e})});var R=ks.aliases=[{name:"content",pointsTo:"label"},{name:"control-point-distance",pointsTo:"control-point-distances"},{name:"control-point-weight",pointsTo:"control-point-weights"},{name:"segment-distance",pointsTo:"segment-distances"},{name:"segment-weight",pointsTo:"segment-weights"},{name:"segment-radius",pointsTo:"segment-radii"},{name:"edge-text-rotation",pointsTo:"text-rotation"},{name:"padding-left",pointsTo:"padding"},{name:"padding-right",pointsTo:"padding"},{name:"padding-top",pointsTo:"padding"},{name:"padding-bottom",pointsTo:"padding"}];ks.propertyNames=L.map(function(e){return e.name});for(var N=0;N<L.length;N++){var j=L[N];L[j.name]=j}for(var B=0;B<R.length;B++){var F=R[B],z=L[F.pointsTo],V={name:F.name,alias:!0,pointsTo:z};L.push(V),L[F.name]=V}}(),ks.getDefaultProperty=function(e){return this.getDefaultProperties()[e]},ks.getDefaultProperties=function(){var e=this._private;if(null!=e.defaultProperties)return e.defaultProperties;for(var t=ye({"selection-box-color":"#ddd","selection-box-opacity":.65,"selection-box-border-color":"#aaa","selection-box-border-width":1,"active-bg-color":"black","active-bg-opacity":.15,"active-bg-size":30,"outside-texture-bg-color":"#000","outside-texture-bg-opacity":.125,events:"yes","text-events":"no","text-valign":"top","text-halign":"center","text-justification":"auto","line-height":1,color:"#000","box-selection":"contain","text-outline-color":"#000","text-outline-width":0,"text-outline-opacity":1,"text-opacity":1,"text-decoration":"none","text-transform":"none","text-wrap":"none","text-overflow-wrap":"whitespace","text-max-width":9999,"text-background-color":"#000","text-background-opacity":0,"text-background-shape":"rectangle","text-background-padding":0,"text-border-opacity":0,"text-border-width":0,"text-border-style":"solid","text-border-color":"#000","font-family":"Helvetica Neue, Helvetica, sans-serif","font-style":"normal","font-weight":"normal","font-size":16,"min-zoomed-font-size":0,"text-rotation":"none","source-text-rotation":"none","target-text-rotation":"none",visibility:"visible",display:"element",opacity:1,"z-compound-depth":"auto","z-index-compare":"auto","z-index":0,label:"","text-margin-x":0,"text-margin-y":0,"source-label":"","source-text-offset":0,"source-text-margin-x":0,"source-text-margin-y":0,"target-label":"","target-text-offset":0,"target-text-margin-x":0,"target-text-margin-y":0,"overlay-opacity":0,"overlay-color":"#000","overlay-padding":10,"overlay-shape":"round-rectangle","overlay-corner-radius":"auto","underlay-opacity":0,"underlay-color":"#000","underlay-padding":10,"underlay-shape":"round-rectangle","underlay-corner-radius":"auto","transition-property":"none","transition-duration":0,"transition-delay":0,"transition-timing-function":"linear","box-select-labels":"no","background-blacken":0,"background-color":"#999","background-fill":"solid","background-opacity":1,"background-image":"none","background-image-crossorigin":"anonymous","background-image-opacity":1,"background-image-containment":"inside","background-image-smoothing":"yes","background-position-x":"50%","background-position-y":"50%","background-offset-x":0,"background-offset-y":0,"background-width-relative-to":"include-padding","background-height-relative-to":"include-padding","background-repeat":"no-repeat","background-fit":"none","background-clip":"node","background-width":"auto","background-height":"auto","border-color":"#000","border-opacity":1,"border-width":0,"border-style":"solid","border-dash-pattern":[4,2],"border-dash-offset":0,"border-cap":"butt","border-join":"miter","border-position":"center","outline-color":"#999","outline-opacity":1,"outline-width":0,"outline-offset":0,"outline-style":"solid",height:30,width:30,shape:"ellipse","shape-polygon-points":"-1, -1,   1, -1,   1, 1,   -1, 1","corner-radius":"auto","bounds-expansion":0,"background-gradient-direction":"to-bottom","background-gradient-stop-colors":"#999","background-gradient-stop-positions":"0%",ghost:"no","ghost-offset-y":0,"ghost-offset-x":0,"ghost-opacity":0,padding:0,"padding-relative-to":"width",position:"origin","compound-sizing-wrt-labels":"include","min-width":0,"min-width-bias-left":0,"min-width-bias-right":0,"min-height":0,"min-height-bias-top":0,"min-height-bias-bottom":0},{"pie-size":"100%","pie-hole":0,"pie-start-angle":"0deg"},[{name:"pie-{{i}}-background-color",value:"black"},{name:"pie-{{i}}-background-size",value:"0%"},{name:"pie-{{i}}-background-opacity",value:1}].reduce(function(e,t){for(var i=1;i<=ks.pieBackgroundN;i++){var r=t.name.replace("{{i}}",i),n=t.value;e[r]=n}return e},{}),{"stripe-size":"100%","stripe-direction":"horizontal"},[{name:"stripe-{{i}}-background-color",value:"black"},{name:"stripe-{{i}}-background-size",value:"0%"},{name:"stripe-{{i}}-background-opacity",value:1}].reduce(function(e,t){for(var i=1;i<=ks.stripeBackgroundN;i++){var r=t.name.replace("{{i}}",i),n=t.value;e[r]=n}return e},{}),{"line-style":"solid","line-color":"#999","line-fill":"solid","line-cap":"butt","line-opacity":1,"line-outline-width":0,"line-outline-color":"#000","line-gradient-stop-colors":"#999","line-gradient-stop-positions":"0%","control-point-step-size":40,"control-point-weights":.5,"segment-weights":.5,"segment-distances":20,"segment-radii":15,"radius-type":"arc-radius","taxi-turn":"50%","taxi-radius":15,"taxi-turn-min-distance":10,"taxi-direction":"auto","edge-distances":"intersection","curve-style":"haystack","haystack-radius":0,"arrow-scale":1,"loop-direction":"-45deg","loop-sweep":"-90deg","source-distance-from-node":0,"target-distance-from-node":0,"source-endpoint":"outside-to-node","target-endpoint":"outside-to-node","line-dash-pattern":[6,3],"line-dash-offset":0},[{name:"arrow-shape",value:"none"},{name:"arrow-color",value:"#999"},{name:"arrow-fill",value:"filled"},{name:"arrow-width",value:1}].reduce(function(e,t){return ks.arrowPrefixes.forEach(function(i){var r=i+"-"+t.name,n=t.value;e[r]=n}),e},{})),i={},r=0;r<this.properties.length;r++){var n=this.properties[r];if(!n.pointsTo){var a=n.name,s=t[a],o=this.parse(a,s);i[a]=o}}return e.defaultProperties=i,e.defaultProperties},ks.addDefaultStylesheet=function(){this.selector(":parent").css({shape:"rectangle",padding:10,"background-color":"#eee","border-color":"#ccc","border-width":1}).selector("edge").css({width:3}).selector(":loop").css({"curve-style":"bezier"}).selector("edge:compound").css({"curve-style":"bezier","source-endpoint":"outside-to-line","target-endpoint":"outside-to-line"}).selector(":selected").css({"background-color":"#0169D9","line-color":"#0169D9","source-arrow-color":"#0169D9","target-arrow-color":"#0169D9","mid-source-arrow-color":"#0169D9","mid-target-arrow-color":"#0169D9"}).selector(":parent:selected").css({"background-color":"#CCE1F9","border-color":"#aec8e5"}).selector(":active").css({"overlay-color":"black","overlay-padding":10,"overlay-opacity":.25}),this.defaultLength=this.length};var ko={};ko.parse=function(e,t,i,r){if(vz(t))return this.parseImplWarn(e,t,i,r);var n,a=yS(e,""+t,i?"t":"f","mapping"===r||!0===r||!1===r||null==r?"dontcare":r),s=this.propCache=this.propCache||[];return(n=s[a])||(n=s[a]=this.parseImplWarn(e,t,i,r)),(i||"mapping"===r)&&(n=yz(n))&&(n.value=yz(n.value)),n},ko.parseImplWarn=function(e,t,i,r){var n=this.parseImpl(e,t,i,r);return n||null==t||yF("The style property `".concat(e,": ").concat(t,"` is invalid")),n&&("width"===n.name||"height"===n.name)&&"label"===t&&yF("The style value of `label` is deprecated for `"+n.name+"`"),n},ko.parseImpl=function(e,t,i,r){e=vQ(e);var n=this.properties[e],a=t,s=this.types;if(!n||void 0===t)return null;n.alias&&(e=(n=n.pointsTo).name);var o=vF(t);o&&(t=t.trim());var l=n.type;if(!l)return null;if(i&&(""===t||null===t))return{name:e,value:t,bypass:!0,deleteBypass:!0};if(vz(t))return{name:e,value:t,strValue:"fn",mapped:s.fn,bypass:i};if(!o||r||t.length<7||"a"!==t[1]);else if(t.length>=7&&"d"===t[0]&&(g=new RegExp(s.data.regex).exec(t))){if(i)return!1;var c=s.data;return{name:e,value:g,strValue:""+t,mapped:c,field:g[1],bypass:i}}else if(t.length>=10&&"m"===t[0]&&(v=new RegExp(s.mapData.regex).exec(t))){if(i||l.multiple)return!1;var u=s.mapData;if(!(l.color||l.number))return!1;var h=this.parse(e,v[4]);if(!h||h.mapped)return!1;var d=this.parse(e,v[5]);if(!d||d.mapped)return!1;if(h.pfValue===d.pfValue||h.strValue===d.strValue)return yF("`"+e+": "+t+"` is not a valid mapper because the output range is zero; converting to `"+e+": "+h.strValue+"`"),this.parse(e,h.strValue);if(l.color){var f=h.value,p=d.value;if(f[0]===p[0]&&f[1]===p[1]&&f[2]===p[2]&&(f[3]===p[3]||(null==f[3]||1===f[3])&&(null==p[3]||1===p[3])))return!1}return{name:e,value:v,strValue:""+t,mapped:u,field:v[1],fieldMin:parseFloat(v[2]),fieldMax:parseFloat(v[3]),valueMin:h.value,valueMax:d.value,bypass:i}}if(l.multiple&&"multiple"!==r){if(y=o?t.split(/\s+/):vV(t)?t:[t],l.evenMultiple&&y.length%2!=0)return null;for(var g,v,y,b=[],x=[],_=[],w="",k=!1,E=0;E<y.length;E++){var T=this.parse(e,y[E],i,"multiple");k=k||vF(T.value),b.push(T.value),_.push(null!=T.pfValue?T.pfValue:T.value),x.push(T.units),w+=(E>0?" ":"")+T.strValue}if(l.validate&&!l.validate(b,x))return null;if(l.singleEnum&&k)if(1===b.length&&vF(b[0]))return{name:e,value:b[0],strValue:b[0],bypass:i};else return null;return{name:e,value:b,pfValue:_,strValue:w,bypass:i,units:x}}var P=function(){for(var r=0;r<l.enums.length;r++)if(l.enums[r]===t)return{name:e,value:t,strValue:""+t,bypass:i};return null};if(l.number){var S,M,C="px";if(l.units&&(M=l.units),l.implicitUnits&&(C=l.implicitUnits),!l.unitless)if(o){var A="px|em"+(l.allowPercent?"|\\%":"");M&&(A=M);var I=t.match("^("+v4+")("+A+")?$");I&&(t=I[1],M=I[2]||C)}else(!M||l.implicitUnits)&&(M=C);if(isNaN(t=parseFloat(t))&&void 0===l.enums)return null;if(isNaN(t)&&void 0!==l.enums)return t=a,P();if(l.integer&&!(v$(S=t)&&Math.floor(S)===S)||void 0!==l.min&&(t<l.min||l.strictMin&&t===l.min)||void 0!==l.max&&(t>l.max||l.strictMax&&t===l.max))return null;var L={name:e,value:t,strValue:""+t+(M||""),units:M,bypass:i};return l.unitless||"px"!==M&&"em"!==M?L.pfValue=t:L.pfValue="px"!==M&&M?this.getEmSizeInPixels()*t:t,("ms"===M||"s"===M)&&(L.pfValue="ms"===M?t:1e3*t),("deg"===M||"rad"===M)&&(L.pfValue="rad"===M?t:Math.PI*t/180),"%"===M&&(L.pfValue=t/100),L}if(l.propList){var D=[],O=""+t;if("none"===O);else{for(var R=O.split(/\s*,\s*|\s+/),N=0;N<R.length;N++){var j=R[N].trim();this.properties[j]?D.push(j):yF("`"+j+"` is not a valid property name")}if(0===D.length)return null}return{name:e,value:D,strValue:0===D.length?"none":D.join(" "),bypass:i}}if(l.color){var B=yn(t);return B?{name:e,value:B,pfValue:B,strValue:"rgb("+B[0]+","+B[1]+","+B[2]+")",bypass:i}:null}if(l.regex||l.regexes){if(l.enums){var F=P();if(F)return F}for(var z=l.regexes?l.regexes:[l.regex],V=0;V<z.length;V++){var U=new RegExp(z[V]).exec(t);if(U)return{name:e,value:l.singleRegexMatchValue?U[1]:U,strValue:""+t,bypass:i}}return null}if(l.string)return{name:e,value:""+t,strValue:""+t,bypass:i};else if(l.enums)return P();else return null};var kl=function(e){return this instanceof kl?vY(e)?void(this._private={cy:e,coreStyle:{}},this.length=0,this.resetToDefault()):void yj("A style must have a core reference"):new kl(e)},kc=kl.prototype;kc.instanceString=function(){return"style"},kc.clear=function(){for(var e=this._private,t=e.cy.elements(),i=0;i<this.length;i++)this[i]=void 0;return this.length=0,e.contextStyles={},e.propDiffs={},this.cleanElements(t,!0),t.forEach(function(e){var t=e[0]._private;t.styleDirty=!0,t.appliedInitStyle=!1}),this},kc.resetToDefault=function(){return this.clear(),this.addDefaultStylesheet(),this},kc.core=function(e){return this._private.coreStyle[e]||this.getDefaultProperty(e)},kc.selector=function(e){var t="core"===e?null:new _N(e),i=this.length++;return this[i]={selector:t,properties:[],mappedProperties:[],index:i},this},kc.css=function(){var e=arguments;if(1===e.length)for(var t=e[0],i=0;i<this.properties.length;i++){var r=this.properties[i],n=t[r.name];void 0===n&&(n=t[v0(r.name)]),void 0!==n&&this.cssRule(r.name,n)}else 2===e.length&&this.cssRule(e[0],e[1]);return this},kc.style=kc.css,kc.cssRule=function(e,t){var i=this.parse(e,t);if(i){var r=this.length-1;this[r].properties.push(i),this[r].properties[i.name]=i,i.name.match(/pie-(\d+)-background-size/)&&i.value&&(this._private.hasPie=!0),i.name.match(/stripe-(\d+)-background-size/)&&i.value&&(this._private.hasStripe=!0),i.mapped&&this[r].mappedProperties.push(i),this[r].selector||(this._private.coreStyle[i.name]=i)}return this},kc.append=function(e){return vX(e)?e.appendToStyle(this):vV(e)?this.appendFromJson(e):vF(e)&&this.appendFromString(e),this},kl.fromJson=function(e,t){var i=new kl(e);return i.fromJson(t),i},kl.fromString=function(e,t){return new kl(e).fromString(t)},[ke,kt,ki,kr,kn,ka,ks,ko].forEach(function(e){ye(kc,e)}),kl.types=kc.types,kl.properties=kc.properties,kl.propertyGroups=kc.propertyGroups,kl.propertyGroupNames=kc.propertyGroupNames,kl.propertyGroupKeys=kc.propertyGroupKeys;var ku={autolock:function(e){return void 0===e?this._private.autolock:(this._private.autolock=!!e,this)},autoungrabify:function(e){return void 0===e?this._private.autoungrabify:(this._private.autoungrabify=!!e,this)},autounselectify:function(e){return void 0===e?this._private.autounselectify:(this._private.autounselectify=!!e,this)},selectionType:function(e){var t=this._private;return(null==t.selectionType&&(t.selectionType="single"),void 0===e)?t.selectionType:(("additive"===e||"single"===e)&&(t.selectionType=e),this)},panningEnabled:function(e){return void 0===e?this._private.panningEnabled:(this._private.panningEnabled=!!e,this)},userPanningEnabled:function(e){return void 0===e?this._private.userPanningEnabled:(this._private.userPanningEnabled=!!e,this)},zoomingEnabled:function(e){return void 0===e?this._private.zoomingEnabled:(this._private.zoomingEnabled=!!e,this)},userZoomingEnabled:function(e){return void 0===e?this._private.userZoomingEnabled:(this._private.userZoomingEnabled=!!e,this)},boxSelectionEnabled:function(e){return void 0===e?this._private.boxSelectionEnabled:(this._private.boxSelectionEnabled=!!e,this)},pan:function(){var e,t,i,r,n,a=arguments,s=this._private.pan;switch(a.length){case 0:return s;case 1:if(vF(a[0]))return s[e=a[0]];if(vU(a[0])){if(!this._private.panningEnabled)return this;r=(i=a[0]).x,n=i.y,v$(r)&&(s.x=r),v$(n)&&(s.y=n),this.emit("pan viewport")}break;case 2:if(!this._private.panningEnabled)return this;e=a[0],t=a[1],("x"===e||"y"===e)&&v$(t)&&(s[e]=t),this.emit("pan viewport")}return this.notify("viewport"),this},panBy:function(e,t){var i,r,n,a=arguments,s=this._private.pan;if(!this._private.panningEnabled)return this;switch(a.length){case 1:vU(e)&&(r=(i=a[0]).x,n=i.y,v$(r)&&(s.x+=r),v$(n)&&(s.y+=n),this.emit("pan viewport"));break;case 2:("x"===e||"y"===e)&&v$(t)&&(s[e]+=t),this.emit("pan viewport")}return this.notify("viewport"),this},gc:function(){this.notify("gc")},fit:function(e,t){var i=this.getFitViewport(e,t);if(i){var r=this._private;r.zoom=i.zoom,r.pan=i.pan,this.emit("pan zoom viewport"),this.notify("viewport")}return this},getFitViewport:function(e,t){if(v$(e)&&void 0===t&&(t=e,e=void 0),this._private.panningEnabled&&this._private.zoomingEnabled){if(vF(e)){var i,r,n,a=e;e=this.$(a)}else if(vU(i=e)&&v$(i.x1)&&v$(i.x2)&&v$(i.y1)&&v$(i.y2)){var s=e;(r={x1:s.x1,y1:s.y1,x2:s.x2,y2:s.y2}).w=r.x2-r.x1,r.h=r.y2-r.y1}else vH(e)||(e=this.mutableElements());if(!(vH(e)&&e.empty())){r=r||e.boundingBox();var o=this.width(),l=this.height();if(t=v$(t)?t:0,!isNaN(o)&&!isNaN(l)&&o>0&&l>0&&!isNaN(r.w)&&!isNaN(r.h)&&r.w>0&&r.h>0){n=(n=(n=Math.min((o-2*t)/r.w,(l-2*t)/r.h))>this._private.maxZoom?this._private.maxZoom:n)<this._private.minZoom?this._private.minZoom:n;var c={x:(o-n*(r.x1+r.x2))/2,y:(l-n*(r.y1+r.y2))/2};return{zoom:n,pan:c}}}}},zoomRange:function(e,t){var i=this._private;if(null==t){var r=e;e=r.min,t=r.max}return v$(e)&&v$(t)&&e<=t?(i.minZoom=e,i.maxZoom=t):v$(e)&&void 0===t&&e<=i.maxZoom?i.minZoom=e:v$(t)&&void 0===e&&t>=i.minZoom&&(i.maxZoom=t),this},minZoom:function(e){return void 0===e?this._private.minZoom:this.zoomRange({min:e})},maxZoom:function(e){return void 0===e?this._private.maxZoom:this.zoomRange({max:e})},getZoomedViewport:function(e){var t,i,r=this._private,n=r.pan,a=r.zoom,s=!1;if(r.zoomingEnabled||(s=!0),v$(e)?i=e:vU(e)&&(i=e.level,null!=e.position?t=br(e.position,a,n):null!=e.renderedPosition&&(t=e.renderedPosition),null==t||r.panningEnabled||(s=!0)),i=(i=i>r.maxZoom?r.maxZoom:i)<r.minZoom?r.minZoom:i,s||!v$(i)||i===a||null!=t&&(!v$(t.x)||!v$(t.y)))return null;if(null==t)return{zoomed:!0,panned:!1,zoom:i,pan:n};var o=i,l={x:-o/a*(t.x-n.x)+t.x,y:-o/a*(t.y-n.y)+t.y};return{zoomed:!0,panned:!0,zoom:o,pan:l}},zoom:function(e){if(void 0===e)return this._private.zoom;var t=this.getZoomedViewport(e),i=this._private;return null!=t&&t.zoomed&&(i.zoom=t.zoom,t.panned&&(i.pan.x=t.pan.x,i.pan.y=t.pan.y),this.emit("zoom"+(t.panned?" pan":"")+" viewport"),this.notify("viewport")),this},viewport:function(e){var t=this._private,i=!0,r=!0,n=[],a=!1;if(!e||(v$(e.zoom)||(i=!1),vU(e.pan)||(r=!1),!i&&!r))return this;if(i){var s=e.zoom;s<t.minZoom||s>t.maxZoom||!t.zoomingEnabled?a=!0:(t.zoom=s,n.push("zoom"))}if(r&&(!a||!e.cancelOnFailedZoom)&&t.panningEnabled){var o=e.pan;v$(o.x)&&(t.pan.x=o.x),v$(o.y)&&(t.pan.y=o.y),n.push("pan")}return n.length>0&&(n.push("viewport"),this.emit(n.join(" ")),this.notify("viewport")),this},center:function(e){var t=this.getCenterPan(e);return t&&(this._private.pan=t,this.emit("pan viewport"),this.notify("viewport")),this},getCenterPan:function(e,t){if(this._private.panningEnabled){if(vF(e)){var i=e;e=this.mutableElements().filter(i)}else vH(e)||(e=this.mutableElements());if(0!==e.length){var r=e.boundingBox(),n=this.width(),a=this.height();return{x:(n-(t=void 0===t?this._private.zoom:t)*(r.x1+r.x2))/2,y:(a-t*(r.y1+r.y2))/2}}}},reset:function(){return this._private.panningEnabled&&this._private.zoomingEnabled&&this.viewport({pan:{x:0,y:0},zoom:1}),this},invalidateSize:function(){this._private.sizeCache=null},size:function(){var e,t,i=this._private,r=i.container;return i.sizeCache=i.sizeCache||(r?(e=this.window().getComputedStyle(r),t=function(t){return parseFloat(e.getPropertyValue(t))},{width:r.clientWidth-t("padding-left")-t("padding-right"),height:r.clientHeight-t("padding-top")-t("padding-bottom")}):{width:1,height:1})},width:function(){return this.size().width},height:function(){return this.size().height},extent:function(){var e=this._private.pan,t=this._private.zoom,i=this.renderedExtent(),r={x1:(i.x1-e.x)/t,x2:(i.x2-e.x)/t,y1:(i.y1-e.y)/t,y2:(i.y2-e.y)/t};return r.w=r.x2-r.x1,r.h=r.y2-r.y1,r},renderedExtent:function(){var e=this.width(),t=this.height();return{x1:0,y1:0,x2:e,y2:t,w:e,h:t}},multiClickDebounceTime:function(e){return e?(this._private.multiClickDebounceTime=e,this):this._private.multiClickDebounceTime}};ku.centre=ku.center,ku.autolockNodes=ku.autolock,ku.autoungrabifyNodes=ku.autoungrabify;var kh={data:_y.data({field:"data",bindingEvent:"data",allowBinding:!0,allowSetting:!0,settingEvent:"data",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0,updateStyle:!0}),removeData:_y.removeData({field:"data",event:"data",triggerFnName:"trigger",triggerEvent:!0,updateStyle:!0}),scratch:_y.data({field:"scratch",bindingEvent:"scratch",allowBinding:!0,allowSetting:!0,settingEvent:"scratch",settingTriggersEvent:!0,triggerFnName:"trigger",allowGetting:!0,updateStyle:!0}),removeScratch:_y.removeData({field:"scratch",event:"scratch",triggerFnName:"trigger",triggerEvent:!0,updateStyle:!0})};kh.attr=kh.data,kh.removeAttr=kh.removeData;var kd=function(e){var t=this,i=(e=ye({},e)).container;i&&!vW(i)&&vW(i[0])&&(i=i[0]);var r=i?i._cyreg:null;(r=r||{}).cy&&(r.cy.destroy(),r={});var n=r.readies=r.readies||[];i&&(i._cyreg=r),r.cy=t;var a=void 0!==vL&&void 0!==i&&!e.headless,s=e;s.layout=ye({name:a?"grid":"null"},s.layout),s.renderer=ye({name:a?"canvas":"null"},s.renderer);var o=function(e,t,i){return void 0!==t?t:void 0!==i?i:e},l=this._private={container:i,ready:!1,options:s,elements:new wH(this),listeners:[],aniEles:new wH(this),data:s.data||{},scratch:{},layout:null,renderer:null,destroyed:!1,notificationsEnabled:!0,minZoom:1e-50,maxZoom:1e50,zoomingEnabled:o(!0,s.zoomingEnabled),userZoomingEnabled:o(!0,s.userZoomingEnabled),panningEnabled:o(!0,s.panningEnabled),userPanningEnabled:o(!0,s.userPanningEnabled),boxSelectionEnabled:o(!0,s.boxSelectionEnabled),autolock:o(!1,s.autolock,s.autolockNodes),autoungrabify:o(!1,s.autoungrabify,s.autoungrabifyNodes),autounselectify:o(!1,s.autounselectify),styleEnabled:void 0===s.styleEnabled?a:s.styleEnabled,zoom:v$(s.zoom)?s.zoom:1,pan:{x:vU(s.pan)&&v$(s.pan.x)?s.pan.x:0,y:vU(s.pan)&&v$(s.pan.y)?s.pan.y:0},animation:{current:[],queue:[]},hasCompoundNodes:!1,multiClickDebounceTime:o(250,s.multiClickDebounceTime)};this.createEmitter(),this.selectionType(s.selectionType),this.zoomRange({min:s.minZoom,max:s.maxZoom}),l.styleEnabled&&t.setStyle([]);var c=ye({},s,s.renderer);t.initRenderer(c);var u=function(e,i,r){t.notifications(!1);var n=t.mutableElements();n.length>0&&n.remove(),null!=e&&(vU(e)||vV(e))&&t.add(e),t.one("layoutready",function(e){t.notifications(!0),t.emit(e),t.one("load",i),t.emitAndNotify("load")}).one("layoutstop",function(){t.one("done",r),t.emit("done")});var a=ye({},t._private.options.layout);a.eles=t.elements(),t.layout(a).run()};!function(e,t){if(e.some(vZ))return _t.all(e).then(t);t(e)}([s.style,s.elements],function(e){var i=e[0],a=e[1];l.styleEnabled&&t.style().append(i),u(a,function(){t.startAnimationLoop(),l.ready=!0,vz(s.ready)&&t.on("ready",s.ready);for(var e=0;e<n.length;e++){var i=n[e];t.on("ready",i)}r&&(r.readies=[]),t.emit("ready")},s.done)})},kf=kd.prototype;ye(kf,{instanceString:function(){return"core"},isReady:function(){return this._private.ready},destroyed:function(){return this._private.destroyed},ready:function(e){return this.isReady()?this.emitter().emit("ready",[],e):this.on("ready",e),this},destroy:function(){if(!this.destroyed())return this.stopAnimationLoop(),this.destroyRenderer(),this.emit("destroy"),this._private.destroyed=!0,this},hasElementWithId:function(e){return this._private.elements.hasElementWithId(e)},getElementById:function(e){return this._private.elements.getElementById(e)},hasCompoundNodes:function(){return this._private.hasCompoundNodes},headless:function(){return this._private.renderer.isHeadless()},styleEnabled:function(){return this._private.styleEnabled},addToPool:function(e){return this._private.elements.merge(e),this},removeFromPool:function(e){return this._private.elements.unmerge(e),this},container:function(){return this._private.container||null},window:function(){if(null==this._private.container)return vL;var e=this._private.container.ownerDocument;return void 0===e||null==e?vL:e.defaultView||vL},mount:function(e){if(null!=e){var t=this._private,i=t.options;return!vW(e)&&vW(e[0])&&(e=e[0]),this.stopAnimationLoop(),this.destroyRenderer(),t.container=e,t.styleEnabled=!0,this.invalidateSize(),this.initRenderer(ye({},i,i.renderer,{name:"null"===i.renderer.name?"canvas":i.renderer.name})),this.startAnimationLoop(),this.style(i.style),this.emit("mount"),this}},unmount:function(){return this.stopAnimationLoop(),this.destroyRenderer(),this.initRenderer({name:"null"}),this.emit("unmount"),this},options:function(){return yz(this._private.options)},json:function(e){var t=this,i=t._private,r=t.mutableElements();if(vU(e)){if(t.startBatch(),e.elements){var n={},a=function(e,i){for(var r=[],a=[],s=0;s<e.length;s++){var o=e[s];if(!o.data.id){yF("cy.json() cannot handle elements without an ID attribute");continue}var l=""+o.data.id,c=t.getElementById(l);n[l]=!0,0!==c.length?a.push({ele:c,json:o}):(i&&(o.group=i),r.push(o))}t.add(r);for(var u=0;u<a.length;u++){var h=a[u],d=h.ele,f=h.json;d.json(f)}};if(vV(e.elements))a(e.elements);else for(var s=["nodes","edges"],o=0;o<s.length;o++){var l=s[o],c=e.elements[l];vV(c)&&a(c,l)}var u=t.collection();r.filter(function(e){return!n[e.id()]}).forEach(function(e){e.isParent()?u.merge(e):e.remove()}),u.forEach(function(e){return e.children().move({parent:null})}),u.forEach(function(e){return t.getElementById(e.id()).remove()})}e.style&&t.style(e.style),null!=e.zoom&&e.zoom!==i.zoom&&t.zoom(e.zoom),e.pan&&(e.pan.x!==i.pan.x||e.pan.y!==i.pan.y)&&t.pan(e.pan),e.data&&t.data(e.data);for(var h=["minZoom","maxZoom","zoomingEnabled","userZoomingEnabled","panningEnabled","userPanningEnabled","boxSelectionEnabled","autolock","autoungrabify","autounselectify","multiClickDebounceTime"],d=0;d<h.length;d++){var f=h[d];null!=e[f]&&t[f](e[f])}return t.endBatch(),this}var p={};e?p.elements=this.elements().map(function(e){return e.json()}):(p.elements={},r.forEach(function(e){var t=e.group();p.elements[t]||(p.elements[t]=[]),p.elements[t].push(e.json())})),this._private.styleEnabled&&(p.style=t.style().json()),p.data=yz(t.data());var g=i.options;return p.zoomingEnabled=i.zoomingEnabled,p.userZoomingEnabled=i.userZoomingEnabled,p.zoom=i.zoom,p.minZoom=i.minZoom,p.maxZoom=i.maxZoom,p.panningEnabled=i.panningEnabled,p.userPanningEnabled=i.userPanningEnabled,p.pan=yz(i.pan),p.boxSelectionEnabled=i.boxSelectionEnabled,p.renderer=yz(g.renderer),p.hideEdgesOnViewport=g.hideEdgesOnViewport,p.textureOnViewport=g.textureOnViewport,p.wheelSensitivity=g.wheelSensitivity,p.motionBlur=g.motionBlur,p.multiClickDebounceTime=g.multiClickDebounceTime,p}}),kf.$id=kf.getElementById,[{add:function(e){var t;if(vH(e))if(e._private.cy===this)t=e.restore();else{for(var i=[],r=0;r<e.length;r++){var n=e[r];i.push(n.json())}t=new wH(this,i)}else if(vV(e))t=new wH(this,e);else if(vU(e)&&(vV(e.nodes)||vV(e.edges))){for(var a=[],s=["nodes","edges"],o=0,l=s.length;o<l;o++){var c=s[o],u=e[c];if(vV(u))for(var h=0,d=u.length;h<d;h++){var f=ye({group:c},u[h]);a.push(f)}}t=new wH(this,a)}else t=new y0(this,e).collection();return t},remove:function(e){if(vH(e));else if(vF(e)){var t=e;e=this.$(t)}return e.remove()}},w1,w4,w5,w6,{notify:function(e,t){var i=this._private;if(this.batching()){i.batchNotifications=i.batchNotifications||{};var r=i.batchNotifications[e]=i.batchNotifications[e]||this.collection();null!=t&&r.merge(t);return}if(i.notificationsEnabled){var n=this.renderer();!this.destroyed()&&n&&n.notify(e,t)}},notifications:function(e){var t=this._private;return void 0===e?t.notificationsEnabled:(t.notificationsEnabled=!!e,this)},noNotifications:function(e){this.notifications(!1),e(),this.notifications(!0)},batching:function(){return this._private.batchCount>0},startBatch:function(){var e=this._private;return null==e.batchCount&&(e.batchCount=0),0===e.batchCount&&(e.batchStyleEles=this.collection(),e.batchNotifications={}),e.batchCount++,this},endBatch:function(){var e=this._private;if(0===e.batchCount)return this;if(e.batchCount--,0===e.batchCount){e.batchStyleEles.updateStyle();var t=this.renderer();Object.keys(e.batchNotifications).forEach(function(i){var r=e.batchNotifications[i];r.empty()?t.notify(i):t.notify(i,r)})}return this},batch:function(e){return this.startBatch(),e(),this.endBatch(),this},batchData:function(e){var t=this;return this.batch(function(){for(var i=Object.keys(e),r=0;r<i.length;r++){var n=i[r],a=e[n];t.getElementById(n).data(a)}})}},w9,w7,{style:function(e){return e&&this.setStyle(e).update(),this._private.style},setStyle:function(e){var t=this._private;return vX(e)?t.style=e.generateStyle(this):vV(e)?t.style=kl.fromJson(this,e):vF(e)?t.style=kl.fromString(this,e):t.style=kl(this),t.style},updateStyle:function(){this.mutableElements().updateStyle()}},ku,kh].forEach(function(e){ye(kf,e)});var kp={fit:!0,directed:!1,direction:"downward",padding:30,circle:!1,grid:!1,spacingFactor:1.75,boundingBox:void 0,avoidOverlap:!0,nodeDimensionsIncludeLabels:!1,roots:void 0,depthSort:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(e,t){return!0},ready:void 0,stop:void 0,transform:function(e,t){return t}},kg={maximal:!1,acyclic:!1},km=function(e){return e.scratch("breadthfirst")},kv=function(e,t){return e.scratch("breadthfirst",t)};function ky(e){this.options=ye({},kp,kg,e)}ky.prototype.run=function(){var e,t=this.options,i=t.cy,r=t.eles,n=r.nodes().filter(function(e){return e.isChildless()}),a=t.directed,s=t.acyclic||t.maximal||t.maximalAdjustments>0,o=!!t.boundingBox,l=bx(o?t.boundingBox:structuredClone(i.extent()));if(vH(t.roots))e=t.roots;else if(vV(t.roots)){for(var c=[],u=0;u<t.roots.length;u++){var h=t.roots[u],d=i.getElementById(h);c.push(d)}e=i.collection(c)}else if(vF(t.roots))e=i.$(t.roots);else if(a)e=n.roots();else{var f=r.components();e=i.collection();for(var p=0;p<f.length;p++)!function(){var t=f[p],i=t.maxDegree(!1),r=t.filter(function(e){return e.degree(!1)===i});e=e.add(r)}()}var g=[],v={},y=function(e,t){null==g[t]&&(g[t]=[]);var i=g[t].length;g[t].push(e),kv(e,{index:i,depth:t})},b=function(e,t){var i=km(e),r=i.depth,n=i.index;g[r][n]=null,e.isChildless()&&y(e,t)};r.bfs({roots:e,directed:t.directed,visit:function(e,t,i,r,n){var a=e[0],s=a.id();a.isChildless()&&y(a,n),v[s]=!0}});for(var x=[],_=0;_<n.length;_++){var w=n[_];v[w.id()]||x.push(w)}var k=function(e){for(var t=g[e],i=0;i<t.length;i++){var r=t[i];if(null==r){t.splice(i,1),i--;continue}kv(r,{depth:e,index:i})}};if(a&&s){var E=[],T={},P=function(e){return E.push(e)};for(n.forEach(function(e){return E.push(e)});E.length>0;){var S=E.shift(),M=function(e,i){for(var n=km(e),a=e.incomers().filter(function(e){return e.isNode()&&r.has(e)}),s=-1,o=e.id(),l=0;l<a.length;l++)s=Math.max(s,km(a[l]).depth);if(n.depth<=s){if(!t.acyclic&&i[o])return null;var c=s+1;return b(e,c),i[o]=c,!0}return!1}(S,T);if(M)S.outgoers().filter(function(e){return e.isNode()&&r.has(e)}).forEach(P);else if(null===M){yF("Detected double maximal shift for node `"+S.id()+"`.  Bailing maximal adjustment due to cycle.  Use `options.maximal: true` only on DAGs.");break}}}var C=0;if(t.avoidOverlap)for(var A=0;A<n.length;A++){var I=n[A].layoutDimensions(t),L=I.w,D=I.h;C=Math.max(C,L,D)}var O={},R=function(e){if(O[e.id()])return O[e.id()];for(var t=km(e).depth,i=e.neighborhood(),r=0,a=0,s=0;s<i.length;s++){var o=i[s];if(!(o.isEdge()||o.isParent())&&n.has(o)){var l=km(o);if(null!=l){var c=l.index,u=l.depth;if(null!=c&&null!=u){var h=g[u].length;u<t&&(r+=c/h,a++)}}}}return r/=a=Math.max(1,a),0===a&&(r=0),O[e.id()]=r,r},N=function(e,t){var i=R(e)-R(t);return 0===i?v7(e.id(),t.id()):i};void 0!==t.depthSort&&(N=t.depthSort);for(var j=g.length,B=0;B<j;B++)g[B].sort(N),k(B);for(var F=[],z=0;z<x.length;z++)F.push(x[z]);if(F.length){g.unshift(F),j=g.length;for(var V=0;V<j;V++)k(V)}for(var U=0,$=0;$<j;$++)U=Math.max(g[$].length,U);var W={x:l.x1+l.w/2,y:l.y1+l.h/2},H=n.reduce(function(e,i){var r;return r=i.boundingBox({includeLabels:t.nodeDimensionsIncludeLabels}),{w:-1===e.w?r.w:(e.w+r.w)/2,h:-1===e.h?r.h:(e.h+r.h)/2}},{w:-1,h:-1}),q=Math.max(1===j?0:o?(l.h-2*t.padding-H.h)/(j-1):(l.h-2*t.padding-H.h)/(j+1),C),G=g.reduce(function(e,t){return Math.max(e,t.length)},0),Y=function(e){var i=km(e),r=i.depth,n=i.index;if(t.circle){var a=Math.min(l.w/2/j,l.h/2/j),s=(a=Math.max(a,C))*r+a-(j>0&&g[0].length<=3?a/2:0),c=2*Math.PI/g[r].length*n;return 0===r&&1===g[0].length&&(s=1),{x:W.x+s*Math.cos(c),y:W.y+s*Math.sin(c)}}var u=g[r].length,h=Math.max(1===u?0:o?(l.w-2*t.padding-H.w)/((t.grid?G:u)-1):(l.w-2*t.padding-H.w)/((t.grid?G:u)+1),C);return{x:W.x+(n+1-(u+1)/2)*h,y:W.y+(r+1-(j+1)/2)*q}},X={downward:0,leftward:90,upward:180,rightward:-90};return -1===Object.keys(X).indexOf(t.direction)&&yj("Invalid direction '".concat(t.direction,"' specified for breadthfirst layout. Valid values are: ").concat(Object.keys(X).join(", "))),r.nodes().layoutPositions(this,t,function(e){return function(e,t,i){if(0===i)return e;var r,n,a,s,o=(t.x1+t.x2)/2,l=(t.y1+t.y2)/2,c=t.w/t.h,u=(r=e.x,n=e.y,{x:Math.cos(a=i*Math.PI/180)*(r-o)-Math.sin(a)*(n-l)+o,y:Math.sin(a)*(r-o)+Math.cos(a)*(n-l)+l}),h=(s=u.x,{x:(s-o)*c+o,y:(u.y-l)*(1/c)+l});return{x:h.x,y:h.y}}(Y(e),l,X[t.direction])}),this};var kb={fit:!0,padding:30,boundingBox:void 0,avoidOverlap:!0,nodeDimensionsIncludeLabels:!1,spacingFactor:void 0,radius:void 0,startAngle:1.5*Math.PI,sweep:void 0,clockwise:!0,sort:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(e,t){return!0},ready:void 0,stop:void 0,transform:function(e,t){return t}};function kx(e){this.options=ye({},kb,e)}kx.prototype.run=function(){var e,t=this.options,i=t.cy,r=t.eles,n=void 0!==t.counterclockwise?!t.counterclockwise:t.clockwise,a=r.nodes().not(":parent");t.sort&&(a=a.sort(t.sort));for(var s=bx(t.boundingBox?t.boundingBox:{x1:0,y1:0,w:i.width(),h:i.height()}),o={x:s.x1+s.w/2,y:s.y1+s.h/2},l=(void 0===t.sweep?2*Math.PI-2*Math.PI/a.length:t.sweep)/Math.max(1,a.length-1),c=0,u=0;u<a.length;u++){var h=a[u].layoutDimensions(t);c=Math.max(c,h.w,h.h)}if(e=v$(t.radius)?t.radius:a.length<=1?0:Math.min(s.h,s.w)/2-c,a.length>1&&t.avoidOverlap){var d=Math.cos(l)-1,f=Math.sin(l)-0;e=Math.max(Math.sqrt((c*=1.75)*c/(d*d+f*f)),e)}return r.nodes().layoutPositions(this,t,function(i,r){var a=t.startAngle+r*l*(n?1:-1),s=e*Math.cos(a),c=e*Math.sin(a);return{x:o.x+s,y:o.y+c}}),this};var k_={fit:!0,padding:30,startAngle:1.5*Math.PI,sweep:void 0,clockwise:!0,equidistant:!1,minNodeSpacing:10,boundingBox:void 0,avoidOverlap:!0,nodeDimensionsIncludeLabels:!1,height:void 0,width:void 0,spacingFactor:void 0,concentric:function(e){return e.degree()},levelWidth:function(e){return e.maxDegree()/4},animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(e,t){return!0},ready:void 0,stop:void 0,transform:function(e,t){return t}};function kw(e){this.options=ye({},k_,e)}kw.prototype.run=function(){for(var e=this.options,t=void 0!==e.counterclockwise?!e.counterclockwise:e.clockwise,i=e.cy,r=e.eles,n=r.nodes().not(":parent"),a=bx(e.boundingBox?e.boundingBox:{x1:0,y1:0,w:i.width(),h:i.height()}),s={x:a.x1+a.w/2,y:a.y1+a.h/2},o=[],l=0,c=0;c<n.length;c++){var u=n[c],h=void 0;h=e.concentric(u),o.push({value:h,node:u}),u._private.scratch.concentric=h}n.updateStyle();for(var d=0;d<n.length;d++){var f=n[d].layoutDimensions(e);l=Math.max(l,f.w,f.h)}o.sort(function(e,t){return t.value-e.value});for(var p=e.levelWidth(n),g=[[]],v=g[0],y=0;y<o.length;y++){var b=o[y];v.length>0&&Math.abs(v[0].value-b.value)>=p&&(v=[],g.push(v)),v.push(b)}var x=l+e.minNodeSpacing;if(!e.avoidOverlap){var _=g.length>0&&g[0].length>1,w=(Math.min(a.w,a.h)/2-x)/(g.length+_?1:0);x=Math.min(x,w)}for(var k=0,E=0;E<g.length;E++){var T=g[E],P=void 0===e.sweep?2*Math.PI-2*Math.PI/T.length:e.sweep,S=T.dTheta=P/Math.max(1,T.length-1);if(T.length>1&&e.avoidOverlap){var M=Math.cos(S)-1,C=Math.sin(S)-0;k=Math.max(Math.sqrt(x*x/(M*M+C*C)),k)}T.r=k,k+=x}if(e.equidistant){for(var A=0,I=0,L=0;L<g.length;L++)A=Math.max(A,g[L].r-I);I=0;for(var D=0;D<g.length;D++){var O=g[D];0===D&&(I=O.r),O.r=I,I+=A}}for(var R={},N=0;N<g.length;N++)for(var j=g[N],B=j.dTheta,F=j.r,z=0;z<j.length;z++){var V=j[z],U=e.startAngle+(t?1:-1)*B*z,$={x:s.x+F*Math.cos(U),y:s.y+F*Math.sin(U)};R[V.node.id()]=$}return r.nodes().layoutPositions(this,e,function(e){return R[e.id()]}),this};var kk={ready:function(){},stop:function(){},animate:!0,animationEasing:void 0,animationDuration:void 0,animateFilter:function(e,t){return!0},animationThreshold:250,refresh:20,fit:!0,padding:30,boundingBox:void 0,nodeDimensionsIncludeLabels:!1,randomize:!1,componentSpacing:40,nodeRepulsion:function(e){return 2048},nodeOverlap:4,idealEdgeLength:function(e){return 32},edgeElasticity:function(e){return 32},nestingFactor:1.2,gravity:1,numIter:1e3,initialTemp:1e3,coolingFactor:.99,minTemp:1};function kE(e){this.options=ye({},kk,e),this.options.layout=this;var t=this.options.eles.nodes(),i=this.options.eles.edges().filter(function(e){var i=e.source().data("id"),r=e.target().data("id"),n=t.some(function(e){return e.data("id")===i}),a=t.some(function(e){return e.data("id")===r});return!n||!a});this.options.eles=this.options.eles.not(i)}kE.prototype.run=function(){var e=this.options,t=e.cy,i=this;i.stopped=!1,(!0===e.animate||!1===e.animate)&&i.emit({type:"layoutstart",layout:i}),PI=!0===e.debug;var r=kT(t,i,e);PI&&PL(r),e.randomize&&kM(r);var n=yv(),a=function(){kA(r,t,e),!0===e.fit&&t.fit(e.padding)},s=function(t){return!i.stopped&&!(t>=e.numIter)&&(kI(r,e),r.temperature=r.temperature*e.coolingFactor,!(r.temperature<e.minTemp))},o=function(){if(!0===e.animate||!1===e.animate)a(),i.one("layoutstop",e.stop),i.emit({type:"layoutstop",layout:i});else{var t=e.eles.nodes(),n=kC(r,e,t);t.layoutPositions(i,e,n)}},l=0,c=!0;if(!0===e.animate){var u=function(){for(var t=0;c&&t<e.refresh;)c=s(l),l++,t++;c?(yv()-n>=e.animationThreshold&&a(),yb(u)):(k$(r,e),o())};u()}else{for(;c;)c=s(l),l++;k$(r,e),o()}return this},kE.prototype.stop=function(){return this.stopped=!0,this.thread&&this.thread.stop(),this.emit("layoutstop"),this},kE.prototype.destroy=function(){return this.thread&&this.thread.stop(),this};var kT=function(e,t,i){for(var r=i.eles.edges(),n=i.eles.nodes(),a=bx(i.boundingBox?i.boundingBox:{x1:0,y1:0,w:e.width(),h:e.height()}),s={isCompound:e.hasCompoundNodes(),layoutNodes:[],idToIndex:{},nodeSize:n.size(),graphSet:[],indexToGraph:[],layoutEdges:[],edgeSize:r.size(),temperature:i.initialTemp,clientWidth:a.w,clientHeight:a.h,boundingBox:a},o=i.eles.components(),l={},c=0;c<o.length;c++)for(var u=o[c],h=0;h<u.length;h++){var d=u[h];l[d.id()]=c}for(var c=0;c<s.nodeSize;c++){var f=n[c],p=f.layoutDimensions(i),g={};g.isLocked=f.locked(),g.id=f.data("id"),g.parentId=f.data("parent"),g.cmptId=l[f.id()],g.children=[],g.positionX=f.position("x"),g.positionY=f.position("y"),g.offsetX=0,g.offsetY=0,g.height=p.w,g.width=p.h,g.maxX=g.positionX+g.width/2,g.minX=g.positionX-g.width/2,g.maxY=g.positionY+g.height/2,g.minY=g.positionY-g.height/2,g.padLeft=parseFloat(f.style("padding")),g.padRight=parseFloat(f.style("padding")),g.padTop=parseFloat(f.style("padding")),g.padBottom=parseFloat(f.style("padding")),g.nodeRepulsion=vz(i.nodeRepulsion)?i.nodeRepulsion(f):i.nodeRepulsion,s.layoutNodes.push(g),s.idToIndex[g.id]=c}for(var v=[],y=0,b=-1,x=[],c=0;c<s.nodeSize;c++){var f=s.layoutNodes[c],_=f.parentId;null!=_?s.layoutNodes[s.idToIndex[_]].children.push(f.id):(v[++b]=f.id,x.push(f.id))}for(s.graphSet.push(x);y<=b;){var w=v[y++],k=s.idToIndex[w],d=s.layoutNodes[k],E=d.children;if(E.length>0){s.graphSet.push(E);for(var c=0;c<E.length;c++)v[++b]=E[c]}}for(var c=0;c<s.graphSet.length;c++)for(var T=s.graphSet[c],h=0;h<T.length;h++){var P=s.idToIndex[T[h]];s.indexToGraph[P]=c}for(var c=0;c<s.edgeSize;c++){var S=r[c],M={};M.id=S.data("id"),M.sourceId=S.data("source"),M.targetId=S.data("target");var C=vz(i.idealEdgeLength)?i.idealEdgeLength(S):i.idealEdgeLength,A=vz(i.edgeElasticity)?i.edgeElasticity(S):i.edgeElasticity,I=s.idToIndex[M.sourceId],L=s.idToIndex[M.targetId];if(s.indexToGraph[I]!=s.indexToGraph[L]){for(var D=kP(M.sourceId,M.targetId,s),O=s.graphSet[D],R=0,g=s.layoutNodes[I];-1===O.indexOf(g.id);)g=s.layoutNodes[s.idToIndex[g.parentId]],R++;for(g=s.layoutNodes[L];-1===O.indexOf(g.id);)g=s.layoutNodes[s.idToIndex[g.parentId]],R++;C*=R*i.nestingFactor}M.idealLength=C,M.elasticity=A,s.layoutEdges.push(M)}return s},kP=function(e,t,i){var r=kS(e,t,0,i);return 2>r.count?0:r.graph},kS=function(e,t,i,r){var n=r.graphSet[i];if(-1<n.indexOf(e)&&-1<n.indexOf(t))return{count:2,graph:i};for(var a=0,s=0;s<n.length;s++){var o=n[s],l=r.idToIndex[o],c=r.layoutNodes[l].children;if(0!==c.length){var u=kS(e,t,r.indexToGraph[r.idToIndex[c[0]]],r);if(0===u.count)continue;if(1!==u.count)return u;if(2==++a)break}}return{count:a,graph:i}},kM=function(e,t){for(var i=e.clientWidth,r=e.clientHeight,n=0;n<e.nodeSize;n++){var a=e.layoutNodes[n];0!==a.children.length||a.isLocked||(a.positionX=Math.random()*i,a.positionY=Math.random()*r)}},kC=function(e,t,i){var r=e.boundingBox,n={x1:1/0,x2:-1/0,y1:1/0,y2:-1/0};return t.boundingBox&&(i.forEach(function(t){var i=e.layoutNodes[e.idToIndex[t.data("id")]];n.x1=Math.min(n.x1,i.positionX),n.x2=Math.max(n.x2,i.positionX),n.y1=Math.min(n.y1,i.positionY),n.y2=Math.max(n.y2,i.positionY)}),n.w=n.x2-n.x1,n.h=n.y2-n.y1),function(i,a){var s=e.layoutNodes[e.idToIndex[i.data("id")]];if(!t.boundingBox)return{x:s.positionX,y:s.positionY};var o=0===n.w?.5:(s.positionX-n.x1)/n.w,l=0===n.h?.5:(s.positionY-n.y1)/n.h;return{x:r.x1+o*r.w,y:r.y1+l*r.h}}},kA=function(e,t,i){var r=i.layout,n=i.eles.nodes(),a=kC(e,i,n);n.positions(a),!0!==e.ready&&(e.ready=!0,r.one("layoutready",i.ready),r.emit({type:"layoutready",layout:this}))},kI=function(e,t,i){kL(e,t),kj(e),kB(e,t),kF(e),kz(e)},kL=function(e,t){for(var i=0;i<e.graphSet.length;i++)for(var r=e.graphSet[i],n=r.length,a=0;a<n;a++)for(var s=e.layoutNodes[e.idToIndex[r[a]]],o=a+1;o<n;o++)kO(s,e.layoutNodes[e.idToIndex[r[o]]],e,t)},kD=function(e){return -1+2*e*Math.random()},kO=function(e,t,i,r){if(e.cmptId===t.cmptId||i.isCompound){var n=t.positionX-e.positionX,a=t.positionY-e.positionY;0===n&&0===a&&(n=kD(1),a=kD(1));var s=kR(e,t,n,a);if(s>0)var o=r.nodeOverlap*s,l=Math.sqrt(n*n+a*a),c=o*n/l,u=o*a/l;else var h=kN(e,n,a),d=kN(t,-1*n,-1*a),f=d.x-h.x,p=d.y-h.y,g=f*f+p*p,l=Math.sqrt(g),o=(e.nodeRepulsion+t.nodeRepulsion)/g,c=o*f/l,u=o*p/l;e.isLocked||(e.offsetX-=c,e.offsetY-=u),t.isLocked||(t.offsetX+=c,t.offsetY+=u)}},kR=function(e,t,i,r){if(i>0)var n=e.maxX-t.minX;else var n=t.maxX-e.minX;if(r>0)var a=e.maxY-t.minY;else var a=t.maxY-e.minY;return n>=0&&a>=0?Math.sqrt(n*n+a*a):0},kN=function(e,t,i){var r=e.positionX,n=e.positionY,a=e.height||1,s=e.width||1,o=i/t,l=a/s,c={};return 0===t&&0<i||0===t&&0>i?(c.x=r,c.y=n+a/2):0<t&&-1*l<=o&&o<=l?(c.x=r+s/2,c.y=n+s*i/2/t):0>t&&-1*l<=o&&o<=l?(c.x=r-s/2,c.y=n-s*i/2/t):0<i&&(o<=-1*l||o>=l)?(c.x=r+a*t/2/i,c.y=n+a/2):0>i&&(o<=-1*l||o>=l)&&(c.x=r-a*t/2/i,c.y=n-a/2),c},kj=function(e,t){for(var i=0;i<e.edgeSize;i++){var r=e.layoutEdges[i],n=e.idToIndex[r.sourceId],a=e.layoutNodes[n],s=e.idToIndex[r.targetId],o=e.layoutNodes[s],l=o.positionX-a.positionX,c=o.positionY-a.positionY;if(0!==l||0!==c){var u=kN(a,l,c),h=kN(o,-1*l,-1*c),d=h.x-u.x,f=h.y-u.y,p=Math.sqrt(d*d+f*f),g=Math.pow(r.idealLength-p,2)/r.elasticity;if(0!==p)var v=g*d/p,y=g*f/p;else var v=0,y=0;a.isLocked||(a.offsetX+=v,a.offsetY+=y),o.isLocked||(o.offsetX-=v,o.offsetY-=y)}}},kB=function(e,t){if(0!==t.gravity)for(var i=0;i<e.graphSet.length;i++){var r=e.graphSet[i],n=r.length;if(0===i)var a=e.clientHeight/2,s=e.clientWidth/2;else var o=e.layoutNodes[e.idToIndex[r[0]]],l=e.layoutNodes[e.idToIndex[o.parentId]],a=l.positionX,s=l.positionY;for(var c=0;c<n;c++){var u=e.layoutNodes[e.idToIndex[r[c]]];if(!u.isLocked){var h=a-u.positionX,d=s-u.positionY,f=Math.sqrt(h*h+d*d);if(f>1){var p=t.gravity*h/f,g=t.gravity*d/f;u.offsetX+=p,u.offsetY+=g}}}}},kF=function(e,t){var i=[],r=0,n=-1;for(i.push.apply(i,e.graphSet[0]),n+=e.graphSet[0].length;r<=n;){var a=i[r++],s=e.idToIndex[a],o=e.layoutNodes[s],l=o.children;if(0<l.length&&!o.isLocked){for(var c=o.offsetX,u=o.offsetY,h=0;h<l.length;h++){var d=e.layoutNodes[e.idToIndex[l[h]]];d.offsetX+=c,d.offsetY+=u,i[++n]=l[h]}o.offsetX=0,o.offsetY=0}}},kz=function(e,t){for(var i=0;i<e.nodeSize;i++){var r=e.layoutNodes[i];0<r.children.length&&(r.maxX=void 0,r.minX=void 0,r.maxY=void 0,r.minY=void 0)}for(var i=0;i<e.nodeSize;i++){var r=e.layoutNodes[i];if(!(0<r.children.length)&&!r.isLocked){var n=kV(r.offsetX,r.offsetY,e.temperature);r.positionX+=n.x,r.positionY+=n.y,r.offsetX=0,r.offsetY=0,r.minX=r.positionX-r.width,r.maxX=r.positionX+r.width,r.minY=r.positionY-r.height,r.maxY=r.positionY+r.height,kU(r,e)}}for(var i=0;i<e.nodeSize;i++){var r=e.layoutNodes[i];0<r.children.length&&!r.isLocked&&(r.positionX=(r.maxX+r.minX)/2,r.positionY=(r.maxY+r.minY)/2,r.width=r.maxX-r.minX,r.height=r.maxY-r.minY)}},kV=function(e,t,i){var r=Math.sqrt(e*e+t*t);if(r>i)var n={x:i*e/r,y:i*t/r};else var n={x:e,y:t};return n},kU=function(e,t){var i=e.parentId;if(null!=i){var r=t.layoutNodes[t.idToIndex[i]],n=!1;if((null==r.maxX||e.maxX+r.padRight>r.maxX)&&(r.maxX=e.maxX+r.padRight,n=!0),(null==r.minX||e.minX-r.padLeft<r.minX)&&(r.minX=e.minX-r.padLeft,n=!0),(null==r.maxY||e.maxY+r.padBottom>r.maxY)&&(r.maxY=e.maxY+r.padBottom,n=!0),(null==r.minY||e.minY-r.padTop<r.minY)&&(r.minY=e.minY-r.padTop,n=!0),n)return kU(r,t)}},k$=function(e,t){for(var i=e.layoutNodes,r=[],n=0;n<i.length;n++){var a=i[n],s=a.cmptId;(r[s]=r[s]||[]).push(a)}for(var o=0,n=0;n<r.length;n++){var l=r[n];if(l){l.x1=1/0,l.x2=-1/0,l.y1=1/0,l.y2=-1/0;for(var c=0;c<l.length;c++){var u=l[c];l.x1=Math.min(l.x1,u.positionX-u.width/2),l.x2=Math.max(l.x2,u.positionX+u.width/2),l.y1=Math.min(l.y1,u.positionY-u.height/2),l.y2=Math.max(l.y2,u.positionY+u.height/2)}l.w=l.x2-l.x1,l.h=l.y2-l.y1,o+=l.w*l.h}}r.sort(function(e,t){return t.w*t.h-e.w*e.h});for(var h=0,d=0,f=0,p=0,g=Math.sqrt(o)*e.clientWidth/e.clientHeight,n=0;n<r.length;n++){var l=r[n];if(l){for(var c=0;c<l.length;c++){var u=l[c];u.isLocked||(u.positionX+=h-l.x1,u.positionY+=d-l.y1)}h+=l.w+t.componentSpacing,f+=l.w+t.componentSpacing,p=Math.max(p,l.h),f>g&&(d+=p+t.componentSpacing,h=0,f=0,p=0)}}},kW={fit:!0,padding:30,boundingBox:void 0,avoidOverlap:!0,avoidOverlapPadding:10,nodeDimensionsIncludeLabels:!1,spacingFactor:void 0,condense:!1,rows:void 0,cols:void 0,position:function(e){},sort:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(e,t){return!0},ready:void 0,stop:void 0,transform:function(e,t){return t}};function kH(e){this.options=ye({},kW,e)}kH.prototype.run=function(){var e=this.options,t=e.cy,i=e.eles,r=i.nodes().not(":parent");e.sort&&(r=r.sort(e.sort));var n=bx(e.boundingBox?e.boundingBox:{x1:0,y1:0,w:t.width(),h:t.height()});if(0===n.h||0===n.w)i.nodes().layoutPositions(this,e,function(e){return{x:n.x1,y:n.y1}});else{var a=r.size(),s=Math.sqrt(a*n.h/n.w),o=Math.round(s),l=Math.round(n.w/n.h*s),c=function(e){if(null==e)return Math.min(o,l);Math.min(o,l)==o?o=e:l=e},u=function(e){if(null==e)return Math.max(o,l);Math.max(o,l)==o?o=e:l=e},h=e.rows,d=null!=e.cols?e.cols:e.columns;if(null!=h&&null!=d)o=h,l=d;else if(null!=h&&null==d)l=Math.ceil(a/(o=h));else if(null==h&&null!=d)o=Math.ceil(a/(l=d));else if(l*o>a){var f=c(),p=u();(f-1)*p>=a?c(f-1):(p-1)*f>=a&&u(p-1)}else for(;l*o<a;){var g=c(),v=u();(v+1)*g>=a?u(v+1):c(g+1)}var y=n.w/l,b=n.h/o;if(e.condense&&(y=0,b=0),e.avoidOverlap)for(var x=0;x<r.length;x++){var _=r[x],w=_._private.position;(null==w.x||null==w.y)&&(w.x=0,w.y=0);var k=_.layoutDimensions(e),E=e.avoidOverlapPadding,T=k.w+E,P=k.h+E;y=Math.max(y,T),b=Math.max(b,P)}for(var S={},M=function(e,t){return!!S["c-"+e+"-"+t]},C=function(e,t){S["c-"+e+"-"+t]=!0},A=0,I=0,L=function(){++I>=l&&(I=0,A++)},D={},O=0;O<r.length;O++){var R=r[O],N=e.position(R);if(N&&(void 0!==N.row||void 0!==N.col)){var j={row:N.row,col:N.col};if(void 0===j.col)for(j.col=0;M(j.row,j.col);)j.col++;else if(void 0===j.row)for(j.row=0;M(j.row,j.col);)j.row++;D[R.id()]=j,C(j.row,j.col)}}r.layoutPositions(this,e,function(e,t){if(e.locked()||e.isParent())return!1;var i,r,a=D[e.id()];if(a)i=a.col*y+y/2+n.x1,r=a.row*b+b/2+n.y1;else{for(;M(A,I);)L();i=I*y+y/2+n.x1,r=A*b+b/2+n.y1,C(A,I),L()}return{x:i,y:r}})}return this};var kq={ready:function(){},stop:function(){}};function kG(e){this.options=ye({},kq,e)}kG.prototype.run=function(){var e=this.options,t=e.eles;return e.cy,this.emit("layoutstart"),t.nodes().positions(function(){return{x:0,y:0}}),this.one("layoutready",e.ready),this.emit("layoutready"),this.one("layoutstop",e.stop),this.emit("layoutstop"),this},kG.prototype.stop=function(){return this};var kY={positions:void 0,zoom:void 0,pan:void 0,fit:!0,padding:30,spacingFactor:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(e,t){return!0},ready:void 0,stop:void 0,transform:function(e,t){return t}};function kX(e){this.options=ye({},kY,e)}kX.prototype.run=function(){var e=this.options,t=e.eles.nodes(),i=vz(e.positions);return t.layoutPositions(this,e,function(t,r){var n=function(t){if(null==e.positions){var r;return{x:(r=t.position()).x,y:r.y}}if(i)return e.positions(t);var n=e.positions[t._private.data.id];return null==n?null:n}(t);return!t.locked()&&null!=n&&n}),this};var kK={fit:!0,padding:30,boundingBox:void 0,animate:!1,animationDuration:500,animationEasing:void 0,animateFilter:function(e,t){return!0},ready:void 0,stop:void 0,transform:function(e,t){return t}};function kZ(e){this.options=ye({},kK,e)}kZ.prototype.run=function(){var e=this.options,t=e.cy,i=e.eles,r=bx(e.boundingBox?e.boundingBox:{x1:0,y1:0,w:t.width(),h:t.height()});return i.nodes().layoutPositions(this,e,function(e,t){return{x:r.x1+Math.round(Math.random()*r.w),y:r.y1+Math.round(Math.random()*r.h)}}),this};var kJ=[{name:"breadthfirst",impl:ky},{name:"circle",impl:kx},{name:"concentric",impl:kw},{name:"cose",impl:kE},{name:"grid",impl:kH},{name:"null",impl:kG},{name:"preset",impl:kX},{name:"random",impl:kZ}];function kQ(e){this.options=e,this.notifications=0}var k0=function(){},k1=function(){throw Error("A headless instance can not render images")};kQ.prototype={recalculateRenderedStyle:k0,notify:function(){this.notifications++},init:k0,isHeadless:function(){return!0},png:k1,jpg:k1};var k2={};k2.arrowShapeWidth=.3,k2.registerArrowShapes=function(){var e=this.arrowShapes={},t=this,i=function(e,t,i,r,n,a,s){var o=n.x-i/2-s,l=n.x+i/2+s,c=n.y-i/2-s,u=n.y+i/2+s;return o<=e&&e<=l&&c<=t&&t<=u},r=function(e,t,i,r,n){var a=e*Math.cos(r)-t*Math.sin(r),s=e*Math.sin(r)+t*Math.cos(r);return{x:a*i+n.x,y:s*i+n.y}},n=function(e,t,i,n){for(var a=[],s=0;s<e.length;s+=2){var o=e[s],l=e[s+1];a.push(r(o,l,t,i,n))}return a},a=function(e){for(var t=[],i=0;i<e.length;i++){var r=e[i];t.push(r.x,r.y)}return t},s=function(e){return e.pstyle("width").pfValue*e.pstyle("arrow-scale").pfValue*2},o=function(r,o){vF(o)&&(o=e[o]),e[r]=ye({name:r,points:[-.15,-.3,.15,-.3,.15,.3,-.15,.3],collide:function(e,t,i,r,s,o){return bF(e,t,a(n(this.points,i+2*o,r,s)))},roughCollide:i,draw:function(e,i,r,a){var s=n(this.points,i,r,a);t.arrowShapeImpl("polygon")(e,s)},spacing:function(e){return 0},gap:s},o)};o("none",{collide:yO,roughCollide:yO,draw:yN,spacing:yR,gap:yR}),o("triangle",{points:[-.15,-.3,0,0,.15,-.3]}),o("arrow","triangle"),o("triangle-backcurve",{points:e.triangle.points,controlPoint:[0,-.15],roughCollide:i,draw:function(e,i,a,s,o){var l=n(this.points,i,a,s),c=this.controlPoint,u=r(c[0],c[1],i,a,s);t.arrowShapeImpl(this.name)(e,l,u)},gap:function(e){return .8*s(e)}}),o("triangle-tee",{points:[0,0,.15,-.3,-.15,-.3,0,0],pointsTee:[-.15,-.4,-.15,-.5,.15,-.5,.15,-.4],collide:function(e,t,i,r,s,o,l){var c=a(n(this.points,i+2*l,r,s)),u=a(n(this.pointsTee,i+2*l,r,s));return bF(e,t,c)||bF(e,t,u)},draw:function(e,i,r,a,s){var o=n(this.points,i,r,a),l=n(this.pointsTee,i,r,a);t.arrowShapeImpl(this.name)(e,o,l)}}),o("circle-triangle",{radius:.15,pointsTr:[0,-.15,.15,-.45,-.15,-.45,0,-.15],collide:function(e,t,i,r,s,o,l){var c=Math.pow(s.x-e,2)+Math.pow(s.y-t,2)<=Math.pow((i+2*l)*this.radius,2);return bF(e,t,a(n(this.points,i+2*l,r,s)))||c},draw:function(e,i,r,a,s){var o=n(this.pointsTr,i,r,a);t.arrowShapeImpl(this.name)(e,o,a.x,a.y,this.radius*i)},spacing:function(e){return t.getArrowWidth(e.pstyle("width").pfValue,e.pstyle("arrow-scale").value)*this.radius}}),o("triangle-cross",{points:[0,0,.15,-.3,-.15,-.3,0,0],baseCrossLinePts:[-.15,-.4,-.15,-.4,.15,-.4,.15,-.4],crossLinePts:function(e,t){var i=this.baseCrossLinePts.slice(),r=t/e;return i[3]=i[3]-r,i[5]=i[5]-r,i},collide:function(e,t,i,r,s,o,l){var c=a(n(this.points,i+2*l,r,s)),u=a(n(this.crossLinePts(i,o),i+2*l,r,s));return bF(e,t,c)||bF(e,t,u)},draw:function(e,i,r,a,s){var o=n(this.points,i,r,a),l=n(this.crossLinePts(i,s),i,r,a);t.arrowShapeImpl(this.name)(e,o,l)}}),o("vee",{points:[-.15,-.3,0,0,.15,-.3,0,-.15],gap:function(e){return .525*s(e)}}),o("circle",{radius:.15,collide:function(e,t,i,r,n,a,s){return Math.pow(n.x-e,2)+Math.pow(n.y-t,2)<=Math.pow((i+2*s)*this.radius,2)},draw:function(e,i,r,n,a){t.arrowShapeImpl(this.name)(e,n.x,n.y,this.radius*i)},spacing:function(e){return t.getArrowWidth(e.pstyle("width").pfValue,e.pstyle("arrow-scale").value)*this.radius}}),o("tee",{points:[-.15,0,-.15,-.1,.15,-.1,.15,0],spacing:function(e){return 1},gap:function(e){return 1}}),o("square",{points:[-.15,0,.15,0,.15,-.3,-.15,-.3]}),o("diamond",{points:[-.15,-.15,0,-.3,.15,-.15,0,0],gap:function(e){return e.pstyle("width").pfValue*e.pstyle("arrow-scale").value}}),o("chevron",{points:[0,0,-.15,-.15,-.1,-.2,0,-.1,.1,-.2,.15,-.15],gap:function(e){return .95*e.pstyle("width").pfValue*e.pstyle("arrow-scale").value}})};var k3={};k3.projectIntoViewport=function(e,t){var i=this.cy,r=this.findContainerClientCoords(),n=r[0],a=r[1],s=r[4],o=i.pan(),l=i.zoom();return[((e-n)/s-o.x)/l,((t-a)/s-o.y)/l]},k3.findContainerClientCoords=function(){if(this.containerBB)return this.containerBB;var e=this.container,t=e.getBoundingClientRect(),i=this.cy.window().getComputedStyle(e),r=function(e){return parseFloat(i.getPropertyValue(e))},n={left:r("padding-left"),right:r("padding-right"),top:r("padding-top"),bottom:r("padding-bottom")},a={left:r("border-left-width"),right:r("border-right-width"),top:r("border-top-width"),bottom:r("border-bottom-width")},s=e.clientWidth,o=e.clientHeight,l=n.left+n.right,c=n.top+n.bottom,u=a.left+a.right,h=t.width/(s+u),d=t.left+n.left+a.left,f=t.top+n.top+a.top;return this.containerBB=[d,f,s-l,o-c,h]},k3.invalidateContainerClientCoordsCache=function(){this.containerBB=null},k3.findNearestElement=function(e,t,i,r){return this.findNearestElements(e,t,i,r)[0]},k3.findNearestElements=function(e,t,i,r){var n,a,s=this,o=this,l=o.getCachedZSortedEles(),c=[],u=o.cy.zoom(),h=o.cy.hasCompoundNodes(),d=(r?24:8)/u,f=(r?8:2)/u,p=(r?8:2)/u,g=1/0;function v(e,t){if(e.isNode())if(a)return;else a=e,c.push(e);if(e.isEdge()&&(null==t||t<g))if(n){if(n.pstyle("z-compound-depth").value===e.pstyle("z-compound-depth").value&&n.pstyle("z-compound-depth").value===e.pstyle("z-compound-depth").value){for(var i=0;i<c.length;i++)if(c[i].isEdge()){c[i]=e,n=e,g=null!=t?t:g;break}}}else c.push(e),n=e,g=null!=t?t:g}function y(i){var r=i.outerWidth()+2*f,n=i.outerHeight()+2*f,a=r/2,l=n/2,c=i.position(),u="auto"===i.pstyle("corner-radius").value?"auto":i.pstyle("corner-radius").pfValue,h=i._private.rscratch;if(c.x-a<=e&&e<=c.x+a&&c.y-l<=t&&t<=c.y+l&&o.nodeShapes[s.getNodeShape(i)].checkPoint(e,t,0,r,n,c.x,c.y,u,h))return v(i,0),!0}i&&(l=l.interactive);function b(i,r){var n,a=i._private;n=r?r+"-":"",i.boundingBox();var s=a.labelBounds[r||"main"],o=i.pstyle(n+"label").value;if("yes"===i.pstyle("text-events").strValue&&o){var l=yY(a.rscratch,"labelX",r),c=yY(a.rscratch,"labelY",r),u=yY(a.rscratch,"labelAngle",r),h=i.pstyle(n+"text-margin-x").pfValue,d=i.pstyle(n+"text-margin-y").pfValue,f=s.x1-p-h,g=s.x2+p-h,y=s.y1-p-d,b=s.y2+p-d;if(u){var x=Math.cos(u),_=Math.sin(u),w=function(e,t){return{x:(e-=l)*x-(t-=c)*_+l,y:e*_+t*x+c}},k=w(f,y),E=w(f,b),T=w(g,y),P=w(g,b);if(bF(e,t,[k.x+h,k.y+d,T.x+h,T.y+d,P.x+h,P.y+d,E.x+h,E.y+d]))return v(i),!0}else if(bM(s,e,t))return v(i),!0}}for(var x=l.length-1;x>=0;x--){var _=l[x];_.isNode()?y(_)||b(_):function(i){var r,n=i._private,a=n.rscratch,l=i.pstyle("width").pfValue,u=i.pstyle("arrow-scale").value,f=l/2+d,p=f*f,g=2*f,b=n.source,x=n.target;if("segments"===a.edgeType||"straight"===a.edgeType||"haystack"===a.edgeType){for(var _=a.allpts,w=0;w+3<_.length;w+=2)if(bD(e,t,_[w],_[w+1],_[w+2],_[w+3],g)&&p>(r=bB(e,t,_[w],_[w+1],_[w+2],_[w+3])))return v(i,r),!0}else if("bezier"===a.edgeType||"multibezier"===a.edgeType||"self"===a.edgeType||"compound"===a.edgeType){for(var _=a.allpts,w=0;w+5<a.allpts.length;w+=4)if(bO(e,t,_[w],_[w+1],_[w+2],_[w+3],_[w+4],_[w+5],g)&&p>(r=bj(e,t,_[w],_[w+1],_[w+2],_[w+3],_[w+4],_[w+5])))return v(i,r),!0}for(var b=b||n.source,x=x||n.target,k=s.getArrowWidth(l,u),E=[{name:"source",x:a.arrowStartX,y:a.arrowStartY,angle:a.srcArrowAngle},{name:"target",x:a.arrowEndX,y:a.arrowEndY,angle:a.tgtArrowAngle},{name:"mid-source",x:a.midX,y:a.midY,angle:a.midsrcArrowAngle},{name:"mid-target",x:a.midX,y:a.midY,angle:a.midtgtArrowAngle}],w=0;w<E.length;w++){var T=E[w],P=o.arrowShapes[i.pstyle(T.name+"-arrow-shape").value],S=i.pstyle("width").pfValue;if(P.roughCollide(e,t,k,T.angle,{x:T.x,y:T.y},S,d)&&P.collide(e,t,k,T.angle,{x:T.x,y:T.y},S,d))return v(i),!0}h&&c.length>0&&(y(b),y(x))}(_)||b(_)||b(_,"source")||b(_,"target")}return c},k3.getAllInBox=function(e,t,i,r){var n=this.getCachedZSortedEles().interactive,a=2/this.cy.zoom(),s=[],o=Math.min(e,i),l=Math.max(e,i),c=Math.min(t,r),u=Math.max(t,r);e=o,i=l;var h=bx({x1:e,y1:t=c,x2:i,y2:r=u}),d=[{x:h.x1,y:h.y1},{x:h.x2,y:h.y1},{x:h.x2,y:h.y2},{x:h.x1,y:h.y2}],f=[[d[0],d[1]],[d[1],d[2]],[d[2],d[3]],[d[3],d[0]]];function p(e,t){var i=e._private;e.boundingBox();var r=i.labelBounds.main;if(!r)return null;var n=yY(i.rscratch,"labelX",t),s=yY(i.rscratch,"labelY",t),o=yY(i.rscratch,"labelAngle",t),l=e.pstyle("text-margin-x").pfValue,c=e.pstyle("text-margin-y").pfValue,u=r.x1-a-l,h=r.x2+a-l,d=r.y1-a-c,f=r.y2+a-c;if(!o)return[{x:u,y:d},{x:h,y:d},{x:h,y:f},{x:u,y:f}];var p=Math.cos(o),g=Math.sin(o),v=function(e,t){return{x:(e-=n)*p-(t-=s)*g+n,y:e*g+t*p+s}};return[v(u,d),v(h,d),v(h,f),v(u,f)]}for(var g=0;g<n.length;g++){var v=n[g];if(v.isNode()){var y="yes"===v.pstyle("text-events").strValue,b=v.pstyle("box-selection").strValue,x="yes"===v.pstyle("box-select-labels").strValue;if("none"===b)continue;var _=("overlap"===b||x)&&y,w=v.boundingBox({includeNodes:!0,includeEdges:!1,includeLabels:_});if("contain"===b){var k=!1;if(x&&y){var E=p(v);E&&b6(E,d)&&(s.push(v),k=!0)}!k&&bA(h,w)&&s.push(v)}else if("overlap"===b&&bS(h,w)){var T=v.boundingBox({includeNodes:!0,includeEdges:!0,includeLabels:!1,includeMainLabels:!1,includeSourceLabels:!1,includeTargetLabels:!1});if(b6([{x:T.x1,y:T.y1},{x:T.x2,y:T.y1},{x:T.x2,y:T.y2},{x:T.x1,y:T.y2}],d))s.push(v);else{var P=p(v);P&&b6(P,d)&&s.push(v)}}}else{var S=v._private,M=S.rscratch,C=v.pstyle("box-selection").strValue;if("none"===C)continue;if("contain"===C){if(null!=M.startX&&null!=M.startY&&!bM(h,M.startX,M.startY)||null!=M.endX&&null!=M.endY&&!bM(h,M.endX,M.endY))continue;if("bezier"===M.edgeType||"multibezier"===M.edgeType||"self"===M.edgeType||"compound"===M.edgeType||"segments"===M.edgeType||"haystack"===M.edgeType){for(var A=S.rstyle.bezierPts||S.rstyle.linePts||S.rstyle.haystackPts,I=!0,L=0;L<A.length;L++)if(!bC(h,A[L])){I=!1;break}I&&s.push(v)}else"straight"===M.edgeType&&s.push(v)}else if("overlap"===C){var D=!1;if(null!=M.startX&&null!=M.startY&&null!=M.endX&&null!=M.endY&&(bM(h,M.startX,M.startY)||bM(h,M.endX,M.endY)))s.push(v),D=!0;else if(!D&&"haystack"===M.edgeType){for(var O=S.rstyle.haystackPts,R=0;R<O.length;R++)if(bC(h,O[R])){s.push(v),D=!0;break}}if(!D){var N=S.rstyle.bezierPts||S.rstyle.linePts||S.rstyle.haystackPts;if((!N||N.length<2)&&"straight"===M.edgeType&&null!=M.startX&&null!=M.startY&&null!=M.endX&&null!=M.endY&&(N=[{x:M.startX,y:M.startY},{x:M.endX,y:M.endY}]),!N||N.length<2)continue;for(var j=0;j<N.length-1;j++){for(var B=N[j],F=N[j+1],z=0;z<f.length;z++){var V=vS(f[z],2);if(function(e,t,i,r){function n(e,t,i){return(i.y-e.y)*(t.x-e.x)>(t.y-e.y)*(i.x-e.x)}return n(e,i,r)!==n(t,i,r)&&n(e,t,i)!==n(e,t,r)}(B,F,V[0],V[1])){s.push(v),D=!0;break}}if(D)break}}}}}return s};var k4={};k4.calculateArrowAngles=function(e){var t=e._private.rscratch,i="haystack"===t.edgeType,r="bezier"===t.edgeType,n="multibezier"===t.edgeType,a="segments"===t.edgeType,s="compound"===t.edgeType,o="self"===t.edgeType;if(i?(y=t.haystackPts[0],b=t.haystackPts[1],x=t.haystackPts[2],_=t.haystackPts[3]):(y=t.arrowStartX,b=t.arrowStartY,x=t.arrowEndX,_=t.arrowEndY),h=t.midX,d=t.midY,a)g=y-t.segpts[0],v=b-t.segpts[1];else if(n||s||o||r){var l=t.allpts,c=bm(l[0],l[2],l[4],.1),u=bm(l[1],l[3],l[5],.1);g=y-c,v=b-u}else g=y-h,v=b-d;t.srcArrowAngle=bu(g,v);var h=t.midX,d=t.midY;if(i&&(h=(y+x)/2,d=(b+_)/2),g=x-y,v=_-b,a){var l=t.allpts;if(l.length/2%2==0){var f=l.length/2,p=f-2;g=l[f]-l[p],v=l[f+1]-l[p+1]}else if(t.isRound)g=t.midVector[1],v=-t.midVector[0];else{var f=l.length/2-1,p=f-2;g=l[f]-l[p],v=l[f+1]-l[p+1]}}else if(n||s||o){var g,v,y,b,x,_,h,d,w,k,E,T,l=t.allpts;if(t.ctrlpts.length/2%2==0){var P=l.length/2-1,S=P+2,M=S+2;w=bm(l[P],l[S],l[M],0),k=bm(l[P+1],l[S+1],l[M+1],0),E=bm(l[P],l[S],l[M],1e-4),T=bm(l[P+1],l[S+1],l[M+1],1e-4)}else{var S=l.length/2-1,P=S-2,M=S+2;w=bm(l[P],l[S],l[M],.4999),k=bm(l[P+1],l[S+1],l[M+1],.4999),E=bm(l[P],l[S],l[M],.5),T=bm(l[P+1],l[S+1],l[M+1],.5)}g=E-w,v=T-k}if(t.midtgtArrowAngle=bu(g,v),t.midDispX=g,t.midDispY=v,g*=-1,v*=-1,a){var l=t.allpts;if(l.length/2%2==0);else if(!t.isRound){var f=l.length/2-1,C=f+2;g=-(l[C]-l[f]),v=-(l[C+1]-l[f+1])}}if(t.midsrcArrowAngle=bu(g,v),a)g=x-t.segpts[t.segpts.length-2],v=_-t.segpts[t.segpts.length-1];else if(n||s||o||r){var l=t.allpts,A=l.length,c=bm(l[A-6],l[A-4],l[A-2],.9),u=bm(l[A-5],l[A-3],l[A-1],.9);g=x-c,v=_-u}else g=x-h,v=_-d;t.tgtArrowAngle=bu(g,v)},k4.getArrowWidth=k4.getArrowHeight=function(e,t){var i=this.arrowWidthCache=this.arrowWidthCache||{},r=i[e+", "+t];return r||(r=Math.max(Math.pow(13.37*e,.9),29)*t,i[e+", "+t]=r),r};var k5,k6,k8,k9,k7,Ee,Et,Ei,Er,En,Ea,Es,Eo,El,Ec,Eu,Eh,Ed,Ef,Ep,Eg,Em,Ev,Ey,Eb,Ex,E_,Ew,Ek,EE,ET,EP,ES,EM,EC,EA,EI,EL,ED,EO,ER,EN,Ej,EB,EF,Ez,EV,EU,E$,EW,EH,Eq,EG,EY,EX,EK,EZ,EJ,EQ,E0,E1,E2,E3,E4,E5,E6,E8,E9,E7,Te,Tt,Ti,Tr,Tn,Ta,Ts,To,Tl,Tc,Tu,Th,Td,Tf,Tp,Tg,Tm,Tv,Ty,Tb,Tx,T_,Tw,Tk,TE,TT,TP,TS,TM,TC,TA,TI,TL,TD,TO,TR,TN,Tj,TB,TF,Tz,TV,TU,T$,TW,TH,Tq,TG,TY,TX,TK,TZ,TJ,TQ,T0,T1,T2,T3,T4,T5,T6,T8,T9,T7,Pe,Pt,Pi,Pr,Pn,Pa,Ps,Po,Pl,Pc,Pu,Ph,Pd,Pf,Pp,Pg,Pm,Pv,Py,Pb,Px,P_,Pw,Pk,PE,PT,PP,PS,PM,PC,PA,PI,PL,PD,PO,PR,PN,Pj,PB,PF,Pz,PV,PU,P$,PW,PH={},Pq={},PG=function(e,t,i){i.x=t.x-e.x,i.y=t.y-e.y,i.len=Math.sqrt(i.x*i.x+i.y*i.y),i.nx=i.x/i.len,i.ny=i.y/i.len,i.ang=Math.atan2(i.ny,i.nx)},PY=function(e,t){t.x=-1*e.x,t.y=-1*e.y,t.nx=-1*e.nx,t.ny=-1*e.ny,t.ang=e.ang>0?-(Math.PI-e.ang):Math.PI+e.ang},PX=function(e,t,i,r,n){if(e!==g?PG(t,e,PH):PY(Pq,PH),PG(t,i,Pq),PR=PH.nx*Pq.ny-PH.ny*Pq.nx,PN=PH.nx*Pq.nx- -(PH.ny*Pq.ny),1e-6>Math.abs(PF=Math.asin(Math.max(-1,Math.min(1,PR))))){PD=t.x,PO=t.y,PV=P$=0;return}Pj=1,PB=!1,PN<0?PF<0?PF=Math.PI+PF:(PF=Math.PI-PF,Pj=-1,PB=!0):PF>0&&(Pj=-1,PB=!0),P$=void 0!==t.radius?t.radius:r,Pz=PF/2,PW=Math.min(PH.len/2,Pq.len/2),PV=n?(PU=Math.abs(Math.cos(Pz)*P$/Math.sin(Pz)))>PW?Math.abs((PU=PW)*Math.sin(Pz)/Math.cos(Pz)):P$:Math.abs((PU=Math.min(PW,P$))*Math.sin(Pz)/Math.cos(Pz)),f=t.x+Pq.nx*PU,p=t.y+Pq.ny*PU,PD=f-Pq.ny*PV*Pj,PO=p+Pq.nx*PV*Pj,h=t.x+PH.nx*PU,d=t.y+PH.ny*PU,g=t};function PK(e,t){0===t.radius?e.lineTo(t.cx,t.cy):e.arc(t.cx,t.cy,t.radius,t.startAngle,t.endAngle,t.counterClockwise)}function PZ(e,t,i,r){var n=!(arguments.length>4)||void 0===arguments[4]||arguments[4];return 0===r||0===t.radius?{cx:t.x,cy:t.y,radius:0,startX:t.x,startY:t.y,stopX:t.x,stopY:t.y,startAngle:void 0,endAngle:void 0,counterClockwise:void 0}:(PX(e,t,i,r,n),{cx:PD,cy:PO,radius:PV,startX:h,startY:d,stopX:f,stopY:p,startAngle:PH.ang+Math.PI/2*Pj,endAngle:Pq.ang-Math.PI/2*Pj,counterClockwise:PB})}var PJ=Math.sqrt(.02),PQ={};function P0(e){var t=[];if(null!=e){for(var i=0;i<e.length;i+=2){var r=e[i],n=e[i+1];t.push({x:r,y:n})}return t}}PQ.findMidptPtsEtc=function(e,t){var i,r=t.posPts,n=t.intersectionPts,a=t.vectorNormInverse,s=e.pstyle("source-endpoint"),o=e.pstyle("target-endpoint"),l=null!=s.units&&null!=o.units;switch(e.pstyle("edge-distances").value){case"node-position":i=r;break;case"intersection":i=n;break;case"endpoints":if(l){var c,u,h,d=vS(this.manualEndptToPx(e.source()[0],s),2),f=d[0],p=d[1],g=vS(this.manualEndptToPx(e.target()[0],o),2),v=g[0],y=g[1];c=y-p,h=Math.sqrt((u=v-f)*u+c*c),a={x:-c/h,y:u/h},i={x1:f,y1:p,x2:v,y2:y}}else yF("Edge ".concat(e.id()," has edge-distances:endpoints specified without manual endpoints specified via source-endpoint and target-endpoint.  Falling back on edge-distances:intersection (default).")),i=n}return{midptPts:i,vectorNormInverse:a}},PQ.findHaystackPoints=function(e){for(var t=0;t<e.length;t++){var i=e[t],r=i._private,n=r.rscratch;if(!n.haystack){var a=2*Math.random()*Math.PI;n.source={x:Math.cos(a),y:Math.sin(a)},n.target={x:Math.cos(a=2*Math.random()*Math.PI),y:Math.sin(a)}}var s=r.source,o=r.target,l=s.position(),c=o.position(),u=s.width(),h=o.width(),d=s.height(),f=o.height(),p=i.pstyle("haystack-radius").value/2;n.haystackPts=n.allpts=[n.source.x*u*p+l.x,n.source.y*d*p+l.y,n.target.x*h*p+c.x,n.target.y*f*p+c.y],n.midX=(n.allpts[0]+n.allpts[2])/2,n.midY=(n.allpts[1]+n.allpts[3])/2,n.edgeType="haystack",n.haystack=!0,this.storeEdgeProjections(i),this.calculateArrowAngles(i),this.recalculateEdgeLabelProjections(i),this.calculateLabelAngles(i)}},PQ.findSegmentsPoints=function(e,t){var i=e._private.rscratch,r=e.pstyle("segment-weights"),n=e.pstyle("segment-distances"),a=e.pstyle("segment-radii"),s=e.pstyle("radius-type"),o=Math.min(r.pfValue.length,n.pfValue.length),l=a.pfValue[a.pfValue.length-1],c=s.pfValue[s.pfValue.length-1];i.edgeType="segments",i.segpts=[],i.radii=[],i.isArcRadius=[];for(var u=0;u<o;u++){var h=r.pfValue[u],d=n.pfValue[u],f=1-h,p=this.findMidptPtsEtc(e,t),g=p.midptPts,v=p.vectorNormInverse,y={x:g.x1*f+g.x2*h,y:g.y1*f+g.y2*h};i.segpts.push(y.x+v.x*d,y.y+v.y*d),i.radii.push(void 0!==a.pfValue[u]?a.pfValue[u]:l),i.isArcRadius.push((void 0!==s.pfValue[u]?s.pfValue[u]:c)==="arc-radius")}},PQ.findLoopPoints=function(e,t,i,r){var n=e._private.rscratch,a=t.dirCounts,s=t.srcPos,o=e.pstyle("control-point-distances"),l=o?o.pfValue[0]:void 0,c=e.pstyle("loop-direction").pfValue,u=e.pstyle("loop-sweep").pfValue,h=e.pstyle("control-point-step-size").pfValue;n.edgeType="self";var d=i,f=h;r&&(d=0,f=l);var p=c-Math.PI/2,g=p-u/2,v=p+u/2,y=String(c+"_"+u);d=void 0===a[y]?a[y]=0:++a[y],n.ctrlpts=[s.x+1.4*Math.cos(g)*f*(d/3+1),s.y+1.4*Math.sin(g)*f*(d/3+1),s.x+1.4*Math.cos(v)*f*(d/3+1),s.y+1.4*Math.sin(v)*f*(d/3+1)]},PQ.findCompoundLoopPoints=function(e,t,i,r){var n=e._private.rscratch;n.edgeType="compound";var a=t.srcPos,s=t.tgtPos,o=t.srcW,l=t.srcH,c=t.tgtW,u=t.tgtH,h=e.pstyle("control-point-step-size").pfValue,d=e.pstyle("control-point-distances"),f=d?d.pfValue[0]:void 0,p=i,g=h;r&&(p=0,g=f);var v={x:a.x-o/2,y:a.y-l/2},y={x:s.x-c/2,y:s.y-u/2},b={x:Math.min(v.x,y.x),y:Math.min(v.y,y.y)},x=Math.max(.5,Math.log(.01*o)),_=Math.max(.5,Math.log(.01*c));n.ctrlpts=[b.x,b.y-1.7995514309304248*g*(p/3+1)*x,b.x-1.7995514309304248*g*(p/3+1)*_,b.y]},PQ.findStraightEdgePoints=function(e){e._private.rscratch.edgeType="straight"},PQ.findBezierPoints=function(e,t,i,r,n){var a=e._private.rscratch,s=e.pstyle("control-point-step-size").pfValue,o=e.pstyle("control-point-distances"),l=e.pstyle("control-point-weights"),c=o&&l?Math.min(o.value.length,l.value.length):1,u=o?o.pfValue[0]:void 0,h=l.value[0];a.edgeType=r?"multibezier":"bezier",a.ctrlpts=[];for(var d=0;d<c;d++){var f=(.5-t.eles.length/2+i)*s*(n?-1:1),p=void 0,g=bd(f);r&&(u=o?o.pfValue[d]:s,h=l.value[d]);var v=void 0!==(p=r?u:void 0!==u?g*u:void 0)?p:f,y=1-h,b=h,x=this.findMidptPtsEtc(e,t),_=x.midptPts,w=x.vectorNormInverse,k={x:_.x1*y+_.x2*b,y:_.y1*y+_.y2*b};a.ctrlpts.push(k.x+w.x*v,k.y+w.y*v)}},PQ.findTaxiPoints=function(e,t){var i,r=e._private.rscratch;r.edgeType="segments";var n="vertical",a="horizontal",s="leftward",o="rightward",l="downward",c="upward",u=t.posPts,h=t.srcW,d=t.srcH,f=t.tgtW,p=t.tgtH,g="node-position"!==e.pstyle("edge-distances").value,v=e.pstyle("taxi-direction").value,y=v,b=e.pstyle("taxi-turn"),x="%"===b.units,_=b.pfValue,w=e.pstyle("taxi-turn-min-distance").pfValue,k=u.x2-u.x1,E=u.y2-u.y1,T=function(e,t){return e>0?Math.max(e-t,0):Math.min(e+t,0)},P=T(k,g?(h+f)/2:0),S=T(E,g?(d+p)/2:0),M=!1;"auto"===y?v=Math.abs(P)>Math.abs(S)?a:n:y===c||y===l?(v=n,M=!0):(y===s||y===o)&&(v=a,M=!0);var C=v===n,A=C?S:P,I=C?E:k,L=bd(I),D=!1;!(M&&(x||_<0))&&(y===l&&I<0||y===c&&I>0||y===s&&I>0||y===o&&I<0)&&(L*=-1,A=L*Math.abs(A),D=!0);var O=function(e){return Math.abs(e)<w||Math.abs(e)>=Math.abs(A)},R=O(i=x?(_<0?1+_:_)*A:(_<0?A:0)+_*L),N=O(Math.abs(A)-Math.abs(i));if((R||N)&&!D)if(C){var j=Math.abs(k)<=f/2;if(Math.abs(I)<=d/2){var B=(u.x1+u.x2)/2;r.segpts=[B,u.y1,B,u.y2]}else if(j){var F=(u.y1+u.y2)/2;r.segpts=[u.x1,F,u.x2,F]}else r.segpts=[u.x1,u.y2]}else{var z=Math.abs(E)<=p/2;if(Math.abs(I)<=h/2){var V=(u.y1+u.y2)/2;r.segpts=[u.x1,V,u.x2,V]}else if(z){var U=(u.x1+u.x2)/2;r.segpts=[U,u.y1,U,u.y2]}else r.segpts=[u.x2,u.y1]}else if(C){var $=u.y1+i+(g?d/2*L:0);r.segpts=[u.x1,$,u.x2,$]}else{var W=u.x1+i+(g?h/2*L:0);r.segpts=[W,u.y1,W,u.y2]}if(r.isRound){var H=e.pstyle("taxi-radius").value,q="arc-radius"===e.pstyle("radius-type").value[0];r.radii=Array(r.segpts.length/2).fill(H),r.isArcRadius=Array(r.segpts.length/2).fill(q)}},PQ.tryToCorrectInvalidPoints=function(e,t){var i=e._private.rscratch;if("bezier"===i.edgeType){var r=t.srcPos,n=t.tgtPos,a=t.srcW,s=t.srcH,o=t.tgtW,l=t.tgtH,c=t.srcShape,u=t.tgtShape,h=t.srcCornerRadius,d=t.tgtCornerRadius,f=t.srcRs,p=t.tgtRs,g=!v$(i.startX)||!v$(i.startY),v=!v$(i.arrowStartX)||!v$(i.arrowStartY),y=!v$(i.endX)||!v$(i.endY),b=!v$(i.arrowEndX)||!v$(i.arrowEndY),x=3*(this.getArrowWidth(e.pstyle("width").pfValue,e.pstyle("arrow-scale").value)*this.arrowShapeWidth),_=bf({x:i.ctrlpts[0],y:i.ctrlpts[1]},{x:i.startX,y:i.startY}),w=_<x,k=bf({x:i.ctrlpts[0],y:i.ctrlpts[1]},{x:i.endX,y:i.endY}),E=k<x,T=!1;if(g||v||w){T=!0;var P={x:i.ctrlpts[0]-r.x,y:i.ctrlpts[1]-r.y},S=Math.sqrt(P.x*P.x+P.y*P.y),M={x:P.x/S,y:P.y/S},C=Math.max(a,s),A={x:i.ctrlpts[0]+2*M.x*C,y:i.ctrlpts[1]+2*M.y*C},I=c.intersectLine(r.x,r.y,a,s,A.x,A.y,0,h,f);w?(i.ctrlpts[0]=i.ctrlpts[0]+M.x*(x-_),i.ctrlpts[1]=i.ctrlpts[1]+M.y*(x-_)):(i.ctrlpts[0]=I[0]+M.x*x,i.ctrlpts[1]=I[1]+M.y*x)}if(y||b||E){T=!0;var L={x:i.ctrlpts[0]-n.x,y:i.ctrlpts[1]-n.y},D=Math.sqrt(L.x*L.x+L.y*L.y),O={x:L.x/D,y:L.y/D},R=Math.max(a,s),N={x:i.ctrlpts[0]+2*O.x*R,y:i.ctrlpts[1]+2*O.y*R},j=u.intersectLine(n.x,n.y,o,l,N.x,N.y,0,d,p);E?(i.ctrlpts[0]=i.ctrlpts[0]+O.x*(x-k),i.ctrlpts[1]=i.ctrlpts[1]+O.y*(x-k)):(i.ctrlpts[0]=j[0]+O.x*x,i.ctrlpts[1]=j[1]+O.y*x)}T&&this.findEndpoints(e)}},PQ.storeAllpts=function(e){var t=e._private.rscratch;if("multibezier"===t.edgeType||"bezier"===t.edgeType||"self"===t.edgeType||"compound"===t.edgeType){t.allpts=[],t.allpts.push(t.startX,t.startY);for(var i,r=0;r+1<t.ctrlpts.length;r+=2)t.allpts.push(t.ctrlpts[r],t.ctrlpts[r+1]),r+3<t.ctrlpts.length&&t.allpts.push((t.ctrlpts[r]+t.ctrlpts[r+2])/2,(t.ctrlpts[r+1]+t.ctrlpts[r+3])/2);(t.allpts.push(t.endX,t.endY),t.ctrlpts.length/2%2==0)?(i=t.allpts.length/2-1,t.midX=t.allpts[i],t.midY=t.allpts[i+1]):(i=t.allpts.length/2-3,t.midX=bm(t.allpts[i],t.allpts[i+2],t.allpts[i+4],.5),t.midY=bm(t.allpts[i+1],t.allpts[i+3],t.allpts[i+5],.5))}else if("straight"===t.edgeType)t.allpts=[t.startX,t.startY,t.endX,t.endY],t.midX=(t.startX+t.endX+t.arrowStartX+t.arrowEndX)/4,t.midY=(t.startY+t.endY+t.arrowStartY+t.arrowEndY)/4;else if("segments"===t.edgeType){if(t.allpts=[],t.allpts.push(t.startX,t.startY),t.allpts.push.apply(t.allpts,t.segpts),t.allpts.push(t.endX,t.endY),t.isRound){t.roundCorners=[];for(var n=2;n+3<t.allpts.length;n+=2){var a=t.radii[n/2-1],s=t.isArcRadius[n/2-1];t.roundCorners.push(PZ({x:t.allpts[n-2],y:t.allpts[n-1]},{x:t.allpts[n],y:t.allpts[n+1],radius:a},{x:t.allpts[n+2],y:t.allpts[n+3]},a,s))}}if(t.segpts.length%4==0){var o=t.segpts.length/2,l=o-2;t.midX=(t.segpts[l]+t.segpts[o])/2,t.midY=(t.segpts[l+1]+t.segpts[o+1])/2}else{var c=t.segpts.length/2-1;if(t.isRound){var u={x:t.segpts[c],y:t.segpts[c+1]},h=t.roundCorners[c/2];if(0===h.radius){var d={x:t.segpts[c+2],y:t.segpts[c+3]};t.midX=u.x,t.midY=u.y,t.midVector=[u.y-d.y,d.x-u.x]}else{var f=[u.x-h.cx,u.y-h.cy],p=h.radius/Math.sqrt(Math.pow(f[0],2)+Math.pow(f[1],2));f=f.map(function(e){return e*p}),t.midX=h.cx+f[0],t.midY=h.cy+f[1],t.midVector=f}}else t.midX=t.segpts[c],t.midY=t.segpts[c+1]}}},PQ.checkForInvalidEdgeWarning=function(e){var t=e[0]._private.rscratch;t.nodesOverlap||v$(t.startX)&&v$(t.startY)&&v$(t.endX)&&v$(t.endY)?t.loggedErr=!1:t.loggedErr||(t.loggedErr=!0,yF("Edge `"+e.id()+"` has invalid endpoints and so it is impossible to draw.  Adjust your edge style (e.g. control points) accordingly or use an alternative edge type.  This is expected behaviour when the source node and the target node overlap."))},PQ.findEdgeControlPoints=function(e){var t=this;if(e&&0!==e.length){for(var i=this,r=i.cy.hasCompoundNodes(),n=new yZ,a=function(e,t){return[].concat(vM(e),[+!!t]).join("-")},s=[],o=[],l=0;l<e.length;l++){var c=e[l],u=c._private,h=c.pstyle("curve-style").value;if(!c.removed()&&c.takesUpSpace()){if("haystack"===h){o.push(c);continue}var d="unbundled-bezier"===h||v3(h,"segments")||"straight"===h||"straight-triangle"===h||v3(h,"taxi"),f="unbundled-bezier"===h||"bezier"===h,p=u.source,g=u.target,v=[p.poolIndex(),g.poolIndex()].sort(),y=a(v,d),b=n.get(y);null==b&&(b={eles:[]},s.push({pairId:v,edgeIsUnbundled:d}),n.set(y,b)),b.eles.push(c),d&&(b.hasUnbundled=!0),f&&(b.hasBezier=!0)}}for(var x=0;x<s.length;x++)!function(){var e,o=s[x],l=a(o.pairId,o.edgeIsUnbundled),c=n.get(l);if(!c.hasUnbundled){var u=c.eles[0].parallelEdges().filter(function(e){return e.isBundledBezier()});yq(c.eles),u.forEach(function(e){return c.eles.push(e)}),c.eles.sort(function(e,t){return e.poolIndex()-t.poolIndex()})}var h=c.eles[0],d=h.source(),f=h.target();if(d.poolIndex()>f.poolIndex()){var p=d;d=f,f=p}var g=c.srcPos=d.position(),v=c.tgtPos=f.position(),y=c.srcW=d.outerWidth(),b=c.srcH=d.outerHeight(),_=c.tgtW=f.outerWidth(),w=c.tgtH=f.outerHeight(),k=c.srcShape=i.nodeShapes[t.getNodeShape(d)],E=c.tgtShape=i.nodeShapes[t.getNodeShape(f)],T=c.srcCornerRadius="auto"===d.pstyle("corner-radius").value?"auto":d.pstyle("corner-radius").pfValue,P=c.tgtCornerRadius="auto"===f.pstyle("corner-radius").value?"auto":f.pstyle("corner-radius").pfValue,S=c.tgtRs=f._private.rscratch,M=c.srcRs=d._private.rscratch;c.dirCounts={north:0,west:0,south:0,east:0,northwest:0,southwest:0,northeast:0,southeast:0};for(var C=0;C<c.eles.length;C++){var A=c.eles[C],I=A[0]._private.rscratch,L=A.pstyle("curve-style").value,D="unbundled-bezier"===L||v3(L,"segments")||v3(L,"taxi"),O=!d.same(A.source());if(!c.calculatedIntersection&&d!==f&&(c.hasBezier||c.hasUnbundled)){c.calculatedIntersection=!0;var R=k.intersectLine(g.x,g.y,y,b,v.x,v.y,0,T,M),N=c.srcIntn=R,j=E.intersectLine(v.x,v.y,_,w,g.x,g.y,0,P,S),B=c.tgtIntn=j,F=c.intersectionPts={x1:R[0],x2:j[0],y1:R[1],y2:j[1]},z=c.posPts={x1:g.x,x2:v.x,y1:g.y,y2:v.y},V=j[1]-R[1],U=j[0]-R[0],$=Math.sqrt(U*U+V*V);v$($)&&$>=PJ||($=Math.sqrt(Math.max(U*U,.01)+Math.max(V*V,.01)));var W=c.vector={x:U,y:V},H=c.vectorNorm={x:W.x/$,y:W.y/$},q={x:-H.y,y:H.x};c.nodesOverlap=!v$($)||E.checkPoint(R[0],R[1],0,_,w,v.x,v.y,P,S)||k.checkPoint(j[0],j[1],0,y,b,g.x,g.y,T,M),c.vectorNormInverse=q,e={nodesOverlap:c.nodesOverlap,dirCounts:c.dirCounts,calculatedIntersection:!0,hasBezier:c.hasBezier,hasUnbundled:c.hasUnbundled,eles:c.eles,srcPos:v,srcRs:S,tgtPos:g,tgtRs:M,srcW:_,srcH:w,tgtW:y,tgtH:b,srcIntn:B,tgtIntn:N,srcShape:E,tgtShape:k,posPts:{x1:z.x2,y1:z.y2,x2:z.x1,y2:z.y1},intersectionPts:{x1:F.x2,y1:F.y2,x2:F.x1,y2:F.y1},vector:{x:-W.x,y:-W.y},vectorNorm:{x:-H.x,y:-H.y},vectorNormInverse:{x:-q.x,y:-q.y}}}var G=O?e:c;I.nodesOverlap=G.nodesOverlap,I.srcIntn=G.srcIntn,I.tgtIntn=G.tgtIntn,I.isRound=L.startsWith("round"),r&&(d.isParent()||d.isChild()||f.isParent()||f.isChild())&&(d.parents().anySame(f)||f.parents().anySame(d)||d.same(f)&&d.isParent())?t.findCompoundLoopPoints(A,G,C,D):d===f?t.findLoopPoints(A,G,C,D):L.endsWith("segments")?t.findSegmentsPoints(A,G):L.endsWith("taxi")?t.findTaxiPoints(A,G):"straight"!==L&&(D||c.eles.length%2!=1||C!==Math.floor(c.eles.length/2))?t.findBezierPoints(A,G,C,D,O):t.findStraightEdgePoints(A),t.findEndpoints(A),t.tryToCorrectInvalidPoints(A,G),t.checkForInvalidEdgeWarning(A),t.storeAllpts(A),t.storeEdgeProjections(A),t.calculateArrowAngles(A),t.recalculateEdgeLabelProjections(A),t.calculateLabelAngles(A)}}();this.findHaystackPoints(o)}},PQ.getSegmentPoints=function(e){var t=e[0]._private.rscratch;if(this.recalculateRenderedStyle(e),"segments"===t.edgeType)return P0(t.segpts)},PQ.getControlPoints=function(e){var t=e[0]._private.rscratch;this.recalculateRenderedStyle(e);var i=t.edgeType;if("bezier"===i||"multibezier"===i||"self"===i||"compound"===i)return P0(t.ctrlpts)},PQ.getEdgeMidpoint=function(e){var t=e[0]._private.rscratch;return this.recalculateRenderedStyle(e),{x:t.midX,y:t.midY}};var P1={};P1.manualEndptToPx=function(e,t){var i=e.position(),r=e.outerWidth(),n=e.outerHeight(),a=e._private.rscratch;if(2===t.value.length){var s=[t.pfValue[0],t.pfValue[1]];return"%"===t.units[0]&&(s[0]=s[0]*r),"%"===t.units[1]&&(s[1]=s[1]*n),s[0]+=i.x,s[1]+=i.y,s}var o=t.pfValue[0];o=-Math.PI/2+o;var l=2*Math.max(r,n),c=[i.x+Math.cos(o)*l,i.y+Math.sin(o)*l];return this.nodeShapes[this.getNodeShape(e)].intersectLine(i.x,i.y,r,n,c[0],c[1],0,"auto"===e.pstyle("corner-radius").value?"auto":e.pstyle("corner-radius").pfValue,a)},P1.findEndpoints=function(e){var t,i,r,n,a,s,o,l,c,u=e.source()[0],h=e.target()[0],d=u.position(),f=h.position(),p=e.pstyle("target-arrow-shape").value,g=e.pstyle("source-arrow-shape").value,v=e.pstyle("target-distance-from-node").pfValue,y=e.pstyle("source-distance-from-node").pfValue,b=u._private.rscratch,x=h._private.rscratch,_=e.pstyle("curve-style").value,w=e._private.rscratch,k=w.edgeType,E=v3(_,"taxi"),T="self"===k||"compound"===k,P="bezier"===k||"multibezier"===k||T,S="bezier"!==k,M="straight"===k||"segments"===k,C="segments"===k,A=T||E,I=e.pstyle("source-endpoint"),L=A?"outside-to-node":I.value,D="auto"===u.pstyle("corner-radius").value?"auto":u.pstyle("corner-radius").pfValue,O=e.pstyle("target-endpoint"),R=A?"outside-to-node":O.value,N="auto"===h.pstyle("corner-radius").value?"auto":h.pstyle("corner-radius").pfValue;w.srcManEndpt=I,w.tgtManEndpt=O;var j=null!=(t=(null==O||null==(i=O.pfValue)?void 0:i.length)===2?O.pfValue:null)?t:[0,0],B=null!=(r=(null==I||null==(n=I.pfValue)?void 0:n.length)===2?I.pfValue:null)?r:[0,0];if(P){var F=[w.ctrlpts[0],w.ctrlpts[1]];s=S?[w.ctrlpts[w.ctrlpts.length-2],w.ctrlpts[w.ctrlpts.length-1]]:F,o=F}else if(M){var z=C?w.segpts.slice(0,2):[f.x+j[0],f.y+j[1]];s=C?w.segpts.slice(w.segpts.length-2):[d.x+B[0],d.y+B[1]],o=z}if("inside-to-node"===R)a=[f.x,f.y];else if(O.units)a=this.manualEndptToPx(h,O);else if("outside-to-line"===R)a=w.tgtIntn;else if("outside-to-node"===R||"outside-to-node-or-label"===R?l=s:("outside-to-line"===R||"outside-to-line-or-label"===R)&&(l=[d.x,d.y]),a=this.nodeShapes[this.getNodeShape(h)].intersectLine(f.x,f.y,h.outerWidth(),h.outerHeight(),l[0],l[1],0,N,x),"outside-to-node-or-label"===R||"outside-to-line-or-label"===R){var V=h._private.rscratch,U=V.labelWidth,$=V.labelHeight,W=V.labelX,H=V.labelY,q=U/2,G=$/2,Y=h.pstyle("text-valign").value;"top"===Y?H-=G:"bottom"===Y&&(H+=G);var X=h.pstyle("text-halign").value;"left"===X?W-=q:"right"===X&&(W+=q);var K=bK(l[0],l[1],[W-q,H-G,W+q,H-G,W+q,H+G,W-q,H+G],f.x,f.y);if(K.length>0){var Z=bp(d,ba(a)),J=bp(d,ba(K)),Q=Z;J<Z&&(a=K,Q=J),K.length>2&&bp(d,{x:K[2],y:K[3]})<Q&&(a=[K[2],K[3]])}}var ee=bJ(a,s,this.arrowShapes[p].spacing(e)+v),et=bJ(a,s,this.arrowShapes[p].gap(e)+v);if(w.endX=et[0],w.endY=et[1],w.arrowEndX=ee[0],w.arrowEndY=ee[1],"inside-to-node"===L)a=[d.x,d.y];else if(I.units)a=this.manualEndptToPx(u,I);else if("outside-to-line"===L)a=w.srcIntn;else if("outside-to-node"===L||"outside-to-node-or-label"===L?c=o:("outside-to-line"===L||"outside-to-line-or-label"===L)&&(c=[f.x,f.y]),a=this.nodeShapes[this.getNodeShape(u)].intersectLine(d.x,d.y,u.outerWidth(),u.outerHeight(),c[0],c[1],0,D,b),"outside-to-node-or-label"===L||"outside-to-line-or-label"===L){var ei=u._private.rscratch,er=ei.labelWidth,en=ei.labelHeight,ea=ei.labelX,es=ei.labelY,eo=er/2,el=en/2,ec=u.pstyle("text-valign").value;"top"===ec?es-=el:"bottom"===ec&&(es+=el);var eu=u.pstyle("text-halign").value;"left"===eu?ea-=eo:"right"===eu&&(ea+=eo);var eh=bK(c[0],c[1],[ea-eo,es-el,ea+eo,es-el,ea+eo,es+el,ea-eo,es+el],d.x,d.y);if(eh.length>0){var ed=bp(f,ba(a)),ef=bp(f,ba(eh)),ep=ed;ef<ed&&(a=[eh[0],eh[1]],ep=ef),eh.length>2&&bp(f,{x:eh[2],y:eh[3]})<ep&&(a=[eh[2],eh[3]])}}var eg=bJ(a,o,this.arrowShapes[g].spacing(e)+y),em=bJ(a,o,this.arrowShapes[g].gap(e)+y);w.startX=em[0],w.startY=em[1],w.arrowStartX=eg[0],w.arrowStartY=eg[1],(P||S||M)&&(v$(w.startX)&&v$(w.startY)&&v$(w.endX)&&v$(w.endY)?w.badLine=!1:w.badLine=!0)},P1.getSourceEndpoint=function(e){var t=e[0]._private.rscratch;return(this.recalculateRenderedStyle(e),"haystack"===t.edgeType)?{x:t.haystackPts[0],y:t.haystackPts[1]}:{x:t.arrowStartX,y:t.arrowStartY}},P1.getTargetEndpoint=function(e){var t=e[0]._private.rscratch;return(this.recalculateRenderedStyle(e),"haystack"===t.edgeType)?{x:t.haystackPts[2],y:t.haystackPts[3]}:{x:t.arrowEndX,y:t.arrowEndY}};var P2={};P2.storeEdgeProjections=function(e){var t=e._private,i=t.rscratch,r=i.edgeType;if(t.rstyle.bezierPts=null,t.rstyle.linePts=null,t.rstyle.haystackPts=null,"multibezier"===r||"bezier"===r||"self"===r||"compound"===r){t.rstyle.bezierPts=[];for(var n=0;n+5<i.allpts.length;n+=4)!function(e,t,i){for(var r=function(e,t,i,r){return bm(e,t,i,r)},n=t._private.rstyle.bezierPts,a=0;a<e.bezierProjPcts.length;a++){var s=e.bezierProjPcts[a];n.push({x:r(i[0],i[2],i[4],s),y:r(i[1],i[3],i[5],s)})}}(this,e,i.allpts.slice(n,n+6))}else if("segments"===r)for(var a=t.rstyle.linePts=[],n=0;n+1<i.allpts.length;n+=2)a.push({x:i.allpts[n],y:i.allpts[n+1]});else if("haystack"===r){var s=i.haystackPts;t.rstyle.haystackPts=[{x:s[0],y:s[1]},{x:s[2],y:s[3]}]}t.rstyle.arrowWidth=this.getArrowWidth(e.pstyle("width").pfValue,e.pstyle("arrow-scale").value)*this.arrowShapeWidth},P2.recalculateEdgeProjections=function(e){this.findEdgeControlPoints(e)};var P3={};P3.recalculateNodeLabelProjection=function(e){var t,i;if(!vK(e.pstyle("label").strValue)){var r=e._private,n=e.width(),a=e.height(),s=e.padding(),o=e.position(),l=e.pstyle("text-halign").strValue,c=e.pstyle("text-valign").strValue,u=r.rscratch,h=r.rstyle;switch(l){case"left":t=o.x-n/2-s;break;case"right":t=o.x+n/2+s;break;default:t=o.x}switch(c){case"top":i=o.y-a/2-s;break;case"bottom":i=o.y+a/2+s;break;default:i=o.y}u.labelX=t,u.labelY=i,h.labelX=t,h.labelY=i,this.calculateLabelAngles(e),this.applyLabelDimensions(e)}};var P4=function(e,t){var i=Math.atan(t/e);return 0===e&&i<0&&(i*=-1),i},P5=function(e,t){return P4(t.x-e.x,t.y-e.y)},P6=function(e,t,i,r){var n=bb(0,r-.001,1),a=bb(0,r+.001,1);return P5(bv(e,t,i,n),bv(e,t,i,a))};P3.recalculateEdgeLabelProjections=function(e){var t,i=e._private,r=i.rscratch,n=this,a={mid:e.pstyle("label").strValue,source:e.pstyle("source-label").strValue,target:e.pstyle("target-label").strValue};if(a.mid||a.source||a.target){t={x:r.midX,y:r.midY};var s=function(e,t,r){yX(i.rscratch,e,t,r),yX(i.rstyle,e,t,r)};s("labelX",null,t.x),s("labelY",null,t.y),s("labelAutoAngle",null,P4(r.midDispX,r.midDispY));var o=function(){if(o.cache)return o.cache;for(var e=[],t=0;t+5<r.allpts.length;t+=4){var a={x:r.allpts[t],y:r.allpts[t+1]},s={x:r.allpts[t+2],y:r.allpts[t+3]},l={x:r.allpts[t+4],y:r.allpts[t+5]};e.push({p0:a,p1:s,p2:l,startDist:0,length:0,segments:[]})}var c=i.rstyle.bezierPts,u=n.bezierProjPcts.length;function h(e,t,i,r,n){var a=bf(t,i),s=e.segments[e.segments.length-1],o={p0:t,p1:i,t0:r,t1:n,startDist:s?s.startDist+s.length:0,length:a};e.segments.push(o),e.length+=a}for(var d=0;d<e.length;d++){var f=e[d],p=e[d-1];p&&(f.startDist=p.startDist+p.length),h(f,f.p0,c[d*u],0,n.bezierProjPcts[0]);for(var g=0;g<u-1;g++)h(f,c[d*u+g],c[d*u+g+1],n.bezierProjPcts[g],n.bezierProjPcts[g+1]);h(f,c[d*u+u-1],f.p2,n.bezierProjPcts[u-1],1)}return o.cache=e},l=function(i){var n="source"===i;if(a[i]){var l=e.pstyle(i+"-text-offset").pfValue;switch(r.edgeType){case"self":case"compound":case"bezier":case"multibezier":for(var c,u,h=o(),d=0,f=0,p=0;p<h.length;p++){for(var g=h[n?p:h.length-1-p],v=0;v<g.segments.length;v++){var y=g.segments[n?v:g.segments.length-1-v],b=p===h.length-1&&v===g.segments.length-1;if(d=f,(f+=y.length)>=l||b){u={cp:g,segment:y};break}}if(u)break}var x=u.cp,_=u.segment,w=(l-d)/_.length,k=_.t1-_.t0,E=n?_.t0+k*w:_.t1-k*w;E=bb(0,E,1),t=bv(x.p0,x.p1,x.p2,E),c=P6(x.p0,x.p1,x.p2,E);break;case"straight":case"segments":case"haystack":for(var T,P,S,M,C=0,A=r.allpts.length,I=0;I+3<A&&(n?(T={x:r.allpts[I],y:r.allpts[I+1]},P={x:r.allpts[I+2],y:r.allpts[I+3]}):(T={x:r.allpts[A-2-I],y:r.allpts[A-1-I]},P={x:r.allpts[A-4-I],y:r.allpts[A-3-I]}),S=bf(T,P),M=C,!((C+=S)>=l));I+=2);var L=(l-M)/S;t=by(T,P,L=bb(0,L,1)),c=P5(T,P)}s("labelX",i,t.x),s("labelY",i,t.y),s("labelAutoAngle",i,c)}};l("source"),l("target"),this.applyLabelDimensions(e)}},P3.applyLabelDimensions=function(e){this.applyPrefixedLabelDimensions(e),e.isEdge()&&(this.applyPrefixedLabelDimensions(e,"source"),this.applyPrefixedLabelDimensions(e,"target"))},P3.applyPrefixedLabelDimensions=function(e,t){var i=e._private,r=this.getLabelText(e,t),n=yP(r,e._private.labelDimsKey);if(yY(i.rscratch,"prefixedLabelDimsKey",t)!==n){yX(i.rscratch,"prefixedLabelDimsKey",t,n);var a=this.calculateLabelDimensions(e,r),s=e.pstyle("line-height").pfValue,o=e.pstyle("text-wrap").strValue,l=yY(i.rscratch,"labelWrapCachedLines",t)||[],c="wrap"!==o?1:Math.max(l.length,1),u=a.height/c,h=a.width,d=a.height+(c-1)*(s-1)*u;yX(i.rstyle,"labelWidth",t,h),yX(i.rscratch,"labelWidth",t,h),yX(i.rstyle,"labelHeight",t,d),yX(i.rscratch,"labelHeight",t,d),yX(i.rscratch,"labelLineHeight",t,u*s)}},P3.getLabelText=function(e,t){var i=e._private,r=t?t+"-":"",n=e.pstyle(r+"label").strValue,a=e.pstyle("text-transform").value,s=function(e,r){return r?(yX(i.rscratch,e,t,r),r):yY(i.rscratch,e,t)};if(!n)return"";"none"==a||("uppercase"==a?n=n.toUpperCase():"lowercase"==a&&(n=n.toLowerCase()));var o=e.pstyle("text-wrap").value;if("wrap"===o){var l=s("labelKey");if(null!=l&&s("labelWrapKey")===l)return s("labelWrapCachedText");for(var c=n.split("\n"),u=e.pstyle("text-max-width").pfValue,h="anywhere"===e.pstyle("text-overflow-wrap").value,d=[],f=/[\s\u200b]+|$/g,p=0;p<c.length;p++){var g=c[p],v=this.calculateLabelDimensions(e,g).width;if(h&&(g=g.split("").join("")),v>u){var y,b=g.matchAll(f),x="",_=0,w=vT(b);try{for(w.s();!(y=w.n()).done;){var k=y.value,E=k[0],T=g.substring(_,k.index);_=k.index+E.length;var P=0===x.length?T:x+T+E;this.calculateLabelDimensions(e,P).width<=u?x+=T+E:(x&&d.push(x),x=T+E)}}catch(e){w.e(e)}finally{w.f()}x.match(/^[\s\u200b]+$/)||d.push(x)}else d.push(g)}s("labelWrapCachedLines",d),n=s("labelWrapCachedText",d.join("\n")),s("labelWrapKey",l)}else if("ellipsis"===o){var S=e.pstyle("text-max-width").pfValue,M="",C=!1;if(this.calculateLabelDimensions(e,n).width<S)return n;for(var A=0;A<n.length&&!(this.calculateLabelDimensions(e,M+n[A]+"").width>S);A++)M+=n[A],A===n.length-1&&(C=!0);return C||(M+=""),M}return n},P3.getLabelJustification=function(e){var t=e.pstyle("text-justification").strValue,i=e.pstyle("text-halign").strValue;if("auto"!==t)return t;if(!e.isNode())return"center";switch(i){case"left":return"right";case"right":return"left";default:return"center"}},P3.calculateLabelDimensions=function(e,t){var i=this.cy.window().document,r=e.pstyle("font-style").strValue,n=e.pstyle("font-size").pfValue,a=e.pstyle("font-family").strValue,s=e.pstyle("font-weight").strValue,o=this.labelCalcCanvas,l=this.labelCalcCanvasContext;if(!o){o=this.labelCalcCanvas=i.createElement("canvas"),l=this.labelCalcCanvasContext=o.getContext("2d");var c=o.style;c.position="absolute",c.left="-9999px",c.top="-9999px",c.zIndex="-1",c.visibility="hidden",c.pointerEvents="none"}l.font="".concat(r," ").concat(s," ").concat(n,"px ").concat(a);for(var u=0,h=0,d=t.split("\n"),f=0;f<d.length;f++){var p=d[f];u=Math.max(Math.ceil(l.measureText(p).width),u),h+=n}return{width:u+=0,height:h+=0}},P3.calculateLabelAngle=function(e,t){var i=e._private.rscratch,r=e.isEdge(),n=e.pstyle((t?t+"-":"")+"text-rotation"),a=n.strValue;return"none"===a?0:r&&"autorotate"===a?i.labelAutoAngle:"autorotate"===a?0:n.pfValue},P3.calculateLabelAngles=function(e){var t=e.isEdge(),i=e._private.rscratch;i.labelAngle=this.calculateLabelAngle(e),t&&(i.sourceLabelAngle=this.calculateLabelAngle(e,"source"),i.targetLabelAngle=this.calculateLabelAngle(e,"target"))};var P8={},P9=!1;P8.getNodeShape=function(e){var t=e.pstyle("shape").value;if("cutrectangle"===t&&(28>e.width()||28>e.height()))return P9||(yF("The `cutrectangle` node shape can not be used at small sizes so `rectangle` is used instead"),P9=!0),"rectangle";if(e.isParent())if("rectangle"===t||"roundrectangle"===t||"round-rectangle"===t||"cutrectangle"===t||"cut-rectangle"===t||"barrel"===t)return t;else return"rectangle";if("polygon"===t){var i=e.pstyle("shape-polygon-points").value;return this.nodeShapes.makePolygon(i).name}return t};var P7={};P7.registerCalculationListeners=function(){var e=this.cy,t=e.collection(),i=this,r=function(e){var i=!(arguments.length>1)||void 0===arguments[1]||arguments[1];if(t.merge(e),i)for(var r=0;r<e.length;r++){var n=e[r]._private.rstyle;n.clean=!1,n.cleanConnected=!1}};i.binder(e).on("bounds.* dirty.*",function(e){r(e.target)}).on("style.* background.*",function(e){r(e.target,!1)});var n=function(n){if(n){var a=i.onUpdateEleCalcsFns;t.cleanStyle();for(var s=0;s<t.length;s++){var o=t[s],l=o._private.rstyle;o.isNode()&&!l.cleanConnected&&(r(o.connectedEdges()),l.cleanConnected=!0)}if(a)for(var c=0;c<a.length;c++)(0,a[c])(n,t);i.recalculateRenderedStyle(t),t=e.collection()}};i.flushRenderedStyleQueue=function(){n(!0)},i.beforeRender(n,i.beforeRenderPriorities.eleCalcs)},P7.onUpdateEleCalcs=function(e){(this.onUpdateEleCalcsFns=this.onUpdateEleCalcsFns||[]).push(e)},P7.recalculateRenderedStyle=function(e,t){var i=function(e){return e._private.rstyle.cleanConnected};if(0!==e.length){var r=[],n=[];if(!this.destroyed){void 0===t&&(t=!0);for(var a=0;a<e.length;a++){var s=e[a],o=s._private,l=o.rstyle;!s.isEdge()||i(s.source())&&i(s.target())||(l.clean=!1),s.isEdge()&&s.isBundledBezier()&&s.parallelEdges().some(function(e){return!e._private.rstyle.clean&&e.isBundledBezier()})&&(l.clean=!1),t&&l.clean||s.removed()||"none"!==s.pstyle("display").value&&("nodes"===o.group?n.push(s):r.push(s),l.clean=!0)}for(var c=0;c<n.length;c++){var u=n[c],h=u._private.rstyle,d=u.position();this.recalculateNodeLabelProjection(u),h.nodeX=d.x,h.nodeY=d.y,h.nodeW=u.pstyle("width").pfValue,h.nodeH=u.pstyle("height").pfValue}this.recalculateEdgeProjections(r);for(var f=0;f<r.length;f++){var p=r[f]._private,g=p.rstyle,v=p.rscratch;g.srcX=v.arrowStartX,g.srcY=v.arrowStartY,g.tgtX=v.arrowEndX,g.tgtY=v.arrowEndY,g.midX=v.midX,g.midY=v.midY,g.labelAngle=v.labelAngle,g.sourceLabelAngle=v.sourceLabelAngle,g.targetLabelAngle=v.targetLabelAngle}}}};var Se={};Se.updateCachedGrabbedEles=function(){var e=this.cachedZSortedEles;if(e){e.drag=[],e.nondrag=[];for(var t=[],i=0;i<e.length;i++){var r=e[i],n=r._private.rscratch;r.grabbed()&&!r.isParent()?t.push(r):n.inDragLayer?e.drag.push(r):e.nondrag.push(r)}for(var i=0;i<t.length;i++){var r=t[i];e.drag.push(r)}}},Se.invalidateCachedZSortedEles=function(){this.cachedZSortedEles=null},Se.getCachedZSortedEles=function(e){if(e||!this.cachedZSortedEles){var t=this.cy.mutableElements().toArray();t.sort(wE),t.interactive=t.filter(function(e){return e.interactive()}),this.cachedZSortedEles=t,this.updateCachedGrabbedEles()}else t=this.cachedZSortedEles;return t};var St={};[k3,k4,PQ,P1,P2,P3,P8,P7,Se].forEach(function(e){ye(St,e)});var Si={};Si.getCachedImage=function(e,t,i){var r=this.imageCache=this.imageCache||{},n=r[e];if(n)return n.image.complete||n.image.addEventListener("load",i),n.image;var a=(n=r[e]=r[e]||{}).image=new Image;a.addEventListener("load",i),a.addEventListener("error",function(){a.error=!0});var s="data:";return e.substring(0,s.length).toLowerCase()!==s&&(a.crossOrigin=t="null"===t?null:t),a.src=e,a};var Sr={};Sr.registerBinding=function(e,t,i,r){var n=Array.prototype.slice.apply(arguments,[1]);if(Array.isArray(e)){for(var a=[],s=0;s<e.length;s++){var o=e[s];if(void 0!==o){var l=this.binder(o);a.push(l.on.apply(l,n))}}return a}var l=this.binder(e);return l.on.apply(l,n)},Sr.binder=function(e){var t=this,i=t.cy.window(),r=e===i||e===i.document||e===i.document.body||"undefined"!=typeof HTMLElement&&e instanceof HTMLElement;if(null==t.supportsPassiveEvents){var n=!1;try{var a=Object.defineProperty({},"passive",{get:function(){return n=!0,!0}});i.addEventListener("test",null,a)}catch(e){}t.supportsPassiveEvents=n}var s=function(i,n,a){var s=Array.prototype.slice.call(arguments);return r&&t.supportsPassiveEvents&&(s[2]={capture:null!=a&&a,passive:!1,once:!1}),t.bindings.push({target:e,args:s}),(e.addEventListener||e.on).apply(e,s),this};return{on:s,addEventListener:s,addListener:s,bind:s}},Sr.nodeIsDraggable=function(e){return e&&e.isNode()&&!e.locked()&&e.grabbable()},Sr.nodeIsGrabbable=function(e){return this.nodeIsDraggable(e)&&e.interactive()},Sr.load=function(){var e,t,i,r,n,a,s,o,l,c,u,h,d,f,p,g,v,y,b,x,_,w,k,E,T,P=this,S=P.cy.window(),M=function(e){return e.selected()},C=function(e,t,i,r){null==e&&(e=P.cy);for(var n=0;n<t.length;n++){var a=t[n];e.emit({originalEvent:i,type:a,position:r})}},A=function(e){return e.shiftKey||e.metaKey||e.ctrlKey},I=function(e,t){var i=!0;if(P.cy.hasCompoundNodes()&&e&&e.pannable())for(var r=0;t&&r<t.length;r++){var e=t[r];if(e.isNode()&&e.isParent()&&!e.pannable()){i=!1;break}}else i=!0;return i},L=function(e){e[0]._private.grabbed=!0},D=function(e){e[0]._private.grabbed=!1},O=function(e){e[0]._private.rscratch.inDragLayer=!0},R=function(e){e[0]._private.rscratch.inDragLayer=!1},N=function(e){e[0]._private.rscratch.isGrabTarget=!0},j=function(e){e[0]._private.rscratch.isGrabTarget=!1},B=function(e,t){var i=t.addToList;!i.has(e)&&e.grabbable()&&!e.locked()&&(i.merge(e),L(e))},F=function(e,t){if(e.cy().hasCompoundNodes()&&(null!=t.inDragLayer||null!=t.addToList)){var i=e.descendants();t.inDragLayer&&(i.forEach(O),i.connectedEdges().forEach(O)),t.addToList&&B(i,t)}},z=function(e,t){t=t||{};var i=e.cy().hasCompoundNodes();t.inDragLayer&&(e.forEach(O),e.neighborhood().stdFilter(function(e){return!i||e.isEdge()}).forEach(O)),t.addToList&&e.forEach(function(e){B(e,t)}),F(e,t),U(e,{inDragLayer:t.inDragLayer}),P.updateCachedGrabbedEles()},V=function(e){e&&(P.getCachedZSortedEles().forEach(function(e){D(e),R(e),j(e)}),P.updateCachedGrabbedEles())},U=function(e,t){if((null!=t.inDragLayer||null!=t.addToList)&&e.cy().hasCompoundNodes()){var i=e.ancestors().orphans();if(!i.same(e)){var r=i.descendants().spawnSelf().merge(i).unmerge(e).unmerge(e.descendants()),n=r.connectedEdges();t.inDragLayer&&(n.forEach(O),r.forEach(O)),t.addToList&&r.forEach(function(e){B(e,t)})}}},$=function(){null!=document.activeElement&&null!=document.activeElement.blur&&document.activeElement.blur()},W="undefined"!=typeof MutationObserver,H="undefined"!=typeof ResizeObserver;W?(P.removeObserver=new MutationObserver(function(e){for(var t=0;t<e.length;t++){var i=e[t].removedNodes;if(i){for(var r=0;r<i.length;r++)if(i[r]===P.container){P.destroy();break}}}}),P.container.parentNode&&P.removeObserver.observe(P.container.parentNode,{childList:!0})):P.registerBinding(P.container,"DOMNodeRemoved",function(e){P.destroy()});var q=yg(function(){P.cy.resize()},100);W&&(P.styleObserver=new MutationObserver(q),P.styleObserver.observe(P.container,{attributes:!0})),P.registerBinding(S,"resize",q),H&&(P.resizeObserver=new ResizeObserver(q),P.resizeObserver.observe(P.container));for(var G=function(){P.invalidateContainerClientCoordsCache()},Y=P.container;null!=Y;){e=Y,P.registerBinding(e,"transitionend",G),P.registerBinding(e,"animationend",G),P.registerBinding(e,"scroll",G),Y=Y.parentNode}P.registerBinding(P.container,"contextmenu",function(e){e.preventDefault()});var X=function(e){for(var t=P.findContainerClientCoords(),i=t[0],r=t[1],n=t[2],a=t[3],s=e.touches?e.touches:[e],o=!1,l=0;l<s.length;l++){var c=s[l];if(i<=c.clientX&&c.clientX<=i+n&&r<=c.clientY&&c.clientY<=r+a){o=!0;break}}if(!o)return!1;for(var u=P.container,h=e.target.parentNode,d=!1;h;){if(h===u){d=!0;break}h=h.parentNode}return!!d};P.registerBinding(P.container,"mousedown",function(e){if(X(e)&&(1!==P.hoverData.which||1===e.which)){e.preventDefault(),$(),P.hoverData.capture=!0,P.hoverData.which=e.which;var t=P.cy,i=[e.clientX,e.clientY],r=P.projectIntoViewport(i[0],i[1]),n=P.selection,a=P.findNearestElements(r[0],r[1],!0,!1),s=a[0],o=P.dragData.possibleDragElements;P.hoverData.mdownPos=r,P.hoverData.mdownGPos=i;var l=function(t){return{originalEvent:e,type:t,position:{x:r[0],y:r[1]}}};if(3==e.which){P.hoverData.cxtStarted=!0;var c={originalEvent:e,type:"cxttapstart",position:{x:r[0],y:r[1]}};s?(s.activate(),s.emit(c),P.hoverData.down=s):t.emit(c),P.hoverData.downTime=new Date().getTime(),P.hoverData.cxtDragged=!1}else if(1==e.which){if(s&&s.activate(),null!=s&&P.nodeIsGrabbable(s)){if(N(s),s.selected()){o=P.dragData.possibleDragElements=t.collection();var u=t.$(function(e){return e.isNode()&&e.selected()&&P.nodeIsGrabbable(e)});z(u,{addToList:o}),s.emit(l("grabon")),u.forEach(function(e){e.emit(l("grab"))})}else z(s,{addToList:o=P.dragData.possibleDragElements=t.collection()}),s.emit(l("grabon")).emit(l("grab"));P.redrawHint("eles",!0),P.redrawHint("drag",!0)}P.hoverData.down=s,P.hoverData.downs=a,P.hoverData.downTime=new Date().getTime(),C(s,["mousedown","tapstart","vmousedown"],e,{x:r[0],y:r[1]}),null==s?(n[4]=1,P.data.bgActivePosistion={x:r[0],y:r[1]},P.redrawHint("select",!0),P.redraw()):s.pannable()&&(n[4]=1),P.hoverData.tapholdCancelled=!1,clearTimeout(P.hoverData.tapholdTimeout),P.hoverData.tapholdTimeout=setTimeout(function(){if(!P.hoverData.tapholdCancelled){var e=P.hoverData.down;e?e.emit(l("taphold")):t.emit(l("taphold"))}},P.tapholdDuration)}n[0]=n[2]=r[0],n[1]=n[3]=r[1]}},!1);var K=function(e){var t=e.getRootNode();if(t&&11===t.nodeType&&void 0!==t.host)return t}(P.container);P.registerBinding([S,K],"mousemove",function(e){var t,i;if(P.hoverData.capture||X(e)){var r=!1,n=P.cy,a=n.zoom(),s=[e.clientX,e.clientY],o=P.projectIntoViewport(s[0],s[1]),l=P.hoverData.mdownPos,c=P.hoverData.mdownGPos,u=P.selection,h=null;P.hoverData.draggingEles||P.hoverData.dragging||P.hoverData.selecting||(h=P.findNearestElement(o[0],o[1],!0,!1));var d=P.hoverData.last,f=P.hoverData.down,p=[o[0]-u[2],o[1]-u[3]],g=P.dragData.possibleDragElements;if(c){var v=s[0]-c[0],y=s[1]-c[1];P.hoverData.isOverThresholdDrag=t=v*v+y*y>=P.desktopTapThreshold2}var b=A(e);t&&(P.hoverData.tapholdCancelled=!0),r=!0,C(h,["mousemove","vmousemove","tapdrag"],e,{x:o[0],y:o[1]});var x=function(t){return{originalEvent:e,type:t,position:{x:o[0],y:o[1]}}},_=function(){P.data.bgActivePosistion=void 0,P.hoverData.selecting||n.emit(x("boxstart")),u[4]=1,P.hoverData.selecting=!0,P.redrawHint("select",!0),P.redraw()};if(3===P.hoverData.which){if(t){var w=x("cxtdrag");f?f.emit(w):n.emit(w),P.hoverData.cxtDragged=!0,(!P.hoverData.cxtOver||h!==P.hoverData.cxtOver)&&(P.hoverData.cxtOver&&P.hoverData.cxtOver.emit(x("cxtdragout")),P.hoverData.cxtOver=h,h&&h.emit(x("cxtdragover")))}}else if(P.hoverData.dragging){if(r=!0,n.panningEnabled()&&n.userPanningEnabled()){if(P.hoverData.justStartedPan){var k=P.hoverData.mdownPos;i={x:(o[0]-k[0])*a,y:(o[1]-k[1])*a},P.hoverData.justStartedPan=!1}else i={x:p[0]*a,y:p[1]*a};n.panBy(i),n.emit(x("dragpan")),P.hoverData.dragged=!0}o=P.projectIntoViewport(e.clientX,e.clientY)}else if(1==u[4]&&(null==f||f.pannable()))t&&(!P.hoverData.dragging&&n.boxSelectionEnabled()&&(b||!n.panningEnabled()||!n.userPanningEnabled())?_():!P.hoverData.selecting&&n.panningEnabled()&&n.userPanningEnabled()&&I(f,P.hoverData.downs)&&(P.hoverData.dragging=!0,P.hoverData.justStartedPan=!0,u[4]=0,P.data.bgActivePosistion=ba(l),P.redrawHint("select",!0),P.redraw()),f&&f.pannable()&&f.active()&&f.unactivate());else{if(f&&f.pannable()&&f.active()&&f.unactivate(),f&&f.grabbed()||h==d||(d&&C(d,["mouseout","tapdragout"],e,{x:o[0],y:o[1]}),h&&C(h,["mouseover","tapdragover"],e,{x:o[0],y:o[1]}),P.hoverData.last=h),f)if(t){if(n.boxSelectionEnabled()&&b)f&&f.grabbed()&&(V(g),f.emit(x("freeon")),g.emit(x("free")),P.dragData.didDrag&&(f.emit(x("dragfreeon")),g.emit(x("dragfree")))),_();else if(f&&f.grabbed()&&P.nodeIsDraggable(f)){var E,T=!P.dragData.didDrag;T&&P.redrawHint("eles",!0),P.dragData.didDrag=!0,P.hoverData.draggingEles||z(g,{inDragLayer:!0});var S={x:0,y:0};if(v$(p[0])&&v$(p[1])&&(S.x+=p[0],S.y+=p[1],T)){var M=P.hoverData.dragDelta;M&&v$(M[0])&&v$(M[1])&&(S.x+=M[0],S.y+=M[1])}P.hoverData.draggingEles=!0,g.silentShift(S).emit(x("position")).emit(x("drag")),P.redrawHint("drag",!0),P.redraw()}}else 0===(E=P.hoverData.dragDelta=P.hoverData.dragDelta||[]).length?(E.push(p[0]),E.push(p[1])):(E[0]+=p[0],E[1]+=p[1]);r=!0}if(u[2]=o[0],u[3]=o[1],r)return e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),!1}},!1),P.registerBinding(S,"mouseup",function(e){if((1!==P.hoverData.which||1===e.which||!P.hoverData.capture)&&P.hoverData.capture){P.hoverData.capture=!1;var n=P.cy,a=P.projectIntoViewport(e.clientX,e.clientY),s=P.selection,o=P.findNearestElement(a[0],a[1],!0,!1),l=P.dragData.possibleDragElements,c=P.hoverData.down,u=A(e);P.data.bgActivePosistion&&(P.redrawHint("select",!0),P.redraw()),P.hoverData.tapholdCancelled=!0,P.data.bgActivePosistion=void 0,c&&c.unactivate();var h=function(t){return{originalEvent:e,type:t,position:{x:a[0],y:a[1]}}};if(3===P.hoverData.which){var d=h("cxttapend");if(c?c.emit(d):n.emit(d),!P.hoverData.cxtDragged){var f=h("cxttap");c?c.emit(f):n.emit(f)}P.hoverData.cxtDragged=!1,P.hoverData.which=null}else if(1===P.hoverData.which){if(C(o,["mouseup","tapend","vmouseup"],e,{x:a[0],y:a[1]}),P.dragData.didDrag||P.hoverData.dragged||P.hoverData.selecting||P.hoverData.isOverThresholdDrag||(C(c,["click","tap","vclick"],e,{x:a[0],y:a[1]}),i=!1,e.timeStamp-r<=n.multiClickDebounceTime()?(t&&clearTimeout(t),i=!0,r=null,C(c,["dblclick","dbltap","vdblclick"],e,{x:a[0],y:a[1]})):(t=setTimeout(function(){i||C(c,["oneclick","onetap","voneclick"],e,{x:a[0],y:a[1]})},n.multiClickDebounceTime()),r=e.timeStamp)),null!=c||P.dragData.didDrag||P.hoverData.selecting||P.hoverData.dragged||A(e)||(n.$(M).unselect(["tapunselect"]),l.length>0&&P.redrawHint("eles",!0),P.dragData.possibleDragElements=l=n.collection()),o!=c||P.dragData.didDrag||P.hoverData.selecting||null==o||!o._private.selectable||(P.hoverData.dragging||("additive"===n.selectionType()||u?o.selected()?o.unselect(["tapunselect"]):o.select(["tapselect"]):u||(n.$(M).unmerge(o).unselect(["tapunselect"]),o.select(["tapselect"]))),P.redrawHint("eles",!0)),P.hoverData.selecting){var p=n.collection(P.getAllInBox(s[0],s[1],s[2],s[3]));P.redrawHint("select",!0),p.length>0&&P.redrawHint("eles",!0),n.emit(h("boxend"));"additive"===n.selectionType()||u||n.$(M).unmerge(p).unselect(),p.emit(h("box")).stdFilter(function(e){return e.selectable()&&!e.selected()}).select().emit(h("boxselect")),P.redraw()}if(P.hoverData.dragging&&(P.hoverData.dragging=!1,P.redrawHint("select",!0),P.redrawHint("eles",!0),P.redraw()),!s[4]){P.redrawHint("drag",!0),P.redrawHint("eles",!0);var g=c&&c.grabbed();V(l),g&&(c.emit(h("freeon")),l.emit(h("free")),P.dragData.didDrag&&(c.emit(h("dragfreeon")),l.emit(h("dragfree"))))}}s[4]=0,P.hoverData.down=null,P.hoverData.cxtStarted=!1,P.hoverData.draggingEles=!1,P.hoverData.selecting=!1,P.hoverData.isOverThresholdDrag=!1,P.dragData.didDrag=!1,P.hoverData.dragged=!1,P.hoverData.dragDelta=[],P.hoverData.mdownPos=null,P.hoverData.mdownGPos=null,P.hoverData.which=null}},!1);var Z=[],J=1e5,Q=function(e,t){for(var i=0;i<e.length;i++)if(e[i]%t!=0)return!1;return!0},ee=function(e){for(var t=Math.abs(e[0]),i=1;i<e.length;i++)if(Math.abs(e[i])!==t)return!1;return!0},et=function(e){var t=!1,i=e.deltaY;if(null==i&&(null!=e.wheelDeltaY?i=e.wheelDeltaY/4:null!=e.wheelDelta&&(i=e.wheelDelta/4)),0!==i){if(null==n)if(Z.length>=4){if(!(n=Q(Z,5))){var r=Math.abs(Z[0]);n=ee(Z)&&r>5}if(n)for(var a=0;a<Z.length;a++)J=Math.min(Math.abs(Z[a]),J)}else Z.push(i),t=!0;else n&&(J=Math.min(Math.abs(i),J));if(!P.scrollingPage){var s=P.cy,o=s.zoom(),l=s.pan(),c=P.projectIntoViewport(e.clientX,e.clientY),u=[c[0]*o+l.x,c[1]*o+l.y];if(P.hoverData.draggingEles||P.hoverData.dragging||P.hoverData.cxtStarted||0!==P.selection[4])return void e.preventDefault();if(s.panningEnabled()&&s.userPanningEnabled()&&s.zoomingEnabled()&&s.userZoomingEnabled()){e.preventDefault(),P.data.wheelZooming=!0,clearTimeout(P.data.wheelTimeout),P.data.wheelTimeout=setTimeout(function(){P.data.wheelZooming=!1,P.redrawHint("eles",!0),P.redraw()},150),t&&Math.abs(i)>5&&(i=5*bd(i)),h=-(i/250),n&&(h/=J,h*=3),h*=P.wheelSensitivity,1===e.deltaMode&&(h*=33);var h,d=s.zoom()*Math.pow(10,h);"gesturechange"===e.type&&(d=P.gestureStartZoom*e.scale),s.zoom({level:d,renderedPosition:{x:u[0],y:u[1]}}),s.emit({type:"gesturechange"===e.type?"pinchzoom":"scrollzoom",originalEvent:e,position:{x:c[0],y:c[1]}})}}}};P.registerBinding(P.container,"wheel",et,!0),P.registerBinding(S,"scroll",function(e){P.scrollingPage=!0,clearTimeout(P.scrollingPageTimeout),P.scrollingPageTimeout=setTimeout(function(){P.scrollingPage=!1},250)},!0),P.registerBinding(P.container,"gesturestart",function(e){P.gestureStartZoom=P.cy.zoom(),P.hasTouchStarted||e.preventDefault()},!0),P.registerBinding(P.container,"gesturechange",function(e){P.hasTouchStarted||et(e)},!0),P.registerBinding(P.container,"mouseout",function(e){var t=P.projectIntoViewport(e.clientX,e.clientY);P.cy.emit({originalEvent:e,type:"mouseout",position:{x:t[0],y:t[1]}})},!1),P.registerBinding(P.container,"mouseover",function(e){var t=P.projectIntoViewport(e.clientX,e.clientY);P.cy.emit({originalEvent:e,type:"mouseover",position:{x:t[0],y:t[1]}})},!1);var ei=function(e,t,i,r){return Math.sqrt((i-e)*(i-e)+(r-t)*(r-t))},er=function(e,t,i,r){return(i-e)*(i-e)+(r-t)*(r-t)};if(P.registerBinding(P.container,"touchstart",b=function(e){if(P.hasTouchStarted=!0,X(e)){$(),P.touchData.capture=!0,P.data.bgActivePosistion=void 0;var t=P.cy,i=P.touchData.now,r=P.touchData.earlier;if(e.touches[0]){var n=P.projectIntoViewport(e.touches[0].clientX,e.touches[0].clientY);i[0]=n[0],i[1]=n[1]}if(e.touches[1]){var n=P.projectIntoViewport(e.touches[1].clientX,e.touches[1].clientY);i[2]=n[0],i[3]=n[1]}if(e.touches[2]){var n=P.projectIntoViewport(e.touches[2].clientX,e.touches[2].clientY);i[4]=n[0],i[5]=n[1]}var b=function(t){return{originalEvent:e,type:t,position:{x:i[0],y:i[1]}}};if(e.touches[1]){P.touchData.singleTouchMoved=!0,V(P.dragData.touchDragEles);var x=P.findContainerClientCoords();f=x[0],p=x[1],g=x[2],v=x[3],a=e.touches[0].clientX-f,s=e.touches[0].clientY-p,o=e.touches[1].clientX-f,l=e.touches[1].clientY-p,y=0<=a&&a<=g&&0<=o&&o<=g&&0<=s&&s<=v&&0<=l&&l<=v;var _=t.pan(),w=t.zoom();if(c=ei(a,s,o,l),u=er(a,s,o,l),d=[((h=[(a+o)/2,(s+l)/2])[0]-_.x)/w,(h[1]-_.y)/w],u<4e4&&!e.touches[2]){var k=P.findNearestElement(i[0],i[1],!0,!0),E=P.findNearestElement(i[2],i[3],!0,!0);k&&k.isNode()?(k.activate().emit(b("cxttapstart")),P.touchData.start=k):E&&E.isNode()?(E.activate().emit(b("cxttapstart")),P.touchData.start=E):t.emit(b("cxttapstart")),P.touchData.start&&(P.touchData.start._private.grabbed=!1),P.touchData.cxt=!0,P.touchData.cxtDragged=!1,P.data.bgActivePosistion=void 0,P.redraw();return}}if(e.touches[2])t.boxSelectionEnabled()&&e.preventDefault();else if(e.touches[1]);else if(e.touches[0]){var T=P.findNearestElements(i[0],i[1],!0,!0),S=T[0];if(null!=S&&(S.activate(),P.touchData.start=S,P.touchData.starts=T,P.nodeIsGrabbable(S))){var M=P.dragData.touchDragEles=t.collection(),A=null;P.redrawHint("eles",!0),P.redrawHint("drag",!0),S.selected()?z(A=t.$(function(e){return e.selected()&&P.nodeIsGrabbable(e)}),{addToList:M}):z(S,{addToList:M}),N(S),S.emit(b("grabon")),A?A.forEach(function(e){e.emit(b("grab"))}):S.emit(b("grab"))}C(S,["touchstart","tapstart","vmousedown"],e,{x:i[0],y:i[1]}),null==S&&(P.data.bgActivePosistion={x:n[0],y:n[1]},P.redrawHint("select",!0),P.redraw()),P.touchData.singleTouchMoved=!1,P.touchData.singleTouchStartTime=+new Date,clearTimeout(P.touchData.tapholdTimeout),P.touchData.tapholdTimeout=setTimeout(function(){!1!==P.touchData.singleTouchMoved||P.pinching||P.touchData.selecting||C(P.touchData.start,["taphold"],e,{x:i[0],y:i[1]})},P.tapholdDuration)}if(e.touches.length>=1){for(var I=P.touchData.startPosition=[null,null,null,null,null,null],L=0;L<i.length;L++)I[L]=r[L]=i[L];var D=e.touches[0];P.touchData.startGPosition=[D.clientX,D.clientY]}}},!1),P.registerBinding(S,"touchmove",x=function(e){var t=P.touchData.capture;if(t||X(e)){var i=P.selection,r=P.cy,n=P.touchData.now,h=P.touchData.earlier,g=r.zoom();if(e.touches[0]){var v=P.projectIntoViewport(e.touches[0].clientX,e.touches[0].clientY);n[0]=v[0],n[1]=v[1]}if(e.touches[1]){var v=P.projectIntoViewport(e.touches[1].clientX,e.touches[1].clientY);n[2]=v[0],n[3]=v[1]}if(e.touches[2]){var v=P.projectIntoViewport(e.touches[2].clientX,e.touches[2].clientY);n[4]=v[0],n[5]=v[1]}var b=function(t){return{originalEvent:e,type:t,position:{x:n[0],y:n[1]}}},x=P.touchData.startGPosition;if(t&&e.touches[0]&&x){for(var _=[],w=0;w<n.length;w++)_[w]=n[w]-h[w];var k=e.touches[0].clientX-x[0],E=k*k,T=e.touches[0].clientY-x[1];et=E+T*T>=P.touchTapThreshold2}if(t&&P.touchData.cxt){e.preventDefault();var S=e.touches[0].clientX-f,M=e.touches[0].clientY-p,A=e.touches[1].clientX-f,L=e.touches[1].clientY-p,D=er(S,M,A,L);if(D/u>=2.25||D>=22500){P.touchData.cxt=!1,P.data.bgActivePosistion=void 0,P.redrawHint("select",!0);var O=b("cxttapend");P.touchData.start?(P.touchData.start.unactivate().emit(O),P.touchData.start=null):r.emit(O)}}if(t&&P.touchData.cxt){var O=b("cxtdrag");P.data.bgActivePosistion=void 0,P.redrawHint("select",!0),P.touchData.start?P.touchData.start.emit(O):r.emit(O),P.touchData.start&&(P.touchData.start._private.grabbed=!1),P.touchData.cxtDragged=!0;var R=P.findNearestElement(n[0],n[1],!0,!0);(!P.touchData.cxtOver||R!==P.touchData.cxtOver)&&(P.touchData.cxtOver&&P.touchData.cxtOver.emit(b("cxtdragout")),P.touchData.cxtOver=R,R&&R.emit(b("cxtdragover")))}else if(t&&e.touches[2]&&r.boxSelectionEnabled())e.preventDefault(),P.data.bgActivePosistion=void 0,this.lastThreeTouch=+new Date,P.touchData.selecting||r.emit(b("boxstart")),P.touchData.selecting=!0,P.touchData.didSelect=!0,i[4]=1,i&&0!==i.length&&void 0!==i[0]?(i[2]=(n[0]+n[2]+n[4])/3,i[3]=(n[1]+n[3]+n[5])/3):(i[0]=(n[0]+n[2]+n[4])/3,i[1]=(n[1]+n[3]+n[5])/3,i[2]=(n[0]+n[2]+n[4])/3+1,i[3]=(n[1]+n[3]+n[5])/3+1),P.redrawHint("select",!0),P.redraw();else if(t&&e.touches[1]&&!P.touchData.didSelect&&r.zoomingEnabled()&&r.panningEnabled()&&r.userZoomingEnabled()&&r.userPanningEnabled()){e.preventDefault(),P.data.bgActivePosistion=void 0,P.redrawHint("select",!0);var N=P.dragData.touchDragEles;if(N){P.redrawHint("drag",!0);for(var j=0;j<N.length;j++){var B=N[j]._private;B.grabbed=!1,B.rscratch.inDragLayer=!1}}var F=P.touchData.start,S=e.touches[0].clientX-f,M=e.touches[0].clientY-p,A=e.touches[1].clientX-f,L=e.touches[1].clientY-p,U=ei(S,M,A,L),$=U/c;if(y){var W=S-a,H=M-s,q=A-o,G=L-l,Y=r.zoom(),K=Y*$,Z=r.pan(),J=d[0]*Y+Z.x,Q=d[1]*Y+Z.y,ee={x:-K/Y*(J-Z.x-(W+q)/2)+J,y:-K/Y*(Q-Z.y-(H+G)/2)+Q};if(F&&F.active()){var N=P.dragData.touchDragEles;V(N),P.redrawHint("drag",!0),P.redrawHint("eles",!0),F.unactivate().emit(b("freeon")),N.emit(b("free")),P.dragData.didDrag&&(F.emit(b("dragfreeon")),N.emit(b("dragfree")))}r.viewport({zoom:K,pan:ee,cancelOnFailedZoom:!0}),r.emit(b("pinchzoom")),c=U,a=S,s=M,o=A,l=L,P.pinching=!0}if(e.touches[0]){var v=P.projectIntoViewport(e.touches[0].clientX,e.touches[0].clientY);n[0]=v[0],n[1]=v[1]}if(e.touches[1]){var v=P.projectIntoViewport(e.touches[1].clientX,e.touches[1].clientY);n[2]=v[0],n[3]=v[1]}if(e.touches[2]){var v=P.projectIntoViewport(e.touches[2].clientX,e.touches[2].clientY);n[4]=v[0],n[5]=v[1]}}else if(e.touches[0]&&!P.touchData.didSelect){var et,R,en=P.touchData.start,ea=P.touchData.last;if(P.hoverData.draggingEles||P.swipePanning||(R=P.findNearestElement(n[0],n[1],!0,!0)),t&&null!=en&&e.preventDefault(),t&&null!=en&&P.nodeIsDraggable(en))if(et){var N=P.dragData.touchDragEles,es=!P.dragData.didDrag;es&&z(N,{inDragLayer:!0}),P.dragData.didDrag=!0;var eo={x:0,y:0};if(v$(_[0])&&v$(_[1])&&(eo.x+=_[0],eo.y+=_[1],es)){P.redrawHint("eles",!0);var el=P.touchData.dragDelta;el&&v$(el[0])&&v$(el[1])&&(eo.x+=el[0],eo.y+=el[1])}P.hoverData.draggingEles=!0,N.silentShift(eo).emit(b("position")).emit(b("drag")),P.redrawHint("drag",!0),P.touchData.startPosition[0]==h[0]&&P.touchData.startPosition[1]==h[1]&&P.redrawHint("eles",!0),P.redraw()}else{var el=P.touchData.dragDelta=P.touchData.dragDelta||[];0===el.length?(el.push(_[0]),el.push(_[1])):(el[0]+=_[0],el[1]+=_[1])}if(C(en||R,["touchmove","tapdrag","vmousemove"],e,{x:n[0],y:n[1]}),en&&en.grabbed()||R==ea||(ea&&ea.emit(b("tapdragout")),R&&R.emit(b("tapdragover"))),P.touchData.last=R,t)for(var j=0;j<n.length;j++)n[j]&&P.touchData.startPosition[j]&&et&&(P.touchData.singleTouchMoved=!0);if(t&&(null==en||en.pannable())&&r.panningEnabled()&&r.userPanningEnabled()){I(en,P.touchData.starts)&&(e.preventDefault(),P.data.bgActivePosistion||(P.data.bgActivePosistion=ba(P.touchData.startPosition)),P.swipePanning?(r.panBy({x:_[0]*g,y:_[1]*g}),r.emit(b("dragpan"))):et&&(P.swipePanning=!0,r.panBy({x:k*g,y:T*g}),r.emit(b("dragpan")),en&&(en.unactivate(),P.redrawHint("select",!0),P.touchData.start=null)));var v=P.projectIntoViewport(e.touches[0].clientX,e.touches[0].clientY);n[0]=v[0],n[1]=v[1]}}for(var w=0;w<n.length;w++)h[w]=n[w];t&&e.touches.length>0&&!P.hoverData.draggingEles&&!P.swipePanning&&null!=P.data.bgActivePosistion&&(P.data.bgActivePosistion=void 0,P.redrawHint("select",!0),P.redraw())}},!1),P.registerBinding(S,"touchcancel",_=function(e){var t=P.touchData.start;P.touchData.capture=!1,t&&t.unactivate()}),P.registerBinding(S,"touchend",w=function(e){var t,i=P.touchData.start;if(P.touchData.capture){0===e.touches.length&&(P.touchData.capture=!1),e.preventDefault();var r=P.selection;P.swipePanning=!1,P.hoverData.draggingEles=!1;var n=P.cy,a=n.zoom(),s=P.touchData.now,o=P.touchData.earlier;if(e.touches[0]){var l=P.projectIntoViewport(e.touches[0].clientX,e.touches[0].clientY);s[0]=l[0],s[1]=l[1]}if(e.touches[1]){var l=P.projectIntoViewport(e.touches[1].clientX,e.touches[1].clientY);s[2]=l[0],s[3]=l[1]}if(e.touches[2]){var l=P.projectIntoViewport(e.touches[2].clientX,e.touches[2].clientY);s[4]=l[0],s[5]=l[1]}var c=function(t){return{originalEvent:e,type:t,position:{x:s[0],y:s[1]}}};if(i&&i.unactivate(),P.touchData.cxt){if(t=c("cxttapend"),i?i.emit(t):n.emit(t),!P.touchData.cxtDragged){var u=c("cxttap");i?i.emit(u):n.emit(u)}P.touchData.start&&(P.touchData.start._private.grabbed=!1),P.touchData.cxt=!1,P.touchData.start=null,P.redraw();return}if(!e.touches[2]&&n.boxSelectionEnabled()&&P.touchData.selecting){P.touchData.selecting=!1;var h=n.collection(P.getAllInBox(r[0],r[1],r[2],r[3]));r[0]=void 0,r[1]=void 0,r[2]=void 0,r[3]=void 0,r[4]=0,P.redrawHint("select",!0),n.emit(c("boxend")),h.emit(c("box")).stdFilter(function(e){return e.selectable()&&!e.selected()}).select().emit(c("boxselect")),h.nonempty()&&P.redrawHint("eles",!0),P.redraw()}if(null!=i&&i.unactivate(),e.touches[2])P.data.bgActivePosistion=void 0,P.redrawHint("select",!0);else if(e.touches[1]);else if(e.touches[0]);else if(!e.touches[0]){P.data.bgActivePosistion=void 0,P.redrawHint("select",!0);var d=P.dragData.touchDragEles;if(null!=i){var f=i._private.grabbed;V(d),P.redrawHint("drag",!0),P.redrawHint("eles",!0),f&&(i.emit(c("freeon")),d.emit(c("free")),P.dragData.didDrag&&(i.emit(c("dragfreeon")),d.emit(c("dragfree")))),C(i,["touchend","tapend","vmouseup","tapdragout"],e,{x:s[0],y:s[1]}),i.unactivate(),P.touchData.start=null}else C(P.findNearestElement(s[0],s[1],!0,!0),["touchend","tapend","vmouseup","tapdragout"],e,{x:s[0],y:s[1]});var p=P.touchData.startPosition[0]-s[0],g=P.touchData.startPosition[1]-s[1];P.touchData.singleTouchMoved||(i||n.$(":selected").unselect(["tapunselect"]),C(i,["tap","vclick"],e,{x:s[0],y:s[1]}),k=!1,e.timeStamp-T<=n.multiClickDebounceTime()?(E&&clearTimeout(E),k=!0,T=null,C(i,["dbltap","vdblclick"],e,{x:s[0],y:s[1]})):(E=setTimeout(function(){k||C(i,["onetap","voneclick"],e,{x:s[0],y:s[1]})},n.multiClickDebounceTime()),T=e.timeStamp)),null!=i&&!P.dragData.didDrag&&i._private.selectable&&(p*p+g*g)*a*a<P.touchTapThreshold2&&!P.pinching&&("single"===n.selectionType()?(n.$(M).unmerge(i).unselect(["tapunselect"]),i.select(["tapselect"])):i.selected()?i.unselect(["tapunselect"]):i.select(["tapselect"]),P.redrawHint("eles",!0)),P.touchData.singleTouchMoved=!0}for(var v=0;v<s.length;v++)o[v]=s[v];P.dragData.didDrag=!1,0===e.touches.length&&(P.touchData.dragDelta=[],P.touchData.startPosition=[null,null,null,null,null,null],P.touchData.startGPosition=null,P.touchData.didSelect=!1),e.touches.length<2&&(1===e.touches.length&&(P.touchData.startGPosition=[e.touches[0].clientX,e.touches[0].clientY]),P.pinching=!1,P.redrawHint("eles",!0),P.redraw())}},!1),"undefined"==typeof TouchEvent){var en=[],ea=function(e){return{clientX:e.clientX,clientY:e.clientY,force:1,identifier:e.pointerId,pageX:e.pageX,pageY:e.pageY,radiusX:e.width/2,radiusY:e.height/2,screenX:e.screenX,screenY:e.screenY,target:e.target}},es=function(e){en.push({event:e,touch:ea(e)})},eo=function(e){for(var t=0;t<en.length;t++)if(en[t].event.pointerId===e.pointerId)return void en.splice(t,1)},el=function(e){var t=en.filter(function(t){return t.event.pointerId===e.pointerId})[0];t.event=e,t.touch=ea(e)},ec=function(e){e.touches=en.map(function(e){return e.touch})},eu=function(e){return"mouse"===e.pointerType||4===e.pointerType};P.registerBinding(P.container,"pointerdown",function(e){eu(e)||(e.preventDefault(),es(e),ec(e),b(e))}),P.registerBinding(P.container,"pointerup",function(e){eu(e)||(eo(e),ec(e),w(e))}),P.registerBinding(P.container,"pointercancel",function(e){eu(e)||(eo(e),ec(e),_(e))}),P.registerBinding(P.container,"pointermove",function(e){eu(e)||(e.preventDefault(),el(e),ec(e),x(e))})}};var Sn={};Sn.generatePolygon=function(e,t){return this.nodeShapes[e]={renderer:this,name:e,points:t,draw:function(e,t,i,r,n,a){this.renderer.nodeShapeImpl("polygon",e,t,i,r,n,this.points)},intersectLine:function(e,t,i,r,n,a,s,o){return bK(n,a,this.points,e,t,i/2,r/2,s)},checkPoint:function(e,t,i,r,n,a,s,o){return bz(e,t,this.points,a,s,r,n,[0,-1],i)},hasMiterBounds:"rectangle"!==e,miterBounds:function(e,t,i,r,n,a){var s,o,l;return s=this.points,o=function(e,t){if(e.length<3)throw Error("Need at least 3 vertices");var i=function(e,t){return{x:e.x+t.x,y:e.y+t.y}},r=function(e,t){return{x:e.x-t.x,y:e.y-t.y}},n=function(e,t){return{x:e.x*t,y:e.y*t}},a=function(e,t){return e.x*t.y-e.y*t.x},s=e.map(function(e){return{x:e.x,y:e.y}});0>function(e){for(var t=0,i=0;i<e.length;i++){var r=e[i],n=e[(i+1)%e.length];t+=r.x*n.y-n.x*r.y}return t/2}(s)&&s.reverse();for(var o=s.length,l=[],c=0;c<o;c++){var u=s[c],h=r(s[(c+1)%o],u),d=function(e){var t=bI(e.x,e.y);return 0===t?{x:0,y:0}:{x:e.x/t,y:e.y/t}}({x:h.y,y:-h.x});l.push(d)}for(var f=l.map(function(e,r){return{p1:i(s[r],n(e,t)),p2:i(s[(r+1)%o],n(e,t))}}),p=[],g=0;g<o;g++){var v=f[(g-1+o)%o],y=f[g],b=function(e,t,s,o){var l=r(t,e),c=r(o,s),u=a(l,c);if(1e-9>Math.abs(u))return i(e,n(l,.5));var h=a(r(s,e),c)/u;return i(e,n(l,h))}(v.p1,v.p2,y.p1,y.p2);p.push(b)}return p}(bX(s,e,t,i,r),n),l=bx(),o.forEach(function(e){return bk(l,e.x,e.y)}),l}}},Sn.generateEllipse=function(){return this.nodeShapes.ellipse={renderer:this,name:"ellipse",draw:function(e,t,i,r,n,a){this.renderer.nodeShapeImpl(this.name,e,t,i,r,n)},intersectLine:function(e,t,i,r,n,a,s,o){return bW(n,a,e,t,i/2+s,r/2+s)},checkPoint:function(e,t,i,r,n,a,s,o){return bH(e,t,r,n,a,s,i)}}},Sn.generateRoundPolygon=function(e,t){return this.nodeShapes[e]={renderer:this,name:e,points:t,getOrCreateCorners:function(e,i,r,n,a,s,o){if(void 0!==s[o]&&s[o+"-cx"]===e&&s[o+"-cy"]===i)return s[o];s[o]=Array(t.length/2),s[o+"-cx"]=e,s[o+"-cy"]=i;var l=r/2,c=n/2;a="auto"===a?b3(r,n):a;for(var u=Array(t.length/2),h=0;h<t.length/2;h++)u[h]={x:e+l*t[2*h],y:i+c*t[2*h+1]};var d,f,p,g,v=u.length;for(d=0,f=u[v-1];d<v;d++)p=u[d%v],g=u[(d+1)%v],s[o][d]=PZ(f,p,g,a),f=p,p=g;return s[o]},draw:function(e,t,i,r,n,a,s){this.renderer.nodeShapeImpl("round-polygon",e,t,i,r,n,this.points,this.getOrCreateCorners(t,i,r,n,a,s,"drawCorners"))},intersectLine:function(e,t,i,r,n,a,s,o,l){return bZ(n,a,this.points,e,t,i,r,s,this.getOrCreateCorners(e,t,i,r,o,l,"corners"))},checkPoint:function(e,t,i,r,n,a,s,o,l){return bV(e,t,this.points,a,s,r,n,this.getOrCreateCorners(a,s,r,n,o,l,"corners"))}}},Sn.generateRoundRectangle=function(){return this.nodeShapes["round-rectangle"]=this.nodeShapes.roundrectangle={renderer:this,name:"round-rectangle",points:bQ(4,0),draw:function(e,t,i,r,n,a){this.renderer.nodeShapeImpl(this.name,e,t,i,r,n,this.points,a)},intersectLine:function(e,t,i,r,n,a,s,o){return bL(n,a,e,t,i,r,s,o)},checkPoint:function(e,t,i,r,n,a,s,o){var l=r/2,c=n/2,u=2*(o=Math.min(l,c,o="auto"===o?b2(r,n):o));return!!(bz(e,t,this.points,a,s,r,n-u,[0,-1],i)||bz(e,t,this.points,a,s,r-u,n,[0,-1],i)||bH(e,t,u,u,a-l+o,s-c+o,i)||bH(e,t,u,u,a+l-o,s-c+o,i)||bH(e,t,u,u,a+l-o,s+c-o,i)||bH(e,t,u,u,a-l+o,s+c-o,i))}}},Sn.generateCutRectangle=function(){return this.nodeShapes["cut-rectangle"]=this.nodeShapes.cutrectangle={renderer:this,name:"cut-rectangle",cornerLength:b4(),points:bQ(4,0),draw:function(e,t,i,r,n,a){this.renderer.nodeShapeImpl(this.name,e,t,i,r,n,null,a)},generateCutTrianglePts:function(e,t,i,r,n){var a="auto"===n?this.cornerLength:n,s=t/2,o=e/2,l=i-o,c=i+o,u=r-s,h=r+s;return{topLeft:[l,u+a,l+a,u,l+a,u+a],topRight:[c-a,u,c,u+a,c-a,u+a],bottomRight:[c,h-a,c-a,h,c-a,h-a],bottomLeft:[l+a,h,l,h-a,l+a,h-a]}},intersectLine:function(e,t,i,r,n,a,s,o){var l=this.generateCutTrianglePts(i+2*s,r+2*s,e,t,o);return bK(n,a,[].concat.apply([],[l.topLeft.splice(0,4),l.topRight.splice(0,4),l.bottomRight.splice(0,4),l.bottomLeft.splice(0,4)]),e,t)},checkPoint:function(e,t,i,r,n,a,s,o){var l="auto"===o?this.cornerLength:o;if(bz(e,t,this.points,a,s,r,n-2*l,[0,-1],i)||bz(e,t,this.points,a,s,r-2*l,n,[0,-1],i))return!0;var c=this.generateCutTrianglePts(r,n,a,s);return bF(e,t,c.topLeft)||bF(e,t,c.topRight)||bF(e,t,c.bottomRight)||bF(e,t,c.bottomLeft)}}},Sn.generateBarrel=function(){return this.nodeShapes.barrel={renderer:this,name:"barrel",points:bQ(4,0),draw:function(e,t,i,r,n,a){this.renderer.nodeShapeImpl(this.name,e,t,i,r,n)},intersectLine:function(e,t,i,r,n,a,s,o){var l=this.generateBarrelBezierPts(i+2*s,r+2*s,e,t),c=function(e){var t=bv({x:e[0],y:e[1]},{x:e[2],y:e[3]},{x:e[4],y:e[5]},.15),i=bv({x:e[0],y:e[1]},{x:e[2],y:e[3]},{x:e[4],y:e[5]},.5),r=bv({x:e[0],y:e[1]},{x:e[2],y:e[3]},{x:e[4],y:e[5]},.85);return[e[0],e[1],t.x,t.y,i.x,i.y,r.x,r.y,e[4],e[5]]};return bK(n,a,[].concat(c(l.topLeft),c(l.topRight),c(l.bottomRight),c(l.bottomLeft)),e,t)},generateBarrelBezierPts:function(e,t,i,r){var n=t/2,a=e/2,s=i-a,o=i+a,l=r-n,c=r+n,u=b5(e,t),h=u.heightOffset,d=u.widthOffset,f=u.ctrlPtOffsetPct*e,p={topLeft:[s,l+h,s+f,l,s+d,l],topRight:[o-d,l,o-f,l,o,l+h],bottomRight:[o,c-h,o-f,c,o-d,c],bottomLeft:[s+d,c,s+f,c,s,c-h]};return p.topLeft.isTop=!0,p.topRight.isTop=!0,p.bottomLeft.isBottom=!0,p.bottomRight.isBottom=!0,p},checkPoint:function(e,t,i,r,n,a,s,o){var l=b5(r,n),c=l.heightOffset,u=l.widthOffset;if(bz(e,t,this.points,a,s,r,n-2*c,[0,-1],i)||bz(e,t,this.points,a,s,r-2*u,n,[0,-1],i))return!0;for(var h=this.generateBarrelBezierPts(r,n,a,s),d=Object.keys(h),f=0;f<d.length;f++){var p=h[d[f]],g=function(e,t,i){var r=i[4],n=i[2],a=i[0],s=i[5],o=i[1],l=Math.min(r,a),c=Math.max(r,a),u=Math.min(s,o),h=Math.max(s,o);if(l<=e&&e<=c&&u<=t&&t<=h){var d=[r-2*n+a,2*(n-r),r],f=bR(d[0],d[1],d[2],e).filter(function(e){return 0<=e&&e<=1});if(f.length>0)return f[0]}return null}(e,t,p);if(null!=g){var v=bm(p[5],p[3],p[1],g);if(p.isTop&&v<=t||p.isBottom&&t<=v)return!0}}return!1}}},Sn.generateBottomRoundrectangle=function(){return this.nodeShapes["bottom-round-rectangle"]=this.nodeShapes.bottomroundrectangle={renderer:this,name:"bottom-round-rectangle",points:bQ(4,0),draw:function(e,t,i,r,n,a){this.renderer.nodeShapeImpl(this.name,e,t,i,r,n,this.points,a)},intersectLine:function(e,t,i,r,n,a,s,o){var l=e-(i/2+s),c=t-(r/2+s),u=e+(i/2+s),h=bY(n,a,e,t,l,c,u,c,!1);return h.length>0?h:bL(n,a,e,t,i,r,s,o)},checkPoint:function(e,t,i,r,n,a,s,o){var l=2*(o="auto"===o?b2(r,n):o);if(bz(e,t,this.points,a,s,r,n-l,[0,-1],i)||bz(e,t,this.points,a,s,r-l,n,[0,-1],i))return!0;var c=r/2+2*i,u=n/2+2*i;return!!(bF(e,t,[a-c,s-u,a-c,s,a+c,s,a+c,s-u])||bH(e,t,l,l,a+r/2-o,s+n/2-o,i)||bH(e,t,l,l,a-r/2+o,s+n/2-o,i))}}},Sn.registerNodeShapes=function(){var e=this.nodeShapes={},t=this;this.generateEllipse(),this.generatePolygon("triangle",bQ(3,0)),this.generateRoundPolygon("round-triangle",bQ(3,0)),this.generatePolygon("rectangle",bQ(4,0)),e.square=e.rectangle,this.generateRoundRectangle(),this.generateCutRectangle(),this.generateBarrel(),this.generateBottomRoundrectangle();var i=[0,1,1,0,0,-1,-1,0];this.generatePolygon("diamond",i),this.generateRoundPolygon("round-diamond",i),this.generatePolygon("pentagon",bQ(5,0)),this.generateRoundPolygon("round-pentagon",bQ(5,0)),this.generatePolygon("hexagon",bQ(6,0)),this.generateRoundPolygon("round-hexagon",bQ(6,0)),this.generatePolygon("heptagon",bQ(7,0)),this.generateRoundPolygon("round-heptagon",bQ(7,0)),this.generatePolygon("octagon",bQ(8,0)),this.generateRoundPolygon("round-octagon",bQ(8,0));var r=Array(20),n=b1(5,0),a=b1(5,Math.PI/5),s=.5*(3-Math.sqrt(5));s*=1.57;for(var o=0;o<a.length/2;o++)a[2*o]*=s,a[2*o+1]*=s;for(var o=0;o<5;o++)r[4*o]=n[2*o],r[4*o+1]=n[2*o+1],r[4*o+2]=a[2*o],r[4*o+3]=a[2*o+1];r=b0(r),this.generatePolygon("star",r),this.generatePolygon("vee",[-1,-1,0,-.333,1,-1,0,1]),this.generatePolygon("rhomboid",[-1,-1,.333,-1,1,1,-.333,1]),this.generatePolygon("right-rhomboid",[-.333,-1,1,-1,.333,1,-1,1]),this.nodeShapes.concavehexagon=this.generatePolygon("concave-hexagon",[-1,-.95,-.75,0,-1,.95,1,.95,.75,0,1,-.95]);var l=[-1,-1,.25,-1,1,0,.25,1,-1,1];this.generatePolygon("tag",l),this.generateRoundPolygon("round-tag",l),e.makePolygon=function(e){var i,r="polygon-"+e.join("$");return(i=this[r])?i:t.generatePolygon(r,e)}};var Sa={};Sa.timeToRender=function(){return this.redrawTotalTime/this.redrawCount},Sa.redraw=function(e){e=e||y$(),void 0===this.averageRedrawTime&&(this.averageRedrawTime=0),void 0===this.lastRedrawTime&&(this.lastRedrawTime=0),void 0===this.lastDrawTime&&(this.lastDrawTime=0),this.requestedFrame=!0,this.renderOptions=e},Sa.beforeRender=function(e,t){if(!this.destroyed){null==t&&yj("Priority is not optional for beforeRender");var i=this.beforeRenderCallbacks;i.push({fn:e,priority:t}),i.sort(function(e,t){return t.priority-e.priority})}};var Ss=function(e,t,i){for(var r=e.beforeRenderCallbacks,n=0;n<r.length;n++)r[n].fn(t,i)};Sa.startRenderLoop=function(){var e=this,t=e.cy;if(!e.renderLoopStarted){e.renderLoopStarted=!0;var i=function(r){if(!e.destroyed){if(t.batching());else if(e.requestedFrame&&!e.skipFrame){Ss(e,!0,r);var n=yv();e.render(e.renderOptions);var a=e.lastDrawTime=yv();void 0===e.averageRedrawTime&&(e.averageRedrawTime=a-n),void 0===e.redrawCount&&(e.redrawCount=0),e.redrawCount++,void 0===e.redrawTotalTime&&(e.redrawTotalTime=0);var s=a-n;e.redrawTotalTime+=s,e.lastRedrawTime=s,e.averageRedrawTime=e.averageRedrawTime/2+s/2,e.requestedFrame=!1}else Ss(e,!1,r);e.skipFrame=!1,yb(i)}};yb(i)}};var So=function(e){this.init(e)},Sl=So.prototype;Sl.clientFunctions=["redrawHint","render","renderTo","matchCanvasSize","nodeShapeImpl","arrowShapeImpl"],Sl.init=function(e){this.options=e,this.cy=e.cy;var t=this.container=e.cy.container(),i=this.cy.window();if(i){var r=i.document,n=r.head,a="__________cytoscape_stylesheet",s="__________cytoscape_container",o=null!=r.getElementById(a);if(0>t.className.indexOf(s)&&(t.className=(t.className||"")+" "+s),!o){var l=r.createElement("style");l.id=a,l.textContent="."+s+" { position: relative; }",n.insertBefore(l,n.children[0])}"static"===i.getComputedStyle(t).getPropertyValue("position")&&yF("A Cytoscape container has style position:static and so can not use UI extensions properly")}this.selection=[void 0,void 0,void 0,void 0,0],this.bezierProjPcts=[.05,.225,.4,.5,.6,.775,.95],this.hoverData={down:null,last:null,downTime:null,triggerMode:null,dragging:!1,initialPan:[null,null],capture:!1},this.dragData={possibleDragElements:[]},this.touchData={start:null,capture:!1,startPosition:[null,null,null,null,null,null],singleTouchStartTime:null,singleTouchMoved:!0,now:[null,null,null,null,null,null],earlier:[null,null,null,null,null,null]},this.redraws=0,this.showFps=e.showFps,this.debug=e.debug,this.webgl=e.webgl,this.hideEdgesOnViewport=e.hideEdgesOnViewport,this.textureOnViewport=e.textureOnViewport,this.wheelSensitivity=e.wheelSensitivity,this.motionBlurEnabled=e.motionBlur,this.forcedPixelRatio=v$(e.pixelRatio)?e.pixelRatio:null,this.motionBlur=e.motionBlur,this.motionBlurOpacity=e.motionBlurOpacity,this.motionBlurTransparency=1-this.motionBlurOpacity,this.motionBlurPxRatio=1,this.mbPxRBlurry=1,this.minMbLowQualFrames=4,this.fullQualityMb=!1,this.clearedForMotionBlur=[],this.desktopTapThreshold=e.desktopTapThreshold,this.desktopTapThreshold2=e.desktopTapThreshold*e.desktopTapThreshold,this.touchTapThreshold=e.touchTapThreshold,this.touchTapThreshold2=e.touchTapThreshold*e.touchTapThreshold,this.tapholdDuration=500,this.bindings=[],this.beforeRenderCallbacks=[],this.beforeRenderPriorities={animations:400,eleCalcs:300,eleTxrDeq:200,lyrTxrDeq:150,lyrTxrSkip:100},this.registerNodeShapes(),this.registerArrowShapes(),this.registerCalculationListeners()},Sl.notify=function(e,t){var i=this.cy;if(!this.destroyed){if("init"===e)return void this.load();if("destroy"===e)return void this.destroy();("add"===e||"remove"===e||"move"===e&&i.hasCompoundNodes()||"load"===e||"zorder"===e||"mount"===e)&&this.invalidateCachedZSortedEles(),"viewport"===e&&this.redrawHint("select",!0),"gc"===e&&this.redrawHint("gc",!0),("load"===e||"resize"===e||"mount"===e)&&(this.invalidateContainerClientCoordsCache(),this.matchCanvasSize(this.container)),this.redrawHint("eles",!0),this.redrawHint("drag",!0),this.startRenderLoop(),this.redraw()}},Sl.destroy=function(){this.destroyed=!0,this.cy.stopAnimationLoop();for(var e=0;e<this.bindings.length;e++){var t=this.bindings[e],i=t.target;(i.off||i.removeEventListener).apply(i,t.args)}if(this.bindings=[],this.beforeRenderCallbacks=[],this.onUpdateEleCalcsFns=[],this.removeObserver&&this.removeObserver.disconnect(),this.styleObserver&&this.styleObserver.disconnect(),this.resizeObserver&&this.resizeObserver.disconnect(),this.labelCalcDiv)try{document.body.removeChild(this.labelCalcDiv)}catch(e){}},Sl.isHeadless=function(){return!1},[k2,St,Si,Sr,Sn,Sa].forEach(function(e){ye(Sl,e)});var Sc=1e3/60,Su=function(e){return function(){var t=this,i=this.renderer;if(!t.dequeueingSetup){t.dequeueingSetup=!0;var r=yg(function(){i.redrawHint("eles",!0),i.redrawHint("drag",!0),i.redraw()},e.deqRedrawThreshold),n=e.priority||yN;i.beforeRender(function(n,a){var s=yv(),o=i.averageRedrawTime,l=i.lastRedrawTime,c=[],u=i.cy.extent(),h=i.getPixelRatio();for(n||i.flushRenderedStyleQueue();;){var d=yv(),f=d-s,p=d-a;if(l<Sc){var g=Sc-(n?o:0);if(p>=e.deqFastCost*g)break}else if(n){if(f>=e.deqCost*l||f>=e.deqAvgCost*o)break}else if(p>=e.deqNoDrawCost*Sc)break;var v=e.deq(t,h,u);if(v.length>0)for(var y=0;y<v.length;y++)c.push(v[y]);else break}c.length>0&&(e.onDeqd(t,c),!n&&e.shouldRedraw(t,c,h,u)&&r())},n(t))}}},Sh=vE(function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:yO;vk(this,e),this.idsByKey=new yZ,this.keyForId=new yZ,this.cachesByLvl=new yZ,this.lvls=[],this.getKey=t,this.doesEleInvalidateKey=i},[{key:"getIdsFor",value:function(e){null==e&&yj("Can not get id list for null key");var t=this.idsByKey,i=this.idsByKey.get(e);return i||(i=new yQ,t.set(e,i)),i}},{key:"addIdForKey",value:function(e,t){null!=e&&this.getIdsFor(e).add(t)}},{key:"deleteIdForKey",value:function(e,t){null!=e&&this.getIdsFor(e).delete(t)}},{key:"getNumberOfIdsForKey",value:function(e){return null==e?0:this.getIdsFor(e).size}},{key:"updateKeyMappingFor",value:function(e){var t=e.id(),i=this.keyForId.get(t),r=this.getKey(e);this.deleteIdForKey(i,t),this.addIdForKey(r,t),this.keyForId.set(t,r)}},{key:"deleteKeyMappingFor",value:function(e){var t=e.id(),i=this.keyForId.get(t);this.deleteIdForKey(i,t),this.keyForId.delete(t)}},{key:"keyHasChangedFor",value:function(e){var t=e.id();return this.keyForId.get(t)!==this.getKey(e)}},{key:"isInvalid",value:function(e){return this.keyHasChangedFor(e)||this.doesEleInvalidateKey(e)}},{key:"getCachesAt",value:function(e){var t=this.cachesByLvl,i=this.lvls,r=t.get(e);return r||(r=new yZ,t.set(e,r),i.push(e)),r}},{key:"getCache",value:function(e,t){return this.getCachesAt(t).get(e)}},{key:"get",value:function(e,t){var i=this.getKey(e),r=this.getCache(i,t);return null!=r&&this.updateKeyMappingFor(e),r}},{key:"getForCachedKey",value:function(e,t){var i=this.keyForId.get(e.id());return this.getCache(i,t)}},{key:"hasCache",value:function(e,t){return this.getCachesAt(t).has(e)}},{key:"has",value:function(e,t){var i=this.getKey(e);return this.hasCache(i,t)}},{key:"setCache",value:function(e,t,i){i.key=e,this.getCachesAt(t).set(e,i)}},{key:"set",value:function(e,t,i){var r=this.getKey(e);this.setCache(r,t,i),this.updateKeyMappingFor(e)}},{key:"deleteCache",value:function(e,t){this.getCachesAt(t).delete(e)}},{key:"delete",value:function(e,t){var i=this.getKey(e);this.deleteCache(i,t)}},{key:"invalidateKey",value:function(e){var t=this;this.lvls.forEach(function(i){return t.deleteCache(e,i)})}},{key:"invalidate",value:function(e){var t=e.id(),i=this.keyForId.get(t);this.deleteKeyMappingFor(e);var r=this.doesEleInvalidateKey(e);return r&&this.invalidateKey(i),r||0===this.getNumberOfIdsForKey(i)}}]),Sd={dequeue:"dequeue",downscale:"downscale",highQuality:"highQuality"},Sf=yW({getKey:null,doesEleInvalidateKey:yO,drawElement:null,getBoundingBox:null,getRotationPoint:null,getRotationOffset:null,isVisible:yD,allowEdgeTxrCaching:!0,allowParentTxrCaching:!0}),Sp=function(e,t){this.renderer=e,this.onDequeues=[];var i=Sf(t);ye(this,i),this.lookup=new Sh(i.getKey,i.doesEleInvalidateKey),this.setupDequeueing()},Sg=Sp.prototype;Sg.reasons=Sd,Sg.getTextureQueue=function(e){return this.eleImgCaches=this.eleImgCaches||{},this.eleImgCaches[e]=this.eleImgCaches[e]||[]},Sg.getRetiredTextureQueue=function(e){var t=this.eleImgCaches.retired=this.eleImgCaches.retired||{};return t[e]=t[e]||[]},Sg.getElementQueue=function(){return this.eleCacheQueue=this.eleCacheQueue||new y5(function(e,t){return t.reqs-e.reqs})},Sg.getElementKeyToQueue=function(){return this.eleKeyToCacheQueue=this.eleKeyToCacheQueue||{}},Sg.getElement=function(e,t,i,r,n){var a,s,o,l=this,c=this.renderer,u=c.cy.zoom(),h=this.lookup;if(!t||0===t.w||0===t.h||isNaN(t.w)||isNaN(t.h)||!e.visible()||e.removed()||!l.allowEdgeTxrCaching&&e.isEdge()||!l.allowParentTxrCaching&&e.isParent())return null;if(null==r&&(r=Math.ceil(bh(u*i))),r<-4)r=-4;else if(u>=7.99||r>3)return null;var d=Math.pow(2,r),f=t.h*d,p=t.w*d,g=c.eleTextBiggerThanMin(e,d);if(!this.isVisible(e,g))return null;var v=h.get(e,r);if(v&&v.invalidated&&(v.invalidated=!1,v.texture.invalidatedWidth-=v.width),v)return v;if(a=f<=25?25:f<=50?50:50*Math.ceil(f/50),f>1024||p>1024)return null;var y=l.getTextureQueue(a),b=y[y.length-2],x=function(){return l.recycleTexture(a,p)||l.addTexture(a,p)};b||(b=y[y.length-1]),b||(b=x()),b.width-b.usedWidth<p&&(b=x());for(var _=function(e){return e&&e.scaledLabelShown===g},w=n&&n===Sd.dequeue,k=n&&n===Sd.highQuality,E=n&&n===Sd.downscale,T=r+1;T<=3;T++){var P=h.get(e,T);if(P){s=P;break}}var S=s&&s.level===r+1?s:null,M=function(){b.context.drawImage(S.texture.canvas,S.x,0,S.width,S.height,b.usedWidth,0,p,f)};if(b.context.setTransform(1,0,0,1,0,0),b.context.clearRect(b.usedWidth,0,p,a),_(S))M();else if(_(s))if(!k)return l.queueElement(e,s.level-1),s;else{for(var C=s.level;C>r;C--)S=l.getElement(e,t,i,C,Sd.downscale);M()}else{if(!w&&!k&&!E)for(var A=r-1;A>=-4;A--){var I=h.get(e,A);if(I){o=I;break}}if(_(o))return l.queueElement(e,r),o;b.context.translate(b.usedWidth,0),b.context.scale(d,d),this.drawElement(b.context,e,t,g,!1),b.context.scale(1/d,1/d),b.context.translate(-b.usedWidth,0)}return v={x:b.usedWidth,texture:b,level:r,scale:d,width:p,height:f,scaledLabelShown:g},b.usedWidth+=Math.ceil(p+8),b.eleCaches.push(v),h.set(e,r,v),l.checkTextureFullness(b),v},Sg.invalidateElements=function(e){for(var t=0;t<e.length;t++)this.invalidateElement(e[t])},Sg.invalidateElement=function(e){var t=this.lookup,i=[];if(t.isInvalid(e)){for(var r=-4;r<=3;r++){var n=t.getForCachedKey(e,r);n&&i.push(n)}if(t.invalidate(e))for(var a=0;a<i.length;a++){var s=i[a],o=s.texture;o.invalidatedWidth+=s.width,s.invalidated=!0,this.checkTextureUtility(o)}this.removeFromQueue(e)}},Sg.checkTextureUtility=function(e){e.invalidatedWidth>=.2*e.width&&this.retireTexture(e)},Sg.checkTextureFullness=function(e){var t=this.getTextureQueue(e.height);e.usedWidth/e.width>.8&&e.fullnessChecks>=10?yH(t,e):e.fullnessChecks++},Sg.retireTexture=function(e){var t=e.height,i=this.getTextureQueue(t),r=this.lookup;yH(i,e),e.retired=!0;for(var n=e.eleCaches,a=0;a<n.length;a++){var s=n[a];r.deleteCache(s.key,s.level)}yq(n),this.getRetiredTextureQueue(t).push(e)},Sg.addTexture=function(e,t){var i=this.getTextureQueue(e),r={};return i.push(r),r.eleCaches=[],r.height=e,r.width=Math.max(1024,t),r.usedWidth=0,r.invalidatedWidth=0,r.fullnessChecks=0,r.canvas=this.renderer.makeOffscreenCanvas(r.width,r.height),r.context=r.canvas.getContext("2d"),r},Sg.recycleTexture=function(e,t){for(var i=this.getTextureQueue(e),r=this.getRetiredTextureQueue(e),n=0;n<r.length;n++){var a=r[n];if(a.width>=t)return a.retired=!1,a.usedWidth=0,a.invalidatedWidth=0,a.fullnessChecks=0,yq(a.eleCaches),a.context.setTransform(1,0,0,1,0,0),a.context.clearRect(0,0,a.width,a.height),yH(r,a),i.push(a),a}},Sg.queueElement=function(e,t){var i=this.getElementQueue(),r=this.getElementKeyToQueue(),n=this.getKey(e),a=r[n];if(a)a.level=Math.max(a.level,t),a.eles.merge(e),a.reqs++,i.updateItem(a);else{var s={eles:e.spawn().merge(e),level:t,reqs:1,key:n};i.push(s),r[n]=s}},Sg.dequeue=function(e){for(var t=this.getElementQueue(),i=this.getElementKeyToQueue(),r=[],n=this.lookup,a=0;a<1;a++)if(t.size()>0){var s=t.pop(),o=s.key,l=s.eles[0],c=n.hasCache(l,s.level);if(i[o]=null,c)continue;r.push(s);var u=this.getBoundingBox(l);this.getElement(l,u,e,s.level,Sd.dequeue)}else break;return r},Sg.removeFromQueue=function(e){var t=this.getElementQueue(),i=this.getElementKeyToQueue(),r=this.getKey(e),n=i[r];null!=n&&(1===n.eles.length?(n.reqs=yL,t.updateItem(n),t.pop(),i[r]=null):n.eles.unmerge(e))},Sg.onDequeue=function(e){this.onDequeues.push(e)},Sg.offDequeue=function(e){yH(this.onDequeues,e)},Sg.setupDequeueing=Su({deqRedrawThreshold:100,deqCost:.15,deqAvgCost:.1,deqNoDrawCost:.9,deqFastCost:.9,deq:function(e,t,i){return e.dequeue(t,i)},onDeqd:function(e,t){for(var i=0;i<e.onDequeues.length;i++)(0,e.onDequeues[i])(t)},shouldRedraw:function(e,t,i,r){for(var n=0;n<t.length;n++)for(var a=t[n].eles,s=0;s<a.length;s++)if(bS(a[s].boundingBox(),r))return!0;return!1},priority:function(e){return e.renderer.beforeRenderPriorities.eleTxrDeq}});var Sm=function(e){var t=this,i=t.renderer=e,r=i.cy;t.layersByLevel={},t.firstGet=!0,t.lastInvalidationTime=yv()-500,t.skipping=!1,t.eleTxrDeqs=r.collection(),t.scheduleElementRefinement=yg(function(){t.refineElementTextures(t.eleTxrDeqs),t.eleTxrDeqs.unmerge(t.eleTxrDeqs)},50),i.beforeRender(function(e,i){i-t.lastInvalidationTime<=250?t.skipping=!0:t.skipping=!1},i.beforeRenderPriorities.lyrTxrSkip),t.layersQueue=new y5(function(e,t){return t.reqs-e.reqs}),t.setupDequeueing()},Sv=Sm.prototype,Sy=0;Sv.makeLayer=function(e,t){var i=Math.pow(2,t),r=Math.ceil(e.w*i),n=Math.ceil(e.h*i),a=this.renderer.makeOffscreenCanvas(r,n),s={id:Sy=++Sy%0x1fffffffffffff,bb:e,level:t,width:r,height:n,canvas:a,context:a.getContext("2d"),eles:[],elesQueue:[],reqs:0},o=s.context,l=-s.bb.x1,c=-s.bb.y1;return o.scale(i,i),o.translate(l,c),s},Sv.getLayers=function(e,t,i){var r,n,a=this,s=a.renderer.cy.zoom(),o=a.firstGet;if(a.firstGet=!1,null==i){if((i=Math.ceil(bh(s*t)))<-4)i=-4;else if(s>=3.99||i>2)return null}a.validateLayersElesOrdering(i,e);var l=a.layersByLevel,c=Math.pow(2,i),u=l[i]=l[i]||[];if(a.levelIsComplete(i,e))return u;var h=function(t){if(a.validateLayersElesOrdering(t,e),a.levelIsComplete(t,e))return n=l[t],!0},d=function(e){if(!n)for(var t=i+e;-4<=t&&t<=2&&!h(t);t+=e);};d(1),d(-1);for(var f=u.length-1;f>=0;f--){var p=u[f];p.invalid&&yH(u,p)}var g=function(){if(!r){r=bx();for(var t=0;t<e.length;t++)bw(r,e[t].boundingBox())}return r};if(a.skipping&&!o)return null;for(var v=null,y=e.length/1,b=!o,x=0;x<e.length;x++){var _=e[x],w=_._private.rscratch,k=w.imgLayerCaches=w.imgLayerCaches||{},E=k[i];if(E){v=E;continue}if((!v||v.eles.length>=y||!bA(v.bb,_.boundingBox()))&&!(v=function(e){var t=(e=e||{}).after;g();var n=Math.ceil(r.w*c),s=Math.ceil(r.h*c);if(n>32767||s>32767||n*s>16e6)return null;var o=a.makeLayer(r,i);if(null!=t){var l=u.indexOf(t)+1;u.splice(l,0,o)}else(void 0===e.insert||e.insert)&&u.unshift(o);return o}({insert:!0,after:v})))return null;n||b?a.queueLayer(v,_):a.drawEleInLayer(v,_,i,t),v.eles.push(_),k[i]=v}return n||(b?null:u)},Sv.getEleLevelForLayerLevel=function(e,t){return e},Sv.drawEleInLayer=function(e,t,i,r){var n=this.renderer,a=e.context,s=t.boundingBox();0!==s.w&&0!==s.h&&t.visible()&&(i=this.getEleLevelForLayerLevel(i,r),n.setImgSmoothing(a,!1),n.drawCachedElement(a,t,null,null,i,!0),n.setImgSmoothing(a,!0))},Sv.levelIsComplete=function(e,t){var i=this.layersByLevel[e];if(!i||0===i.length)return!1;for(var r=0,n=0;n<i.length;n++){var a=i[n];if(a.reqs>0||a.invalid)return!1;r+=a.eles.length}return r===t.length},Sv.validateLayersElesOrdering=function(e,t){var i=this.layersByLevel[e];if(i)for(var r=0;r<i.length;r++){for(var n=i[r],a=-1,s=0;s<t.length;s++)if(n.eles[0]===t[s]){a=s;break}if(a<0){this.invalidateLayer(n);continue}for(var o=a,s=0;s<n.eles.length;s++)if(n.eles[s]!==t[o+s]){this.invalidateLayer(n);break}}},Sv.updateElementsInLayers=function(e,t){for(var i=vq(e[0]),r=0;r<e.length;r++)for(var n=i?null:e[r],a=i?e[r]:e[r].ele,s=a._private.rscratch,o=s.imgLayerCaches=s.imgLayerCaches||{},l=-4;l<=2;l++){var c=o[l];c&&(n&&this.getEleLevelForLayerLevel(c.level)!==n.level||t(c,a,n))}},Sv.haveLayers=function(){for(var e=!1,t=-4;t<=2;t++){var i=this.layersByLevel[t];if(i&&i.length>0){e=!0;break}}return e},Sv.invalidateElements=function(e){var t=this;0===e.length||(t.lastInvalidationTime=yv(),0!==e.length&&t.haveLayers()&&t.updateElementsInLayers(e,function(e,i,r){t.invalidateLayer(e)}))},Sv.invalidateLayer=function(e){if(this.lastInvalidationTime=yv(),!e.invalid){var t=e.level,i=e.eles;yH(this.layersByLevel[t],e),e.elesQueue=[],e.invalid=!0,e.replacement&&(e.replacement.invalid=!0);for(var r=0;r<i.length;r++){var n=i[r]._private.rscratch.imgLayerCaches;n&&(n[t]=null)}}},Sv.refineElementTextures=function(e){var t=this;t.updateElementsInLayers(e,function(e,i,r){var n=e.replacement;if(n||((n=e.replacement=t.makeLayer(e.bb,e.level)).replaces=e,n.eles=e.eles),!n.reqs)for(var a=0;a<n.eles.length;a++)t.queueLayer(n,n.eles[a])})},Sv.enqueueElementRefinement=function(e){this.eleTxrDeqs.merge(e),this.scheduleElementRefinement()},Sv.queueLayer=function(e,t){var i=this.layersQueue,r=e.elesQueue,n=r.hasId=r.hasId||{};if(!e.replacement){if(t){if(n[t.id()])return;r.push(t),n[t.id()]=!0}e.reqs?(e.reqs++,i.updateItem(e)):(e.reqs=1,i.push(e))}},Sv.dequeue=function(e){for(var t=this.layersQueue,i=[],r=0;r<1&&0!==t.size();){var n=t.peek();if(n.replacement||n.replaces&&n!==n.replaces.replacement||n.invalid){t.pop();continue}var a=n.elesQueue.shift();a&&(this.drawEleInLayer(n,a,n.level,e),r++),0===i.length&&i.push(!0),0===n.elesQueue.length&&(t.pop(),n.reqs=0,n.replaces&&this.applyLayerReplacement(n),this.requestRedraw())}return i},Sv.applyLayerReplacement=function(e){var t=this.layersByLevel[e.level],i=e.replaces,r=t.indexOf(i);if(!(r<0)&&!i.invalid){t[r]=e;for(var n=0;n<e.eles.length;n++){var a=e.eles[n]._private,s=a.imgLayerCaches=a.imgLayerCaches||{};s&&(s[e.level]=e)}this.requestRedraw()}},Sv.requestRedraw=yg(function(){var e=this.renderer;e.redrawHint("eles",!0),e.redrawHint("drag",!0),e.redraw()},100),Sv.setupDequeueing=Su({deqRedrawThreshold:50,deqCost:.15,deqAvgCost:.1,deqNoDrawCost:.9,deqFastCost:.9,deq:function(e,t){return e.dequeue(t)},onDeqd:yN,shouldRedraw:yD,priority:function(e){return e.renderer.beforeRenderPriorities.lyrTxrDeq}});var Sb={};function Sx(e,t){for(var i=0;i<t.length;i++){var r=t[i];e.lineTo(r.x,r.y)}}function S_(e,t,i){for(var r,n=0;n<t.length;n++){var a=t[n];0===n&&(r=a),e.lineTo(a.x,a.y)}e.quadraticCurveTo(i.x,i.y,r.x,r.y)}function Sw(e,t,i){e.beginPath&&e.beginPath();for(var r=0;r<t.length;r++){var n=t[r];e.lineTo(n.x,n.y)}var a=i[0];e.moveTo(a.x,a.y);for(var r=1;r<i.length;r++){var n=i[r];e.lineTo(n.x,n.y)}e.closePath&&e.closePath()}function Sk(e,t,i,r,n){e.beginPath&&e.beginPath(),e.arc(i,r,n,0,2*Math.PI,!1);var a=t[0];e.moveTo(a.x,a.y);for(var s=0;s<t.length;s++){var o=t[s];e.lineTo(o.x,o.y)}e.closePath&&e.closePath()}function SE(e,t,i,r){e.arc(t,i,r,0,2*Math.PI,!1)}Sb.arrowShapeImpl=function(e){return(v||(v={polygon:Sx,"triangle-backcurve":S_,"triangle-tee":Sw,"circle-triangle":Sk,"triangle-cross":Sw,circle:SE}))[e]};var ST={};ST.drawElement=function(e,t,i,r,n,a){t.isNode()?this.drawNode(e,t,i,r,n,a):this.drawEdge(e,t,i,r,n,a)},ST.drawElementOverlay=function(e,t){t.isNode()?this.drawNodeOverlay(e,t):this.drawEdgeOverlay(e,t)},ST.drawElementUnderlay=function(e,t){t.isNode()?this.drawNodeUnderlay(e,t):this.drawEdgeUnderlay(e,t)},ST.drawCachedElementPortion=function(e,t,i,r,n,a,s,o){var l=i.getBoundingBox(t);if(0!==l.w&&0!==l.h){var c=i.getElement(t,l,r,n,a);if(null!=c){var u,h,d,f,p,g,v=o(this,t);if(0===v)return;var y=s(this,t),b=l.x1,x=l.y1,_=l.w,w=l.h;if(0!==y){var k=i.getRotationPoint(t);d=k.x,f=k.y,e.translate(d,f),e.rotate(y),(p=this.getImgSmoothing(e))||this.setImgSmoothing(e,!0);var E=i.getRotationOffset(t);u=E.x,h=E.y}else u=b,h=x;1!==v&&(g=e.globalAlpha,e.globalAlpha=g*v),e.drawImage(c.texture.canvas,c.x,0,c.width,c.height,u,h,_,w),1!==v&&(e.globalAlpha=g),0!==y&&(e.rotate(-y),e.translate(-d,-f),p||this.setImgSmoothing(e,!1))}else i.drawElement(e,t)}};var SP=function(){return 0},SS=function(e,t){return e.getTextAngle(t,null)},SM=function(e,t){return e.getTextAngle(t,"source")},SC=function(e,t){return e.getTextAngle(t,"target")},SA=function(e,t){return t.effectiveOpacity()},SI=function(e,t){return t.pstyle("text-opacity").pfValue*t.effectiveOpacity()};ST.drawCachedElement=function(e,t,i,r,n,a){var s=this.data,o=s.eleTxrCache,l=s.lblTxrCache,c=s.slbTxrCache,u=s.tlbTxrCache,h=t.boundingBox(),d=!0===a?o.reasons.highQuality:null;if(0!==h.w&&0!==h.h&&t.visible()&&(!r||bS(h,r))){var f=t.isEdge(),p=t.element()._private.rscratch.badLine;this.drawElementUnderlay(e,t),this.drawCachedElementPortion(e,t,o,i,n,d,SP,SA),f&&p||this.drawCachedElementPortion(e,t,l,i,n,d,SS,SI),f&&!p&&(this.drawCachedElementPortion(e,t,c,i,n,d,SM,SI),this.drawCachedElementPortion(e,t,u,i,n,d,SC,SI)),this.drawElementOverlay(e,t)}},ST.drawElements=function(e,t){for(var i=0;i<t.length;i++){var r=t[i];this.drawElement(e,r)}},ST.drawCachedElements=function(e,t,i,r){for(var n=0;n<t.length;n++){var a=t[n];this.drawCachedElement(e,a,i,r)}},ST.drawCachedNodes=function(e,t,i,r){for(var n=0;n<t.length;n++){var a=t[n];a.isNode()&&this.drawCachedElement(e,a,i,r)}},ST.drawLayeredElements=function(e,t,i,r){var n=this.data.lyrTxrCache.getLayers(t,i);if(n)for(var a=0;a<n.length;a++){var s=n[a],o=s.bb;0!==o.w&&0!==o.h&&e.drawImage(s.canvas,o.x1,o.y1,o.w,o.h)}else this.drawCachedElements(e,t,i,r)};var SL={};SL.drawEdge=function(e,t,i){var r,n=!(arguments.length>3)||void 0===arguments[3]||arguments[3],a=!(arguments.length>4)||void 0===arguments[4]||arguments[4],s=!(arguments.length>5)||void 0===arguments[5]||arguments[5],o=this,l=t._private.rscratch;if((!s||t.visible())&&!(l.badLine||null==l.allpts||isNaN(l.allpts[0]))){i&&(r=i,e.translate(-r.x1,-r.y1));var c=s?t.pstyle("opacity").value:1,u=s?t.pstyle("line-opacity").value:1,h=t.pstyle("curve-style").value,d=t.pstyle("line-style").value,f=t.pstyle("width").pfValue,p=t.pstyle("line-cap").value,g=t.pstyle("line-outline-width").value,v=t.pstyle("line-outline-color").value,y=c*u,b=c*u,x=function(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:y;"straight-triangle"===h?(o.eleStrokeStyle(e,t,i),o.drawEdgeTrianglePath(t,e,l.allpts)):(e.lineWidth=f,e.lineCap=p,o.eleStrokeStyle(e,t,i),o.drawEdgePath(t,e,l.allpts,d),e.lineCap="butt")},_=function(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:b;o.drawArrowheads(e,t,i)};if(e.lineJoin="round","yes"===t.pstyle("ghost").value){var w=t.pstyle("ghost-offset-x").pfValue,k=t.pstyle("ghost-offset-y").pfValue,E=y*t.pstyle("ghost-opacity").value;e.translate(w,k),x(E),_(E),e.translate(-w,-k)}else!function(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:y;if(e.lineWidth=f+g,e.lineCap=p,g>0)o.colorStrokeStyle(e,v[0],v[1],v[2],i);else{e.lineCap="butt";return}"straight-triangle"===h?o.drawEdgeTrianglePath(t,e,l.allpts):(o.drawEdgePath(t,e,l.allpts,d),e.lineCap="butt")}();a&&o.drawEdgeUnderlay(e,t),x(),_(),a&&o.drawEdgeOverlay(e,t),o.drawElementText(e,t,null,n),i&&e.translate(r.x1,r.y1)}};var SD=function(e){if(!["overlay","underlay"].includes(e))throw Error("Invalid state");return function(t,i){if(i.visible()){var r=i.pstyle("".concat(e,"-opacity")).value;if(0!==r){var n=this.usePaths(),a=i._private.rscratch,s=i.pstyle("".concat(e,"-padding")).pfValue,o=i.pstyle("".concat(e,"-color")).value;t.lineWidth=2*s,"self"!==a.edgeType||n?t.lineCap="round":t.lineCap="butt",this.colorStrokeStyle(t,o[0],o[1],o[2],r),this.drawEdgePath(i,t,a.allpts,"solid")}}}};SL.drawEdgeOverlay=SD("overlay"),SL.drawEdgeUnderlay=SD("underlay"),SL.drawEdgePath=function(e,t,i,r){var n=e._private.rscratch,a=t,s=!1,o=this.usePaths(),l=e.pstyle("line-dash-pattern").pfValue,c=e.pstyle("line-dash-offset").pfValue;if(o){var u=i.join("$");n.pathCacheKey&&n.pathCacheKey===u?(f=t=n.pathCache,s=!0):(f=t=new Path2D,n.pathCacheKey=u,n.pathCache=f)}if(a.setLineDash)switch(r){case"dotted":a.setLineDash([1,1]);break;case"dashed":a.setLineDash(l),a.lineDashOffset=c;break;case"solid":a.setLineDash([])}if(!s&&!n.badLine)switch(t.beginPath&&t.beginPath(),t.moveTo(i[0],i[1]),n.edgeType){case"bezier":case"self":case"compound":case"multibezier":for(var h=2;h+3<i.length;h+=4)t.quadraticCurveTo(i[h],i[h+1],i[h+2],i[h+3]);break;case"straight":case"haystack":for(var d=2;d+1<i.length;d+=2)t.lineTo(i[d],i[d+1]);break;case"segments":if(n.isRound){var f,p,g=vT(n.roundCorners);try{for(g.s();!(p=g.n()).done;){var v=p.value;PK(t,v)}}catch(e){g.e(e)}finally{g.f()}t.lineTo(i[i.length-2],i[i.length-1])}else for(var y=2;y+1<i.length;y+=2)t.lineTo(i[y],i[y+1])}t=a,o?t.stroke(f):t.stroke(),t.setLineDash&&t.setLineDash([])},SL.drawEdgeTrianglePath=function(e,t,i){t.fillStyle=t.strokeStyle;for(var r=e.pstyle("width").pfValue,n=0;n+1<i.length;n+=2){var a=[i[n+2]-i[n],i[n+3]-i[n+1]],s=Math.sqrt(a[0]*a[0]+a[1]*a[1]),o=[a[1]/s,-a[0]/s],l=[o[0]*r/2,o[1]*r/2];t.beginPath(),t.moveTo(i[n]-l[0],i[n+1]-l[1]),t.lineTo(i[n]+l[0],i[n+1]+l[1]),t.lineTo(i[n+2],i[n+3]),t.closePath(),t.fill()}},SL.drawArrowheads=function(e,t,i){var r=t._private.rscratch,n="haystack"===r.edgeType;n||this.drawArrowhead(e,t,"source",r.arrowStartX,r.arrowStartY,r.srcArrowAngle,i),this.drawArrowhead(e,t,"mid-target",r.midX,r.midY,r.midtgtArrowAngle,i),this.drawArrowhead(e,t,"mid-source",r.midX,r.midY,r.midsrcArrowAngle,i),n||this.drawArrowhead(e,t,"target",r.arrowEndX,r.arrowEndY,r.tgtArrowAngle,i)},SL.drawArrowhead=function(e,t,i,r,n,a,s){if(!(isNaN(r)||null==r||isNaN(n)||null==n||isNaN(a))&&null!=a){var o=t.pstyle(i+"-arrow-shape").value;if("none"!==o){var l="hollow"===t.pstyle(i+"-arrow-fill").value?"both":"filled",c=t.pstyle(i+"-arrow-fill").value,u=t.pstyle("width").pfValue,h=t.pstyle(i+"-arrow-width"),d="match-line"===h.value?u:h.pfValue;"%"===h.units&&(d*=u);var f=t.pstyle("opacity").value;void 0===s&&(s=f);var p=e.globalCompositeOperation;(1!==s||"hollow"===c)&&(e.globalCompositeOperation="destination-out",this.colorFillStyle(e,255,255,255,1),this.colorStrokeStyle(e,255,255,255,1),this.drawArrowShape(t,e,l,u,o,d,r,n,a),e.globalCompositeOperation=p);var g=t.pstyle(i+"-arrow-color").value;this.colorFillStyle(e,g[0],g[1],g[2],s),this.colorStrokeStyle(e,g[0],g[1],g[2],s),this.drawArrowShape(t,e,c,u,o,d,r,n,a)}}},SL.drawArrowShape=function(e,t,i,r,n,a,s,o,l){var c,u=this.usePaths()&&"triangle-cross"!==n,h=!1,d=t,f=e.pstyle("arrow-scale").value,p=this.getArrowWidth(r,f),g=this.arrowShapes[n];if(u){var v=this.arrowPathCache=this.arrowPathCache||[],y=yP(n),b=v[y];null!=b?(c=t=b,h=!0):(c=t=new Path2D,v[y]=c)}!h&&(t.beginPath&&t.beginPath(),u?g.draw(t,1,0,{x:0,y:0},1):g.draw(t,p,l,{x:s,y:o},r),t.closePath&&t.closePath()),t=d,u&&(t.translate(s,o),t.rotate(l),t.scale(p,p)),("filled"===i||"both"===i)&&(u?t.fill(c):t.fill()),("hollow"===i||"both"===i)&&(t.lineWidth=a/(u?p:1),t.lineJoin="miter",u?t.stroke(c):t.stroke()),u&&(t.scale(1/p,1/p),t.rotate(-l),t.translate(-s,-o))};var SO={};SO.safeDrawImage=function(e,t,i,r,n,a,s,o,l,c){if(!(n<=0)&&!(a<=0)&&!(l<=0)&&!(c<=0))try{e.drawImage(t,i,r,n,a,s,o,l,c)}catch(e){yF(e)}},SO.drawInscribedImage=function(e,t,i,r,n){var a=i.position(),s=a.x,o=a.y,l=i.cy().style(),c=l.getIndexedStyle.bind(l),u=c(i,"background-fit","value",r),h=c(i,"background-repeat","value",r),d=i.width(),f=i.height(),p=2*i.padding(),g=d+("inner"===c(i,"background-width-relative-to","value",r)?0:p),v=f+("inner"===c(i,"background-height-relative-to","value",r)?0:p),y=i._private.rscratch,b="node"===c(i,"background-clip","value",r),x=c(i,"background-image-opacity","value",r)*n,_=c(i,"background-image-smoothing","value",r),w=i.pstyle("corner-radius").value;"auto"!==w&&(w=i.pstyle("corner-radius").pfValue);var k=t.width||t.cachedW,E=t.height||t.cachedH;(null==k||null==E)&&(document.body.appendChild(t),k=t.cachedW=t.width||t.offsetWidth,E=t.cachedH=t.height||t.offsetHeight,document.body.removeChild(t));var T=k,P=E;if("auto"!==c(i,"background-width","value",r)&&(T="%"===c(i,"background-width","units",r)?c(i,"background-width","pfValue",r)*g:c(i,"background-width","pfValue",r)),"auto"!==c(i,"background-height","value",r)&&(P="%"===c(i,"background-height","units",r)?c(i,"background-height","pfValue",r)*v:c(i,"background-height","pfValue",r)),0!==T&&0!==P){if("contain"===u){var S=Math.min(g/T,v/P);T*=S,P*=S}else if("cover"===u){var S=Math.max(g/T,v/P);T*=S,P*=S}var M=s-g/2,C=c(i,"background-position-x","units",r),A=c(i,"background-position-x","pfValue",r);"%"===C?M+=(g-T)*A:M+=A;var I=c(i,"background-offset-x","units",r),L=c(i,"background-offset-x","pfValue",r);"%"===I?M+=(g-T)*L:M+=L;var D=o-v/2,O=c(i,"background-position-y","units",r),R=c(i,"background-position-y","pfValue",r);"%"===O?D+=(v-P)*R:D+=R;var N=c(i,"background-offset-y","units",r),j=c(i,"background-offset-y","pfValue",r);"%"===N?D+=(v-P)*j:D+=j,y.pathCache&&(M-=s,D-=o,s=0,o=0);var B=e.globalAlpha;e.globalAlpha=x;var F=this.getImgSmoothing(e),z=!1;if("no"===_&&F?(this.setImgSmoothing(e,!1),z=!0):"yes"!==_||F||(this.setImgSmoothing(e,!0),z=!0),"no-repeat"===h)b&&(e.save(),y.pathCache?e.clip(y.pathCache):(this.nodeShapes[this.getNodeShape(i)].draw(e,s,o,g,v,w,y),e.clip())),this.safeDrawImage(e,t,0,0,k,E,M,D,T,P),b&&e.restore();else{var V=e.createPattern(t,h);e.fillStyle=V,this.nodeShapes[this.getNodeShape(i)].draw(e,s,o,g,v,w,y),e.translate(M,D),e.fill(),e.translate(-M,-D)}e.globalAlpha=B,z&&this.setImgSmoothing(e,F)}};var SR={};function SN(e,t,i,r,n){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:5,s=Math.min(a,r/2,n/2);e.beginPath(),e.moveTo(t+s,i),e.lineTo(t+r-s,i),e.quadraticCurveTo(t+r,i,t+r,i+s),e.lineTo(t+r,i+n-s),e.quadraticCurveTo(t+r,i+n,t+r-s,i+n),e.lineTo(t+s,i+n),e.quadraticCurveTo(t,i+n,t,i+n-s),e.lineTo(t,i+s),e.quadraticCurveTo(t,i,t+s,i),e.closePath()}SR.eleTextBiggerThanMin=function(e,t){return t||(t=Math.pow(2,Math.ceil(bh(e.cy().zoom()*this.getPixelRatio())))),!(e.pstyle("font-size").pfValue*t<e.pstyle("min-zoomed-font-size").pfValue)},SR.drawElementText=function(e,t,i,r,n){var a,s=!(arguments.length>5)||void 0===arguments[5]||arguments[5];if(null==r){if(s&&!this.eleTextBiggerThanMin(t))return}else if(!1===r)return;if(t.isNode()){var o=t.pstyle("label");if(!o||!o.value)return;e.textAlign=this.getLabelJustification(t),e.textBaseline="bottom"}else{var l=t.element()._private.rscratch.badLine,c=t.pstyle("label"),u=t.pstyle("source-label"),h=t.pstyle("target-label");if(l||(!c||!c.value)&&(!u||!u.value)&&(!h||!h.value))return;e.textAlign="center",e.textBaseline="bottom"}var d=!i;i&&(a=i,e.translate(-a.x1,-a.y1)),null==n?(this.drawText(e,t,null,d,s),t.isEdge()&&(this.drawText(e,t,"source",d,s),this.drawText(e,t,"target",d,s))):this.drawText(e,t,n,d,s),i&&e.translate(a.x1,a.y1)},SR.getFontCache=function(e){var t;this.fontCaches=this.fontCaches||[];for(var i=0;i<this.fontCaches.length;i++)if((t=this.fontCaches[i]).context===e)return t;return t={context:e},this.fontCaches.push(t),t},SR.setupTextStyle=function(e,t){var i=!(arguments.length>2)||void 0===arguments[2]||arguments[2],r=t.pstyle("font-style").strValue,n=t.pstyle("font-size").pfValue+"px",a=t.pstyle("font-family").strValue,s=t.pstyle("font-weight").strValue,o=i?t.effectiveOpacity()*t.pstyle("text-opacity").value:1,l=t.pstyle("text-outline-opacity").value*o,c=t.pstyle("color").value,u=t.pstyle("text-outline-color").value;e.font=r+" "+s+" "+n+" "+a,e.lineJoin="round",this.colorFillStyle(e,c[0],c[1],c[2],o),this.colorStrokeStyle(e,u[0],u[1],u[2],l)},SR.getTextAngle=function(e,t){var i,r=e._private.rscratch,n=t?t+"-":"",a=e.pstyle(n+"text-rotation");if("autorotate"===a.strValue){var s=yY(r,"labelAngle",t);i=e.isEdge()?s:0}else i="none"===a.strValue?0:a.pfValue;return i},SR.drawText=function(e,t,i){var r=!(arguments.length>3)||void 0===arguments[3]||arguments[3],n=!(arguments.length>4)||void 0===arguments[4]||arguments[4],a=t._private.rscratch,s=n?t.effectiveOpacity():1;if(!n||0!==s&&0!==t.pstyle("text-opacity").value){"main"===i&&(i=null);var o=yY(a,"labelX",i),l=yY(a,"labelY",i),c=this.getLabelText(t,i);if(null!=c&&""!==c&&!isNaN(o)&&!isNaN(l)){this.setupTextStyle(e,t,n);var u,h,d,f=i?i+"-":"",p=yY(a,"labelWidth",i),g=yY(a,"labelHeight",i),v=t.pstyle(f+"text-margin-x").pfValue,y=t.pstyle(f+"text-margin-y").pfValue,b=t.isEdge(),x=t.pstyle("text-halign").value,_=t.pstyle("text-valign").value;switch(b&&(x="center",_="center"),o+=v,l+=y,0!==(d=r?this.getTextAngle(t,i):0)&&(u=o,h=l,e.translate(u,h),e.rotate(d),o=0,l=0),_){case"top":break;case"center":l+=g/2;break;case"bottom":l+=g}var w=t.pstyle("text-background-opacity").value,k=t.pstyle("text-border-opacity").value,E=t.pstyle("text-border-width").pfValue,T=t.pstyle("text-background-padding").pfValue,P=t.pstyle("text-background-shape").strValue,S="round-rectangle"===P||"roundrectangle"===P;if(w>0||E>0&&k>0){var M,C,A=e.fillStyle,I=e.strokeStyle,L=e.lineWidth,D=t.pstyle("text-background-color").value,O=t.pstyle("text-border-color").value,R=t.pstyle("text-border-style").value,N=w>0,j=E>0&&k>0,B=o-T;switch(x){case"left":B-=p;break;case"center":B-=p/2}var F=l-g-T,z=p+2*T,V=g+2*T;if(N&&(e.fillStyle="rgba(".concat(D[0],",").concat(D[1],",").concat(D[2],",").concat(w*s,")")),j&&(e.strokeStyle="rgba(".concat(O[0],",").concat(O[1],",").concat(O[2],",").concat(k*s,")"),e.lineWidth=E,e.setLineDash))switch(R){case"dotted":e.setLineDash([1,1]);break;case"dashed":e.setLineDash([4,2]);break;case"double":e.lineWidth=E/4,e.setLineDash([]);break;default:e.setLineDash([])}if(S?(e.beginPath(),SN(e,B,F,z,V,2)):"circle"===P?(e.beginPath(),M=B,C=Math.min(z,V),e.beginPath(),e.arc(M+z/2,F+V/2,C/2,0,2*Math.PI),e.closePath()):(e.beginPath(),e.rect(B,F,z,V)),N&&e.fill(),j&&e.stroke(),j&&"double"===R){var U=E/2;e.beginPath(),S?SN(e,B+U,F+U,z-2*U,V-2*U,2):e.rect(B+U,F+U,z-2*U,V-2*U),e.stroke()}e.fillStyle=A,e.strokeStyle=I,e.lineWidth=L,e.setLineDash&&e.setLineDash([])}var $=2*t.pstyle("text-outline-width").pfValue;if($>0&&(e.lineWidth=$),"wrap"===t.pstyle("text-wrap").value){var W=yY(a,"labelWrapCachedLines",i),H=yY(a,"labelLineHeight",i),q=p/2,G=this.getLabelJustification(t);switch("auto"===G||("left"===x?"left"===G?o+=-p:"center"===G&&(o+=-q):"center"===x?"left"===G?o+=-q:"right"===G&&(o+=q):"right"===x&&("center"===G?o+=q:"right"===G&&(o+=p))),_){case"top":case"center":case"bottom":l-=(W.length-1)*H}for(var Y=0;Y<W.length;Y++)$>0&&e.strokeText(W[Y],o,l),e.fillText(W[Y],o,l),l+=H}else $>0&&e.strokeText(c,o,l),e.fillText(c,o,l);0!==d&&(e.rotate(-d),e.translate(-u,-h))}}};var Sj={};Sj.drawNode=function(e,t,i){var r,n,a,s,o=!(arguments.length>3)||void 0===arguments[3]||arguments[3],l=!(arguments.length>4)||void 0===arguments[4]||arguments[4],c=!(arguments.length>5)||void 0===arguments[5]||arguments[5],u=this,h=t._private,d=h.rscratch,f=t.position();if(v$(f.x)&&v$(f.y)&&(!c||t.visible())){var p=c?t.effectiveOpacity():1,g=u.usePaths(),v=!1,y=t.padding();r=t.width()+2*y,n=t.height()+2*y,i&&(s=i,e.translate(-s.x1,-s.y1));for(var b=t.pstyle("background-image").value,x=Array(b.length),_=Array(b.length),w=0,k=0;k<b.length;k++){var E=b[k];if(x[k]=null!=E&&"none"!==E){var T=t.cy().style().getIndexedStyle(t,"background-image-crossorigin","value",k);w++,_[k]=u.getCachedImage(E,T,function(){h.backgroundTimestamp=Date.now(),t.emitAndNotify("background")})}}var P=t.pstyle("background-blacken").value,S=t.pstyle("border-width").pfValue,M=t.pstyle("background-opacity").value*p,C=t.pstyle("border-color").value,A=t.pstyle("border-style").value,I=t.pstyle("border-join").value,L=t.pstyle("border-cap").value,D=t.pstyle("border-position").value,O=t.pstyle("border-dash-pattern").pfValue,R=t.pstyle("border-dash-offset").pfValue,N=t.pstyle("border-opacity").value*p,j=t.pstyle("outline-width").pfValue,B=t.pstyle("outline-color").value,F=t.pstyle("outline-style").value,z=t.pstyle("outline-opacity").value*p,V=t.pstyle("outline-offset").value,U=t.pstyle("corner-radius").value;"auto"!==U&&(U=t.pstyle("corner-radius").pfValue);var $=function(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M;u.eleFillStyle(e,t,i)},W=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:N;u.colorStrokeStyle(e,C[0],C[1],C[2],t)},H=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:z;u.colorStrokeStyle(e,B[0],B[1],B[2],t)},q=function(e,t,i,r){var n,a=u.nodePathCache=u.nodePathCache||[],s=yS("polygon"===i?i+","+r.join(","):i,""+t,""+e,""+U),o=a[s],l=!1;return null!=o?(l=!0,d.pathCache=n=o):(n=new Path2D,a[s]=d.pathCache=n),{path:n,cacheHit:l}},G=t.pstyle("shape").strValue,Y=t.pstyle("shape-polygon-points").pfValue;if(g){e.translate(f.x,f.y);var X=q(r,n,G,Y);a=X.path,v=X.cacheHit}var K=function(){if(!v){var i=f;g&&(i={x:0,y:0}),u.nodeShapes[u.getNodeShape(t)].draw(a||e,i.x,i.y,r,n,U,d)}g?e.fill(a):e.fill()},Z=function(){for(var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:p,r=!(arguments.length>1)||void 0===arguments[1]||arguments[1],n=h.backgrounding,a=0,s=0;s<_.length;s++){var o=t.cy().style().getIndexedStyle(t,"background-image-containment","value",s);if(r&&"over"===o||!r&&"inside"===o){a++;continue}x[s]&&_[s].complete&&!_[s].error&&(a++,u.drawInscribedImage(e,_[s],t,s,i))}h.backgrounding=a!==w,n!==h.backgrounding&&t.updateStyle(!1)},J=function(){var i=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:p;u.hasPie(t)&&(u.drawPie(e,t,a),i&&!g&&u.nodeShapes[u.getNodeShape(t)].draw(e,f.x,f.y,r,n,U,d))},Q=function(){var i=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:p;u.hasStripe(t)&&(e.save(),g?e.clip(d.pathCache):(u.nodeShapes[u.getNodeShape(t)].draw(e,f.x,f.y,r,n,U,d),e.clip()),u.drawStripe(e,t,a),e.restore(),i&&!g&&u.nodeShapes[u.getNodeShape(t)].draw(e,f.x,f.y,r,n,U,d))},ee=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:p,i=P>0?0:255;0!==P&&(u.colorFillStyle(e,i,i,i,(P>0?P:-P)*t),g?e.fill(a):e.fill())},et=function(){if(S>0){if(e.lineWidth=S,e.lineCap=L,e.lineJoin=I,e.setLineDash)switch(A){case"dotted":e.setLineDash([1,1]);break;case"dashed":e.setLineDash(O),e.lineDashOffset=R;break;case"solid":case"double":e.setLineDash([])}if("center"!==D){if(e.save(),e.lineWidth*=2,"inside"===D)g?e.clip(a):e.clip();else{var t=new Path2D;t.rect(-r/2-S,-n/2-S,r+2*S,n+2*S),t.addPath(a),e.clip(t,"evenodd")}g?e.stroke(a):e.stroke(),e.restore()}else g?e.stroke(a):e.stroke();if("double"===A){e.lineWidth=S/3;var i=e.globalCompositeOperation;e.globalCompositeOperation="destination-out",g?e.stroke(a):e.stroke(),e.globalCompositeOperation=i}e.setLineDash&&e.setLineDash([])}},ei=function(){if(j>0){if(e.lineWidth=j,e.lineCap="butt",e.setLineDash)switch(F){case"dotted":e.setLineDash([1,1]);break;case"dashed":e.setLineDash([4,2]);break;case"solid":case"double":e.setLineDash([])}var i=f;g&&(i={x:0,y:0});var a=u.getNodeShape(t),s=S;"inside"===D&&(s=0),"outside"===D&&(s*=2);var o=(r+s+(j+V))/r,l=(n+s+(j+V))/n,c=r*o,h=n*l,d=u.nodeShapes[a].points;if(g&&(T=q(c,h,a,d).path),"ellipse"===a)u.drawEllipsePath(T||e,i.x,i.y,c,h);else if(["round-diamond","round-heptagon","round-hexagon","round-octagon","round-pentagon","round-polygon","round-triangle","round-tag"].includes(a)){var p=0,v=0,y=0;"round-diamond"===a?p=(s+V+j)*1.4:"round-heptagon"===a?(p=(s+V+j)*1.075,y=-(s/2+V+j)/35):"round-hexagon"===a?p=(s+V+j)*1.12:"round-pentagon"===a?(p=(s+V+j)*1.13,y=-(s/2+V+j)/15):"round-tag"===a?(p=(s+V+j)*1.12,v=(s/2+j+V)*.07):"round-triangle"===a&&(p=Math.PI/2*(s+V+j),y=-(s+V/2+j)/Math.PI),0!==p&&(o=(r+p)/r,c=r*o,["round-hexagon","round-tag"].includes(a)||(l=(n+p)/n,h=n*l)),U="auto"===U?b3(c,h):U;for(var b=c/2,x=h/2,_=U+(s+j+V)/2,w=Array(d.length/2),k=Array(d.length/2),E=0;E<d.length/2;E++)w[E]={x:i.x+v+b*d[2*E],y:i.y+y+x*d[2*E+1]};var T,P,M,C,A,I=w.length;for(P=0,M=w[I-1];P<I;P++)C=w[P%I],A=w[(P+1)%I],k[P]=PZ(M,C,A,_),M=C,C=A;u.drawRoundPolygonPath(T||e,i.x+v,i.y+y,r*o,n*l,d,k)}else["roundrectangle","round-rectangle"].includes(a)?(U="auto"===U?b2(c,h):U,u.drawRoundRectanglePath(T||e,i.x,i.y,c,h,U+(s+j+V)/2)):["cutrectangle","cut-rectangle"].includes(a)?(U="auto"===U?b4():U,u.drawCutRectanglePath(T||e,i.x,i.y,c,h,null,U+(s+j+V)/4)):["bottomroundrectangle","bottom-round-rectangle"].includes(a)?(U="auto"===U?b2(c,h):U,u.drawBottomRoundRectanglePath(T||e,i.x,i.y,c,h,U+(s+j+V)/2)):"barrel"===a?u.drawBarrelPath(T||e,i.x,i.y,c,h):(d=a.startsWith("polygon")||["rhomboid","right-rhomboid","round-tag","tag","vee"].includes(a)?bU(b$(d,(s+j+V)/r)):bU(b$(d,-((s+j+V)/r))),u.drawPolygonPath(T||e,i.x,i.y,r,n,d));if(g?e.stroke(T):e.stroke(),"double"===F){e.lineWidth=s/3;var L=e.globalCompositeOperation;e.globalCompositeOperation="destination-out",g?e.stroke(T):e.stroke(),e.globalCompositeOperation=L}e.setLineDash&&e.setLineDash([])}};if("yes"===t.pstyle("ghost").value){var er=t.pstyle("ghost-offset-x").pfValue,en=t.pstyle("ghost-offset-y").pfValue,ea=t.pstyle("ghost-opacity").value,es=ea*p;e.translate(er,en),H(),ei(),$(ea*M),K(),Z(es,!0),W(ea*N),et(),J(0!==P||0!==S),Q(0!==P||0!==S),Z(es,!1),ee(es),e.translate(-er,-en)}g&&e.translate(-f.x,-f.y),l&&u.drawNodeUnderlay(e,t,f,r,n),g&&e.translate(f.x,f.y),H(),ei(),$(),K(),Z(p,!0),W(),et(),J(0!==P||0!==S),Q(0!==P||0!==S),Z(p,!1),ee(),g&&e.translate(-f.x,-f.y),u.drawElementText(e,t,null,o),l&&u.drawNodeOverlay(e,t,f,r,n),i&&e.translate(s.x1,s.y1)}};var SB=function(e){if(!["overlay","underlay"].includes(e))throw Error("Invalid state");return function(t,i,r,n,a){if(i.visible()){var s=i.pstyle("".concat(e,"-padding")).pfValue,o=i.pstyle("".concat(e,"-opacity")).value,l=i.pstyle("".concat(e,"-color")).value,c=i.pstyle("".concat(e,"-shape")).value,u=i.pstyle("".concat(e,"-corner-radius")).value;if(o>0){if(r=r||i.position(),null==n||null==a){var h=i.padding();n=i.width()+2*h,a=i.height()+2*h}this.colorFillStyle(t,l[0],l[1],l[2],o),this.nodeShapes[c].draw(t,r.x,r.y,n+2*s,a+2*s,u),t.fill()}}}};Sj.drawNodeOverlay=SB("overlay"),Sj.drawNodeUnderlay=SB("underlay"),Sj.hasPie=function(e){return(e=e[0])._private.hasPie},Sj.hasStripe=function(e){return(e=e[0])._private.hasStripe},Sj.drawPie=function(e,t,i,r){t=t[0],r=r||t.position();var n,a=t.cy().style(),s=t.pstyle("pie-size"),o=t.pstyle("pie-hole"),l=t.pstyle("pie-start-angle").pfValue,c=r.x,u=r.y,h=Math.min(t.width(),t.height())/2,d=0;if(this.usePaths()&&(c=0,u=0),"%"===s.units?h*=s.pfValue:void 0!==s.pfValue&&(h=s.pfValue/2),"%"===o.units?n=h*o.pfValue:void 0!==o.pfValue&&(n=o.pfValue/2),!(n>=h))for(var f=1;f<=a.pieBackgroundN;f++){var p=t.pstyle("pie-"+f+"-background-size").value,g=t.pstyle("pie-"+f+"-background-color").value,v=t.pstyle("pie-"+f+"-background-opacity").value*i,y=p/100;y+d>1&&(y=1-d);var b=1.5*Math.PI+2*Math.PI*d,x=2*Math.PI*y,_=(b+=l)+x;0===p||d>=1||d+y>1||(0===n?(e.beginPath(),e.moveTo(c,u),e.arc(c,u,h,b,_)):(e.beginPath(),e.arc(c,u,h,b,_),e.arc(c,u,n,_,b,!0)),e.closePath(),this.colorFillStyle(e,g[0],g[1],g[2],v),e.fill(),d+=y)}},Sj.drawStripe=function(e,t,i,r){t=t[0],r=r||t.position();var n=t.cy().style(),a=r.x,s=r.y,o=t.width(),l=t.height(),c=0,u=this.usePaths();e.save();var h=t.pstyle("stripe-direction").value,d=t.pstyle("stripe-size");switch(h){case"vertical":break;case"righward":e.rotate(-Math.PI/2)}var f=o,p=l;"%"===d.units?(f*=d.pfValue,p*=d.pfValue):void 0!==d.pfValue&&(f=d.pfValue,p=d.pfValue),u&&(a=0,s=0),s-=f/2,a-=p/2;for(var g=1;g<=n.stripeBackgroundN;g++){var v=t.pstyle("stripe-"+g+"-background-size").value,y=t.pstyle("stripe-"+g+"-background-color").value,b=t.pstyle("stripe-"+g+"-background-opacity").value*i,x=v/100;x+c>1&&(x=1-c),0===v||c>=1||c+x>1||(e.beginPath(),e.rect(a,s+p*c,f,p*x),e.closePath(),this.colorFillStyle(e,y[0],y[1],y[2],b),e.fill(),c+=x)}e.restore()};var SF={};function Sz(e,t,i){var r=e.createShader(t);if(e.shaderSource(r,i),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS))throw Error(e.getShaderInfoLog(r));return r}function SV(e,t,i){void 0===i&&(i=t);var r=e.makeOffscreenCanvas(t,i),n=r.context=r.getContext("2d");return r.clear=function(){return n.clearRect(0,0,r.width,r.height)},r.clear(),r}function SU(e){var t=e.pixelRatio,i=e.cy.zoom(),r=e.cy.pan();return{zoom:i*t,pan:{x:r.x*t,y:r.y*t}}}function S$(e){return"solid"===e.pstyle("background-fill").value&&"none"===e.pstyle("background-image").strValue&&(0===e.pstyle("border-width").value||0===e.pstyle("border-opacity").value||"solid"===e.pstyle("border-style").value)}function SW(e,t,i){var r=e[0]/255,n=e[1]/255,a=e[2]/255,s=i||[,,,,];return s[0]=r*t,s[1]=n*t,s[2]=a*t,s[3]=t,s}function SH(e,t){var i=t||[,,,,];return i[0]=(255&e)/255,i[1]=(e>>8&255)/255,i[2]=(e>>16&255)/255,i[3]=(e>>24&255)/255,i}function Sq(e,t){switch(t){case"float":return[1,e.FLOAT,4];case"vec2":return[2,e.FLOAT,4];case"vec3":return[3,e.FLOAT,4];case"vec4":return[4,e.FLOAT,4];case"int":return[1,e.INT,4];case"ivec2":return[2,e.INT,4]}}function SG(e,t,i){switch(t){case e.FLOAT:return new Float32Array(i);case e.INT:return new Int32Array(i)}}function SY(e,t,i,r){var n=vS(Sq(e,i),3),a=n[0],s=n[1],o=n[2],l=SG(e,s,t*a),c=a*o,u=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,u),e.bufferData(e.ARRAY_BUFFER,t*c,e.DYNAMIC_DRAW),e.enableVertexAttribArray(r),s===e.FLOAT?e.vertexAttribPointer(r,a,s,!1,c,0):s===e.INT&&e.vertexAttribIPointer(r,a,s,c,0),e.vertexAttribDivisor(r,1),e.bindBuffer(e.ARRAY_BUFFER,null);for(var h=Array(t),d=0;d<t;d++)h[d]=function(e,t,i,r,n,a){switch(t){case e.FLOAT:return new Float32Array(i.buffer,a*r,n);case e.INT:return new Int32Array(i.buffer,a*r,n)}}(e,s,l,c,a,d);return u.dataArray=l,u.stride=c,u.size=a,u.getView=function(e){return h[e]},u.setPoint=function(e,t,i){var r=h[e];r[0]=t,r[1]=i},u.bufferSubData=function(t){e.bindBuffer(e.ARRAY_BUFFER,u),t?e.bufferSubData(e.ARRAY_BUFFER,0,l,0,t*a):e.bufferSubData(e.ARRAY_BUFFER,0,l)},u}SF.getPixelRatio=function(){var e=this.data.contexts[0];if(null!=this.forcedPixelRatio)return this.forcedPixelRatio;var t=this.cy.window(),i=e.backingStorePixelRatio||e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;return(t.devicePixelRatio||1)/i},SF.paintCache=function(e){for(var t,i=this.paintCaches=this.paintCaches||[],r=!0,n=0;n<i.length;n++)if((t=i[n]).context===e){r=!1;break}return r&&(t={context:e},i.push(t)),t},SF.createGradientStyleFor=function(e,t,i,r,n){var a,s=this.usePaths(),o=i.pstyle(t+"-gradient-stop-colors").value,l=i.pstyle(t+"-gradient-stop-positions").pfValue;if("radial-gradient"===r)if(i.isEdge()){var c=i.sourceEndpoint(),u=i.targetEndpoint(),h=i.midpoint(),d=bf(c,h),f=bf(u,h);a=e.createRadialGradient(h.x,h.y,0,h.x,h.y,Math.max(d,f))}else{var p=s?{x:0,y:0}:i.position(),g=i.paddedWidth(),v=i.paddedHeight();a=e.createRadialGradient(p.x,p.y,0,p.x,p.y,Math.max(g,v))}else if(i.isEdge()){var y=i.sourceEndpoint(),b=i.targetEndpoint();a=e.createLinearGradient(y.x,y.y,b.x,b.y)}else{var x=s?{x:0,y:0}:i.position(),_=i.paddedWidth(),w=i.paddedHeight(),k=_/2,E=w/2;switch(i.pstyle("background-gradient-direction").value){case"to-bottom":a=e.createLinearGradient(x.x,x.y-E,x.x,x.y+E);break;case"to-top":a=e.createLinearGradient(x.x,x.y+E,x.x,x.y-E);break;case"to-left":a=e.createLinearGradient(x.x+k,x.y,x.x-k,x.y);break;case"to-right":a=e.createLinearGradient(x.x-k,x.y,x.x+k,x.y);break;case"to-bottom-right":case"to-right-bottom":a=e.createLinearGradient(x.x-k,x.y-E,x.x+k,x.y+E);break;case"to-top-right":case"to-right-top":a=e.createLinearGradient(x.x-k,x.y+E,x.x+k,x.y-E);break;case"to-bottom-left":case"to-left-bottom":a=e.createLinearGradient(x.x+k,x.y-E,x.x-k,x.y+E);break;case"to-top-left":case"to-left-top":a=e.createLinearGradient(x.x+k,x.y+E,x.x-k,x.y-E)}}if(!a)return null;for(var T=l.length===o.length,P=o.length,S=0;S<P;S++)a.addColorStop(T?l[S]:S/(P-1),"rgba("+o[S][0]+","+o[S][1]+","+o[S][2]+","+n+")");return a},SF.gradientFillStyle=function(e,t,i,r){var n=this.createGradientStyleFor(e,"background",t,i,r);if(!n)return null;e.fillStyle=n},SF.colorFillStyle=function(e,t,i,r,n){e.fillStyle="rgba("+t+","+i+","+r+","+n+")"},SF.eleFillStyle=function(e,t,i){var r=t.pstyle("background-fill").value;if("linear-gradient"===r||"radial-gradient"===r)this.gradientFillStyle(e,t,r,i);else{var n=t.pstyle("background-color").value;this.colorFillStyle(e,n[0],n[1],n[2],i)}},SF.gradientStrokeStyle=function(e,t,i,r){var n=this.createGradientStyleFor(e,"line",t,i,r);if(!n)return null;e.strokeStyle=n},SF.colorStrokeStyle=function(e,t,i,r,n){e.strokeStyle="rgba("+t+","+i+","+r+","+n+")"},SF.eleStrokeStyle=function(e,t,i){var r=t.pstyle("line-fill").value;if("linear-gradient"===r||"radial-gradient"===r)this.gradientStrokeStyle(e,t,r,i);else{var n=t.pstyle("line-color").value;this.colorStrokeStyle(e,n[0],n[1],n[2],i)}},SF.matchCanvasSize=function(e){var t,i=this.data,r=this.findContainerClientCoords(),n=r[2],a=r[3],s=this.getPixelRatio(),o=this.motionBlurPxRatio;(e===this.data.bufferCanvases[this.MOTIONBLUR_BUFFER_NODE]||e===this.data.bufferCanvases[this.MOTIONBLUR_BUFFER_DRAG])&&(s=o);var l=n*s,c=a*s;if(l!==this.canvasWidth||c!==this.canvasHeight){this.fontCaches=null;var u=i.canvasContainer;u.style.width=n+"px",u.style.height=a+"px";for(var h=0;h<this.CANVAS_LAYERS;h++)(t=i.canvases[h]).width=l,t.height=c,t.style.width=n+"px",t.style.height=a+"px";for(var h=0;h<this.BUFFER_COUNT;h++)(t=i.bufferCanvases[h]).width=l,t.height=c,t.style.width=n+"px",t.style.height=a+"px";this.textureMult=1,s<=1&&(t=i.bufferCanvases[this.TEXTURE_BUFFER],this.textureMult=2,t.width=l*this.textureMult,t.height=c*this.textureMult),this.canvasWidth=l,this.canvasHeight=c,this.pixelRatio=s}},SF.renderTo=function(e,t,i,r){this.render({forcedContext:e,forcedZoom:t,forcedPan:i,drawAllLayers:!0,forcedPxRatio:r})},SF.clearCanvas=function(){var e=this,t=e.data;function i(t){t.clearRect(0,0,e.canvasWidth,e.canvasHeight)}i(t.contexts[e.NODE]),i(t.contexts[e.DRAG])},SF.render=function(e){var t=this;e=e||y$();var i=t.cy,r=e.forcedContext,n=e.drawAllLayers,a=e.drawOnlyNodeLayer,s=e.forcedZoom,o=e.forcedPan,l=void 0===e.forcedPxRatio?this.getPixelRatio():e.forcedPxRatio,c=t.data,u=c.canvasNeedsRedraw,h=t.textureOnViewport&&!r&&(t.pinching||t.hoverData.dragging||t.swipePanning||t.data.wheelZooming),d=void 0!==e.motionBlur?e.motionBlur:t.motionBlur,f=t.motionBlurPxRatio,p=i.hasCompoundNodes(),g=t.hoverData.draggingEles,v=!!t.hoverData.selecting||!!t.touchData.selecting,y=d=d&&!r&&t.motionBlurEnabled&&!v;r||(t.prevPxRatio!==l&&(t.invalidateContainerClientCoordsCache(),t.matchCanvasSize(t.container),t.redrawHint("eles",!0),t.redrawHint("drag",!0)),t.prevPxRatio=l),!r&&t.motionBlurTimeout&&clearTimeout(t.motionBlurTimeout),d&&(null==t.mbFrames&&(t.mbFrames=0),t.mbFrames++,t.mbFrames<3&&(y=!1),t.mbFrames>t.minMbLowQualFrames&&(t.motionBlurPxRatio=t.mbPxRBlurry)),t.clearingMotionBlur&&(t.motionBlurPxRatio=1),t.textureDrawLastFrame&&!h&&(u[t.NODE]=!0,u[t.SELECT_BOX]=!0);var b=i.style(),x=i.zoom(),_=void 0!==s?s:x,w=i.pan(),k={x:w.x,y:w.y},E={zoom:x,pan:{x:w.x,y:w.y}},T=t.prevViewport;void 0===T||E.zoom!==T.zoom||E.pan.x!==T.pan.x||E.pan.y!==T.pan.y||g&&!p||(t.motionBlurPxRatio=1),o&&(k=o),_*=l,k.x*=l,k.y*=l;var P=t.getCachedZSortedEles();function S(e,i,r,n,a){var s=e.globalCompositeOperation;e.globalCompositeOperation="destination-out",t.colorFillStyle(e,255,255,255,t.motionBlurTransparency),e.fillRect(i,r,n,a),e.globalCompositeOperation=s}function M(e,i){var a,l,u,h;t.clearingMotionBlur||e!==c.bufferContexts[t.MOTIONBLUR_BUFFER_NODE]&&e!==c.bufferContexts[t.MOTIONBLUR_BUFFER_DRAG]?(a=k,l=_,u=t.canvasWidth,h=t.canvasHeight):(a={x:w.x*f,y:w.y*f},l=x*f,u=t.canvasWidth*f,h=t.canvasHeight*f),e.setTransform(1,0,0,1,0,0),"motionBlur"===i?S(e,0,0,u,h):!r&&(void 0===i||i)&&e.clearRect(0,0,u,h),n||(e.translate(a.x,a.y),e.scale(l,l)),o&&e.translate(o.x,o.y),s&&e.scale(s,s)}if(h||(t.textureDrawLastFrame=!1),h){if(t.textureDrawLastFrame=!0,!t.textureCache){t.textureCache={},t.textureCache.bb=i.mutableElements().boundingBox(),t.textureCache.texture=t.data.bufferCanvases[t.TEXTURE_BUFFER];var C=t.data.bufferContexts[t.TEXTURE_BUFFER];C.setTransform(1,0,0,1,0,0),C.clearRect(0,0,t.canvasWidth*t.textureMult,t.canvasHeight*t.textureMult),t.render({forcedContext:C,drawOnlyNodeLayer:!0,forcedPxRatio:l*t.textureMult});var E=t.textureCache.viewport={zoom:i.zoom(),pan:i.pan(),width:t.canvasWidth,height:t.canvasHeight};E.mpan={x:(0-E.pan.x)/E.zoom,y:(0-E.pan.y)/E.zoom}}u[t.DRAG]=!1,u[t.NODE]=!1;var A=c.contexts[t.NODE],I=t.textureCache.texture,E=t.textureCache.viewport;A.setTransform(1,0,0,1,0,0),d?S(A,0,0,E.width,E.height):A.clearRect(0,0,E.width,E.height);var L=b.core("outside-texture-bg-color").value,D=b.core("outside-texture-bg-opacity").value;t.colorFillStyle(A,L[0],L[1],L[2],D),A.fillRect(0,0,E.width,E.height);var x=i.zoom();M(A,!1),A.clearRect(E.mpan.x,E.mpan.y,E.width/E.zoom/l,E.height/E.zoom/l),A.drawImage(I,E.mpan.x,E.mpan.y,E.width/E.zoom/l,E.height/E.zoom/l)}else t.textureOnViewport&&!r&&(t.textureCache=null);var O=i.extent(),R=t.pinching||t.hoverData.dragging||t.swipePanning||t.data.wheelZooming||t.hoverData.draggingEles||t.cy.animated(),N=t.hideEdgesOnViewport&&R,j=[];if(j[t.NODE]=!u[t.NODE]&&d&&!t.clearedForMotionBlur[t.NODE]||t.clearingMotionBlur,j[t.NODE]&&(t.clearedForMotionBlur[t.NODE]=!0),j[t.DRAG]=!u[t.DRAG]&&d&&!t.clearedForMotionBlur[t.DRAG]||t.clearingMotionBlur,j[t.DRAG]&&(t.clearedForMotionBlur[t.DRAG]=!0),u[t.NODE]||n||a||j[t.NODE]){var B=d&&!j[t.NODE]&&1!==f,A=r||(B?t.data.bufferContexts[t.MOTIONBLUR_BUFFER_NODE]:c.contexts[t.NODE]);M(A,d&&!B?"motionBlur":void 0),N?t.drawCachedNodes(A,P.nondrag,l,O):t.drawLayeredElements(A,P.nondrag,l,O),t.debug&&t.drawDebugPoints(A,P.nondrag),n||d||(u[t.NODE]=!1)}if(!a&&(u[t.DRAG]||n||j[t.DRAG])){var B=d&&!j[t.DRAG]&&1!==f,A=r||(B?t.data.bufferContexts[t.MOTIONBLUR_BUFFER_DRAG]:c.contexts[t.DRAG]);M(A,d&&!B?"motionBlur":void 0),N?t.drawCachedNodes(A,P.drag,l,O):t.drawCachedElements(A,P.drag,l,O),t.debug&&t.drawDebugPoints(A,P.drag),n||d||(u[t.DRAG]=!1)}if(this.drawSelectionRectangle(e,M),d&&1!==f){var F=c.contexts[t.NODE],z=t.data.bufferCanvases[t.MOTIONBLUR_BUFFER_NODE],V=c.contexts[t.DRAG],U=t.data.bufferCanvases[t.MOTIONBLUR_BUFFER_DRAG],$=function(e,i,r){e.setTransform(1,0,0,1,0,0),r||!y?e.clearRect(0,0,t.canvasWidth,t.canvasHeight):S(e,0,0,t.canvasWidth,t.canvasHeight),e.drawImage(i,0,0,t.canvasWidth*f,t.canvasHeight*f,0,0,t.canvasWidth,t.canvasHeight)};(u[t.NODE]||j[t.NODE])&&($(F,z,j[t.NODE]),u[t.NODE]=!1),(u[t.DRAG]||j[t.DRAG])&&($(V,U,j[t.DRAG]),u[t.DRAG]=!1)}t.prevViewport=E,t.clearingMotionBlur&&(t.clearingMotionBlur=!1,t.motionBlurCleared=!0,t.motionBlur=!0),d&&(t.motionBlurTimeout=setTimeout(function(){t.motionBlurTimeout=null,t.clearedForMotionBlur[t.NODE]=!1,t.clearedForMotionBlur[t.DRAG]=!1,t.motionBlur=!1,t.clearingMotionBlur=!h,t.mbFrames=0,u[t.NODE]=!0,u[t.DRAG]=!0,t.redraw()},100)),r||i.emit("render")},SF.drawSelectionRectangle=function(e,t){var i=this.cy,r=this.data,n=i.style(),a=e.drawOnlyNodeLayer,s=e.drawAllLayers,o=r.canvasNeedsRedraw,l=e.forcedContext;if(this.showFps||!a&&o[this.SELECT_BOX]&&!s){var c=l||r.contexts[this.SELECT_BOX];if(t(c),1==this.selection[4]&&(this.hoverData.selecting||this.touchData.selecting)){var u=this.cy.zoom(),h=n.core("selection-box-border-width").value/u;c.lineWidth=h,c.fillStyle="rgba("+n.core("selection-box-color").value[0]+","+n.core("selection-box-color").value[1]+","+n.core("selection-box-color").value[2]+","+n.core("selection-box-opacity").value+")",c.fillRect(this.selection[0],this.selection[1],this.selection[2]-this.selection[0],this.selection[3]-this.selection[1]),h>0&&(c.strokeStyle="rgba("+n.core("selection-box-border-color").value[0]+","+n.core("selection-box-border-color").value[1]+","+n.core("selection-box-border-color").value[2]+","+n.core("selection-box-opacity").value+")",c.strokeRect(this.selection[0],this.selection[1],this.selection[2]-this.selection[0],this.selection[3]-this.selection[1]))}if(r.bgActivePosistion&&!this.hoverData.selecting){var u=this.cy.zoom(),d=r.bgActivePosistion;c.fillStyle="rgba("+n.core("active-bg-color").value[0]+","+n.core("active-bg-color").value[1]+","+n.core("active-bg-color").value[2]+","+n.core("active-bg-opacity").value+")",c.beginPath(),c.arc(d.x,d.y,n.core("active-bg-size").pfValue/u,0,2*Math.PI),c.fill()}var f=this.lastRedrawTime;if(this.showFps&&f){var p=Math.round(1e3/(f=Math.round(f))),g="1 frame = "+f+" ms = "+p+" fps";c.setTransform(1,0,0,1,0,0),c.fillStyle="rgba(255, 0, 0, 0.75)",c.strokeStyle="rgba(255, 0, 0, 0.75)",c.font="30px Arial",y||(y=c.measureText(g).actualBoundingBoxAscent),c.fillText(g,0,y),c.strokeRect(0,y+10,250,20),c.fillRect(0,y+10,250*Math.min(p/60,1),20)}s||(o[this.SELECT_BOX]=!1)}};var SX="undefined"!=typeof Float32Array?Float32Array:Array;function SK(){var e=new SX(9);return SX!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function SZ(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function SJ(e,t,i){var r=t[0],n=t[1],a=t[2],s=t[3],o=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=i[0],f=i[1];return e[0]=r,e[1]=n,e[2]=a,e[3]=s,e[4]=o,e[5]=l,e[6]=d*r+f*s+c,e[7]=d*n+f*o+u,e[8]=d*a+f*l+h,e}function SQ(e,t,i){var r=t[0],n=t[1],a=t[2],s=t[3],o=t[4],l=t[5],c=t[6],u=t[7],h=t[8],d=Math.sin(i),f=Math.cos(i);return e[0]=f*r+d*s,e[1]=f*n+d*o,e[2]=f*a+d*l,e[3]=f*s-d*r,e[4]=f*o-d*n,e[5]=f*l-d*a,e[6]=c,e[7]=u,e[8]=h,e}function S0(e,t,i){var r=i[0],n=i[1];return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=n*t[3],e[4]=n*t[4],e[5]=n*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var S1=vE(function e(t,i,r,n){vk(this,e),this.debugID=Math.floor(1e4*Math.random()),this.r=t,this.texSize=i,this.texRows=r,this.texHeight=Math.floor(i/r),this.enableWrapping=!0,this.locked=!1,this.texture=null,this.needsBuffer=!0,this.freePointer={x:0,row:0},this.keyToLocation=new Map,this.canvas=n(t,i,i),this.scratch=n(t,i,this.texHeight,"scratch")},[{key:"lock",value:function(){this.locked=!0}},{key:"getKeys",value:function(){return new Set(this.keyToLocation.keys())}},{key:"getScale",value:function(e){var t=e.w,i=e.h,r=this.texHeight,n=this.texSize,a=r/i,s=t*a,o=i*a;return s>n&&(a=n/t,s=t*a,o=i*a),{scale:a,texW:s,texH:o}}},{key:"draw",value:function(e,t,i){var r,n,a,s,o,l,c,u=this;if(this.locked)throw Error("can't draw, atlas is locked");var h=this.texSize,d=this.texRows,f=this.texHeight,p=this.getScale(t),g=p.scale,v=p.texW,y=p.texH,b=function(e,r){if(i&&r){var n=r.context,a=e.x,s=f*e.row;n.save(),n.translate(a,s),n.scale(g,g),i(n,t),n.restore()}},x=[null,null],_=function(){b(u.freePointer,u.canvas),x[0]={x:u.freePointer.x,y:u.freePointer.row*f,w:v,h:y},x[1]={x:u.freePointer.x+v,y:u.freePointer.row*f,w:0,h:y},u.freePointer.x+=v,u.freePointer.x==h&&(u.freePointer.x=0,u.freePointer.row++)},w=function(){u.freePointer.x=0,u.freePointer.row++};if(this.freePointer.x+v<=h)_();else{if(this.freePointer.row>=d-1)return!1;this.freePointer.x===h?(w(),_()):this.enableWrapping?(r=u.scratch,n=u.canvas,r.clear(),b({x:0,row:0},r),s=v-(a=h-u.freePointer.x),o=u.freePointer.x,l=u.freePointer.row*f,n.context.drawImage(r,0,0,a,f,o,l,a,f),x[0]={x:o,y:l,w:a,h:y},c=(u.freePointer.row+1)*f,n&&n.context.drawImage(r,a,0,s,f,0,c,s,f),x[1]={x:0,y:c,w:s,h:y},u.freePointer.x=s,u.freePointer.row++):(w(),_())}return this.keyToLocation.set(e,x),this.needsBuffer=!0,x}},{key:"getOffsets",value:function(e){return this.keyToLocation.get(e)}},{key:"isEmpty",value:function(){return 0===this.freePointer.x&&0===this.freePointer.row}},{key:"canFit",value:function(e){if(this.locked)return!1;var t=this.texSize,i=this.texRows,r=this.getScale(e).texW;return!(this.freePointer.x+r>t)||this.freePointer.row<i-1}},{key:"bufferIfNeeded",value:function(e){var t;this.texture||(this.texture=(this.debugID,(t=e.createTexture()).buffer=function(i){e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR_MIPMAP_NEAREST),e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,i),e.generateMipmap(e.TEXTURE_2D),e.bindTexture(e.TEXTURE_2D,null)},t.deleteTexture=function(){e.deleteTexture(t)},t)),this.needsBuffer&&(this.texture.buffer(this.canvas),this.needsBuffer=!1,this.locked&&(this.canvas=null,this.scratch=null))}},{key:"dispose",value:function(){this.texture&&(this.texture.deleteTexture(),this.texture=null),this.canvas=null,this.scratch=null,this.locked=!0}}]),S2=vE(function e(t,i,r,n){vk(this,e),this.r=t,this.texSize=i,this.texRows=r,this.createTextureCanvas=n,this.atlases=[],this.styleKeyToAtlas=new Map,this.markedKeys=new Set},[{key:"getKeys",value:function(){return new Set(this.styleKeyToAtlas.keys())}},{key:"_createAtlas",value:function(){return new S1(this.r,this.texSize,this.texRows,this.createTextureCanvas)}},{key:"_getScratchCanvas",value:function(){if(!this.scratch){var e=this.r,t=this.texSize,i=this.texRows,r=this.createTextureCanvas,n=Math.floor(t/i);this.scratch=r(e,t,n,"scratch")}return this.scratch}},{key:"draw",value:function(e,t,i){var r=this.styleKeyToAtlas.get(e);return r||((r=this.atlases[this.atlases.length-1])&&r.canFit(t)||(r&&r.lock(),r=this._createAtlas(),this.atlases.push(r)),r.draw(e,t,i),this.styleKeyToAtlas.set(e,r)),r}},{key:"getAtlas",value:function(e){return this.styleKeyToAtlas.get(e)}},{key:"hasAtlas",value:function(e){return this.styleKeyToAtlas.has(e)}},{key:"markKeyForGC",value:function(e){this.markedKeys.add(e)}},{key:"gc",value:function(){var e=this,t=this.markedKeys;if(0===t.size)return void console.log("nothing to garbage collect");var i,r=[],n=new Map,a=null,s=vT(this.atlases);try{for(s.s();!(i=s.n()).done;)if(function(){var s=i.value,o=s.getKeys(),l=function(e,t){return e.intersection?e.intersection(t):new Set(vM(e).filter(function(e){return t.has(e)}))}(t,o);if(0===l.size)return r.push(s),o.forEach(function(e){return n.set(e,s)}),1;a||(a=e._createAtlas(),r.push(a));var c,u=vT(o);try{for(u.s();!(c=u.n()).done;){var h=c.value;if(!l.has(h)){var d=s.getOffsets(h),f=vS(d,2),p=f[0],g=f[1];a.canFit({w:p.w+g.w,h:p.h})||(a.lock(),a=e._createAtlas(),r.push(a)),s.canvas&&(e._copyTextureToNewAtlas(h,s,a),n.set(h,a))}}}catch(e){u.e(e)}finally{u.f()}s.dispose()}())continue}catch(e){s.e(e)}finally{s.f()}this.atlases=r,this.styleKeyToAtlas=n,this.markedKeys=new Set}},{key:"_copyTextureToNewAtlas",value:function(e,t,i){var r=vS(t.getOffsets(e),2),n=r[0],a=r[1];if(0===a.w)i.draw(e,n,function(e){e.drawImage(t.canvas,n.x,n.y,n.w,n.h,0,0,n.w,n.h)});else{var s=this._getScratchCanvas();s.clear(),s.context.drawImage(t.canvas,n.x,n.y,n.w,n.h,0,0,n.w,n.h),s.context.drawImage(t.canvas,a.x,a.y,a.w,a.h,n.w,0,a.w,a.h);var o=n.w+a.w,l=n.h;i.draw(e,{w:o,h:l},function(e){e.drawImage(s,0,0,o,l,0,0,o,l)})}}},{key:"getCounts",value:function(){return{keyCount:this.styleKeyToAtlas.size,atlasCount:new Set(this.styleKeyToAtlas.values()).size}}}]),S3=vE(function e(t,i){vk(this,e),this.r=t,this.globalOptions=i,this.atlasSize=i.webglTexSize,this.maxAtlasesPerBatch=i.webglTexPerBatch,this.renderTypes=new Map,this.collections=new Map,this.typeAndIdToKey=new Map},[{key:"getAtlasSize",value:function(){return this.atlasSize}},{key:"addAtlasCollection",value:function(e,t){var i=this.globalOptions,r=i.webglTexSize,n=i.createTextureCanvas,a=t.texRows,s=this._cacheScratchCanvas(n),o=new S2(this.r,r,a,s);this.collections.set(e,o)}},{key:"addRenderType",value:function(e,t){var i=t.collection;if(!this.collections.has(i))throw Error("invalid atlas collection name '".concat(i,"'"));var r=ye({type:e,atlasCollection:this.collections.get(i)},t);this.renderTypes.set(e,r)}},{key:"getRenderTypeOpts",value:function(e){return this.renderTypes.get(e)}},{key:"getAtlasCollection",value:function(e){return this.collections.get(e)}},{key:"_cacheScratchCanvas",value:function(e){var t=-1,i=-1,r=null;return function(n,a,s,o){return o?(r&&a==t&&s==i||(t=a,i=s,r=e(n,a,s)),r):e(n,a,s)}}},{key:"_key",value:function(e,t){return"".concat(e,"-").concat(t)}},{key:"invalidate",value:function(e){var t,i=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.forceRedraw,a=void 0!==n&&n,s=r.filterEle,o=void 0===s?function(){return!0}:s,l=r.filterType,c=void 0===l?function(){return!0}:l,u=!1,h=!1,d=vT(e);try{for(d.s();!(t=d.n()).done;){var f=t.value;if(o(f)){var p,g=vT(this.renderTypes.values());try{for(g.s();!(p=g.n()).done;)!function(){var e=p.value,t=e.type;if(c(t)){var r=i.collections.get(e.collection),n=e.getKey(f),s=Array.isArray(n)?n:[n];if(a)s.forEach(function(e){return r.markKeyForGC(e)}),h=!0;else{var o=e.getID?e.getID(f):f.id(),l=i._key(t,o),d=i.typeAndIdToKey.get(l);void 0!==d&&!function(e,t){if(e.length!==t.length)return!1;for(var i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}(s,d)&&(u=!0,i.typeAndIdToKey.delete(l),d.forEach(function(e){return r.markKeyForGC(e)}))}}}()}catch(e){g.e(e)}finally{g.f()}}}}catch(e){d.e(e)}finally{d.f()}return h&&(this.gc(),u=!1),u}},{key:"gc",value:function(){var e,t=vT(this.collections.values());try{for(t.s();!(e=t.n()).done;)e.value.gc()}catch(e){t.e(e)}finally{t.f()}}},{key:"getOrCreateAtlas",value:function(e,t,i,r){var n=this.renderTypes.get(t),a=this.collections.get(n.collection),s=!1,o=a.draw(r,i,function(t){n.drawClipped?(t.save(),t.beginPath(),t.rect(0,0,i.w,i.h),t.clip(),n.drawElement(t,e,i,!0,!0),t.restore()):n.drawElement(t,e,i,!0,!0),s=!0});if(s){var l=n.getID?n.getID(e):e.id(),c=this._key(t,l);this.typeAndIdToKey.has(c)?this.typeAndIdToKey.get(c).push(r):this.typeAndIdToKey.set(c,[r])}return o}},{key:"getAtlasInfo",value:function(e,t){var i=this,r=this.renderTypes.get(t),n=r.getKey(e);return(Array.isArray(n)?n:[n]).map(function(n){var a=r.getBoundingBox(e,n),s=i.getOrCreateAtlas(e,t,a,n),o=vS(s.getOffsets(n),2),l=o[0];return{atlas:s,tex:l,tex1:l,tex2:o[1],bb:a}})}},{key:"getDebugInfo",value:function(){var e,t=[],i=vT(this.collections);try{for(i.s();!(e=i.n()).done;){var r=vS(e.value,2),n=r[0],a=r[1].getCounts(),s=a.keyCount,o=a.atlasCount;t.push({type:n,keyCount:s,atlasCount:o})}}catch(e){i.e(e)}finally{i.f()}return t}}]),S4=vE(function e(t){vk(this,e),this.globalOptions=t,this.atlasSize=t.webglTexSize,this.maxAtlasesPerBatch=t.webglTexPerBatch,this.batchAtlases=[]},[{key:"getMaxAtlasesPerBatch",value:function(){return this.maxAtlasesPerBatch}},{key:"getAtlasSize",value:function(){return this.atlasSize}},{key:"getIndexArray",value:function(){return Array.from({length:this.maxAtlasesPerBatch},function(e,t){return t})}},{key:"startBatch",value:function(){this.batchAtlases=[]}},{key:"getAtlasCount",value:function(){return this.batchAtlases.length}},{key:"getAtlases",value:function(){return this.batchAtlases}},{key:"canAddToCurrentBatch",value:function(e){return this.batchAtlases.length!==this.maxAtlasesPerBatch||this.batchAtlases.includes(e)}},{key:"getAtlasIndexForBatch",value:function(e){var t=this.batchAtlases.indexOf(e);if(t<0){if(this.batchAtlases.length===this.maxAtlasesPerBatch)throw Error("cannot add more atlases to batch");this.batchAtlases.push(e),t=this.batchAtlases.length-1}return t}}]),S5={name:"screen",screen:!0},S6={name:"picking",picking:!0},S8=vE(function e(t,i,r){vk(this,e),this.r=t,this.gl=i,this.maxInstances=r.webglBatchSize,this.atlasSize=r.webglTexSize,this.bgColor=r.bgColor,this.debug=r.webglDebug,this.batchDebugInfo=[],r.enableWrapping=!0,r.createTextureCanvas=SV,this.atlasManager=new S3(t,r),this.batchManager=new S4(r),this.simpleShapeOptions=new Map,this.program=this._createShaderProgram(S5),this.pickingProgram=this._createShaderProgram(S6),this.vao=this._createVAO()},[{key:"addAtlasCollection",value:function(e,t){this.atlasManager.addAtlasCollection(e,t)}},{key:"addTextureAtlasRenderType",value:function(e,t){this.atlasManager.addRenderType(e,t)}},{key:"addSimpleShapeRenderType",value:function(e,t){this.simpleShapeOptions.set(e,t)}},{key:"invalidate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t.type,r=this.atlasManager;return i?r.invalidate(e,{filterType:function(e){return e===i},forceRedraw:!0}):r.invalidate(e)}},{key:"gc",value:function(){this.atlasManager.gc()}},{key:"_createShaderProgram",value:function(e){var t=this.gl,i="#version 300 es\n      precision highp float;\n\n      uniform mat3 uPanZoomMatrix;\n      uniform int  uAtlasSize;\n      \n      // instanced\n      in vec2 aPosition; // a vertex from the unit square\n      \n      in mat3 aTransform; // used to transform verticies, eg into a bounding box\n      in int aVertType; // the type of thing we are rendering\n\n      // the z-index that is output when using picking mode\n      in vec4 aIndex;\n      \n      // For textures\n      in int aAtlasId; // which shader unit/atlas to use\n      in vec4 aTex; // x/y/w/h of texture in atlas\n\n      // for edges\n      in vec4 aPointAPointB;\n      in vec4 aPointCPointD;\n      in vec2 aLineWidth; // also used for node border width\n\n      // simple shapes\n      in vec4 aCornerRadius; // for round-rectangle [top-right, bottom-right, top-left, bottom-left]\n      in vec4 aColor; // also used for edges\n      in vec4 aBorderColor; // aLineWidth is used for border width\n\n      // output values passed to the fragment shader\n      out vec2 vTexCoord;\n      out vec4 vColor;\n      out vec2 vPosition;\n      // flat values are not interpolated\n      flat out int vAtlasId; \n      flat out int vVertType;\n      flat out vec2 vTopRight;\n      flat out vec2 vBotLeft;\n      flat out vec4 vCornerRadius;\n      flat out vec4 vBorderColor;\n      flat out vec2 vBorderWidth;\n      flat out vec4 vIndex;\n      \n      void main(void) {\n        int vid = gl_VertexID;\n        vec2 position = aPosition; // TODO make this a vec3, simplifies some code below\n\n        if(aVertType == ".concat(0,") {\n          float texX = aTex.x; // texture coordinates\n          float texY = aTex.y;\n          float texW = aTex.z;\n          float texH = aTex.w;\n\n          if(vid == 1 || vid == 2 || vid == 4) {\n            texX += texW;\n          }\n          if(vid == 2 || vid == 4 || vid == 5) {\n            texY += texH;\n          }\n\n          float d = float(uAtlasSize);\n          vTexCoord = vec2(texX / d, texY / d); // tex coords must be between 0 and 1\n\n          gl_Position = vec4(uPanZoomMatrix * aTransform * vec3(position, 1.0), 1.0);\n        }\n        else if(aVertType == ").concat(4," || aVertType == ").concat(7," \n             || aVertType == ").concat(5," || aVertType == ").concat(6,") { // simple shapes\n\n          // the bounding box is needed by the fragment shader\n          vBotLeft  = (aTransform * vec3(0, 0, 1)).xy; // flat\n          vTopRight = (aTransform * vec3(1, 1, 1)).xy; // flat\n          vPosition = (aTransform * vec3(position, 1)).xy; // will be interpolated\n\n          // calculations are done in the fragment shader, just pass these along\n          vColor = aColor;\n          vCornerRadius = aCornerRadius;\n          vBorderColor = aBorderColor;\n          vBorderWidth = aLineWidth;\n\n          gl_Position = vec4(uPanZoomMatrix * aTransform * vec3(position, 1.0), 1.0);\n        }\n        else if(aVertType == ").concat(1,") {\n          vec2 source = aPointAPointB.xy;\n          vec2 target = aPointAPointB.zw;\n\n          // adjust the geometry so that the line is centered on the edge\n          position.y = position.y - 0.5;\n\n          // stretch the unit square into a long skinny rectangle\n          vec2 xBasis = target - source;\n          vec2 yBasis = normalize(vec2(-xBasis.y, xBasis.x));\n          vec2 point = source + xBasis * position.x + yBasis * aLineWidth[0] * position.y;\n\n          gl_Position = vec4(uPanZoomMatrix * vec3(point, 1.0), 1.0);\n          vColor = aColor;\n        } \n        else if(aVertType == ").concat(2,") {\n          vec2 pointA = aPointAPointB.xy;\n          vec2 pointB = aPointAPointB.zw;\n          vec2 pointC = aPointCPointD.xy;\n          vec2 pointD = aPointCPointD.zw;\n\n          // adjust the geometry so that the line is centered on the edge\n          position.y = position.y - 0.5;\n\n          vec2 p0, p1, p2, pos;\n          if(position.x == 0.0) { // The left side of the unit square\n            p0 = pointA;\n            p1 = pointB;\n            p2 = pointC;\n            pos = position;\n          } else { // The right side of the unit square, use same approach but flip the geometry upside down\n            p0 = pointD;\n            p1 = pointC;\n            p2 = pointB;\n            pos = vec2(0.0, -position.y);\n          }\n\n          vec2 p01 = p1 - p0;\n          vec2 p12 = p2 - p1;\n          vec2 p21 = p1 - p2;\n\n          // Find the normal vector.\n          vec2 tangent = normalize(normalize(p12) + normalize(p01));\n          vec2 normal = vec2(-tangent.y, tangent.x);\n\n          // Find the vector perpendicular to p0 -> p1.\n          vec2 p01Norm = normalize(vec2(-p01.y, p01.x));\n\n          // Determine the bend direction.\n          float sigma = sign(dot(p01 + p21, normal));\n          float width = aLineWidth[0];\n\n          if(sign(pos.y) == -sigma) {\n            // This is an intersecting vertex. Adjust the position so that there's no overlap.\n            vec2 point = 0.5 * width * normal * -sigma / dot(normal, p01Norm);\n            gl_Position = vec4(uPanZoomMatrix * vec3(p1 + point, 1.0), 1.0);\n          } else {\n            // This is a non-intersecting vertex. Treat it like a mitre join.\n            vec2 point = 0.5 * width * normal * sigma * dot(normal, p01Norm);\n            gl_Position = vec4(uPanZoomMatrix * vec3(p1 + point, 1.0), 1.0);\n          }\n\n          vColor = aColor;\n        } \n        else if(aVertType == ").concat(3," && vid < 3) {\n          // massage the first triangle into an edge arrow\n          if(vid == 0)\n            position = vec2(-0.15, -0.3);\n          if(vid == 1)\n            position = vec2(  0.0,  0.0);\n          if(vid == 2)\n            position = vec2( 0.15, -0.3);\n\n          gl_Position = vec4(uPanZoomMatrix * aTransform * vec3(position, 1.0), 1.0);\n          vColor = aColor;\n        }\n        else {\n          gl_Position = vec4(2.0, 0.0, 0.0, 1.0); // discard vertex by putting it outside webgl clip space\n        }\n\n        vAtlasId = aAtlasId;\n        vVertType = aVertType;\n        vIndex = aIndex;\n      }\n    "),r=this.batchManager.getIndexArray(),n=function(e,t,i){var r=Sz(e,e.VERTEX_SHADER,t),n=Sz(e,e.FRAGMENT_SHADER,i),a=e.createProgram();if(e.attachShader(a,r),e.attachShader(a,n),e.linkProgram(a),!e.getProgramParameter(a,e.LINK_STATUS))throw Error("Could not initialize shaders");return a}(t,i,"#version 300 es\n      precision highp float;\n\n      // declare texture unit for each texture atlas in the batch\n      ".concat(r.map(function(e){return"uniform sampler2D uTexture".concat(e,";")}).join("\n	"),"\n\n      uniform vec4 uBGColor;\n      uniform float uZoom;\n\n      in vec2 vTexCoord;\n      in vec4 vColor;\n      in vec2 vPosition; // model coordinates\n\n      flat in int vAtlasId;\n      flat in vec4 vIndex;\n      flat in int vVertType;\n      flat in vec2 vTopRight;\n      flat in vec2 vBotLeft;\n      flat in vec4 vCornerRadius;\n      flat in vec4 vBorderColor;\n      flat in vec2 vBorderWidth;\n\n      out vec4 outColor;\n\n      ").concat("\n  float circleSD(vec2 p, float r) {\n    return distance(vec2(0), p) - r; // signed distance\n  }\n","\n      ").concat("\n  float rectangleSD(vec2 p, vec2 b) {\n    vec2 d = abs(p)-b;\n    return distance(vec2(0),max(d,0.0)) + min(max(d.x,d.y),0.0);\n  }\n","\n      ").concat("\n  float roundRectangleSD(vec2 p, vec2 b, vec4 cr) {\n    cr.xy = (p.x > 0.0) ? cr.xy : cr.zw;\n    cr.x  = (p.y > 0.0) ? cr.x  : cr.y;\n    vec2 q = abs(p) - b + cr.x;\n    return min(max(q.x, q.y), 0.0) + distance(vec2(0), max(q, 0.0)) - cr.x;\n  }\n","\n      ").concat("\n  float ellipseSD(vec2 p, vec2 ab) {\n    p = abs( p ); // symmetry\n\n    // find root with Newton solver\n    vec2 q = ab*(p-ab);\n    float w = (q.x<q.y)? 1.570796327 : 0.0;\n    for( int i=0; i<5; i++ ) {\n      vec2 cs = vec2(cos(w),sin(w));\n      vec2 u = ab*vec2( cs.x,cs.y);\n      vec2 v = ab*vec2(-cs.y,cs.x);\n      w = w + dot(p-u,v)/(dot(p-u,u)+dot(v,v));\n    }\n    \n    // compute final point and distance\n    float d = length(p-ab*vec2(cos(w),sin(w)));\n    \n    // return signed distance\n    return (dot(p/ab,p/ab)>1.0) ? d : -d;\n  }\n","\n\n      vec4 blend(vec4 top, vec4 bot) { // blend colors with premultiplied alpha\n        return vec4( \n          top.rgb + (bot.rgb * (1.0 - top.a)),\n          top.a   + (bot.a   * (1.0 - top.a)) \n        );\n      }\n\n      vec4 distInterp(vec4 cA, vec4 cB, float d) { // interpolate color using Signed Distance\n        // scale to the zoom level so that borders don't look blurry when zoomed in\n        // note 1.5 is an aribitrary value chosen because it looks good\n        return mix(cA, cB, 1.0 - smoothstep(0.0, 1.5 / uZoom, abs(d))); \n      }\n\n      void main(void) {\n        if(vVertType == ").concat(0,") {\n          // look up the texel from the texture unit\n          ").concat(r.map(function(e){return"if(vAtlasId == ".concat(e,") outColor = texture(uTexture").concat(e,", vTexCoord);")}).join("\n	else "),"\n        } \n        else if(vVertType == ").concat(3,") {\n          // mimics how canvas renderer uses context.globalCompositeOperation = 'destination-out';\n          outColor = blend(vColor, uBGColor);\n          outColor.a = 1.0; // make opaque, masks out line under arrow\n        }\n        else if(vVertType == ").concat(4," && vBorderWidth == vec2(0.0)) { // simple rectangle with no border\n          outColor = vColor; // unit square is already transformed to the rectangle, nothing else needs to be done\n        }\n        else if(vVertType == ").concat(4," || vVertType == ").concat(7," \n          || vVertType == ").concat(5," || vVertType == ").concat(6,") { // use SDF\n\n          float outerBorder = vBorderWidth[0];\n          float innerBorder = vBorderWidth[1];\n          float borderPadding = outerBorder * 2.0;\n          float w = vTopRight.x - vBotLeft.x - borderPadding;\n          float h = vTopRight.y - vBotLeft.y - borderPadding;\n          vec2 b = vec2(w/2.0, h/2.0); // half width, half height\n          vec2 p = vPosition - vec2(vTopRight.x - b[0] - outerBorder, vTopRight.y - b[1] - outerBorder); // translate to center\n\n          float d; // signed distance\n          if(vVertType == ").concat(4,") {\n            d = rectangleSD(p, b);\n          } else if(vVertType == ").concat(7," && w == h) {\n            d = circleSD(p, b.x); // faster than ellipse\n          } else if(vVertType == ").concat(7,") {\n            d = ellipseSD(p, b);\n          } else {\n            d = roundRectangleSD(p, b, vCornerRadius.wzyx);\n          }\n\n          // use the distance to interpolate a color to smooth the edges of the shape, doesn't need multisampling\n          // we must smooth colors inwards, because we can't change pixels outside the shape's bounding box\n          if(d > 0.0) {\n            if(d > outerBorder) {\n              discard;\n            } else {\n              outColor = distInterp(vBorderColor, vec4(0), d - outerBorder);\n            }\n          } else {\n            if(d > innerBorder) {\n              vec4 outerColor = outerBorder == 0.0 ? vec4(0) : vBorderColor;\n              vec4 innerBorderColor = blend(vBorderColor, vColor);\n              outColor = distInterp(innerBorderColor, outerColor, d);\n            } \n            else {\n              vec4 outerColor;\n              if(innerBorder == 0.0 && outerBorder == 0.0) {\n                outerColor = vec4(0);\n              } else if(innerBorder == 0.0) {\n                outerColor = vBorderColor;\n              } else {\n                outerColor = blend(vBorderColor, vColor);\n              }\n              outColor = distInterp(vColor, outerColor, d - innerBorder);\n            }\n          }\n        }\n        else {\n          outColor = vColor;\n        }\n\n        ").concat(e.picking?"if(outColor.a == 0.0) discard;\n             else outColor = vIndex;":"","\n      }\n    "));n.aPosition=t.getAttribLocation(n,"aPosition"),n.aIndex=t.getAttribLocation(n,"aIndex"),n.aVertType=t.getAttribLocation(n,"aVertType"),n.aTransform=t.getAttribLocation(n,"aTransform"),n.aAtlasId=t.getAttribLocation(n,"aAtlasId"),n.aTex=t.getAttribLocation(n,"aTex"),n.aPointAPointB=t.getAttribLocation(n,"aPointAPointB"),n.aPointCPointD=t.getAttribLocation(n,"aPointCPointD"),n.aLineWidth=t.getAttribLocation(n,"aLineWidth"),n.aColor=t.getAttribLocation(n,"aColor"),n.aCornerRadius=t.getAttribLocation(n,"aCornerRadius"),n.aBorderColor=t.getAttribLocation(n,"aBorderColor"),n.uPanZoomMatrix=t.getUniformLocation(n,"uPanZoomMatrix"),n.uAtlasSize=t.getUniformLocation(n,"uAtlasSize"),n.uBGColor=t.getUniformLocation(n,"uBGColor"),n.uZoom=t.getUniformLocation(n,"uZoom"),n.uTextures=[];for(var a=0;a<this.batchManager.getMaxAtlasesPerBatch();a++)n.uTextures.push(t.getUniformLocation(n,"uTexture".concat(a)));return n}},{key:"_createVAO",value:function(){var e,t,i,r,n,a,s=[0,0,1,0,1,1,0,0,1,1,0,1];this.vertexCount=s.length/2;var o=this.maxInstances,l=this.gl,c=this.program,u=l.createVertexArray();return l.bindVertexArray(u),e=c.aPosition,i=(t=vS(Sq(l,"vec2"),2))[0],n=SG(l,r=t[1],s),a=l.createBuffer(),l.bindBuffer(l.ARRAY_BUFFER,a),l.bufferData(l.ARRAY_BUFFER,n,l.STATIC_DRAW),r===l.FLOAT?l.vertexAttribPointer(e,i,r,!1,0,0):r===l.INT&&l.vertexAttribIPointer(e,i,r,0,0),l.enableVertexAttribArray(e),l.bindBuffer(l.ARRAY_BUFFER,null),this.transformBuffer=function(e,t,i){for(var r=new Float32Array(9*t),n=Array(t),a=0;a<t;a++){var s=9*a*4;n[a]=new Float32Array(r.buffer,s,9)}var o=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,o),e.bufferData(e.ARRAY_BUFFER,r.byteLength,e.DYNAMIC_DRAW);for(var l=0;l<3;l++){var c=i+l;e.enableVertexAttribArray(c),e.vertexAttribPointer(c,3,e.FLOAT,!1,36,12*l),e.vertexAttribDivisor(c,1)}return e.bindBuffer(e.ARRAY_BUFFER,null),o.getMatrixView=function(e){return n[e]},o.setData=function(e,t){n[t].set(e,0)},o.bufferSubData=function(){e.bindBuffer(e.ARRAY_BUFFER,o),e.bufferSubData(e.ARRAY_BUFFER,0,r)},o}(l,o,c.aTransform),this.indexBuffer=SY(l,o,"vec4",c.aIndex),this.vertTypeBuffer=SY(l,o,"int",c.aVertType),this.atlasIdBuffer=SY(l,o,"int",c.aAtlasId),this.texBuffer=SY(l,o,"vec4",c.aTex),this.pointAPointBBuffer=SY(l,o,"vec4",c.aPointAPointB),this.pointCPointDBuffer=SY(l,o,"vec4",c.aPointCPointD),this.lineWidthBuffer=SY(l,o,"vec2",c.aLineWidth),this.colorBuffer=SY(l,o,"vec4",c.aColor),this.cornerRadiusBuffer=SY(l,o,"vec4",c.aCornerRadius),this.borderColorBuffer=SY(l,o,"vec4",c.aBorderColor),l.bindVertexArray(null),u}},{key:"buffers",get:function(){var e=this;return this._buffers||(this._buffers=Object.keys(this).filter(function(e){return v3(e,"Buffer")}).map(function(t){return e[t]})),this._buffers}},{key:"startFrame",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:S5;this.panZoomMatrix=e,this.renderTarget=t,this.batchDebugInfo=[],this.wrappedCount=0,this.simpleCount=0,this.startBatch()}},{key:"startBatch",value:function(){this.instanceCount=0,this.batchManager.startBatch()}},{key:"endFrame",value:function(){this.endBatch()}},{key:"_isVisible",value:function(e,t){return!!e.visible()&&(!t||!t.isVisible||t.isVisible(e))}},{key:"drawTexture",value:function(e,t,i){var r=this.atlasManager,n=this.batchManager,a=r.getRenderTypeOpts(i);if(this._isVisible(e,a)&&(!e.isEdge()||this._isValidEdge(e))){if(this.renderTarget.picking&&a.getTexPickingMode){var s=a.getTexPickingMode(e);if(1===s)return;if(2==s)return void this.drawPickingRectangle(e,t,i)}var o,l=vT(r.getAtlasInfo(e,i));try{for(l.s();!(o=l.n()).done;){var c=o.value,u=c.atlas,h=c.tex1,d=c.tex2;n.canAddToCurrentBatch(u)||this.endBatch();for(var f=n.getAtlasIndexForBatch(u),p=0,g=[[h,!0],[d,!1]];p<g.length;p++){var v=vS(g[p],2),y=v[0],b=v[1];if(0!=y.w){var x=this.instanceCount;this.vertTypeBuffer.getView(x)[0]=0;var _=this.indexBuffer.getView(x);SH(t,_),this.atlasIdBuffer.getView(x)[0]=f;var w=this.texBuffer.getView(x);w[0]=y.x,w[1]=y.y,w[2]=y.w,w[3]=y.h;var k=this.transformBuffer.getMatrixView(x);this.setTransformMatrix(e,k,a,c,b),this.instanceCount++,!b&&this.wrappedCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}}}}catch(e){l.e(e)}finally{l.f()}}}},{key:"setTransformMatrix",value:function(e,t,i,r){var n=!(arguments.length>4)||void 0===arguments[4]||arguments[4],a=0;if(i.shapeProps&&i.shapeProps.padding&&(a=e.pstyle(i.shapeProps.padding).pfValue),r){var s=r.bb,o=r.tex1,l=r.tex2,c=o.w/(o.w+l.w);n||(c=1-c);var u=this._getAdjustedBB(s,a,n,c);this._applyTransformMatrix(t,u,i,e)}else{var h=i.getBoundingBox(e),d=this._getAdjustedBB(h,a,!0,1);this._applyTransformMatrix(t,d,i,e)}}},{key:"_applyTransformMatrix",value:function(e,t,i,r){SZ(e);var n,a,s=i.getRotation?i.getRotation(r):0;if(0!==s){var o=i.getRotationPoint(r);SJ(e,e,[o.x,o.y]),SQ(e,e,s);var l=i.getRotationOffset(r);n=l.x+(t.xOffset||0),a=l.y+(t.yOffset||0)}else n=t.x1,a=t.y1;SJ(e,e,[n,a]),S0(e,e,[t.w,t.h])}},{key:"_getAdjustedBB",value:function(e,t,i,r){var n=e.x1,a=e.y1,s=e.w,o=e.h,l=e.yOffset;t&&(n-=t,a-=t,s+=2*t,o+=2*t);var c=0,u=s*r;return i&&r<1?s=u:!i&&r<1&&(n+=c=s-u,s=u),{x1:n,y1:a,w:s,h:o,xOffset:c,yOffset:l}}},{key:"drawPickingRectangle",value:function(e,t,i){var r=this.atlasManager.getRenderTypeOpts(i),n=this.instanceCount;this.vertTypeBuffer.getView(n)[0]=4,SH(t,this.indexBuffer.getView(n)),SW([0,0,0],1,this.colorBuffer.getView(n));var a=this.transformBuffer.getMatrixView(n);this.setTransformMatrix(e,a,r),this.simpleCount++,this.instanceCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}},{key:"drawNode",value:function(e,t,i){var r=this.simpleShapeOptions.get(i);if(this._isVisible(e,r)){var n=r.shapeProps,a=this._getVertTypeForShape(e,n.shape);if(void 0===a||r.isSimple&&!r.isSimple(e))return void this.drawTexture(e,t,i);var s=this.instanceCount;if(this.vertTypeBuffer.getView(s)[0]=a,5===a||6===a){var o=r.getBoundingBox(e),l=this._getCornerRadius(e,n.radius,o),c=this.cornerRadiusBuffer.getView(s);c[0]=l,c[1]=l,c[2]=l,c[3]=l,6===a&&(c[0]=0,c[2]=0)}SH(t,this.indexBuffer.getView(s)),SW(e.pstyle(n.color).value,e.pstyle(n.opacity).value,this.colorBuffer.getView(s));var u=this.lineWidthBuffer.getView(s);if(u[0]=0,u[1]=0,n.border){var h=e.pstyle("border-width").value;if(h>0){SW(e.pstyle("border-color").value,e.pstyle("border-opacity").value,this.borderColorBuffer.getView(s));var d=e.pstyle("border-position").value;if("inside"===d)u[0]=0,u[1]=-h;else if("outside"===d)u[0]=h,u[1]=0;else{var f=h/2;u[0]=f,u[1]=-f}}}var p=this.transformBuffer.getMatrixView(s);this.setTransformMatrix(e,p,r),this.simpleCount++,this.instanceCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}}},{key:"_getVertTypeForShape",value:function(e,t){switch(e.pstyle(t).value){case"rectangle":return 4;case"ellipse":return 7;case"roundrectangle":case"round-rectangle":return 5;case"bottom-round-rectangle":return 6;default:return}}},{key:"_getCornerRadius",value:function(e,t,i){var r=i.w,n=i.h;return"auto"===e.pstyle(t).value?b2(r,n):Math.min(e.pstyle(t).pfValue,n/2,r/2)}},{key:"drawEdgeArrow",value:function(e,t,i){if(e.visible()){var r,n,a,s=e._private.rscratch;if(("source"===i?(r=s.arrowStartX,n=s.arrowStartY,a=s.srcArrowAngle):(r=s.arrowEndX,n=s.arrowEndY,a=s.tgtArrowAngle),!(isNaN(r)||null==r||isNaN(n)||null==n||isNaN(a))&&null!=a)&&"none"!==e.pstyle(i+"-arrow-shape").value){var o=e.pstyle(i+"-arrow-color").value,l=e.pstyle("opacity").value,c=e.pstyle("line-opacity").value,u=e.pstyle("width").pfValue,h=e.pstyle("arrow-scale").value,d=this.r.getArrowWidth(u,h),f=this.instanceCount,p=this.transformBuffer.getMatrixView(f);SZ(p),SJ(p,p,[r,n]),S0(p,p,[d,d]),SQ(p,p,a),this.vertTypeBuffer.getView(f)[0]=3,SH(t,this.indexBuffer.getView(f)),SW(o,l*c,this.colorBuffer.getView(f)),this.instanceCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}}}},{key:"drawEdgeLine",value:function(e,t){if(e.visible()){var i=this._getEdgePoints(e);if(i){var r=e.pstyle("opacity").value,n=e.pstyle("line-opacity").value,a=e.pstyle("width").pfValue,s=e.pstyle("line-color").value,o=r*n;if(i.length/2+this.instanceCount>this.maxInstances&&this.endBatch(),4==i.length){var l=this.instanceCount;this.vertTypeBuffer.getView(l)[0]=1,SH(t,this.indexBuffer.getView(l)),SW(s,o,this.colorBuffer.getView(l)),this.lineWidthBuffer.getView(l)[0]=a;var c=this.pointAPointBBuffer.getView(l);c[0]=i[0],c[1]=i[1],c[2]=i[2],c[3]=i[3],this.instanceCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}else for(var u=0;u<i.length-2;u+=2){var h=this.instanceCount;this.vertTypeBuffer.getView(h)[0]=2,SH(t,this.indexBuffer.getView(h)),SW(s,o,this.colorBuffer.getView(h)),this.lineWidthBuffer.getView(h)[0]=a;var d=i[u-2],f=i[u-1],p=i[u],g=i[u+1],v=i[u+2],y=i[u+3],b=i[u+4],x=i[u+5];0==u&&(d=2*p-v+.001,f=2*g-y+.001),u==i.length-4&&(b=2*v-p+.001,x=2*y-g+.001);var _=this.pointAPointBBuffer.getView(h);_[0]=d,_[1]=f,_[2]=p,_[3]=g;var w=this.pointCPointDBuffer.getView(h);w[0]=v,w[1]=y,w[2]=b,w[3]=x,this.instanceCount++,this.instanceCount>=this.maxInstances&&this.endBatch()}}}}},{key:"_isValidEdge",value:function(e){var t=e._private.rscratch;return!(t.badLine||null==t.allpts||isNaN(t.allpts[0]))}},{key:"_getEdgePoints",value:function(e){var t=e._private.rscratch;if(this._isValidEdge(e)){var i=t.allpts;if(4==i.length)return i;var r=this._getNumSegments(e);return this._getCurveSegmentPoints(i,r)}}},{key:"_getNumSegments",value:function(e){return Math.min(15,this.maxInstances)}},{key:"_getCurveSegmentPoints",value:function(e,t){if(4==e.length)return e;for(var i=Array((t+1)*2),r=0;r<=t;r++)if(0==r)i[0]=e[0],i[1]=e[1];else if(r==t)i[2*r]=e[e.length-2],i[2*r+1]=e[e.length-1];else{var n=r/t;this._setCurvePoint(e,n,i,2*r)}return i}},{key:"_setCurvePoint",value:function(e,t,i,r){if(e.length<=2)i[r]=e[0],i[r+1]=e[1];else{for(var n=Array(e.length-2),a=0;a<n.length;a+=2){var s=(1-t)*e[a]+t*e[a+2],o=(1-t)*e[a+1]+t*e[a+3];n[a]=s,n[a+1]=o}return this._setCurvePoint(n,t,i,r)}}},{key:"endBatch",value:function(){var e=this.gl,t=this.vao,i=this.vertexCount,r=this.instanceCount;if(0!==r){var n,a,s=this.renderTarget.picking?this.pickingProgram:this.program;e.useProgram(s),e.bindVertexArray(t);var o,l=vT(this.buffers);try{for(l.s();!(o=l.n()).done;)o.value.bufferSubData(r)}catch(e){l.e(e)}finally{l.f()}for(var c=this.batchManager.getAtlases(),u=0;u<c.length;u++)c[u].bufferIfNeeded(e);for(var h=0;h<c.length;h++)e.activeTexture(e.TEXTURE0+h),e.bindTexture(e.TEXTURE_2D,c[h].texture),e.uniform1i(s.uTextures[h],h);e.uniform1f(s.uZoom,(a=(n=this.r).pixelRatio,n.cy.zoom()*a)),e.uniformMatrix3fv(s.uPanZoomMatrix,!1,this.panZoomMatrix),e.uniform1i(s.uAtlasSize,this.batchManager.getAtlasSize());var d=SW(this.bgColor,1);e.uniform4fv(s.uBGColor,d),e.drawArraysInstanced(e.TRIANGLES,0,i,r),e.bindVertexArray(null),e.bindTexture(e.TEXTURE_2D,null),this.debug&&this.batchDebugInfo.push({count:r,atlasCount:c.length}),this.startBatch()}}},{key:"getDebugInfo",value:function(){var e=this.atlasManager.getDebugInfo(),t=e.reduce(function(e,t){return e+t.atlasCount},0),i=this.batchDebugInfo,r=i.reduce(function(e,t){return e+t.count},0);return{atlasInfo:e,totalAtlases:t,wrappedCount:this.wrappedCount,simpleCount:this.simpleCount,batchCount:i.length,batchInfo:i,totalInstances:r}}}]),S9={};function S7(e,t){return yY(e._private.rscratch,"labelWrapCachedLines",t)||[]}S9.initWebgl=function(e,t){var i,r,n,a,s,o,l,c,u=this,h=u.data.contexts[u.WEBGL];e.bgColor=yn((i=u.cy.container())&&i.style&&i.style.backgroundColor||"white"),e.webglTexSize=Math.min(e.webglTexSize,h.getParameter(h.MAX_TEXTURE_SIZE)),e.webglTexRows=Math.min(e.webglTexRows,54),e.webglTexRowsNodes=Math.min(e.webglTexRowsNodes,54),e.webglBatchSize=Math.min(e.webglBatchSize,16384),e.webglTexPerBatch=Math.min(e.webglTexPerBatch,h.getParameter(h.MAX_TEXTURE_IMAGE_UNITS)),u.webglDebug=e.webglDebug,u.webglDebugShowAtlases=e.webglDebugShowAtlases,l=h.createFramebuffer(),h.bindFramebuffer(h.FRAMEBUFFER,l),c=h.createTexture(),h.bindTexture(h.TEXTURE_2D,c),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,h.LINEAR),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,h.CLAMP_TO_EDGE),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,h.CLAMP_TO_EDGE),h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,c,0),h.bindFramebuffer(h.FRAMEBUFFER,null),l.setFramebufferAttachmentSizes=function(e,t){h.bindTexture(h.TEXTURE_2D,c),h.texImage2D(h.TEXTURE_2D,0,h.RGBA,e,t,0,h.RGBA,h.UNSIGNED_BYTE,null)},u.pickingFrameBuffer=l,u.pickingFrameBuffer.needsDraw=!0,u.drawing=new S8(u,h,e);var d=function(e){return function(t){return u.getTextAngle(t,e)}},f=function(e){return function(t){var i=t.pstyle(e);return i&&i.value}},p=function(e){return function(t){return t.pstyle("".concat(e,"-opacity")).value>0}},g=function(e){return"yes"===e.pstyle("text-events").strValue?2:1},v=function(e){var t=e.position(),i=t.x,r=t.y,n=e.outerWidth(),a=e.outerHeight();return{w:n,h:a,x1:i-n/2,y1:r-a/2}};u.drawing.addAtlasCollection("node",{texRows:e.webglTexRowsNodes}),u.drawing.addAtlasCollection("label",{texRows:e.webglTexRows}),u.drawing.addTextureAtlasRenderType("node-body",{collection:"node",getKey:t.getStyleKey,getBoundingBox:t.getElementBox,drawElement:t.drawElement}),u.drawing.addSimpleShapeRenderType("node-body",{getBoundingBox:v,isSimple:S$,shapeProps:{shape:"shape",color:"background-color",opacity:"background-opacity",radius:"corner-radius",border:!0}}),u.drawing.addSimpleShapeRenderType("node-overlay",{getBoundingBox:v,isVisible:p("overlay"),shapeProps:{shape:"overlay-shape",color:"overlay-color",opacity:"overlay-opacity",padding:"overlay-padding",radius:"overlay-corner-radius"}}),u.drawing.addSimpleShapeRenderType("node-underlay",{getBoundingBox:v,isVisible:p("underlay"),shapeProps:{shape:"underlay-shape",color:"underlay-color",opacity:"underlay-opacity",padding:"underlay-padding",radius:"underlay-corner-radius"}}),u.drawing.addTextureAtlasRenderType("label",{collection:"label",getTexPickingMode:g,getKey:Me(t.getLabelKey,null),getBoundingBox:Mt(t.getLabelBox,null),drawClipped:!0,drawElement:t.drawLabel,getRotation:d(null),getRotationPoint:t.getLabelRotationPoint,getRotationOffset:t.getLabelRotationOffset,isVisible:f("label")}),u.drawing.addTextureAtlasRenderType("edge-source-label",{collection:"label",getTexPickingMode:g,getKey:Me(t.getSourceLabelKey,"source"),getBoundingBox:Mt(t.getSourceLabelBox,"source"),drawClipped:!0,drawElement:t.drawSourceLabel,getRotation:d("source"),getRotationPoint:t.getSourceLabelRotationPoint,getRotationOffset:t.getSourceLabelRotationOffset,isVisible:f("source-label")}),u.drawing.addTextureAtlasRenderType("edge-target-label",{collection:"label",getTexPickingMode:g,getKey:Me(t.getTargetLabelKey,"target"),getBoundingBox:Mt(t.getTargetLabelBox,"target"),drawClipped:!0,drawElement:t.drawTargetLabel,getRotation:d("target"),getRotationPoint:t.getTargetLabelRotationPoint,getRotationOffset:t.getTargetLabelRotationOffset,isVisible:f("target-label")});var y=yg(function(){console.log("garbage collect flag set"),u.data.gc=!0},1e4);u.onUpdateEleCalcs(function(e,t){var i=!1;t&&t.length>0&&(i|=u.drawing.invalidate(t)),i&&y()}),n=(r=u).render,r.render=function(e){e=e||{};var t,i,a,s,o=r.cy;r.webgl&&(o.zoom()>7.99?((i=(t=r).data.contexts[t.WEBGL]).clear(i.COLOR_BUFFER_BIT|i.DEPTH_BUFFER_BIT),n.call(r,e)):(a=r,(s=function(e){e.save(),e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,a.canvasWidth,a.canvasHeight),e.restore()})(a.data.contexts[a.NODE]),s(a.data.contexts[a.DRAG]),Mn(r,e,S5)))},a=r.matchCanvasSize,r.matchCanvasSize=function(e){a.call(r,e),r.pickingFrameBuffer.setFramebufferAttachmentSizes(r.canvasWidth,r.canvasHeight),r.pickingFrameBuffer.needsDraw=!0},r.findNearestElements=function(e,t,i,n){return function(e,t,i){var r,n,a,s=function(e,t,i,r,n){var a=SU(e),s=a.pan,o=a.zoom,l=vS((g=t*o+s.x,v=i*o+s.y,[g,v=Math.round(e.canvasHeight-v)]),2),c=l[0],u=l[1],h=e.data.contexts[e.WEBGL];h.bindFramebuffer(h.FRAMEBUFFER,e.pickingFrameBuffer),e.pickingFrameBuffer.needsDraw&&(h.viewport(0,0,h.canvas.width,h.canvas.height),Mn(e,null,S6),e.pickingFrameBuffer.needsDraw=!1);var d=new Uint8Array(144);h.readPixels(c-3,u-3,6,6,h.RGBA,h.UNSIGNED_BYTE,d),h.bindFramebuffer(h.FRAMEBUFFER,null);for(var f=new Set,p=0;p<36;p++){var g,v,y,b=(y=d.slice(4*p,4*p+4))[0]+(y[1]<<8)+(y[2]<<16)+(y[3]<<24)-1;b>=0&&f.add(b)}return f}(e,t,i),o=e.getCachedZSortedEles(),l=vT(s);try{for(l.s();!(a=l.n()).done;){var c=o[a.value];if(!r&&c.isNode()&&(r=c),!n&&c.isEdge()&&(n=c),r&&n)break}}catch(e){l.e(e)}finally{l.f()}return[r,n].filter(Boolean)}(r,e,t)},s=r.invalidateCachedZSortedEles,r.invalidateCachedZSortedEles=function(){s.call(r),r.pickingFrameBuffer.needsDraw=!0},o=r.notify,r.notify=function(e,t){o.call(r,e,t),"viewport"===e||"bounds"===e?r.pickingFrameBuffer.needsDraw=!0:"background"===e&&r.drawing.invalidate(t,{type:"node-body"})}};var Me=function(e,t){return function(i){var r=e(i),n=S7(i,t);return n.length>1?n.map(function(e,t){return"".concat(r,"_").concat(t)}):r}},Mt=function(e,t){return function(i,r){var n=e(i);if("string"==typeof r){var a=r.indexOf("_");if(a>0){var s=Number(r.substring(a+1)),o=S7(i,t),l=n.h/o.length,c=l*s,u=n.y1+c;return{x1:n.x1,w:n.w,y1:u,h:l,yOffset:c}}}return n}};function Mi(e,t){var i=e.canvasWidth,r=e.canvasHeight,n=SU(e),a=n.pan,s=n.zoom;t.setTransform(1,0,0,1,0,0),t.clearRect(0,0,i,r),t.translate(a.x,a.y),t.scale(s,s)}function Mr(e,t,i){var r=e.drawing;t+=1,i.isNode()?(r.drawNode(i,t,"node-underlay"),r.drawNode(i,t,"node-body"),r.drawTexture(i,t,"label"),r.drawNode(i,t,"node-overlay")):(r.drawEdgeLine(i,t),r.drawEdgeArrow(i,t,"source"),r.drawEdgeArrow(i,t,"target"),r.drawTexture(i,t,"label"),r.drawTexture(i,t,"edge-source-label"),r.drawTexture(i,t,"edge-target-label"))}function Mn(e,t,i){e.webglDebug&&(q=performance.now());var r=e.drawing,n=0;if(i.screen&&e.data.canvasNeedsRedraw[e.SELECT_BOX]&&e.drawSelectionRectangle(t,function(t){return Mi(e,t)}),e.data.canvasNeedsRedraw[e.NODE]||i.picking){var a,s,o,l,c,u,h,d,f,p,g,v,y,b,x,_,w,k,E,T,P,S,M,C,A,I,L,D,O,R,N,j=e.data.contexts[e.WEBGL];i.screen?(j.clearColor(0,0,0,0),j.enable(j.BLEND),j.blendFunc(j.ONE,j.ONE_MINUS_SRC_ALPHA)):j.disable(j.BLEND),j.clear(j.COLOR_BUFFER_BIT|j.DEPTH_BUFFER_BIT),j.viewport(0,0,j.canvas.width,j.canvas.height);var B=(a=e.canvasWidth,s=e.canvasHeight,l=(o=SU(e)).pan,c=o.zoom,SJ(u=SK(),u,[l.x,l.y]),S0(u,u,[c,c]),d=h=SK(),d[0]=2/a,d[1]=0,d[2]=0,d[3]=0,d[4]=-2/s,d[5]=0,d[6]=-1,d[7]=1,d[8]=1,p=f=SK(),g=h[0],v=h[1],y=h[2],b=h[3],x=h[4],_=h[5],w=h[6],k=h[7],E=h[8],T=u[0],P=u[1],S=u[2],M=u[3],C=u[4],A=u[5],I=u[6],L=u[7],D=u[8],p[0]=T*g+P*b+S*w,p[1]=T*v+P*x+S*k,p[2]=T*y+P*_+S*E,p[3]=M*g+C*b+A*w,p[4]=M*v+C*x+A*k,p[5]=M*y+C*_+A*E,p[6]=I*g+L*b+D*w,p[7]=I*v+L*x+D*k,p[8]=I*y+L*_+D*E,f),F=e.getCachedZSortedEles();if(n=F.length,r.startFrame(B,i),i.screen){for(var z=0;z<F.nondrag.length;z++)Mr(e,z,F.nondrag[z]);for(var V=0;V<F.drag.length;V++)Mr(e,V,F.drag[V])}else if(i.picking)for(var U=0;U<F.length;U++)Mr(e,U,F[U]);r.endFrame(),i.screen&&e.webglDebugShowAtlases&&((O=e.data.contexts[e.NODE]).save(),Mi(e,O),O.strokeStyle="rgba(0, 0, 0, 0.3)",O.beginPath(),O.moveTo(-1e3,0),O.lineTo(1e3,0),O.stroke(),O.beginPath(),O.moveTo(0,-1e3),O.lineTo(0,1e3),O.stroke(),O.restore(),N=0,(R=function(t,i,r){for(var n=t.atlasManager.getAtlasCollection(i),a=e.data.contexts[e.NODE],s=n.atlases,o=0;o<s.length;o++){var l=s[o].canvas;if(l){var c=l.width,u=l.height,h=c*o,d=l.height*r;a.save(),a.scale(.4,.4),a.drawImage(l,h,d),a.strokeStyle="black",a.rect(h,d,c,u),a.stroke(),a.restore()}}})(e.drawing,"node",N++),R(e.drawing,"label",N++)),e.data.canvasNeedsRedraw[e.NODE]=!1,e.data.canvasNeedsRedraw[e.DRAG]=!1}if(e.webglDebug){var $=Math.ceil(performance.now()-q),W=r.getDebugInfo(),H=["".concat(n," elements"),"".concat(W.totalInstances," instances"),"".concat(W.batchCount," batches"),"".concat(W.totalAtlases," atlases"),"".concat(W.wrappedCount," wrapped textures"),"".concat(W.simpleCount," simple shapes")].join(", ");console.log("WebGL (".concat(i.name,") - frame time ").concat($,"ms")),console.log("Totals:"),console.log("  ".concat(H)),console.log("Texture Atlases Used:");var q,G,Y=vT(W.atlasInfo);try{for(Y.s();!(G=Y.n()).done;){var X=G.value;console.log("  ".concat(X.type,": ").concat(X.keyCount," keys, ").concat(X.atlasCount," atlases"))}}catch(e){Y.e(e)}finally{Y.f()}console.log("")}e.data.gc&&(console.log("Garbage Collect!"),e.data.gc=!1,r.gc())}var Ma={};Ma.drawPolygonPath=function(e,t,i,r,n,a){var s=r/2,o=n/2;e.beginPath&&e.beginPath(),e.moveTo(t+s*a[0],i+o*a[1]);for(var l=1;l<a.length/2;l++)e.lineTo(t+s*a[2*l],i+o*a[2*l+1]);e.closePath()},Ma.drawRoundPolygonPath=function(e,t,i,r,n,a,s){s.forEach(function(t){return PK(e,t)}),e.closePath()},Ma.drawRoundRectanglePath=function(e,t,i,r,n,a){var s=r/2,o=n/2,l="auto"===a?b2(r,n):Math.min(a,o,s);e.beginPath&&e.beginPath(),e.moveTo(t,i-o),e.arcTo(t+s,i-o,t+s,i,l),e.arcTo(t+s,i+o,t,i+o,l),e.arcTo(t-s,i+o,t-s,i,l),e.arcTo(t-s,i-o,t,i-o,l),e.lineTo(t,i-o),e.closePath()},Ma.drawBottomRoundRectanglePath=function(e,t,i,r,n,a){var s=r/2,o=n/2,l="auto"===a?b2(r,n):a;e.beginPath&&e.beginPath(),e.moveTo(t,i-o),e.lineTo(t+s,i-o),e.lineTo(t+s,i),e.arcTo(t+s,i+o,t,i+o,l),e.arcTo(t-s,i+o,t-s,i,l),e.lineTo(t-s,i-o),e.lineTo(t,i-o),e.closePath()},Ma.drawCutRectanglePath=function(e,t,i,r,n,a,s){var o=r/2,l=n/2,c="auto"===s?b4():s;e.beginPath&&e.beginPath(),e.moveTo(t-o+c,i-l),e.lineTo(t+o-c,i-l),e.lineTo(t+o,i-l+c),e.lineTo(t+o,i+l-c),e.lineTo(t+o-c,i+l),e.lineTo(t-o+c,i+l),e.lineTo(t-o,i+l-c),e.lineTo(t-o,i-l+c),e.closePath()},Ma.drawBarrelPath=function(e,t,i,r,n){var a=r/2,s=n/2,o=t-a,l=t+a,c=i-s,u=i+s,h=b5(r,n),d=h.widthOffset,f=h.heightOffset,p=h.ctrlPtOffsetPct*d;e.beginPath&&e.beginPath(),e.moveTo(o,c+f),e.lineTo(o,u-f),e.quadraticCurveTo(o+p,u,o+d,u),e.lineTo(l-d,u),e.quadraticCurveTo(l-p,u,l,u-f),e.lineTo(l,c+f),e.quadraticCurveTo(l-p,c,l-d,c),e.lineTo(o+d,c),e.quadraticCurveTo(o+p,c,o,c+f),e.closePath()};for(var Ms={},Mo={},Ml=Math.PI/40,Mc=0*Math.PI;Mc<2*Math.PI;Mc+=Ml)Ms[Mc]=Math.sin(Mc),Mo[Mc]=Math.cos(Mc);Ma.drawEllipsePath=function(e,t,i,r,n){if(e.beginPath&&e.beginPath(),e.ellipse)e.ellipse(t,i,r/2,n/2,0,0,2*Math.PI);else for(var a,s,o=r/2,l=n/2,c=0*Math.PI;c<2*Math.PI;c+=Ml)a=t-o*Ms[c]*0+o*Mo[c]*1,s=i+l*Mo[c]*0+l*Ms[c]*1,0===c?e.moveTo(a,s):e.lineTo(a,s);e.closePath()};var Mu={};function Mh(e){var t=e.indexOf(",");return e.substr(t+1)}function Md(e,t,i){var r=function(){return t.toDataURL(i,e.quality)};switch(e.output){case"blob-promise":return new _t(function(r,n){try{t.toBlob(function(e){null!=e?r(e):n(Error("`canvas.toBlob()` sent a null value in its callback"))},i,e.quality)}catch(e){n(e)}});case"blob":return function(e,t){for(var i=atob(e),r=new ArrayBuffer(i.length),n=new Uint8Array(r),a=0;a<i.length;a++)n[a]=i.charCodeAt(a);return new Blob([r],{type:t})}(Mh(r()),i);case"base64":return Mh(r());default:return r()}}Mu.createBuffer=function(e,t){var i=document.createElement("canvas");return i.width=e,i.height=t,[i,i.getContext("2d")]},Mu.bufferCanvasImage=function(e){var t=this.cy,i=t.mutableElements().boundingBox(),r=this.findContainerClientCoords(),n=e.full?Math.ceil(i.w):r[2],a=e.full?Math.ceil(i.h):r[3],s=v$(e.maxWidth)||v$(e.maxHeight),o=this.getPixelRatio(),l=1;if(void 0!==e.scale)n*=e.scale,a*=e.scale,l=e.scale;else if(s){var c=1/0,u=1/0;v$(e.maxWidth)&&(c=l*e.maxWidth/n),v$(e.maxHeight)&&(u=l*e.maxHeight/a),n*=l=Math.min(c,u),a*=l}s||(n*=o,a*=o,l*=o);var h=document.createElement("canvas");h.width=n,h.height=a,h.style.width=n+"px",h.style.height=a+"px";var d=h.getContext("2d");if(n>0&&a>0){d.clearRect(0,0,n,a),d.globalCompositeOperation="source-over";var f=this.getCachedZSortedEles();if(e.full)d.translate(-i.x1*l,-i.y1*l),d.scale(l,l),this.drawElements(d,f),d.scale(1/l,1/l),d.translate(i.x1*l,i.y1*l);else{var p=t.pan(),g={x:p.x*l,y:p.y*l};l*=t.zoom(),d.translate(g.x,g.y),d.scale(l,l),this.drawElements(d,f),d.scale(1/l,1/l),d.translate(-g.x,-g.y)}e.bg&&(d.globalCompositeOperation="destination-over",d.fillStyle=e.bg,d.rect(0,0,n,a),d.fill())}return h},Mu.png=function(e){return Md(e,this.bufferCanvasImage(e),"image/png")},Mu.jpg=function(e){return Md(e,this.bufferCanvasImage(e),"image/jpeg")};var Mf={};Mf.nodeShapeImpl=function(e,t,i,r,n,a,s,o){switch(e){case"ellipse":return this.drawEllipsePath(t,i,r,n,a);case"polygon":return this.drawPolygonPath(t,i,r,n,a,s);case"round-polygon":return this.drawRoundPolygonPath(t,i,r,n,a,s,o);case"roundrectangle":case"round-rectangle":return this.drawRoundRectanglePath(t,i,r,n,a,o);case"cutrectangle":case"cut-rectangle":return this.drawCutRectanglePath(t,i,r,n,a,s,o);case"bottomroundrectangle":case"bottom-round-rectangle":return this.drawBottomRoundRectanglePath(t,i,r,n,a,o);case"barrel":return this.drawBarrelPath(t,i,r,n,a)}};var Mp=Mg.prototype;function Mg(e){var t=this,i=t.cy.window().document;e.webgl&&(Mp.CANVAS_LAYERS=t.CANVAS_LAYERS=4,console.log("webgl rendering enabled")),t.data={canvases:Array(Mp.CANVAS_LAYERS),contexts:Array(Mp.CANVAS_LAYERS),canvasNeedsRedraw:Array(Mp.CANVAS_LAYERS),bufferCanvases:Array(Mp.BUFFER_COUNT),bufferContexts:Array(Mp.CANVAS_LAYERS)};var r="-webkit-tap-highlight-color",n="rgba(0,0,0,0)";t.data.canvasContainer=i.createElement("div");var a=t.data.canvasContainer.style;t.data.canvasContainer.style[r]=n,a.position="relative",a.zIndex="0",a.overflow="hidden";var s=e.cy.container();s.appendChild(t.data.canvasContainer),s.style[r]=n;var o={"-webkit-user-select":"none","-moz-user-select":"-moz-none","user-select":"none","-webkit-tap-highlight-color":"rgba(0,0,0,0)","outline-style":"none"};vD&&vD.userAgent.match(/msie|trident|edge/i)&&(o["-ms-touch-action"]="none",o["touch-action"]="none");for(var l=0;l<Mp.CANVAS_LAYERS;l++){var c=t.data.canvases[l]=i.createElement("canvas"),u=Mp.CANVAS_TYPES[l];t.data.contexts[l]=c.getContext(u),t.data.contexts[l]||yj("Could not create canvas of type "+u),Object.keys(o).forEach(function(e){c.style[e]=o[e]}),c.style.position="absolute",c.setAttribute("data-id","layer"+l),c.style.zIndex=String(Mp.CANVAS_LAYERS-l),t.data.canvasContainer.appendChild(c),t.data.canvasNeedsRedraw[l]=!1}t.data.topCanvas=t.data.canvases[0],t.data.canvases[Mp.NODE].setAttribute("data-id","layer"+Mp.NODE+"-node"),t.data.canvases[Mp.SELECT_BOX].setAttribute("data-id","layer"+Mp.SELECT_BOX+"-selectbox"),t.data.canvases[Mp.DRAG].setAttribute("data-id","layer"+Mp.DRAG+"-drag"),t.data.canvases[Mp.WEBGL]&&t.data.canvases[Mp.WEBGL].setAttribute("data-id","layer"+Mp.WEBGL+"-webgl");for(var l=0;l<Mp.BUFFER_COUNT;l++)t.data.bufferCanvases[l]=i.createElement("canvas"),t.data.bufferContexts[l]=t.data.bufferCanvases[l].getContext("2d"),t.data.bufferCanvases[l].style.position="absolute",t.data.bufferCanvases[l].setAttribute("data-id","buffer"+l),t.data.bufferCanvases[l].style.zIndex=String(-l-1),t.data.bufferCanvases[l].style.visibility="hidden";t.pathsEnabled=!0;var h=bx(),d=function(e){return{x:-e.w/2,y:-e.h/2}},f=function(e){return e[0]._private.nodeKey},p=function(e){return e[0]._private.labelStyleKey},g=function(e){return e[0]._private.sourceLabelStyleKey},v=function(e){return e[0]._private.targetLabelStyleKey},y=function(e,i,r,n,a){return t.drawElement(e,i,r,!1,!1,a)},b=function(e,i,r,n,a){return t.drawElementText(e,i,r,n,"main",a)},x=function(e,i,r,n,a){return t.drawElementText(e,i,r,n,"source",a)},_=function(e,i,r,n,a){return t.drawElementText(e,i,r,n,"target",a)},w=function(e){return e.boundingBox(),e[0]._private.bodyBounds},k=function(e){return e.boundingBox(),e[0]._private.labelBounds.main||h},E=function(e){return e.boundingBox(),e[0]._private.labelBounds.source||h},T=function(e){return e.boundingBox(),e[0]._private.labelBounds.target||h},P=function(e,t){return t},S=function(e){var t;return{x:((t=w(e)).x1+t.x2)/2,y:(t.y1+t.y2)/2}},M=function(e,t,i){var r=e?e+"-":"";return{x:t.x+i.pstyle(r+"text-margin-x").pfValue,y:t.y+i.pstyle(r+"text-margin-y").pfValue}},C=function(e,t,i){var r=e[0]._private.rscratch;return{x:r[t],y:r[i]}},A=function(e){return M("",C(e,"labelX","labelY"),e)},I=function(e){return M("source",C(e,"sourceLabelX","sourceLabelY"),e)},L=function(e){return M("target",C(e,"targetLabelX","targetLabelY"),e)},D=function(e){return d(w(e))},O=function(e){return d(E(e))},R=function(e){return d(T(e))},N=function(e){var t=k(e),i=d(k(e));if(e.isNode()){switch(e.pstyle("text-halign").value){case"left":i.x=-t.w-(t.leftPad||0);break;case"right":i.x=-(t.rightPad||0)}switch(e.pstyle("text-valign").value){case"top":i.y=-t.h-(t.topPad||0);break;case"bottom":i.y=-(t.botPad||0)}}return i},j=t.data.eleTxrCache=new Sp(t,{getKey:f,doesEleInvalidateKey:function(e){var t=e[0]._private;return t.oldBackgroundTimestamp!==t.backgroundTimestamp},drawElement:y,getBoundingBox:w,getRotationPoint:S,getRotationOffset:D,allowEdgeTxrCaching:!1,allowParentTxrCaching:!1}),B=t.data.lblTxrCache=new Sp(t,{getKey:p,drawElement:b,getBoundingBox:k,getRotationPoint:A,getRotationOffset:N,isVisible:P}),F=t.data.slbTxrCache=new Sp(t,{getKey:g,drawElement:x,getBoundingBox:E,getRotationPoint:I,getRotationOffset:O,isVisible:P}),z=t.data.tlbTxrCache=new Sp(t,{getKey:v,drawElement:_,getBoundingBox:T,getRotationPoint:L,getRotationOffset:R,isVisible:P}),V=t.data.lyrTxrCache=new Sm(t);t.onUpdateEleCalcs(function(e,t){j.invalidateElements(t),B.invalidateElements(t),F.invalidateElements(t),z.invalidateElements(t),V.invalidateElements(t);for(var i=0;i<t.length;i++){var r=t[i]._private;r.oldBackgroundTimestamp=r.backgroundTimestamp}});var U=function(e){for(var t=0;t<e.length;t++)V.enqueueElementRefinement(e[t].ele)};j.onDequeue(U),B.onDequeue(U),F.onDequeue(U),z.onDequeue(U),e.webgl&&t.initWebgl(e,{getStyleKey:f,getLabelKey:p,getSourceLabelKey:g,getTargetLabelKey:v,drawElement:y,drawLabel:b,drawSourceLabel:x,drawTargetLabel:_,getElementBox:w,getLabelBox:k,getSourceLabelBox:E,getTargetLabelBox:T,getElementRotationPoint:S,getElementRotationOffset:D,getLabelRotationPoint:A,getSourceLabelRotationPoint:I,getTargetLabelRotationPoint:L,getLabelRotationOffset:N,getSourceLabelRotationOffset:O,getTargetLabelRotationOffset:R})}Mp.CANVAS_LAYERS=3,Mp.SELECT_BOX=0,Mp.DRAG=1,Mp.NODE=2,Mp.WEBGL=3,Mp.CANVAS_TYPES=["2d","2d","2d","webgl2"],Mp.BUFFER_COUNT=3,Mp.TEXTURE_BUFFER=0,Mp.MOTIONBLUR_BUFFER_NODE=1,Mp.MOTIONBLUR_BUFFER_DRAG=2,Mp.redrawHint=function(e,t){switch(e){case"eles":this.data.canvasNeedsRedraw[Mp.NODE]=t;break;case"drag":this.data.canvasNeedsRedraw[Mp.DRAG]=t;break;case"select":this.data.canvasNeedsRedraw[Mp.SELECT_BOX]=t;break;case"gc":this.data.gc=!0}};var Mm="undefined"!=typeof Path2D;Mp.path2dEnabled=function(e){if(void 0===e)return this.pathsEnabled;this.pathsEnabled=!!e},Mp.usePaths=function(){return Mm&&this.pathsEnabled},Mp.setImgSmoothing=function(e,t){null!=e.imageSmoothingEnabled?e.imageSmoothingEnabled=t:(e.webkitImageSmoothingEnabled=t,e.mozImageSmoothingEnabled=t,e.msImageSmoothingEnabled=t)},Mp.getImgSmoothing=function(e){return null!=e.imageSmoothingEnabled?e.imageSmoothingEnabled:e.webkitImageSmoothingEnabled||e.mozImageSmoothingEnabled||e.msImageSmoothingEnabled},Mp.makeOffscreenCanvas=function(e,t){var i;return("undefined"==typeof OffscreenCanvas?"undefined":vA(OffscreenCanvas))!=="undefined"?i=new OffscreenCanvas(e,t):((i=this.cy.window().document.createElement("canvas")).width=e,i.height=t),i},[Sb,ST,SL,SO,SR,Sj,SF,S9,Ma,Mu,Mf].forEach(function(e){ye(Mp,e)});var Mv=[{name:"null",impl:kQ},{name:"base",impl:So},{name:"canvas",impl:Mg}],My={},Mb={};function Mx(e,t,i){var r=i,n=function(i){yF("Can not register `"+t+"` for `"+e+"` since `"+i+"` already exists in the prototype and can not be overridden")};if("core"===e)if(kd.prototype[t])return n(t);else kd.prototype[t]=i;else if("collection"===e)if(wH.prototype[t])return n(t);else wH.prototype[t]=i;else if("layout"===e){for(var a=function(e){this.options=e,i.call(this,e),vU(this._private)||(this._private={}),this._private.cy=e.cy,this._private.listeners=[],this.createEmitter()},s=a.prototype=Object.create(i.prototype),o=[],l=0;l<o.length;l++){var c=o[l];s[c]=s[c]||function(){return this}}s.start&&!s.run?s.run=function(){return this.start(),this}:!s.start&&s.run&&(s.start=function(){return this.run(),this});var u=i.prototype.stop;s.stop=function(){var e=this.options;if(e&&e.animate){var t=this.animations;if(t)for(var i=0;i<t.length;i++)t[i].stop()}return u?u.call(this):this.emit("layoutstop"),this},s.destroy||(s.destroy=function(){return this}),s.cy=function(){return this._private.cy};var h=function(e){return e._private.cy},d={addEventFields:function(e,t){t.layout=e,t.cy=h(e),t.target=e},bubble:function(){return!0},parent:function(e){return h(e)}};ye(s,{createEmitter:function(){return this._private.emitter=new wg(d,this),this},emitter:function(){return this._private.emitter},on:function(e,t){return this.emitter().on(e,t),this},one:function(e,t){return this.emitter().one(e,t),this},once:function(e,t){return this.emitter().one(e,t),this},removeListener:function(e,t){return this.emitter().removeListener(e,t),this},removeAllListeners:function(){return this.emitter().removeAllListeners(),this},emit:function(e,t){return this.emitter().emit(e,t),this}}),_y.eventAliasesOn(s),r=a}else if("renderer"===e&&"null"!==t&&"base"!==t){var f=M_("renderer","base"),p=f.prototype,g=i.prototype,v=function(){f.apply(this,arguments),i.apply(this,arguments)},y=v.prototype;for(var b in p){var x=p[b];if(null!=g[b])return n(b);y[b]=x}for(var _ in g)y[_]=g[_];p.clientFunctions.forEach(function(e){y[e]=y[e]||function(){yj("Renderer does not implement `renderer."+e+"()` on its prototype")}}),r=v}else if("__proto__"===e||"constructor"===e||"prototype"===e)return yj(e+" is an illegal type to be registered, possibly lead to prototype pollutions");return ys({map:My,keys:[e,t],value:r})}function M_(e,t){return yo({map:My,keys:[e,t]})}function Mw(e,t,i,r,n){return ys({map:Mb,keys:[e,t,i,r],value:n})}function Mk(e,t,i,r){return yo({map:Mb,keys:[e,t,i,r]})}var ME=function(){return 2==arguments.length?M_.apply(null,arguments):3==arguments.length?Mx.apply(null,arguments):4==arguments.length?Mk.apply(null,arguments):5==arguments.length?Mw.apply(null,arguments):void yj("Invalid extension access syntax")};kd.prototype.extension=ME,[{type:"layout",extensions:kJ},{type:"renderer",extensions:Mv}].forEach(function(e){e.extensions.forEach(function(t){Mx(e.type,t.name,t.impl)})});var MT=function(){if(!(this instanceof MT))return new MT;this.length=0},MP=MT.prototype;MP.instanceString=function(){return"stylesheet"},MP.selector=function(e){return this[this.length++]={selector:e,properties:[]},this},MP.css=function(e,t){var i=this.length-1;if(vF(e))this[i].properties.push({name:e,value:t});else if(vU(e))for(var r=Object.keys(e),n=0;n<r.length;n++){var a=r[n],s=e[a];if(null!=s){var o=kl.properties[a]||kl.properties[v0(a)];if(null!=o){var l=o.name;this[i].properties.push({name:l,value:s})}}}return this},MP.style=MP.css,MP.generateStyle=function(e){var t=new kl(e);return this.appendToStyle(t)},MP.appendToStyle=function(e){for(var t=0;t<this.length;t++){var i=this[t],r=i.selector,n=i.properties;e.selector(r);for(var a=0;a<n.length;a++){var s=n[a];e.css(s.name,s.value)}}return e};var MS=function(e){return(void 0===e&&(e={}),vU(e))?new kd(e):vF(e)?ME.apply(ME,arguments):void 0};function MM({data:e}){let t=(0,x.useRef)(null),i=(0,x.useRef)(null);return(0,x.useEffect)(()=>{if(!t.current)return;let e=MS({container:t.current,elements:[{data:{id:"1",label:"Validation",type:"operator",entropy:50},classes:"operator high-entropy"},{data:{id:"2",label:"Temporal",type:"operator",entropy:45.8},classes:"operator high-entropy"},{data:{id:"3",label:"Geographic",type:"operator",entropy:40},classes:"operator high-entropy"},{data:{id:"4",label:"Batch",type:"operator",entropy:32.9},classes:"operator medium-entropy"},{data:{id:"5",label:"Threshold",type:"operator",entropy:26.6},classes:"operator medium-entropy"},{data:{id:"6",label:"Cascading",type:"operator",entropy:20.4},classes:"operator low-entropy"},{data:{id:"7",label:"Complex",type:"operator",entropy:14.2},classes:"operator low-entropy"},{data:{id:"8",label:"Deterministic",type:"operator",entropy:8},classes:"operator very-low-entropy"},{data:{id:"jtbd1",label:"Order Fulfillment",type:"jtbd"},classes:"jtbd"},{data:{id:"jtbd2",label:"Recurring Purchase",type:"jtbd"},classes:"jtbd"},{data:{id:"jtbd3",label:"Listing Compliance",type:"jtbd"},classes:"jtbd"},{data:{id:"jtbd5",label:"Address Validation",type:"jtbd"},classes:"jtbd"},{data:{id:"jtbd6",label:"Bulk Updates",type:"jtbd"},classes:"jtbd"},{data:{id:"before-add",label:"before-add",type:"trigger"},classes:"trigger"},{data:{id:"after-add",label:"after-add",type:"trigger"},classes:"trigger"},{data:{id:"on-interval",label:"on-interval",type:"trigger"},classes:"trigger"},{data:{source:"1",target:"2",type:"flow",weight:4.2}},{data:{source:"2",target:"3",type:"flow",weight:5.8}},{data:{source:"3",target:"4",type:"flow",weight:7.1}},{data:{source:"4",target:"5",type:"flow",weight:6.3}},{data:{source:"5",target:"6",type:"flow",weight:5.9}},{data:{source:"6",target:"7",type:"flow",weight:6.2}},{data:{source:"7",target:"8",type:"flow",weight:5.4}},{data:{source:"jtbd1",target:"1",type:"uses"}},{data:{source:"jtbd2",target:"2",type:"uses"}},{data:{source:"jtbd3",target:"1",type:"uses"}},{data:{source:"jtbd5",target:"3",type:"uses"}},{data:{source:"jtbd6",target:"4",type:"uses"}},{data:{source:"before-add",target:"1",type:"triggers"}},{data:{source:"before-add",target:"3",type:"triggers"}},{data:{source:"after-add",target:"7",type:"triggers"}},{data:{source:"on-interval",target:"2",type:"triggers"}}],style:[{selector:"node",style:{"background-color":"#1e293b","border-color":"#cbd5e1","border-width":2,"text-valign":"center","text-halign":"center","font-size":12,color:"#e2e8f0",padding:"8px","min-zoomed-font-size":8}},{selector:"node.operator",style:{shape:"round-rectangle",width:70,height:50,"font-weight":"bold",color:"#06b6d4"}},{selector:"node.operator.high-entropy",style:{"background-color":"#ea580c","border-color":"#f97316",color:"#ffffff"}},{selector:"node.operator.medium-entropy",style:{"background-color":"#d97706","border-color":"#f59e0b",color:"#ffffff"}},{selector:"node.operator.low-entropy",style:{"background-color":"#dc2626","border-color":"#ef4444",color:"#ffffff"}},{selector:"node.operator.very-low-entropy",style:{"background-color":"#7c3aed","border-color":"#a78bfa",color:"#ffffff"}},{selector:"node.jtbd",style:{shape:"square",width:60,height:60,"background-color":"#0369a1","border-color":"#0ea5e9",color:"#e0f2fe","font-size":10}},{selector:"node.trigger",style:{shape:"diamond",width:50,height:50,"background-color":"#059669","border-color":"#10b981",color:"#d1fae5","font-size":9}},{selector:"edge",style:{"line-color":"#64748b","target-arrow-color":"#64748b","target-arrow-shape":"triangle","arrow-scale":1.2,"curve-style":"bezier",width:1.5}},{selector:'edge[type="flow"]',style:{"line-color":"#a855f7","target-arrow-color":"#a855f7",width:2}},{selector:'edge[type="uses"]',style:{"line-color":"#0ea5e9","target-arrow-color":"#0ea5e9",width:1.5,"line-style":"dashed"}},{selector:'edge[type="triggers"]',style:{"line-color":"#10b981","target-arrow-color":"#10b981",width:1.5,"line-style":"dotted"}},{selector:":selected",style:{"background-color":"#06b6d4","border-color":"#00d9ff","border-width":3,"line-color":"#06b6d4","target-arrow-color":"#06b6d4"}},{selector:":hover",style:{"background-color":"#22d3ee","border-color":"#06f","border-width":3}}],layout:{name:"cose",directed:!0,roots:"#1",animate:!0,animationDuration:500,avoidOverlap:!0,nodeSpacing:10,gravity:-30,cooling:.99,coolingFactor:.999,initialTemp:1e3,nestingFactor:1.2,repulsiveStrength:100,attractiveStrength:1,edgeElasticity:100,randomize:!1}});return i.current=e,e.on("tap","node",e=>{console.log("Selected:",e.target.data())}),e.on("mouseover","node",e=>{e.target.style("overlay-opacity",.2)}),e.on("mouseout","node",e=>{e.target.style("overlay-opacity",0)}),e.fit(),()=>{e.destroy()}},[e]),(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold text-cyan-400",children:"Knowledge Hook Graph"}),(0,b.jsx)("p",{className:"text-sm text-slate-400",children:"Interactive visualization of (O) operator chains, JTBD scenarios, and trigger mappings. Purple edges show information flow; blue dashed edges show JTBD usage; green dotted edges show trigger associations."})]}),(0,b.jsx)("div",{className:"card h-96 rounded border border-slate-700 overflow-hidden bg-slate-950",ref:t}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,b.jsxs)("div",{className:"bg-slate-900/50 border border-slate-700 rounded p-4 space-y-3",children:[(0,b.jsx)("div",{className:"font-semibold text-cyan-400",children:"Operators (Nodes)"}),(0,b.jsxs)("div",{className:"space-y-2 text-xs text-slate-300",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"w-4 h-4 bg-orange-500 rounded"}),(0,b.jsx)("span",{children:"High Entropy (-): 50  32.9 nats"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"w-4 h-4 bg-amber-600 rounded"}),(0,b.jsx)("span",{children:"Medium Entropy (): 26.6 nats"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"w-4 h-4 bg-red-600 rounded"}),(0,b.jsx)("span",{children:"Low Entropy (-): 20.4  14.2 nats"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"w-4 h-4 bg-purple-600 rounded"}),(0,b.jsx)("span",{children:"Deterministic (): 8.0 nats"})]})]})]}),(0,b.jsxs)("div",{className:"bg-slate-900/50 border border-slate-700 rounded p-4 space-y-3",children:[(0,b.jsx)("div",{className:"font-semibold text-cyan-400",children:"JTBD Scenarios"}),(0,b.jsxs)("div",{className:"space-y-2 text-xs text-slate-300",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"w-4 h-4 bg-cyan-600 rounded"}),(0,b.jsx)("span",{children:"Job To Be Done scenarios"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"w-4 h-4 bg-green-600 rounded"}),(0,b.jsx)("span",{children:"Hook Triggers (before-add, after-add, on-interval)"})]})]})]}),(0,b.jsxs)("div",{className:"bg-slate-900/50 border border-slate-700 rounded p-4 space-y-3",children:[(0,b.jsx)("div",{className:"font-semibold text-cyan-400",children:"Edge Types"}),(0,b.jsxs)("div",{className:"space-y-2 text-xs text-slate-300",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"w-6 h-0.5 bg-purple-500"}),(0,b.jsx)("span",{children:"Information Flow"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"w-6 h-0.5 bg-cyan-500",style:{borderTop:"1px dashed"}}),(0,b.jsx)("span",{children:"JTBD Usage"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"w-6 h-0.5 bg-green-500",style:{borderTop:"1px dotted"}}),(0,b.jsx)("span",{children:"Trigger Association"})]})]})]})]}),(0,b.jsxs)("div",{className:"bg-slate-800/50 rounded-lg p-4 space-y-3",children:[(0,b.jsx)("div",{className:"font-semibold text-cyan-400",children:"Graph Insights"}),(0,b.jsxs)("ul",{className:"space-y-2 text-sm text-slate-300",children:[(0,b.jsxs)("li",{className:"flex gap-2",children:[(0,b.jsx)("span",{className:"inline-block w-1.5 h-1.5 rounded-full bg-cyan-400 mt-1 flex-shrink-0"}),(0,b.jsx)("span",{children:"Operators form a deterministic chain: user intent (50 nats)  observable outcome (1 nat)"})]}),(0,b.jsxs)("li",{className:"flex gap-2",children:[(0,b.jsx)("span",{className:"inline-block w-1.5 h-1.5 rounded-full bg-purple-400 mt-1 flex-shrink-0"}),(0,b.jsx)("span",{children:"5 JTBD scenarios depend on validators (, ) and batch processor ()"})]}),(0,b.jsxs)("li",{className:"flex gap-2",children:[(0,b.jsx)("span",{className:"inline-block w-1.5 h-1.5 rounded-full bg-green-400 mt-1 flex-shrink-0"}),(0,b.jsx)("span",{children:"Three hook triggers activate different operators: before-add, after-add, on-interval"})]}),(0,b.jsxs)("li",{className:"flex gap-2",children:[(0,b.jsx)("span",{className:"inline-block w-1.5 h-1.5 rounded-full bg-orange-400 mt-1 flex-shrink-0"}),(0,b.jsx)("span",{children:"Click nodes to inspect details; use mouse to pan and zoom"})]})]})]})]})}MS.use=function(e){var t=Array.prototype.slice.call(arguments,1);return t.unshift(MS),e.apply(null,t),this},MS.warnings=function(e){return yB(e)},MS.version="3.33.1",MS.stylesheet=MS.Stylesheet=MT;let MC=[{id:"knowledge-hooks-c4-context",title:"Knowledge Hooks - C4 Context",description:"System context diagram showing knowledge hooks architecture",category:"Architecture",content:`@startuml knowledge-hooks-c4-context
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Context.puml

LAYOUT_WITH_LEGEND()

title Knowledge Hooks - C4 Context Diagram

Person(user, "User", "Creates intents and observes outcomes")
System(kh, "Knowledge Hooks Engine", "Transforms intent to outcome through (O) operators")
System_Ext(rdf, "RDF Store", "Persists ontologies and quads")

Rel(user, kh, "Executes hooks")
Rel(kh, rdf, "Reads/writes")

@enduml`},{id:"knowledge-hooks-sequence",title:"Knowledge Hooks - Execution Sequence",description:"Sequence diagram showing hook execution flow",category:"Flow",content:`@startuml knowledge-hooks-sequence
title Knowledge Hooks - Execution Sequence

participant User as user
participant "Hook Manager" as hm
participant "Executor" as ex
participant "(O) Operators" as op
participant "Store" as store

user -> hm: executeByTrigger(trigger, quad)
hm -> hm: findHooksByTrigger()
hm -> ex: compiledChain(hooks)
ex -> op: validate(quad)
op -> op: reduce entropy
ex -> store: updateQuad()
store --> ex: success
ex --> hm: result
hm --> user: outcome

@enduml`},{id:"hook-execution-flow",title:"Hook Execution Flow",description:"Detailed flow of hook execution with error handling",category:"Flow",content:`@startuml hook-execution-flow
title Hook Execution Flow

start
:Receive trigger + quad;
:Validate hook schema;
if (Valid?) then (no)
  :Return error;
  stop
else (yes)
  :Find matching hooks;
  if (Found?) then (no)
    :Return noop;
    stop
  else (yes)
    :Execute hook chain;
    if (Has validation?) then (yes)
      :Run validate();
      if (Valid?) then (no)
        :Log failure;
        :Return invalid;
        stop
      else (yes)
      endif
    endif
    if (Has transform?) then (yes)
      :Run transform();
      if (Successful?) then (no)
        :Log error;
        :Return error;
        stop
      else (yes)
      endif
    endif
    :Persist changes;
    :Return success;
    stop
  endif
endif
end

@enduml`},{id:"operator-chain-entropy",title:"(O) Operator Chain - Entropy Reduction",description:"Shows 8-operator chain with entropy reduction (501 nats)",category:"Operators",content:`@startuml operator-chain-entropy
title (O) Calculus: Operator Chain Entropy Reduction

skinparam backgroundColor #1e293b
skinparam ArrowColor #a855f7
skinparam ClassBackgroundColor #ea580c
skinparam ClassBorderColor #f97316

class 1 {
  **Validation**
  Entropy: 50  45.8
  Reduction: 4.2 nats
  Trigger: before-add
}

class 2 {
  **Temporal**
  Entropy: 45.8  40.0
  Reduction: 5.8 nats
  Trigger: on-interval
}

class 3 {
  **Geographic**
  Entropy: 40.0  32.9
  Reduction: 7.1 nats
  Trigger: before-add
}

class 4 {
  **Batch**
  Entropy: 32.9  26.6
  Reduction: 6.3 nats
  Trigger: before-add
}

class 5 {
  **Threshold**
  Entropy: 26.6  20.4
  Reduction: 5.9 nats
  Trigger: on-interval
}

class 6 {
  **Cascading**
  Entropy: 20.4  14.2
  Reduction: 6.2 nats
  Trigger: after-add
}

class 7 {
  **Complex**
  Entropy: 14.2  8.0
  Reduction: 5.4 nats
  Trigger: before-add
}

class 8 {
  **Deterministic**
  Entropy: 8.0  1.0
  Reduction: 0.1 nats
  Trigger: after-add
}

1 --> 2
2 --> 3
3 --> 4
4 --> 5
5 --> 6
6 --> 7
7 --> 8

@enduml`},{id:"federation-protocol",title:"Federation Protocol",description:"Multi-agent federation and consensus protocol",category:"Protocol",content:`@startuml federation-protocol
title Knowledge Hooks - Federation Protocol

participant "Agent A" as a
participant "Federation Manager" as fm
participant "Agent B" as b
participant "Agent C" as c

a -> fm: propose(change)
fm -> b: broadcast(change)
fm -> c: broadcast(change)
b -> b: validate()
c -> c: validate()
b -> fm: vote(yes)
c -> fm: vote(yes)
fm -> fm: consensus check
fm -> a: commit(change)
fm -> b: commit(change)
fm -> c: commit(change)

@enduml`},{id:"raft-consensus",title:"Raft Consensus Protocol",description:"Leader election and log replication in Raft",category:"Protocol",content:`@startuml raft-consensus
title Raft Consensus - Leader Election

state Follower
state Candidate
state Leader

[*] --> Follower

Follower --> Candidate: election timeout\\nincrement term\\nvote for self
Candidate --> Follower: receive higher term
Candidate --> Leader: receive majority votes\\nbecome leader
Leader --> Follower: receive higher term\\nstep down
Follower --> [*]

note right of Leader
  - Send heartbeats
  - Replicate log entries
  - Commit entries
end note

@enduml`},{id:"swarm-coordination",title:"Swarm Coordination",description:"Multi-agent swarm topology and task distribution",category:"Architecture",content:`@startuml swarm-coordination
title Knowledge Hooks - Swarm Coordination

skinparam BackgroundColor #1e293b

package "Coordinator" {
  [Task Orchestrator]
  [Load Balancer]
}

package "Agent Pool" {
  [Agent 1]
  [Agent 2]
  [Agent 3]
  [Agent 4]
}

package "Shared State" {
  database "Memory" as mem
  database "Store" as store
}

[Task Orchestrator] --> [Load Balancer]
[Load Balancer] --> [Agent 1]
[Load Balancer] --> [Agent 2]
[Load Balancer] --> [Agent 3]
[Load Balancer] --> [Agent 4]

[Agent 1] --> mem
[Agent 2] --> mem
[Agent 3] --> mem
[Agent 4] --> mem

[Agent 1] --> store
[Agent 2] --> store
[Agent 3] --> store
[Agent 4] --> store

@enduml`}];function MA({data:e}){let[t,i]=(0,x.useState)(MC[0]),[r,n]=(0,x.useState)("All"),a=(0,x.useRef)(null),s=["All",...new Set(MC.map(e=>e.category))],o="All"===r?MC:MC.filter(e=>e.category===r);return(0,x.useEffect)(()=>{if(a.current&&t){a.current.innerHTML="";let e=document.createElement("pre");e.className="bg-slate-900 text-slate-300 p-4 rounded text-xs overflow-auto max-h-96",e.textContent=t.content,a.current.appendChild(e)}},[t]),(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold text-cyan-400",children:"Architecture & Design Diagrams"}),(0,b.jsx)("p",{className:"text-sm text-slate-400",children:"PlantUML diagrams showing knowledge hooks architecture, execution flows, federation protocols, and consensus mechanisms."})]}),(0,b.jsx)("div",{className:"flex flex-wrap gap-2",children:s.map(e=>(0,b.jsx)("button",{onClick:()=>n(e),className:`px-4 py-2 rounded text-sm font-medium transition-colors ${r===e?"bg-cyan-500 text-slate-900":"bg-slate-800 text-slate-400 hover:text-slate-200 border border-slate-700"}`,children:e},e))}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("h4",{className:"text-sm font-semibold text-slate-300",children:["Diagrams (",o.length,")"]}),(0,b.jsx)("div",{className:"space-y-2 max-h-96 overflow-y-auto border border-slate-700 rounded p-3 bg-slate-900/50",children:o.map(e=>(0,b.jsxs)("button",{onClick:()=>i(e),className:`w-full text-left px-3 py-2 rounded text-sm transition-colors ${t.id===e.id?"bg-cyan-900/50 border border-cyan-500 text-cyan-300":"border border-slate-700 text-slate-300 hover:bg-slate-800"}`,children:[(0,b.jsx)("div",{className:"font-semibold",children:e.title}),(0,b.jsx)("div",{className:"text-xs text-slate-500",children:e.category})]},e.id))})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"bg-slate-900/50 border border-slate-700 rounded p-4",children:[(0,b.jsx)("h4",{className:"text-sm font-semibold text-cyan-400 mb-2",children:t.title}),(0,b.jsx)("p",{className:"text-xs text-slate-400 mb-3",children:t.description}),(0,b.jsx)("div",{ref:a,className:"bg-slate-950 rounded border border-slate-700 p-3 min-h-64 overflow-auto"})]}),(0,b.jsxs)("div",{className:"bg-slate-900/50 border border-slate-700 rounded p-3 text-xs text-slate-400",children:[(0,b.jsx)("div",{className:"font-semibold text-cyan-400 mb-1",children:"PlantUML Format"}),(0,b.jsx)("div",{children:"Diagrams show architecture, flows, protocols, and operator chains"})]})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,b.jsxs)("div",{className:"bg-slate-900/50 border border-slate-700 rounded p-4",children:[(0,b.jsx)("div",{className:"text-xs text-slate-400 uppercase",children:"Total Diagrams"}),(0,b.jsx)("div",{className:"text-2xl font-bold text-cyan-400 mt-1",children:MC.length})]}),(0,b.jsxs)("div",{className:"bg-slate-900/50 border border-slate-700 rounded p-4",children:[(0,b.jsx)("div",{className:"text-xs text-slate-400 uppercase",children:"Categories"}),(0,b.jsx)("div",{className:"text-2xl font-bold text-cyan-400 mt-1",children:s.length-1})]}),(0,b.jsxs)("div",{className:"bg-slate-900/50 border border-slate-700 rounded p-4",children:[(0,b.jsx)("div",{className:"text-xs text-slate-400 uppercase",children:"Operators"}),(0,b.jsx)("div",{className:"text-2xl font-bold text-cyan-400 mt-1",children:"8 (-)"})]}),(0,b.jsxs)("div",{className:"bg-slate-900/50 border border-slate-700 rounded p-4",children:[(0,b.jsx)("div",{className:"text-xs text-slate-400 uppercase",children:"Entropy Reduction"}),(0,b.jsx)("div",{className:"text-2xl font-bold text-cyan-400 mt-1",children:"50  1"})]})]}),(0,b.jsxs)("div",{className:"card space-y-3",children:[(0,b.jsx)("h4",{className:"font-semibold text-cyan-400",children:"Knowledge Hooks System Overview"}),(0,b.jsxs)("ul",{className:"space-y-2 text-sm text-slate-300",children:[(0,b.jsxs)("li",{className:"flex gap-2",children:[(0,b.jsx)("span",{className:"inline-block w-1.5 h-1.5 rounded-full bg-orange-400 mt-1.5 flex-shrink-0"}),(0,b.jsxs)("span",{children:[(0,b.jsx)("strong",{children:"Architecture:"})," C4 context diagrams showing system boundaries and interactions"]})]}),(0,b.jsxs)("li",{className:"flex gap-2",children:[(0,b.jsx)("span",{className:"inline-block w-1.5 h-1.5 rounded-full bg-purple-400 mt-1.5 flex-shrink-0"}),(0,b.jsxs)("span",{children:[(0,b.jsx)("strong",{children:"Flows:"})," Execution sequences showing hook validation, transformation, and persistence"]})]}),(0,b.jsxs)("li",{className:"flex gap-2",children:[(0,b.jsx)("span",{className:"inline-block w-1.5 h-1.5 rounded-full bg-cyan-400 mt-1.5 flex-shrink-0"}),(0,b.jsxs)("span",{children:[(0,b.jsx)("strong",{children:"Operators:"})," 8-stage operator chain (-) with entropy reduction from 50 to 1 nats"]})]}),(0,b.jsxs)("li",{className:"flex gap-2",children:[(0,b.jsx)("span",{className:"inline-block w-1.5 h-1.5 rounded-full bg-green-400 mt-1.5 flex-shrink-0"}),(0,b.jsxs)("span",{children:[(0,b.jsx)("strong",{children:"Protocols:"})," Federation, Raft consensus, and swarm coordination for distributed execution"]})]})]})]}),(0,b.jsxs)("div",{className:"bg-slate-800/50 rounded-lg p-4 space-y-2 text-xs text-slate-400",children:[(0,b.jsx)("div",{className:"font-semibold text-slate-300",children:"PlantUML Diagram Sources"}),(0,b.jsxs)("div",{children:["Diagrams sourced from: ",(0,b.jsx)("code",{children:"/docs/diagrams/*.puml"})," including knowledge hooks architecture, execution flows, federation protocols, RAFT consensus, and distributed system coordination patterns."]}),(0,b.jsxs)("div",{className:"mt-2",children:[(0,b.jsx)("strong",{children:"Note:"})," For full PlantUML rendering in production, integrate with plantuml.com API or @mermaid-js/mermaid-cli for server-side SVG generation."]})]})]})}let MI=(0,_.default)(()=>e.A(87872),{loadableGenerated:{modules:[35392]},ssr:!1,loading:()=>(0,b.jsx)("div",{className:"card h-96 flex items-center justify-center",children:(0,b.jsx)("div",{className:"text-slate-400",children:"Loading 3D visualization..."})})});function ML(){let[e,t]=(0,x.useState)("overview"),i=(0,x.useMemo)(()=>({singleOperator:{latency:.853,range:[.742,.964],unit:"s"},eightOperatorChain:{latency:6.824,range:[5.891,7.756],unit:"s"},throughput:{opsPerSec:117e4,description:"Sustained throughput across all operators"},informationProcessing:{rate:8.4,perOperator:"1.05M",totalPerChain:"8.4M",unit:"nats/sec"},entropyReduction:{initial:50,final:1,reductionRate:.0588,stages:[{operator:"",reduction:4.2,entropy:"50  45.8"},{operator:"",reduction:5.8,entropy:"45.8  40.0"},{operator:"",reduction:7.1,entropy:"40.0  32.9"},{operator:"",reduction:6.3,entropy:"32.9  26.6"},{operator:"",reduction:5.9,entropy:"26.6  20.4"},{operator:"",reduction:6.2,entropy:"20.4  14.2"},{operator:"",reduction:5.4,entropy:"14.2  8.0"},{operator:"",reduction:.1,entropy:"8.0  1.0"}]},fmea:{totalFailureModes:51,riskReduction:86,categories:6,topRisks:[{id:"FM-001",name:"Silent Error Swallowing",before:504,after:50},{id:"FM-002",name:"Audit Log Unbounded Growth",before:448,after:45},{id:"FM-003",name:"Scheduler Error Swallowing",before:432,after:43},{id:"FM-004",name:"Hook Validation Timeout",before:384,after:38},{id:"FM-005",name:"Async Hook Silent Failure",before:336,after:34}]},jtbd:[{id:"JTBD-1",name:"Order Fulfillment",latency:2.53,reduction:48.2},{id:"JTBD-2",name:"Recurring Purchase",latency:3.12,reduction:47.1},{id:"JTBD-3",name:"Listing Compliance",latency:2.89,reduction:49.4},{id:"JTBD-5",name:"Address Validation",latency:1.87,reduction:46.8},{id:"JTBD-6",name:"Bulk Updates",latency:18.4,reduction:49.1},{id:"JTBD-7",name:"Change Notifications",latency:2.91,reduction:48.3},{id:"JTBD-8",name:"Account Consistency",latency:3.45,reduction:49}]}),[]);return(0,b.jsxs)("div",{className:"space-y-8",children:[(0,b.jsxs)("div",{className:"bg-gradient-to-r from-slate-800 to-slate-900 border border-slate-700 rounded-lg p-8 space-y-4",children:[(0,b.jsx)("h2",{className:"text-3xl font-bold text-cyan-400",children:"Knowledge Hook Performance Analysis"}),(0,b.jsx)("p",{className:"text-slate-300 max-w-2xl",children:"Interactive visualization of (O) calculus research findings demonstrating deterministic intent-to-outcome transformation with 8 information-theoretic operators achieving 1.17M operations per second with entropy reduction from 50 to 1 nat."}),(0,b.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-6",children:[(0,b.jsxs)("div",{className:"bg-slate-900/50 border border-slate-700 rounded p-3",children:[(0,b.jsx)("div",{className:"text-xs text-slate-400 uppercase",children:"Single Op"}),(0,b.jsx)("div",{className:"text-xl font-bold text-cyan-400",children:"0.853 s"})]}),(0,b.jsxs)("div",{className:"bg-slate-900/50 border border-slate-700 rounded p-3",children:[(0,b.jsx)("div",{className:"text-xs text-slate-400 uppercase",children:"8-Op Chain"}),(0,b.jsx)("div",{className:"text-xl font-bold text-cyan-400",children:"6.82 s"})]}),(0,b.jsxs)("div",{className:"bg-slate-900/50 border border-slate-700 rounded p-3",children:[(0,b.jsx)("div",{className:"text-xs text-slate-400 uppercase",children:"Throughput"}),(0,b.jsx)("div",{className:"text-xl font-bold text-cyan-400",children:"1.17M ops/s"})]}),(0,b.jsxs)("div",{className:"bg-slate-900/50 border border-slate-700 rounded p-3",children:[(0,b.jsx)("div",{className:"text-xs text-slate-400 uppercase",children:"Entropy "}),(0,b.jsx)("div",{className:"text-xl font-bold text-cyan-400",children:"50  1 nat"})]})]})]}),(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsx)("div",{className:"flex flex-wrap gap-2 bg-slate-900 border border-slate-800 rounded-lg p-1",children:[{id:"overview",label:"Overview"},{id:"performance",label:"Performance"},{id:"entropy",label:"Entropy"},{id:"entropy3d",label:"3D View"},{id:"knowledge-graph",label:"Knowledge Graph"},{id:"diagrams",label:"Diagrams"},{id:"geospatial",label:"Geospatial"},{id:"fmea",label:"FMEA"},{id:"jtbd",label:"JTBD"},{id:"operators",label:"Operators"}].map(i=>(0,b.jsx)("button",{onClick:()=>t(i.id),className:`px-4 py-2 rounded text-sm font-medium transition-colors ${e===i.id?"bg-cyan-500 text-slate-900":"text-slate-400 hover:text-slate-200"}`,children:i.label},i.id))}),(0,b.jsxs)("div",{className:"space-y-6",children:["overview"===e&&(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,b.jsx)(n1,{data:i}),(0,b.jsx)(n3,{data:i})]}),"performance"===e&&(0,b.jsx)(n1,{data:i,detailed:!0}),"entropy"===e&&(0,b.jsx)(n2,{data:i}),"entropy3d"===e&&(0,b.jsx)(MI,{data:i}),"knowledge-graph"===e&&(0,b.jsx)(MM,{data:i}),"diagrams"===e&&(0,b.jsx)(MA,{data:i}),"geospatial"===e&&(0,b.jsx)(v_,{data:i}),"fmea"===e&&(0,b.jsx)(n4,{data:i}),"jtbd"===e&&(0,b.jsx)(n5,{data:i}),"operators"===e&&(0,b.jsx)(n6,{data:i})]})]})]})}e.s(["default",()=>ML],66074)}]);