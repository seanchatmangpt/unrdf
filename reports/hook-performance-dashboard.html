<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Knowledge Hook Performance Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #333;
      padding: 20px;
    }
    .container {
      max-width: 1400px;
      margin: 0 auto;
    }
    .header {
      background: white;
      border-radius: 12px;
      padding: 30px;
      margin-bottom: 20px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    .header h1 {
      color: #667eea;
      font-size: 2.5em;
      margin-bottom: 10px;
    }
    .metadata {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }
    .metadata-item {
      background: #f7fafc;
      padding: 15px;
      border-radius: 8px;
      border-left: 4px solid #667eea;
    }
    .metadata-item label {
      display: block;
      font-size: 0.85em;
      color: #718096;
      margin-bottom: 5px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .metadata-item value {
      display: block;
      font-size: 1.2em;
      font-weight: 600;
      color: #2d3748;
    }
    .filters {
      background: white;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    .filters h2 {
      color: #667eea;
      margin-bottom: 15px;
      font-size: 1.5em;
    }
    .filter-group {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 15px;
    }
    .filter-group label {
      display: inline-flex;
      align-items: center;
      background: #f7fafc;
      padding: 8px 12px;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .filter-group label:hover {
      background: #edf2f7;
    }
    .filter-group input[type="checkbox"] {
      margin-right: 8px;
    }
    .charts-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(600px, 1fr));
      gap: 20px;
      margin-bottom: 20px;
    }
    .chart-container {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
    .chart-container h3 {
      color: #667eea;
      margin-bottom: 15px;
      font-size: 1.3em;
    }
    .chart-wrapper {
      position: relative;
      height: 400px;
    }
    .table-container {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      overflow-x: auto;
    }
    .table-container h2 {
      color: #667eea;
      margin-bottom: 15px;
      font-size: 1.5em;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.9em;
    }
    thead {
      background: #667eea;
      color: white;
    }
    th {
      padding: 12px;
      text-align: left;
      font-weight: 600;
      cursor: pointer;
      user-select: none;
    }
    th:hover {
      background: #5568d3;
    }
    th::after {
      content: ' ‚áÖ';
      opacity: 0.5;
    }
    td {
      padding: 12px;
      border-bottom: 1px solid #e2e8f0;
    }
    tbody tr:hover {
      background: #f7fafc;
    }
    .export-btn {
      background: #667eea;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1em;
      margin-bottom: 15px;
      transition: all 0.2s;
    }
    .export-btn:hover {
      background: #5568d3;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    .summary-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }
    .stat-card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      text-align: center;
    }
    .stat-card .value {
      font-size: 2.5em;
      font-weight: 700;
      color: #667eea;
      margin-bottom: 5px;
    }
    .stat-card .label {
      font-size: 1em;
      color: #718096;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üöÄ Knowledge Hook Performance Dashboard</h1>
      <p style="color: #718096; font-size: 1.1em; margin-top: 10px;">
        Interactive analysis of hook configurations, operations, and data size impact
      </p>
      <div class="metadata">
        <div class="metadata-item">
          <label>Generated</label>
          <value>12/4/2025, 11:52:54 AM</value>
        </div>
        <div class="metadata-item">
          <label>Node Version</label>
          <value>v24.11.1</value>
        </div>
        <div class="metadata-item">
          <label>Platform</label>
          <value>darwin arm64</value>
        </div>
        <div class="metadata-item">
          <label>Total Benchmarks</label>
          <value>30</value>
        </div>
        <div class="metadata-item">
          <label>Iterations per Test</label>
          <value>100</value>
        </div>
      </div>
    </div>

    <div class="summary-stats">
      <div class="stat-card">
        <div class="value">24.16ms</div>
        <div class="label">Mean Latency</div>
      </div>
      <div class="stat-card">
        <div class="value">118.80ms</div>
        <div class="label">P95 Latency</div>
      </div>
      <div class="stat-card">
        <div class="value">236.14ms</div>
        <div class="label">P99 Latency</div>
      </div>
      <div class="stat-card">
        <div class="value">6</div>
        <div class="label">Hook Configs</div>
      </div>
    </div>

    <div class="filters">
      <h2>üîç Filters</h2>
      <div class="filter-group">
        <label><input type="checkbox" id="filter-all" checked> All Hooks</label>
        <label><input type="checkbox" class="hook-filter" value="minimal" checked> minimal</label><label><input type="checkbox" class="hook-filter" value="validation-only" checked> validation-only</label><label><input type="checkbox" class="hook-filter" value="transformation" checked> transformation</label><label><input type="checkbox" class="hook-filter" value="complex-validation" checked> complex-validation</label><label><input type="checkbox" class="hook-filter" value="transformation-chain" checked> transformation-chain</label><label><input type="checkbox" class="hook-filter" value="intensive-compute" checked> intensive-compute</label>
      </div>
      <div class="filter-group">
        <label>Data Size:</label>
        <label><input type="checkbox" class="size-filter" value="10" checked> 10 quads</label><label><input type="checkbox" class="size-filter" value="50" checked> 50 quads</label><label><input type="checkbox" class="size-filter" value="100" checked> 100 quads</label><label><input type="checkbox" class="size-filter" value="500" checked> 500 quads</label><label><input type="checkbox" class="size-filter" value="1000" checked> 1000 quads</label>
      </div>
    </div>

    <div class="charts-grid">
      <div class="chart-container">
        <h3>üìä Latency Comparison (Mean)</h3>
        <div class="chart-wrapper">
          <canvas id="latencyChart"></canvas>
        </div>
      </div>

      <div class="chart-container">
        <h3>‚ö° Throughput Comparison</h3>
        <div class="chart-wrapper">
          <canvas id="throughputChart"></canvas>
        </div>
      </div>

      <div class="chart-container">
        <h3>üíæ Memory Usage</h3>
        <div class="chart-wrapper">
          <canvas id="memoryChart"></canvas>
        </div>
      </div>

      <div class="chart-container">
        <h3>üìà Overhead Percentage</h3>
        <div class="chart-wrapper">
          <canvas id="overheadChart"></canvas>
        </div>
      </div>

      <div class="chart-container">
        <h3>üìè Data Size Impact (Latency)</h3>
        <div class="chart-wrapper">
          <canvas id="scalingChart"></canvas>
        </div>
      </div>

      <div class="chart-container">
        <h3>üéØ Hook Trigger Type Performance</h3>
        <div class="chart-wrapper">
          <canvas id="operationsChart"></canvas>
        </div>
      </div>
    </div>

    <div class="table-container">
      <h2>üìã Benchmark Results</h2>
      <button class="export-btn" onclick="exportToCSV()">üì• Export to CSV</button>
      <table id="resultsTable">
        <thead>
          <tr>
            <th onclick="sortTable(0)">Hook Config</th>
            <th onclick="sortTable(1)">Data Size</th>
            <th onclick="sortTable(2)">Mean Latency (ms)</th>
            <th onclick="sortTable(3)">P95 Latency (ms)</th>
            <th onclick="sortTable(4)">P99 Latency (ms)</th>
            <th onclick="sortTable(5)">Throughput (ops/sec)</th>
            <th onclick="sortTable(6)">Memory Delta (MB)</th>
            <th onclick="sortTable(7)">Overhead %</th>
          </tr>
        </thead>
        <tbody id="resultsBody"></tbody>
      </table>
    </div>
  </div>

  <script>
    // Benchmark data
    const data = {"metadata":{"timestamp":"2025-12-04T19:52:54.552Z","nodeVersion":"v24.11.1","platform":"darwin arm64","testSizes":[10,50,100,500,1000],"iterations":100},"hookConfigurations":[{"name":"minimal","description":"Minimal hook with validation only"},{"name":"validation-only","description":"Validation hook with type checking"},{"name":"transformation","description":"Hook that transforms data"},{"name":"complex-validation","description":"Hook with complex validation logic"},{"name":"transformation-chain","description":"Hook with validation and transformation"},{"name":"intensive-compute","description":"Hook with CPU-intensive operations"}],"results":[{"hookConfig":"minimal","hookName":"MinimalHook","dataSize":10,"iterations":100,"latency":{"min":"0.045","max":"1.458","mean":"0.153","median":"0.079","p95":"0.610","p99":"1.458"},"throughput":"6553598.74","memory":{"before":"7.06","after":"8.40","delta":"1.34"},"overhead":"0.015"},{"hookConfig":"minimal","hookName":"MinimalHook","dataSize":50,"iterations":100,"latency":{"min":"0.119","max":"1.276","mean":"0.287","median":"0.249","p95":"0.579","p99":"1.276"},"throughput":"17441862.70","memory":{"before":"8.70","after":"9.05","delta":"0.35"},"overhead":"0.006"},{"hookConfig":"minimal","hookName":"MinimalHook","dataSize":100,"iterations":100,"latency":{"min":"0.210","max":"1.876","mean":"0.423","median":"0.416","p95":"0.980","p99":"1.876"},"throughput":"23628205.46","memory":{"before":"9.47","after":"10.91","delta":"1.44"},"overhead":"0.004"},{"hookConfig":"minimal","hookName":"MinimalHook","dataSize":500,"iterations":100,"latency":{"min":"0.984","max":"4.833","mean":"1.436","median":"1.100","p95":"2.649","p99":"4.833"},"throughput":"34828006.24","memory":{"before":"8.89","after":"8.43","delta":"-0.45"},"overhead":"0.003"},{"hookConfig":"minimal","hookName":"MinimalHook","dataSize":1000,"iterations":100,"latency":{"min":"2.292","max":"9.507","mean":"2.662","median":"2.350","p95":"4.488","p99":"9.507"},"throughput":"37562000.21","memory":{"before":"12.15","after":"12.80","delta":"0.64"},"overhead":"0.003"},{"hookConfig":"validation-only","hookName":"ValidationHook","dataSize":10,"iterations":100,"latency":{"min":"0.155","max":"22.245","mean":"0.505","median":"0.223","p95":"0.946","p99":"22.245"},"throughput":"1980814.23","memory":{"before":"12.86","after":"13.71","delta":"0.85"},"overhead":"0.050"},{"hookConfig":"validation-only","hookName":"ValidationHook","dataSize":50,"iterations":100,"latency":{"min":"0.641","max":"23.069","mean":"1.725","median":"0.753","p95":"4.143","p99":"23.069"},"throughput":"2898989.07","memory":{"before":"13.92","after":"35.16","delta":"21.24"},"overhead":"0.034"},{"hookConfig":"validation-only","hookName":"ValidationHook","dataSize":100,"iterations":100,"latency":{"min":"1.192","max":"9.092","mean":"1.756","median":"1.384","p95":"4.021","p99":"9.092"},"throughput":"5695012.07","memory":{"before":"35.55","after":"59.25","delta":"23.70"},"overhead":"0.018"},{"hookConfig":"validation-only","hookName":"ValidationHook","dataSize":500,"iterations":100,"latency":{"min":"6.647","max":"52.613","mean":"13.266","median":"10.218","p95":"36.877","p99":"52.613"},"throughput":"3769167.14","memory":{"before":"61.15","after":"122.58","delta":"61.43"},"overhead":"0.027"},{"hookConfig":"validation-only","hookName":"ValidationHook","dataSize":1000,"iterations":100,"latency":{"min":"14.241","max":"87.478","mean":"27.229","median":"22.093","p95":"60.625","p99":"87.478"},"throughput":"3672568.48","memory":{"before":"69.40","after":"107.60","delta":"38.20"},"overhead":"0.027"},{"hookConfig":"transformation","hookName":"TransformHook","dataSize":10,"iterations":100,"latency":{"min":"0.100","max":"12.401","mean":"0.447","median":"0.114","p95":"2.429","p99":"12.401"},"throughput":"2236969.62","memory":{"before":"107.67","after":"124.16","delta":"16.49"},"overhead":"0.045"},{"hookConfig":"transformation","hookName":"TransformHook","dataSize":50,"iterations":100,"latency":{"min":"0.516","max":"12.100","mean":"1.007","median":"0.598","p95":"3.386","p99":"12.100"},"throughput":"4962883.83","memory":{"before":"124.37","after":"148.06","delta":"23.69"},"overhead":"0.020"},{"hookConfig":"transformation","hookName":"TransformHook","dataSize":100,"iterations":100,"latency":{"min":"0.935","max":"31.335","mean":"1.850","median":"1.079","p95":"5.578","p99":"31.335"},"throughput":"5404547.25","memory":{"before":"148.45","after":"136.48","delta":"-11.98"},"overhead":"0.019"},{"hookConfig":"transformation","hookName":"TransformHook","dataSize":500,"iterations":100,"latency":{"min":"4.956","max":"186.540","mean":"32.828","median":"10.045","p95":"136.704","p99":"186.540"},"throughput":"1523089.43","memory":{"before":"138.41","after":"88.45","delta":"-49.96"},"overhead":"0.066"},{"hookConfig":"transformation","hookName":"TransformHook","dataSize":1000,"iterations":100,"latency":{"min":"13.299","max":"430.829","mean":"118.795","median":"99.879","p95":"304.222","p99":"430.829"},"throughput":"841786.11","memory":{"before":"83.09","after":"125.26","delta":"42.16"},"overhead":"0.119"},{"hookConfig":"complex-validation","hookName":"ComplexValidationHook","dataSize":10,"iterations":100,"latency":{"min":"0.034","max":"61.035","mean":"0.671","median":"0.051","p95":"0.121","p99":"61.035"},"throughput":"1490251.87","memory":{"before":"125.32","after":"129.85","delta":"4.52"},"overhead":"0.067"},{"hookConfig":"complex-validation","hookName":"ComplexValidationHook","dataSize":50,"iterations":100,"latency":{"min":"0.088","max":"94.936","mean":"1.286","median":"0.162","p95":"0.880","p99":"94.936"},"throughput":"3888981.19","memory":{"before":"130.07","after":"165.91","delta":"35.84"},"overhead":"0.026"},{"hookConfig":"complex-validation","hookName":"ComplexValidationHook","dataSize":100,"iterations":100,"latency":{"min":"0.175","max":"0.710","mean":"0.192","median":"0.177","p95":"0.231","p99":"0.710"},"throughput":"52140359.14","memory":{"before":"166.32","after":"131.38","delta":"-34.95"},"overhead":"0.002"},{"hookConfig":"complex-validation","hookName":"ComplexValidationHook","dataSize":500,"iterations":100,"latency":{"min":"0.851","max":"65.182","mean":"1.676","median":"0.917","p95":"1.981","p99":"65.182"},"throughput":"29837772.09","memory":{"before":"133.43","after":"139.31","delta":"5.89"},"overhead":"0.003"},{"hookConfig":"complex-validation","hookName":"ComplexValidationHook","dataSize":1000,"iterations":100,"latency":{"min":"1.711","max":"87.451","mean":"3.062","median":"1.852","p95":"4.707","p99":"87.451"},"throughput":"32659984.71","memory":{"before":"143.41","after":"152.96","delta":"9.55"},"overhead":"0.003"},{"hookConfig":"transformation-chain","hookName":"TransformChainHook","dataSize":10,"iterations":100,"latency":{"min":"0.111","max":"65.462","mean":"1.646","median":"0.174","p95":"4.335","p99":"65.462"},"throughput":"607388.72","memory":{"before":"153.03","after":"134.62","delta":"-18.41"},"overhead":"0.165"},{"hookConfig":"transformation-chain","hookName":"TransformChainHook","dataSize":50,"iterations":100,"latency":{"min":"0.713","max":"140.038","mean":"9.076","median":"1.133","p95":"76.411","p99":"140.038"},"throughput":"550915.29","memory":{"before":"134.83","after":"141.15","delta":"6.32"},"overhead":"0.182"},{"hookConfig":"transformation-chain","hookName":"TransformChainHook","dataSize":100,"iterations":100,"latency":{"min":"1.661","max":"120.962","mean":"14.474","median":"2.480","p95":"106.459","p99":"120.962"},"throughput":"690881.41","memory":{"before":"141.55","after":"159.78","delta":"18.23"},"overhead":"0.145"},{"hookConfig":"transformation-chain","hookName":"TransformChainHook","dataSize":500,"iterations":100,"latency":{"min":"9.768","max":"342.858","mean":"97.890","median":"85.243","p95":"285.897","p99":"342.858"},"throughput":"510778.54","memory":{"before":"146.59","after":"200.72","delta":"54.13"},"overhead":"0.196"},{"hookConfig":"transformation-chain","hookName":"TransformChainHook","dataSize":1000,"iterations":100,"latency":{"min":"19.166","max":"918.354","mean":"236.138","median":"187.469","p95":"707.536","p99":"918.354"},"throughput":"423481.31","memory":{"before":"184.16","after":"271.55","delta":"87.38"},"overhead":"0.236"},{"hookConfig":"intensive-compute","hookName":"IntensiveComputeHook","dataSize":10,"iterations":100,"latency":{"min":"0.177","max":"67.403","mean":"0.890","median":"0.179","p95":"0.273","p99":"67.403"},"throughput":"1123868.54","memory":{"before":"271.61","after":"260.17","delta":"-11.44"},"overhead":"0.089"},{"hookConfig":"intensive-compute","hookName":"IntensiveComputeHook","dataSize":50,"iterations":100,"latency":{"min":"0.689","max":"275.089","mean":"9.564","median":"0.856","p95":"29.395","p99":"275.089"},"throughput":"522812.37","memory":{"before":"260.38","after":"231.39","delta":"-29.00"},"overhead":"0.191"},{"hookConfig":"intensive-compute","hookName":"IntensiveComputeHook","dataSize":100,"iterations":100,"latency":{"min":"1.380","max":"375.124","mean":"14.367","median":"1.914","p95":"86.877","p99":"375.124"},"throughput":"696026.19","memory":{"before":"231.85","after":"235.02","delta":"3.16"},"overhead":"0.144"},{"hookConfig":"intensive-compute","hookName":"IntensiveComputeHook","dataSize":500,"iterations":100,"latency":{"min":"7.496","max":"276.829","mean":"47.806","median":"11.140","p95":"219.493","p99":"276.829"},"throughput":"1045904.37","memory":{"before":"237.10","after":"254.82","delta":"17.73"},"overhead":"0.096"},{"hookConfig":"intensive-compute","hookName":"IntensiveComputeHook","dataSize":1000,"iterations":100,"latency":{"min":"17.523","max":"448.388","mean":"81.683","median":"30.001","p95":"278.589","p99":"448.388"},"throughput":"1224249.95","memory":{"before":"258.77","after":"251.06","delta":"-7.71"},"overhead":"0.082"}],"triggerResults":[{"trigger":"before-add","latency":{"mean":"18.123","p95":"168.392","p99":"317.344"}},{"trigger":"after-add","latency":{"mean":"6.151","p95":"10.288","p99":"128.407"}},{"trigger":"before-query","latency":{"mean":"8.037","p95":"8.332","p99":"221.220"}},{"trigger":"after-query","latency":{"mean":"11.621","p95":"98.864","p99":"244.400"}}],"summary":{"totalBenchmarks":30,"meanLatency":24.159666666666666,"p95Latency":118.795,"p99Latency":236.138}};

    // Color palette
    const colors = [
      'rgba(102, 126, 234, 0.8)',
      'rgba(118, 75, 162, 0.8)',
      'rgba(237, 100, 166, 0.8)',
      'rgba(255, 154, 158, 0.8)',
      'rgba(255, 198, 93, 0.8)',
      'rgba(160, 212, 104, 0.8)'
    ];

    // Initialize charts
    let charts = {};

    function updateCharts() {
      const selectedHooks = Array.from(document.querySelectorAll('.hook-filter:checked')).map(cb => cb.value);
      const selectedSizes = Array.from(document.querySelectorAll('.size-filter:checked')).map(cb => parseInt(cb.value));

      const filteredData = data.results.filter(r =>
        selectedHooks.includes(r.hookConfig) && selectedSizes.includes(r.dataSize)
      );

      // Group by hook config
      const groupedByHook = {};
      filteredData.forEach(r => {
        if (!groupedByHook[r.hookConfig]) groupedByHook[r.hookConfig] = [];
        groupedByHook[r.hookConfig].push(r);
      });

      // Latency Chart
      if (charts.latency) charts.latency.destroy();
      charts.latency = new Chart(document.getElementById('latencyChart'), {
        type: 'bar',
        data: {
          labels: selectedSizes.map(s => s + ' quads'),
          datasets: selectedHooks.map((hook, idx) => ({
            label: hook,
            data: selectedSizes.map(size => {
              const item = filteredData.find(r => r.hookConfig === hook && r.dataSize === size);
              return item ? parseFloat(item.latency.mean) : 0;
            }),
            backgroundColor: colors[idx % colors.length]
          }))
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: { beginAtZero: true, title: { display: true, text: 'Latency (ms)' } }
          }
        }
      });

      // Throughput Chart
      if (charts.throughput) charts.throughput.destroy();
      charts.throughput = new Chart(document.getElementById('throughputChart'), {
        type: 'line',
        data: {
          labels: selectedSizes.map(s => s + ' quads'),
          datasets: selectedHooks.map((hook, idx) => ({
            label: hook,
            data: selectedSizes.map(size => {
              const item = filteredData.find(r => r.hookConfig === hook && r.dataSize === size);
              return item ? parseFloat(item.throughput) : 0;
            }),
            borderColor: colors[idx % colors.length],
            backgroundColor: colors[idx % colors.length].replace('0.8', '0.2'),
            fill: true
          }))
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: { beginAtZero: true, title: { display: true, text: 'Operations/sec' } }
          }
        }
      });

      // Memory Chart
      if (charts.memory) charts.memory.destroy();
      charts.memory = new Chart(document.getElementById('memoryChart'), {
        type: 'line',
        data: {
          labels: selectedSizes.map(s => s + ' quads'),
          datasets: selectedHooks.map((hook, idx) => ({
            label: hook,
            data: selectedSizes.map(size => {
              const item = filteredData.find(r => r.hookConfig === hook && r.dataSize === size);
              return item ? parseFloat(item.memory.delta) : 0;
            }),
            borderColor: colors[idx % colors.length],
            backgroundColor: colors[idx % colors.length]
          }))
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: { beginAtZero: true, title: { display: true, text: 'Memory Delta (MB)' } }
          }
        }
      });

      // Overhead Chart
      if (charts.overhead) charts.overhead.destroy();
      charts.overhead = new Chart(document.getElementById('overheadChart'), {
        type: 'bar',
        data: {
          labels: selectedHooks,
          datasets: [{
            label: 'Overhead %',
            data: selectedHooks.map(hook => {
              const items = filteredData.filter(r => r.hookConfig === hook);
              const avg = items.reduce((sum, r) => sum + parseFloat(r.overhead), 0) / items.length;
              return avg;
            }),
            backgroundColor: colors
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: { beginAtZero: true, title: { display: true, text: 'Overhead %' } }
          }
        }
      });

      // Scaling Chart
      if (charts.scaling) charts.scaling.destroy();
      charts.scaling = new Chart(document.getElementById('scalingChart'), {
        type: 'line',
        data: {
          labels: selectedSizes.map(s => s + ' quads'),
          datasets: selectedHooks.map((hook, idx) => ({
            label: hook,
            data: selectedSizes.map(size => {
              const item = filteredData.find(r => r.hookConfig === hook && r.dataSize === size);
              return item ? parseFloat(item.latency.mean) : 0;
            }),
            borderColor: colors[idx % colors.length],
            backgroundColor: 'transparent',
            tension: 0.4
          }))
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true,
              title: { display: true, text: 'Latency (ms)' },
              type: 'logarithmic'
            }
          }
        }
      });

      // Trigger Types Chart
      if (charts.triggers) charts.triggers.destroy();
      charts.triggers = new Chart(document.getElementById('operationsChart'), {
        type: 'bar',
        data: {
          labels: data.triggerResults.map(r => r.trigger),
          datasets: [{
            label: 'Mean Latency',
            data: data.triggerResults.map(r => parseFloat(r.latency.mean)),
            backgroundColor: colors[0]
          }, {
            label: 'P95 Latency',
            data: data.triggerResults.map(r => parseFloat(r.latency.p95)),
            backgroundColor: colors[1]
          }, {
            label: 'P99 Latency',
            data: data.triggerResults.map(r => parseFloat(r.latency.p99)),
            backgroundColor: colors[2]
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: { beginAtZero: true, title: { display: true, text: 'Latency (ms)' } }
          }
        }
      });

      updateTable(filteredData);
    }

    function updateTable(filteredData) {
      const tbody = document.getElementById('resultsBody');
      tbody.innerHTML = filteredData.map(r =>
        '<tr>' +
        '<td>' + r.hookConfig + '</td>' +
        '<td>' + r.dataSize + '</td>' +
        '<td>' + r.latency.mean + '</td>' +
        '<td>' + r.latency.p95 + '</td>' +
        '<td>' + r.latency.p99 + '</td>' +
        '<td>' + r.throughput + '</td>' +
        '<td>' + r.memory.delta + '</td>' +
        '<td>' + r.overhead + '</td>' +
        '</tr>'
      ).join('');
    }

    function sortTable(column) {
      const tbody = document.getElementById('resultsBody');
      const rows = Array.from(tbody.rows);
      const sorted = rows.sort((a, b) => {
        const aVal = a.cells[column].textContent;
        const bVal = b.cells[column].textContent;
        return isNaN(aVal) ? aVal.localeCompare(bVal) : parseFloat(aVal) - parseFloat(bVal);
      });
      tbody.innerHTML = '';
      sorted.forEach(row => tbody.appendChild(row));
    }

    function exportToCSV() {
      const rows = [
        ['Hook Config', 'Data Size', 'Mean Latency (ms)', 'P95 Latency (ms)', 'P99 Latency (ms)', 'Throughput (ops/sec)', 'Memory Delta (MB)', 'Overhead %']
      ];
      data.results.forEach(r => {
        rows.push([
          r.hookConfig,
          r.dataSize,
          r.latency.mean,
          r.latency.p95,
          r.latency.p99,
          r.throughput,
          r.memory.delta,
          r.overhead
        ]);
      });
      const csv = rows.map(row => row.join(',')).join('\n');
      const blob = new Blob([csv], { type: 'text/csv' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'hook-benchmarks.csv';
      a.click();
    }

    // Event listeners
    document.getElementById('filter-all').addEventListener('change', (e) => {
      document.querySelectorAll('.hook-filter').forEach(cb => cb.checked = e.target.checked);
      updateCharts();
    });

    document.querySelectorAll('.hook-filter, .size-filter').forEach(cb => {
      cb.addEventListener('change', updateCharts);
    });

    // Initial render
    updateCharts();
  </script>
</body>
</html>