# Threshold Monitoring Hook Template
# This template provides a SPARQL query for monitoring numeric thresholds.
# Ideal for compliance, alerting, and governance use cases.
#
# Usage:
# 1. Customize the threshold values and aggregation logic
# 2. Update the FILTER clause with your condition
# 3. Calculate the SHA-256 hash of this file
# 4. Reference this file in your Knowledge Hook definition
#
# Example: Detect when total transaction amount exceeds threshold

PREFIX ex: <http://example.org/>
PREFIX fibo: <https://spec.edmcouncil.org/fibo/ontology/>
PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>

# TODO: Choose ASK or SELECT based on your needs

# Option 1: ASK query for simple threshold check
ASK WHERE {
  # Pattern 1: Single value threshold
  ?resource ex:amount ?amount .
  FILTER(?amount > 10000)  # TODO: Adjust threshold value

  # Pattern 2: Percentage threshold
  # ?resource ex:score ?score .
  # FILTER(?score > 0.95)

  # Pattern 3: Time-based threshold
  # ?resource ex:age ?age .
  # FILTER(?age > 365)  # Days
}

# Option 2: SELECT query with aggregation
# SELECT ?category (SUM(?amount) AS ?total) WHERE {
#   ?transaction rdf:type fibo:Transaction ;
#                fibo:hasAmount ?amount ;
#                fibo:hasCategory ?category .
#
#   # TODO: Add time window filter if needed
#   # ?transaction fibo:hasTimestamp ?timestamp .
#   # BIND(NOW() - ?timestamp AS ?age)
#   # FILTER(?age < 86400)  # Last 24 hours in seconds
# }
# GROUP BY ?category
# HAVING(SUM(?amount) > 50000)  # TODO: Adjust aggregated threshold

# Option 3: Percentile or statistical threshold
# SELECT ?resource ?value WHERE {
#   {
#     SELECT (AVG(?amount) AS ?avgAmount) (STDEV(?amount) AS ?stdDev) WHERE {
#       ?res ex:amount ?amount .
#     }
#   }
#   ?resource ex:amount ?value .
#   # Detect outliers (more than 2 standard deviations from mean)
#   FILTER(?value > (?avgAmount + (2 * ?stdDev)))
# }
