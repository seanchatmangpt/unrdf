graph TD
    subgraph "Current Architecture - PROBLEMATIC"
        App["Application"]
        Context["Context System<br/>(unctx + AsyncLocalStorage)"]
        StoreCtx["StoreContext<br/>(store + engine)"]
        
        subgraph "Composables - Current Issues"
            Store["useStore()<br/>✅ Uses Context"]
            Graph["useGraph()<br/>✅ Uses Context"]
            Turtle["useTurtle()<br/>✅ Uses Context"]
            Terms["useTerms()<br/>✅ No Context Needed"]
            Prefixes["usePrefixes()<br/>✅ No Context Needed"]
            IRIs["useIRIs()<br/>✅ No Context Needed"]
            Lists["useLists()<br/>✅ Uses Context"]
            TurtleFS["useTurtleFS()<br/>⚠️ Calls useStore() incorrectly"]
            NQuads["useNQuads()<br/>⚠️ Reassigns engine"]
            JsonLD["useJsonLD()<br/>❌ Creates own engine"]
            Pointer["usePointer()<br/>❌ Creates own engine"]
            Validator["useValidator()<br/>❌ Creates own engine"]
            Reasoner["useReasoner()<br/>⚠️ Inconsistent patterns"]
            Canon["useCanon()<br/>❌ Creates own engine"]
            Zod["useZod()<br/>✅ No Context Needed"]
            Delta["useDelta()<br/>✅ No Context Needed"]
            Metrics["useMetrics()<br/>✅ No Context Needed"]
            Cache["useCache()<br/>✅ No Context Needed"]
        end
        
        subgraph "Engine Instances - PROBLEM"
            Engine1["RdfEngine #1<br/>(Context)"]
            Engine2["RdfEngine #2<br/>(JsonLD)"]
            Engine3["RdfEngine #3<br/>(Pointer)"]
            Engine4["RdfEngine #4<br/>(Validator)"]
            Engine5["RdfEngine #5<br/>(Canon)"]
            Engine6["RdfEngine #6<br/>(Reasoner)"]
        end
        
        subgraph "Store Instances - PROBLEM"
            Store1["Store #1<br/>(Context)"]
            Store2["Store #2<br/>(JsonLD)"]
            Store3["Store #3<br/>(Pointer)"]
            Store4["Store #4<br/>(Validator)"]
            Store5["Store #5<br/>(Canon)"]
            Store6["Store #6<br/>(Reasoner)"]
        end
    end
    
    App --> Context
    Context --> StoreCtx
    StoreCtx --> Engine1
    StoreCtx --> Store1
    
    Store --> StoreCtx
    Graph --> StoreCtx
    Turtle --> StoreCtx
    Lists --> StoreCtx
    
    TurtleFS -.-> StoreCtx
    NQuads -.-> StoreCtx
    
    JsonLD --> Engine2
    JsonLD --> Store2
    Pointer --> Engine3
    Pointer --> Store3
    Validator --> Engine4
    Validator --> Store4
    Canon --> Engine5
    Canon --> Store5
    Reasoner --> Engine6
    Reasoner --> Store6
    
    classDef problem fill:#ffcccc,stroke:#ff0000,stroke-width:2px
    classDef warning fill:#fff2cc,stroke:#ff9900,stroke-width:2px
    classDef good fill:#ccffcc,stroke:#00cc00,stroke-width:2px
    classDef engine fill:#ffcccc,stroke:#ff0000,stroke-width:3px
    
    class JsonLD,Pointer,Validator,Canon problem
    class TurtleFS,NQuads,Reasoner warning
    class Store,Graph,Turtle,Terms,Prefixes,IRIs,Lists,Zod,Delta,Metrics,Cache good
    class Engine2,Engine3,Engine4,Engine5,Engine6,Store2,Store3,Store4,Store5,Store6 engine
