graph TD
    subgraph "Proposed Architecture - CORRECT"
        App["Application"]
        Context["Context System<br/>(unctx + AsyncLocalStorage)"]
        StoreCtx["StoreContext<br/>(store + engine)"]
        
        subgraph "Composables - Refactored"
            Store["useStore()<br/>✅ Returns Context"]
            Graph["useGraph()<br/>✅ Uses Context"]
            Turtle["useTurtle()<br/>✅ Uses Context"]
            Terms["useTerms()<br/>✅ Pure Utility"]
            Prefixes["usePrefixes()<br/>✅ Pure Utility"]
            IRIs["useIRIs()<br/>✅ Pure Utility"]
            Lists["useLists()<br/>✅ Uses Context"]
            TurtleFS["useTurtleFS()<br/>✅ Uses Context Directly"]
            NQuads["useNQuads()<br/>✅ Uses Context Engine"]
            Pointer["usePointer()<br/>✅ Uses Context Engine"]
            Validator["useValidator()<br/>✅ Uses Context Engine"]
            Reasoner["useReasoner()<br/>✅ Uses Context Store"]
            Canon["useCanon()<br/>✅ Uses Context Engine"]
            Zod["useZod()<br/>✅ Pure Utility"]
            Delta["useDelta()<br/>✅ Pure Utility"]
            Metrics["useMetrics()<br/>✅ Pure Utility"]
            Cache["useCache()<br/>✅ Pure Utility"]
        end
        
        subgraph "Single Engine Instance - SOLUTION"
            Engine["RdfEngine<br/>(Shared Context)"]
        end
        
        subgraph "Single Store Instance - SOLUTION"
            Store["Store<br/>(Shared Context)"]
        end
    end
    
    App --> Context
    Context --> StoreCtx
    StoreCtx --> Engine
    StoreCtx --> Store
    
    Store --> StoreCtx
    Graph --> StoreCtx
    Turtle --> StoreCtx
    Lists --> StoreCtx
    TurtleFS --> StoreCtx
    NQuads --> StoreCtx
    Pointer --> StoreCtx
    Validator --> StoreCtx
    Reasoner --> StoreCtx
    Canon --> StoreCtx
    
    classDef good fill:#ccffcc,stroke:#00cc00,stroke-width:2px
    classDef solution fill:#ccffff,stroke:#0066cc,stroke-width:3px
    
    class Store,Graph,Turtle,Terms,Prefixes,IRIs,Lists,TurtleFS,NQuads,Pointer,Validator,Reasoner,Canon,Zod,Delta,Metrics,Cache good
    class Engine,Store solution
